"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6183],{10433:(e,t,i)=>{i.d(t,{X:()=>s});var a=i(64088),o=i(3489),r=i(99392),n=i(13880);class s extends r.w{constructor(e){super({...e,isDraped:!0,constraint:new a.en(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new n.c(o.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},24056:(e,t,i)=>{i.d(t,{C:()=>a});class a{constructor(e,t,i,a){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=a}}},25927:(e,t,i)=>{i.d(t,{R:()=>u});var a=i(54036),o=i(63599),r=i(56911),n=i(64088),s=i(73541),p=i(18836),l=i(3489),h=i(24056),d=i(13880),c=i(82587);class u extends h.C{constructor({targetPoint:e,point1:t,point2:i,isDraped:l}){super(e,new n.ej((0,s._7)((0,o.m)((0,r.vt)(),t,i,.5)),.5*(0,a.Io)((0,s.Xz)(t),(0,s.Xz)(i))),l,p.n.SELF),this._p1=t,this._p2=i}get hints(){return[new d.c(l.H3.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new d.c(l.H3.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new c.l(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}},26183:(e,t,i)=>{i.d(t,{RouteLayerInteraction:()=>ex});var a,o,r=i(81856),n=i(28690),s=i(19158),p=i(40941),l=i(45257),h=i(91838);i(57845);var d=i(61939);i(33638);var c=i(12709),u=i(18524),y=i(54774),g=i(81794),v=i(97477),m=i(13711),_=i(78988),f=i(54335),b=i(32391),E=i(74652),w=i(92753),S=i(69752),T=i(65111),M=i(60470),O=i(71760),G=i(71086),C=i(92090),P=i(46633),R=i(59276),A=i(71230),k=i(22191),D=i(76558),H=i(72735),I=i(86410),x=i(26585),U=i(63667),N=i(83392),Z=i(23500),L=i(54376),F=i(69802),V=i(29251),j=i(66612),B=i(83610),Y=i(73541),q=i(51205),z=i(18836),K=i(31461);let W=class extends n.A{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new f.A}};(0,r._)([(0,h.MZ)({constructOnly:!0})],W.prototype,"layer",void 0),(0,r._)([(0,h.MZ)()],W.prototype,"enabled",void 0),(0,r._)([(0,h.MZ)()],W.prototype,"updating",void 0),(0,r._)([(0,h.MZ)()],W.prototype,"availability",void 0),(0,r._)([(0,h.MZ)()],W.prototype,"sublayerSources",void 0);let $=W=(0,r._)([(0,c.$)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],W),X=class extends n.A{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new f.A,this.distance=q.N.distance,this.touchSensitivityMultiplier=q.N.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){let e=this.featureSources;e.some(J)&&d.A.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");let t=e.filter(et),i=this._get("_effectiveFeatureSources")?.filter(J)??new f.A;for(let e of t){let t=i.find(t=>t.layer===e.layer.parent);if(t)t.sublayerSources.includes(e)||t.sublayerSources.add(e);else if(e.layer.parent){let t=new $({layer:e.layer.parent});t.sublayerSources.add(e),i.add(t)}}for(let e of i){let i=e.sublayerSources.filter(e=>!t.includes(e));e.sublayerSources.removeMany(i)}i.removeMany(i.filter(e=>0===e.sublayerSources.length));let a=e.filter(ee),o=this._get("_effectiveFeatureSources")??new f.A,{added:r,removed:n}=(0,K.iv)(o.toArray(),[...a,...i]);return o.removeMany(n),o.addMany(r),o}};(0,r._)([(0,h.MZ)()],X.prototype,"enabled",void 0),(0,r._)([(0,h.MZ)()],X.prototype,"enabledToggled",void 0),(0,r._)([(0,h.MZ)()],X.prototype,"forceDisabled",void 0),(0,r._)([(0,h.MZ)()],X.prototype,"selfEnabled",void 0),(0,r._)([(0,h.MZ)()],X.prototype,"featureEnabled",void 0),(0,r._)([(0,h.MZ)()],X.prototype,"gridEnabled",void 0),(0,r._)([(0,h.MZ)()],X.prototype,"attributeRulesEnabled",void 0),(0,r._)([(0,h.MZ)({type:f.A.ofType($)})],X.prototype,"featureSources",void 0),(0,r._)([(0,h.MZ)()],X.prototype,"distance",void 0),(0,r._)([(0,h.MZ)()],X.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],X.prototype,"effectiveEnabled",null),(0,r._)([(0,h.MZ)({readOnly:!0})],X.prototype,"effectiveGridEnabled",null),(0,r._)([(0,h.MZ)({readOnly:!0})],X.prototype,"effectiveSelfEnabled",null),(0,r._)([(0,h.MZ)({readOnly:!0})],X.prototype,"effectiveFeatureEnabled",null),(0,r._)([(0,h.MZ)({readOnly:!0})],X.prototype,"_effectiveFeatureSources",null);let Q=X=(0,r._)([(0,c.$)("esri.views.interactive.snapping.SnappingOptions")],X);function J(e){return"subtype-group"===e.layer.type}function ee(e){return"subtype-group"!==e.layer.type}function et(e){return"subtype-sublayer"===e.layer.type}var ei=i(3489),ea=i(10433),eo=i(87255),er=i(50547),en=i(58562),es=i(41723),ep=i(39443),el=i(25927),eh=i(94799);let ed=class extends E.A.EventedMixin(n.A){constructor(e){super(e),this.options=new Q,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=a.MAIN}initialize(){this.addHandles([(0,l.wB)(()=>{let{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:i,effectiveFeatureEnabled:a,effectiveGridEnabled:o}=this.options;return{selfEnabled:i,featureEnabled:a,gridEnabled:"2d"===this.view.type&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=(0,B.UT)(i=>this._updateEngines(e,t,i))},l.pc),(0,l.wB)(()=>this.options,e=>{for(let t of this._engines)t.options=e},l.OH)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,i){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();let a=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!a.has("feature")?this._createFeatureSnappingEngine(i):void 0,e.selfEnabled&&!a.has("self")?this._createSelfSnappingEngine(i):void 0,e.gridEnabled&&!a.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(let e of o)"fulfilled"===e.status&&e.value?.engine.destroy();else{for(let e of o)"fulfilled"===e.status&&e.value&&a.set(e.value.type,e.value.engine);this._engines=Array.from(a.values())}}async _createSelfSnappingEngine(e){let{SelfSnappingEngine:t}=await Promise.all([i.e(472),i.e(2111)]).then(i.bind(i,34718));return(0,w.Te)(e),{type:"self",engine:new t({view:this.view,options:this.options})}}async _createGridSnappingEngine(e){let{view:t}=this;if("2d"!==t.type)return;let{GridSnappingEngine:a}=await i.e(7194).then(i.bind(i,7194));return(0,w.Te)(e),{type:"grid",engine:new a({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){let{FeatureSnappingEngine:t}=await i.e(1856).then(i.bind(i,51856));(0,w.Te)(e);let{view:a,options:o}=this,{spatialReference:r}=a;return{type:"feature",engine:new t({view:a,options:o,spatialReference:r})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){let{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}snap(e){return null!=e.scenePoint?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){let{point:t,context:i}=e;this._removeVisualization();let a=this._currentMainCandidate;if(null==a)return t;let o=this._selectUpdateInput(e);if(null==o)return t;let{spatialReference:r}=i,n=(0,T.project)(o,r);if(null==n)return t;let{view:s}=this,{elevationInfo:p,visualizer:l}=i,h=[],d=(0,Y.vf)(n,s,p),c=a.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,c,i)||!eu(a,i.drawConstraints))return this._resetSnappingState(),t;for(let e of(a.targetPoint=(0,Y.de)(c),h.push(...a.hints),this._currentOtherActiveCandidates))eu(e,i.drawConstraints)&&(e.targetPoint=(0,Y.de)(c),h.push(...e.hints));return null!=l&&this.addHandles(l.draw(h,{spatialReference:r,elevationInfo:function({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?x.qt:t}(i),view:s,selfSnappingZ:i.selfSnappingZ}),ec),(0,Y.xF)(c,s,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case a.MAIN:return e;case a.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=a.MAIN}_removeVisualization(){this.removeHandles(ec)}async _snapSinglePoint({point:e,context:t,signal:i}){let{view:o}=this,{elevationInfo:r}=t,n=(0,Y.vf)(e,o,r),s=await this._fetchCandidates(n,z.n.ALL,t,i);return this._createSnapResult(n,a.MAIN,s,o,e,t,i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:o}){let{view:r}=this,{coordinateHelper:n,elevationInfo:s,spatialReference:p}=i;await (0,T.initializeProjection)(t.spatialReference,p);let l=(0,T.project)(t,p),h=(0,Y.vf)(l,r,s),d=await this._fetchCandidates(h,z.n.FEATURE,i,o);if(d.length>0){let e=await this._fetchCandidates(h,z.n.SELF,i,o);return this._createSnapResult(h,a.SCENE,[...d,...e],r,l,i,o)}let c=(0,Y.vf)(e,r,s),u=await this._fetchCandidates(c,z.n.SELF,i,o);return this._createSnapResult(c,a.MAIN,u,r,{z:n.hasZ()&&e.hasZ?e.z??0:void 0,m:n.hasM()&&e.hasM?e.m??0:void 0},i,o)}async _fetchCandidates(e,t,i,a){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,i,a)))).flat()}_createSnapResult(e,t,i,a,o,r,n){return{get valid(){return!(0,w.G4)(n)},apply:()=>{let{spatialReference:n}=r,{snappedPoint:s,hints:p}=this._processCandidates(e,t,i,r);return this._removeVisualization(),null!=r.visualizer&&this.addHandles(r.visualizer.draw(p,{spatialReference:n,elevationInfo:x.qt,view:a,selfSnappingZ:r.selfSnappingZ}),ec),(0,Y.xF)(s,a,o,r)}}}_processCandidates(e,t,i,a){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,ei.xX)(e,i);let o=this._currentMainCandidate;if(null!=o){var r,n;let s=(r=o,n=i,r instanceof er.N?ey(n,r.first)>=0&&ey(n,r.second)>=0?0:-1:ey(n,r));if(s>=0){if(!(i[s]instanceof er.N))return this._intersectWithOtherCandidates(s,i,e,t,a);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,a))return this._updateSnappingCandidate(o,t,i,a)}}return this._intersectWithOtherCandidates(0,i,e,t,a)}_intersectWithOtherCandidates(e,t,i,a,o){let{coordinateHelper:r}=o,n=t[e],s=[];for(let a=0;a<t.length;++a){if(a===e)continue;let o=t[a],p=n.constraint.intersect(o.constraint);if(p)for(let e of p.closestPoints(n.targetPoint))s.push([new er.N((0,Y.de)(e),n,o,o.isDraped),this._squaredScreenDistance(i,e,r)])}return s.length>0&&(s.sort((e,t)=>e[1]-t[1]),s[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(s[0][0],a,t,o):eu(n,o.drawConstraints)?this._updateSnappingCandidate(n,a,t,o):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(e,t,i,a){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;let o=this._currentMainCandidate.targetPoint,r=[];for(let t of(r.push(...e.hints),i)){if(e instanceof er.N){if(t.constraint.equals(e.first.constraint)||t.constraint.equals(e.second.constraint))continue}else if(t.constraint.equals(e.constraint))continue;let i=t.constraint.closestTo(o);this._squaredScreenDistance(i,o,a.coordinateHelper)<q.N.satisfiesConstraintScreenThreshold*q.N.satisfiesConstraintScreenThreshold&&(t.targetPoint=o,this._currentOtherActiveCandidates.push(t),r.push(...t.hints))}return{snappedPoint:o,hints:r}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,ei.pM)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,eh.j)(e,t.spatialReference,x.qt,this.view)}get test(){}};(0,r._)([(0,h.MZ)({constructOnly:!0})],ed.prototype,"view",void 0),(0,r._)([(0,h.MZ)()],ed.prototype,"options",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],ed.prototype,"updating",null),(0,r._)([(0,h.MZ)()],ed.prototype,"_loadTask",void 0),(0,r._)([(0,h.MZ)()],ed.prototype,"_engines",void 0),(0,r._)([(0,h.MZ)()],ed.prototype,"_squaredMouseProximityThreshold",null),(0,r._)([(0,h.MZ)()],ed.prototype,"_squaredTouchProximityThreshold",null),ed=(0,r._)([(0,c.$)("esri.views.interactive.snapping.SnappingManager")],ed),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(a||(a={}));let ec="visualization-handle";function eu(e,t){return!t||null==t.direction&&null==t.distance||!(e instanceof ea.X||e instanceof eo.z||e instanceof en.o||e instanceof es.B||e instanceof el.R)&&(!(e instanceof ep.HJ)||null==t.direction&&e.selfSnappingType===ep._b.LastVertex)}function ey(e,t){let i=-1;for(let a=0;a<e.length;++a)if(t.constraint.equals(e[a].constraint)){i=a;break}return i}var eg=i(75028),ev=i(9247),em=i(28255);let e_=class extends E.A.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,em.Xb)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){let e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};(0,r._)([(0,h.MZ)()],e_.prototype,"activeComponent",void 0),(0,r._)([(0,h.MZ)()],e_.prototype,"cancelled",void 0),(0,r._)([(0,h.MZ)()],e_.prototype,"history",void 0),(0,r._)([(0,h.MZ)()],e_.prototype,"tool",null),(0,r._)([(0,h.MZ)()],e_.prototype,"type",void 0),(0,r._)([(0,h.MZ)()],e_.prototype,"canUndo",null),(0,r._)([(0,h.MZ)()],e_.prototype,"canRedo",null),(0,r._)([(0,h.MZ)()],e_.prototype,"onEnd",void 0),(0,r._)([(0,h.MZ)()],e_.prototype,"undo",null),(0,r._)([(0,h.MZ)()],e_.prototype,"redo",null),(0,r._)([(0,h.MZ)()],e_.prototype,"toggleTool",void 0),(0,r._)([(0,h.MZ)()],e_.prototype,"addToSelection",void 0),(0,r._)([(0,h.MZ)()],e_.prototype,"removeFromSelection",void 0),e_=(0,r._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle")],e_);let ef=class extends e_{};(0,r._)([(0,h.MZ)()],ef.prototype,"activeComponent",void 0),ef=(0,r._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],ef);let eb=class extends e_{};(0,r._)([(0,h.MZ)()],eb.prototype,"activeComponent",void 0),eb=(0,r._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],eb),!function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"}(o||(o={}));let eE={defaultZ:0},ew={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"},eS=class extends E.A.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new u.U,this._internalGraphicsLayer=new y.A({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new k.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new R.A({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new A.A({color:[130,130,130,1],width:2}),this.meshSymbol=new P.A({symbolLayers:new f.A([new C.A])}),this.updateGraphics=new f.A,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new k.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new F.A,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=eE,this.defaultUpdateOptions=ew,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new Q}initialize(){this.addHandles([(0,l.on)(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),(0,l.on)(()=>this.layer?.graphics,"change",e=>{if(null!=this._operationHandle)for(let t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),(0,l.wB)(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},l.pc),(0,l.wB)(()=>this.view,e=>{this._defaultSnappingManager=(0,p.pR)(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new ed({view:e,options:this.snappingOptions})),"2d"===e.type?Promise.all([i.e(472),i.e(2617),i.e(1905),i.e(7914),i.e(7403)]).then(i.bind(i,46114)):"3d"===e.type&&(Promise.all([i.e(472),i.e(3081),i.e(420),i.e(2617),i.e(7208),i.e(1905),i.e(7914),i.e(5043),i.e(5171),i.e(8619),i.e(8801),i.e(2312)]).then(i.bind(i,72312)),Promise.all([i.e(3081),i.e(420),i.e(7208),i.e(2243),i.e(5043),i.e(8801),i.e(568)]).then(i.bind(i,44383))))},l.pc),(0,l.wB)(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),(0,ei.BY)(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=(0,p.pR)(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||null!=this.snappingManager&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return"create"===this._operationHandle?.type&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){let{activeComponent:e,destroyed:t}=this,i=!t&&e&&"tooltip"in e?e.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...eE,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...ew,...e,reshapeOptions:{...ew.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...ew.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){null!=this._defaultSnappingManager&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=(0,p.pR)(this._defaultSnappingManager)),this._override("snappingManager",e);else{let{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new ed({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){let e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){let t=this._get("view");if(t){let{container:e,map:i}=t;e&&(t.cursor=null),i?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}let i="view-ready";this.removeHandles(i),e&&this.addHandles((0,l.z7)(()=>e.ready,t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},l.pc),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=(0,p.DC)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,p.DC)(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){let{state:e,updateGraphics:t}=this;if("active"===e&&t.length){let{activeTool:e,layer:i}=this,a=t.toArray();i.removeMany(a),this.cancel(),this._emitDeleteEvent({graphics:a,tool:e})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){let e=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();let{view:i,layer:a}=this;if(!i||"disabled"===this.state)throw a||this._logMissingLayer(),(0,w.NK)();if(null!=i.activeTool&&(i.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,U.Y)(i,this._internalGraphicsLayer);let o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(null==o||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);o.on("complete",()=>{if(o===this._operationHandle){let i=this.createGraphic,r=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||null==i||a.add(i),this._sketchContinuationFlag=!1,this.emit("create",{graphic:i,state:r?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),r||this._sketchContinuationFlag)return;let{creationMode:n}=this;if("continuous"===n){if(t?.geometryToPlace)return;this._updatingHandles.addPromise((0,w.QZ)(this.create(e,t)))}else"update"===n&&i&&this._updatingHandles.addPromise((0,w.QZ)(this.update([i])))}}),this._operationHandle=o,i.ready&&i.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();let{layer:i,view:a,state:o}=this;if(!a||"disabled"===o)throw i||this._logMissingLayer(),(0,w.NK)();null!=a.activeTool&&(a.activeTool=null);let r=Array.isArray(e)?e:[e];if(null==e||!r?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):null==e.geometry&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;let n=await this._updatingHandles.addPromise(this._setupUpdateOperation(r,t));this.destroyed||null==n||ek(n)||((0,U.Y)(a,this._internalGraphicsLayer),this._setUpdateOperationHandle(n,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:n.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){let t=this.view;if(t)for(let i of e=Array.isArray(e)?e:[e])null==i.geometry||"mesh"===i.geometry.type||(0,O.aI)(i.geometry.spatialReference,t.spatialReference)||((0,T.canProjectWithoutEngine)(i.geometry.spatialReference,t.spatialReference)||(0,T.isLoaded)()||await (0,T.load)(),i.geometry=(0,T.project)(i.geometry,t.spatialReference));else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){let t=this.view;if(!t)return this._logMissingView(),null;if("2d"===t.type){let i=[];t.map.allLayers.forEach(e=>{"vector-tile"!==e.type&&"imagery"!==e.type||i.push(e)});let a=await t.hitTest(e,{exclude:i});return(0,eg.zF)(a.results)}let i=[t.map.ground];t.map.allLayers.forEach(e=>{(0,G.Eq)(e.type)&&i.push(e)});let a=await t.hitTest(e,{exclude:i});if(a.results.length>0){let e=a.results[0];if(null!=e&&"graphic"===e.type&&e.graphic&&(!a.ground.mapPoint||t.map.ground.opacity<1||a.ground.distance-(e.distance??0)>-Math.min(3*a.ground.distance,"global"===t.viewingMode?(0,S.tO)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",async e=>{let t="active"===this.state&&"create"===this._operationHandle?.type;"disabled"!==this.state&&!t&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},N.o.WIDGET)]}async _handleImmediateClick(e){let t=await e.async(()=>this._getFirstHit((0,ev.ZV)(e))),i=null;if(null!=t){let a=t.graphic;this.updateGraphics.includes(a)||a.layer===this.layer?(e.stopPropagation(),i=a):"2d"!==this.view?.type||this._isComponentGraphic(a)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();null==i||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){let i=this.view;if(!i)return this._logMissingView(),null;let a={hasZ:"3d"===i.type,...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,i,a);return null==o?null:(i.tools.add(o),i.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,i){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;let{cursor:a,defaultZ:o,hasZ:r,geometryToPlace:n,graphicProperties:s,mode:p,preserveAspectRatio:l}=i,h="freehandPolygon"===e||"freehandPolyline"===e?"freehand":p??("rectangle"===e||"circle"===e?"hybrid":"click"),d=function(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}(e),c=i?.optionsPerTool?.has(e)?i.optionsPerTool.get(e):{},u=c?.preserveAspectRatio??l??"rectangle"!==e,y={centered:"rectangle"!==e&&!("circle"===e&&!u),cursor:a,defaultZ:o,forceUniformSize:u,graphicProperties:{...s,attributes:{...s?.attributes}},geometryToPlace:n,geometryType:d,mode:h,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:r,snappingManager:this.snappingManager,snapToScene:!1,view:t,...c};return"2d"===t.type?this._makeDrawGraphicTool2D(y):this._makeDrawGraphicTool3D(y)}async _makeDrawGraphicTool2D(e){var t;let a=await this._requireModule(Promise.all([i.e(472),i.e(2617),i.e(1905),i.e(7914),i.e(7403)]).then(i.bind(i,46114)));return ek(a)||this.destroyed?null:new a.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:"polygon"===(t=e.geometryType)||"rectangle"===t||"circle"===t?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(e){let t=await this._requireModule(Promise.all([i.e(472),i.e(3081),i.e(420),i.e(2617),i.e(7208),i.e(1905),i.e(7914),i.e(5043),i.e(5171),i.e(8619),i.e(8801),i.e(2312)]).then(i.bind(i,72312)));if(ek(t)||this.destroyed)return null;let{elevationInfo:a}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:a,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(e){let t=this.view;if(!t)return this._logMissingView(),null;let i=null,a=e.forceUniformSize,o=e.centered,r=[t.on("key-down",t=>{if(t.key===Z.NE.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===Z.NE.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==Z.NE.vertexAdd||t.repeat)t.key===Z.NE.undo?(t.stopPropagation(),n.undo()):t.key===Z.NE.redo?(t.stopPropagation(),n.redo()):t.key!==Z.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===Z.NE.center&&(t.repeat||(e.centered=!o,t.stopPropagation())):(e.forceUniformSize=!a,t.stopPropagation());else{let i=e.drawOperation.geometryType;"polyline"!==i&&"polygon"!==i&&"multipoint"!==i||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}},N.o.WIDGET),t.on("key-up",t=>{t.key===Z.NE.pan?e.enabled=!0:t.key!==Z.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===Z.NE.center&&(e.centered=o,t.stopPropagation()):(e.forceUniformSize=a,t.stopPropagation())},N.o.WIDGET),e.on("vertex-add",t=>{switch(i=null==i?"start":"active",t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",e=>{this._set("createGraphic",e.graphic),i="complete",e.aborted?n&&n.cancel():n&&n.complete()}),(0,l.wB)(()=>this._getGraphicSymbolFromTool(e.geometryType),t=>{e.graphicSymbol=t})],n=new ef({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{(0,s.ei)(r),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return n}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){let{layer:i,view:a}=this;if(!a)return this._logMissingView(),null;let o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}},r=o.tool??ew.tool;for(let t of e)i.remove(t),i.add(t);if("3d"===a.type){if(0===e.length)return null;switch(r){case"move":return this._setupMove3DOperation(e,o,a,r);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,a);case"transform":return this._setupGraphicTransform3DOperation(e,o,a)}}switch(r){case"move":return this._setupMove2DOperation(e,o,a);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,r,o,a);case"transform":if(1===e.length){let t=e[0].geometry?.type;"point"!==t&&"multipoint"!==t||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,o,a)}}async _setupMove3DOperation(e,t,a,o,r=!1){let n=await this._requireModule(Promise.all([i.e(472),i.e(3081),i.e(420),i.e(2617),i.e(7208),i.e(1905),i.e(7914),i.e(5043),i.e(5171),i.e(8619),i.e(8801),i.e(2312)]).then(i.bind(i,72312)));if(ek(n))return n;let{ManipulatedObject3DGraphic:p,MoveTool3D:l}=n.module,h=new Map,d=()=>{h.forEach(e=>e.destroy()),h.clear()};for(let t of e){let e=new p({view:a,graphic:t}),i=(0,I.Y)(e);if(i!==H.d.SUPPORTED)return d(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${(0,H.c)(i)}).`),null;h.set(t,e)}let c=new l({view:a,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});a.tools.add(c),c.objects.addMany(Array.from(h.values())),r||this.updateGraphics.addMany(e);let u=[],y=new eb({activeComponent:c,tool:o,type:"update",onEnd:()=>{(0,s.ei)(u),eA(a,c),d()},undo:()=>{eP(this.view,c),eO(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{eG(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:e=>{this.updateGraphics.push(e);let t=new p({view:a,graphic:e});h.set(e,t),c.objects.push(t),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);if(y.history.undo.forEach(e=>e.updates.splice(t,1)),y.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0===this.updateGraphics.length)return void y.complete();let i=h.get(e);i&&(c.objects.remove(i),i.destroy(),h.delete(e))},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick||"transform"!==o)return;let e=this.updateGraphics.at(0),i=await this._setupReshape3DOperation(e,t,a,!0);i&&!ek(i)&&(y.onEnd(),y.destroy(),this._setUpdateOperationHandle(i,t))}});return u.push(...this._getHandlesForComponent(y,t),a.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(y,e,t),N.o.WIDGET),a.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(y,e)},N.o.WIDGET)),y}_setupGraphicTransform3DOperation(e,t,i,a=!1){if(1===e.length&&function(e){if("graphics"!==e.layer?.type)return H.d.GRAPHICS_LAYER_MISSING;if(null==e.geometry)return H.d.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return H.d.SUPPORTED;default:return H.d.GEOMETRY_TYPE_UNSUPPORTED}let t=null!=e.symbol&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return t&&t.some(e=>"object"===e.type)?"on-the-ground"!==(0,x.ky)(e)&&(0,x.NN)(e)?H.d.ELEVATION_MODE_UNSUPPORTED:H.d.SUPPORTED:H.d.SYMBOL_TYPE_UNSUPPORTED}(e[0])===H.d.SUPPORTED){let o=e[0],r=o.geometry;if(null!=r&&("point"===r.type||"mesh"===r.type))return this._setupPointTransform3DOperation(o,t,i);if(null!=r&&("polygon"===r.type||"polyline"===r.type))return this._setupPolyTransform3DOperation(o,t,i,a)}return this._setupMove3DOperation(e,t,i,"transform",a)}async _setupPointTransform3DOperation(e,t,a){let o="transform",{enableRotation:r,enableScaling:n,enableZ:p}=t,l=await this._requireModule(Promise.all([i.e(472),i.e(3081),i.e(420),i.e(2617),i.e(7208),i.e(1905),i.e(7914),i.e(5043),i.e(5171),i.e(8619),i.e(8801),i.e(2312)]).then(i.bind(i,72312)));if(ek(l))return l;let{TransformTool3D:h,ManipulatedObject3DGraphic:d}=l.module,c=new d({graphic:e,view:a}),u=new h({object:c,view:a,enableRotation:r,enableScaling:n,enableZ:p,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});a.tools.add(u),this.updateGraphics.add(e);let y=[],g=new eb({activeComponent:u,tool:o,type:"update",onEnd:()=>{(0,s.ei)(y),eA(a,u),c.destroy()},undo:()=>{eP(this.view,u),eO(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{eG(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();let i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);ek(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),g.complete()},toggleTool:()=>{}});return y.push(...this._getHandlesForComponent(g,t),a.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(g,e,t),N.o.WIDGET),a.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(g,e)},N.o.WIDGET)),g}async _setupPolyTransform3DOperation(e,t,a,o=!1){let r="transform",{enableRotation:n,enableScaling:p,enableZ:l,preserveAspectRatio:h}=t,d=await this._requireModule(Promise.all([i.e(472),i.e(3081),i.e(420),i.e(2617),i.e(7208),i.e(1905),i.e(7914),i.e(5043),i.e(5171),i.e(8619),i.e(8801),i.e(2312)]).then(i.bind(i,72312)));if(ek(d))return d;let{ManipulatedObject3DGraphic:c,ExtentTransformTool:u}=d.module,y=this.view?.inputManager?.isModifierKeyDown(Z.NE.constraint),g=new c({view:a,graphic:e}),v=new u({object:g,view:a,enableRotation:n,enableScaling:p,enableZ:l,preserveAspectRatio:!!h!=!!y,sketchOptions:this.sketchOptions});a.tools.add(v),o||this.updateGraphics.add(e);let m=[],_=new eb({activeComponent:v,tool:r,type:"update",onEnd:()=>{(0,s.ei)(m),eA(a,v),g.destroy()},canUndo:()=>!v.destroyed&&v.canUndo,undo:()=>{v.destroyed||(v.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!v.destroyed&&v.canRedo,redo:()=>{v.destroyed||(v.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),_.onEnd(),_.destroy();let i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);ek(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),_.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;let i=await this._setupReshape3DOperation(e,t,a,!0);i&&!ek(i)&&(_.onEnd(),_.destroy(),this._setUpdateOperationHandle(i,t))}});return m.push(...this._getHandlesForComponent(_,t),a.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(_,e,t),N.o.WIDGET),a.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(_,e),N.o.WIDGET),a.on("key-down",e=>{e.key!==Z.NE.constraint||e.repeat||(v.preserveAspectRatio=!v.preserveAspectRatio,e.stopPropagation())},N.o.WIDGET),a.on("key-up",e=>{e.key===Z.NE.constraint&&(v.preserveAspectRatio=!v.preserveAspectRatio,e.stopPropagation())},N.o.WIDGET)),_}async _setupMove2DOperation(e,t,i){let a="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));let o=await this._getGraphicMover(e,t,i);if(ek(o))return o;let r=new eb({activeComponent:o,tool:a,type:"update",onEnd:()=>{this._displayDefaultCursor(),(0,s.ei)(l),(0,s.ei)(p),o.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{let e=this.updateGraphics.toArray();eO(r,e),r.refreshComponent(),this._emitUndoEvent({graphics:e,tool:a})},redo:()=>{let e=this.updateGraphics.toArray();eG(r,e),r.refreshComponent(),this._emitRedoEvent({graphics:e,tool:a})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);r.history.undo.forEach(e=>e.updates.splice(t,1)),r.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);let i=this.updateGraphics.toArray();this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?o.graphics=i:r.complete()}}),n=!1,p=[i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(r,e,t),N.o.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key!==Z.NE.constraint||e.repeat||(n=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},N.o.WIDGET),i.on("key-up",e=>{e.key===Z.NE.constraint&&n&&(n=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},N.o.WIDGET)],l=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,a,o=!1){let r="reshape",n=await this._requireModule(Promise.all([i.e(472),i.e(3081),i.e(420),i.e(2617),i.e(7208),i.e(1905),i.e(7914),i.e(5043),i.e(5171),i.e(8619),i.e(8801),i.e(2312)]).then(i.bind(i,72312)));if(ek(n))return n;let{ManipulatedObject3DGraphic:p,ReshapeTool3D:l}=n.module,h=new p({view:a,graphic:e}),d=function(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return{result:H.d.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:H.d.GEOMETRY_MISSING};if((0,x.wz)(e.elevationInfo))return{result:H.d.ELEVATION_MODE_UNSUPPORTED};let t=e.operations.data.type,i=e.operations.data.geometry;return"point"===t||"mesh"===t||"polyline"===t||"polygon"===t?{result:H.d.SUPPORTED,geometry:i}:{result:H.d.GEOMETRY_TYPE_UNSUPPORTED}}(h).result;if(d!==H.d.SUPPORTED)return h.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,H.c)(d)}).`),null;let c=t.reshapeOptions,u=new l({view:a,object:h,enableZVertex:t.enableZ&&"move"===c?.vertexOperation,enableZShape:t.enableZ&&"move"===c?.shapeOperation,enableMoveObject:"move"===c?.shapeOperation||"move-xy"===c?.shapeOperation,enableMidpoints:"split"===c?.edgeOperation,enableEdgeOffset:"offset"===c?.edgeOperation,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});a.tools.add(u),o||this.updateGraphics.add(h.graphic);let y=[],g=new eb({activeComponent:u,tool:r,type:"update",onEnd:()=>{(0,s.ei)(y),eA(a,u),h.destroy()},canUndo:()=>!u.destroyed&&u.canUndo,undo:()=>{u.destroyed||(u.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!u.destroyed&&u.canRedo,redo:()=>{u.destroyed||(u.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();let i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);ek(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),g.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;g.onEnd(),g.destroy();let e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,a,!0);ek(e)||this._setUpdateOperationHandle(e,t)}});return y.push(...this._getHandlesForComponent(g,t),a.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(g,e,t),N.o.WIDGET),a.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(g,e)},N.o.WIDGET)),g}async _setupTransformOrReshape2DOperation(e,t,i,a){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));let o="transform"===t?await this._getBox(e,i,a):await this._getReshape(e,i,a);if(ek(o))return o;let r=new eb({activeComponent:o,type:"update",onEnd:()=>{(0,s.ei)(p),(0,s.ei)(n),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{eO(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{eG(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async e=>{let t=r.activeComponent;if("reshape"===t?.type){let t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();let o=await this._setupTransformOrReshape2DOperation(t,"transform",i,a);if(ek(o))return;this._setUpdateOperationHandle(o,i)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{let t=this.updateGraphics.indexOf(e);r.history.undo.forEach(e=>e.updates.splice(t,1)),r.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);let i=this.updateGraphics.toArray();if(0===i.length)r.complete();else{let e=i[0].geometry;1!==i.length||null==e||"point"!==e.type&&"multipoint"!==e.type?r.activeComponent.graphics=i:r.toggleTool()}this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;let e=this.updateGraphics.at(0),t=e.geometry;if(null!=t&&("reshape"===r.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===r.tool&&"extent"===t.type))return;let o=null;"transform"===r.tool?o=await this._getReshape([e],i,a):"reshape"===r.tool&&(o=await this._getBox([e],i,a)),ek(o)||(r.activeComponent?.destroy(),r.activeComponent=o,r.activeComponent&&((0,s.ei)(p),p=this._getHandlesForComponent(r,i)))}}),n=[a.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(r,e,i),N.o.WIDGET),a.on("key-down",e=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key===Z.NE.constraint&&!e.repeat&&r){let e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},N.o.WIDGET),a.on("key-up",e=>{if(e.key===Z.NE.constraint&&r){let e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},N.o.WIDGET)],p=this._getHandlesForComponent(r,i);return r}async _getGraphicMover(e,t,a){let{enableMoveAllGraphics:o,highlightOptions:r}=t,n=await this._requireModule(Promise.all([i.e(6041),i.e(3103)]).then(i.bind(i,76041)));return ek(n)?n:new n.module.default({enableMoveAllGraphics:o,highlightsEnabled:!!r?.enabled,indicatorsEnabled:!1,graphics:e,view:a,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:i})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:t,graphic:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:i})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,a){let{enableRotation:o,enableScaling:r,highlightOptions:n,preserveAspectRatio:s}=t,p=await this._requireModule(Promise.all([i.e(472),i.e(2617),i.e(6041),i.e(6838)]).then(i.bind(i,5728)));if(ek(p))return p;let l=this.view?.inputManager?.isModifierKeyDown(Z.NE.constraint);return new p.module.default({graphics:e,enableRotation:o,enableScaling:r,highlightsEnabled:!!n?.enabled,preserveAspectRatio:!!s!=!!l,layer:this._internalGraphicsLayer,view:a,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,a){let o="split"===t.reshapeOptions?.edgeOperation,r="move"===t.reshapeOptions?.shapeOperation,n=!!t.highlightOptions?.enabled,s=await this._requireModule(Promise.all([i.e(472),i.e(2617),i.e(1905),i.e(6041),i.e(4842)]).then(i.bind(i,12090)));return ek(s)?s:new s.module.default({enableMidpoints:o,enableMovement:r,graphic:e[0],highlightsEnabled:n,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:a,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:i,type:a})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:a},type:"update"}),onMove:({dx:e,dy:t,mover:i,type:a})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:a},type:"update"}),onMoveStop:({dx:e,dy:t,mover:i,type:a})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:a},type:"update"}),onVertexAdd:({added:e,type:t,vertices:i})=>{let a=e.map(e=>(0,M.$K)(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:a,vertices:i,type:t},type:"update"})},onVertexRemove:({removed:e,type:t,vertices:i})=>{let a=e.map(e=>(0,M.$K)(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:a,vertices:i,type:t},type:"update"})}}})}_getHandlesForComponent(e,t){let i=e.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:t,viewEvent:i})=>{i.native?.shiftKey&&(i.stopPropagation(),e.removeFromSelection(t))}),i.on("graphic-move-start",t=>e.addToHistory(eR(t.allGraphics)))];case"box":return[i.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),i.on("move-start",t=>e.addToHistory(eR(t.graphics))),i.on("rotate-start",t=>e.addToHistory(eR(t.graphics))),i.on("scale-start",t=>e.addToHistory(eR(t.graphics)))];case"reshape":return[i.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),i.on("move-start",t=>e.addToHistory(eR([t.mover]))),i.on("reshape-start",t=>e.addToHistory(eR([t.graphic]))),i.on("vertex-add",t=>e.addToHistory(eR([t.oldGraphic]))),i.on("vertex-remove",t=>e.addToHistory(eR([t.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:t})=>{e.addToHistory({updates:t})}),i.events.on("move-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:t})=>{e.addToHistory({updates:t})}),i.events.on("translate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate"},type:"update"})}),i.events.on("scale",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})}),i.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})}),i.events.on("vertex-add",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),i.events.on("vertex-remove",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),i.events.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,i){let{graphic:a,viewEvent:o}=i;return o.native?.shiftKey&&a.layer===this.layer?(o.stopPropagation(),e.removeFromSelection(a)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;let i=this.view?.map;this._disablePopup(t),e.on("complete",()=>{if(e===this._operationHandle){let a=this.updateGraphics.toArray(),o=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:a,state:"complete",aborted:e.cancelled,tool:o,toolEventInfo:null,type:"update"})}})}async _getCommonUpdateOperationClickHandlers(e,t,i){let a=(0,ev.ZV)(t),o=await t.async(()=>this._getFirstHit(a));return null==o?void e.complete():t.native.shiftKey&&this._toggleSelection([o.graphic],e,i)?void t.stopPropagation():void(this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete())}_toggleSelection(e,t,i){let a=!!i.multipleSelectionEnabled;return e.some(e=>null!=e&&!(!a||e.layer!==this.layer)&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;let i=t.key;i===Z.NE.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===Z.NE.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===Z.NE.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&Z.NE.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;let t=this.activeComponent,i=this.updateGraphics.toArray();null!=t&&("reshape"!==t.type||1===i.length&&"point"===i[0].geometry?.type)&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,p.pR)(this._internalGraphicsLayer))}_isComponentGraphic(e){let{activeComponent:t}=this;return!(!e||null==t)&&(e.attributes?.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){d.A.getLogger(this).error(new b.A(e,t,i))}async _requireModule(e){let t=new AbortController;this._moduleLoaderAbortController=t;let i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return(0,l.C_)(()=>!this.updating)}_disablePopupEnabled(e){return"3d"!==this.view?.type||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){let e=this.view;e?((0,p.DC)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await (0,w.qr)((0,l.C_)(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",eM("view"))}_logMissingLayer(){this._logError(eT,eM("layer"))}};(0,r._)([(0,h.MZ)()],eS.prototype,"_defaultSnappingManager",void 0),(0,r._)([(0,h.MZ)()],eS.prototype,"updating",null),(0,r._)([(0,h.MZ)({readOnly:!0})],eS.prototype,"_updatingHandles",void 0),(0,r._)([(0,h.MZ)()],eS.prototype,"_operationHandle",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],eS.prototype,"activeTool",null),(0,r._)([(0,h.MZ)({readOnly:!0})],eS.prototype,"activeCreateToolDrawMode",null),(0,r._)([(0,h.MZ)()],eS.prototype,"activeTooltip",null),(0,r._)([(0,h.MZ)({types:D.Es})],eS.prototype,"activeFillSymbol",void 0),(0,r._)([(0,h.MZ)()],eS.prototype,"activeLineSymbol",void 0),(0,r._)([(0,h.MZ)()],eS.prototype,"activeVertexSymbol",void 0),(0,r._)([(0,h.MZ)()],eS.prototype,"allowDeleteKey",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],eS.prototype,"createGraphic",null),(0,r._)([(0,h.MZ)()],eS.prototype,"defaultCreateOptions",null),(0,r._)([(0,h.MZ)()],eS.prototype,"defaultUpdateOptions",null),(0,r._)([(0,h.MZ)({type:L.A,nonNullable:!0})],eS.prototype,"labelOptions",null),(0,r._)([(0,h.MZ)()],eS.prototype,"layer",void 0),(0,r._)([(0,h.MZ)({types:D.Es})],eS.prototype,"pointSymbol",void 0),(0,r._)([(0,h.MZ)({types:D.Es})],eS.prototype,"polygonSymbol",void 0),(0,r._)([(0,h.MZ)({types:D.Es})],eS.prototype,"polylineSymbol",void 0),(0,r._)([(0,h.MZ)()],eS.prototype,"meshSymbol",void 0),(0,r._)([(0,h.MZ)({type:Q,nonNullable:!0})],eS.prototype,"snappingOptions",null),(0,r._)([(0,h.MZ)()],eS.prototype,"snappingManager",null),(0,r._)([(0,h.MZ)({readOnly:!0})],eS.prototype,"state",null),(0,r._)([(0,h.MZ)({type:V.A,nonNullable:!0})],eS.prototype,"tooltipOptions",null),(0,r._)([(0,h.MZ)({readOnly:!0})],eS.prototype,"updateGraphics",void 0),(0,r._)([(0,h.MZ)()],eS.prototype,"updateOnGraphicClick",void 0),(0,r._)([(0,h.MZ)()],eS.prototype,"creationMode",void 0),(0,r._)([(0,h.MZ)({type:j.A,nonNullable:!0})],eS.prototype,"valueOptions",null),(0,r._)([(0,h.MZ)({types:D.Es})],eS.prototype,"vertexSymbol",void 0),(0,r._)([(0,h.MZ)({value:null})],eS.prototype,"view",null),(0,r._)([(0,h.MZ)({constructOnly:!0,type:F.A})],eS.prototype,"sketchOptions",void 0);let eT="sketch:missing-property",eM=e=>`Property '${e}' is missing on SketchViewModel.`;function eO(e,t){eC("undo",e.history.undo,e.history.redo,t)}function eG(e,t){eC("redo",e.history.redo,e.history.undo,t)}function eC(e,t,i,a){let o=t.pop();if(!o)return;let r=o.updates,n=[];a.forEach((t,i)=>{let a=r[i];null!=a&&("geometry"in a&&null!=a.geometry&&(n.push({geometry:t.geometry}),t.geometry=a.geometry),"symbol"in a&&null!=a.symbol&&(n.push({symbol:t.symbol}),t.symbol=a.symbol),"undo"in a&&(n.push(a),a[e](t)))}),i.push({updates:n})}function eP(e,t){null!=e&&t.hasGrabbedManipulators&&(e.activeTool=null)}function eR(e){return{updates:e.map(({geometry:e})=>"mesh"===e?.type?{geometry:e.cloneShallow()}:{geometry:e})}}function eA(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function ek(e){return"requireError"in e&&"aborted"===e.requireError}let eD=eS=(0,r._)([(0,c.$)("esri.widgets.Sketch.SketchViewModel")],eS);function eH(e,t){e.networkFeature=t}function eI(e){return e.networkFeature}let ex=class extends n.A{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new y.A({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new u.U,this.enabled=!0,this._handleSketchViewModelEvents=async e=>{switch(e.type){case"update":switch(e.state){case"active":case"complete":for(let t of e.graphics)eI(t).geometry=!function(e){return"point"===e?.type||"polyline"===e?.type||"polygon"===e?.type}(t.geometry)?null:t.geometry.clone()}break;case"undo":case"redo":break;case"delete":for(let t of e.graphics){let e=eI(t);this._removeNetworkFeature(e)}break;case"create":if(e.graphic&&"complete"===e.state&&this._createMode){let t=e.graphic.geometry?.clone(),i=e.graphic.symbol?.clone();if(!t)break;switch(this._createMode){case"stop":{if("point"!==t.type)break;let{stops:i}=this.layer;if(i.length>0&&i.every(({geometry:e})=>!e)){i.at(0).geometry=t;break}if(i.length>1&&i.filter((e,t)=>0!==t).every(({geometry:e})=>!e)){i.at(1).geometry=t;break}let a=new _.A({geometry:t});i.add(a),eH(e.graphic,a);break}case"point-barrier":{if("point"!==t.type)break;let a=new g.A({geometry:t,symbol:i});this.layer.pointBarriers.add(a),eH(e.graphic,a);break}case"polyline-barrier":{if("polyline"!==t.type)break;let a=new m.A({geometry:t,symbol:i});this.layer.polylineBarriers.add(a),eH(e.graphic,a);break}case"polygon-barrier":{if("polygon"!==t.type)break;let a=new v.A({geometry:t,symbol:i});this.layer.polygonBarriers.add(a),eH(e.graphic,a)}}}}(await this.view.whenLayerView(this.layer)).emit(e.type,"create"===e.type?function(e){let t=eI(e.graphic);return{...e,networkFeature:t}}(e):function(e){let t=e.graphics.map(e=>eI(e));return{...e,networkFeatures:t}}(e))}}initialize(){this._sketchViewModel=new eD({layer:this._graphicsLayer,view:this.view}),this.addHandles([(0,l.wB)(()=>this.enabled,e=>{e?this._activate():this._deactivate()},l.Vh),(0,l.wB)(()=>{let{stops:e,pointBarriers:t,polylineBarriers:i,polygonBarriers:a}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:i,polygonBarriers:a}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),(0,s.DQ)(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,p.pR)(this._graphicsLayer),this._sketchViewModel=(0,p.pR)(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>eI(e))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case"stop":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){let t=this._graphicsLayer.graphics.find(t=>eI(t)===e);t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){let e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(e=>e.toArray().map(e=>{let t=e.toGraphic();return t.networkFeature=e,t}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};(0,r._)([(0,h.MZ)()],ex.prototype,"enabled",void 0),(0,r._)([(0,h.MZ)({constructOnly:!0})],ex.prototype,"layer",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],ex.prototype,"selectedNetworkFeatures",null),(0,r._)([(0,h.MZ)()],ex.prototype,"updating",null),(0,r._)([(0,h.MZ)({constructOnly:!0})],ex.prototype,"view",void 0),ex=(0,r._)([(0,c.$)("esri.views.2d.layers.support.RouteLayerInteraction")],ex)},33359:(e,t,i)=>{i.d(t,{X:()=>s});var a=i(55048);i(54036);var o=i(63599),r=i(56911),n=i(26585);function s(e,t,i,a,l=(0,r.vt)()){let h=(0,o.c)(p,e);return h[2]=(0,n.xS)(a,h,t,i)||0,a.renderCoordsHelper.toRenderCoords(h,t,l),l}let p=(0,r.vt)();(0,a.QG)(),(0,a.QG)()},39443:(e,t,i)=>{i.d(t,{HJ:()=>h,_b:()=>o,pn:()=>a});var a,o,r=i(18836),n=i(3489),s=i(24056),p=i(13880),l=i(82587);class h extends s.C{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:a,otherVertexType:n,isDraped:s,selfSnappingType:p,objectId:l,domain:h}){super(e,t,s,h??r.n.SELF),this.previousVertex=i,this.otherVertex=a,this.otherVertexType=n,this.selfSnappingType=p??o.None,this.objectId=l??null}get hints(){let e=this.previousVertex,t=this.otherVertexType===a.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===a.CENTER?this.targetPoint:this.otherVertex;return[new p.c(n.H3.TARGET,t,i,this.isDraped,this.domain),new p.c(n.H3.REFERENCE,e,t,this.isDraped,this.domain),new l.l(this.previousVertex,t,i,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(a||(a={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(o||(o={}))},41723:(e,t,i)=>{i.d(t,{B:()=>c});var a=i(63599),o=i(56911),r=i(64088),n=i(73541),s=i(18836),p=i(3489),l=i(24056),h=i(13880),d=i(29949);class c extends l.C{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:p}){let l=(0,o.o8)(t),{left:h,right:d}=e;(0,a.d)(l,(0,a.g)(l,l,d),h),super(i,new r.WG(t,(0,n._7)(l)),p,s.n.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new h.c(p.H3.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new d.r(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new h.c(p.H3.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){let t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{(0,a.p)(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),(0,a.p)(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),(0,a.p)(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),(0,a.p)(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}}},50547:(e,t,i)=>{i.d(t,{N:()=>s});var a=i(64088),o=i(18836),r=i(24056),n=i(74531);class s extends r.C{constructor(e,t,i,r){super(e,new a.i7(e),r,o.n.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new n.v(this.targetPoint,this.isDraped,this.domain)]}}},58562:(e,t,i)=>{i.d(t,{o:()=>p});var a=i(64088),o=i(18836),r=i(3489),n=i(24056),s=i(13880);class p extends n.C{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:n}){super(i,new a.WG(e,t),n,o.n.SELF),this._referenceLineHint=new s.c(r.H3.REFERENCE_EXTENSION,e,t,n,this.domain)}get hints(){return[this._referenceLineHint,new s.c(r.H3.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}},63667:(e,t,i)=>{function a(e,t,i){if(!t||!e?.map)return;let{map:a}=e,o=a.layers.find(e=>e===t);o||a.add(t,i),o&&null!=i&&a.layers.reorder(o,i)}function o(e,t){let i="subtype-sublayer"===t?.type?t.parent:t;return e.allLayerViews.find(e=>{let t=e.layer;return t===i||"sublayers"in t&&null!=t.sublayers&&t.sublayers.includes(i)})}i.d(t,{Y:()=>a,i:()=>o})},72735:(e,t,i)=>{var a;function o(e){switch(e){case a.SUPPORTED:break;case a.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case a.GEOMETRY_MISSING:return"no geometry";case a.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case a.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case a.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}i.d(t,{c:()=>o,d:()=>a}),i(57845),function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"}(a||(a={}))},86410:(e,t,i)=>{i.d(t,{Y:()=>r}),i(57845);var a=i(26585),o=i(72735);function r(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return o.d.GRAPHICS_LAYER_MISSING;let t=e.operations?.data.type;if(!t)return o.d.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return o.d.GEOMETRY_TYPE_UNSUPPORTED}let i=e.elevationInfo;return(0,a.wz)(i)?o.d.ELEVATION_MODE_UNSUPPORTED:o.d.SUPPORTED}},87255:(e,t,i)=>{i.d(t,{z:()=>s});var a=i(64088),o=i(3489),r=i(99392),n=i(13880);class s extends r.w{constructor(e){super({...e,constraint:new a.Mn(e.edgeStart,e.edgeEnd)})}get hints(){return[new n.c(o.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},94799:(e,t,i)=>{i.d(t,{j:()=>s});var a=i(55048),o=i(56911),r=i(40838),n=i(33359);function s(e,t,i,o){return"2d"===o.type?(p.x=e[0],p.y=e[1],p.spatialReference=t,o.toScreen(p)):((0,n.X)(e,t,i,o,l),o.state.camera.projectToScreen(l,h),(0,a.tc)(h[0],h[1]))}let p=(0,r.T)(0,0,0,null),l=(0,o.vt)(),h=(0,a.gs)()},99392:(e,t,i)=>{i.d(t,{w:()=>r});var a=i(18836),o=i(24056);class r extends o.C{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:o}){super(e,i,o,a.n.FEATURE),this.objectId=t}}}}]);