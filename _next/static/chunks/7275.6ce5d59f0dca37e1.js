"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7275],{7275:(e,t,r)=>{r.r(t),r.d(t,{applyTextFormattingHTML:()=>P,createFieldInfoMap:()=>Y,findRelatedLayer:()=>ea,findUtilityNetwork:()=>eo,fixTokens:()=>k,formatAttributes:()=>K,formatEditInfo:()=>J,formatValueToFieldInfo:()=>z,getAllFieldInfos:()=>_,getFieldInfo:()=>G,getFieldInfoLabel:()=>E,getFixedFieldName:()=>q,getFixedFieldNames:()=>x,getHighlightKeyForFeature:()=>ef,getSourceLayer:()=>L,graphicCallback:()=>Z,htmlEntities:()=>Q,isAssociatedFeatureSupportedLayer:()=>D,isExpressionField:()=>C,isFeatureSupportedLayer:()=>R,isGraphicForRelatableFeatureSupportedLayer:()=>O,isRelatableFeatureSupportedLayer:()=>j,isRelatableLayer:()=>S,isRelatedField:()=>ee,preLayerQueryCallback:()=>ei,preRequestCallback:()=>el,querySourceLayer:()=>B,queryUpdatedFeature:()=>X,shouldOpenInNewTab:()=>v,substituteAttributes:()=>M,substituteFieldsInLinksAndAttributes:()=>U});var n=r(57845),i=r(61939),l=r(45714),a=r(59983),o=r(71538),u=r(39265),s=r(71086),f=r(32274),d=r(20703),p=r(90628);let y=()=>i.A.getLogger("esri.widgets.Feature.support.featureUtils"),c=/href=(""|'')/gi,m=/(\{([^{\r\n]+)\})/g,g=/'/g,b=/^\s*expression\//i,h=/(\n)/gi,I=/[\u00A0-\u9999<>&]/gim,F=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,T=/^(?:mailto:|tel:)/,w="relationships/",N=(0,a.J2)("short-date-short-time");function L(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function Z({type:e,value:t,event:r}){try{return"function"==typeof t?t(r):await t}catch(n){return void y().error("error",`An error occurred when calling the "${e}" function`,{error:n,graphic:r.graphic,value:t})}}function v(e=""){if(e)return!T.test(e.trim().toLowerCase())}function C(e){return!!e&&b.test(e)}function E(e,t){let r=function(e,t){if(!t||!C(t)||!e)return;let r=t.replace(b,"").toLowerCase();return e.find(({name:e})=>e.toLowerCase()===r)}(t,e?.fieldName);return r?r.title||null:e?e.label||e.fieldName:null}function q(e,t){let r=$(t,e);return r?r.name:e}function x(e,t){return e&&e.map(e=>q(e,t))}function $(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function A(e){return`${e}`.trim()}function U({attributes:e,globalAttributes:t,layer:r,text:n,expressionAttributes:i,fieldInfoMap:a}){return n?M({formattedAttributes:t,template:function(e,t,r){let n=k(e,r);return n?n.replaceAll(F,(e,r,n)=>(function(e,t,r){let n=(t=A(t))&&"{"!==t[0];return(0,l.HC)(e,function(e,t=!1){let r={...e};return Object.keys(r).forEach(e=>(function(e,t,r=!1){let n=t[e];if("string"==typeof n){let i=(r?encodeURIComponent(n):n).replaceAll(g,"%27");t[e]=i}})(e,r,t)),r}(r,n||!1))})(e,r||n,t)):n}(n,{...t,...i,...e},r),fieldInfoMap:a}):""}function M({formattedAttributes:e,template:t,fieldInfoMap:r}){return A((0,l.HC)((0,l.HC)(t,e=>(function(e,t){let r=t.get(e.toLowerCase());return`{${r?.fieldName||e}}`})(e,r)),e).replaceAll(c,""))}function k(e,t){return e.replaceAll(m,(e,r,n)=>{let i=$(t,n);return i?`{${i.name}}`:r})}function R(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function S(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function j(e){return R(e)&&S(e)}function D(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function O(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&j(e.sourceLayer)}function z(e,t){var r,n;let{fieldInfos:i,fieldName:l,preventPlacesFormatting:a,layer:s,timeZone:d}=t,p=G(i,l),y=$(s,l);if(p&&!(0,u.JL)(l)){let t=y?.type,r=p.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||r)return(0,f.i0)(e,{format:r,fieldType:t,timeZoneOptions:{layerTimeZone:s&&"preferredTimeZone"in s?s.preferredTimeZone:null,viewTimeZone:d,datesInUnknownTimezone:!(!s||!("datesInUnknownTimezone"in s))&&!!s.datesInUnknownTimezone}})}let c=p?.format;return"string"==typeof e&&(0,u.JL)(l)&&c?(r=e,n=c,r=r.trim(),/\d{2}-\d{2}/.test(r)?r:r.includes(",")?H(r,",",", ",n):r.includes(";")?H(r,";","; ",n):r.includes(" ")?H(r," "," ",n):(0,o.ZV)(Number(r),(0,o.yx)(n))):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){let t=Number(e);if(!isNaN(t))return t}return e}(e,c))||null==e||null==c?P(e):(0,o.ZV)(e,a?{...(0,o.yx)(c),minimumFractionDigits:0,maximumFractionDigits:20}:(0,o.yx)(c))}function H(e,t,r,n){return e.trim().split(t).map(e=>(0,o.ZV)(Number(e),(0,o.yx)(n))).join(r)}function G(e,t){if(e?.length&&t)return e.find(e=>e.fieldName?.toLowerCase()===t.toLowerCase())}function J(e,t,r,n){let{creatorField:i,creationDateField:l,editorField:o,editDateField:u}=e;if(!t)return;let s=(0,p.hv)(n&&"preferredTimeZone"in n?n.preferredTimeZone:null,!(!n||!("datesInUnknownTimezone"in n))&&!!n.datesInUnknownTimezone,r,N,"date"),f={...N,...s},d=t[u];if("number"==typeof d){let e=t[o];return{type:"edit",date:(0,a.Yq)(d,f),user:e}}let y=t[l];if("number"==typeof y){let e=t[i];return{type:"create",date:(0,a.Yq)(y,f),user:e}}return null}function Y(e,t){let r=new Map;if(!e)return r;for(let n of e){if(!n.fieldName)continue;let e=q(n.fieldName,t);n.fieldName=e,r.set(e.toLowerCase(),n)}return r}function _(e){let t=[];if(!e)return t;let{fieldInfos:r,content:n}=e;return r&&t.push(...r),n&&Array.isArray(n)&&n.forEach(e=>{if("fields"===e.type){let r=e?.fieldInfos;r&&t.push(...r)}}),t}function Q(e){return e.replaceAll(I,e=>`&#${e.charCodeAt(0)};`)}function P(e){return"string"==typeof e?e.replaceAll(h,'<br class="esri-text-new-line" />'):e}function V(e){let{value:t,fieldName:r,fieldInfos:i,fieldInfoMap:l,layer:a,graphic:o,timeZone:s}=e;if(null==t)return"";let d=function({fieldName:e,value:t,graphic:r,layer:i}){if(ee(e)||!i||"function"!=typeof i.getFieldDomain)return null;let l=r&&i.getFieldDomain(e,{feature:r,excludeImpliedDomains:(0,n.A)("esri-widget-legacy-field-domain-calculation")});return l&&"coded-value"===l.type?l.getName(t):null}({fieldName:r,value:t,graphic:o,layer:a});if(d)return d;let p=function({fieldName:e,graphic:t,layer:r}){if(ee(e)||!r||"function"!=typeof r.getFeatureType)return null;let{typeIdField:n}=r;if(!n||e!==n)return null;let i=r.getFeatureType(t);return i?i.name:null}({fieldName:r,graphic:o,layer:a});if(p)return p;if(l.get(r.toLowerCase()))return z(t,{fieldInfos:i||Array.from(l.values()),fieldName:r,layer:a,timeZone:s});let y=a?.fieldsIndex?.get(r);return y&&((0,f.fs)(y)||(0,u.OH)(y))?(0,f.i0)(t,{fieldType:y.type,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:s,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}}):P(t)}function K({fieldInfos:e,attributes:t,layer:r,graphic:n,fieldInfoMap:i,relatedInfos:l,timeZone:a}){let o={};return l?.forEach(t=>(function({attributes:e,relatedInfo:t,fieldInfoMap:r,fieldInfos:n,layer:i,timeZone:l}){e&&t&&(t.relatedFeatures?.forEach(a=>et({attributes:e,graphic:a,relatedInfo:t,fieldInfoMap:r,fieldInfos:n,layer:i,timeZone:l})),t.relatedStatsFeatures?.forEach(a=>et({attributes:e,graphic:a,relatedInfo:t,fieldInfoMap:r,fieldInfos:n,layer:i,timeZone:l})))})({attributes:o,relatedInfo:t,fieldInfoMap:i,fieldInfos:e,layer:r,timeZone:a})),t&&Object.keys(t).forEach(l=>{let u=t[l];o[l]=V({fieldName:l,fieldInfos:e,fieldInfoMap:i,layer:r,value:u,graphic:n,timeZone:a})}),o}async function B(e,t){let{layer:r,graphic:n,outFields:i,objectIds:l,returnGeometry:a,spatialReference:o}=e,u=l[0];if("number"!=typeof u&&"string"!=typeof u)return y().warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:r,graphic:n,objectId:u,requiredFields:i}),null;if(!(0,s.BR)(r)?.operations?.supportsQuery)return y().warn("The specified layer cannot be queried. The following fields will not be available.",{layer:r,graphic:n,requiredFields:i,returnGeometry:a}),null;let f=r.createQuery();return f.objectIds=l,f.outFields=i?.length?i:[r.objectIdField],f.returnGeometry=!!a,f.returnZ=!!a,f.returnM=!!a,f.outSpatialReference=o,(await r.queryFeatures(f,t)).features[0]}async function W(e){if(!e.expressionInfos?.length)return!1;let{arcadeUtils:{hasGeometryFunctions:t}}=await (0,d.lw)();return t(e)}async function X({graphic:e,popupTemplate:t,layer:r,spatialReference:n},i){if(!r||!t||("function"==typeof r.load&&await r.load(i),!e.attributes))return;let l=r.objectIdField,a=e.attributes[l];if(null==a)return;let o=await t.getRequiredFields(r.fieldsIndex),s=(0,u.Kl)(o,e),f=s?[]:o.includes(l)?o:[...o,l],d=t.returnGeometry||await W(t);if(s&&!d)return;let p=await B({layer:r,graphic:e,outFields:f,objectIds:[a],returnGeometry:d,spatialReference:n},i);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes={...e.attributes,...p.attributes}))}function ee(e=""){return!!e&&e.includes(w)}function et({attributes:e,graphic:t,relatedInfo:r,fieldInfos:n,fieldInfoMap:i,layer:l,timeZone:a}){e&&t&&r&&Object.keys(t.attributes).forEach(o=>{var u;let s=(u={layerId:r.relation.id.toString(),fieldName:o},`${w}${u.layerId}/${u.fieldName}`),f=t.attributes[o];e[s]=V({fieldName:s,fieldInfos:n,fieldInfoMap:i,layer:l,value:f,graphic:t,timeZone:a})})}let er=e=>{if(!e)return!1;let t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},en=({layer:e,method:t,query:r,definitionExpression:n})=>{if(!e.capabilities?.query?.supportsCacheHint||"attachments"===t)return;let i=null!=r.where?r.where:null,l=null!=r.geometry?r.geometry:null;er(n)||er(i)||"extent"===l?.type||"tile"===r.resultType||(r.cacheHint=!0)},ei=({query:e,layer:t,method:r})=>{en({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},el=({queryPayload:e,layer:t,method:r})=>{en({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})};function ea(e,t,r){return e&&t&&r?"sublayer"===t.type?es({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:r})||es({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:r}):es({layers:e.allLayers,map:e,relatedLayer:t,relationship:r})||es({layers:e.allTables,map:e,relatedLayer:t,relationship:r}):null}function eo(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find(e=>e.isUtilityLayer(t)):null}function eu(e,t){return e?.allTables.find(e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url)}function es({map:e,relationship:t,relationship:{relatedTableId:r},relatedLayer:n,layers:i}){if(!i)return null;for(let l of i){if("map-image"===l.type){let r=es({layers:l.sublayers,map:e,relatedLayer:n,relationship:t})||es({layers:l.subtables,map:e,relatedLayer:n,relationship:t});if(r)return r;continue}if(!j(l))continue;if("sublayer"===n.type){if(l!==n&&l.id===r)return l.isTable?eu(e,l):l;continue}let i="scene"===n.type&&n.associatedLayer?n.associatedLayer.url:n.url;if(!i)break;if("sublayer"!==l.type){if(l!==n&&l.url===i&&l.layerId===r)return l}else if(l!==n&&l.layer?.url===i&&l.id===r)return l.isTable?eu(e,l):l}return null}function ef(e){let t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}},32274:(e,t,r)=>{r.d(t,{EG:()=>y,Ll:()=>I,R3:()=>h,UH:()=>u,aM:()=>g,fs:()=>p,i0:()=>F});var n=r(59983),i=r(39265),l=r(20703);r(12723);var a=r(93682),o=r(90628);let u=",",s={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},f=new Set(["integer","small-integer"]),d=null;function p(e){return(0,i.vE)(e)||(0,i.zD)(e)||(0,i.Ah)(e)}async function y(e){let{field:t,field2:r,field3:n,normalizationField:i,valueExpression:a}=e,o=[];if(a){if(!d){let{arcadeUtils:e}=await (0,l.lw)();d=e}o=d.extractFieldNames(a)}return t&&o.push(t),r&&o.push(r),n&&o.push(n),i&&o.push(i),o}function c(e){return String(e).padStart(2,"0")}function m(e,t,r){let n;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),n=`TIMESTAMP'${r?e.getFullYear():e.getUTCFullYear()}-${c((r?e.getMonth():e.getUTCMonth())+1)}-${c(r?e.getDate():e.getUTCDate())} ${c(r?e.getHours():e.getUTCHours())}:${c(r?e.getMinutes():e.getUTCMinutes())}:${c(r?e.getSeconds():e.getUTCSeconds())}'`):n=e,n}function g(e,t,r,n){let{hasQueryEngine:i}=e,l=`(${m(r,b(e,r),i)} - ${m(t,b(e,t),i)})`,a=s[n],o="/";return a<1&&(a=1/a,o="*"),{sqlExpression:1===a?l:`(${l} ${o} ${a})`,sqlWhere:null}}function b(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){let r=e.getField(t);if("<now>"===t.toLowerCase())return;if((0,i.vE)(r))return"field"}}function h(e,t){let r=t&&e.getField(t);return!!r&&f.has(r.type)}function I(e){return`cast(${e} as float)`}function F(e,t){let r,i,{format:l,timeZoneOptions:u,fieldType:s}=t??{};if(u&&({timeZone:r,timeZoneName:i}=(0,o.hv)(u.layerTimeZone,u.datesInUnknownTimezone,u.viewTimeZone,(0,n.J2)(l||"short-date-short-time"),s)),"string"==typeof e&&isNaN(Date.parse("time-only"===s?`1970-01-01T${e}Z`:e)))return e;switch(s){case"date-only":{let t=(0,n.J2)(l||"short-date");return"string"==typeof e?(0,n.iS)(e,{...t}):(0,n.Yq)(e,{...t,timeZone:a.n$})}case"time-only":{let t=(0,n.J2)(l||"short-time");return"string"==typeof e?(0,n.F8)(e,t):(0,n.Yq)(e,{...t,timeZone:a.n$})}case"timestamp-offset":{if(!r&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;let t=l||u?(0,n.J2)(l||"short-date-short-time"):void 0,a=t?{...t,timeZone:r,timeZoneName:i}:void 0;return"string"==typeof e?(0,n.Ey)(e,a):(0,n.Yq)(e,a)}default:{let t=l||u?(0,n.J2)(l||"short-date-short-time"):void 0;return(0,n.Yq)("string"==typeof e?new Date(e):e,t?{...t,timeZone:r,timeZoneName:i}:void 0)}}}}}]);