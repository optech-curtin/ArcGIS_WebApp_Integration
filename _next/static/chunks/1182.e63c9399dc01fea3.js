"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1182],{18402:(e,t,r)=>{r.d(t,{$Q:()=>a,Sd:()=>l,b7:()=>u});var n=r(8922),s=r(61414),i=r(39960),o=r(93409);async function a(e,t,n){if("extent"===n.type)return function(e,t,r){let{width:n,height:s}=e,i=new Uint8Array(n*s),a=t.width/n,l=t.height/s;if(r.width/a<.5||r.height/l<.5)return new o.A({pixelType:e.pixelType,width:n,height:s,mask:i,pixels:[...e.pixels]});let{xmin:u,xmax:p,ymin:c,ymax:h}=t,{xmin:m,xmax:f,ymin:d,ymax:g}=r,y=Math.max(u,m),x=Math.min(p,f),w=Math.max(c,d),A=Math.min(h,g),b=.5*a,_=.5*l;if(x-y<b||A-w<_||x<u+b||y>p-b||w>h-_||A<c+_)return new o.A({pixelType:e.pixelType,width:n,height:s,mask:i,pixels:[...e.pixels]});let v=Math.max(0,(y-u)/a),M=Math.min(n,Math.max(0,(x-u)/a)),P=Math.max(0,(h-A)/l),T=Math.min(s,Math.max(0,(h-w)/l)),R=Math.round(v),N=Math.round(M)-1,F=Math.round(P),k=Math.round(T)-1;if(R===N&&v%1>.5&&M%1<.5||F===k&&P%1>.5&&T%1<.5)return new o.A({pixelType:e.pixelType,width:n,height:s,mask:i,pixels:[...e.pixels]});if(0===R&&0===F&&N===n&&k===s)return e;let S=e.mask;for(let e=F;e<=k;e++)for(let t=R;t<=N;t++){let r=e*n+t;i[r]=S?S[r]:255}return new o.A({pixelType:e.pixelType,width:n,height:s,mask:i,pixels:[...e.pixels]})}(e,t,n);let{width:s,height:i}=e,a=new Uint8Array(s*i),{contains:l,intersects:u}=await Promise.all([r.e(472),r.e(8255)]).then(r.bind(r,40636));return u(t,n)?"polyline"===n.type?function(e,t,r){let{width:n,height:s}=e,i=new Uint8Array(n*s),a=t.width/n,l=t.height/s,{xmin:u,ymax:p}=t,{paths:c}=r,h=e.mask;for(let e=0;e<c.length;e++){let t=c[e];for(let e=0;e<t.length-1;e++){let[r,o]=t[e],[c,m]=t[e+1],f=Math.floor((p-o)/l),d=Math.floor((p-m)/l);if(d<f){let e=f;f=d,d=e}f=Math.max(0,f),d=Math.min(s-1,d);let g=(c-r)/(m-o);for(let e=f;e<=d;e++){let t=e===f?Math.max(o,m):(s+1-e)*l,p=e===d?Math.min(o,m):t-l,y=m===o?Math.floor((r-u)/a):Math.floor((g*(t-o)+r-u)/a),x=m===o?Math.floor((c-u)/a):Math.floor((g*(p-o)+r-u)/a);if(x<y){let e=y;y=x,x=e}let w=e*n;y=Math.max(0,y),x=Math.min(n-1,x);for(let e=w+y;e<=w+x;e++)i[e]=h?h[e]:255}}}return new o.A({pixelType:e.pixelType,width:n,height:s,mask:i,pixels:[...e.pixels]})}(e,t,n):l(n,t)?e:function(e,t,r){let n;if(!e)return e;let{width:s,height:i}=e,a=t.width/s,l=t.height/i,{xmin:u,ymax:p}=t;if("extent"===r.type){let e=(r.xmin-u)/a,t=(r.xmax-u)/a,s=(p-r.ymax)/l,i=(p-r.ymin)/l;n=[[[e,s],[e,i],[t,i],[t,s],[e,s]]]}else n=r.rings.map(e=>e.map(([e,t])=>[(e-u)/a,(p-t)/l]));let c=document.createElement("canvas");c.width=s,c.height=i;let h=c.getContext("2d");h.fillStyle="#f00",h.beginPath(),n.forEach(e=>{h.moveTo(e[0][0],e[0][1]);for(let t=0;t<e.length;t++)h.lineTo(e[t][0],e[t][1]);h.closePath()}),h.fill();let m=h.getImageData(0,0,s,i).data,f=e.mask,d=s*i,g=new Uint8Array(d);for(let e=0;e<d;e++)f&&!f[e]||(g[e]=255*(m[4*e+3]>127));return new o.A({pixelType:e.pixelType,width:s,height:i,mask:g,maskIsAlpha:!1,pixels:[...e.pixels]})}(e,t,n):new o.A({pixelType:e.pixelType,width:s,height:i,mask:a,maskIsAlpha:!1,pixels:[...e.pixels]})}function l(e,t){let{extent:r}=u(e,t,new i.A({x:e.pixelSize.x,y:e.pixelSize.y,spatialReference:e.spatialReference})),{extent:n}=e.extent;if(r.xmax=Math.min(r.xmax,n.xmax),r.ymax=Math.min(r.ymax,n.ymax),r.xmin<r.xmax&&r.ymin<r.ymax){let{x:t,y:n}=e.pixelSize,s=Math.round(r.width/t),i=Math.round(r.height/n);e.extent=r,e.width=s,e.height=i}}function u(e,t,r,i=!0){let o,a,l,{spatialReference:p}=e,{x:c,y:h}=function(e,t){if(e.spatialReference.equals(t))return e;let r=(0,n.GA)(e.spatialReference),s=(0,n.GA)(t);if(r===s)return e;let i=r/s;return{x:e.x*i,y:e.y*i}}(r,p),{xmin:m,xmax:f,ymax:d,ymin:g}="extent"===t.type?t:t.extent,{xmin:y,ymax:x}=e.extent;return i?(m=y+(m>y?c*Math.round((m-y)/c):0),d=x-(d<x?h*Math.round((x-d)/h):0),f=y+(f>y?c*Math.round((f-y)/c):0),g=x-(g<x?h*Math.round((x-g)/h):0),a=Math.round((o=new s.A({xmin:m,ymax:d,xmax:f,ymin:g,spatialReference:p})).width/c),l=Math.round(o.height/h)):(a=Math.floor((f-m)/c+.8),l=Math.floor((d-g)/h+.8),m=y+(m>y?c*Math.floor((m-y)/c+.1):0),d=x-(d<x?h*Math.floor((x-d)/h+.1):0),f=m+a*c,g=d-l*h,o=new s.A({xmin:m,ymax:d,xmax:f,ymin:g,spatialReference:p})),{extent:o,width:a,height:l}}},18801:(e,t,r)=>{r.d(t,{vt:()=>r2,UD:()=>function e(t,r){let{rasterFunctionArguments:n}=t;n&&(n.rasters||[n.raster,n.raster2]).forEach(t=>{t&&"number"!=typeof t&&("string"==typeof t?t.startsWith("http")&&(r.includes(t)||r.push(t)):"rasterFunctionArguments"in t&&e(t,r))})}});var n,s,i,o,a,l,u,p,c,h,m,f,d,g,y,x,w,A,b,_,v,M,P,T,R=r(64763),N=r(32391),F=r(33715),k=r(81856),S=r(91838);r(57845),r(61939),r(33638);var I=r(12709),C=r(50518),j=r(92713);let B=class extends j.A{constructor(){super(...arguments),this.raster=void 0}};(0,k._)([(0,S.MZ)({json:{write:!0}})],B.prototype,"raster",void 0);let G=B=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.BaseFunctionArguments")],B),Z=n=class extends G{constructor(){super(...arguments),this.raster2=void 0}get rasters(){return[this.raster,this.raster2]}clone(){return new n({raster:this.raster,raster2:this.raster2,operation:this.operation})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],Z.prototype,"operation",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],Z.prototype,"raster2",void 0),(0,k._)([(0,S.MZ)({readOnly:!0})],Z.prototype,"rasters",null);let z=Z=n=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ArithmeticFunctionArguments")],Z);var E=r(16352),O=r(93409),D=r(65018);let U=new Set(["slope","aspect","curvature","hillshade","shadedrelief","statistics"]),L=class extends j.A{constructor(){super(...arguments),this.functionArguments=null,this.readingBufferSize=0,this.id=-1,this.isNoopProcess=!1,this.rawInputBandIds=[],this.rawSourceRasterInfos=null,this.isInputBandIdsSwizzled=!1,this.swizzledBandSelection=[],this.isBranch=!1,this._bindingResult=null}get supportsGPU(){return this._bindingResult.supportsGPU}get flatWebGLFunctionChain(){let e=this.getWebGLProcessorDefinition();if(!e)return null;let t=[e],{parameters:r}=e,n=r.rasters||r.raster&&[r.raster];for(;n?.length;){t.unshift(...n);let e=[];for(let t=0;t<n.length;t++){let{parameters:r}=n[t],s=r.rasters||r.raster&&[r.raster];s?.length&&e.push(...s)}n=e}for(let e=t.length-1;e>=0;e--)t[e].isNoopProcess&&t.splice(e,1);let s=!1;for(let e=0;e<t.length;e++){let r=t[e];r.id=t.length-e-1;let{rasters:n}=r.parameters;s=s||null!=n&&n.length>1}let i=t.some(({name:e})=>U.has(e.toLowerCase())),{rawSourceRasterInfos:o}=this;return{functions:t,hasBranches:s,hasFocalFunction:i,isSourceSingleBand:1===o?.[0]?.bandCount}}bind(e,t=!1,r=-1){this.id=r+1;let n=this._getRasterValues(),s=!0;for(let r=0;r<n.length;r++){let i=n[r];if(null!=i&&this._isRasterFunctionValue(i)){let n=i.bind(e,t,this.id+r);if(!n.success)return this._bindingResult=n,n;s=s&&n.supportsGPU}}return!this.rasterInfo||t?(this.sourceRasterInfos=this._getSourceRasterInfos(e),this._bindingResult=this._bindSourceRasters(),this._bindingResult.success&&this._patchRasterInfo(),this._bindingResult.supportsGPU=s&&this._bindingResult.supportsGPU):this._bindingResult={success:!0,supportsGPU:!0},this.processInputBandIds(),this._bindingResult}process(e){let t=this._getRasterValues(),r=0===t.length?e.pixelBlocks??e.primaryPixelBlocks:t.map(t=>this._readRasterValue(t,e));return this._processPixels({...e,pixelBlocks:r})}processInputBandIds(){let e,t=this._getRasterValues().filter(this._isRasterFunctionValue);if(t.length>1){let e=t.map(e=>e.processInputBandIds()[0]);this.rawInputBandIds=e,this.isInputBandIdsSwizzled=this.rawInputBandIds.some((e,t)=>e!==t);let r=t.filter(e=>"ExtractBand"===e.functionName);return r.length&&r.forEach((e,t)=>{e.isInputBandIdsSwizzled=!0,e.swizzledBandSelection=[t,t,t]}),this.rawInputBandIds}let r=t[0];if(r){if(e=r.processInputBandIds(),r.isInputBandIdsSwizzled)return this.rawInputBandIds=e,e}else{e=[];let{bandCount:t}=this.sourceRasterInfos[0];for(let r=0;r<t;r++)e.push(r)}let n=this._getInputBandIds(e);return this.isInputBandIdsSwizzled=n.some((e,t)=>e!==t),this.rawInputBandIds=n,this.rawInputBandIds}getPrimaryRasters(){let e=[],t=[];return this._getPrimaryRasters(this,e,t),{rasters:e,rasterIds:t}}getWebGLProcessorDefinition(){let e=this._getWebGLParameters(),{raster:t,rasters:r}=this.functionArguments;return r&&Array.isArray(r)&&r.length?(e.rasters=r.map(e=>this._isRasterFunctionValue(e)?e.getWebGLProcessorDefinition():"number"==typeof e?{name:"Constant",parameters:{value:e},pixelType:"f32",id:-1,isNoopProcess:!1}:{name:"Identity",parameters:{value:e},pixelType:"f32",id:-1,isNoopProcess:!1}),e.rasters.some(e=>null!=e)||(e.rasters=null)):this._isRasterFunctionValue(t)&&(e.raster=t.getWebGLProcessorDefinition()),{name:this.functionName,parameters:e,pixelType:this.outputPixelType,id:this.id,isNoopProcess:this.isNoopProcess}}getClippingGeometries(){let e=[];"Clip"===this.functionName&&e.push(this.functionArguments);let{raster:t,rasters:r}=this.functionArguments;if(r&&Array.isArray(r)&&r.length)r.forEach(t=>{if(this._isRasterFunctionValue(t)){let r=t.getClippingGeometries();e.push(...r)}});else if(this._isRasterFunctionValue(t)){let r=t.getClippingGeometries();e.push(...r)}return e}_getOutputPixelType(e){return"unknown"===this.outputPixelType?e:this.outputPixelType??e}_getWebGLParameters(){return{}}_getInputBandIds(e){return e}_removeStatsHistColormapVAT(e){e.statistics=null,e.histograms=null,e.colormap=null,e.attributeTable=null,e.multidimensionalInfo?.variables.forEach(e=>{e.statistics=void 0,e.histograms=void 0})}_getRasterValues(){let{rasterArgumentNames:e}=this;return"rasters"===e[0]?this.functionArguments.rasters??[]:e.flatMap(e=>this.functionArguments[e])}_getSourceRasterInfos(e){let t=this._getRasterValues(),{rasterInfos:r,rasterIds:n}=e;if(0===t.length)return r;let s=t.map(e=>e&&"object"==typeof e&&"bind"in e&&e.rasterInfo?e.rasterInfo:"string"==typeof e&&n.includes(e)?r[n.indexOf(e)]:"number"!=typeof e?r[0]:void 0),i=s.find(e=>e)??r[0];return s.forEach((e,t)=>{void 0===e&&(s[t]=i)}),s}_getPrimaryRasterId(e){return e?.rasterId}_getPrimaryRasters(e,t=[],r=[]){for(let n=0;n<e.sourceRasters.length;n++){let s=e.sourceRasters[n];if("number"!=typeof s)if("bind"in s)this._getPrimaryRasters(s,t,r);else{let e=this._getPrimaryRasterId(s);if(null==e)continue;r.includes(e)||(this.mainPrimaryRasterId===e?(t.unshift(s),r.unshift(e)):(t.push(s),r.push(e)))}}}_isRasterFunctionValue(e){return null!=e&&"object"==typeof e&&"getWebGLProcessorDefinition"in e}_readRasterValue(e,t){let{primaryPixelBlocks:r}=t;if(null==e||"$$"===e){let e=r[0];return null==e?null:e.clone()}if("string"==typeof e){let n=t.primaryRasterIds.indexOf(e);return -1===n?null:r[n]}if("number"==typeof e){let t=r[0];if(null==t)return null;let{width:n,height:s,pixelType:i}=t,o=new Float32Array(n*s);o.fill(e);let a=Array(this.sourceRasterInfos[0].bandCount).fill(o);return new O.A({width:n,height:s,pixelType:i,pixels:a})}return e.process(t)}_patchRasterInfo(){let{rasterInfo:e}=this;if(!e?.keyProperties)return;let{bandCount:t,keyProperties:r,statistics:n,histograms:s}=e,i=r.BandProperties;i&&i.length!==t&&(e.keyProperties={...r,BandProperties:void 0}),n&&n.length!==t&&(e.statistics=n.length>t?n.slice(0,t):null),s&&s.length!==t&&(e.histograms=s.length>t?s.slice(0,t):null),r.BAND_COUNT&&Number(r.BAND_COUNT)!==t&&(e.keyProperties={...r,BAND_COUNT:"string"==typeof r.BAND_COUNT?String(t):t})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],L.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],L.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],L.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}}),(0,E.w)(e=>e?.toLowerCase())],L.prototype,"outputPixelType",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],L.prototype,"mainPrimaryRasterId",void 0),(0,k._)([(0,S.MZ)()],L.prototype,"sourceRasters",void 0),(0,k._)([(0,S.MZ)({type:[D.A],json:{write:!0}})],L.prototype,"sourceRasterInfos",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],L.prototype,"rasterInfo",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],L.prototype,"readingBufferSize",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],L.prototype,"id",void 0),(0,k._)([(0,S.MZ)()],L.prototype,"isNoopProcess",void 0),(0,k._)([(0,S.MZ)()],L.prototype,"supportsGPU",null),(0,k._)([(0,S.MZ)()],L.prototype,"rawInputBandIds",void 0),(0,k._)([(0,S.MZ)()],L.prototype,"rawSourceRasterInfos",void 0),(0,k._)([(0,S.MZ)()],L.prototype,"isInputBandIdsSwizzled",void 0),(0,k._)([(0,S.MZ)()],L.prototype,"swizzledBandSelection",void 0),(0,k._)([(0,S.MZ)()],L.prototype,"isBranch",void 0),(0,k._)([(0,S.MZ)({readOnly:!0})],L.prototype,"flatWebGLFunctionChain",null),(0,k._)([(0,S.MZ)()],L.prototype,"_bindingResult",void 0);let V=L=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.BaseRasterFunction")],L),W={userDefined:-1,lineDetectionHorizontal:0,lineDetectionVertical:1,lineDetectionLeftDiagonal:2,lineDetectionRightDiagonal:3,gradientNorth:4,gradientWest:5,gradientEast:6,gradientSouth:7,gradientNorthEast:8,gradientNorthWest:9,smoothArithmeticMean:10,smoothing3x3:11,smoothing5x5:12,sharpening3x3:13,sharpening5x5:14,laplacian3x3:15,laplacian5x5:16,sobelHorizontal:17,sobelVertical:18,sharpen:19,sharpen2:20,pointSpread:21,none:255},$={bitwiseAnd:11,bitwiseLeftShift:12,bitwiseNot:13,bitwiseOr:14,bitwiseRightShift:15,bitwiseXOr:16,booleanAnd:17,booleanNot:18,booleanOr:19,booleanXOr:20,equalTo:24,greaterThan:28,greaterThanEqual:29,lessThan:33,lessThanEqual:34,isNull:31,notEqual:46},H={acos:6,asin:7,atan:8,atanh:9,cos:21,cosh:22,sin:51,sinh:52,tan:56,tanh:57,acosh:59,asinh:60,atan2:61},q={setNull:50,conditional:78},J={plus:1,minus:2,times:3,sqrt:4,power:5,abs:10,divide:23,exp:25,exp10:26,exp2:27,int:30,float:32,ln:35,log10:36,log2:37,mod:44,negate:45,roundDown:48,roundUp:49,square:53,floatDivide:64,floorDivide:65,...$,...H,majority:38,max:39,mean:40,med:41,min:42,minority:43,range:47,stddev:54,sum:55,variety:58,majorityIgnoreNoData:66,maxIgnoreNoData:67,meanIgnoreNoData:68,medIgnoreNoData:69,minIgnoreNoData:70,minorityIgnoreNoData:71,rangeIgnoreNoData:72,stddevIgnoreNoData:73,sumIgnoreNoData:74,varietyIgnoreNoData:75,...q},K=new Map([[H.acos,{domain:[0,Math.PI],isInteger:!1}],[H.asin,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[H.atan,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[H.cos,{domain:[-1,1],isInteger:!1}],[H.sin,{domain:[-1,1],isInteger:!1}],[$.booleanAnd,{domain:[0,1],isInteger:!0}],[$.booleanNot,{domain:[0,1],isInteger:!0}],[$.booleanOr,{domain:[0,1],isInteger:!0}],[$.booleanXOr,{domain:[0,1],isInteger:!0}],[$.equalTo,{domain:[0,1],isInteger:!0}],[$.notEqual,{domain:[0,1],isInteger:!0}],[$.greaterThan,{domain:[0,1],isInteger:!0}],[$.greaterThanEqual,{domain:[0,1],isInteger:!0}],[$.lessThan,{domain:[0,1],isInteger:!0}],[$.lessThanEqual,{domain:[0,1],isInteger:!0}],[$.isNull,{domain:[0,1],isInteger:!0}]]),X=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3];function Y(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]+s[e]);return o}function Q(e,t,r){let[n]=e,s=n.length,i=O.A.createEmptyBand("f32",s);return i.set(n),i}function ee(e,t,r){let[n]=e,s=n.length,i=O.A.createEmptyBand(r,s);for(let e=0;e<s;e++)t&&!t[e]||(i[e]=n[e]*n[e]);return i}function et(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]-s[e]);return o}function er(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]*s[e]);return o}function en(e,t,r){let[n]=e,s=n.length,i=O.A.createEmptyBand(r,s);for(let e=0;e<s;e++)t&&!t[e]||(i[e]=Math.sign(n[e])*Math.floor(Math.abs(n[e])));return i}function es(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]/s[e]);return o}function ei(e,t,r){return es(e,t,"f32")}function eo(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=Math.floor(n[e]/s[e]));return o}function ea(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]&s[e]);return o}function el(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]<<s[e]);return o}function eu(e,t,r){let[n]=e,s=n.length,i=O.A.createEmptyBand(r,s);for(let e=0;e<s;e++)t&&!t[e]||(i[e]=~n[e]);return i}function ep(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]|s[e]);return o}function ec(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]>>s[e]);return o}function eh(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]^s[e]);return o}function em(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]&&s[e]?1:0);return o}function ef(e,t,r){let[n]=e,s=n.length,i=O.A.createEmptyBand(r,s);for(let e=0;e<s;e++)t&&!t[e]||(i[e]=+!n[e]);return i}function ed(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]||s[e]?1:0);return o}function eg(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=!!n[e]^!!s[e]);return o}function ey(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=+(n[e]===s[e]));return o}function ex(e,t,r,n){let[s]=e,i=s.length,o=O.A.createEmptyBand(r,i),a=n===Math.E;for(let e=0;e<i;e++)t&&!t[e]||(o[e]=a?Math.exp(s[e]):n**s[e]);return o}function ew(e,t,r){return ex(e,t,r,10)}function eA(e,t,r){return ex(e,t,r,2)}function eb(e,t,r){return ex(e,t,r,Math.E)}function e_(e,t,r,n){let[s]=e,i=s.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(s[e]<=0?t[e]=0:o[e]=n(s[e]));return o}function ev(e,t,r){return e_(e,t,r,Math.log10)}function eM(e,t,r){return e_(e,t,r,Math.log2)}function eP(e,t,r){return e_(e,t,r,Math.log)}function eT(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=+(n[e]>s[e]));return o}function eR(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=+(n[e]>=s[e]));return o}function eN(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=+(n[e]<s[e]));return o}function eF(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=+(n[e]<=s[e]));return o}function ek(e,t,r){let[n]=e,s=n.length,i=O.A.createEmptyBand(r,s);if(!t)return i;for(let e=0;e<s;e++)i[e]=+!t[e];return i}function eS(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]%s[e]);return o}function eI(e,t,r){let[n]=e,s=n.length,i=O.A.createEmptyBand(r,s);for(let e=0;e<s;e++)t&&!t[e]||(i[e]=-n[e]);return i}function eC(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=+(n[e]!==s[e]));return o}function ej(e,t,r){let[n,s,i]=e,o=n.length,a=O.A.createEmptyBand(r,o);for(let e=0;e<o;e++)t&&!t[e]||(a[e]=n[e]?s[e]:i[e]);return a}function eB(e,t,r){let n=e.length;if(n<2)return e[0];let[s]=e,i=s.length,o=O.A.createEmptyBand(r,i);for(let r=0;r<i;r++)if(!t||t[r]){let t=s[r];for(let s=1;s<n;s++){let n=e[s][r];t<n&&(t=n)}o[r]=t}return o}function eG(e,t,r){let n=e.length;if(n<2)return e[0];let[s]=e,i=s.length,o=O.A.createEmptyBand(r,i);for(let r=0;r<i;r++)if(!t||t[r]){let t=s[r];for(let s=1;s<n;s++){let n=e[s][r];t>n&&(t=n)}o[r]=t}return o}function eZ(e,t,r){let n=e.length;if(n<2)return e[0];let[s]=e,i=s.length,o=O.A.createEmptyBand(r,i);for(let r=0;r<i;r++)if(!t||t[r]){let t=s[r],i=t;for(let s=1;s<n;s++){let n=e[s][r];i<n?i=n:t>n&&(t=n)}o[r]=i-t}return o}function ez(e,t,r){let n=e.length;if(n<2)return e[0];let[s]=e,i=s.length,o=O.A.createEmptyBand(r,i);for(let r=0;r<i;r++)if(!t||t[r]){let t=0;for(let s=0;s<n;s++)t+=e[s][r];o[r]=t/n}return o}function eE(e,t,r){let n=e.length;if(n<2)return e[0];let[s]=e,i=s.length,o=O.A.createEmptyBand(r,i);for(let r=0;r<i;r++)if(!t||t[r])for(let t=0;t<n;t++){let n=e[t];o[r]+=n[r]}return o}function eO(e,t,r){let n=e.length;if(n<2)return e[0];let[s]=e,i=s.length,o=O.A.createEmptyBand(r,i);for(let r=0;r<i;r++)if(!t||t[r]){let t=new Float32Array(n),s=0;for(let i=0;i<n;i++){let n=e[i];s+=n[r],t[i]=n[r]}s/=n;let i=0;for(let e=0;e<n;e++)i+=(t[e]-s)**2;o[r]=Math.sqrt(i/n)}return o}function eD(e,t,r){let n=e.length;if(n<2)return e[0];let s=Math.floor(n/2),[i]=e,o=i.length,a=O.A.createEmptyBand(r,o),l=new Float32Array(n),u=n%2==1;for(let r=0;r<o;r++)if(!t||t[r]){for(let t=0;t<n;t++)l[t]=e[t][r];l.sort(),a[r]=u?l[s]:(l[s]+l[s-1])/2}return a}function eU(e,t,r){let[n,s]=e;if(null==s)return n;let i=n.length,o=O.A.createEmptyBand(r,i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n[e]<s[e]?n[e]:s[e]);return o}function eL(e,t,r){let n=e.length;if(n<=2)return eU(e,t,r);let s=e[0].length,i=O.A.createEmptyBand(r,s),o=new Map;for(let r=0;r<s;r++)if(!t||t[r]){o.clear();for(let t=0;t<n;t++){let n=e[t][r];o.set(n,o.has(n)?o.get(n)+1:1)}let t=0,s=0,a=[];for(let e of o.keys())(t=o.get(e))>s?(s=t,a.length=0,a.push(e)):t===s&&a.push(e);a.length>1&&a.sort((e,t)=>e-t),i[r]=a[0]}return i}function eV(e,t,r){let n=e.length;if(n<=2)return eU(e,t,r);let s=e[0].length,i=O.A.createEmptyBand(r,s),o=new Map;for(let r=0;r<s;r++)if(!t||t[r]){o.clear();for(let t=0;t<n;t++){let n=e[t][r];o.set(n,o.has(n)?o.get(n)+1:1)}let t=0,s=e.length,a=[];for(let e of o.keys())(t=o.get(e))<s?(s=t,a.length=0,a.push(e)):t===s&&a.push(e);a.length>1&&a.sort((e,t)=>e-t),i[r]=a[0]}return i}function eW(e,t,r){let n=e.length;if(n<2)return e[0];let[s]=e,i=s.length,o=O.A.createEmptyBand(r,i),a=new Set;for(let r=0;r<i;r++)if(!t||t[r]){let t;a.clear();for(let s=0;s<n;s++)t=e[s][r],a.add(t);o[r]=a.size}return o}let e$=new Map,eH=new Map,eq=new Map,eJ=new Map;function eK(e,t,r={}){e$.size||(e$.set(4,Math.sqrt),e$.set(6,Math.acos),e$.set(7,Math.asin),e$.set(8,Math.atan),e$.set(9,Math.atanh),e$.set(10,Math.abs),e$.set(21,Math.cos),e$.set(22,Math.cosh),e$.set(48,Math.floor),e$.set(49,Math.ceil),e$.set(51,Math.sin),e$.set(52,Math.sinh),e$.set(56,Math.tan),e$.set(57,Math.tanh),e$.set(59,Math.acosh),e$.set(60,Math.asinh),e$.set(65,Math.floor),eH.set(5,Math.pow),eH.set(61,Math.atan2),eq.set(1,Y),eq.set(2,et),eq.set(3,er),eq.set(11,ea),eq.set(12,el),eq.set(13,eu),eq.set(14,ep),eq.set(15,ec),eq.set(16,eh),eq.set(17,em),eq.set(18,ef),eq.set(19,ed),eq.set(20,eg),eq.set(23,es),eq.set(24,ey),eq.set(25,eb),eq.set(26,ew),eq.set(27,eA),eq.set(28,eT),eq.set(29,eR),eq.set(30,en),eq.set(31,ek),eq.set(32,Q),eq.set(33,eN),eq.set(34,eF),eq.set(35,eP),eq.set(36,ev),eq.set(37,eM),eq.set(44,eS),eq.set(45,eI),eq.set(46,eC),eq.set(53,ee),eq.set(64,ei),eq.set(65,eo),eq.set(76,ej),eq.set(78,ej),eJ.set(38,eL),eJ.set(39,eB),eJ.set(40,ez),eJ.set(41,eD),eJ.set(42,eG),eJ.set(43,eV),eJ.set(47,eZ),eJ.set(54,eO),eJ.set(55,eE),eJ.set(58,eW),eJ.set(66,eL),eJ.set(67,eB),eJ.set(68,ez),eJ.set(69,eD),eJ.set(70,eG),eJ.set(71,eV),eJ.set(72,eZ),eJ.set(73,eO),eJ.set(74,eE),eJ.set(75,eW));let n=function(e,t=!1){let r=e.map(e=>e.mask),n=r.filter(e=>null!=e),s=e[0].pixels[0].length;if(0===n.length||t&&n.length!==r.length)return new Uint8Array(s).fill(255);let i=new Uint8Array(n[0]);if(1===n.length)return i;if(!t){for(let e=1;e<n.length;e++){let t=n[e];for(let e=0;e<i.length;e++)i[e]&&(i[e]=255*!!t[e])}return i}for(let e=1;e<n.length;e++){let t=n[e];for(let e=0;e<i.length;e++)0===i[e]&&(i[e]=255*!!t[e])}return i}(e,t>=66&&t<=75),{outputPixelType:s="f32"}=r,i=!eJ.has(t)||r.processAsMultiband,o=i?e[0].pixels.length:1,a=[];for(let r=0;r<o;r++){let o=eJ.has(t)&&!i?e.flatMap(e=>e.pixels):e.map(e=>e.pixels[r]),l,u=!0;if(t===q.setNull){let e=function(e,t,r){let[n,s]=e,i=n.length,o=O.A.createEmptyBand(r,i),a=new Uint8Array(i);for(let e=0;e<i;e++)(null==t||t[e])&&0===n[e]&&(o[e]=s[e],a[e]=255);return{band:o,mask:a}}(o,n,s);l=e.band,n=e.mask,u=!1}else eq.has(t)?l=eq.get(t)(o,n,"f64"):e$.has(t)?l=t===H.asin||t===H.acos||t===H.atanh?function(e,t,r,n){let s=e[0],i=s.length,o=O.A.createEmptyBand("f64",i);if(n===H.atanh){for(let e=0;e<i;e++)if(t[e]){let r=s[e];Math.abs(r)>=1?t[e]=0:o[e]=Math.atanh(r)}return o}let a=n===H.asin?Math.asin:Math.acos;for(let e=0;e<i;e++)if(t[e]){let r=s[e];Math.abs(r)>1?t[e]=0:o[e]=a(r)}return o}(o,n,0,t):function(e,t,r,n){let[s]=e,i=s.length,o=O.A.createEmptyBand("f64",i);for(let e=0;e<i;e++)t&&!t[e]||(o[e]=n(s[e]));return o}(o,n,0,e$.get(t)):eH.has(t)?l=function(e,t,r,n){let[s,i]=e,o=s.length,a=O.A.createEmptyBand("f64",o);for(let e=0;e<o;e++)t&&!t[e]||(a[e]=n(s[e],i[e]));return a}(o,n,0,eH.get(t)):eJ.has(t)?l=eJ.get(t)(o,n,"f64"):(l=o[0],u=!1);if(u&&t!==$.isNull&&!K.has(t)){let e=O.A.createEmptyBand(s,l.length);n||(n=new Uint8Array(l.length).fill(255)),(0,C.$p)(l,n),(0,C.yM)(l,n,s,e),l=e}a.push(l)}let l=e[0];return new O.A({width:l.width,height:l.height,pixelType:s,mask:t===$.isNull?null:n,pixels:a})}let eX=class extends V{constructor(){super(...arguments),this.functionName="Arithmetic",this.functionArguments=null,this.rasterArgumentNames=["raster","raster2"]}_bindSourceRasters(){let{operation:e}=this.functionArguments;if(e<1||e>6)return{success:!1,supportsGPU:!1,error:"unsupported operation"};let t=this.sourceRasterInfos[0].clone();return this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),this.rasterInfo=t,{success:!0,supportsGPU:t.bandCount<=3}}_processPixels(e){var t;let{pixelBlocks:r}=e;return null==r?.[0]||null==r?.[1]?null:eK(r,t=[null,1,2,3,23,5,44][t=this.functionArguments.operation]??1,{outputPixelType:this.outputPixelType})}_getWebGLParameters(){let{operation:e}=this.functionArguments,t=["","plus","minus","times","divide","power","mod"][e],r=this.outputPixelType??"f32",[n,s]=(0,C.hP)(r),i=(0,C.zw)(r);return i&&(n-=1e-4,s+=1e-4),{imageCount:2,operationName:t,domainRange:[n,s],isOutputRounded:i}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],eX.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:z,json:{write:!0,name:"rasterFunctionArguments"}})],eX.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],eX.prototype,"rasterArgumentNames",void 0);let eY=eX=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ArithmeticFunction")],eX),eQ=s=class extends G{clone(){return new s({raster:this.raster})}},e0=eQ=s=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.AspectFunctionArguments")],eQ);var e1=r(25723);let e2=class extends V{constructor(){super(...arguments),this.functionName="Aspect",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){let e=this.sourceRasterInfos[0];this.isGCS=e.spatialReference?.isGeographic??!1,this.outputPixelType=this._getOutputPixelType("f32");let t=e.clone();return t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),t.statistics=[{min:-1,max:360,avg:180,stddev:30}],t.bandCount=1,this.rasterInfo=t,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t)return null;let{extent:r,primaryPixelSizes:n}=e,s=n?.[0]??(r?{x:r.width/t.width,y:r.height/t.height}:{x:1,y:1});return(0,e1.di)(t,{resolution:s})}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],e2.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:e0,json:{write:!0,name:"rasterFunctionArguments"}})],e2.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],e2.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],e2.prototype,"isGCS",void 0);let e5=e2=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.AspectFunction")],e2);var e3=r(33498),e4=r(30781);let e8=new Set(["+","-","*","/","(",")"]);function e7(e,t){return e.toLowerCase().startsWith("b")?t[parseInt(e.slice(1),10)-1]:parseFloat(e)}var e6=r(93782);let e9=new e4.J({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});function te(e){let t=new Float32Array(9);return t[3*e[0]]=1,t[3*e[1]+1]=1,t[3*e[2]+2]=1,t}function tt(e,t,r){let n=r.length,s=new Float32Array(n);for(let i=0;i<n;i++)if(null==e||e[i]){let e=t[i],n=r[i],o=e+n;o&&(s[i]=(e-n)/o)}return[s]}let tr=i=class extends G{constructor(){super(...arguments),this.method="custom"}clone(){return new i({method:this.method,bandIndexes:this.bandIndexes,raster:(0,F.o8)(this.raster)})}};(0,k._)([(0,S.MZ)({json:{type:String,write:!0}})],tr.prototype,"bandIndexes",void 0),(0,k._)([(0,e3.e)(e9)],tr.prototype,"method",void 0);let tn=tr=i=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.BandArithmeticFunctionArguments")],tr),ts=new Set(["vari","mtvi2","rtvi-core","evi"]),ti=class extends V{constructor(){super(...arguments),this.functionName="BandArithmetic",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");let e=this.sourceRasterInfos[0];if(e.bandCount<2)return{success:!1,supportsGPU:!1,error:"band-arithmetic-function: source raster has insufficient amount of raster bands"};let t=e.clone();return t.pixelType=this.outputPixelType,t.bandCount="sultan"===this.functionArguments.method?3:1,this._removeStatsHistColormapVAT(t),t.keyProperties={...t.keyProperties,BandProperties:void 0},this.rasterInfo=t,{success:!0,supportsGPU:!["custom","gvitm","sultan"].includes(this.functionArguments.method)}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t)return t;let{method:r,bandIndexes:n}=this.functionArguments;return function(e,t){let r,n;if(!(0,e6.AB)(e))return e;let{equation:s,method:i}=t,o=t.bandIndexes.map(e=>e-1),{pixels:a,mask:l}=e;switch(i){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":r=tt(l,a[o[0]],a[o[1]]);break;case"ndwi":r=tt(l,a[o[1]],a[o[0]]);break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":r=function(e,t,r){let n=r.length,s=new Float32Array(n);for(let i=0;i<n;i++)if(null==e||e[i]){let e=t[i],n=r[i];n&&(s[i]=e/n)}return[s]}(l,a[o[0]],a[o[1]]);break;case"ci-g":case"ci-re":r=function(e,t,r){let n=t.length,s=new Float32Array(n);for(let i=0;i<n;i++)if(null==e||e[i]){let e=t[i],n=r[i];n&&(s[i]=e/n-1)}return[s]}(l,a[o[0]],a[o[1]]);break;case"savi":r=function(e,t,r,n){let s=r.length,i=new Float32Array(s);for(let o=0;o<s;o++)if(null==e||e[o]){let e=r[o],s=t[o],a=s+e+n;a&&(i[o]=(s-e)/a*(1+n))}return[i]}(l,a[o[0]],a[o[1]],o[2]+1);break;case"tsavi":r=function(e,t,r,n,s,i){let o=r.length,a=new Float32Array(o),l=-s*n+i*(1+n*n);for(let i=0;i<o;i++)if(null==e||e[i]){let e=r[i],o=t[i],u=s*o+e+l;u&&(a[i]=n*(o-n*e-s)/u)}return[a]}(l,a[o[0]],a[o[1]],o[2]+1,o[3]+1,o[4]+1);break;case"msavi":r=function(e,t,r){let n=r.length,s=new Float32Array(n);for(let i=0;i<n;i++)if(null==e||e[i]){let e=r[i],n=t[i],o=2*n+1;s[i]=.5*(o-Math.sqrt(o*o-8*(n-e)))}return[s]}(l,a[o[0]],a[o[1]]);break;case"gemi":r=function(e,t,r){let n=r.length,s=new Float32Array(n);for(let i=0;i<n;i++)if(null==e||e[i]){let e=r[i],n=t[i];if(1!==e&&n+e+.5!==0){let t=(2*(n*n-e*e)+1.5*n+.5*e)/(n+e+.5);s[i]=t*(1-.25*t)-(e-.125)/(1-e)}}return[s]}(l,a[o[0]],a[o[1]]);break;case"pvi":r=function(e,t,r,n,s){let i=r.length,o=new Float32Array(i),a=1/Math.sqrt(1+n*n);for(let l=0;l<i;l++)if(null==e||e[l]){let e=r[l],i=t[l];o[l]=(i-n*e-s)*a}return[o]}(l,a[o[0]],a[o[1]],o[2]+1,o[3]+1);break;case"gvitm":r=function(e,t){let[r,n,s,i,o,a]=t,l=r.length,u=new Float32Array(l);for(let t=0;t<l;t++)(null==e||e[t])&&(u[t]=-.2848*r[t]-.2435*n[t]-.5436*s[t]+.7243*i[t]+.084*o[t]-.18*a[t]);return[u]}(l,[a[o[0]],a[o[1]],a[o[2]],a[o[3]],a[o[4]],a[o[5]]]);break;case"sultan":r=function(e,t){let[r,n,s,i,o]=t,a=r.length,l=new Float32Array(a),u=new Float32Array(a),p=new Float32Array(a);for(let t=0;t<a;t++)(null==e||e[t])&&(l[t]=o[t]?i[t]/o[t]*100:0,u[t]=r[t]?i[t]/r[t]*100:0,p[t]=s[t]?n[t]/s[t]*(i[t]/s[t])*100:0);return[l,u,p]}(l,[a[o[0]],a[o[1]],a[o[2]],a[o[3]],a[o[4]]]);break;case"vari":r=function(e,t){let[r,n,s]=t,i=r.length,o=new Float32Array(i);for(let t=0;t<i;t++)if(null==e||e[t])for(t=0;t<i;t++){let e=r[t],i=n[t],a=i+e-s[t];a&&(o[t]=(i-e)/a)}return[o]}(l,[a[o[0]],a[o[1]],a[o[2]]]);break;case"mtvi2":r=function(e,t){let[r,n,s]=t,i=r.length,o=new Float32Array(i);for(let t=0;t<i;t++)if(null==e||e[t])for(t=0;t<i;t++){let e=r[t],i=n[t],a=s[t],l=Math.sqrt((2*e+1)**2-(6*e-5*Math.sqrt(i))-.5);if(l){let r=1.5*(1.2*(e-a)-2.5*(i-a));o[t]=r/l}}return[o]}(l,[a[o[0]],a[o[1]],a[o[2]]]);break;case"rtvi-core":r=function(e,t){let[r,n,s]=t,i=r.length,o=new Float32Array(i);for(let t=0;t<i;t++)if(null==e||e[t])for(t=0;t<i;t++){let e=r[t],i=n[t],a=s[t];o[t]=100*(e-i)-10*(e-a)}return[o]}(l,[a[o[0]],a[o[1]],a[o[2]]]);break;case"evi":r=function(e,t){let[r,n,s]=t,i=r.length,o=new Float32Array(i);for(let t=0;t<i;t++)if(null==e||e[t])for(t=0;t<i;t++){let e=r[t],i=n[t],a=e+6*i-7.5*s[t]+1;a&&(o[t]=2.5*(e-i)/a)}return[o]}(l,[a[o[0]],a[o[1]],a[o[2]]]);break;case"wndwi":r=function(e,t,r=.5){let[n,s,i]=t,o=s.length,a=new Float32Array(o);for(let t=0;t<o;t++)if(null==e||e[t])for(t=0;t<o;t++){let e=n[t],o=s[t],l=i[t],u=e+r*o+(1-r)*l;u&&(a[t]=(e-r*o-(1-r)*l)/u)}return[a]}(l,[a[o[0]],a[o[1]],a[o[2]]],o[3]?o[3]+1:.5);break;case"bai":r=function(e,t,r){let n=r.length,s=new Float32Array(n);for(let i=0;i<n;i++)if(null==e||e[i])for(i=0;i<n;i++){let e=(.1-t[i])**2+(.06-r[i])**2;e&&(s[i]=1/e)}return[s]}(l,a[o[0]],a[o[1]]);break;case"custom":r=function(e,t,r){let n,{ops:s,nums:i}=function(e,t){(e=e.replaceAll(" ","")).startsWith("-")&&(e="0"+e),e.startsWith("+")&&(e=e.slice(1));let r=e.split(""),n=[],s=[],i="";for(let e=0;e<r.length;e++){let o=r[e];e8.has(o)?(i.length&&s.push(e7(i,t)),n.push(o),i=""):i=i.concat(o)}return i.length&&s.push(e7(i,t)),{ops:n,nums:s}}(r,t);if(0===s.length){let e=1===i.length?i[0]:t[0];if(e instanceof Float32Array)return[e];let r=new Float32Array(t[0].length);return"number"==typeof e?r.fill(e):r.set(e),[r]}for(;s.length>0;){let{numIndex:t,opIndex:r}=function(e){if(1===e.length)return{opIndex:0,numIndex:0};let t=0,r=0;for(let n=0;n<e.length;n++)if("("===e[n])t=n;else if(")"===e[n]){r=n;break}let n=0===r?e:e.slice(t+1,r),s=-1;for(let e=0;e<n.length;e++)if("*"===n[e]||"/"===n[e]){s=e;break}if(s>-1)r>0&&(s+=t+1);else{for(let e=0;e<n.length;e++)if("+"===n[e]||"-"===n[e]){s=e;break}r>0&&(s+=t+1)}let i=0;for(let t=0;t<s;t++)"("===e[t]&&i++;return{opIndex:s,numIndex:s-i}}(s);if(n=function(e,t,r,n){let s,i,o;if("number"==typeof r&&"number"==typeof n)return r+n;"number"==typeof r?(i=new Float32Array(s=(o=n).length)).fill(r):(s=r.length,i=r,n.constructor===Number?(o=new Float32Array(s)).fill(n):o=n);let a=new Float32Array(s);switch(t){case"+":for(let t=0;t<s;t++)(null==e||e[t])&&(a[t]=i[t]+o[t]);break;case"-":for(let t=0;t<s;t++)(null==e||e[t])&&(a[t]=i[t]-o[t]);break;case"*":for(let t=0;t<s;t++)(null==e||e[t])&&(a[t]=i[t]*o[t]);break;case"/":for(let t=0;t<s;t++)(null==e||e[t])&&o[t]&&(a[t]=i[t]/o[t]);break;case"(":case")":throw Error("encountered error with custom band index equation")}return a}(e,s[r],i[t],i[t+1]),1===s.length)break;s=function(e,t){e.splice(t,1);let r=0,n=0;do{r=0,n=0;for(let t=0;t<e.length;t++)if("("===e[t])r=t;else if(")"===e[t]){n=t;break}n===r+1&&e.splice(r,2)}while(n===r+1);return e}(s,r),i.splice(t,2,n)}return[n]}(l,a,s);break;default:return e}let{outputPixelType:u="f32"}=t,p=null!=u&&(0,C.zw)(u);l?(n=new Uint8Array(e.width*e.height)).set(l):p&&(n=new Uint8Array(e.width*e.height).fill(255)),p&&(r=r.map(e=>{let t=O.A.createEmptyBand(u,e.length);return(0,C.yM)(e,n,u,t),t}));let c=new O.A({width:e.width,height:e.height,pixelType:u,pixels:r,mask:n});return c.updateStatistics(),c}(t,{method:r,bandIndexes:n.split(" ").map(e=>parseFloat(e)),equation:n,outputPixelType:this.outputPixelType})}_getWebGLParameters(){let e,t,r=this.functionArguments.bandIndexes.split(" ").map(e=>parseFloat(e)-1);2===r.length&&r.push(0);let n=this.isInputBandIdsSwizzled?[0,1,2]:r,s=new Float32Array(3),{method:i}=this.functionArguments;switch(i){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":e=te([n[0],n[1],0]),t="ndxi";break;case"ndwi":e=te([n[1],n[0],0]),t="ndxi";break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":e=te([n[0],n[1],0]),t="sr";break;case"ci-g":case"ci-re":e=te([n[0],n[1],0]),t="ci";break;case"savi":e=te([n[0],n[1],0]),t="savi",s[0]=r[2]+1;break;case"tsavi":e=te([n[0],n[1],0]),t="tsavi",s[0]=r[2]+1,s[1]=r[3]+1,s[2]=r[4]+1;break;case"msavi":e=te([n[0],n[1],0]),t="msavi";break;case"gemi":e=te([n[0],n[1],0]),t="gemi";break;case"pvi":e=te([n[0],n[1],0]),t="tsavi",s[0]=r[2]+1,s[1]=r[3]+1;break;case"vari":e=te([n[0],n[1],n[2]]),t="vari";break;case"mtvi2":e=te([n[0],n[1],n[2]]),t="mtvi";break;case"rtvi-core":e=te([n[0],n[1],n[2]]),t="rtvicore";break;case"evi":e=te([n[0],n[1],n[2]]),t="evi";break;case"wndwi":e=te([n[0],n[1],0]),t="wndwi",s[0]=r[3]?r[3]+1:.5;break;case"bai":e=te([n[1],n[0],0]),t="bai";break;default:e=te([0,1,2]),t="custom"}return{bandIndexMat3:e,indexType:t,adjustments:s,isOutputRounded:(0,C.zw)(this.outputPixelType)}}_getInputBandIds(e){if("custom"===this.functionArguments.method)return e;let t=this.functionArguments.bandIndexes.split(" ").map(e=>parseFloat(e)-1),r=e.length,n=t.map(e=>e>=r?r-1:e),s=ts.has(this.functionArguments.method)?3:2,i=n.slice(0,s).map(t=>e[t]);return 2===i.length&&i.push(0),i}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],ti.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:tn,json:{write:!0,name:"rasterFunctionArguments"}})],ti.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],ti.prototype,"rasterArgumentNames",void 0);let to=ti=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.BandArithmeticFunction")],ti);var ta=r(31789),tl=r(59879);let tu=new e4.J({1:"outside",2:"inside"},{useNumericKeys:!0}),tp=o=class extends G{constructor(){super(...arguments),this.clippingType="outside"}clone(){return new o({clippingGeometry:this.clippingGeometry.clone(),clippingType:this.clippingType})}};(0,k._)([(0,S.MZ)({types:tl.yR,json:{read:ta.rS,write:!0}})],tp.prototype,"clippingGeometry",void 0),(0,k._)([(0,S.MZ)({json:{read:tu.read,write:tu.write}})],tp.prototype,"clippingType",void 0);let tc=tp=o=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ClipFunctionArguments")],tp);var th=r(18402),tm=r(34455);let tf=class extends V{constructor(){super(...arguments),this.functionName="Clip",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){let e=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(e.pixelType),e.pixelType=this.outputPixelType,this.rasterInfo=e;let{functionArguments:t}=this,{clippingGeometry:r,clippingType:n}=t;if(!r)return{success:!1,supportsGPU:!1,error:"missing clipping geometry"};if("outside"===n)try{let{spatialReference:t}=e,n="extent"===r.type?(0,tm._l)(r,t):(0,tm.uk)(r,t).extent;n&&(0,th.Sd)(e,n)}catch{}return{success:!0,supportsGPU:!0}}_processPixels(e){return e.pixelBlocks?.[0]}_getWebGLParameters(){let{clippingGeometry:e,clippingType:t}=this.functionArguments;return{clippingGeometry:e.toJSON(),clippingType:t}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],tf.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:tc,json:{write:!0,name:"rasterFunctionArguments"}})],tf.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],tf.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)()],tf.prototype,"isNoopProcess",void 0);let td=tf=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ClipFunction")],tf);var tg=r(53480),ty=r(36940),tx=r(3640);let tw=a=class extends G{castColormapName(e){if(!e)return null;let t=e.toLowerCase();return ty.L7.includes(t)?t:null}readColorRamp(e){return(0,tx.r)(e)}readColorRampName(e,t){if(!e)return null;let r=ty.kH.jsonValues.find(t=>t.toLowerCase()===e.toLowerCase());return r?ty.kH.fromJSON(r):null}clone(){return new a({colormap:(0,F.o8)(this.colormap),colormapName:this.colormapName,colorRamp:this.colorRamp?.clone(),colorRampName:this.colorRampName})}};(0,k._)([(0,S.MZ)({type:[[Number]],json:{write:!0}})],tw.prototype,"colormap",void 0),(0,k._)([(0,S.MZ)({type:String,json:{write:!0}})],tw.prototype,"colormapName",void 0),(0,k._)([(0,E.w)("colormapName")],tw.prototype,"castColormapName",null),(0,k._)([(0,S.MZ)({types:tx.g,json:{write:!0}})],tw.prototype,"colorRamp",void 0),(0,k._)([(0,tg.w)("colorRamp")],tw.prototype,"readColorRamp",null),(0,k._)([(0,S.MZ)({type:ty.kH.apiValues,json:{type:ty.kH.jsonValues,write:ty.kH.write}})],tw.prototype,"colorRampName",void 0),(0,k._)([(0,tg.w)("colorRampName")],tw.prototype,"readColorRampName",null);let tA=tw=a=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ColormapFunctionArguments")],tw),tb=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[112,75,3],[113,76,3],[114,77,3],[115,77,3],[116,78,3],[117,79,3],[118,79,3],[119,80,3],[121,81,4],[122,82,4],[123,82,4],[124,83,4],[125,84,4],[126,84,4],[127,85,4],[128,86,4],[129,86,4],[130,87,4],[131,88,4],[132,89,4],[133,89,4],[134,90,4],[135,91,4],[136,91,4],[137,92,4],[138,93,4],[139,94,4],[140,94,4],[142,95,5],[143,96,5],[144,96,5],[145,97,5],[146,98,5],[147,99,5],[148,99,5],[149,100,5],[150,101,5],[151,101,5],[152,102,5],[153,103,5],[154,104,5],[155,104,5],[156,105,5],[157,106,5],[158,106,5],[159,107,5],[160,108,5],[161,108,5],[162,109,5],[164,110,6],[165,111,6],[166,111,6],[167,112,6],[168,113,6],[169,113,6],[170,114,6],[171,115,6],[172,116,6],[173,116,6],[174,117,6],[245,0,0],[245,5,0],[245,10,0],[246,15,0],[246,20,0],[246,25,0],[246,30,0],[247,35,0],[247,40,0],[247,45,0],[247,50,0],[247,55,0],[248,60,0],[248,65,0],[248,70,0],[248,75,0],[249,81,0],[249,86,0],[249,91,0],[249,96,0],[250,101,0],[250,106,0],[250,111,0],[250,116,0],[250,121,0],[251,126,0],[251,131,0],[251,136,0],[251,141,0],[252,146,0],[252,151,0],[252,156,0],[252,156,0],[251,159,0],[250,162,0],[249,165,0],[248,168,0],[247,171,0],[246,174,0],[245,177,0],[245,179,0],[244,182,0],[243,185,0],[242,188,0],[241,191,0],[240,194,0],[239,197,0],[238,200,0],[237,203,0],[236,206,0],[235,209,0],[234,212,0],[233,215,0],[232,218,0],[231,221,0],[230,224,0],[230,226,0],[229,229,0],[228,232,0],[227,235,0],[226,238,0],[225,241,0],[224,244,0],[223,247,0],[165,247,0],[163,244,0],[161,240,0],[158,237,0],[156,233,1],[154,230,1],[152,227,1],[149,223,1],[147,220,1],[145,216,1],[143,213,1],[140,210,2],[138,206,2],[136,203,2],[134,200,2],[132,196,2],[129,193,2],[127,189,2],[125,186,3],[123,183,3],[120,179,3],[118,176,3],[116,172,3],[114,169,3],[111,166,3],[109,162,4],[107,159,4],[105,155,4],[103,152,4],[100,149,4],[98,145,4],[96,142,4],[94,138,5],[91,135,5],[89,132,5],[87,128,5],[85,125,5],[82,121,5],[80,118,5],[78,115,6],[76,111,6],[73,108,6],[71,105,6],[69,101,6],[67,98,6],[65,94,6],[62,91,7],[60,88,7],[58,84,7],[56,81,7],[53,77,7],[51,74,7],[49,71,7],[47,67,8],[44,64,8],[42,60,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8]],t_=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[245,20,0],[245,24,0],[245,29,0],[245,31,0],[247,33,0],[247,33,0],[247,37,0],[247,41,0],[247,41,0],[247,41,0],[247,45,0],[247,45,0],[247,47,0],[247,49,0],[247,49,0],[247,54,0],[247,54,0],[247,56,0],[247,58,0],[247,58,0],[250,62,0],[250,62,0],[250,62,0],[250,67,0],[250,67,0],[250,67,0],[250,69,0],[250,71,0],[250,71,0],[250,75,0],[250,75,0],[250,78,0],[250,79,0],[250,79,0],[250,79,0],[250,81,0],[250,83,0],[250,83,0],[250,87,0],[250,87,0],[250,90,0],[250,92,0],[252,93,0],[252,93,0],[252,97,0],[252,97,0],[252,97,0],[252,97,0],[252,101,0],[252,101,0],[252,101,0],[252,101,0],[252,105,0],[252,105,0],[252,107,0],[252,109,0],[252,109,0],[252,113,13],[255,118,20],[255,119,23],[255,121,25],[255,126,33],[255,132,38],[255,133,40],[255,135,43],[255,141,48],[255,144,54],[255,150,59],[255,152,61],[255,153,64],[255,159,69],[255,163,77],[255,165,79],[255,168,82],[255,174,87],[255,176,92],[255,181,97],[255,183,99],[255,186,102],[255,191,107],[255,197,115],[255,201,120],[255,203,123],[255,205,125],[255,209,130],[255,214,138],[255,216,141],[255,218,143],[255,224,150],[255,228,156],[255,234,163],[255,236,165],[255,238,168],[255,243,173],[255,248,181],[255,252,186],[253,252,186],[250,252,187],[244,250,180],[238,247,176],[234,246,173],[231,245,169],[223,240,163],[217,237,157],[211,235,150],[205,233,146],[200,230,142],[195,227,136],[189,224,132],[184,222,126],[180,220,123],[174,217,119],[169,214,114],[163,212,108],[160,210,105],[154,207,101],[148,204,96],[143,201,93],[138,199,88],[134,197,84],[130,194,81],[126,191,77],[117,189,70],[115,186,68],[112,184,64],[106,181,60],[100,179,55],[94,176,49],[92,174,47],[90,173,45],[81,168,37],[75,166,33],[71,163,28],[66,160,24],[62,158,21],[56,156,14],[51,153,0],[51,153,0],[51,153,0],[50,150,0],[50,150,0],[50,150,0],[50,150,0],[49,148,0],[49,148,0],[49,148,0],[48,145,0],[48,145,0],[48,145,0],[48,145,0],[48,143,0],[48,143,0],[48,143,0],[48,143,0],[47,140,0],[47,140,0],[47,140,0],[47,140,0],[46,138,0],[46,138,0],[46,138,0],[46,138,0],[45,135,0],[45,135,0],[45,135,0],[45,135,0],[44,133,0],[44,133,0],[44,133,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[42,128,0],[42,128,0],[42,128,0],[42,125,0],[42,125,0],[42,125,0],[42,125,0],[41,122,0],[41,122,0],[41,122,0],[41,122,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[39,117,0],[39,117,0],[39,117,0],[39,117,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0]];function tv(e,t){let r=[],n=[];for(let t=0;t<e.length-1;t++)r.push({type:"algorithmic",algorithm:"esriHSVAlgorithm",fromColor:e[t].slice(1),toColor:e[t+1].slice(1)}),n.push(e[t+1][0]-e[t][0]);let s=e[e.length-1][0];return(0,ty.iv)({type:"multipart",colorRamps:r},{numColors:s,weights:t=t??n})}let tM=class extends V{constructor(){super(...arguments),this.functionName="Colormap",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){let e=this.sourceRasterInfos[0];if(e.bandCount>1)return{success:!1,supportsGPU:!1,error:"colormap-function: source data must be single band"};let{colormap:t,colormapName:r,colorRamp:n,colorRampName:s}=this.functionArguments;if(!t?.length)if(n)this.colorRamp=n,t=(0,ty.R8)(n,{interpolateAlpha:!0});else if(s){let e=(0,ty.M5)(s);e&&(t=(0,ty.R8)(e),this.colorRamp=(0,tx.r)(e))}else r&&(t=function(e){let t;switch(e){case"elevation":t=tv([[0,0,191,191],[51,0,0,255],[102,255,0,255],[153,255,0,127],[204,191,63,127],[256,20,20,20]]);break;case"gray":t=(0,ty.iv)({type:"algorithmic",algorithm:"esriHSVAlgorithm",fromColor:[0,0,0],toColor:[255,255,255]});break;case"hillshade":t=tv([[0,38,41,54],[69,79,82,90],[131,156,156,156],[256,253,253,241]],[.268,.238,.495]);break;case"ndvi":t=tb;break;case"ndvi2":t=function(){let e=tv([[0,255,255,255],[70,0,255,0],[80,205,173,193],[100,150,150,150],[110,120,51,100],[130,120,100,200],[140,28,3,144],[160,6,0,55],[180,10,25,30],[201,6,7,27]]);for(let t=e.length;t<256;t++)e.push([6,27,7]);return e}();break;case"ndvi3":t=t_;break;case"random":t=function(){let e=[];for(let t=0;t<256;t++){let t=[];for(let e=0;e<3;e++)t.push(Math.round(255*Math.random()));e.push(t)}return e}()}return t?t=t.map((e,t)=>[t,...e]):null}(r));if(!t?.length)return{success:!1,supportsGPU:!1,error:"colormap-function: missing colormap argument"};let i=this._getOutputPixelType(e.pixelType);this.outputPixelType=i.startsWith("f")?"s32":i;let o=e.clone();return o.pixelType=this.outputPixelType,o.colormap=t,o.bandCount=1,this.rasterInfo=o,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];return!t||(0,C.zw)(t.pixelType)||(t=t.clone()).clamp(this.outputPixelType),t}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],tM.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:tA,json:{write:!0,name:"rasterFunctionArguments"}})],tM.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],tM.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)()],tM.prototype,"isNoopProcess",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],tM.prototype,"indexedColormap",void 0),(0,k._)([(0,S.MZ)()],tM.prototype,"colorRamp",void 0);let tP=tM=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ColormapFunction")],tM);var tT=r(84298);let tR=l=class extends G{clone(){return new l({raster:this.raster})}},tN=tR=l=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ColormapToRGBFunctionArguments")],tR);var tF=r(7671);let tk=class extends V{constructor(){super(...arguments),this.functionName="ColormapToRGB",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){let e=this.sourceRasterInfos[0];if(e.bandCount>1||!e.colormap?.length)return{success:!1,supportsGPU:!1,error:"colormap-to-rgb-function: source data must be single band with a colormap"};let t=e.clone();t.pixelType=this.outputPixelType=this._getOutputPixelType("u8"),this._removeStatsHistColormapVAT(t),t.bandCount=3,t.statistics=[{min:0,max:255,avg:100,stddev:20},{min:0,max:255,avg:100,stddev:20},{min:0,max:255,avg:100,stddev:20}],this.rasterInfo=t;let r=[...e.colormap].sort((e,t)=>e[0]-t[0]),{indexedColormap:n,offset:s}=(0,e6.zg)({colormap:r});return n?(this.lookup={indexedColormap:n,offset:s},{success:!0,supportsGPU:(0,tF.WN)(n)}):{success:!1,supportsGPU:!1,error:"colormap-to-rgb-function: the colormap is not supported"}}_processPixels(e){let t=e.pixelBlocks?.[0];if(!t||!this.lookup)return t;let r=(t=t.clone()).pixels[0],n=t.mask??new Uint8Array(r.length).fill(255),s=new Uint8Array(r.length),i=new Uint8Array(r.length),o=new Uint8Array(r.length),{indexedColormap:a,offset:l}=this.lookup,u=a.length;for(let e=0;e<r.length;e++)if(n[e]){let t=4*(r[e]-l);t<0||t>u-4?n[e]=0:(s[e]=a[t++],i[e]=a[t++],o[e]=a[t++])}return t.pixels=[s,i,o],t.statistics=[new tT.z(0,255),new tT.z(0,255),new tT.z(0,255)],t.pixelType=this.outputPixelType,t}_getWebGLParameters(){return this.lookup}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],tk.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:tN,json:{write:!0,name:"rasterFunctionArguments"}})],tk.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],tk.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],tk.prototype,"lookup",void 0);let tS=tk=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ColormapToRGBFunction")],tk);var tI=r(7780);let tC=u=class extends G{constructor(){super(...arguments),this.rasters=[]}writeRasters(e,t){t.rasters=e.map(e=>"number"==typeof e||"string"==typeof e?e:e.toJSON())}clone(){return new u({rasters:(0,F.o8)(this.rasters)})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],tC.prototype,"rasters",void 0),(0,k._)([(0,tI.K)("rasters")],tC.prototype,"writeRasters",null);let tj=tC=u=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.CompositeBandFunctionArguments")],tC),tB=class extends V{constructor(){super(...arguments),this.functionName="CompositeBand",this.functionArguments=null,this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){let{sourceRasterInfos:e}=this,t=e[0];this.outputPixelType=this._getOutputPixelType(t.pixelType);let r=t.clone();if(r.attributeTable=null,r.colormap=null,r.pixelType=this.outputPixelType,r.bandCount=e.map(({bandCount:e})=>e).reduce((e,t)=>e+t),e.every(({statistics:e})=>null!=e&&e.length)){let t=[];e.forEach(({statistics:e})=>null!=e&&t.push(...e)),r.statistics=t}if(e.every(({histograms:e})=>null!=e&&e.length)){let t=[];e.forEach(({histograms:e})=>null!=e&&t.push(...e)),r.histograms=t}r.multidimensionalInfo&&r.multidimensionalInfo.variables.forEach(t=>{let r=e.map(e=>e.multidimensionalInfo?.variables.find(({name:e})=>e===t.name)),n=r.map(e=>e?.statistics?.length?e.statistics:null),s=r.map(e=>e?.histograms?.length?e.histograms:null);t.statistics=n.every(e=>null!=e)?n.flat():null,t.histograms=s.every(e=>null!=e)?s.flat():null}),r.bandCount>1&&(r.colormap=null,r.attributeTable=null);let n=e.every(e=>e.keyProperties.BandProperties?.length)?e.flatMap(e=>e.keyProperties.BandProperties):void 0;return r.keyProperties={...r.keyProperties,BandProperties:n},this.rasterInfo=r,{success:!0,supportsGPU:r.bandCount<=3}}_processPixels(e){let{pixelBlocks:t}=e;return t?null==t?.[0]?null:(0,e6.Wy)(t):null}_getWebGLParameters(){return{bandCount:this.rasterInfo.bandCount}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],tB.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:tj,json:{write:!0,name:"rasterFunctionArguments"}})],tB.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],tB.prototype,"rasterArgumentNames",void 0);let tG=tB=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.CompositeBandFunction")],tB);var tZ=r(80824);let tz=new e4.J({0:"difference",1:"relative-difference",2:"categorical",3:"euclidean-distance",4:"angle-difference",5:"band-with-most-change"},{useNumericKeys:!0}),tE=new e4.J({0:"all",1:"changed",2:"unchanged"},{useNumericKeys:!0}),tO=p=class extends G{constructor(){super(...arguments),this.method="difference",this.keepMethod="all",this.raster2=void 0}get rasters(){return[this.raster,this.raster2]}clone(){return new p({raster:this.raster,raster2:this.raster2,method:this.method,keepMethod:this.keepMethod})}};(0,k._)([(0,e3.e)(tz)],tO.prototype,"method",void 0),(0,k._)([(0,e3.e)(tE)],tO.prototype,"keepMethod",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],tO.prototype,"raster2",void 0),(0,k._)([(0,S.MZ)({readOnly:!0})],tO.prototype,"rasters",null);let tD=tO=p=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ComputeChangeFunctionArguments")],tO),tU=class extends V{constructor(){super(...arguments),this.functionName="ComputeChange",this.functionArguments=null,this.rasterArgumentNames=["raster","raster2"]}_bindSourceRasters(){let{method:e}=this.functionArguments,t=this.sourceRasterInfos[0].clone();if(this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),"categorical"===e){let e=this.sourceRasterInfos.map(e=>e.attributeTable),r=this._getFieldNames(e,"value"),n=e.map(e=>this._getClassFieldName(e));if(null==r[0]||null==r[1]||null==n[0]||null==n[1])return{success:!1,supportsGPU:!1,error:"both inputs must have proper attribute table with value and class fields"};this._updateAttributeTable(t,r,n)}return t.bandCount=1,this.rasterInfo=t,{success:!0,supportsGPU:"difference"===e||"relative-difference"===e}}_processPixels(e){let{pixelBlocks:t}=e;if(null==t?.[0]||null==t?.[1])return null;let{method:r}=this.functionArguments;return function(e,t,r,n){let[s,i]=e,o=(0,C.zw)(r)&&!(0,C.zw)(s.pixelType)&&!(0,C.zw)(i.pixelType),a=[s.mask,i.mask].filter(e=>e),l=O.A.combineBandMasks(a),u=e.map(e=>e.pixels[0]),{width:p,height:c}=s,h=O.A.createEmptyBand(r,p*c);switch(t){case"difference":case"relative-difference":!function(e){let{bands:[t,r],mask:n,isRelative:s,isRoundingNeeded:i,outBand:o}=e,a=t.length;for(let e=0;e<a;e++)if(!n||n[e]){let n=t[e]-r[e];if(s){let s=Math.max(Math.abs(t[e])-Math.abs(r[e]));n=s>0?n/s:0}o[e]=i?Math.round(n):n}}({bands:u,mask:l,outBand:h,isRoundingNeeded:o,isRelative:"relative-difference"===t});break;case"categorical":!function(e){let{bands:[t,r],categoryIndexLookups:[n,s],classNames:[i,o],mask:a,keepMethod:l,outBand:u}=e,p=t.length,c=i.length,h=o.length,m=c*h,f=m+1,d=m+2;for(let e=0;e<p;e++)if(!a||a[e]){let a=t[e],p=r[e],c=n[a],g=s[p],y=i[c],x=o[g];u[e]=null==c||null==g?m:"changed"===l&&y===x?f:"unchanged"===l&&y!==x?d:c*h+g}}({bands:u,mask:l,outBand:h,...n});break;case"euclidean-distance":!function(e){let{pixels:[t,r],mask:n,outBand:s}=e,i=t[0].length,o=t.length;for(let e=0;e<i;e++)if(!n||n[e]){let n=0;for(let s=0;s<o;s++){let i=t[s][e]-r[s][e];n+=i*i}s[e]=Math.sqrt(n)}}({pixels:e.map(e=>e.pixels),mask:l,outBand:h});break;case"angle-difference":!function(e){let{pixels:[t,r],mask:n,outBand:s}=e,i=t[0].length,o=t.length;for(let e=0;e<i;e++)if(!n||n[e]){let n=0,i=0,a=0;for(let s=0;s<o;s++){let o=t[s][e],l=r[s][e];n+=o*l,i+=o*o,a+=l*l}let l=Math.sqrt(i*a);s[e]=l?Math.acos(n/l):1.5707963267948966}}({pixels:e.map(e=>e.pixels),mask:l,outBand:h});break;case"band-with-most-change":!function(e){let{pixels:[t,r],mask:n,outBand:s}=e,i=t[0].length,o=t.length;for(let e=0;e<i;e++)if(!n||n[e]){let n=0,i=0;for(let s=0;s<o;s++){let o=Math.abs(t[s][e]-r[s][e]);o>n&&(n=o,i=s)}s[e]=i}}({pixels:e.map(e=>e.pixels),mask:l,outBand:h})}let m=new O.A({width:p,height:c,pixels:[h],pixelType:r,mask:l});return m.updateStatistics(),m}(t,r,this.outputPixelType,this._categoryConfig)}_getWebGLParameters(){let e=this.outputPixelType??"f32",[t,r]=(0,C.hP)(e),n=(0,C.zw)(e);return n&&(t-=1e-4,r+=1e-4),{method:this.functionArguments.method,domainRange:[t,r],isOutputRounded:n}}_updateAttributeTable(e,t,r){let n=this.sourceRasterInfos.map(e=>e.attributeTable),s=n.map((e,r)=>e.features.map(e=>e.attributes[t[r]])),i=n.map((e,t)=>e.features.map(e=>e.attributes[r[t]])),o=s.map(e=>{let t=[];return e.forEach((e,r)=>t[e]=r),t}),{keepMethod:a}=this.functionArguments;this._categoryConfig={categoryIndexLookups:o,classNames:i,keepMethod:a};let l=n[0].clone();l.fields=[new tZ.A({name:"OID",type:"oid"}),new tZ.A({name:"Value",type:"integer"}),new tZ.A({name:"ClassName",type:"string"}),new tZ.A({name:"Class_From",type:"string"}),new tZ.A({name:"Class_To",type:"string"})];let u=this._getFieldNames(n,"red"),p=this._getFieldNames(n,"green"),c=this._getFieldNames(n,"blue"),h=[],m=2===u.length&&2===p.length&&2===c.length;m&&(h.push(...n.map((e,t)=>e.features.map(e=>[e.attributes[u[t]],e.attributes[p[t]],e.attributes[c[t]]]))),l.fields.push(new tZ.A({name:"Red",type:"integer"}),new tZ.A({name:"Green",type:"integer"}),new tZ.A({name:"Blue",type:"integer"})));let f=l.features[0].clone();f.geometry=null;let d=[],[g,y]=s.map(e=>e.length),x=1;for(let e=0;e<g;e++){let t=i[0][e];for(let r=0;r<y;r++){let n=i[1][r];if("changed"===a&&t===n||"unchanged"===a&&t!==n)continue;let s=f.clone();s.attributes={OID:x++,Value:e*y+r,ClassName:t===n?t:`${t} -> ${n}`,Class_From:t,Class_To:n},m&&(s.attributes.Red=h[0][e][0]+h[1][r][0]>>1,s.attributes.Green=h[0][e][1]+h[1][r][1]>>1,s.attributes.Blue=h[0][e][2]+h[1][r][2]>>1),d.push(s)}}if("changed"===a){let e=f.clone();e.attributes={OID:x++,Value:g*y+1,ClassName:"No Change",Class_From:"Same",Class_To:"Same"},d.push(e)}else if("unchanged"===a){let e=f.clone();e.attributes={OID:x++,Value:g*y+2,ClassName:"Changed",Class_From:"Any",Class_To:"Any"},d.push(e)}l.features=d,e.attributeTable=l}_getFieldNames(e,t){return e.map(({fields:e})=>e.find(e=>e.name.toLowerCase()===t)?.name).filter(e=>e)}_getClassFieldName(e){let t=e.fields.find(e=>"string"===e.type&&e.name.toLowerCase().startsWith("class"))??e.fields.find(e=>"string"===e.type&&e.name.toLowerCase().includes("class")||e.name.toLowerCase().includes("type")||e.name.toLowerCase().includes("name"))??e.fields.find(e=>"string"===e.type);return t?.name}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],tU.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:tD,json:{write:!0,name:"rasterFunctionArguments"}})],tU.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],tU.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],tU.prototype,"_categoryConfig",void 0);let tL=tU=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ComputeChangeFunction")],tU),tV=c=class extends G{constructor(){super(...arguments),this.contrastOffset=0,this.brightnessOffset=0}clone(){return new c({contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset,raster:this.raster})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],tV.prototype,"contrastOffset",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],tV.prototype,"brightnessOffset",void 0);let tW=tV=c=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ContrastBrightnessFunctionArguments")],tV);var t$=r(51725);let tH=class extends V{constructor(){super(...arguments),this.functionName="ContrastBrightness",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null}_bindSourceRasters(){let{sourceRasterInfos:e}=this,t=e[0];if("u8"!==t.pixelType)return{success:!1,supportsGPU:!1,error:"Only unsigned 8 bit raster is supported by ContrastBrightness function."};this.outputPixelType=this._getOutputPixelType("u8");let r=t.clone();this._removeStatsHistColormapVAT(r),this.rasterInfo=r;let{contrastOffset:n,brightnessOffset:s}=this.functionArguments;return this.lookup=(0,t$.zj)(n,s),{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];return null==t?null:(0,e6.eH)(t,{lut:t.pixels.map(()=>this.lookup),offset:0,outputPixelType:"u8"})}_getWebGLParameters(){let{contrastOffset:e,brightnessOffset:t}=this.functionArguments;return{contrastOffset:e,brightnessOffset:t}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],tH.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:tW,json:{write:!0,name:"rasterFunctionArguments"}})],tH.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],tH.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],tH.prototype,"lookup",void 0);let tq=tH=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ContrastBrightnessFunction")],tH);function tJ(e,t,r,n,s){let i=Math.floor(n/2);for(let n=0;n<i;n++)for(let i=0;i<t;i++)e[n*t+i]=e[(s-1-n)*t+i],e[(r-1-n)*t+i]=e[(r-s+n)*t+i];let o=Math.floor(s/2);for(let n=0;n<r;n++){let r=n*t;for(let n=0;n<o;n++)e[r+n]=e[r+s-1-n],e[r+t-n-1]=e[r+t+n-s]}}let tK=new Map;function tX(e,t,r,n,s,i,o){let a=new Float32Array(t*r),l=i.length,u=o?0:n,p=o?n:0,c=o?1:t;for(let o=u;o<r-u;o++){let r=o*t;for(let o=p;o<t-p;o++){if(s&&!s[r+o])continue;let t=0;for(let s=0;s<l;s++)t+=e[r+o+(s-n)*c]*i[s];a[r+o]=t}}return a}tK.set(W.none,[0,0,0,0,1,0,0,0,0]),tK.set(W.lineDetectionHorizontal,[-1,-1,-1,2,2,2,-1,-1,-1]),tK.set(W.lineDetectionVertical,[-1,2,-1,-1,2,-1,-1,2,-1]),tK.set(W.lineDetectionLeftDiagonal,[2,-1,-1,-1,2,-1,-1,-1,2]),tK.set(W.lineDetectionRightDiagonal,[-1,-1,2,-1,2,-1,2,-1,-1]),tK.set(W.gradientNorth,[-1,-2,-1,0,0,0,1,2,1]),tK.set(W.gradientWest,[-1,0,1,-2,0,2,-1,0,1]),tK.set(W.gradientEast,[1,0,-1,2,0,-2,1,0,-1]),tK.set(W.gradientSouth,[1,2,1,0,0,0,-1,-2,-1]),tK.set(W.gradientNorthEast,[0,-1,-2,1,0,-1,2,1,0]),tK.set(W.gradientNorthWest,[-2,-1,0,-1,0,1,0,1,2]),tK.set(W.smoothArithmeticMean,[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111]),tK.set(W.smoothing3x3,[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625]),tK.set(W.smoothing5x5,[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1]),tK.set(W.sharpening3x3,[-1,-1,-1,-1,9,-1,-1,-1,-1]),tK.set(W.sharpening5x5,[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1]),tK.set(W.laplacian3x3,[0,-1,0,-1,4,-1,0,-1,0]),tK.set(W.laplacian5x5,[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0]),tK.set(W.sobelHorizontal,[-1,-2,-1,0,0,0,1,2,1]),tK.set(W.sobelVertical,[-1,0,1,-2,0,2,-1,0,1]),tK.set(W.sharpen,[0,-.25,0,-.25,2,-.25,0,-.25,0]),tK.set(W.sharpen2,[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25]),tK.set(W.pointSpread,[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627]);let tY=h=class extends G{constructor(){super(...arguments),this.rows=3,this.cols=3,this.kernel=[0,0,0,0,1,0,0,0,0]}set convolutionType(e){this._set("convolutionType",e);let t=tK.get(e);if(!t||e===W.userDefined||e===W.none)return;let r=Math.sqrt(t.length);this._set("kernel",t),this._set("cols",r),this._set("rows",r)}clone(){return new h({cols:this.cols,rows:this.rows,kernel:[...this.kernel],convolutionType:this.convolutionType,raster:(0,F.o8)(this.raster)})}};(0,k._)([(0,S.MZ)({json:{type:Number,write:!0}})],tY.prototype,"rows",void 0),(0,k._)([(0,S.MZ)({json:{type:Number,write:!0}})],tY.prototype,"cols",void 0),(0,k._)([(0,S.MZ)({json:{name:"type",type:Number,write:!0}})],tY.prototype,"convolutionType",null),(0,k._)([(0,S.MZ)({json:{type:[Number],write:!0}})],tY.prototype,"kernel",void 0);let tQ=tY=h=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ConvolutionFunctionArguments")],tY),t0=class extends V{constructor(){super(...arguments),this.functionName="Convolution",this.rasterArgumentNames=["raster"]}get _normalizedKernel(){let{kernel:e,convolutionType:t}=this.functionArguments,r=e.reduce((e,t)=>e+t);return -1===t||0===r||1===r?e:e.map(e=>e/r)}_bindSourceRasters(){let{convolutionType:e,rows:t,cols:r,kernel:n}=this.functionArguments;if(!Object.values(W).includes(e))return{success:!1,supportsGPU:!1,error:`convolution-function: the specified kernel type is not supported ${e}`};if(e!==W.none&&t*r!==n.length)return{success:!1,supportsGPU:!1,error:"convolution-function: the specified rows and cols do not match the length of the kernel"};let s=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(s.pixelType);let i=s.clone();i.pixelType=this.outputPixelType;let o=[W.none,W.sharpen,W.sharpen2,W.sharpening3x3,W.sharpening5x5];return -1!==e&&("u8"===this.outputPixelType||o.includes(e))||(i.statistics=null,i.histograms=null),i.colormap=null,i.attributeTable=null,this.rasterInfo=i,{success:!0,supportsGPU:n.length<=25}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t||this.functionArguments.convolutionType===W.none)return t;let{rows:r,cols:n}=this.functionArguments,{_normalizedKernel:s}=this;return function(e,t){let r=function(e){let t=Math.sqrt(e.length),r=e.slice(0,t),n=[1];for(let r=1;r<t;r++){let s=null;for(let n=0;n<t;n++){let i=e[n+r*t],o=e[n];if(null==s)if(0===o){if(i)return{separable:!1,row:null,col:null}}else s=i/o;else if(i/o!==s)return{separable:!1,row:null,col:null}}if(null==s)return{separable:!1,row:null,col:null};n.push(s)}return{separable:!0,row:r,col:n}}(t.kernel),n=!1!==t.mirrorEdges,s=r.separable?function(e,t,r,n=!0){let{pixels:s,width:i,height:o,pixelType:a,mask:l}=e,u=s.length,p=[],c=t.length,h=r.length,m=Math.floor(c/2),f=Math.floor(h/2);for(let e=0;e<u;e++){let a=tX(s[e],i,o,m,l,t,!0);a=tX(a,i,o,f,l,r,!1),n&&tJ(a,i,o,c,h),p.push(a)}return new O.A({width:i,height:o,pixelType:a,pixels:p,mask:l})}(e,r.row,r.col,n):function(e,t,r=!0){let{pixels:n,width:s,height:i,pixelType:o,mask:a}=e,l=n.length,u=[],{kernel:p,rows:c,cols:h}=t;for(let e=0;e<l;e++){let t=function(e,t,r,n,s,i,o){let a=new Float32Array(t*r),l=Math.floor(n/2),u=Math.floor(s/2);for(let p=l;p<r-l;p++){let r=p*t;for(let p=u;p<t-u;p++){if(i&&!i[r+p])continue;let c=0;for(let i=0;i<n;i++)for(let n=0;n<s;n++)c+=e[r+p+(i-l)*t+n-u]*o[i*s+n];a[r+p]=c}}return a}(n[e],s,i,c,h,a,p);r&&tJ(t,s,i,c,h),u.push(t)}return new O.A({width:s,height:i,pixelType:o,pixels:u,mask:a})}(e,t,n),{outputPixelType:i}=t;return i&&s.clamp(i),s}(t,{kernel:s,rows:r,cols:n,outputPixelType:this.outputPixelType})}_getWebGLParameters(){let e=new Float32Array(25);return e.set(this._normalizedKernel),{kernelRows:this.functionArguments.rows,kernelCols:this.functionArguments.cols,kernel:e,clampRange:(0,C.hP)(this.outputPixelType)}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],t0.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:tQ,json:{write:!0,name:"rasterFunctionArguments"}})],t0.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],t0.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)()],t0.prototype,"_normalizedKernel",null);let t1=t0=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ConvolutionFunction")],t0),t2=new e4.J({0:"standard",1:"planform",2:"profile"},{useNumericKeys:!0}),t5=m=class extends G{constructor(){super(...arguments),this.curvatureType="standard",this.zFactor=1}readCurvatureType(e,t){return t2.fromJSON(t.type??t.curvatureType??0)}clone(){return new m({curvatureType:this.curvatureType,zFactor:this.zFactor,raster:this.raster})}};(0,k._)([(0,S.MZ)({json:{write:{target:"type"}}}),(0,e3.e)(t2)],t5.prototype,"curvatureType",void 0),(0,k._)([(0,tg.w)("curvatureType",["type","curvatureType"])],t5.prototype,"readCurvatureType",null),(0,k._)([(0,S.MZ)({type:Number,json:{write:!0}})],t5.prototype,"zFactor",void 0);let t3=t5=m=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.CurvatureFunctionArguments")],t5),t4=class extends V{constructor(){super(...arguments),this.functionName="Curvature",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");let e=this.sourceRasterInfos[0].clone();return e.pixelType=this.outputPixelType,e.bandCount=1,this._removeStatsHistColormapVAT(e),this.rasterInfo=e,this.isGCS=e.spatialReference?.isGeographic??!1,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t)return null;let{zFactor:r,curvatureType:n}=this.functionArguments,{extent:s,primaryPixelSizes:i}=e,o=i?.[0]??(s?{x:s.width/t.width,y:s.height/t.height}:{x:1,y:1}),a=this.isGCS&&r>=1?r*e1.rk:r;return(0,e1.E0)(t,{zFactor:a,curvatureType:n,resolution:o})}_getWebGLParameters(){let{zFactor:e,curvatureType:t}=this.functionArguments;return{curvatureType:t,zFactor:this.isGCS&&e>=1?e*e1.rk:e}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],t4.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:t3,json:{write:!0,name:"rasterFunctionArguments"}})],t4.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],t4.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],t4.prototype,"isGCS",void 0);let t8=t4=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.CurvatureFunction")],t4),t7=f=class extends G{constructor(){super(...arguments),this.bandIds=[],this.bandNames=[],this.bandWavelengths=[],this.missingBandAction=e6.Wb.bestMatch}clone(){return new f({bandIds:this.bandIds?.slice(),bandNames:this.bandNames?.slice(),bandWavelengths:this.bandWavelengths?.slice(),missingBandAction:this.missingBandAction,method:this.method,wavelengthMatchTolerance:this.wavelengthMatchTolerance})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],t7.prototype,"bandIds",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],t7.prototype,"bandNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],t7.prototype,"bandWavelengths",void 0),(0,k._)([(0,e3.e)({0:"name",1:"wavelength",2:"id"})],t7.prototype,"method",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],t7.prototype,"missingBandAction",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],t7.prototype,"wavelengthMatchTolerance",void 0);let t6=t7=f=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ExtractBandFunctionArguments")],t7),t9=class extends V{constructor(){super(...arguments),this.functionName="ExtractBand",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){let{functionArguments:e,sourceRasterInfos:t}=this,r=t[0],{method:n,bandNames:s,bandWavelengths:i,bandIds:o,missingBandAction:a}=e,l=s?.length&&("name"===n||"id"!==n&&!o?.length),u=i?.length&&("wavelength"===n||"id"!==n&&!o?.length),p=a===e6.Wb.fail,c=l?function(e,t){let r=e.bandInfos.map(({name:e})=>e.toLowerCase()),n=[];for(let e=0;e<t.length;e++){let s=t[e].toLowerCase(),i=r.indexOf(s);if(-1===i&&"nearinfrared"===s&&-1===(i=r.findIndex(e=>e.startsWith("nearinfrared_1")))&&(i=r.findIndex(e=>e.startsWith("nearinfrared"))),-1===i)return null;n.push(i)}return n}(r,s):u?function(e,t,{wavelengthMatchTolerance:r},n){let{bandInfos:s}=e,i=[];for(let e=0;e<s.length;e++){let{minWavelength:t,maxWavelength:r}=s[e];if(!t||!r)return null;i.push({minWavelength:t,maxWavelength:r})}let o=[];for(let e=0;e<t.length;e++){let s=t[e],a=!1,l=-1,u=Number.MAX_VALUE;for(let e=0;e<i.length;e++){let t=i[e],r=s>=t.minWavelength&&s<=t.maxWavelength,n=Math.abs(s-(t.minWavelength+t.maxWavelength)/2);r?n<u&&(a=!0,l=e,u=n):!a&&n<u&&(l=e,u=n)}if(!a&&r&&u<r&&(a=!0),!a&&n)return null;o.push(l)}return o}(r,i,this.functionArguments,p):function(e,t,r){let{bandCount:n}=e;return!t?.length||r&&t.some(e=>e<0||e>=n)?null:t}(r,o,p);if(null==c)return{success:!1,supportsGPU:!1,error:`extract-band-function: Invalid ${l?"band names":u?"band wavelengths":"band ids"} for the imagery data source`};this.functionArguments.bandIds=c,this.functionArguments.method="id",this.outputPixelType=this._getOutputPixelType("f32");let h=r.clone();h.pixelType=this.outputPixelType,h.bandCount=c.length;let{statistics:m,histograms:f}=h;null!=m&&m.length&&(h.statistics=c.map(e=>m[e]||m[m.length-1])),null!=f&&f.length&&(h.histograms=c.map(e=>f[e]||f[f.length-1])),h.multidimensionalInfo&&h.multidimensionalInfo.variables.forEach(e=>{let{statistics:t,histograms:r}=e;null!=t&&t.length&&(e.statistics=c.map(e=>t[e]||t[t.length-1])),null!=r&&r.length&&(e.histograms=c.map(e=>r[e]||r[r.length-1]))});let d=h.keyProperties?.BandProperties;return d?.length&&(d=c.map(e=>e>=d.length?d[d.length-1]:d[e]),h.keyProperties={...h.keyProperties,BandProperties:d}),this.rasterInfo=h,{success:!0,supportsGPU:h.bandCount<=3}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t)return null;let r=t.pixels.length,n=this.functionArguments.bandIds.map(e=>e>=r?r-1:e);return t.extractBands(n)}_getWebGLParameters(){let e;if(this.isInputBandIdsSwizzled)e=this.swizzledBandSelection.length?this.swizzledBandSelection:[0,1,2];else{0===(e=[...this.functionArguments.bandIds]).length?e=[0,1,2]:e.length<3&&(e[1]=e[1]??e[0],e[2]=e[2]??e[1]);for(let t=0;t<3;t++)e[t]=Math.min(e[t],2)}return{bandIndexMat3:te(e)}}_getInputBandIds(e){let t=e.length;return this.functionArguments.bandIds.map(e=>e>=t?t-1:e).map(t=>e[t])}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],t9.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:t6,json:{write:!0,name:"rasterFunctionArguments"}})],t9.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],t9.prototype,"rasterArgumentNames",void 0);let re=t9=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ExtractBandFunction")],t9),rt=d=class extends G{clone(){return new d({conversionParameters:[...this.conversionParameters],raster:this.raster})}};(0,k._)([(0,S.MZ)({type:[Number],json:{write:!0}})],rt.prototype,"conversionParameters",void 0);let rr=rt=d=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.GrayscaleFunctionArguments")],rt),rn=class extends V{constructor(){super(...arguments),this.functionName="Grayscale",this.functionArguments=null,this.rasterArgumentNames=["raster"]}get _normalizedWeights(){let{conversionParameters:e}=this.functionArguments,t=e.reduce((e,t)=>e+t);return e.map(e=>e/t)}_bindSourceRasters(){let{conversionParameters:e}=this.functionArguments;if(!e?.length)return{success:!1,supportsGPU:!1,error:"missing valid conversion parameters."};let t=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType;let r=3===e.length||3===t.bandCount&&e.length>3;return t.bandCount=1,this._removeStatsHistColormapVAT(t),this.rasterInfo=t,{success:!0,supportsGPU:r}}_processPixels(e){let t=e.pixelBlocks?.[0];return null==t?null:function(e,t,r){let{pixels:n,width:s,height:i,mask:o,bandMasks:a}=e,l=a?.length?O.A.combineBandMasks(a):o,u=Math.min(t.length,n.length),p=r.startsWith("f"),c=!p&&r!==e.pixelType,[h,m]=(0,C.hP)(r),f=O.A.createEmptyBand(r,s*i);for(let e=0;e<i;e++){let r=e*s;for(let e=0;e<s;e++,r++)if(!l||l[r]){let e=0;for(let s=0;s<u;s++)e+=t[s]*n[s][r];p||(e=Math.round(e),c&&(e=e>m?m:e<h?h:e)),f[r]=e}}let d=new O.A({width:s,height:i,pixels:[f],pixelType:r,mask:l});return d.updateStatistics(),d}(t,this._normalizedWeights,this.outputPixelType)}_getWebGLParameters(){return{weights:this._normalizedWeights}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],rn.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rr,json:{write:!0,name:"rasterFunctionArguments"}})],rn.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],rn.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)()],rn.prototype,"_normalizedWeights",null);let rs=rn=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.GrayscaleFunction")],rn),ri=new e4.J({0:"traditional",1:"multi-directional"},{useNumericKeys:!0}),ro=new e4.J({1:"degree",2:"percent-rise",3:"scaled"},{useNumericKeys:!0}),ra=g=class extends G{constructor(){super(...arguments),this.altitude=45,this.azimuth=315,this.hillshadeType="traditional",this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.slopeType="degree",this.zFactor=1,this.removeEdgeEffect=!1}clone(){return new g({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,slopeType:this.slopeType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,removeEdgeEffect:this.removeEdgeEffect,raster:this.raster})}};(0,k._)([(0,S.MZ)({type:Number,json:{write:!0}})],ra.prototype,"altitude",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{write:!0}})],ra.prototype,"azimuth",void 0),(0,k._)([(0,S.MZ)(),(0,e3.e)(ri)],ra.prototype,"hillshadeType",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{write:!0,name:"psPower"}})],ra.prototype,"pixelSizePower",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{write:!0,name:"psZFactor"}})],ra.prototype,"pixelSizeFactor",void 0),(0,k._)([(0,S.MZ)(),(0,e3.e)(ro)],ra.prototype,"slopeType",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{write:!0}})],ra.prototype,"zFactor",void 0),(0,k._)([(0,S.MZ)({type:Boolean,json:{write:!0}})],ra.prototype,"removeEdgeEffect",void 0);let rl=ra=g=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.HillshadeFunctionArguments")],ra),ru=class extends V{constructor(){super(...arguments),this.functionName="Hillshade",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){let e=this.sourceRasterInfos[0];if(e.bandCount>1)return{success:!1,supportsGPU:!1,error:"hillshade-function: source data must be single band"};this.outputPixelType=this._getOutputPixelType("u8");let t=e.clone();return this._removeStatsHistColormapVAT(t),t.pixelType=this.outputPixelType,t.bandCount=1,t.statistics=[{min:0,max:255,avg:60,stddev:10}],this.rasterInfo=t,this.isGCS=t.spatialReference?.isGeographic??!1,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];if(!t)return null;let{extent:r,primaryPixelSizes:n}=e,s=n?.[0]??(r?{x:r.width/t.width,y:r.height/t.height}:{x:1,y:1}),i=(0,e1.PP)(this.functionArguments,s,this.isGCS),o=(0,e1.fw)(t,i);return o.pixelType=this.outputPixelType,o}_getWebGLParameters(){let e=(0,e1.PP)(this.functionArguments,{x:1,y:1},this.isGCS),t=(0,e1.ng)(e),{slopeType:r,zFactor:n,pixelSizeFactor:s,pixelSizePower:i}=this.functionArguments,o="scaled"===r,a=(0,C.zw)(this.outputPixelType);return{...t,zFactor:n,gcsFactor:this.isGCS?e1.rk:1,pixelSizeFactor:o?s:0,pixelSizePower:o?i:0,isOutputRounded:a}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],ru.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rl,json:{write:!0,name:"rasterFunctionArguments"}})],ru.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],ru.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],ru.prototype,"isGCS",void 0);let rp=ru=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.HillshadeFunction")],ru),rc=y=class extends G{constructor(){super(...arguments),this.rasters=[],this.processAsMultiband=!0}writeRasters(e,t){t.rasters=e.map(e=>"number"==typeof e||"string"==typeof e?e:e.toJSON())}clone(){return new y({operation:this.operation,processAsMultiband:this.processAsMultiband,rasters:(0,F.o8)(this.rasters)})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],rc.prototype,"operation",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rc.prototype,"rasters",void 0),(0,k._)([(0,tI.K)("rasters")],rc.prototype,"writeRasters",null),(0,k._)([(0,S.MZ)({json:{write:!0}})],rc.prototype,"processAsMultiband",void 0);let rh=rc=y=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.LocalFunctionArguments")],rc),rm=class extends V{constructor(){super(...arguments),this.functionName="Local",this.functionArguments=null,this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){let{sourceRasterInfos:e}=this,t=e[0],{bandCount:r}=t,{processAsMultiband:n}=this.functionArguments;if(e.some(e=>e.bandCount!==r))return{success:!1,supportsGPU:!1,error:"local-function: input rasters do not have same band count"};let{operation:s,rasters:i}=this.functionArguments,o=X[s];if(!(999===o||i.length===o||i.length<=1&&1===o))return{success:!1,supportsGPU:!1,error:`local-function: the length of functionArguments.rasters does not match operation's requirement: ${o}`};let a=t.clone();return a.bandCount=999!==o||n?r:1,this._removeStatsHistColormapVAT(a),this._updateStatistics(a),this._updatePixelType(a),this.rasterInfo=a,{success:!0,supportsGPU:1===a.bandCount&&o<=3}}_processPixels(e){let{pixelBlocks:t}=e;return null==t||t.some(e=>null==e)?null:eK(t,this.functionArguments.operation,{processAsMultiband:this.functionArguments.processAsMultiband,outputPixelType:this.outputPixelType??void 0})}_getWebGLParameters(){let{operation:e}=this.functionArguments,t=X[e],r=Object.keys(J).find(t=>J[t]===e)?.toLowerCase()??"undefined",n=this.outputPixelType??"f32",[s,i]=(0,C.hP)(n),o=(0,C.zw)(n);return o&&(s-=1e-4,i+=1e-4),{imageCount:t,operationName:r,domainRange:[s,i],isOutputRounded:o}}_updateStatistics(e){let t=this.sourceRasterInfos[0],{operation:r}=this.functionArguments,n=K.get(r)?.domain;if(n){e.statistics=[];for(let t=0;t<e.bandCount;t++)e.statistics[t]={min:n[0],max:n[1],avg:(n[0]+n[1])/2,stddev:(n[0]+n[1])/10}}else 45===r&&t.statistics?.length&&(e.statistics=t.statistics.map(e=>({min:-e.max,max:-e.min,avg:null!=e.avg?-e.avg:void 0,stddev:null!=e.stddev?-e.stddev:void 0})))}_updatePixelType(e){let{statistics:t,pixelType:r}=this.sourceRasterInfos[0],{operation:n}=this.functionArguments,{domain:s,isInteger:i}=K.get(n)??{domain:null,isInteger:!1},o="f32";if(s&&i)o=(0,C.X1)(s[0],s[1]);else if(30===n){let e=t?.[0];o=e?(0,C.X1)(e.min,e.max):(0,C.zw)(r)?r:"s32"}else if(45===n&&(0,C.zw)(r)){let e=t?.map(({max:e})=>-e),n=t?.map(({min:e})=>-e),s=e?.length?Math.min(...e):null,i=n?.length?Math.min(...n):null;o=null!=s&&null!=i?(0,C.X1)(s,i):r.startsWith("s")?r.replace("s","u"):"u1"===r||"u2"===r||"u4"===r?"s8":"u8"===r?"s16":"s32"}e.pixelType=this.outputPixelType=this._getOutputPixelType(o)}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],rm.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rh,json:{write:!0,name:"rasterFunctionArguments"}})],rm.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],rm.prototype,"rasterArgumentNames",void 0);let rf=rm=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.LocalFunction")],rm);var rd=r(20538);let rg=x=class extends G{constructor(){super(...arguments),this.includedRanges=null,this.noDataValues=null,this.noDataInterpretation=e6.IB.matchAny}get normalizedNoDataValues(){let{noDataValues:e}=this;if(!e?.length)return null;let t=!1,r=e.map(e=>{if("number"==typeof e)return t=!0,[e];if("string"==typeof e){let r=e.trim().split(" ").filter(e=>""!==e.trim()).map(e=>Number(e));return t=t||r.length>0,0===r.length?null:r}return null});return t?r:null}clone(){return new x({includedRanges:this.includedRanges?.slice()??[],noDataValues:this.noDataValues?.slice()??[],noDataInterpretation:this.noDataInterpretation})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],rg.prototype,"includedRanges",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rg.prototype,"noDataValues",void 0),(0,k._)([(0,S.MZ)()],rg.prototype,"normalizedNoDataValues",null),(0,k._)([(0,S.MZ)({json:{write:!0}})],rg.prototype,"noDataInterpretation",void 0);let ry=rg=x=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.MaskFunctionArguments")],rg),rx=class extends V{constructor(){super(...arguments),this.functionName="Mask",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){let e=this.sourceRasterInfos[0].clone(),{pixelType:t}=e;this.outputPixelType=this._getOutputPixelType(t),e.pixelType=this.outputPixelType,this.rasterInfo=e;let{includedRanges:r,normalizedNoDataValues:n}=this.functionArguments;if(!r?.length&&!n?.length)return{success:!1,supportsGPU:!1,error:"missing includedRanges or noDataValues argument"};let s=[];for(let i=0;i<e.bandCount;i++){let e=(0,e6.Wt)(t,r?.slice(2*i,2*i+2),n?.[i]);if(null==e){s=null;break}s.push(e)}this.lookups=s;let i=null!=n&&n.every(e=>e?.length===n[0]?.length);return{success:!0,supportsGPU:(!r||r.length<=2*e6.et)&&(!n||i&&n[0].length<=e6.et)}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t)return null;let{outputPixelType:r,lookups:n}=this,{includedRanges:s,noDataInterpretation:i,normalizedNoDataValues:o}=this.functionArguments,a=i===e6.IB.matchAll;return(0,e6.dK)(t,{includedRanges:s,noDataValues:o,outputPixelType:r,matchAll:a,lookups:n})}_getWebGLParameters(){let{includedRanges:e,normalizedNoDataValues:t}=this.functionArguments,r=new Float32Array(e6.et);r.fill(rd.pq),t?.[0]?.length&&r.set(t[0]);let n=new Float32Array(e6.et);for(let t=0;t<n.length;t+=2)n[t]=e?.[t]??-rd.pq,n[t+1]=e?.[t+1]??rd.pq;return e?.length&&n.set(e),{bandCount:this.sourceRasterInfos[0].bandCount,noDataValues:r,includedRanges:n}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],rx.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:ry,json:{write:!0,name:"rasterFunctionArguments"}})],rx.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],rx.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rx.prototype,"lookups",void 0);let rw=rx=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.MaskFunction")],rx),rA=w=class extends G{constructor(){super(...arguments),this.visibleBandID=0,this.infraredBandID=1,this.scientificOutput=!1}clone(){let{visibleBandID:e,infraredBandID:t,scientificOutput:r}=this;return new w({visibleBandID:e,infraredBandID:t,scientificOutput:r})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],rA.prototype,"visibleBandID",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rA.prototype,"infraredBandID",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rA.prototype,"scientificOutput",void 0);let rb=rA=w=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.NDVIFunctionArguments")],rA),r_=class extends V{constructor(){super(...arguments),this.functionName="NDVI",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){let{scientificOutput:e,visibleBandID:t,infraredBandID:r}=this.functionArguments;this.outputPixelType=this._getOutputPixelType(e?"f32":"u8");let n=this.sourceRasterInfos[0],s=Math.max(t,r);if(n.bandCount<2||s>=n.bandCount)return{success:!1,supportsGPU:!1,error:"ndvi-function: source raster has insufficient amount of raster bands"};if(t<0||r<0)return{success:!1,supportsGPU:!1,error:"ndvi-function: invalid visible or infrared band id"};let i=n.clone();i.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(i),i.bandCount=1,i.keyProperties={...i.keyProperties,BandProperties:void 0};let[o,a,l,u]=e?[-1,1,0,.1]:[0,200,100,10];return i.statistics=[{min:o,max:a,avg:l,stddev:u}],this.rasterInfo=i,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t)return null;let{visibleBandID:r,infraredBandID:n,scientificOutput:s}=this.functionArguments;return function(e,t,r,n){let{mask:s,pixels:i,width:o,height:a}=e,l=i[r],u=i[t],p=u.length,c=n?new Uint8Array(p):new Float32Array(p),h=n?100:1,m=100.5*!!n;for(let e=0;e<p;e++)if(null==s||s[e]){let t=l[e],r=u[e],n=t+r;n&&(c[e]=(t-r)/n*h+m)}let f=new O.A({width:o,height:a,mask:s,pixelType:n?"u8":"f32",pixels:[c]});return f.updateStatistics(),f}(t,r,n,!s)}_getWebGLParameters(){let{visibleBandID:e,infraredBandID:t,scientificOutput:r}=this.functionArguments;return{bandIndexMat3:te(this.isInputBandIdsSwizzled?[0,1,2]:[t,e,0]),scaled:!r}}_getInputBandIds(e){let{visibleBandID:t,infraredBandID:r}=this.functionArguments;return[r,t,0].map(t=>e[t])}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],r_.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rb,json:{write:!0,name:"rasterFunctionArguments"}})],r_.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],r_.prototype,"rasterArgumentNames",void 0);let rv=r_=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.NDVIFunction")],r_),rM=A=class extends G{constructor(){super(...arguments),this.inputRanges=null,this.outputValues=null,this.noDataRanges=null,this.allowUnmatched=!1,this.isLastInputRangeInclusive=!1}clone(){return new A({inputRanges:[...this.inputRanges],outputValues:[...this.outputValues],noDataRanges:[...this.noDataRanges],allowUnmatched:this.allowUnmatched,isLastInputRangeInclusive:this.isLastInputRangeInclusive})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],rM.prototype,"inputRanges",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rM.prototype,"outputValues",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rM.prototype,"noDataRanges",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rM.prototype,"allowUnmatched",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rM.prototype,"isLastInputRangeInclusive",void 0);let rP=rM=A=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.RemapFunctionArguments")],rM),rT=class extends V{constructor(){super(...arguments),this.functionName="Remap",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null}_bindSourceRasters(){let e=this.sourceRasterInfos[0].clone(),{pixelType:t}=e;this.outputPixelType=this._getOutputPixelType(t),e.pixelType=this.outputPixelType,e.bandCount=1;let{statistics:r}=e;this._removeStatsHistColormapVAT(e);let{allowUnmatched:n,outputValues:s,inputRanges:i,noDataRanges:o,isLastInputRangeInclusive:a}=this.functionArguments;if(null!=r&&r.length&&s?.length)if(n){let t=Math.min.apply(null,[...s,r[0].min]),n=Math.max.apply(null,[...s,r[0].max]);e.statistics=[{...r[0],min:t,max:n}]}else{let t=s[0],n=t;for(let e=0;e<s.length;e++)t=t>s[e]?s[e]:t,n=n>s[e]?n:s[e];e.statistics=[{...r[0],min:t,max:n}]}return this.rasterInfo=e,this.lookup=n?null:(0,e6.XU)({srcPixelType:t,inputRanges:i,outputValues:s,noDataRanges:o,allowUnmatched:n,isLastInputRangeInclusive:a,outputPixelType:this.outputPixelType}),{success:!0,supportsGPU:(!s||s.length<=e6.et)&&(!o||o.length<=e6.et)}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t)return null;let{lookup:r,outputPixelType:n}=this;if(r){let e=(0,e6.eH)(t,{lut:[r.lut],offset:r.offset,outputPixelType:n});return null!=e&&r.mask&&(e.mask=(0,e6.UK)(t.pixels[0],t.mask,r.mask,r.offset,"u8")),e}let{inputRanges:s,outputValues:i,noDataRanges:o,allowUnmatched:a,isLastInputRangeInclusive:l}=this.functionArguments;return(0,e6.Ew)(t,{inputRanges:s,outputValues:i,noDataRanges:o,outputPixelType:n,allowUnmatched:a,isLastInputRangeInclusive:l})}_getWebGLParameters(){let{allowUnmatched:e,noDataRanges:t,isLastInputRangeInclusive:r}=this.functionArguments,n=new Float32Array(3*e6.et),s=this.functionArguments.inputRanges??[],i=this.functionArguments.outputValues??[],o=i.length;for(let e=0;e<e6.et;e++)n[3*e]=s[2*e]??rd.pq-1,n[3*e+1]=s[2*e+1]??rd.pq,n[3*e+2]=i[e]??0,e<o&&(e>0&&(n[3*e]-=1e-5),(e<o-1||!r)&&(n[3*e+1]-=1e-5));let a=new Float32Array(2*e6.et);return a.fill(rd.pq),t?.length&&a.set(t),{allowUnmatched:e,rangeMaps:n,noDataRanges:a,clampRange:(0,C.hP)(this.outputPixelType)}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],rT.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rP,json:{write:!0,name:"rasterFunctionArguments"}})],rT.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],rT.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rT.prototype,"lookup",void 0);let rR=rT=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.RemapFunction")],rT),rN=b=class extends rl{readColorRamp(e){if("string"==typeof e){let t=ty.kH.jsonValues.find(t=>t.toLowerCase()===e.toLowerCase());return t?(0,ty.M5)(ty.kH.fromJSON(t)):null}return"toJSON"in e?e.toJSON():e}clone(){return new b({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,slopeType:this.slopeType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,removeEdgeEffect:this.removeEdgeEffect,colorRamp:this.colorRamp,colormap:this.colormap,raster:this.raster})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],rN.prototype,"colorRamp",void 0),(0,k._)([(0,tg.w)("colorRamp")],rN.prototype,"readColorRamp",null),(0,k._)([(0,S.MZ)({type:[[Number]],json:{write:!0}})],rN.prototype,"colormap",void 0);let rF=rN=b=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ShadedReliefFunctionArguments")],rN),rk=class extends V{constructor(){super(...arguments),this.functionName="ShadedRelief",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){let e=this.sourceRasterInfos[0];if(e.bandCount>1)return{success:!1,supportsGPU:!1,error:"shadedrelief-function: source data must be single band"};let{colorRamp:t,colormap:r}=this.functionArguments;if(!t&&!r?.length)return{success:!1,supportsGPU:!1,error:"shadedrelief-function: a color ramp argument must be specified"};this.outputPixelType=this._getOutputPixelType("u8");let n=e.clone();this._removeStatsHistColormapVAT(n),n.pixelType=this.outputPixelType,n.bandCount=3,n.statistics=[{min:0,max:255,avg:60,stddev:10},{min:0,max:255,avg:60,stddev:10},{min:0,max:255,avg:60,stddev:10}],this.rasterInfo=n,this.isGCS=n.spatialReference?.isGeographic??!1,r?.length||(r=(0,ty.R8)(t,{interpolateAlpha:!0}));let{indexedColormap:s,offset:i}=(0,e6.zg)({colormap:r});if(!s?.length)return{success:!1,supportsGPU:!1,error:"shadedrelief-function: a valid colorramp is required"};let o=(0,ty.S2)(s);return this.lookup={indexedColormap:s,offset:i,hsvMap:o},{success:!0,supportsGPU:(0,tF.WN)(s)}}_processPixels(e){let t=e.pixelBlocks?.[0];if(!t||!this.lookup)return null;let r=e.primaryPixelSizes?.[0];if(null==r){let{extent:n}=e;r=n?{x:n.width/t.width,y:n.height/t.height}:{x:1,y:1}}let n=(0,e1.PP)(this.functionArguments,r,this.isGCS),s=(0,e1.fw)(t,n),i=this.sourceRasterInfos[0].statistics?.[0]??{min:0,max:8e3};return(0,e1.SC)(s,t,this.lookup.hsvMap,i),s.pixelType=this.outputPixelType,s}_getWebGLParameters(){let e=(0,e1.PP)(this.functionArguments,{x:1,y:1},this.isGCS),t=(0,e1.ng)(e),{slopeType:r,zFactor:n,pixelSizeFactor:s,pixelSizePower:i}=this.functionArguments,o="scaled"===r,{indexedColormap:a,offset:l}=this.lookup,u=this.sourceRasterInfos[0].statistics?.[0],p=(0,C.zw)(this.outputPixelType);return{...t,indexedColormap:a,offset:l,zFactor:n,gcsFactor:this.isGCS?e1.rk:1,pixelSizeFactor:o?s:0,pixelSizePower:o?i:0,minValue:u?.min??0,maxValue:u?.max??8e3,isOutputRounded:p}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],rk.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rF,json:{write:!0,name:"rasterFunctionArguments"}})],rk.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],rk.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rk.prototype,"isGCS",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rk.prototype,"lookup",void 0);let rS=rk=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.ShadedReliefFunction")],rk),rI=new e4.J({1:"degree",2:"percent-rise",3:"adjusted"},{useNumericKeys:!0}),rC=_=class extends G{constructor(){super(...arguments),this.slopeType="degree",this.zFactor=1,this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.removeEdgeEffect=!1}clone(){return new _({slopeType:this.slopeType,zFactor:this.zFactor,pixelSizePower:this.pixelSizePower,pixelSizeFactor:this.pixelSizeFactor,removeEdgeEffect:this.removeEdgeEffect,raster:this.raster})}};(0,k._)([(0,e3.e)(rI)],rC.prototype,"slopeType",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{write:!0}})],rC.prototype,"zFactor",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{name:"psPower",write:!0}})],rC.prototype,"pixelSizePower",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{name:"psZFactor",write:!0}})],rC.prototype,"pixelSizeFactor",void 0),(0,k._)([(0,S.MZ)({type:Boolean,json:{write:!0}})],rC.prototype,"removeEdgeEffect",void 0);let rj=rC=_=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.SlopeFunctionArguments")],rC),rB=class extends V{constructor(){super(...arguments),this.functionName="Slope",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");let e=this.sourceRasterInfos[0].clone();return e.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(e),e.statistics="percent-rise"!==this.functionArguments.slopeType?[{min:0,max:90,avg:1,stddev:1}]:null,e.bandCount=1,this.rasterInfo=e,this.isGCS=e.spatialReference?.isGeographic??!1,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t)return null;let{zFactor:r,slopeType:n,pixelSizePower:s,pixelSizeFactor:i}=this.functionArguments,{isGCS:o}=this,{extent:a,primaryPixelSizes:l}=e,u=l?.[0]??(a?{x:a.width/t.width,y:a.height/t.height}:{x:1,y:1});return(0,e1.yy)(t,{zFactor:r,slopeType:n,pixelSizePower:s,pixelSizeFactor:i,isGCS:o,resolution:u})}_getWebGLParameters(){let{zFactor:e,slopeType:t,pixelSizeFactor:r,pixelSizePower:n}=this.functionArguments;return{zFactor:this.isGCS&&e>=1?e*e1.rk:e,slopeType:t,pixelSizeFactor:r??0,pixelSizePower:n??0,isOutputRounded:(0,C.zw)(this.outputPixelType)}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],rB.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rj,json:{write:!0,name:"rasterFunctionArguments"}})],rB.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],rB.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rB.prototype,"isGCS",void 0);let rG=rB=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.SlopeFunction")],rB),rZ=new e4.J({1:"min",2:"max",3:"mean",4:"stddev",5:"median",6:"majority",7:"minority"},{useNumericKeys:!0}),rz=v=class extends G{constructor(){super(...arguments),this.rows=3,this.cols=3,this.fillNoDataOnly=!1,this.statisticsType="min"}clone(){return new v({rows:this.rows,cols:this.cols,fillNoDataOnly:this.fillNoDataOnly,statisticsType:this.statisticsType,raster:(0,F.o8)(this.raster)})}};(0,k._)([(0,S.MZ)({json:{write:!0,read:{source:["kernelRows","rows"],reader:(e,t)=>Number(e??t?.kernelRows??3)}}})],rz.prototype,"rows",void 0),(0,k._)([(0,S.MZ)({json:{write:!0,read:{source:["kernelCols","cols"],reader:(e,t)=>Number(e??t?.kernelCols??3)}}})],rz.prototype,"cols",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rz.prototype,"fillNoDataOnly",void 0),(0,k._)([(0,S.MZ)({json:{read:{source:["statisticsType","type"],reader:(e,t)=>rZ.fromJSON(t?.statisticsType??t?.type)??"min"},write:{target:"type"}}}),(0,e3.e)(rZ)],rz.prototype,"statisticsType",void 0);let rE=rz=v=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.StatisticsFunctionArguments")],rz),rO=class extends V{constructor(){super(...arguments),this.functionName="Statistics",this.rasterArgumentNames=["raster"]}_bindSourceRasters(){let{type:e}=this.functionArguments.toJSON();if(e<1||e>7)return{success:!1,supportsGPU:!1,error:`statistics-function: the given statistics type is not supported ${e}`};let t=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(t.pixelType);let r=t.clone();r.pixelType=this.outputPixelType;let{statisticsType:n}=this.functionArguments;return"stddev"===n&&this._removeStatsHistColormapVAT(r),this.rasterInfo=r,{success:!0,supportsGPU:r.bandCount<=3&&e<5}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t)return t;let{statisticsType:r,rows:n,cols:s,fillNoDataOnly:i}=this.functionArguments;return function(e,t){let{mask:r}=e,{fillNoDataOnly:n}=t;if(n&&!r)return e;let{pixels:s,width:i,height:o,bandMasks:a,pixelType:l}=e,u=s.length,p=i*o,c=[],{kernelRows:h,kernelCols:m,statisticsType:f,mirrorEdges:d}=t;if(n&&!r)return e;let g=t.outputPixelType??l,y=[];for(let e=0;e<u;e++){let l=s[e],u=O.A.createEmptyBand(g,p);n&&u.set(l);let x=a?.[e]??r,w=x?.slice()??null,A={band:l,width:i,height:o,mask:w,outBand:u};switch(f){case"min":case"max":!function(e,t){let{fillNoDataOnly:r}=t,{band:n,width:s,height:i,mask:o,outBand:a}=e;if(r&&!o)return a.set(n);let{kernelRows:l,kernelCols:u,statisticsType:p}=t,c=Math.floor(l/2),h=Math.floor(u/2),m="min"===p,f=a.slice(),d=new Uint32Array(s*i);for(let e=c;e<i-c;e++){let t=e*s;for(let e=h;e<s-h;e++){let r=m?Number.MAX_VALUE:-Number.MAX_VALUE,i=0;for(let a=0;a<l;a++)for(let l=0;l<u;l++){let u=t+e+(a-c)*s+l-h;o&&!o[u]||(r=m?Math.min(r,n[u]):Math.max(r,n[u]),i++)}o?(f[t+e]=0===i?0:r,d[t+e]=i):a[t+e]=0===i?0:r}}if(o)for(let e=c;e<i-c;e++){let t=e*s;for(let e=h;e<s-h;e++)if(d[t+e]){if(r&&o[t+e])continue;a[t+e]=f[t+e],o[t+e]=255}}}(A,t);break;case"mean":case"stddev":!function(e,t){let{fillNoDataOnly:r}=t,{band:n,width:s,height:i,mask:o,outBand:a}=e;if(r&&!o)return a.set(n);let{statisticsType:l,kernelRows:u,kernelCols:p}=t,c="stddev"===l,h=s*i,m=new Float64Array(h),f=new Float64Array(h),d=new Uint32Array(h);for(let e=0;e<i;e++){let t=e*s,r=0,i=0,a=0;for(let e=0;e<p;e++)o&&!o[t+e]||(r+=n[t+e],c&&(i+=n[t+e]**2),a++);m[t]=r,f[t]=i,d[t]=a;for(let e=1;e<=s-p;e++){let s=t+e-1,l=s+p;o?(o[s]&&(a--,r-=n[s],c&&(i-=n[s]**2)),o[l]&&(a++,r+=n[l],c&&(i+=n[l]**2))):(r-=n[s],r+=n[l],c&&(i-=n[s]**2,i+=n[l]**2)),m[t+e]=r,d[t+e]=a,c&&(f[t+e]=i)}}let g=new Float64Array(h),y=new Float64Array(h),x=new Uint32Array(h),w=u*s;for(let e=0;e<=s-p;e++){let t=0,r=0,n=0;for(let i=0;i<u;i++){let o=i*s+e;t+=m[o],n+=d[o],c&&(r+=f[o])}g[e]=t,y[e]=r,x[e]=n;for(let o=1;o<=i-u;o++){let i=(o-1)*s+e,a=i+w;t-=m[i],t+=m[a],n-=d[i],n+=d[a],c&&(r-=f[i],r+=f[a]),g[o*s+e]=t,y[o*s+e]=r,x[o*s+e]=n}}let A=Math.floor(u/2),b=Math.floor(p/2);for(let e=A;e<i-A;e++){let t=e*s;for(let n=b;n<s-b;n++){let i=(e-A)*s+n-b,l=x[i];if(0===l||r&&(!o||o[t+n]))continue;let u=g[i]/l,p=c?Math.sqrt((y[i]-g[i]*u)/l):u;a[t+n]=p,o&&(o[t+n]=255)}}}(A,t);break;case"median":!function(e,t){let{fillNoDataOnly:r}=t,{band:n,width:s,height:i,mask:o,outBand:a}=e;if(r&&!o)return a.set(n);let{kernelRows:l,kernelCols:u}=t,p=Math.floor(l/2),c=Math.floor(u/2),h=a.slice(),m=new Uint32Array(s*i);for(let e=p;e<i-p;e++){let t=e*s;for(let e=c;e<s-c;e++){if(r&&o?.[t+e])continue;let i=[];for(let r=0;r<l;r++)for(let a=0;a<u;a++){let l=t+e+(r-p)*s+a-c;o&&!o[l]||i.push(n[l])}i.length&&(i.sort((e,t)=>e-t),o?(h[t+e]=i[Math.floor((i.length-1)/2)],m[t+e]=i.length):a[t+e]=i[Math.floor((i.length-1)/2)])}}if(o)for(let e=p;e<i-p;e++){let t=e*s;for(let e=c;e<s-c;e++)if(m[t+e]){if(r&&o[t+e])continue;a[t+e]=h[t+e],o[t+e]=255}}}(A,t);break;case"majority":case"minority":!function(e,t){let{fillNoDataOnly:r}=t,{band:n,width:s,height:i,mask:o,outBand:a}=e;if(r&&!o)return a.set(n);let{kernelRows:l,kernelCols:u}=t,p=Math.floor(l/2),c=Math.floor(u/2),h="majority"===t.statisticsType,m=l*u,f=a.slice(),d=new Uint32Array(s*i);for(let e=p;e<i-p;e++){let t=e*s;for(let e=c;e<s-c;e++){if(r&&o?.[t+e])continue;let i=new Map;for(let r=0;r<l;r++)for(let a=0;a<u;a++){let l=t+e+(r-p)*s+a-c;if(o&&!o[l])continue;let u=n[l];i.set(u,i.has(u)?i.get(u)+1:1)}if(0===i.size)continue;let g=0,y=0,x=h?0:m+1;for(let e of i.keys())h===(y=i.get(e))>x&&(x=y,g=e);o?(f[t+e]=g,d[t+e]=i.size):a[t+e]=g}}if(o)for(let e=p;e<i-p;e++){let t=e*s;for(let e=c;e<s-c;e++)if(d[t+e]){if(r&&o[t+e])continue;a[t+e]=f[t+e],o[t+e]=255}}}(A,t)}d&&!n&&tJ(u,i,o,h,m),c.push(u),w&&y.push(w)}let x=y[0]??r;y.length!==u&&(y.length=0),u>1&&a?.length&&(x=O.A.combineBandMasks(a));let w=new O.A({pixelType:g,width:i,height:o,pixels:c,bandMasks:a&&y.length?y:null,mask:x});return w.updateStatistics(),w}(t,{kernelRows:n,kernelCols:s,fillNoDataOnly:i,outputPixelType:this.outputPixelType,statisticsType:r,mirrorEdges:!0})}_getWebGLParameters(){let{rows:e,cols:t,statisticsType:r,fillNoDataOnly:n}=this.functionArguments;return{fillNoDataOnly:n,kernelRows:e,kernelCols:t,statisticsType:r,clampRange:(0,C.hP)(this.outputPixelType)}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],rO.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rE,json:{write:!0,name:"rasterFunctionArguments"}})],rO.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],rO.prototype,"rasterArgumentNames",void 0);let rD=rO=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.StatisticsFunction")],rO),rU=M=class extends G{constructor(){super(...arguments),this.statistics=null,this.histograms=null}readStatistics(e,t){if(!e?.length)return null;let r=[];return e.forEach(e=>{let t={min:e.min,max:e.max,avg:e.avg??e.mean,stddev:e.stddev??e.standardDeviation};r.push(t)}),r}writeStatistics(e,t,r){if(!e?.length)return;let n=[];e.forEach(e=>{let t={...e,mean:e.avg,standardDeviation:e.stddev};delete t.avg,delete t.stddev,n.push(t)}),t[r]=n}clone(){return new M({statistics:(0,F.o8)(this.statistics),histograms:(0,F.o8)(this.histograms)})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],rU.prototype,"statistics",void 0),(0,k._)([(0,tg.w)("statistics")],rU.prototype,"readStatistics",null),(0,k._)([(0,tI.K)("statistics")],rU.prototype,"writeStatistics",null),(0,k._)([(0,S.MZ)({json:{write:!0}})],rU.prototype,"histograms",void 0);let rL=rU=M=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.StatisticsHistogramFunctionArguments")],rU),rV=class extends V{constructor(){super(...arguments),this.functionName="StatisticsHistogram",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){let e=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType("u8");let t=e.clone(),{statistics:r,histograms:n}=this.functionArguments;return n&&(t.histograms=n),r&&(t.statistics=r),this.rasterInfo=t,{success:!0,supportsGPU:!0}}_processPixels(e){return e.pixelBlocks?.[0]}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],rV.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rL,json:{write:!0,name:"rasterFunctionArguments"}})],rV.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],rV.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rV.prototype,"indexedColormap",void 0),(0,k._)([(0,S.MZ)()],rV.prototype,"isNoopProcess",void 0);let rW=rV=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.StatisticsHistogramFunction")],rV),r$=new e4.J({0:"none",3:"standard-deviation",4:"histogram-equalization",5:"min-max",6:"percent-clip",9:"sigmoid"},{useNumericKeys:!0}),rH=P=class extends G{constructor(){super(...arguments),this.computeGamma=!1,this.dynamicRangeAdjustment=!1,this.gamma=[],this.histograms=null,this.statistics=null,this.stretchType="none",this.useGamma=!1}writeStatistics(e,t,r){e?.length&&(Array.isArray(e[0])||(e=e.map(e=>[e.min,e.max,e.avg,e.stddev])),t[r]=e)}clone(){return new P({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:(0,F.o8)(this.statistics),gamma:(0,F.o8)(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,histograms:(0,F.o8)(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment,raster:this.raster})}};(0,k._)([(0,S.MZ)({type:Boolean,json:{write:!0}})],rH.prototype,"computeGamma",void 0),(0,k._)([(0,S.MZ)({type:Boolean,json:{name:"dra",write:!0}})],rH.prototype,"dynamicRangeAdjustment",void 0),(0,k._)([(0,S.MZ)({type:[Number],json:{write:!0}})],rH.prototype,"gamma",void 0),(0,k._)([(0,S.MZ)()],rH.prototype,"histograms",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{write:!0}})],rH.prototype,"maxPercent",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{write:!0}})],rH.prototype,"minPercent",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{write:!0}})],rH.prototype,"numberOfStandardDeviations",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{name:"max",write:!0}})],rH.prototype,"outputMax",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{name:"min",write:!0}})],rH.prototype,"outputMin",void 0),(0,k._)([(0,S.MZ)({type:Number,json:{write:!0}})],rH.prototype,"sigmoidStrengthLevel",void 0),(0,k._)([(0,S.MZ)({json:{type:[[Number]],write:!0}})],rH.prototype,"statistics",void 0),(0,k._)([(0,tI.K)("statistics")],rH.prototype,"writeStatistics",null),(0,k._)([(0,e3.e)(r$)],rH.prototype,"stretchType",void 0),(0,k._)([(0,S.MZ)({type:Boolean,json:{write:!0}})],rH.prototype,"useGamma",void 0);let rq=rH=P=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.StretchFunctionArguments")],rH),rJ=class extends V{constructor(){super(...arguments),this.functionName="Stretch",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null,this.cutOffs=null}_bindSourceRasters(){this.lookup=null,this.cutOffs=null;let e=this.sourceRasterInfos[0],{pixelType:t}=e,{functionArguments:r}=this,{dynamicRangeAdjustment:n,gamma:s,useGamma:i}=r;if(!n&&["u8","u16","s8","s16"].includes(t)){let n=(0,t$.DP)(r.toJSON(),{rasterInfo:e}),o=(0,C.zw)(this.outputPixelType)?"round":"float";this.lookup=(0,t$.RP)({pixelType:t,...n,gamma:i?s:null,rounding:o}),this.cutOffs=n}else n||(this.cutOffs=(0,t$.DP)(r.toJSON(),{rasterInfo:e}));this.outputPixelType=this._getOutputPixelType(t);let o=e.clone();o.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(o),"u8"===this.outputPixelType&&(o.keyProperties.DataType="processed");let{outputMin:a=0,outputMax:l=255}=this.functionArguments;o.statistics=[];for(let e=0;e<o.bandCount;e++)o.statistics[e]={min:a,max:l};return this.rasterInfo=o,{success:!0,supportsGPU:!n}}_processPixels(e){let t=e.pixelBlocks?.[0];if(null==t)return t;let{lookup:r}=this;if(r)return(0,e6.eH)(t,{...r,outputPixelType:this.rasterInfo.pixelType});let{functionArguments:n}=this,s=this.cutOffs||(0,t$.DP)(n.toJSON(),{rasterInfo:this.sourceRasterInfos[0],pixelBlock:t}),i=n.useGamma?n.gamma:null;return(0,t$._N)(t,{...s,gamma:i,outputPixelType:this.outputPixelType})}_getWebGLParameters(){let{outputMin:e=0,outputMax:t=255,gamma:r,useGamma:n}=this.functionArguments,s=this.rasterInfo.bandCount>=2?3:1,i=n&&r?.length?(0,t$.Nh)(s,r):[1,1,1],{minCutOff:o,maxCutOff:a}=this.cutOffs??{minCutOff:[0,0,0],maxCutOff:[255,255,255]};1===o.length&&(o[1]=o[2]=o[0],a[1]=a[2]=a[0]);let l=a.map((r,n)=>(t-e)/(a[n]-o[n])),u=(0,C.zw)(this.outputPixelType),p=n&&r?[r[0],r[1]??r[0],r[2]??r[0]]:[1,1,1],c=n?[i[0],i[1]??i[0],i[2]??i[0]]:[1,1,1];return{bandCount:s,minOutput:e,maxOutput:t,minCutOff:o,maxCutOff:a,factor:l,useGamma:n,gamma:p,gammaCorrection:c,stretchType:this.functionArguments.stretchType,isOutputRounded:u,type:"stretch"}}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],rJ.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rq,json:{write:!0,name:"rasterFunctionArguments"}})],rJ.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],rJ.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rJ.prototype,"lookup",void 0),(0,k._)([(0,S.MZ)({json:{write:!0}})],rJ.prototype,"cutOffs",void 0);let rK=rJ=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.StretchFunction")],rJ),rX=T=class extends G{constructor(){super(...arguments),this.attributeTableAsRecordSet=null}clone(){return new T({attributeTableAsRecordSet:(0,F.o8)(this.attributeTableAsRecordSet)})}};(0,k._)([(0,S.MZ)({json:{write:!0}})],rX.prototype,"attributeTableAsRecordSet",void 0);let rY=rX=T=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.TableFunctionArguments")],rX),rQ=class extends V{constructor(){super(...arguments),this.functionName="Table",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){let e=this.sourceRasterInfos[0];if(e.bandCount>1||e.pixelType.startsWith("f"))return{success:!1,supportsGPU:!1,error:"table-function: Source data must be single band and integer pixel type."};let{attributeTableAsRecordSet:t}=this.functionArguments;if(!t)return{success:!1,supportsGPU:!1,error:"table-function: Missing attributeTableAsRecordSet argument."};this.outputPixelType=this._getOutputPixelType(e.pixelType);let r=e.clone();return r.pixelType=this.outputPixelType,r.bandCount=1,"thematic"!==r.dataType&&(r.keyProperties=r.keyProperties?{...r.keyProperties,DataType:"thematic"}:{DataType:"thematic"}),this.rasterInfo=r,{success:!0,supportsGPU:!0}}_processPixels(e){return e.pixelBlocks?.[0]}};(0,k._)([(0,S.MZ)({json:{write:!0,name:"rasterFunction"}})],rQ.prototype,"functionName",void 0),(0,k._)([(0,S.MZ)({type:rY,json:{write:!0,name:"rasterFunctionArguments"}})],rQ.prototype,"functionArguments",void 0),(0,k._)([(0,S.MZ)()],rQ.prototype,"rasterArgumentNames",void 0),(0,k._)([(0,S.MZ)()],rQ.prototype,"isNoopProcess",void 0);let r0=rQ=(0,k._)([(0,I.$)("esri.layers.support.rasterFunctions.TableFunction")],rQ),r1=new Map;function r2(e,t){if(t=t??{},"function"in(e=(0,F.o8)(e))&&"arguments"in e&&e.arguments){let r=function e(t,r,n){n&&function e(t,r){if(t&&r)for(let n in t){let s=t[n];s&&"object"==typeof s&&"type"in s&&("RasterFunctionTemplate"===s.type?e(s.arguments,r):"RasterFunctionVariable"===s.type&&null!=r[s.name]&&(s.value=r[s.name]))}}(t,n);let s={renderingRule:{},templates:r};return function t(r,n){var s,i,o,a;if(!r||!n.renderingRule)return;let{renderingRule:l,templates:u}=n,{function:p,arguments:c,_object_id:h}=r;if(!p||!c)return;null!=h&&u.set(h,l),l.rasterFunction=p.type.replace("Function",""),l.outputPixelType=p.pixelType;let m={};for(let r in l.rasterFunctionArguments=m,c){if("type"===r||"object_id"===r||"_object_ref_id"===r)continue;let n=c[r];n&&"object"==typeof n&&"type"in n&&("RasterFunctionTemplate"===n.type||"RasterFunctionVariable"===n.type)?("RasterFunctionVariable"===n.type?m[r]=function t(r,n){if(!r||"object"!=typeof r)return r;let{value:s}=r;if(!s||"object"!=typeof s)return r.isDataset?"$$":s;if(Array.isArray(s))return 0===s.length?[]:s.map(e=>"object"==typeof e&&"RasterFunctionVariable"===e.type?t(e,n):e);if("value"in s&&["number","string","boolean"].includes(typeof s.value))return s.value;if(r.isDataset&&"Scalar"!==s.type)return"$$";if(!("type"in s))return s;let i=s;switch(s.type){case"Scalar":i=s.value;break;case"AlgorithmicColorRamp":i=r3(s);break;case"MultiPartColorRamp":i={type:"multipart",colorRamps:s.ArrayOfColorRamp.map(r3)};break;case"ArgumentArray":if(s.elements?.length&&"RasterStatistics"!==s.elements[0].type){let r=[];for(let i=0;i<s.elements.length;i++){let o=s.elements[i],{type:a}=o;if(a)if("RasterFunctionTemplate"===a){let{renderingRule:t}=e(o,n);r.push(t),null!=o._object_id&&n.set(o._object_id,t)}else{if("RasterFunctionVariable"!==a)throw new N.A("raster-function-helper","unsupported raster function json.");{let e=t(o,n);r.push(e),null!=o._object_id&&n.set(o._object_id,e)}}else r.push(o)}i=r}else i=s.elements}return null!=s._object_id&&n.set(s._object_id,i),i}(n,u):(l.rasterFunctionArguments[r]={},t(n,{renderingRule:l.rasterFunctionArguments[r],templates:u})),null!=n._object_id&&u.set(n._object_id,m[r])):m[r]=n}switch(m.DEM&&!m.Raster&&(m.Raster=m.DEM,delete m.DEM),l.rasterFunction){case"Stretch":s=m,s.Statistics?.length&&"object"==typeof s.Statistics&&(s.Statistics=s.Statistics.map(e=>[e.min,e.max,e.mean,e.standardDeviation])),null!=s.NumberOfStandardDeviation&&(s.NumberOfStandardDeviations=s.NumberOfStandardDeviation,delete s.NumberOfStandardDeviation);break;case"Colormap":i=m,"randomcolorramp"===i.ColorRamp?.type?.toLowerCase()&&(delete i.ColorRamp,i.ColormapName="Random"),0===i.ColorSchemeType&&delete i.ColorRamp;break;case"Convolution":null!=(o=m).ConvolutionType&&(o.Type=o.ConvolutionType,delete o.ConvolutionType);break;case"Mask":a=m,a.NoDataValues?.length&&"string"==typeof a.NoDataValues[0]&&(a.NoDataValues=a.NoDataValues.filter(e=>""!==e).map(e=>Number(e)))}}(t,s),s}(e,new Map,t);if(function e(t){let{renderingRule:r,templates:n}=t;if("object"!=typeof r||!r?.rasterFunctionArguments||!n.size)return;let{rasterFunctionArguments:s}=r;for(let t in s){let r=s[t],i="_object_ref_id"===t?r:r&&"object"==typeof r&&"_object_ref_id"in r?r._object_ref_id:null;if(null==i)r&&"object"==typeof r&&(r.rasterFunctionArguments&&e({renderingRule:r,templates:n}),Array.isArray(r)&&r.forEach((t,s)=>{if("object"==typeof t)if(null!=t._object_ref_id){if(!n.has(t._object_ref_id))throw new N.A("raster-function-helper",`unsupported raster function json. _object_ref_id: ${r} does not exist`);let e=n.get(i);e&&"object"==typeof e?Object.assign(t,e):r[s]=e}else e({renderingRule:t,templates:n})}));else{if(!n.has(i))throw new N.A("raster-function-helper",`unsupported raster function json. _object_ref_id: ${i} does not exist`);let e=n.get(i);"_object_ref_id"!==t?s[t]=e:e&&"object"==typeof e&&Object.assign(s,e)}}}(r),!r.renderingRule)throw new N.A("raster-function-helper","Unsupported raster function json.");e=r.renderingRule}if("rasterFunction"in e)return function e(t,r){let{rasterFunction:n,rasterFunctionArguments:s}=t,i=t.outputPixelType?.toLowerCase();if(null==n||!r1.has(n))throw new N.A("raster-function-helper",`unsupported raster function: ${n}`);let o=r1.get(n),a=("function"==typeof o.ctor?o.ctor:o.ctor.default).fromJSON({...t,outputPixelType:i}),{rasterArgumentNames:l}=a,u=[],p="rasters"===l[0]&&Array.isArray(s.rasters)?s.rasters:l.map(e=>s[e]),c="rasters"===l[0]||l.length>1,h=[];for(let t=0;t<p.length;t++){let n,s=p[t];null==s||"string"==typeof s&&s.startsWith("$")?u.push(r?.raster):"string"==typeof s?r[s]&&u.push(r[s]):"number"!=typeof s&&"rasterFunction"in s&&(n=e(s,r),c||(a.functionArguments[l[t]]=n),u.push(n)),c&&h.push(n??s)}if(c&&("rasters"===l[0]?a.functionArguments.rasters=h:l.forEach((e,t)=>{a.functionArguments[e]=h[t]})),r){a.sourceRasters=u;let e=r.raster?.url;e&&(a.mainPrimaryRasterId=e)}return a}(e=function e(t){let{rasterFunction:r,rasterFunctionArguments:n}=t,s={};for(let t in n){let r=n[t],i=t.toLowerCase();if("rasters"===i&&Array.isArray(r))s.rasters=r.map(t=>r5(t)?e(t):t);else switch(r5(r)&&(r=e(r)),i){case"dra":s.dra=r;break;case"pspower":s.psPower=r;break;case"pszfactor":s.psZFactor=r;break;case"bandids":s.bandIds=r;break;default:s[t[0].toLowerCase()+t.slice(1)]=r}}return"Local"!==r||s.rasters?.length||(s.rasters=["$$"]),{...t,rasterFunctionArguments:s}}(e),t);throw new N.A("raster-function-helper","unsupported raster function json.")}function r5(e){return!!(e&&"object"==typeof e&&e.rasterFunction&&e.rasterFunctionArguments)}function r3(e){let t=e.algorithm??"esriHSVAlgorithm",{FromColor:r,ToColor:n}=e;if(!Array.isArray(r)){let{r:e,g:t,b:n}=(0,R.$)({h:r.Hue,s:r.Saturation,v:r.Value});r=[e,t,n,r.AlphaValue]}if(!Array.isArray(n)){let{r:e,g:t,b:r}=(0,R.$)({h:n.Hue,s:n.Saturation,v:n.Value});n=[e,t,r,n.AlphaValue]}return{type:"algorithmic",algorithm:t,fromColor:r,toColor:n}}r1.set("Arithmetic",{desc:"Arithmetic Function",ctor:eY,rasterArgumentNames:["rasters"]}),r1.set("Aspect",{desc:"Aspect Function",ctor:e5,rasterArgumentNames:["raster"]}),r1.set("BandArithmetic",{desc:"Band Arithmetic Function",ctor:to,rasterArgumentNames:["raster"]}),r1.set("Colormap",{desc:"Colormap Function",ctor:tP,rasterArgumentNames:["raster"]}),r1.set("ColormapToRGB",{desc:"ColormapToRGB Function",ctor:tS,rasterArgumentNames:["raster"]}),r1.set("CompositeBand",{desc:"CompositeBand Function",ctor:tG,rasterArgumentNames:["rasters"]}),r1.set("ComputeChange",{desc:"ComputeChange Function",ctor:tL,rasterArgumentNames:["rasters"]}),r1.set("Convolution",{desc:"Convolution Function",ctor:t1,rasterArgumentNames:["raster"]}),r1.set("ContrastBrightness",{desc:"Contrast Brightness Function",ctor:tq,rasterArgumentNames:["raster"]}),r1.set("ExtractBand",{desc:"ExtractBand Function",ctor:re,rasterArgumentNames:["raster"]}),r1.set("Curvature",{desc:"Curvature Function",ctor:t8,rasterArgumentNames:["raster"]}),r1.set("Hillshade",{desc:"Hillshade Function",ctor:rp,rasterArgumentNames:["raster"]}),r1.set("ShadedRelief",{desc:"ShadedRelief Function",ctor:rS,rasterArgumentNames:["raster"]}),r1.set("Grayscale",{desc:"Grayscale Function",ctor:rs,rasterArgumentNames:["raster"]}),r1.set("Clip",{desc:"Clip Function",ctor:td,rasterArgumentNames:["raster"]}),r1.set("Local",{desc:"Local Function",ctor:rf,rasterArgumentNames:["rasters"]}),r1.set("Mask",{desc:"Mask Function",ctor:rw,rasterArgumentNames:["raster"]}),r1.set("NDVI",{desc:"NDVI Function",ctor:rv,rasterArgumentNames:["raster"]}),r1.set("Remap",{desc:"Remap Function",ctor:rR,rasterArgumentNames:["raster"]}),r1.set("Slope",{desc:"Slope Function",ctor:rG,rasterArgumentNames:["raster"]}),r1.set("Statistics",{desc:"Focal Statistics Function",ctor:rD,rasterArgumentNames:["raster"]}),r1.set("StatisticsHistogram",{desc:"Statistics Histogram Function",ctor:rW,rasterArgumentNames:["raster"]}),r1.set("Stretch",{desc:"Stretch Function",ctor:rK,rasterArgumentNames:["raster"]}),r1.set("Table",{desc:"Attribute Table Function",ctor:r0,rasterArgumentNames:["raster"]})},34455:(e,t,r)=>{r.d(t,{DO:()=>U,FT:()=>z,Hh:()=>b,OM:()=>D,OO:()=>R,Ps:()=>$,Wo:()=>v,_I:()=>F,_l:()=>B,dK:()=>J,eh:()=>q,l0:()=>L,t$:()=>H,uk:()=>G,vI:()=>_,xh:()=>f});var n,s=r(31461),i=r(32391),o=r(8922),a=r(61414),l=r(54143),u=r(39960),p=r(87960),c=r(65111),h=r(91463),m=r(71760);function f(e,t,r){return!(0,c.canProjectWithoutEngine)(e,t,r)}function d(e,t,r){let n=f(e,t,r);if(n&&!(0,c.isLoaded)())throw new i.A("rasterprojectionhelper-project","projection engine is not loaded");return n}!function(e){e[e.None=0]="None",e[e.North=1]="North",e[e.South=2]="South",e[e.Both=3]="Both"}(n||(n={}));let g=(e,t,r,n=0)=>{if(1===r[0])return[0,0];let s=1,i=-1,o=1,a=-1;for(let t=0;t<e.length;t+=2)isNaN(e[t])||(s=s>e[t]?e[t]:s,i=i>e[t]?i:e[t],o=o>e[t+1]?e[t+1]:o,a=a>e[t+1]?a:e[t+1]);let{cols:l,rows:u}=t,p=(i-s)/l/r[0],c=(a-o)/u/r[1],h=2*n,m=0,f=!1,d=[0,0];for(let t=0;t<l-3;t++){for(let r=0;r<u-3;r++){let n=t*u*2+2*r,s=(e[n]+e[n+4]+e[n+4*u]+e[n+4*u+4])/4,i=(e[n+1]+e[n+5]+e[n+4*u+1]+e[n+4*u+5])/4,o=Math.abs((s-e[n+2*u+2])/p),a=Math.abs((i-e[n+2*u+3])/c);if(o+a>m&&(m=o+a,d=[o,a]),h&&m>h){f=!0;break}}if(f)break}return d},y={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},x=new Map,w=new Map,A=null;async function b(){A&&(0,c.isLoaded)()||((0,c.isLoaded)()||await (0,c.load)(),A=await Promise.all([r.e(472),r.e(5927)]).then(r.bind(r,40636)))}function _(e,t,r){return d(e.spatialReference,t),r?(0,c.getTransformation)(t,e.spatialReference,e):(0,c.getTransformation)(e.spatialReference,t,e)}function v(e,t,r,n=null){let s=e.spatialReference;if(!s||!t||s.equals(t))return e;d(s,t,n);let i=r.center,o=new a.A({xmin:i.x-e.x/2,xmax:i.x+e.x/2,ymin:i.y-e.y/2,ymax:i.y+e.y/2,spatialReference:s}),l=(0,c.project)(o,t,n),u=z(t);return null==l||null!=u&&l.width>=u?M(e,s,t):{x:l.width,y:l.height}}function M(e,t,r){let n=(0,o.GA)(t)/(0,o.GA)(r);return{x:e.x*n,y:e.y*n}}function P(e,t,r){let{spatialReference:n}=r;if(!n||!t||n.equals(t))return e;if(n.isGeographic&&t.isGeographic)return M(e,n,t);if(d(n,t),!A)throw new i.A("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:s,y:a}=e,l=(s+a)/2*(0,o.GA)(n),u=1;l>30&&(s*=u=30/l,a*=u);let h=256*s/2,m=256*a/2,{x:f,y:g}=r.center,y=[];for(let e=0;e<=256;e++)y.push([f-h,g-m+e*a]);for(let e=1;e<=256;e++)y.push([f-h+e*s,g+m]);for(let e=1;e<=256;e++)y.push([f+h,g+m-e*a]);for(let e=1;e<256;e++)y.push([f+h-e*s,g-m]);y.push(y[0]);let x=new p.A({rings:[y],spatialReference:n}),w=(0,c.project)(x,t);if(!w)return M(e,n,t);let b=w.extent,_=z(t);if(null==b||null!=_&&b.width>=_)return M(e,n,t);let v=Math.sqrt(A.planarArea(w)/(s*a*65536))/u,P={x:b.width/u/256,y:b.height/u/256},T={x:s*v,y:a*v},R=P.x*P.y;return Math.abs(R-T.x*T.y)/R<.1?P:T}function T(e,t){return("number"==typeof e?e:(e.x+e.y)/2)*(0,o.GA)(t)*3779.5199999999995}function R(e,t){let{pixelSize:r,extent:n}=e;return T(P(r,t,n),t)}function N(e,t=.01){return(0,o.GA)(e)?t/(0,o.GA)(e):0}function F(e,t,r=null,n=!0){let s=e.spatialReference;if(s.equals(t))return e;d(s,t,r);let i=(0,c.project)(e,t,r);return n&&i&&k([e],[i],s,t),i}function k(e,t,r,n){let s=E(r,!0),i=E(n,!0),o=N(r,500),a=N(n,500);if(o&&null!=s&&null!=i)for(let r=0;r<e.length;r++){let n=t[r];if(!n)continue;let{x:l}=e[r],{x:u}=n;u>=i[1]-a&&Math.abs(l-s[0])<o?n.x-=i[1]-i[0]:u<=i[0]+a&&Math.abs(l-s[1])<o&&(n.x+=i[1]-i[0])}}function S(e,t=!1){let r=e.wkid||e.wkt2||e.wkt;if(!r||e.isGeographic)return null;if(r=String(r),x.has(r)){let e=x.get(r);return t?e?.gcs:e?.pcs}let n=e.wkid?l.P.coordsys(e.wkid):l.P.fromString(e.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt),s=I(n,N(e,1e-4)),i=I(n,0,!0);return x.set(r,{pcs:s,gcs:i}),t?i:s}function I(e,t=0,r=!1){let n=l.j.generate(e),s=r?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!n||!s?.length)return null;let i=!1,o=s.find(e=>1===e.getInclusive()&&1===e.getKind());if(!o){if(!(o=s.find(e=>1===e.getInclusive()&&0===e.getKind())))return null;i=!0}let a=r?0:2===n.getNorthPoleLocation()|2*(2===n.getSouthPoleLocation()),u=n.isPannableRectangle(),p=o.getCoord();if(i)return{isEnvelope:i,isPannable:u,vertices:p,coef:null,bbox:[p[0][0]-t,p[0][1]-t,p[1][0]+t,p[1][1]+t],poleLocation:a};let c=0,h=[],[m,f]=p[0],[d,g]=p[0];for(let e=0,t=p.length;e<t;e++){++c===t&&(c=0);let[r,n]=p[e],[s,i]=p[c];if(i===n)h.push([r,s,n,i,2]);else{let e=(s-r)/(i-n||1e-4),t=r-e*n;n<i?h.push([e,t,n,i,0]):h.push([e,t,i,n,1])}m=m<r?m:r,f=f<n?f:n,d=d>r?d:r,g=g>n?g:n}return{isEnvelope:!1,isPannable:u,vertices:p,coef:h,bbox:[m,f,d,g],poleLocation:a}}function C(e,t){let r=[],{cols:n,rows:s,xres:i,yres:o,usePixelCenter:a}=e,{xmin:l,ymax:u}=e;if(a&&(l+=i/2,u-=o/2),null==t){for(let e=0;e<n;e++)for(let t=0;t<s;t++)r.push([l+i*e,u-o*t]);return{points:r}}let p=new Uint8Array(n*s);if(t.isEnvelope){let{bbox:[e,a,c,h]}=t;for(let m=0,f=0;m<n;m++){let n=l+i*m,d=t.isPannable||n>=e&&n<=c;for(let e=0;e<s;e++,f++){let t=u-o*e;d&&t>=a&&t<=h&&(r.push([n,t]),p[f]=1)}}return{points:r,mask:p}}let c=t.coef,h=[];for(let e=0;e<s;e++){let t=u-o*e,r=[],n=[];for(let e=0;e<c.length;e++){let[s,i,o,a,l]=c[e];if(t===o&&o===a)r.push(s),r.push(i),n.push(2),n.push(2);else if(t>=o&&t<=a){let e=s*t+i;r.push(e),n.push(l)}}let s=r;if(r.length>2){let e=2===n[0]?0:n[0],t=r[0];s=[];for(let i=1;i<n.length;i++)2===n[i]&&i!==n.length-1||(n[i]!==e&&(s.push(0===e?Math.min(t,r[i-1]):Math.max(t,r[i-1])),e=n[i],t=r[i]),i===n.length-1&&s.push(0===n[i]?Math.min(t,r[i]):Math.max(t,r[i])));s.sort((e,t)=>e-t)}else r[0]>r[1]&&(s=[r[1],r[0]]);h.push(s)}for(let e=0,t=0;e<n;e++){let n=l+i*e;for(let e=0;e<s;e++,t++){let s=u-o*e,i=h[e];if(2===i.length)n>=i[0]&&n<=i[1]&&(r.push([n,s]),p[t]=1);else if(i.length>2){let e=!1;for(let t=0;t<i.length;t+=2)if(n>=i[t]&&n<=i[t+1]){e=!0;break}e&&(r.push([n,s]),p[t]=1)}}}return{points:r,mask:p}}function j(e,t){let r=z(e[0].spatialReference);if(e.length<2||null==r||(t=t??N(e[0].spatialReference),1===(e=e.filter(e=>e.width>t)).length))return e[0];let{xmin:n,xmax:s,ymin:i,ymax:o}=e[0];for(let t=1;t<e.length;t++){let n=e[t];s=n.xmax+r*t,i=Math.min(i,n.ymin),o=Math.max(o,n.ymax)}return new a.A({xmin:n,xmax:s,ymin:i,ymax:o,spatialReference:e[0].spatialReference})}function B(e,t,r=null,i=!0){let o=e.spatialReference;if(o.equals(t))return e;let l=D(e),u=z(o,!0),h=z(t);if(0===l||null==u||null==h){let s=Z(e,t,r,i);if(null==u&&null!=h&&Math.abs(s.width-h)<N(t)&&(0,c.isLoaded)()){let r=S(o);if(null!=r&&r.poleLocation===n.None&&e.width<(r.bbox[2]-r.bbox[0])/2)return function(e,t){let r=z(t);if(null==r)return null;let{xmin:n,ymin:s,xmax:i,ymax:o}=e,l=e.spatialReference,u=new p.A({spatialReference:l,rings:[[[n,s],[i,s],[i,o],[n,o],[n,s]]]}),h=(0,c.project)(u,t);if(2!==h.rings.length||!h.rings[0].length||!h.rings[1].length)return null;let{rings:m}=h,f=N(l),d=new a.A({spatialReference:t});for(let e=0;e<2;e++){n=i=m[e][0][0],s=o=m[e][0][1];for(let t=0;t<m[e].length;t++)n=n>m[e][t][0]?m[e][t][0]:n,i=i<m[e][t][0]?m[e][t][0]:i,s=s>m[e][t][1]?m[e][t][1]:s,o=o<m[e][t][1]?m[e][t][1]:o;if(0===e)d.ymin=s,d.ymax=o,d.xmin=n,d.xmax=i;else if(d.ymin=Math.min(d.ymin,s),d.ymax=Math.max(d.ymax,o),Math.abs(i-r/2)<f)d.xmin=n,d.xmax=d.xmax+r;else{if(!(Math.abs(n+r/2)<f))return null;d.xmax=i+r}}return d}(e,t)||s}return s}let m=e.clone().normalize();if(1===m.length&&e.xmax<u&&e.xmax-u/2>N(o)){let{xmin:t,xmax:r}=e;for(let n=0;n<=l;n++){let s=0===n?t:-u/2,i=n===l?r-u*n:u/2;m[n]=new a.A({xmin:s,xmax:i,ymin:e.ymin,ymax:e.ymax,spatialReference:o})}}return j(m.map(e=>Z(e,t,r,i)).filter(s.Ru))}function G(e,t,r){if("extent"===e.type){let{xmin:t,ymin:r,xmax:n,ymax:s,spatialReference:i}=e;e=new p.A({rings:[[[t,s],[n,s],[n,r],[t,r],[t,s]]],spatialReference:i})}return e.spatialReference.equals(t)?e:(d(e.spatialReference,t,r),(0,c.project)(e,t,r))}function Z(e,t,r=null,n=!0,s=!0){let i=e.spatialReference;if(i.equals(t)||!t)return e;d(i,t,r);let o=(0,c.project)(e,t,r);if(s&&t.isWebMercator&&o&&(o.ymax=Math.min(20037508.342787,o.ymax),o.ymin=Math.max(-20037508.342787,o.ymin),o.ymin>=o.ymax))return null;if(!n||!o)return o;let a=E(i,!0),l=E(t,!0);if(null==a||null==l)return o;let p=N(i,.001),h=N(i,500),m=N(t,.001);if(Math.abs(o.xmin-l[0])<m&&Math.abs(o.xmax-l[1])<m){let n=Math.abs(e.xmin-a[0]),s=Math.abs(a[1]-e.xmax);if(n<p&&s>h){o.xmin=l[0];let n=[];n.push(new u.A(e.xmax,e.ymin,i)),n.push(new u.A(e.xmax,(e.ymin+e.ymax)/2,i)),n.push(new u.A(e.xmax,e.ymax,i));let s=n.map(e=>F(e,t,r)).filter(e=>!isNaN(e?.x)).map(e=>e.x);o.xmax=Math.max.apply(null,s)}if(s<p&&n>h){o.xmax=l[1];let n=[];n.push(new u.A(e.xmin,e.ymin,i)),n.push(new u.A(e.xmin,(e.ymin+e.ymax)/2,i)),n.push(new u.A(e.xmin,e.ymax,i));let s=n.map(e=>F(e,t,r)).filter(e=>!isNaN(e?.x)).map(e=>e.x);o.xmin=Math.min.apply(null,s)}}else{let e=N(t,.001);Math.abs(o.xmin-l[0])<e&&(o.xmin=l[0]),Math.abs(o.xmax-l[1])<e&&(o.xmax=l[1])}return o}function z(e,t=!1){return e?e.isWebMercator?2*(t?20037508.342787:20037508.342788905):e.wkid&&e.isGeographic?360:2*y[e.wkid]||null:null}function E(e,t=!1){if(e.isGeographic)return[-180,180];let r=z(e,t);return null!=r?[-r/2,r/2]:null}function O(e,t,r,n){let s=(e-t)/r;return s-Math.floor(s)!=0?s=Math.floor(s):n&&(s-=1),s}function D(e,t=!1){let r=z(e.spatialReference);if(null==r)return 0;let n=t?0:-(r/2),s=N(e.spatialReference),i=!t&&Math.abs(e.xmax-r/2)<s?r/2:e.xmax,o=!t&&Math.abs(e.xmin+r/2)<s?-r/2:e.xmin;return O(i,n,r,!0)-O(o,n,r,!1)}function U(e){let t=e.storageInfo.origin.x,r=z(e.spatialReference,!0);if(null==r)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};let n=r/2,{nativePixelSize:s,storageInfo:i,extent:o}=e,{maximumPyramidLevel:a,blockWidth:l,pyramidScalingFactor:u}=i,p=s.x,c=[],h=null!=e.transform&&"gcs-shift"===e.transform.type,m=t+(h?0:n),f=h?r-t:n-t;for(let e=0;e<=a;e++){let e=(o.xmax-t)/p/l,r=e-Math.floor(e)==0?e:Math.ceil(e),n=f/p/l,s=n-Math.floor(n)==0?n:Math.ceil(n),i=Math.floor(m/p/l),a=Math.round(m/p)%l,h=(l-Math.round(f/p)%l)%l;c.push({resolutionX:p,blockWidth:l,datasetColumnCount:r,worldColumnCountFromOrigin:s,leftMargin:a,rightPadding:h,originColumnOffset:i}),p*=u}return{originX:t,halfWorldWidth:n,pyramidsInfo:c,hasGCSSShiftTransform:h}}function L(e){let t=e.isAdaptive&&null==e.spacing,r=e.spacing||[32,32],n=V(e),s={cols:n.size[0]+1,rows:n.size[1]+1},i=n.outofBoundPointCount>0&&n.outofBoundPointCount<n.offsets.length/2,o=n.outofBoundPointCount===n.offsets.length/2||t&&i?[0,0]:g(n.offsets,s,r,4),a=(o[0]+o[1])/2,u=e.projectedExtent.spatialReference,p=e.srcBufferExtent.spatialReference;if(t&&(i||a>4)&&(f(u,p,e.datumTransformation)&&(u.isGeographic||S(u)),r=[4,4],s={cols:(n=V({...e,spacing:r})).size[0]+1,rows:n.size[1]+1},o=g(n.offsets,s,r,4)),n.error=o,r[0]>1&&(n.coefficients=W(n.offsets,s,i)),e.includeGCSGrid&&!u.isGeographic&&!u.isWebMercator)if(p.isGeographic)n.gcsGrid={offsets:n.offsets,coefficients:n.coefficients,spacing:r};else{let t=S(u);if(null!=t&&!t.isEnvelope){let t=function(e){let t;if(!e||e.isGeographic)return e;let r=String(e.wkid||e.wkt2||e.wkt);return w.has(r)?t=w.get(r):(t=(e.wkid?l.P.coordsys(e.wkid):l.P.fromString(l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),w.set(r,t)),new h.A({wkid:t})}(u),o=B(e.projectedExtent,t),{offsets:a}=V({...e,srcBufferExtent:o,spacing:r}),p=W(a,s,i);n.gcsGrid={offsets:a,coefficients:p,spacing:r}}}return n}function V(e){let{projectedExtent:t,srcBufferExtent:r,pixelSize:n,datumTransformation:s,rasterTransform:i}=e,o=t.spatialReference,a=r.spatialReference,p=d(o,a),{xmin:h,ymin:m,xmax:f,ymax:g}=t,y=z(a),x=null!=y&&(e.hasWrapAround||"gcs-shift"===i?.type),w=e.spacing||[32,32],A=w[0]*n.x,b=w[1]*n.y,_=1===w[0],v=Math.ceil((f-h)/A-.1/w[0])+ +!_,M=Math.ceil((g-m)/b-.1/w[1])+ +!_,P=function(e){let{inSR:t,outSR:r,datumTransformation:n,preferPE:s}=e;if(t.equals(r)){let{points:t}=C(e,null);return t}if(t.isWebMercator&&r.isWGS84||t.isWGS84&&r.isWebMercator)return function(e){let{cols:t,rows:r,xres:n,yres:s,usePixelCenter:i,inSR:o,outSR:a}=e,{xmin:l,ymax:p}=e;i&&(l+=n/2,p-=s/2);let h=[],m=[],f=Math.max(t,r);for(let e=0;e<f;e++){let i=l+n*Math.min(t,e),f=p-s*Math.min(r,e),d=(0,c.project)(new u.A({x:i,y:f,spatialReference:o}),a);e<=t&&h.push(d.x),e<=r&&m.push(d.y)}let d=[];for(let e=0;e<t;e++)for(let t=0;t<r;t++)d.push([h[e],m[t]]);return d}(e);if(d(t,r,n)&&s&&(t.isGeographic||null!=S(t)))return function(e){let{inSR:t,outSR:r,datumTransformation:n}=e,{points:s,mask:i}=C(e,S(t));if(!t.isGeographic){let e=t.wkid?l.P.coordsys(t.wkid):l.P.fromString(t.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,t.wkt2||t.wkt);l.g.projToGeog(e,s.length,s)}if(null!=n&&n.steps.length){let e;if(r.isGeographic&&(e=s.map(([e])=>e>179.9955?1:e<-179.9955?-1:0)),n.steps.forEach(e=>{let t=e.wkid?l.P.geogtran(e.wkid):l.P.fromString(l.a.PE_TYPE_GEOGTRAN,e.wkt);l.h.geogToGeog(t,s.length,s,null,e.isInverse?l.a.PE_TRANSFORM_2_TO_1:l.a.PE_TRANSFORM_1_TO_2)}),e)for(let t=0;t<s.length;t++){let r=e[t],n=s[t][0],i=n>179.9955?1:n<-179.9955?-1:0;r&&i&&r!==i&&(s[t][0]=r>0?n+360:n-360)}}if(!r.isGeographic){let e=S(r,!0);!function(e,t){let[r,n]=t;for(let t=0;t<e.length;t++){let s=e[t][1];(s<r||s>n)&&(e[t]=[NaN,NaN])}}(s,null!=e&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90]);let t=r.wkid?l.P.coordsys(r.wkid):l.P.fromString(r.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,r.wkt2||r.wkt);l.g.geogToProj(t,s.length,s)}let o=s;if(i&&s.length!==i.length){o=[];for(let e=0,t=0;e<i.length;e++)i[e]?o.push(s[t++]):o.push([NaN,NaN])}return o}(e);var i=e;let{points:o}=C(i,null),{inSR:a,outSR:p,datumTransformation:h}=i,m=o.map(e=>new u.A(e[0],e[1],a)),f=(0,c.project)(m,p,h);return h&&k(m,f,a,p),f.map(e=>e?[e.x,e.y]:[NaN,NaN])}({cols:v,rows:M,xmin:h,ymax:g,xres:A,yres:b,inSR:o,outSR:a,datumTransformation:s,preferPE:w[0]<=4,usePixelCenter:_}),T=[],R,F=0,I=_?-1:NaN,{xmin:j,xmax:B,ymax:G,width:Z,height:E}=r,O=N(a,500),D=null!=y&&j>0&&B>y/2,U=!1;if(p){let e=S(o);U=null!=e&&e.poleLocation>0}for(let e=0;e<v;e++){let t=[];for(let r=0;r<M;r++){let n=P[e*M+r];if(x&&n[0]>B&&n[0]>y/2-O?n[0]-=y:x&&0===e&&n[0]<0&&D&&!i&&(n[0]+=y),!n||isNaN(n[0])||isNaN(n[1]))T.push(I),T.push(I),t.push(null),F++;else{if(i){let e=i.inverseTransform(new u.A({x:n[0],y:n[1],spatialReference:a}));n=[e.x,e.y]}t.push(n),e>0&&x&&R[r]&&n[0]<R[r][0]&&(n[0]+=y,U&&n[0]>B&&n[0]>y&&(n[0]-=y)),T.push((n[0]-j)/Z),T.push((G-n[1])/E)}}R=t}return{offsets:T,error:null,coefficients:null,outofBoundPointCount:F,spacing:w,size:_?[v,M]:[v-1,M-1]}}function W(e,t,r){let{cols:n,rows:s}=t,i=new Float32Array((n-1)*(s-1)*12),o=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),a=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let t=0;t<n-1;t++){for(let r=0;r<s-1;r++){let l=t*s*2+2*r,u=e[l],p=e[l+1],c=e[l+2],h=e[l+3],m=e[l+=2*s],f=e[l+1],d=e[l+2],g=e[l+3],y=0,x=12*(r*(n-1)+t);for(let e=0;e<3;e++)i[x++]=o[y++]*u+o[y++]*c+o[y++]*d;y=0;for(let e=0;e<3;e++)i[x++]=o[y++]*p+o[y++]*h+o[y++]*g;y=0;for(let e=0;e<3;e++)i[x++]=a[y++]*u+a[y++]*m+a[y++]*d;y=0;for(let e=0;e<3;e++)i[x++]=a[y++]*p+a[y++]*f+a[y++]*g}if(r)for(let e=0;e<i.length;e++)isNaN(i[e])&&(i[e]=-1)}return i}function $(e){let{spatialReference:t}=e,r=(0,m.Vp)(t);if(!r)return e;let[n,s]=r.valid,i=s-n,o=0;return e.xmin<n?o=Math.ceil((n-e.xmin)/i):e.xmin>s&&(o=-Math.ceil((e.xmin-s)/i)),new a.A({spatialReference:e.spatialReference,xmin:e.xmin+o*i,ymin:e.ymin,xmax:e.xmax+o*i,ymax:e.ymax})}function H(e,t,r){let{storageInfo:n,pixelSize:s}=t,i=0,a=!1,{pyramidResolutions:l}=n,p="mixed"===n.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,n.tileInfo.dpi/96)):1,c=(e.x+e.y)/2/p;if(null!=l&&l.length){let e=l[l.length-1],n=(e.x+e.y)/2,p=(s.x+s.y)/2;if(c<=p)i=0;else if(c>=n)i=l.length,a=c/n>8;else{let e,t=p;for(let n=1;n<=l.length;n++){if(c<=(e=(l[n-1].x+l[n-1].y)/2)){c===e?i=n:"down"===r?(i=n-1,a=c/t>8):i="up"===r||c-t>e-c||c/t>2?n:n-1;break}t=e}}let h=0===i?s:l[i-1];return a&&Math.min(h.x,h.y)*(0,o.GA)(t.spatialReference)>19567&&(a=!1),{pyramidLevel:i,pyramidResolution:new u.A({x:h.x,y:h.y,spatialReference:t.spatialReference}),excessiveReading:a}}let h=Math.log(e.x/s.x)/Math.LN2,m=Math.log(e.y/s.y)/Math.LN2,f=t.storageInfo.maximumPyramidLevel||0;(i="down"===r?Math.floor(Math.min(h,m)):"up"===r?Math.ceil(Math.max(h,m)):Math.round((h+m)/2))<0?i=0:i>f&&(a=i>f+3,i=f);let d=2**i;return{pyramidLevel:i,pyramidResolution:new u.A({x:d*t.nativePixelSize.x,y:d*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:a}}function q(e,t,r=!1){let{pixelSize:n,extent:s}=e,i=_(s,t,!1),o=B(function(e,t){let r=e.clone().normalize();return 1===r.length?r[0]:j(r,t)}(s,(n.x+n.y)/16),t,i);return r||0===D(o)?o:Z(s,t,i)}function J(e,t,r){let n=r?.tileSize??512,s=r?.alignGlobalDatasetWithAGOL??!0,i=!!r?.limitToSrcResolution,{extent:o,spatialReference:a,pixelSize:l}=e,u=P(l,t,o);if(null==u)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};let p=(u.x+u.y)/2,c=T(p,t),m=t.isGeographic?256/n*295828763.7958547:256/n*591657527.591555,f="vector-magdir"===e.dataType||"vector-uv"===e.dataType,d=q(e,t,!0),g=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(m/2/c)/Math.LN2));if(!f&&s&&(t.isGeographic||t.isWebMercator)){let r=z(t);if(!(f=D(d)>0||null!=r&&d.width>r/4)&&null!=r){let t=-1;if(g<3)t=2**g*p*n;else if(e.storageInfo){let{maximumPyramidLevel:r=0,pyramidScalingFactor:s=2}=e.storageInfo;t=s**r*p*n}let s=Math.ceil(r/t);f=1===s||2===s&&r/2-d.xmax<t}}let y,x=c,w=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(f){x=m;let r=t.isGeographic?1341104507446289e-21:.29858214164761665,n=T(r,t),s=t.isGeographic?4326:3857;y=P({x:r,y:r},a,q(e,new h.A({wkid:s}),!0)),y.x*=x/n,y.y*=x/n}else{y={x:l.x,y:l.y};let e=0;for(;x<.5005*m&&e<g;)e++,x*=w,y.x*=w,y.y*=w;Math.max(x,m)/Math.min(x,m)<=1.001&&(x=m)}let A=[x],b=[{x:y.x,y:y.y}],_=Math.min(70.5310735,c)/1.001;for(;x>=_;)x/=w,y.x/=w,y.y/=w,A.push(x),b.push({x:y.x,y:y.y});if(i){let e=.001*l.x,t=b.findIndex(t=>t.x>=l.x-e&&t.x<=l.x+e);t>-1?(b.length=t+1,A.length=t+1):(t=b.findIndex(t=>t.x<=l.x+e))>0&&(b.length=t,A.length=t)}return{projectedPixelSize:u,scales:A,srcResolutions:b,isCustomTilingScheme:!f}}}}]);