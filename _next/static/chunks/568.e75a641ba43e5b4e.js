"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[568,3724],{2370:(e,t,i)=>{i.d(t,{E:()=>x,w:()=>l});var r=i(31461),s=i(28255);i(57845);var a=i(87196),n=i(70115);class l{constructor(e=9,t){this._compareMinX=u,this._compareMinY=p,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),v.prune(),S.prune(),C.prune()}all(e){o(this._data,e)}search(e,t){let i=this._data,r=this._toBBox;if(f(e,i))for(b.clear();i;){for(let s=0,a=i.children.length;s<a;s++){let a=i.children[s],n=i.leaf?r(a):a;f(e,n)&&(i.leaf?t(a):m(e,n)?o(a,t):b.push(a))}i=b.pop()}}collides(e){let t=this._data,i=this._toBBox;if(!f(e,t))return!1;for(b.clear();t;){for(let r=0,s=t.children.length;r<s;r++){let s=t.children[r],a=t.leaf?i(s):s;if(f(e,a)){if(t.leaf||m(e,a))return!0;b.push(s)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){let e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new E([]),this}remove(e){if(!e)return this;let t,i=this._data,a=null,n=0,l=!1,o=this._toBBox(e);for(S.clear(),C.clear();i||S.length>0;){if(i||(i=S.pop(),a=S.data[S.length-1],n=C.pop()??0,l=!0),i.leaf&&-1!==(t=(0,r.qh)(i.children,(0,s.zI)(e),i.children.length,i.indexHint)))return i.children.splice(t,1),S.push(i),this._condense(S),this;l||i.leaf||!m(i,o)?a?(n++,i=a.children[n],l=!1):i=null:(S.push(i),C.push(n),n=0,a=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,i,r){let s=i-t+1,a=this._maxEntries;if(s<=a){let r=new E(e.slice(t,i+1));return h(r,this._toBBox),r}r||(r=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/a**(r-1)));let n=new G([]);n.height=r;let l=Math.ceil(s/a),o=l*Math.ceil(Math.sqrt(a));_(e,t,i,o,this._compareMinX);for(let s=t;s<=i;s+=o){let t=Math.min(s+o-1,i);_(e,s,t,l,this._compareMinY);for(let i=s;i<=t;i+=l){let s=Math.min(i+l-1,t);n.children.push(this._build(e,i,s,r-1))}}return h(n,this._toBBox),n}_insert(e,t,i){let r=this._toBBox,s=i?e:r(e);S.clear();let a=function(e,t,i,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==i;){let i,r=1/0,n=1/0;for(let l=0,o=t.children.length;l<o;l++){var s,a;let o=t.children[l],h=y(o),d=(s=e,(Math.max((a=o).maxX,s.maxX)-Math.min(a.minX,s.minX))*(Math.max(a.maxY,s.maxY)-Math.min(a.minY,s.minY))-h);d<n?(n=d,r=h<r?h:r,i=o):d===n&&h<r&&(r=h,i=o)}t=i||t.children[0]}return t}(s,this._data,t,S);for(a.children.push(e),c(a,s);t>=0&&S.data[t].children.length>this._maxEntries;)this._split(S,t),t--;var n=s,l=S,o=t;for(let e=o;e>=0;e--)c(l.data[e],n)}_split(e,t){let i=e.data[t],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);let a=this._chooseSplitIndex(i,s,r);if(!a)return;let n=i.children.splice(a,i.children.length-a),l=i.leaf?new E(n):new G(n);l.height=i.height,h(i,this._toBBox),h(l,this._toBBox),t?e.data[t-1].children.push(l):this._splitRoot(i,l)}_splitRoot(e,t){this._data=new G([e,t]),this._data.height=e.height+1,h(this._data,this._toBBox)}_chooseSplitIndex(e,t,i){let r,s,a;r=s=1/0;for(let n=t;n<=i-t;n++){let t=d(e,0,n,this._toBBox),l=d(e,n,i,this._toBBox),o=function(e,t){let i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY);return Math.max(0,Math.min(e.maxX,t.maxX)-i)*Math.max(0,Math.min(e.maxY,t.maxY)-r)}(t,l),h=y(t)+y(l);o<r?(r=o,a=n,s=h<s?h:s):o===r&&h<s&&(s=h,a=n)}return a}_chooseSplitAxis(e,t,i){let r=e.leaf?this._compareMinX:u,s=e.leaf?this._compareMinY:p;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,s)&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);let s=this._toBBox,a=d(e,0,t,s),n=d(e,i-t,i,s),l=g(a)+g(n);for(let r=t;r<i-t;r++){let t=e.children[r];c(a,e.leaf?s(t):t),l+=g(a)}for(let r=i-t-1;r>=t;r--){let t=e.children[r];c(n,e.leaf?s(t):t),l+=g(n)}return l}_condense(e){for(let t=e.length-1;t>=0;t--){let i=e.data[t];if(0===i.children.length)if(t>0){let s=e.data[t-1],a=s.children;a.splice((0,r.qh)(a,i,a.length,s.indexHint),1)}else this.clear();else h(i,this._toBBox)}}_initFormat(e){let t=["return a"," - b",";"];this._compareMinX=Function("a","b",t.join(e[0])),this._compareMinY=Function("a","b",t.join(e[1])),this._toBBox=Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function o(e,t){let i=e;for(v.clear();i;){if(!0===i.leaf)for(let e of i.children)t((0,s.zI)(e));else v.pushArray(i.children);i=v.pop()??null}}function h(e,t){d(e,0,e.children.length,t,e)}function d(e,t,i,r,s){s||(s=new E([])),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let a,n=t;n<i;n++)a=e.children[n],c(s,e.leaf?r(a):a);return s}function c(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function u(e,t){return e.minX-t.minX}function p(e,t){return e.minY-t.minY}function y(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function g(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function _(e,t,i,r,s){let a=[t,i];for(;a.length;){let t=a.pop(),i=a.pop();if(t-i<=r)continue;let l=i+Math.ceil((t-i)/r/2)*r;(0,n.q)(e,l,i,t,s),a.push(i,l,l,t)}}let b=new a.A,v=new a.A,S=new a.A,C=new a.A({deallocator:void 0});class x{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class w extends x{constructor(){super(...arguments),this.height=1,this.indexHint=new r.vW}}class E extends w{constructor(e){super(),this.children=e,this.leaf=!0}}class G extends w{constructor(e){super(),this.children=e,this.leaf=!1}}},3724:(e,t,i)=>{i.r(t),i.d(t,{getGeometryServiceURL:()=>o,projectGeometry:()=>h});var r=i(48767),s=i(32391),a=i(14307),n=i(29597),l=i(74497);async function o(e=null,t){let i;if(r.A.geometryServiceUrl)return r.A.geometryServiceUrl;if(!e)throw new s.A("internal:geometry-service-url-not-configured");i="portal"in e?e.portal||a.A.getDefault():e,await i.load({signal:t});let n=i.helperServices?.geometry?.url;if(!n)throw new s.A("internal:geometry-service-url-not-configured");return n}async function h(e,t,i=null,r){let a=await o(i,r),d=new l.A({geometries:[e],outSpatialReference:t}),c=await (0,n.C)(a,d,{signal:r});if(c&&Array.isArray(c)&&1===c.length)return c[0];throw new s.A("internal:geometry-service-projection-failed")}},4547:(e,t,i)=>{i.d(t,{h:()=>s}),i(119);var r=i(17202);i(19908);class s extends r.R6{constructor(e,t,i,r,s){super(e,t),this.layerUid=e,this.graphicUid=t,this.triangleNr=i,this.baseBoundingSphere=r,this.numLodLevels=s}}},5895:(e,t,i)=>{i.d(t,{T:()=>s});var r=i(82795);let s={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new r.Om(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)}},5951:(e,t,i)=>{function r(e){return null!=e.mapPositions}i.d(t,{p:()=>r}),i(63497)},7800:(e,t,i)=>{i.d(t,{t:()=>r});let r=["web-gltf","web","cim"]},8614:(e,t,i)=>{i.d(t,{H:()=>u,Y:()=>p});var r=i(63599),s=i(56911),a=i(42845),n=i(7916),l=i(74558),o=i(89060),h=i(91220),d=i(18189),c=i(45773);class u{constructor(e,t,i){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=i}}class p{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,i,r,s,a,n,l=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=i,this._uniqueMaterials=r,this._sharedResource=s,this.elevationAligner=a,this.elevationContext=n,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;let t=e.stage;t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){if(!this._stageLayer)return;let e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,t){let{stageObject:i,_edgeState:r,_stageLayer:s}=this;if(null==r)return;let a=y(r.baseMaterial);r.edgeMaterial.objectTransparency!==a&&(r.edgeMaterial.objectTransparency=a,this.resetEdgeObject(t)),s.stage.renderer.withEdgeView(t=>t.updateAllComponentOpacities(i,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,t){let{stageObject:i,_edgeState:r,_stageLayer:s}=this;null!=r&&s.stage.renderer.withEdgeView(s=>{s.updateAllComponentMaterials(i,r.edgeMaterial,e,!t),r.hasSlicePlane=e})}setVisibility(e){let{_edgeState:t,stageObject:i,_stageLayer:r}=this;null!=r&&this.visible!==e&&(this._visible=e,i.visible=e,e&&!this._addedToStage&&(r.add(i),this._addedToStage=!0),null!=t&&r.stage.renderer.withEdgeView(r=>{r.hasObject(i)?r.updateObjectVisibility(i,e):e&&this._addOrUpdateEdgeObject(t,r,!1)}))}get visible(){return this._visible}alignWithElevation(e,t,i,r){null!=this.elevationAligner&&(null!=i&&(0,o.gf)(this.elevationContext.featureExpressionInfoContext,i),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,(i,r)=>(0,l.sE)(i,e,this.elevationContext,t,r),t),this.resetEdgeObject(r))}alignWithAbsoluteElevation(e,t,i){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(t,i)=>{i.sampledElevation=e,i.verticalDistanceToGround=0,i.z=e},t),this.resetEdgeObject(i)}getCenterObjectSpace(e=(0,s.vt)()){return(0,r.c)(e,(0,n.a)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=(0,a.vt)()){let t=this.stageObject.boundingVolumeObjectSpace;return(0,a.Ne)(e,t.min),(0,a.vI)(e,t.max),e}computeAttachmentOrigin(e){let t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(let i of this.stageObject.geometries)i.computeAttachmentOrigin(f)&&((0,r.t)(f,f,t),(0,r.g)(e.render.origin,e.render.origin,f),e.render.num++)}async getProjectedBoundingBox(e,t,i,s,n){let l=this.getBoundingBoxObjectSpace(n),o=(0,a.fT)(l)?1:_.length;for(let e=0;e<o;e++){let t=_[e];m[0]=l[t[0]],m[1]=l[t[1]],m[2]=l[t[2]],(0,r.t)(m,m,this.stageObject.transformation),g[3*e]=m[0],g[3*e+1]=m[1],g[3*e+2]=m[2]}if(!e(g,0,o))return null;(0,a.Ie)(l);let d=null;this.calculateRelativeScreenBounds&&(d=this.calculateRelativeScreenBounds());for(let e=0;e<3*o;e+=3){for(let t=0;t<3;t++)l[t]=Math.min(l[t],g[e+t]),l[t+3]=Math.max(l[t+3],g[e+t]);d&&i.push({location:g.slice(e,e+3),screenSpaceBoundingRect:d})}if(t?.service&&"absolute-height"!==this.elevationContext.mode){(0,a.gX)(l,f);let e="relative-to-scene"===this.elevationContext.mode?"scene":"ground",i=0;if(t.useViewElevation)i=t.service.getElevation(f[0],f[1],e)??0;else try{let r=(0,h.vY)(l,t.service.spatialReference,t);i=await t.service.queryElevation(f[0],f[1],s,r,e)??0}catch(e){}(0,a.cY)(l,0,0,-this.alignedSampledElevation+i)}return l}addObjectState(e){e.stateType===d.Mg.Highlight&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===d.Mg.MaskOccludee&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){let{_edgeState:t,stageObject:i,_stageLayer:r,_visible:s}=this;null!=t&&r.stage.renderer.withEdgeView(r=>{s?this._addOrUpdateEdgeObject(t,r,e):r.removeObject(i)})}_addOrUpdateEdgeObject(e,t,i){let r=y(e.baseMaterial);e.edgeMaterial.objectTransparency=r,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!i).then(()=>this._stageLayer?.sync())}}function y(e){return e.parameters.transparent?c.x.TRANSPARENT:c.x.OPAQUE}let g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=(0,s.vt)(),f=(0,s.vt)(),_=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},19474:(e,t,i)=>{i.d(t,{CK:()=>h,E9:()=>l,Hq:()=>o,MW:()=>d,TE:()=>c,yJ:()=>u});var r=i(63599),s=i(39960),a=i(76277),n=i(61102);function l(e){return null==e.origin}function o(e){return null!=e.origin}function h(e){return o(e.vertexSpace)}function d(e,t){if(!o(e))return null;let[i,r,a]=e.origin;return new s.A({x:i,y:r,z:a,spatialReference:t})}function c(e,t){var i;let{x:r,y:s,z:l,spatialReference:o}=e,h=[r,s,l??0];return"local"===(t?.vertexSpace??((i=o).isGeographic||i.isWebMercator?"local":"georeferenced"))?new n.A({origin:h}):new a.A({origin:h})}function u(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,r.p)(e.origin,t.origin))}},25160:(e,t,i)=>{i.d(t,{U:()=>f});var r=i(70152);i(57845);var s=i(61939),a=i(56911),n=i(44120),l=i(60470),o=i(92446),h=i(74558),d=i(49228),c=i(89060),u=i(91220),p=i(57473),y=i(51525),g=i(26475);let m=()=>s.A.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class f extends y.x{constructor(e,t,i,r){super(i.schedule),this.symbol=e,this.symbolLayer=t,this._context=i,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=m(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=r.renderPriority,this._renderPriorityStep=r.renderPriorityStep,this._elevationContext=new d.F,this.complexity=this.computeComplexity(),this.ignoreDrivers=r.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=_(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get usedMemory(){let e=this.complexity;return null==e?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;let t=this._drivenProperties,i=_(e);return i.color!==t.color||i.opacity!==t.opacity||i.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||i.size!==t.size||i.rotation!==t.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,i,r){let s=e.projectionSuccess,a="polygons"in e?e.polygons:null,n=`${r} geometry failed to be created`;s?!this._logGeometryValidationWarnings(t,i,r)&&a&&0===a.length&&"rings"===i&&t.length>0&&t[0].length>2&&m().warnOncePerTick(`${n} (filled rings should use clockwise winding - try reversing the order of vertices)`):m().warnOncePerTick(`${n} (failed to project geometry to view spatial reference)`)}updateFocus(e,t){}_logGeometryValidationWarnings(e,t,i){let r=`${i} geometry failed to be created`;return e.length&&(1!==e.length||e[0].length)?(!Array.isArray(e)||!Array.isArray(e[0]))&&(m().warnOncePerTick(`${r} (${t} should be defined as a 2D array)`),!0):(m().warnOncePerTick(`${r} (no ${t} were defined)`),!0)}_validateGeometry(e,t=null,i=null){if(null!=t&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;switch(e.type){case"point":if(!isFinite(e.x)||!isFinite(e.y))return m().warn("point coordinate is not a valid number, graphic skipped"),!1;break;case"polygon":(0,l.m3)(e)&&m().warnOnce("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return b}_defaultElevationInfoZ(){return v}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t=new d.F){let i=e.geometry,r=this.getDefaultElevationInfo(i);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:r.unit,t.mode=this.getGeometryElevationMode(i,r),t.offsetMeters=this._elevationContext.meterUnitOffset??r.offset??0;let s=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;s&&(t.mode="relative-to-ground",t.offsetMeters=0);let a=s?c.KF:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(a,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}updateTransform(e,t,i,r){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,t=S){let i=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?i:e?i*e.a:t.hasIntrinsicColor?i:0}_getCombinedOpacityAndColor(e,t=S){let i=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return(0,u.$C)(null,i);let s=null!=e?r.A.toUnitRGB(e):a.Un;return(0,u.$C)(s,i)}_getVertexOpacityAndColor(e,t=null){let i=this._drivenProperties.color?e.color:null,r=this._drivenProperties.opacity?e.opacity:null,s=(0,u.$C)(i,r);return t&&(s[0]*=t,s[1]*=t,s[2]*=t,s[3]*=t),s}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return(0,o.JV)(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,i){switch(e){case"opacity":return this.layerOpacityChanged(t,i),!0;case"elevationInfo":{let e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,i,e)!==h.uw.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,i){let r=h.uw.UPDATE;return e.forEach(e=>{let s=t(e);if(null!=s){let t=e.graphic;this.setGraphicElevationContext(t,s.elevationContext),s.needsElevationUpdates=i(s.elevationContext.mode)}else r=h.uw.RECREATE}),r}applyRendererDiff(e,t){return p.w.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;let t=this._fastUpdates.visualVariables,i=t.size?(0,g.ul)(t.size.field,e):0,r=t.color?(0,g.ul)(t.color.field,e):0,s=t.opacity?(0,g.ul)(t.opacity.field,e):0;return(0,n.fA)(i,r,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&m().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}}}function _(e){let t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let i=0;i<e.stops.length;i++){let r=e.stops[i].color;r&&(t.opacity=!0,r.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0;break;case"rotation":t.rotation=!0}}),t}let b={mode:"on-the-ground",offset:0,unit:"meters"},v={mode:"absolute-height",offset:0,unit:"meters"},S={hasIntrinsicColor:!1}},25266:(e,t,i)=>{i.d(t,{R$:()=>m,SZ:()=>c,ZX:()=>g,d2:()=>y,hS:()=>u});var r=i(56911),s=i(86835),a=i(42845),n=i(60470),l=i(40838),o=i(74558),h=i(91220),d=i(66673);function c(e,t,i,r,s){if(p(e,t))return null;i.localOrigin=m(e,t);let a=new d.B({geometries:[i],castShadow:!1,layerUid:e.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:(0,o.fe)(a,t,e.elevationProvider,e.renderCoordsHelper,r)}}function u(e,t,i,r){return p(t,i)?null:(0,o.fe)(e,i,t.elevationProvider,t.renderCoordsHelper,r)}function p(e,t){let i=e.clippingExtent;return!!i&&((0,s.g)(t,f,e.elevationProvider.spatialReference),!(0,a.Uc)(i,f))}function y(e,t,i){let r=e.elevationContext,a=i.spatialReference;(0,s.g)(t,f,a),r.centerPointInElevationSR=(0,l.T)(f[0],f[1],t.hasZ?f[2]:0,null!=a?a:null)}function g(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,h.W$)(e);case"polyline":{let t=e.paths[0];if(!t||0===t.length)return null;let i=(0,n.$H)(t,(0,n.Yl)(t)/2);return(0,l.T)(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.extent.center}return null}function m(e,t){return(0,s.g)(t,f,e.renderCoordsHelper.spatialReference),e.localOriginFactory.getOrigin(f)}let f=(0,r.vt)()},39481:(e,t,i)=>{i.d(t,{Z:()=>r});class r{constructor(e,t=null){this.labelText=t,this.elevationOffset=e??0}}},40893:(e,t,i)=>{i.d(t,{MT:()=>a,a8:()=>n,hk:()=>s,i3:()=>l,rz:()=>r});class r{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new l}}class s extends r{constructor(e){super(e),this.estimated=!0}}class a extends r{constructor(e,t){super(t),this.numComplexities=e}}class n extends s{constructor(e,t){super(t),this.numComplexities=e}}class l{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}},44383:(e,t,i)=>{i.r(t),i.d(t,{default:()=>i1});var r,s,a,n,l=i(81856),o=i(32391),h=i(40941),d=i(45257),c=i(91838),u=i(57845),p=i(61939);i(33638);var y=i(12709),g=i(19158),m=i(92753),f=i(8811);let _=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,f.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){let e=new AbortController,t=e.signal;this.addHandles((0,g.hA)(()=>e.abort())),await (0,d.C_)(()=>this.view.defaultsFromMap?.heightModelInfoReady,t),(0,m.Te)(t);let i=(0,f.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}};return(0,l._)([(0,c.MZ)()],t.prototype,"view",void 0),(0,l._)([(0,c.MZ)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,l._)([(0,y.$)("esri.views.3d.layers.LayerView3D")],t)};var b=i(56911),v=i(91463),S=i(86835),C=i(40838),x=i(26585),w=i(74558),E=i(49228),G=i(89060);async function P(e,t,i,r,s){let{elevationProvider:a,renderCoordsHelper:n}=e,{elevationInfo:l}=t,{pointsInFeatures:o,spatialReference:h}=r,d=v.A.fromJSON(h),c=(0,G.MF)(l,!0),u=await (0,G.q6)(c,d,s);(0,m.Te)(s);let p=[],y=new Set,g=new Set,f=new E.F,_=(0,C.T)(0,0,0,v.A.WGS84),P=new w.Uk,A=(0,b.vt)();_.spatialReference=d;let O=e.elevationProvider.spatialReference??e.spatialReference;for(let{objectId:e,points:r}of o){let o=i(e);if(null==o){for(let e of r)p.push(e.z??0);y.add(e);continue}o.isDraped&&g.add(e);let h=o.graphic.geometry;for(let{x:e,y:i,z:d}of(f.setFromElevationInfo((0,x.ze)(h,l)),f.updateFeatureExpressionInfoContext(u,o.graphic,t),r))_.x=e,_.y=i,_.z=d??0,await (0,S.W)(_,A,O,0,{signal:s}),(0,w.sE)(A,a,f,n,P),p.push(P.z)}return{elevations:p,drapedObjectIds:g,failedObjectIds:y}}var A=i(97135),O=i(28690),L=i(70128),R=i(18524),I=i(64171),D=i(83048),M=i(65909),F=i(86099),T=i(59641),U=i(95946),V=i(31461),z=i(90304),B=i(15142),j=i(87196),H=i(77089),N=i(63599),k=i(61414),Z=i(39960),q=i(65111),W=i(70983),Y=i(9892),$=i(86578),X=i(42845),Q=i(84766),J=i(71760),K=i(56779),ee=i(31788),et=i(98873),ei=i(62607);function er(e){return null==e||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function es(e,t){if(!t)return null;if(Array.isArray(t)||(t=[t]),t.length>0){let i=t.map(e=>e.details.symbol.type||e.details.symbol.declaredClass).filter(e=>!!e);i.sort();let r=[];return i.forEach((e,t)=>{0!==t&&e===i[t-1]||r.push(e)}),new o.A("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${r.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:t})}return null}var ea=i(49180),en=i(20703),el=i(12723),eo=i(67844),eh=i(7644),ed=i(11584),ec=i(9882),eu=i(92446);class ep{constructor(e,t,i){this.maximumTotalNumberOfVertices=e,this.maximumNumberOfFeatures=t,this.averageSymbolComplexity=i}}i(147);var ey=i(25451);class eg{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,i){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,i)}async queryElevation(e,t,i,r,s){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,s,i,r)}}!function(e){e[e.USER=1]="USER",e[e.SCALE_RANGE=2]="SCALE_RANGE",e[e.FILTER=4]="FILTER",e[e.DECONFLICTION=8]="DECONFLICTION",e[e.ALL_GRAPHIC=15]="ALL_GRAPHIC",e[e.ALL_LABEL=255]="ALL_LABEL"}(r||(r={})),function(e){e[e.GRAPHIC=1]="GRAPHIC",e[e.LABEL=16]="LABEL"}(s||(s={}));var em=i(74652),ef=i(82795),e_=i(56599),eb=i(5895);let ev=(0,X.vt)(),eS=class extends O.A{constructor(e){super(e),this.events=new em.A,this.hasZ=null,this.hasM=null,this.objectIdField=null,this.featureAdapter={getAttribute:(e,t)=>"graphic"in e?e.graphic.attributes[t]:eb.T.getAttribute(e,t),getAttributes:e=>"graphic"in e?e.graphic.attributes:eb.T.getAttributes(e),getObjectId:e=>"graphic"in e?(0,K.RW)(e.graphic,this.objectIdField)??void 0:eb.T.getObjectId(e),getGeometry:e=>"graphic"in e?e.getAsOptimizedGeometry(this.hasZ,this.hasM):eb.T.getGeometry(e),getCentroid:(e,t)=>{if("graphic"in e){let i=null;null!=e.centroid?i=e.centroid:"point"===e.graphic.geometry.type&&(0,q.projectPoint)(e.graphic.geometry,eC,this.viewSpatialReference)&&(i=eC);let r=Array(2+ +!!t.hasZ+ +!!t.hasM);return null==i?(r[0]=0,r[1]=0,r[2]=0,r[3]=0):(r[0]=i.x,r[1]=i.y,t.hasZ&&(r[2]=i.hasZ?i.z:0),t.hasM&&(r[t.hasZ?3:2]=i.hasM?i.m:0)),new e_.A([],r)}return eb.T.getCentroid(e,t)},cloneWithGeometry:(e,t)=>"graphic"in e?new ef.Om(t,this.featureAdapter.getAttributes(e),null,this.featureAdapter.getObjectId(e)):eb.T.cloneWithGeometry(e,t)}}forEachInBounds(e,t){this.getSpatialIndex().forEachInBounds(e,t)}forEachBounds(e,t){let i=this.getSpatialIndex();for(let r of e){let e=this.featureAdapter.getObjectId(r);null!=i.getBounds(e,ev)&&t(ev)}}};(0,l._)([(0,c.MZ)({constructOnly:!0})],eS.prototype,"getSpatialIndex",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],eS.prototype,"forEach",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],eS.prototype,"hasZ",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],eS.prototype,"hasM",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],eS.prototype,"objectIdField",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],eS.prototype,"viewSpatialReference",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],eS.prototype,"featureSpatialReference",void 0),eS=(0,l._)([(0,y.$)("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],eS);let eC={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};class ex{constructor(e,t,i){this.graphic=e,this.renderingInfo=t,this.layer=i}}var ew=i(10954);class eE{constructor(e,t){this.scheduler=e,this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return this.stage.view.state.viewingMode===ew.RT.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}}class eG{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}}var eP=i(83610),eA=i(5342),eO=i(70152),eL=i(55048),eR=i(44120),eI=i(61859),eD=i(8614),eM=i(39481),eF=i(25160),eT=i(91220),eU=i(25266),eV=i(40893),ez=i(4023),eB=i(74405),ej=i(63497),eH=i(53041),eN=i(45714),ek=i(25561),eZ=i(83094),eq=i(4538),eW=i(93895),eY=i(60048),e$=i(22045),eX=i(70950),eQ=i(60649),eJ=i(96741),eK=i(69520),e0=i(93446),e1=i(84153);class e3 extends eJ.w{constructor(e,t){super(e,t,new eQ.$(eK.L,()=>i.e(6062).then(i.bind(i,86062))))}initializePipeline(e){let{hudDepth:t,terrainDepthTest:i}=e,r={func:i?e0.MT.ALWAYS:e0.MT.LESS};return(0,e1.Ey)(t?{depthTest:r,depthWrite:e1.Uy}:{blending:(0,e1.p3)(e0.dn.ONE,e0.dn.SRC_ALPHA,e0.dn.ONE_MINUS_SRC_ALPHA,e0.dn.ONE_MINUS_SRC_ALPHA),depthTest:r,colorWrite:e1.kn})}}var e2=i(95421),e5=i(4111);class e9 extends e5.E{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}}(0,l._)([(0,e2.W)()],e9.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,l._)([(0,e2.W)()],e9.prototype,"occlusionTestEnabled",void 0),(0,l._)([(0,e2.W)()],e9.prototype,"hasVerticalOffset",void 0),(0,l._)([(0,e2.W)()],e9.prototype,"hasScreenSizePerspective",void 0),(0,l._)([(0,e2.W)()],e9.prototype,"hudDepth",void 0),(0,l._)([(0,e2.W)()],e9.prototype,"hudDepthAlignStart",void 0),(0,l._)([(0,e2.W)()],e9.prototype,"terrainDepthTest",void 0);var e4=i(92961);class e8 extends eY.im{constructor(e,t){super(e,te),this.produces=new Map([[e$.N.LINE_CALLOUTS,e=>(0,eq.RN)(e)],[e$.N.LINE_CALLOUTS_HUD_DEPTH,e=>(0,eq.RN)(e)]]),this._configuration=new e9(t),this._uniqueMaterialIdentifier=e6(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){let i=t.slot===e$.N.LINE_CALLOUTS_HUD_DEPTH;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.hudDepth=i,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration}get visible(){return this.parameters.color[3]>=e4.Q||(this.parameters.borderColor?.[3]??0)>=e4.Q}intersect(){}createGLMaterial(e){return new e7(e)}createBufferWriter(){return new tr}validateParameters(e){this._uniqueMaterialIdentifier=e6(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}}function e6({renderOccluded:e,isDecoration:t,horizontalScreenOffset:i,color:r,size:s,occlusionTest:a,shaderPolygonOffset:n,hudDepthAlignStart:l,centerOffsetUnits:o,hasSlicePlane:h,screenSizePerspective:d,verticalOffset:c,borderColor:u}){return(0,eN.ML)`${e}:${t}:${i}:[${r}]:${s}:${a}:${n}:${l}:${o}:${h}:${null!=d}:{${c.screenLength}:${c.minWorldLength}:${c.maxWorldLength}}:[${u}]`}class e7 extends eW.A{beginSlot(e){return this.getTechnique(e3,e)}}class te extends eY.qA{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=(0,eR.fA)(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}let tt=(0,eZ.BP)().vec3f(eH.r.POSITION).vec3f(eH.r.NORMAL).vec2f(eH.r.UV0).vec4f(eH.r.CENTEROFFSETANDDISTANCE),ti=[(0,ek.fA)(0,0),(0,ek.fA)(1,0),(0,ek.fA)(0,1),(0,ek.fA)(1,0),(0,ek.fA)(1,1),(0,ek.fA)(0,1)];class tr{constructor(){this.vertexBufferLayout=tt}elementCount(e){return 6*e.get(eH.r.POSITION).indices.length}write(e,t,i,r,s,a){(0,eX.Hk)(i.get(eH.r.POSITION),e,s.position,a,6),(0,eX.p1)(i.get(eH.r.NORMAL),t,s.normal,a,6),(0,eX.Ut)(i.get(eH.r.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,a,6);for(let e=0;e<ti.length;++e)s.uv0.setVec(a+e,ti[e])}}class ts extends eF.U{constructor(e,t){super(e,null,t,tl),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new e8(this._materialParameters,this._context.spherical),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){let t=this._materialParameters;return t.horizontalScreenOffset=e.horizontalScreenOffset??0,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){let e=new te,t=this.symbol,i=t.callout;if(i.color){let t=eO.A.toUnitRGBA(i.color);t[3]*=this._getLayerOpacity(),e.color=t}else e.color=eR.uY;if(e.size=(0,eL.Lz)(i.size||0),t.verticalOffset){let{screenLength:i,minWorldLength:r,maxWorldLength:s}=t.verticalOffset;e.verticalOffset={screenLength:(0,eL.Lz)(i),minWorldLength:r||0,maxWorldLength:null!=s?s:1/0}}e.borderColor=null!=i.border?.color?eO.A.toUnitRGBA(i.border.color):null;let r="object"===t.symbolLayers.at(0).type,s="label-3d"===t.type;return e.occlusionTest=!r&&!(0,u.A)("enable-feature:non-occluded-hud"),r&&(e.shaderPolygonOffset=0),e.hudDepthAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return tn}createGraphics3DGraphic(e){let t=e.renderingInfo,i=e.graphic,r=this.setGraphicElevationContext(i,new E.F,t.elevationOffset||0),s=t.symbol,a="on-the-ground"===this._elevationContext.mode&&("cim"===s.type||!s.symbolLayers.some(e=>"object"===e.type||"text"===e.type));if("label-3d"!==s.type&&a||"point-3d"===s.type&&s.symbolLayers.every(e=>"text"===e.type&&!(0,eA.Ie)(e)))return null;let n=(0,eT.W$)(i.geometry);return null==n?null:this._createAs3DShape(n,r,t,i.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,i){let r=this._elevationContext.mode,s=(0,w.I2)(ts.elevationModeChangeTypes,i,r);return s!==w.uw.UPDATE||e.forEach(e=>{let i=t(e);null!=i&&this.updateGraphicElevationContext(e.graphic,i)}),s}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,t,i=0){return super.setGraphicElevationContext(e,t),t.addOffsetRenderUnits(i),t}updateGraphicElevationContext(e,t){let{elevationContext:i,metadata:r}=t;this.setGraphicElevationContext(e,i,r?.elevationOffset??0),t.needsElevationUpdates=(0,w.nu)(i.mode)}computeComplexity(){return new eV.rz({verticesPerFeature:6})}_getOrCreateMaterial(e){let t=this._perInstanceMaterialParameters(e),i=e6(t);if(i===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=e.materialCollection){let r=e.materialCollection.get(i);return null==r&&(r=new e8(t,this._context.spherical),e.materialCollection.add(i,r)),{material:r,isUnique:!1}}return{material:new e8(t,this._context.spherical),isUnique:!0}}_createAs3DShape(e,t,i,r){let s=this._context.layer.uid,a=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:s}),n=this._getOrCreateMaterial(i),l=new ej.V(n.material,function(e){let{translation:t,centerOffset:i}=e,r=new ez.n(t?[t[0],t[1],t[2]]:[0,0,0],ta,3,!0),s=new ez.n(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],ta,4,!0);return[[eH.r.POSITION,r],[eH.r.NORMAL,new ez.n([0,0,1],ta,3,!0)],[eH.r.CENTEROFFSETANDDISTANCE,s]]}(i),null,eB.X.Point,a),o=(0,eU.SZ)(this._context,e,l,t,r);if(null==o)return null;let h=new eD.Y(this,o.object,[l],n.isUnique?[n.material]:null,null,eI.G8,t);return h.metadata=new eM.Z(i.elevationOffset),h.alignedSampledElevation=o.sampledElevation,h.needsElevationUpdates=(0,w.nu)(t.mode),(0,eU.d2)(h,e,this._context.elevationProvider),h}}ts.elevationModeChangeTypes={definedChanged:w.uw.UPDATE,staysOnTheGround:w.uw.UPDATE,onTheGroundChanged:w.uw.RECREATE};let ta=[0],tn={mode:"relative-to-ground",offset:0},tl={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class to extends ea.${constructor(e,t,i=(0,b.vt)(),r=(0,eR.vt)(),s=0,a="world",n=0,l=null){super(e,t),this.translation=i,this.centerOffset=r,this.horizontalScreenOffset=s,this.centerOffsetUnits=a,this.elevationOffset=n,this.materialCollection=l}}let th=()=>p.A.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),td={line:ts};var tc=i(94264),tu=i(98570),tp=i(54036),ty=i(35430),tg=i(87960);function tm(e,t,i,r){return null!=e&&((0,J.aI)(t,r)?((0,Q.C)(i,e),!0):(tf[0]=e[0],tf[1]=e[1],tf[2]=0,!!(0,W.projectBuffer)(tf,t,0,tf,r,0)&&(i[0]=tf[0],i[1]=tf[1],tf[0]=e[2],tf[1]=e[3],tf[2]=0,!!(0,W.projectBuffer)(tf,t,0,tf,r,0)&&(i[2]=tf[0],i[3]=tf[1],!0))))}let tf=(0,b.vt)();var t_=i(60729);let tb=new tu.A(Array,e=>(0,X.hZ)(e,X.v_),null,10,5),tv=(0,Q.vt)();class tS{get labelLayers(){return this._labelLayers||V.tR}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e?.isElevationSource)}constructor(e,t,i,s,a){this.graphic=e,this.graphics3DSymbol=t,this.layers=i,this._visibleFlags=r.ALL_LABEL,this.deconflictionPriority=0,++t.referenced,this._featureExpressionFeature=a?(0,G.VG)(a,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(t=>{t.initialize(e),t.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=[]),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(s.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(t=>{"draped"===t.type&&(e=!0)}),e}isVisible(e=s.GRAPHIC,t){let i=t?this._visibleFlags|t|s.LABEL*t:this._visibleFlags;return e===s.GRAPHIC?(i&r.ALL_GRAPHIC)===r.ALL_GRAPHIC:(i&r.ALL_LABEL)===r.ALL_LABEL}setVisibilityFlag(e,t,i){let r=this.isVisible(e);i?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);let a=this.isVisible(e);if(r===a)return!1;if(e===s.LABEL)this._forEachLabelGraphic(e=>e.setVisibility(a));else{this._forEachSymbolLayerGraphic(e=>e.setVisibility(a));let e=this.isVisible(s.LABEL);this._forEachLabelGraphic(t=>t.setVisibility(e))}return!0}getVisibilityFlag(e,t){return!!(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){let t=this.graphic.geometry;if(null==t)return!1;this._extent=(0,Q.vt)(),(0,K.iQ)(t,this._extent);let i=t.spatialReference;if(!(0,J.aI)(i,e)&&!tm(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,i){let r=e.geometry;return"mesh"!==r.type&&"extent"!==r.type||(r=tg.A.fromExtent("mesh"===r.type?r.extent:r)),(0,t_.Ux)(r,t,i)}get usedMemory(){let e=(0,tc.lM)(this.graphic.attributes);return this._forEachSymbolLayerGraphic(t=>e+=t.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){let e={render:{origin:(0,b.vt)(),num:0},draped:{origin:(0,ty.vt)(),num:0}};for(let t of this.layers)null!=t&&t.computeAttachmentOrigin(e);return e.render.num>1&&(0,N.h)(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&(0,tp.hs)(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,i,r,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?(0,X.Ie)(s.boundingBox):s.boundingBox=(0,X.Ie)(),s.requiresDrapedElevation=!1,await (0,eP.jJ)(this.layers,async a=>{if(null==a)return;let n="draped"===a.type?t:e,l=tb.acquire(),o=await a.getProjectedBoundingBox(n,i,s.screenSpaceObjects,r,l);isFinite(o[2])&&isFinite(o[5])||(s.requiresDrapedElevation=!0),o&&(0,X.RF)(s.boundingBox,l),tb.release(l)}),(0,X.vQ)(s.boundingBox)||(0,Q.vQ)((0,X.ES)(s.boundingBox,tv))?s:null}needsElevationUpdates(){for(let e of this.layers)if(null!=e&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;return this._labelLayers?.some(e=>e?.needsElevationUpdates??!1)??!1}alignWithElevation(e,t,i){this._forEachRenderedGraphic(r=>{"object3d"!==r.type&&"lod-instance"!==r.type||r.alignWithElevation(e,t,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,t,i){this._forEachRenderedGraphic(r=>{"object3d"===r.type&&r.alignWithAbsoluteElevation(e,t,i)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(t=>t.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}updateHighlights(e){this._forEachSymbolLayerGraphic(t=>t.updateHighlights(e))}_forEachGraphicList(e,t){e?.forEach(e=>e&&t(e))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}}var tC=i(57473),tx=i(51525);function tw(e){return 2216+4096*e.symbolLayers.length+e.complexity.memory.resourceBytes}class tE extends tx.x{set symbol(e){this._symbol=e,e.symbolLayers.forEach((t,i)=>{let r=this.symbolLayers[i];null!=r&&(r.symbol=e,r.symbolLayer=t)})}get symbol(){return this._symbol}constructor(e,t,i){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=[],this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));let r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;let s=[],{make:a}=await Promise.all([i.e(5171),i.e(8619),i.e(333),i.e(6058),i.e(5141)]).then(i.bind(i,49315));for(let i=0;i<r;i++){let n=t.at(i);if(!1===n.enabled)continue;tG.renderPriority=1-(1+i)/r,tG.renderPriorityStep=1/r,tG.ignoreDrivers=n.ignoreDrivers;let l=a(this.symbol,n,this._context,tG),o=(0,m.NY)(e,()=>{this.symbolLayers[i]=null,l.destroy()});o&&s.push(o),this.symbolLayers[i]=l}if(await (0,eP.jJ)(this.symbolLayers,async(e,t)=>{if(null!=e)try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}}),s.forEach(e=>e.remove()),(0,m.Te)(e),this.symbolLayers.length&&!this.symbolLayers.some(e=>!!e))throw Error()}getSymbolLayerSize(e){let t=this.symbolLayers[e];return null!=t?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e?.queryForSnapping)}updateFocus(e,t){this.symbolLayers.forEach(i=>i?.updateFocus(e,t))}createGraphics3DGraphic(e,t){let i=e.graphic,r=this.symbolLayers.map(t=>t?.createGraphics3DGraphic(e)??null),s=this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null;return new tS(i,t||this,r,e.layer,s)}get complexity(){return(0,eu.Tf)(this.symbolLayers.map(e=>null!=e?e.complexity:null))}globalPropertyChanged(e,t){let i=this.symbolLayers.length;for(let r=0;r<i;r++){let i=this.symbolLayers[r],s=e=>{let t=e.layers[r];return t instanceof eD.Y?t:null};if(null!=i&&!i.globalPropertyChanged(e,t,s))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==tx.P.LOADED?tC.w.RecreateSymbol:this.symbolLayers.reduce((i,r)=>i!==tC.w.RecreateSymbol&&null!=r?Math.min(i,r.applyRendererDiff(e,t)):i,tC.w.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===tx.P.FAILED||"partial"!==e.diff.type)return;let t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;let i=t.symbolLayers.diff;this.symbolLayers.forEach((t,r)=>{if(null==t)return;let s=i[r];if(s){let i={diff:s,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(i),e.symbolStatePatches.push(...i.symbolLayerStatePatches),i.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((e,t)=>{let s=e.layers[r];null!=s&&i.graphics3DGraphicPatches.forEach(e=>e(s,t))})}})}updateGeometry(e,t){return this._updateGeometryOrTransform(e,(e,i)=>e.updateGeometry(i,t))}updateTransform(e,t,i,r){return this._updateGeometryOrTransform(e,(e,s)=>e.updateTransform(s,t,i,r))}_updateGeometryOrTransform(e,t){for(let i=0;i<this.symbolLayers.length;i++){let r=this.symbolLayers[i];if(null==r)continue;let s=e.layers[i];if(!s||!t(r,s))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){let i=this.symbolLayers[t];if(null==i)continue;let r=e.layers[t];null!=r&&i.onRemoveGraphic(r)}}getFastUpdateStatus(){let e=!1,t=!1;for(let i of this.symbolLayers)if(null!=i){if(i.loadStatus===tx.P.LOADING)return tC.G.Loading;i.isFastUpdatesEnabled()?t=!0:e=!0}return t?e?tC.G.Mixed:tC.G.Fast:e?tC.G.Slow:tC.G.Undefined}async queryForSnapping(e,t,i,r){let s=this.symbolLayers.filter(V.Ru).filter(e=>null!=e.queryForSnapping).map(s=>s.queryForSnapping(e,t,i,r)),a=await Promise.all(s);return(0,m.Te)(r),a.flat()}destroy(){if(!this.destroyed){for(let e of(super.destroy(),this.symbolLayers))null!=e&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get cachedMemory(){return tw(this)}}let tG=new eG;class tP extends tE{constructor(e,t,i){super(e,t,i),this._calloutSymbolLayer=null,this.symbol.hasVisibleCallout()&&(this._calloutSymbolLayer=function(e,t){if(!(0,eA.YX)(e))return th().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;let i=td[e.callout.type];return i?new i(e,t):(th().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}(this.symbol,t))}async doLoad(e){let t=this._calloutSymbolLayer?(0,eP.Ke)(this._calloutSymbolLayer.load()):null;try{await super.doLoad(e),(0,m.Te)(e)}catch(e){throw this._calloutSymbolLayer?.abortLoad(),e}t&&await t}destroy(){super.destroy(),this._calloutSymbolLayer=(0,h.pR)(this._calloutSymbolLayer)}createGraphics3DGraphic(e,t){let i=super.createGraphics3DGraphic(e,t);if(null!=this._calloutSymbolLayer&&null!=i){let t=this._createCalloutGraphic(e);t&&i.setCalloutGraphic(t)}return i}globalPropertyChanged(e,t){return!!super.globalPropertyChanged(e,t)&&(!this._calloutSymbolLayer||this._calloutSymbolLayer.globalPropertyChanged(e,t,e=>e.calloutLayer))}updateGeometry(e,t){let i=super.updateGeometry(e,t);if(i&&this._calloutSymbolLayer){let i=e.calloutLayer;if(i)return this._calloutSymbolLayer.updateGeometry(i,t)}return i}_createCalloutGraphic(e){let t=e.renderingInfo;return e.renderingInfo=new to(t.renderer,t.symbol),this._calloutSymbolLayer.createGraphics3DGraphic(e)}}var tA=i(7800);class tO extends tx.x{constructor(e,t,i){super(t),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:0}async doLoad(e){let t=await this.symbol.fetchSymbol({signal:e,acceptedFormats:tA.t});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:eu.uD}globalPropertyChanged(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(e,t):tC.w.RecreateSymbol}prepareSymbolPatch(e){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.updateGeometry(e,t)}updateTransform(e,t,i,r){return this.graphics3DSymbol?.updateTransform(e,t,i,r)??!1}onRemoveGraphic(){}updateFocus(e,t){}getFastUpdateStatus(){return this.graphics3DSymbol?.getFastUpdateStatus()??tC.G.Loading}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}get cachedMemory(){return tw(this)}}class tL{constructor(e,t,i){this.visible=e,this.missing=t,this.pending=i}}class tR{constructor(e){this._graphicsCore=e,this._idToState=new Map,this._states=new Set;let t=e.owner.layer?.objectIdField;t?(this._getGraphicId=e=>(0,K.RW)(e,t),this._getGraphics3DGraphicById=e=>this._graphicsCore.getGraphics3DGraphicByObjectId(e)):(this._getGraphicId=e=>e.uid,this._getGraphics3DGraphicById=e=>this._graphicsCore.getGraphics3DGraphicById(e))}destroy(){this._idToState.clear(),this._states.forEach((e,t)=>this.remove(t))}add(e){let t=(0,g.hA)(()=>this.remove(e));if(this._states.has(e))return t;let i=this._getGraphicId(e.graphic),r=this._getGraphics3DGraphicById(i);return this._states.has(e)||this._states.add(e),this._ensureStateList(i).push(e),e.displaying=null!=r&&r.isVisible(),e.isDraped=null!=r&&r.isDraped,e.tracking=!0,null!=r&&e.emit("changed"),t}remove(e){if(this._states.has(e)){if(this._idToState.size){let t=this._getGraphicId(e.graphic),i=this._idToState.get(t);i&&((0,V.TF)(i,e),0===i.length&&this._idToState.delete(t))}this._states.delete(e),e.tracking=!1,e.displaying=!1}}addGraphic(e){this._forEachState(e.graphic,t=>{t.displaying=e.isVisible(),t.isDraped=e.isDraped,t.emit("changed")})}removeGraphic(e){this._forEachState(e.graphic,e=>{e.displaying=!1,e.isDraped=!1})}updateGraphicGeometry(e){this._forEachState(e.graphic,e=>e.emit("changed"))}updateGraphicVisibility(e){this._forEachState(e.graphic,t=>t.displaying=e.isVisible())}updateGraphicError(e,t){this._forEachState(e,e=>e.error=t)}allGraphicsDeleted(){this._states.forEach(e=>e.displaying=!1)}_ensureStateList(e){let t=this._idToState.get(e);if(t)return t;let i=[];return this._idToState.set(e,i),i}_forEachState(e,t){if(0===this._states.size||0===this._idToState.size)return;let i=this._getGraphicId(e),r=this._idToState.get(i);null!=r&&r.forEach(t)}}var tI=i(2370);let tD=class extends O.A{constructor(e){super(e),this._index=new tI.w(9,(0,u.A)("esri-csp-restrictions")?e=>({minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),this._missing=new Set,this._boundsByFeature=new Map,this.spatialReference=null,this.hasZ=null,this.hasM=null,this.objectIdField=null,this.updating=!1}setup(e){this._addMany(e)}destroy(){this._missing.clear(),this._index=(0,h.pR)(this._index),this._boundsByFeature.clear(),this._boundsByFeature=null}update(){this._missing.size>0&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}get updatingRemaining(){return this._missing.size}queryGraphicUIDsInExtent(e,t,i){null!=t&&t.equals(this.spatialReference)&&(tM.minX=e[0],tM.minY=e[1],tM.maxX=e[2],tM.maxY=e[3],this.update(),this._index.search(tM,e=>i(e.graphic.uid)))}add(e){this._missing.add(e),this.updating=!0}remove(e){if(this._missing.delete(e))return void(this.updating=this._missing.size>0);if(!e.extent)return;this._index.remove(e);let t=(0,K.RW)(e.graphic,this._get("objectIdField"));null!=t&&this._boundsByFeature.delete(t)}_addMany(e){if(0===e.length)return;let t=this._get("objectIdField");for(let i of e){i.computeExtent(this.spatialReference);let e=(0,K.RW)(i.graphic,t);null!=e&&this._boundsByFeature.set(e,i.extent)}this._index.load(e)}clear(){this._index.clear(),this._missing.clear(),this._boundsByFeature.clear(),this.updating=!1}forEachInBounds(e,t){tM.minX=e[0],tM.minY=e[1],tM.maxX=e[2],tM.maxY=e[3],this.update(),this._index.search(tM,e=>{t(e)})}getBounds(e,t){this.update();let i=this._boundsByFeature.get(e);return i?(0,X.Jt)(t,i):null}};(0,l._)([(0,c.MZ)({constructOnly:!0})],tD.prototype,"spatialReference",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],tD.prototype,"hasZ",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],tD.prototype,"hasM",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],tD.prototype,"objectIdField",void 0),(0,l._)([(0,c.MZ)()],tD.prototype,"updating",void 0),(0,l._)([(0,c.MZ)({readOnly:!0})],tD.prototype,"updatingRemaining",null),tD=(0,l._)([(0,y.$)("esri.views.3d.layers.graphics.SpatialIndex2D")],tD);let tM={minX:0,minY:0,maxX:0,maxY:0};var tF=i(8922),tT=i(23106);class tU{constructor(e="scene"){this.context=e,this.extent=(0,Q.Ie)()}}var tV=i(64835),tz=i(119);let tB=Symbol("layerHandles"),tj=class extends em.A.EventedMixin(O.A){get spatialReference(){return this.view?.spatialReference}constructor(e){super(e),this._elevationOffset=0}initialize(){this._renderCoordsHelper=this.view.renderCoordsHelper,this._intersectLayers=[this.stageLayer],this._intersector=(0,tV.hz)(this.view.state.viewingMode),this._intersector.options.store=tz.oH.MIN;let e=this._computeLayerExtent(this.spatialReference,this.stageLayer);this._zmin=e[2],this._zmax=e[5];let t=this.stageLayer.events;this.addHandles([t.on(["layerObjectAdded","layerObjectRemoved","geometryAdded","geometryRemoved"],({object:e})=>this._objectChanged(e)),t.on("attributesChanged",({attribute:e,object:t})=>(0,eH.b)(e)&&this._objectChanged(t)),t.on(["transformationChanged","shaderTransformationChanged"],e=>this._objectChanged(e))],tB)}dispose(){this.removeHandles(tB)}elevationInfoChanged(){let e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"on-the-ground"!==e.mode){let t=(0,tF.G9)(this.layer.spatialReference),i=(0,tT.Ao)(e.unit??"meters");this._elevationOffset=(e.offset??0)*i/t}else this._elevationOffset=0}getElevation(e,t,i,r){if(tk[0]=e,tk[1]=t,tk[2]=i,!this._renderCoordsHelper.toRenderCoords(tk,r,tk))return p.A.getLogger(this).error("could not project point for elevation alignment"),null;let s=this._elevationOffset,a=this._zmin+s,n=this._zmax+s;return this._renderCoordsHelper.setAltitude(tZ,n,tk),this._renderCoordsHelper.setAltitude(tq,a,tk),this._intersector.reset(tZ,tq,null),this._intersector.intersect(this._intersectLayers,null,1,null,e=>!!e.lastValidElevationBB),this._intersector.results.min.getIntersectionPoint(tk)?this._renderCoordsHelper.getAltitude(tk):null}_objectChanged(e){let t=this.spatialReference;if(!e.lastValidElevationBB||!t)return;(0,X.Ie)(tH);let i=e.lastValidElevationBB;i.isEmpty()||this._expandExtent(t,i.min,i.max,tH);let{min:r,max:s}=e.boundingVolumeWorldSpace;this._expandExtent(t,r,s,tH),(0,X.ES)(tH,tN.extent),this._zmin=Math.min(this._zmin,tH[2]),this._zmax=Math.max(this._zmax,tH[5]),tN.spatialReference=t,this.emit("elevation-change",tN),(0,N.c)(i.min,r),(0,N.c)(i.max,s)}_computeLayerExtent(e,t){return(0,X.Ie)(tH),null!=e&&t.objects.forAll(t=>this._expandExtent(e,t.boundingVolumeWorldSpace.min,t.boundingVolumeWorldSpace.max,tH)),tH}_expandExtent(e,t,i,r){for(let s=0;s<8;++s)tk[0]=1&s?t[0]:i[0],tk[1]=2&s?t[1]:i[1],tk[2]=4&s?t[2]:i[2],this._renderCoordsHelper.fromRenderCoords(tk,tk,e),(0,X.iT)(r,tk);return r}};(0,l._)([(0,c.MZ)({constructOnly:!0})],tj.prototype,"layer",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],tj.prototype,"stageLayer",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],tj.prototype,"view",void 0),(0,l._)([(0,c.MZ)()],tj.prototype,"spatialReference",null),tj=(0,l._)([(0,y.$)("esri.views.3d.layers.support.StageLayerElevationProvider")],tj);let tH=(0,X.Ie)(),tN=new tU,tk=(0,b.vt)(),tZ=(0,b.vt)(),tq=(0,b.vt)(),tW=(0,b.vt)();var tY=i(49892),t$=i(58462),tX=i(10638),tQ=i(68186),tJ=i(5901),tK=i(97303);let t0=(0,b.vt)(),t1=(0,X.vt)(),t3=a=class extends O.A{get _viewSpatialReference(){return this.owner.view.spatialReference}get spatialIndex(){return this._spatialIndex||(this._spatialIndex=new tD({objectIdField:this.owner.layer?.objectIdField,spatialReference:this._viewSpatialReference,hasZ:!!this.hasZ,hasM:!!this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values()))),this._spatialIndex.update(),this._spatialIndex}get deconflictor(){return this._deconflictor}get labeler(){return this._labeler}get numberOfGraphics(){return this._numberOfGraphics}get effectiveUpdatePolicy(){return null!=this.currentRenderer&&"dictionary"===this.currentRenderer.type?t$.q.ASYNC:this._forcedUpdatePolicy??this.preferredUpdatePolicy}get featureStore(){return this._featureStore}get initializePromise(){return this._initializePromise}get scaleVisibility(){return this._scaleVisibility}get elevationAlignment(){return this._elevationAlignment}get objectStates(){return this._objectStates}get filterVisibility(){return this._filterVisibility}get updating(){return!!(this.dataUpdating||this._elevationAlignment?.updating||this._scaleVisibility?.updating||this._filterVisibility?.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._frameTaskHandle.updating||this.running)}get dataUpdating(){return!!(this._graphicsWaitingForSymbol.size>0||this._pendingUpdates.size>0||this._spatialIndex?.updating||this._updatingPendingLoadedGraphicsChange||this._dataUpdateQueue.running||this._loadingSymbols>0)}get running(){return this._pendingUpdates.size>0||!!this._spatialIndex?.updating||this._dataUpdateQueue.running||this._updateQueue.running}get suspendedOrOutsideOfView(){return this.owner.suspended||!!this.owner.suspendInfo?.outsideOfView}get updatingRemaining(){return this.updating?this._pendingUpdates.size+.1*(this._spatialIndex?.updatingRemaining||0)+.1*(this._elevationAlignment?.updatingRemaining||0):0}get displayFeatureLimit(){let e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?.graphics3D.minTotalNumberOfFeatures??0,i=e?.graphics3D.maxTotalNumberOfFeatures??0,r=e?.graphics3D.maxNumberOfDrawCalls??0,s=e?.graphics3D.maxTotalNumberOfVertices??0,a=this.averageSymbolComplexity,n=Math.max(1,a?.verticesPerFeature??1),l=a&&a.drawCallsPerFeature>0&&r>0?r/a.drawCallsPerFeature:i,o=Math.max(t,Math.min(i,Math.ceil(s/n),l)),h=this._get("displayFeatureLimit");return h&&h.maximumTotalNumberOfVertices===s&&h.averageSymbolComplexity===a&&h.maximumNumberOfFeatures===o?h:new ep(s,o,a)}get averageSymbolComplexity(){let e=(0,eu.k9)(this._symbolComplexities),t=this._get("averageSymbolComplexity");return 0===e.numComplexities||null!=t&&(e.estimated&&(t.verticesPerFeature>=e.verticesPerFeature||t.verticesPerCoordinate>=e.verticesPerCoordinate||t.drawCallsPerFeature>=e.drawCallsPerFeature)||t.verticesPerFeature===e.verticesPerFeature&&t.verticesPerCoordinate===e.verticesPerCoordinate&&t.drawCallsPerFeature===e.drawCallsPerFeature)?t:e}get usedMemory(){let e=this.labelsEnabled?(this.averageSymbolComplexity?.memory.bytesPerFeatureLabel??0)*this._numberOfGraphics:0,t=this._getSymbolComplexitiesUsed().reduce((e,t)=>e+t.memory.resourceBytes,0);if(null==this._symbolMaterials){for(let e of(this._symbolMaterials=[],this._symbols.values()))if(null!=e){for(let t of e.symbolLayers)if(t)for(let e of t.materials)e&&this._symbolMaterials.push(e)}}let i=this.owner.view._stage.renderer,r=this.owner.view.basemapTerrain.overlayManager.renderer,s=this._symbolMaterials.reduce((e,t)=>e+((i.getMaterialRenderer(t)||r.getMaterialRenderer(t))?.usedMemory??0),0);return this._usedMemory+e+t+s}get usedMemoryPerGraphic(){if(this._usedMemory&&this._numberOfGraphics){let e=this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves));return this._usedMemory/this._numberOfGraphics*e}if(null!=this.averageSymbolComplexity){let e=this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0;return this.averageSymbolComplexity.memory.bytesPerFeature+e}return 0}get unprocessedMemoryEstimate(){return(this._pendingAdds-this._pendingRemoves)*this.usedMemoryPerGraphic}get _symbolComplexities(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}get visible(){return this._visible}_getConvertedSymbol(e){if("web-style"===e.type)return e.clone();let t=this._symbolConversionCache.get(e.id);if(null!=t)return t;let i=(0,ei.t)(e,{geometryType:this.layer?.geometryType??void 0,retainId:!0,hasLabelingContext:this._hasLabelingContext(e),cimFallbackEnabled:!0}),r=i.symbol||null;return null==r&&i.error&&p.A.getLogger(this).error(i.error.message),this._symbolConversionCache.set(e.id,r),r}_getSymbolComplexitiesUsedOrRenderer(e){if(null==e)return[];let t=e.symbols,i="backgroundFillSymbol"in e?e.backgroundFillSymbol:null;if(!i&&!t.length)return[];let r=[],s=this._getSymbolComplexityUsedOrRenderer(i);for(let e of(null!=s&&r.push(s),t)){let t=this._getSymbolComplexityUsedOrRenderer(e);null!=t&&r.push(t)}return r}_getSymbolComplexityUsedOrRenderer(e){if(null==e)return null;let t=this._symbols.get(e.id);if(null!=t)return t.complexity;let i=this._getConvertedSymbol(e);return null!=i?(0,eu.Eg)(i):null}_getSymbolComplexitiesUsed(){let e=[];return this._symbols.forEach(t=>{null!=t&&e.push(t.complexity)}),e}get _objectIdField(){return this.layer.objectIdField}constructor(e){super(e),this._propertiesPool=new tJ.M({computedExtent:k.A},this),this.computedExtent=null,this.currentRenderer=null,this.rendererHasGeometryOperations=!1,this._graphicStateTracking=null,this.graphics3DGraphics=new Map,this.stageLayer=null,this.stage=null,this._graphicsDrapedUids=new Set,this._graphicsBySymbol=new Map,this._symbolConversionCache=new Map,this._symbols=new Map,this._graphicsWithoutSymbol=new Map,this._graphicsWaitingForSymbol=new Map,this._graphicsUpdateId=0,this._frameTaskHandle=ey.nu,this._dataUpdateQueue=new ee.T,this._updateQueue=new ee.T,this._suspendSymbolCleanup=!1,this._arcadeOnDemand=null,this._rendererChangeAbortController=null,this._elevationInfoChangeAbortController=null,this._initializeAbortController=null,this._elevationAlignment=null,this._scaleVisibility=null,this._filterVisibility=null,this._spatialIndex=null,this.extentPadding=0,this._updatingPendingLoadedGraphicsChange=null,this._featureStore=null,this._deconflictor=null,this._labeler=null,this._objectStates=null,this._viewElevationProvider=null,this._stageLayerElevationProvider=null,this._sharedSymbolResourcesOwnerHandle=null,this._whenGraphics3DGraphicRequests={},this._pendingUpdates=new Map,this._numberOfGraphics=0,this._numberOfGraphicsProvidingElevation=0,this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1,this._loadingSymbols=0,this._pendingUpdatesPool=new j.A({allocator:e=>e||new t2,deallocator:e=>(e.clear(),e)}),this._symbolWarningLogged=!1,this._geometryWarningLogged=!1,this._objectIdInvisibleSet=new Set,this._whenSymbolRemoved=new j.A,this.preferredUpdatePolicy=t$.q.SYNC,this._forcedUpdatePolicy=null,this.elevationFeatureExpressionEnabled=!0,this.owner=null,this.layer=null,this.graphicSymbolSupported=!0,this.getRenderingInfoWithoutRenderer=!1,this.setUidToIdOnAdd=!0,this.hasZ=null,this.hasM=null,this._usedMemory=0,this._visible=!1,this._startCreateGraphics=!1,this._unusedSymbolsCache=e.owner.view.resourceController.memoryController.newCache("graphics-3d-unused-symbols",e=>e.destroy()),this.symbolCreationContext=new eE(e.owner.view.resourceController.scheduler,(e,t)=>this._updateQueue.push(e,t))}initialize(){this._featureStore=new eS({objectIdField:this.owner.layer?.objectIdField,hasZ:!!this.hasZ,hasM:!!this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:e=>this.graphics3DGraphics.forEach(e)});let e=(e,t,i)=>this.spatialIndex.queryGraphicUIDsInExtent(e,t,i),{componentFactories:t}=this;this._elevationAlignment=t.elevationAlignment?.(this,e),this._scaleVisibility=t.scaleVisibility?.(this,e),this._filterVisibility=t.filterVisibility?.({featureStore:this._featureStore,getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:e=>this.modifyGraphics3DGraphicVisibilities(t=>t.setVisibilityFlag(s.GRAPHIC,r.FILTER,e((0,K.RW)(t.graphic,this._objectIdField)))),setAllFeaturesVisibility:e=>this.modifyGraphics3DGraphicVisibilities(t=>t.setVisibilityFlag(s.GRAPHIC,r.FILTER,e)),clearFeaturesVisibility:()=>this.modifyGraphics3DGraphicVisibilities(e=>e.setVisibilityFlag(s.GRAPHIC,r.FILTER,!0))}),this._deconflictor=t.deconflictor?.(this),this._labeler=t.labeler?.(this,this._scaleVisibility),this._objectStates=t.objectStates?.(this),this._initializeAbortController=new AbortController,this.addHandles((0,d.z7)(()=>this.owner.view.state.highlights,()=>{let{highlightOrderMap:e}=this.owner.view.state;this.graphics3DGraphics.forEach(t=>t.updateHighlights(e))})),this._initializePromise=this._initializeAsync()}async _initializeAsync(){let e=this._initializeAbortController?.signal,t=this.owner.view;this._viewElevationProvider=new eg(this._viewSpatialReference,t),this._initializeStage(t,this.layer.uid);let i=t.sharedSymbolResources;this.symbolCreationContext.sharedResources=i,this._sharedSymbolResourcesOwnerHandle=i.addGraphicsOwner(this.owner),null!=this.currentRenderer&&(this.symbolCreationContext.renderer=this.currentRenderer),this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=i.streamDataRequester,this.symbolCreationContext.renderCoordsHelper=t.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.graphicsCoreOwner=this.owner,this.symbolCreationContext.localOriginFactory=new tY.g(t.renderSpatialReference),this.symbolCreationContext.elevationProvider=t.elevationProvider,this.symbolCreationContext.notifyGraphicGeometryChanged=e=>this.notifyGraphicGeometryChanged(e),this.symbolCreationContext.notifyGraphicVisibilityChanged=e=>this.notifyGraphicVisibilityChanged(e);let r=(0,G.MF)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);if(this.symbolCreationContext.featureExpressionInfoContext=await (0,G.q6)(r,this._viewSpatialReference,e,p.A.getLogger(this)),(0,m.Te)(e),this.symbolCreationContext.screenSizePerspectiveEnabled=t.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,this.symbolCreationContext.skipHighSymbolLods=!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,"drapeSourceType"in this.owner){let{owner:e}=this;this.symbolCreationContext.drapeSourceRenderer=t.basemapTerrain.overlayManager.registerGeometryDrapeSource(e),this.addHandles((0,g.hA)(()=>t.basemapTerrain.overlayManager.unregisterDrapeSource(e)))}this.addHandles([(0,d.wB)(()=>this.suspendedOrOutsideOfView,()=>this._updateQueue.unshift(()=>this._updateLayerVisibility(),null).catch(m.QZ)),(0,d.wB)(()=>[this.layer?.screenSizePerspectiveEnabled,this.owner.view?.screenSizePerspectiveEnabled],()=>{let e=t.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;e!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=e,this._labeler?.reset(),this.recreateAllGraphicsAndSymbols())}),(0,d.wB)(()=>this.owner.slicePlaneEnabled,e=>this._slicePlaneEnabledChange(!!e)),(0,d.wB)(()=>this.owner.view.state?.rasterPixelRatio,()=>this._pixelRatioChange()),(0,d.wB)(()=>!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,e=>this._physicalBasedRenderingChange(e)),(0,d.wB)(()=>!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,e=>this._skipHighSymbolLoDsChange(e)),(0,d.wB)(()=>this.owner.view.focusAreas.activePolygons,()=>this._updateFocusedLabels()),(0,d.wB)(()=>this.owner.view.focusAreas.style,()=>this.recreateAllGraphicsAndSymbols()),(0,d.z7)(()=>t.basemapTerrain?.tilingScheme,e=>{(e.spatialReference.equals(this.symbolCreationContext.overlaySR)||null==t.basemapTerrain.spatialReference||(this.symbolCreationContext.overlaySR=t.basemapTerrain.spatialReference),this.hasHandles("loaded-graphics"))?this.recreateAllGraphics():this.addHandles([(0,d.on)(()=>this.owner?.loadedGraphics,"change",e=>{this._graphicsCollectionChanged(e),this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics(),this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")},{initial:!0}),(0,d.wB)(()=>this.effectiveUpdatePolicy,e=>{null!=this.stageLayer&&(this.stageLayer.updatePolicy=e),this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===t$.q.ASYNC,e===t$.q.SYNC&&this.runTask(ey.Bb)},d.pc)]),this._frameTaskHandle=t.resourceController.scheduler.registerTask(ey.W6.GRAPHICS_CORE,this),this.layer&&"featureReduction"in this.layer&&this.addHandles((0,d.wB)(()=>this.layer.featureReduction,()=>this._deconflictor?.featureReductionChange())),this.notifyChange("averageSymbolComplexity"),this.rendererChange(this.owner.renderer).catch(()=>{}),this._initializeAbortController=null}_abortInitialize(){this._initializeAbortController&&(this._initializeAbortController.abort(),this._initializeAbortController=null)}_updateFocusedLabels(){this.forEachGraphics3DSymbol((e,t)=>{e.updateFocus(e=>{this.recreateGraphics([e.graphic])},t)})}destroy(){for(let e in this._unusedSymbolsCache.destroy(),this._abortInitialize(),this._rendererChangeAbortController=(0,h.DC)(this._rendererChangeAbortController),this._abortElevationInfoChange(),this._frameTaskHandle.remove(),this._frameTaskHandle=ey.nu,this._dataUpdateQueue.cancelAll(),this._updateQueue.cancelAll(),this._deconflictor=(0,h.xt)(this._deconflictor),this._labeler=(0,h.xt)(this._labeler),this._elevationAlignment=(0,h.pR)(this._elevationAlignment),this._scaleVisibility=(0,h.pR)(this._scaleVisibility),this._filterVisibility=(0,h.pR)(this._filterVisibility),this._objectStates=(0,h.pR)(this._objectStates),this.clear(),this._featureStore=(0,h.pR)(this._featureStore),this._updatingPendingLoadedGraphicsChange=(0,h.xt)(this._updatingPendingLoadedGraphicsChange),this._graphicStateTracking=(0,h.pR)(this._graphicStateTracking),this.stage&&(this.stageLayer=(0,h.pR)(this.stageLayer),this.stage=null),this._set("owner",null),this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[e].reject(new o.A("graphic:layer-destroyed","Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null,this._sharedSymbolResourcesOwnerHandle=(0,h.xt)(this._sharedSymbolResourcesOwnerHandle),this._propertiesPool=(0,h.pR)(this._propertiesPool),this._pendingUpdatesPool=null,this._symbolConversionCache.clear(),this._objectIdInvisibleSet.clear(),this._spatialIndex=(0,h.pR)(this._spatialIndex)}clear(){this._objectStates?.allGraphicsDeleted(),null!=this._graphicStateTracking&&this._graphicStateTracking.allGraphicsDeleted(),this.graphics3DGraphics.forEach(e=>e.destroy()),this._spatialIndex?.clear(),this.graphics3DGraphics.clear(),this._numberOfGraphics=0,this._usedMemory=0,this._updateLayerVisibility(),this._symbols.forEach(h.pR),this._symbols.clear(),this._symbolMaterials=null,this._graphicsBySymbol.clear(),this._graphicsWithoutSymbol.clear(),this._graphicsWaitingForSymbol.clear(),this._pendingUpdates.clear(),this._pendingUpdatesPool.clear(),this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1,this.notifyChange("dataUpdating"),this.notifyChange("running"),this.notifyChange("updatingRemaining"),this._featureStore.events.emit("changed")}_initializeStage(e,t){this.stage=e._stage,this.stageLayer=new tX.x(this.stage,{visible:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},t);let i=this.stageLayer.events;i.on("transformationChanged",e=>this.notifyGraphicGeometryChanged(e.graphicUid)),i.on("shaderTransformationChanged",e=>this.notifyGraphicGeometryChanged(e.graphicUid)),i.on("visibilityChanged",e=>this.notifyGraphicVisibilityChanged(e.graphicUid)),i.on("geometryAdded",e=>this.notifyGraphicGeometryChanged(e.object.graphicUid)),i.on("geometryRemoved",e=>this.notifyGraphicGeometryChanged(e.object.graphicUid)),i.on("attributesChanged",e=>(0,eH.b)(e.attribute)&&this.notifyGraphicGeometryChanged(e.object.graphicUid))}notifyGraphicGeometryChanged(e){if(null==this._graphicStateTracking||null==e)return;let t=this.graphics3DGraphics.get(e);t&&this._graphicStateTracking.updateGraphicGeometry(t)}notifyGraphicVisibilityChanged(e){if(null==this._graphicStateTracking||null==e)return;let t=this.graphics3DGraphics.get(e);t&&this._graphicStateTracking.updateGraphicVisibility(t)}_updateLayerVisibility(){let e=this.displayFeatureLimit.maximumNumberOfFeatures,t=this._numberOfGraphics>e*t5,i=!this.suspendedOrOutsideOfView&&!t;i!==this._visible&&(this._visible=i,this._updateStageLayerVisibility())}_updateStageLayerVisibility(){let e=this._visible&&(null==this.layer.opacity||this.layer.opacity>=e4.Q);this.stageLayer.visible!==e&&(this.stageLayer.visible=e,e?this.updateGraphicsVisibilities():this._hideAllGraphics())}getGraphics3DGraphicById(e){return null!=e?this.graphics3DGraphics.get(e):void 0}getGraphics3DGraphicByObjectId(e){return this.owner.layer?.objectIdField?this._findGraphics3DGraphicByObjectId(e):null}_getGraphicObjectID(e,t=this.owner.layer?.objectIdField){return(0,K.RW)(e,t)}get graphics3DGraphicsByObjectID(){let e=this.owner.layer?.objectIdField;if(!e)return;let t=new Map;return this.graphics3DGraphics.forEach(i=>{if(!i)return;let r=i.graphic,s=this._getGraphicObjectID(r,e);null!=s&&t.set(s,i)}),t}get labelsEnabled(){return!!this._labeler?.layerLabelsEnabled()}async updateLabelingInfo(e){let t=this._deconflictor?.labelingInfoChange(e),i=this._labeler?.labelingInfoChange(e);await Promise.allSettled([t,i])}updateVisibilityInfo(){this._deconflictor?.labelingInfoChange(),this._labeler?.visibilityInfoChange()}get symbolUpdateType(){if(this._pendingUpdates.size>0)return"unknown";let e=!1,t=!1;for(let[i,r]of this._symbols)if(null!=r)switch(r.getFastUpdateStatus()){case tC.G.Loading:return"unknown";case tC.G.Fast:this._graphicsBySymbol.has(i)&&(t=!0);break;case tC.G.Slow:this._graphicsBySymbol.has(i)&&(e=!0);break;case tC.G.Mixed:this._graphicsBySymbol.has(i)&&(t=e=!0);case tC.G.Undefined:}return t?e?"mixed":"fast":e?"slow":"mixed"}runTask(e){if(this._dataUpdateQueue.runTask(e),this._updateQueue.runTask(e),this._applyPendingUpdates(e),this.notifyChange("running"),this.running||this.notifyChange("dataUpdating"),this.notifyChange("updatingRemaining"),!e.hasProgressed)return tK.G}setObjectIdVisibility(e,t){t?this._objectIdInvisibleSet.delete(e):this._objectIdInvisibleSet.add(e);let i=this._findGraphics3DGraphicByObjectId(e);null!=i&&this._updateUserVisibility(i)}_findGraphics3DGraphicByObjectId(e){return(0,z.$n)(this.graphics3DGraphics,t=>this._getGraphicObjectID(t.graphic)===e)}_updateUserVisibility(e){if(null==e)return!1;let t=e.graphic,i=this._getGraphicObjectID(t),a=t.visible&&!this.owner.suspended&&this.stageLayer.visible&&(null==i||!this._objectIdInvisibleSet.has(i));return e.setVisibilityFlag(s.GRAPHIC,r.USER,a)}_whenGraphics3DGraphic(e){let t=this.graphics3DGraphics.get(e.uid);if(t)return Promise.resolve(t);let i=this._whenGraphics3DGraphicRequests[e.uid];if(i)return i.promise;let r=(0,m.Tw)();return this._whenGraphics3DGraphicRequests[e.uid]=r,r.promise}async _boundsForGraphics3DGraphic(e,t){let i=this._viewSpatialReference,r=this.owner.view.renderSpatialReference,s=this.owner.view.basemapTerrain.spatialReference,a=this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:null!=t&&!!t.useViewElevation,minDemResolution:null!=t?t.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:null,n=await e.getProjectedBoundingBox((e,t,s)=>(0,W.projectBuffer)(e,r,t,e,i,t,s),(e,t,r)=>(0,W.projectBuffer)(e,s,t,e,i,t,r),a,t?.signal);if(!n)return null;let l=n.boundingBox;if(n.requiresDrapedElevation){let e=this.symbolCreationContext.elevationProvider;if(e){(0,X.gX)(l,t0);let t=e.getElevation(t0[0],t0[1],0,i,"ground")??0;l[2]=Math.min(l[2],t),l[5]=Math.max(l[5],t)}}return{boundingBox:l,screenSpaceObjects:n.screenSpaceObjects}}async whenGraphicBounds(e,t){await (0,d.C_)(()=>this.owner?.loadedGraphics);let i=this.owner.layer?.objectIdField,r=this.owner.loadedGraphics.find(t=>t===e||null!=i&&null!=t.attributes&&e.attributes&&t.attributes[i]===e.attributes[i]);if(!r)throw new o.A("internal:graphic-not-part-of-view","Graphic is not part of this view");let s=await this._whenGraphics3DGraphic(r);return this._boundsForGraphics3DGraphic(s,t)}computeAttachmentOrigin(e,t){let i=this.graphics3DGraphics.get(e.uid);if(!i)return null;let r=i.computeAttachmentOrigin();if(0===r.render.num&&0===r.draped.num)return null;(0,N.i)(t9,0,0,0);let s=0;if(r.render.num>0){if(!(0,Y.F)(r.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,t4,t))return null;(0,N.g)(t9,t9,t4),s++}if(r.draped.num>0){let[e,i]=r.draped.origin,a=this._viewElevationProvider.getElevation(e,i,"ground")??0;if((0,N.i)(t4,e,i,a),!(0,Y.F)(t4,this._viewElevationProvider.spatialReference,t4,t))return null;(0,N.g)(t9,t9,t4),s++}return s>1&&(0,N.h)(t9,t9,1/s),new Z.A({x:t9[0],y:t9[1],z:t9[2],spatialReference:t})}getSymbolLayerSize(e,t){let i=this._symbols.get(e.id);if(null==i)throw new o.A("internal:symbol-not-part-of-view","Symbol is not part of this view");let r=e.symbolLayers.indexOf(t);if(-1===r)throw new o.A("internal:missing-symbol-layer","Symbol layer is not in symbol");let s=i.getSymbolLayerSize(r);if(null==s)throw new o.A("internal:missing-size","Symbol layer has no valid size");return s}_graphicsCollectionChanged(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))}graphicUpdateHandler(e){let t=e.graphic.uid,i=this.graphics3DGraphics.get(t);if(null!=i||null!=this._graphicsWithoutSymbol.get(t))switch(e.property){case"visible":this._graphicUpdateVisibleHandler(i);break;case"geometry":this._graphicUpdateGeometryHandler(i,e);break;case"symbol":this._graphicUpdateSymbolHandler(i,e);break;case"attributes":break;case"origin-transform":this._graphicUpdateTransformHandler(i,e)}}_graphicUpdateGeometryHandler(e,t){this._graphicUpdateGeometryOrTransformHandler(e,t,()=>!(null==t.newValue||null==e||!e.graphics3DSymbol.updateGeometry(e,t.newValue)||!(this._labeler?.updateGraphicGeometry(e)??1))&&(this._labeler?.setDirty(),!0));let i=t.graphic.geometry;null!=i&&this._expandComputedExtent(i)}_graphicUpdateTransformHandler(e,t){let i=t.graphic.geometry;this._graphicUpdateGeometryOrTransformHandler(e,t,()=>null!=t.newValue&&null!=e&&null!=i&&e.graphics3DSymbol.updateTransform(e,i.spatialReference,t.newValue,t.action))}_graphicUpdateGeometryOrTransformHandler(e,t,i){if(null!=t.graphic.geometry)if(null!=e)i()||this._recreateGraphic(e.graphic);else{let e=t.graphic.symbol?.id;if(e){let t=this._symbols.get(e);if(null!=t&&t.loadStatus===tx.P.LOADING)return}this._recreateGraphic(t.graphic)}else this._recreateGraphic(t.graphic)}_graphicUpdateSymbolHandler(e,t){let i=t.graphic,r=null!=e?e.graphics3DSymbol:null!=t.oldValue?this._symbols.get(t.oldValue.id):null;if(null==r||null==t.newValue)return void this._recreateGraphic(i);let s=r.symbol,a=this._getConvertedSymbol(t.newValue);if(null!=a&&(a.type!==s.type||"web-style"===a.type)||"web-style"===s.type)return void this._recreateGraphic(i);let n=this._graphicsBySymbol.get(s.id);if(n&&1!==n.size)return void this._recreateGraphic(i);let l=(0,L.Ui)(s,a);if(null==l)return void this._updateSymbolMapping(s.id,a);let o={diff:l,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(r.prepareSymbolPatch(o),!(0,L.Im)(o.diff))return void this._recreateGraphic(i);let h=this._getRenderingInfo(i);if(null==h)return void this._recreateGraphic(i);let d=r.extentPadding;for(let e of o.symbolStatePatches)e();if(d!==r.extentPadding&&this._recomputeExtentPadding(),null!=e)for(let t of o.graphics3DGraphicPatches)t(e,h);this._updateSymbolMapping(s.id,a)}_graphicUpdateVisibleHandler(e){this._updateUserVisibility(e)&&(this._labeler?.setDirty(),this._deconflictor?.setDirty())}recreateGraphics(e){this._suspendSymbolCleanup=!0,this.remove(e),this.add(e),this._suspendSymbolCleanup=!1,this.effectiveUpdatePolicy===t$.q.SYNC&&this._cleanupSymbols()}_recreateGraphic(e){this.recreateGraphics([e])}_beginGraphicUpdate(e){let t=this._graphicsUpdateId;return this._graphicsUpdateId++,this._graphicsWaitingForSymbol.set(e.uid,t),1===this._graphicsWaitingForSymbol.size&&this.notifyChange("dataUpdating"),t}_endGraphicUpdate(e,t){e&&(t&&this._graphicStateTracking?.updateGraphicError(e,t),this._graphicsWaitingForSymbol.delete(e.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating")))}_recomputeExtentPadding(){let e=0;this._symbols.forEach(t=>{null!=t&&(e=Math.max(e,t.extentPadding))}),this._set("extentPadding",e)}_expandComputedExtent(e){let t=e.spatialReference;(0,K.w9)(e,t1);let i=this._viewSpatialReference,r=a.tmpVec;if((0,J.aI)(t,i)||(0,$.L)(t1[0],t1[1],0,t,r,i)&&(t1[0]=r[0],t1[1]=r[1],(0,$.L)(t1[3],t1[4],0,t,r,i),t1[3]=r[0],t1[4]=r[1]),!(isFinite(t1[0])&&isFinite(t1[3])&&isFinite(t1[1])&&isFinite(t1[4])))return;let s=this.computedExtent,n=null,l=isFinite(t1[2])&&isFinite(t1[5]),o=l&&(null==s?.zmin||t1[2]<s.zmin),h=l&&(null==s?.zmax||t1[5]>s.zmax);s?(t1[0]<s.xmin||t1[1]<s.ymin||t1[3]>s.xmax||t1[4]>s.ymax||o||h)&&((n=this._propertiesPool.get("computedExtent")).xmin=Math.min(t1[0],s.xmin),n.ymin=Math.min(t1[1],s.ymin),n.xmax=Math.max(t1[3],s.xmax),n.ymax=Math.max(t1[4],s.ymax),n.spatialReference=i):((n=this._propertiesPool.get("computedExtent")).xmin=t1[0],n.ymin=t1[1],n.xmax=t1[3],n.ymax=t1[4],n.spatialReference=i),n&&(o&&(n.zmin=t1[2]),h&&(n.zmax=t1[5]),this._set("computedExtent",n))}_abortElevationInfoChange(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),this._elevationInfoChangeAbortController=null)}async elevationInfoChange(){this._abortElevationInfoChange();let e=new AbortController;this._elevationInfoChangeAbortController=e;let t=(0,G.MF)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await (0,G.q6)(t,this._viewSpatialReference,e.signal,p.A.getLogger(this)),(0,m.Te)(e.signal),this._elevationInfoChangeAbortController=null,this._labeler?.elevationInfoChange(),this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("elevationInfo",t)?t.forEach(e=>{let t=e.graphic;for(let i of e.labelLayers)i.graphics3DSymbolLayer.updateGraphicElevationContext(t,i)}):this._recreateSymbol(i)}),this.updateStageLayerElevationProvider(),this._elevationAlignment?.elevationInfoChange()}updateStageLayerElevationProvider(){this._stageLayerElevationProvider?(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=(0,h.WD)(this._stageLayerElevationProvider)):(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&this._numberOfGraphicsProvidingElevation>0&&(this._stageLayerElevationProvider=new tj({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))}_clearSymbolsAndGraphics(){this.clear(),null!=this._filterVisibility&&this._filterVisibility.clear(),this._labeler?.reset(),this._deconflictor?.clear(),this._elevationAlignment?.clear(),this.stageLayer?.invalidateSpatialQueryAccelerator(),this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=(0,h.WD)(this._stageLayerElevationProvider))}startCreateGraphics(){this._startCreateGraphics=!0,this.recreateAllGraphics()}recreateAllGraphics(){this._recreateAllGraphics(!1)}recreateAllGraphicsAndSymbols(){this._recreateAllGraphics(!0)}_recreateAllGraphics(e=!1){if(!this._startCreateGraphics)return;let{loadedGraphics:t,view:i}=this.owner,r=i.basemapTerrain.tilingScheme&&t?.length?t.toArray():null;!e&&r||this._clearSymbolsAndGraphics(),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this._set("computedExtent",null),r&&(e?this.add(r):this.recreateGraphics(r))}_recreateSymbol(e){let t=this._graphicsBySymbol.get(e),i=[];t&&(t.forEach((e,t)=>{let r=e.usedMemory;this._conditionalRemove(e,t),this._spatialIndex?.remove(e),i.push(e.graphic),e.destroy(),this._removeGraphics3DGraphic(t,r),this._updateLayerVisibility(),this._featureStore.events.emit("changed")}),this._graphicsBySymbol.set(e,new Map));let r=this._symbols.get(e);(0,h.pR)(r),this._symbols.delete(e),this._symbolMaterials=null,this.add(i)}_recreateGraphicsForSymbol(e){let t=this._graphicsBySymbol.get(e);if(t){let e=[];t.forEach(t=>e.push(t.graphic)),this.recreateGraphics(e)}}_conditionalRemove(e,t){this._graphicsDrapedUids.delete(t),this._objectStates?.removeGraphic(e),this._labeler?.removeGraphic(e),this._deconflictor?.removeGraphic(e),null!=this._graphicStateTracking&&this._graphicStateTracking.removeGraphic(e)}add(e){e&&0!==e.length&&(this.owner.view.basemapTerrain?.tilingScheme?(this._updatePolicyForGraphics(e)===t$.q.ASYNC?this._addDelayed(e):this._addImmediate(e),this.notifyChange("dataUpdating")):p.A.getLogger(this).error("#add()","Cannot add graphics before terrain surface has been initialized"))}_updatePolicyForGraphics(e){if(this.effectiveUpdatePolicy===t$.q.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType)){for(let t of e)if(null!=t.geometry&&"mesh"===t.geometry.type&&!t.geometry.loaded)return t$.q.ASYNC}return this.effectiveUpdatePolicy}_addImmediate(e){for(let t of(this._geometryWarningLogged=!1,this._symbolWarningLogged=!1,e))this._addGraphic(t,this._getRenderingInfo(t,p.A.getLogger(this)),t$.q.SYNC);this._cleanupSymbols(),this._labeler?.setDirty(),this._deconflictor?.setDirty()}_addDelayed(e){for(let t of e){let e=t.uid,i=this._pendingUpdates.get(e);i?i.add?i.state!==n.NEW&&i.abortController?.abort():this._pendingAdds++:(i=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(e,i)),i.add=t}this.notifyChange("running"),this.notifyChange("updatingRemaining"),this.notifyChange("dataUpdating")}remove(e){this.effectiveUpdatePolicy===t$.q.ASYNC?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("dataUpdating")}_removeImmediate(e){for(let t of e)this._removeGraphic(t);this._cleanupSymbols(),this._labeler?.setDirty(),this._deconflictor?.setDirty()}_removeDelayed(e){for(let t of e){let e=t.uid,i=this._pendingUpdates.get(e);if(i)i.add&&(i.remove?i.add=null:this._pendingUpdates.delete(e),i.state===n.LOADING&&i.abortController?.abort(),this._pendingAdds--);else{let i=this._pendingUpdatesPool.pushNew();i.remove=t,this._pendingUpdates.set(e,i),this._pendingRemoves++,this._applyPendingRemovesFirst=!0}}0===this._pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("updatingRemaining"),this.notifyChange("dataUpdating")}_finishPendingUpdates(){this._pendingUpdatesPool.clear(),this._cleanupSymbols(),(this._pendingAdds||this._pendingRemoves)&&p.A.getLogger(this).warn("pendingAdds/Removes in inconsistent state!"),this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1}_applyPendingUpdates(e){if(this._geometryWarningLogged=!1,this._symbolWarningLogged=!1,0===this._pendingUpdates.size&&this._spatialIndex?.updating)return this._spatialIndex.update(),void e.madeProgress();if(this._applyPendingRemovesFirst)for(let[t,i]of(this._applyPendingRemovesFirst=!1,this._pendingUpdates)){if(e.done){this._applyPendingRemovesFirst=!0;break}if(i.remove&&!i.add&&(this._pendingRemoves--,e.madeProgress(),this._removeGraphic(i.remove),i.remove=null,this._pendingUpdates.delete(t),0===this._pendingRemoves))break}for(let[t,i]of this._pendingUpdates){if(e.done)break;i.add&&i.state===n.NEW&&this._processPendingUpdateNew(i);let r=this.effectiveUpdatePolicy;if(!i.remove||i.add&&i.state!==n.READY||(this._pendingRemoves--,e.madeProgress(),this._removeGraphic(i.remove),i.remove=null,r=t$.q.SYNC),i.add)switch(i.state){case n.READY:this._addGraphic(i.add,i.renderingInfo,r),i.add=null,this._pendingAdds--,e.madeProgress();break;case n.REJECTED:i.add=null,this._pendingAdds--;case n.LOADING:}null==i.remove&&null==i.add&&this._pendingUpdates.delete(t)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("dataUpdating"))}_processPendingUpdateNew(e){if(!e.add)return void(e.state=n.READY);let t=e.add.geometry;null==t||"mesh"!==t.type||t.loaded?this._processPendingUpdateNewRenderingInfo(e):this._processPendingUpdateNewMesh(e,t)}async _processPendingUpdateNewMesh(e,t){e.state=n.LOADING,e.abortController=new AbortController;let i=e.abortController.signal;try{await t.load({signal:i})}catch(t){return this._processPendingUpdateNewError(e,t)}e.abortController=null,this._processPendingUpdateNewRenderingInfo(e)}_processPendingUpdateNewError(e,t){e.abortController=null,(0,m.zf)(t)?e.state=n.NEW:e.state=n.REJECTED}async _processPendingUpdateNewRenderingInfo(e){if(null==this.layer.renderer||"dictionary"!==this.layer.renderer.type)return e.renderingInfo=this._getRenderingInfo(e.add,p.A.getLogger(this)),void(e.state=n.READY);e.state=n.LOADING,e.abortController=new AbortController;let t=null;try{t=await this._getRenderingInfoAsync(e.add,{signal:e.abortController.signal})}catch(t){return e.abortController=null,void((0,m.zf)(t)?e.state=n.NEW:e.state=n.REJECTED)}null==t?.symbol?(this._symbolWarningLogged||(this._symbolWarningLogged=!0,p.A.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),e.renderingInfo=null):e.renderingInfo=t,e.state=n.READY}_addGraphic(e,t,i){if(this._graphicsWithoutSymbol.set(e.uid,e),null==t?.symbol||!(0,K.N3)(e))return;let r=this.stage.renderView.olidRenderHelper;if(r&&this.setUidToIdOnAdd){let t=(0,el.ns)(this.owner.view.map,this.layer.uid);r.setUidToObjectAndLayerId(e.objectId,e.uid,this.layer.id,this.layer.uid,!!this.layer.popupEnabled&&!t&&(0,tQ.d0)(this.layer,this.owner.view.popup?.defaultPopupTemplateEnabled))}let s=t.symbol,a=this.getOrCreateGraphics3DSymbol(s,t.renderer);if(null==a)return;this._expandComputedExtent(e.geometry);let n=this._beginGraphicUpdate(e),l=new ex(e,t,this.layer),o=!1,h=e=>{e===a.symbol.id&&(o=!0)};this._whenSymbolRemoved.push(h);let d=()=>{if(--this._loadingSymbols,!this.destroyed){if(this._whenSymbolRemoved.removeUnordered(h),this._graphicsWaitingForSymbol.get(e.uid)!==n||o||a.destroyed||this.graphicSymbolSupported&&e.symbol&&e.symbol.id!==a.symbol.id)--a.referenced,this._cleanupSymbols();else{let t=this._createGraphics3DGraphic(a,l);this._spatialIndex&&null!=t&&this._spatialIndex.add(t),--a.referenced,this._endGraphicUpdate(e)}this._featureStore.events.emit("changed"),this._labeler?.setDirty()}},c=t=>{--this._loadingSymbols,this.destroyed||(this._whenSymbolRemoved.removeUnordered(h),o||((0,m.zf)(t)?this.add([e]):a.destroyed||this._endGraphicUpdate(e,t)))};++this._loadingSymbols,i===t$.q.ASYNC?a.load(()=>this._dataUpdateQueue.push(d,null).catch(m.QZ),e=>this._dataUpdateQueue.push(()=>c(e),null).catch(m.QZ)):a.load(d,c)}_removeGraphic(e){let t=e.uid,i=this.graphics3DGraphics.get(t);if(i){i.graphics3DSymbol.onRemoveGraphic(i);let e=i.usedMemory,r=i.isElevationSource;this._conditionalRemove(i,t),this._spatialIndex?.remove(i);let s=i.graphics3DSymbol.symbol.id;this._graphicsBySymbol.get(s)?.delete(t),this._graphicsWithoutSymbol.delete(t),this._removeGraphics3DGraphic(t,e,r),i.destroy(),this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(t),this._graphicsWaitingForSymbol.delete(t),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating"))}_hasLabelingContext(e){if(e instanceof eo.A||e instanceof eh.A){let t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(t=>t.symbol===e)}return!1}_hasValidSymbolCreationContext(e){return!(e instanceof eo.A&&!this._hasLabelingContext(e))||(p.A.getLogger(this).error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1)}_getRenderingInfo(e,t){let i,r=e.geometry;if(null==r)return t&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!(0,q.canProjectWithoutEngine)(r.spatialReference,this._viewSpatialReference))return t&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&null!=e.symbol)return t&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;let s=this.rendererHasGeometryOperations?(0,D.wP)(e,this.layer):e;if(this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||null!=this.currentRenderer))i=this.owner.getRenderingInfo(s,this.currentRenderer,this._arcadeOnDemand);else{let e=s.symbol||(0,ec.dX)(s.geometry);i=new ea.$(null,e)}return null==i?.symbol?(t&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,t.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):i}_getRenderingInfoAsync(e,t){if(null==e.geometry)return this._geometryWarningLogged||(this._geometryWarningLogged=!0,p.A.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&null!=e.symbol)return this._symbolWarningLogged||(this._symbolWarningLogged=!0,p.A.getLogger(this).warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;let i=this.rendererHasGeometryOperations?(0,D.wP)(e,this.layer):e;return this.owner.getRenderingInfoAsync(i,this.currentRenderer,this._arcadeOnDemand,t)}_createGraphics3DSymbol(e,t){var i,r;let s;if(!this._hasValidSymbolCreationContext(e))return null;let a=this._getConvertedSymbol(e);if(!a)return null;if(null!=t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){let e=(0,ei.t)(t.backgroundFillSymbol,{ignoreDrivers:!0});null!=e.symbol&&(s=e.symbol.symbolLayers)}let n=(i=this.symbolCreationContext,r=s,"point-3d"===a.type?new tP(a,i,r):new tE(a,i,r));return n.load(()=>{let e=n.extentPadding;e>this.extentPadding&&this._set("extentPadding",e),this.notifyChange("averageSymbolComplexity")},()=>{}),n}getOrCreateGraphics3DSymbol(e,t){let i=this._symbols.get(e.id);if(void 0===i){let r=this._unusedSymbolsCache.pop(e.id);i=null!=r?r:e instanceof ed.A?new tO(e,e=>this._dataUpdateQueue.push(e,null),e=>this._createGraphics3DSymbol(e,t)):this._createGraphics3DSymbol(e,t),this._symbols.set(e.id,i),this._symbolMaterials=null}return null!=i&&++i.referenced,i}trackGraphicState(e){return null==this._graphicStateTracking&&(this._graphicStateTracking=new tR(this)),this._graphicStateTracking.add(e)}_addGraphics3DGraphic(e){this._usedMemory+=e.usedMemory,this.graphics3DGraphics.set(e.graphic.uid,e),this._numberOfGraphics++,e.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider()),this._updateLayerVisibility()}_removeGraphics3DGraphic(e,t,i=!1){this._usedMemory-=t,this.graphics3DGraphics.delete(e),this._numberOfGraphics--,i&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider()),this._updateLayerVisibility()}_createGraphics3DGraphic(e,t){let i=t.graphic;if(this._graphicsWithoutSymbol.delete(i.uid),!this._symbols.has(e.symbol.id))return this.add([i]),null;if(this.graphics3DGraphics.has(i.uid))return null;let a=e.createGraphics3DGraphic(t);if(null==a)return null;this._addGraphics3DGraphic(a);let n=e.symbol.id;if(this._graphicsBySymbol.has(n)||this._graphicsBySymbol.set(n,new Map),this._graphicsBySymbol.get(n).set(i.uid,a),a.isDraped&&this._graphicsDrapedUids.add(i.uid),a.centroid=null,null!=i.geometry&&"point"!==i.geometry.type&&(a.centroid=(0,eT.W$)(i.geometry,this._viewSpatialReference)),this._updateUserVisibility(a),null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(a),null!=this._filterVisibility){let{defaultVisibility:e}=this._filterVisibility;a.setVisibilityFlag(s.GRAPHIC,r.FILTER,e),e||this._filterVisibility.reapply()}this._deconflictor?.addGraphic(a),this._labeler?.addGraphic(a),this._objectStates?.addGraphic(a),a.initialize(this.stageLayer),null!=this._graphicStateTracking&&this._graphicStateTracking.addGraphic(a);let l=this._whenGraphics3DGraphicRequests[i.uid];return l&&(delete this._whenGraphics3DGraphicRequests[i.uid],l.resolve(a)),this._symbolMaterials=null,a}async rendererChange(e){if(this._rendererChangeAbortController=(0,h.DC)(this._rendererChangeAbortController),e!==this.currentRenderer)if(this._validateRenderer(e),null==e&&this._currentRendererChange(null,!1),er(e))if(e?.arcadeRequired){let t=new AbortController;this._rendererChangeAbortController=t;let{arcadeUtils:i}=await this._ensureArcade();(0,m.Te)(t);let r=i.hasGeometryOperations(e);r&&(await i.enableGeometryOperations(),(0,m.Te)(t)),this.effectiveUpdatePolicy===t$.q.ASYNC?await this._updateQueue.push(()=>this._currentRendererChange(e,r),t.signal):this._currentRendererChange(e,r),this._rendererChangeAbortController=null}else if(this.effectiveUpdatePolicy===t$.q.ASYNC){let t=new AbortController;this._rendererChangeAbortController=t,await this._updateQueue.push(()=>this._currentRendererChange(e,!1),t.signal),this._rendererChangeAbortController=null}else this._currentRendererChange(e,!1);else this._currentRendererChange(e,!1)}async _ensureArcade(){return null==this._arcadeOnDemand&&(this._arcadeOnDemand=await (0,en.lw)()),this._arcadeOnDemand}_currentRendererChange(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t,this.symbolCreationContext.arcade=this._arcadeOnDemand;let i=this.symbolCreationContext.renderer;if(e===i)return;if(this._symbolConversionCache.clear(),this._unusedSymbolsCache.clear(),null==e)return this.symbolCreationContext.renderer=null,void this.recreateAllGraphicsAndSymbols();let r=(0,L.Ui)(i,e);this._updateUnchangedSymbolMappings(r,e,i),this.symbolCreationContext.renderer=e,null!=r&&("complete"===r.type?this.recreateAllGraphicsAndSymbols():"partial"===r.type&&(this._applyRendererDiff(r,e,i)?this._labeler?.reset():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}_diffHasSymbolChange(e){for(let t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"uniqueValueGroups":case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1}_applySymbolSetDiff(e,t,i){e=e||[];let r=[];for(let s of t=t||[]){let t=this._graphicsBySymbol.get(s.id);t&&t.forEach((a,n)=>{let l=a.graphic,o=this.layer instanceof I.A?this.layer:null,h=this._arcadeOnDemand;if(s===i.defaultSymbol&&i.getSymbol((0,D.wP)(l,o),{arcade:h})===i.defaultSymbol)return;let d=a.usedMemory;e.length||i.defaultSymbol?r.push(l):this._graphicsWithoutSymbol.set(n,l);let c=this.graphics3DGraphics.get(n);this._conditionalRemove(c,n),a.destroy(),t.delete(n),this._removeGraphics3DGraphic(n,d),this._updateLayerVisibility()}),this._whenSymbolRemoved.forAll(e=>e(s.id))}(e.length||r.length)&&(this._graphicsWithoutSymbol.forEach(e=>r.push(e)),this._graphicsWithoutSymbol.clear(),this.add(r)),this._cleanupSymbols(),this._labeler?.setDirty(),this._deconflictor?.setDirty()}_applyUniqueValueRendererDiff(e,t,i){let r=e.diff.defaultSymbol,s=e.diff.uniqueValueInfos;if(r||s){let a=s?s.added.map(e=>e.symbol).filter(V.Ru):[],n=s?s.removed.map(e=>e.symbol).filter(V.Ru):[];if(s)for(let e=0;e<s.changed.length;e++)a.push(s.changed[e].newValue.symbol),n.push(s.changed[e].oldValue.symbol);return r?(i.defaultSymbol&&n.push(i.defaultSymbol),t.defaultSymbol&&a.push(t.defaultSymbol)):i.defaultSymbol&&a.length&&n.push(t.defaultSymbol),this._applySymbolSetDiff(a,n,t),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1}_calculateUnchangedSymbolMapping(e,t,i){let r;if("unique-value"!==t?.type||"unique-value"!==i?.type||null!=e&&"partial"!==e.type)return[];let s=e=>null!=e?e.id:null,a=e&&e.diff,n=a?.defaultSymbol,l=a&&a.uniqueValueInfos;if(l)r=l.unchanged.map(e=>({oldId:s(e.oldValue.symbol),newId:s(e.newValue.symbol)}));else for(let e of(r=[],i.uniqueValueInfos??[])){let i=s(e.symbol),a=t.uniqueValueInfos?.find(t=>t.value===e.value);a&&i!==s(a.symbol)&&r.push({oldId:i,newId:s(a.symbol)})}return!n&&i.defaultSymbol&&r.push({oldId:s(i.defaultSymbol),newId:s(t.defaultSymbol)}),r}_updateSymbolMapping(e,t){let i=null!=t&&t?"string"==typeof t?t:t.id:null;if(null==e||e===i)return;let r=this._graphicsBySymbol.get(e);this._graphicsBySymbol.delete(e),void 0!==r&&this._graphicsBySymbol.set(i,r);let s=this._symbols.get(e);if(void 0!==s&&(this._symbols.delete(e),this._symbols.set(i,s),this._symbolMaterials=null,null!=s)){let e="string"==typeof t?null:t;null!=e?s.symbol=e:s.symbol.id=i}}_updateUnchangedSymbolMappings(e,t,i){for(let{oldId:r,newId:s}of this._calculateUnchangedSymbolMapping(e,t,i))this._updateSymbolMapping(r,s)}_applyRendererDiff(e,t,i){if(this._diffHasSymbolChange(e))return!1;if(t instanceof et.A&&i instanceof et.A&&this._applyUniqueValueRendererDiff(e,t,i)&&0===Object.keys(e.diff).length)return!0;for(let i of this._graphicsBySymbol.keys()){let r=this._symbols.get(i);if(null!=r)switch(r.applyRendererDiff(e,t)){case tC.w.RecreateSymbol:this._recreateSymbol(i);break;case tC.w.RecreateGraphics:this._recreateGraphicsForSymbol(i);case tC.w.FastUpdate:}}return!0}opacityChange(){this._updateStageLayerVisibility(),this.forEachGraphics3DSymbol((e,t)=>e.globalPropertyChanged("opacity",t))}_slicePlaneEnabledChange(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.sliceable=e,this.forEachGraphics3DSymbol((e,t)=>e.globalPropertyChanged("slicePlaneEnabled",t)),this._deconflictor?.slicePlaneEnabledChange(),this._labeler?.slicePlaneEnabledChange())}_physicalBasedRenderingChange(e){this.symbolCreationContext.physicalBasedRenderingEnabled=e,this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("physicalBasedRenderingEnabled",t)||this._recreateSymbol(i)})}_skipHighSymbolLoDsChange(e){this.symbolCreationContext.skipHighSymbolLods=e,this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("skipHighSymbolLods",t)||this._recreateSymbol(i)})}_pixelRatioChange(){this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("pixelRatio",t)||this._recreateSymbol(i)})}_signalUpdatingDuringAsyncLoadedGraphicsChange(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=(0,H._)(()=>{this._updatingPendingLoadedGraphicsChange=null})}setClippingExtent(e,t){let i=this.symbolCreationContext.clippingExtent,r=(0,Q.vt)();return!function(e,t,i){if(null==e||null==i)return!1;let r=!0;return tW[0]=null!=e.xmin?e.xmin:0,tW[1]=null!=e.ymin?e.ymin:0,tW[2]=null!=e.zmin?e.zmin:0,r=r&&(0,W.projectBuffer)(tW,e.spatialReference,0,tW,i,0),t[0]=tW[0],t[1]=tW[1],tW[0]=null!=e.xmax?e.xmax:0,tW[1]=null!=e.ymax?e.ymax:0,tW[2]=null!=e.zmax?e.zmax:0,r=r&&(0,W.projectBuffer)(tW,e.spatialReference,0,tW,i,0),t[2]=tW[0],t[3]=tW[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),r}(e,r,t)?this.symbolCreationContext.clippingExtent=null:this.symbolCreationContext.clippingExtent=(0,X.Jt)((0,X.vt)(),r),!(0,X.aI)(this.symbolCreationContext.clippingExtent,i)}modifyGraphics3DGraphicVisibilities(e){if(this.destroyed)return;let t=!1;this.graphics3DGraphics.forEach(i=>{e(i)&&(t=!0)}),t&&(this._labeler?.setDirty(),this._deconflictor?.setDirty())}forEachGraphics3DSymbol(e){for(let[t,i]of this._symbols){if(null==i)return;e(i,this._graphicsBySymbol.get(t)||t8,t)}}updateGraphicsVisibilities(){null!=this._filterVisibility&&this._filterVisibility.reapply(),this.modifyGraphics3DGraphicVisibilities(e=>{let t=this._updateUserVisibility(e),i=null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(e);return t||i})}_hideAllGraphics(){this.modifyGraphics3DGraphicVisibilities(e=>e.setVisibilityFlag(s.GRAPHIC,r.USER,!1))}_validateRenderer(e){let t=()=>`'${this.layer.title?`${this.layer.title}, `:""}id:${this.layer.id}'`,i=function(e,t){if(null==e)return null;if(!er(e))return new o.A("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":var i=e,r=t;let s={...ei.c,...r,cimFallbackEnabled:!0};return es(i,(0,ei.t)(i.symbol,s).error);case"unique-value":var a=e,n=t;let l={...ei.c,...n,cimFallbackEnabled:!0},h=a.uniqueValueInfos?.map(e=>(0,ei.t)(e.symbol,l).error).filter(V.Ru),d=(0,ei.t)(a.defaultSymbol,l);return d.error&&h?.unshift(d.error),es(a,h);case"class-breaks":var c=e,u=t;let p={...ei.c,...u,cimFallbackEnabled:!0},y=c.classBreakInfos.map(e=>(0,ei.t)(e.symbol,p).error).filter(V.Ru),g=(0,ei.t)(c.defaultSymbol,p);return g.error&&y.unshift(g.error),es(c,y)}return null}(e,{geometryType:this.layer?.geometryType,logWarning:(e,i)=>p.A.getLogger(this).warn(e,`Symbology conversion for layer ${t()}: ${i}`)});if(i){let e=`Renderer for layer ${t} is not supported in a SceneView`;p.A.getLogger(this).warn(e,i.message)}}_cleanupSymbols(){if(this._graphicsWaitingForSymbol.size>0||this._suspendSymbolCleanup)return;let e=!1;this._symbols.forEach((t,i)=>{if(null==t||t.referenced>0)return;let r=this._graphicsBySymbol.get(i);r&&0!==r.size||(this._graphicsBySymbol.delete(i),this._symbols.delete(i),this._symbolMaterials=null,this._unusedSymbolsCache.put(i,t,B.Ti),e=!0)}),e&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}get test(){}get performanceInfo(){return new tL(this.graphics3DGraphics.size,this._graphicsWithoutSymbol.size,this._pendingUpdates.size)}};t3.tmpVec=(0,b.vt)(),(0,l._)([(0,c.MZ)({readOnly:!0})],t3.prototype,"computedExtent",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"currentRenderer",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"rendererHasGeometryOperations",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_frameTaskHandle",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_dataUpdateQueue",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_updateQueue",void 0),(0,l._)([(0,c.MZ)({readOnly:!0})],t3.prototype,"_viewSpatialReference",null),(0,l._)([(0,c.MZ)()],t3.prototype,"_rendererChangeAbortController",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_elevationInfoChangeAbortController",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_initializeAbortController",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_elevationAlignment",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_scaleVisibility",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_filterVisibility",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_initializePromise",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_spatialIndex",void 0),(0,l._)([(0,c.MZ)({readOnly:!0})],t3.prototype,"extentPadding",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_updatingPendingLoadedGraphicsChange",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_featureStore",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_objectStates",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_loadingSymbols",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"preferredUpdatePolicy",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_forcedUpdatePolicy",void 0),(0,l._)([(0,c.MZ)({readOnly:!0})],t3.prototype,"effectiveUpdatePolicy",null),(0,l._)([(0,c.MZ)({constructOnly:!0})],t3.prototype,"elevationFeatureExpressionEnabled",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],t3.prototype,"owner",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],t3.prototype,"layer",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],t3.prototype,"graphicSymbolSupported",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],t3.prototype,"getRenderingInfoWithoutRenderer",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],t3.prototype,"componentFactories",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],t3.prototype,"setUidToIdOnAdd",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"featureStore",null),(0,l._)([(0,c.MZ)()],t3.prototype,"initializePromise",null),(0,l._)([(0,c.MZ)()],t3.prototype,"scaleVisibility",null),(0,l._)([(0,c.MZ)()],t3.prototype,"elevationAlignment",null),(0,l._)([(0,c.MZ)()],t3.prototype,"objectStates",null),(0,l._)([(0,c.MZ)()],t3.prototype,"filterVisibility",null),(0,l._)([(0,c.MZ)({readOnly:!0})],t3.prototype,"updating",null),(0,l._)([(0,c.MZ)({readOnly:!0})],t3.prototype,"dataUpdating",null),(0,l._)([(0,c.MZ)({readOnly:!0})],t3.prototype,"running",null),(0,l._)([(0,c.MZ)({readOnly:!0})],t3.prototype,"suspendedOrOutsideOfView",null),(0,l._)([(0,c.MZ)({readOnly:!0,dependsOn:[]})],t3.prototype,"updatingRemaining",null),(0,l._)([(0,c.MZ)({readOnly:!0})],t3.prototype,"displayFeatureLimit",null),(0,l._)([(0,c.MZ)({readOnly:!0,dependsOn:[]})],t3.prototype,"averageSymbolComplexity",null),(0,l._)([(0,c.MZ)({constructOnly:!0})],t3.prototype,"hasZ",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],t3.prototype,"hasM",void 0),(0,l._)([(0,c.MZ)()],t3.prototype,"_objectIdField",null),t3=a=(0,l._)([(0,y.$)("esri.views.3d.layers.graphics.Graphics3DCore")],t3),function(e){e[e.NEW=0]="NEW",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.REJECTED=3]="REJECTED"}(n||(n={}));class t2{constructor(){this.add=null,this.renderingInfo=null,this.state=n.NEW,this.abortController=null,this.remove=null}clear(){this.add=null,this.renderingInfo=null,this.state=n.NEW,this.abortController=null,this.remove=null}}let t5=10,t9=(0,b.vt)(),t4=(0,b.vt)(),t8=new Map;class t6{constructor(){this._extents=new j.A({allocator:e=>e||(0,Q.vt)()}),this._tmpExtent=(0,Q.vt)(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(e){this._contains(e)||(this._removeContained(e),(0,Q.C)(this._extents.pushNew(),e),this._dirty=!0)}pop(){return this._dirty&&this._mergeTight(),this._extents.pop()}merge(e){return this._mergeTight(e),e.hasProgressed}_mergeTight(e=ey.Bb){let t=this._extents,i=new Set,r=0;for(;r!==t.length;){t.sort((e,t)=>e[0]-t[0]),r=t.length,i.clear();for(let r=0;r<t.length;++r){if(e.done)return;let s=t.at(r);if(s){for(let e=r+1;e<t.length;++e){let r=t.at(e);if(null==r||r[0]>=s[2])break;i.add(r)}i.forEach(r=>{if(s===r)return;if(r[2]<=s[0])return void i.delete(r);let a=(0,Q.Wc)(s),n=(0,Q.Wc)(r),l=this._tmpExtent;(0,Q.fT)(s,r,l);let o=a+n;((0,Q.Wc)(l)-o)/o<.05&&((0,Q.C)(s,l),i.delete(r),t.remove(r),e.madeProgress())}),i.add(s)}}}this._dirty=!1}_contains(e){return this._extents.some(t=>(0,Q.gR)(t,e))}_removeContained(e){this._extents.filterInPlace(t=>!(0,Q.gR)(e,t))}get test(){}}let t7=class extends O.A{constructor(e){super(e),this._dirtyExtents=new t6,this._globalDirty=!1,this._averageExtentUpdateSize=0,this._dirtyGraphicsSet=new Set,this._updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new em.A}initialize(){let e=this.elevationProvider,t=this.graphicsCoreOwner.view.resourceController.scheduler;this._task=t.registerTask(ie(this.graphicsCore.layer.elevationInfo?.mode),this),this.addHandles([e.on("elevation-change",e=>this._elevationChanged(e)),(0,d.wB)(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),this._task,(0,d.wB)(()=>ie(this.graphicsCore.layer.elevationInfo?.mode),e=>this._task.priority=e)])}destroy(){this._dirtyGraphicsSet.clear(),this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null,this.elevationProvider=null}clear(){this._dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this._dirtyGraphicsSet.size>0||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(e){for(this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,e.madeProgress()),e.run(()=>this._dirtyExtents.merge(e));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.notifyChange("updating")}_updateDirtyGraphics(e){let t=this.graphicsCoreOwner.view.renderCoordsHelper,i=this.graphicsCore.effectiveUpdatePolicy===t$.q.ASYNC;for(let r of this._dirtyGraphicsSet.keys()){let s=this.graphicsCore.getGraphics3DGraphicById(r);if(this._dirtyGraphicsSet.delete(r),null!=s&&(s.alignWithElevation(this.elevationProvider,t,i),this.graphicsCore.deconflictor?.setDirty(),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this._dirtyExtents.empty&&!e.done;){let t=this._dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:t,spatialReference:i});let r=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,e=>{let t=this.graphicsCore.getGraphics3DGraphicById(e);null!=t&&t.needsElevationUpdates()&&this._dirtyGraphicsSet.add(e)}),this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-r)+.9*this._averageExtentUpdateSize,e.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear(),this._dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((e,t)=>this._dirtyGraphicsSet.add(t))}_elevationChanged(e){if("scene"===e.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;let t=e.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){let e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",e)}else t[0]===-1/0?this._globalDirty=!0:this._dirtyExtents.add(t),this.notifyChange("updating")}};function ie(e){return null==e?ey.W6.ELEVATION_ALIGNMENT:"relative-to-scene"===e?ey.W6.ELEVATION_ALIGNMENT_SCENE:ey.W6.ELEVATION_ALIGNMENT}(0,l._)([(0,c.MZ)()],t7.prototype,"graphicsCoreOwner",void 0),(0,l._)([(0,c.MZ)()],t7.prototype,"graphicsCore",void 0),(0,l._)([(0,c.MZ)()],t7.prototype,"queryGraphicUIDsInExtent",void 0),(0,l._)([(0,c.MZ)()],t7.prototype,"elevationProvider",void 0),(0,l._)([(0,c.MZ)({readOnly:!0})],t7.prototype,"updating",null),(0,l._)([(0,c.MZ)({readOnly:!0})],t7.prototype,"updatingRemaining",null),t7=(0,l._)([(0,y.$)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t7);var it=i(69752),ii=i(28255),ir=i(20538),is=i(40998),ia=i(38715),il=i(26270),io=i(5408),ih=i(18945),id=i(72500),ic=i(23146);let iu={dir:(0,b.vt)(),len:0,clip:(0,ty.vt)()},ip=.5*Math.PI,iy=ip/Math.PI*180;class ig{constructor(e){this._extent=[,,,,],this._planes=Array(6),this._maxSpan=0,this._center={origin:(0,b.vt)(),direction:(0,b.vt)()},this._renderCoordsHelper=e.renderCoordsHelper;for(let e=0;e<4;e++)this._extent[e]={origin:(0,b.vt)(),direction:(0,b.vt)(),cap:{next:null,direction:(0,b.vt)()}},this._planes[e]=(0,id.vt)();this._planes[io.FB.NEAR]=(0,id.vt)(),this._planes[io.FB.FAR]=(0,id.vt)(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,t,i,r=!0){let s=this._extent;this._toRenderBoundingExtent(e,t,i),(0,N.g)(this._center.origin,s[0].origin,s[2].origin),(0,N.h)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),r||(0,N.h)(this._center.direction,this._center.direction,-1);for(let e=0;e<4;e++){let t=s[e];this._renderCoordsHelper.worldUpAtPosition(t.origin,t.direction);let i=s[3===e?0:e+1];t.cap.next=i.origin,(0,N.o)(t.cap.direction,t.origin,i.origin),(0,id.mR)(t.direction,t.cap.direction,t.origin,this._planes[e]),r||(0,N.h)(t.direction,t.direction,-1)}(0,id.mR)(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[io.FB.NEAR]),r?(0,id.ze)(this._planes[io.FB.NEAR],this._planes[io.FB.FAR]):((0,id.C)(this._planes[io.FB.FAR],this._planes[io.FB.NEAR]),(0,id.ze)(this._planes[io.FB.NEAR],this._planes[io.FB.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=t,this._minGlobalAltitude=.9*(0,it.tO)(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,i=!1){if(null==e)return!1;if(this._renderCoordsHelper.viewingMode===ew.RT.Global){let i=this._maxSpanSpatialReference.isGeographic?iy:ip*t;if(this._maxSpan>i)return!0;if(null!=e.altitude&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this._maxSpan){let t=this._extent[0];return!(i||!e.intersectsRay((0,ic.LV)(t.origin,t.direction)))}for(let t=0;t<this._extent.length;t++){let r=this._extent[t];if(!i&&e.intersectsRay((0,ic.LV)(r.origin,r.direction))||e.intersectsLineSegment((0,ih.Cr)(r.origin,r.cap.next,ix),r.cap.direction))return!0}let r=i?this._planes:this._planesWithoutFar;for(let t=0;t<e.lines.length;t++){var s,a,n,l,o,h;let i=e.lines[t];if(s=i.origin,function(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let i=0;i<e.length;i++)if(!function(e,t,i){let r=(0,N.f)((0,id.Qj)(e),i.dir),s=-(0,id.mN)(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;let a=s/r;return r>0?a<i.clip[1]&&(i.clip[1]=a):a>i.clip[0]&&(i.clip[0]=a),i.clip[0]<=i.clip[1]}(e[i],t,r))return!1;return!0}(r,s,a=i.endpoint,(n=i.direction,l=s,o=a,h=!0,n?(o&&h&&(iu.len=(0,N.j)(l,o)),(0,N.c)(iu.dir,n)):h?(iu.len=(0,N.j)(l,o),(0,N.d)(iu.dir,o,l),(0,N.h)(iu.dir,iu.dir,1/iu.len)):((0,N.d)(iu.dir,o,l),(0,N.n)(iu.dir,iu.dir)),iu)))return!0}return!1}_toRenderBoundingExtentGlobal(e,t,i){for(let{x0:r,x1:s,y0:a,y1:n}of((0,Q.gX)(e,i_),i_[2]=i,(0,il.l)(t,i_,ib,this._renderCoordsHelper.spatialReference),(0,is.B8)(iv,ib),(0,X.Ie)(iS),im))for(let l=0;l<5;l++){let o=l/4;i_[0]=(0,ir.Cc)(e[r],e[s],o),i_[1]=(0,ir.Cc)(e[a],e[n],o),i_[2]=i,(0,Y.F)(i_,t,i_,this._renderCoordsHelper.spatialReference),(0,N.t)(i_,i_,iv),(0,X.iT)(iS,i_)}(0,N.i)(this._extent[0].origin,iS[0],iS[1],iS[2]),(0,N.i)(this._extent[1].origin,iS[3],iS[1],iS[2]),(0,N.i)(this._extent[2].origin,iS[3],iS[4],iS[2]),(0,N.i)(this._extent[3].origin,iS[0],iS[4],iS[2]);for(let e=0;e<4;++e)(0,N.t)(this._extent[e].origin,this._extent[e].origin,ib)}_toRenderBoundingExtentLocal(e,t,i){tm(e,t,iC,this._renderCoordsHelper.spatialReference),(0,N.i)(this._extent[0].origin,iC[0],iC[1],i),(0,N.i)(this._extent[1].origin,iC[2],iC[1],i),(0,N.i)(this._extent[2].origin,iC[2],iC[3],i),(0,N.i)(this._extent[3].origin,iC[0],iC[3],i)}_toRenderBoundingExtent(e,t,i){switch(this._renderCoordsHelper.viewingMode){case ew.RT.Global:this._toRenderBoundingExtentGlobal(e,t,i);break;case ew.RT.Local:this._toRenderBoundingExtentLocal(e,t,i);break;default:(0,ii.Xb)(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(e){if(0>(0,id.mN)(e.planes[io.FB.NEAR],this._center.origin)&&0>(0,N.f)(this._center.direction,e.direction))return!0;for(let t=0;t<4;t++){let i=this._extent[t];if(0>(0,id.mN)(e.planes[io.FB.NEAR],i.origin)&&0>(0,N.f)(i.direction,e.direction))return!0}return!1}}let im=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],i_=(0,b.vt)(),ib=(0,ia.vt)(),iv=(0,ia.vt)(),iS=(0,X.vt)(),iC=(0,Q.vt)(),ix=(0,ih.vt)(),iw=class extends O.A{constructor(e){super(e),this.suspended=!1,this._extent=null,this._extentIntersectionDirty=!0,this._isVisibleBelowSurfaceInternal=!1,this.graphicsCoreOwner=null,this.updating=!0}initialize(){let{graphicsCoreOwner:e}=this;this._extentIntersection=new ig({renderCoordsHelper:e.view.renderCoordsHelper});let t=e.view,i=t.basemapTerrain,r=t.resourceController.scheduler;this.addHandles([t.on("resize",()=>this._viewChange()),(0,d.wB)(()=>t.state.camera,()=>this._viewChange(),d.OH),r.registerTask(ey.W6.FRUSTUM_VISIBILITY,this),(0,d.wB)(()=>i.visibleElevationBounds,()=>this._elevationBoundsChange())]),"local"===t.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([(0,d.wB)(()=>[i.baseOpacity,i.wireframe,t.map?.ground?.navigationConstraint?.type],()=>this._updateIsVisibleBelowSurface(),d.Vh)])}destroy(){this._set("graphicsCoreOwner",null),this._extent=null,this._extentIntersection=null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){this._extent=e,this._extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(e){this._isVisibleBelowSurfaceInternal=e,this._setDirty(),this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){let e=this.graphicsCoreOwner.view,t=e.basemapTerrain,i="local"===e.viewingMode,r="none"===e.map.ground?.navigationConstraint?.type;this._isVisibleBelowSurface=i||!t.opaque||r}_updateExtentIntersection(){let e;if(!this._extentIntersectionDirty)return;this._extentIntersectionDirty=!1;let t=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurfaceInternal)e=-.3*(0,it.tO)(t.spatialReference).radius;else{let{min:i,max:r}=t.basemapTerrain.visibleElevationBounds;e=i-Math.max(1,(r-i)*(1.2-1))}this._extentIntersection.update(this._extent,t.spatialReference,e)}get running(){return this.updating}runTask(e){if(this._set("updating",!1),!this._extent)return this._set("suspended",!1),tK.G;this._updateExtentIntersection();let t=this.graphicsCoreOwner.view.frustum,i=(0,it.tO)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(t,i)),e.madeProgress()}};(0,l._)([(0,c.MZ)({readOnly:!0})],iw.prototype,"suspended",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],iw.prototype,"graphicsCoreOwner",void 0),(0,l._)([(0,c.MZ)({readOnly:!0})],iw.prototype,"updating",void 0),iw=(0,l._)([(0,y.$)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],iw);var iE=i(18189);class iG{}class iP extends iG{constructor(e,t){super(),this.objectStateId=e,this.object=t}remove(){this.object.removeStateID(this.objectStateId)}}class iA extends iG{constructor(e,t,i){super(),this.objectStateId=e,this.object=t,this.owner=i}remove(){this.owner.removeRenderGeometryObjectState(this.object,this.objectStateId)}}class iO extends iG{constructor(e,t){super(),this.objectStateId=e,this._removeCallback=t,this.object=null}remove(){this._removeCallback(this.objectStateId)}}class iL{constructor(){this._items=[]}addObject(e,t){this._items.push(new iP(t,e))}addRenderGeometry(e,t,i){this._items.push(new iA(t,e,i))}addExternal(e,t){this._items.push(new iO(t,e))}remove(e){this._remove(t=>t.objectStateId===e)}removeByObject(e){this._remove(t=>t.object===e)}removeAll(){this._items.forEach(e=>e.remove()),this._items=[]}_remove(e){let{_items:t}=this;for(let i=t.length-1;i>=0;--i){let r=t[i];e(r)&&(r.remove(),t.splice(i,1))}}}class iR extends iL{constructor(){super(...arguments),this.stateType=iE.Mg.MaskOccludee}}class iI extends iL{constructor(e){super(),this.highlightName=e,this.stateType=iE.Mg.Highlight}}class iD{constructor(e){this.objectIdField=e,this.ids=new Set,this.paused=!1}hasGraphic(e){let t=this.objectIdField?e.graphic.attributes[this.objectIdField]:e.graphic.uid;return this.ids.has(t)}}class iM extends iD{constructor(e){super(e),this.stateType=iE.Mg.MaskOccludee,this.objectStateSet=new iR}}class iF extends iD{constructor(e,t){super(t),this.highlightName=e,this.stateType=iE.Mg.Highlight,this.objectStateSet=new iI(e)}}class iT{constructor(e){this._graphicsCore=e,this._stateSets=[]}destroy(){this.reset(),this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach(e=>e.objectStateSet.removeAll()),this._stateSets.length=0)}acquireOccludeeSet(e){let t=new iM(e);this._stateSets.push(t);let i=(0,g.hA)(()=>this.releaseSet(t));return{set:t,handle:i}}acquireHighlightSet(e,t){let i=new iF(e,t);this._stateSets.push(i);let r=(0,g.hA)(()=>this.releaseSet(i));return{set:i,handle:r}}releaseSet(e){e.objectStateSet.removeAll();let t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}setUid(e,t){e.ids.add(t);let i=this._graphicsCore.graphics3DGraphics.get(t);i&&i.addObjectStateSet(e.objectStateSet)}setUids(e,t){t.forEach(t=>this.setUid(e,t))}setObjectIds(e,t){t.forEach(t=>e.ids.add(t)),this._initializeSet(e)}addGraphic(e){this._stateSets.forEach(t=>{!t.paused&&t.hasGraphic(e)&&e.addObjectStateSet(t.objectStateSet)})}removeGraphic(e){this._stateSets.forEach(t=>{t.hasGraphic(e)&&e.removeObjectState(t.objectStateSet)})}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach(e=>e.objectStateSet.removeAll())}_initializeSet(e){let t=this._graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach(t=>{t&&e.hasGraphic(t)&&t.addObjectStateSet(e.objectStateSet)}):e.ids.forEach(i=>{let r=t.get(i);r&&r.addObjectStateSet(e.objectStateSet)})}get test(){}}var iU=i(31651);let iV=class extends O.A{constructor(e){super(e),this._scaleRangeActive=!1,this._layerScaleRangeVisibilityQuery=!1,this._extent=null,this._updatingHandles=new R.U,this.graphicsCoreOwner=null,this.layer=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null,this.basemapTerrain=null,this.layerScaleEnabled=!0,this.suspended=!1,this._dirty=!0}initialize(){this.updateScaleRangeActive();let e=this.graphicsCoreOwner.view.resourceController.scheduler;this.addHandles(e.registerTask(ey.W6.SCALE_VISIBILITY,this)),this._updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.layerMinMaxScaleChangeHandler())}destroy(){this._updatingHandles.destroy(),this.removeHandles(),this._dirty=!1,this._extent=null,this.graphicsCoreOwner=null,this.layer=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null,this.basemapTerrain=null}get updating(){return this._dirty||this._updatingHandles.updating}_setDirty(){this._dirty=!0}setExtent(e){let t=this.graphicsCoreOwner.view.spatialReference,i=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;if(t===i)this._extent=e??null;else{let r=(0,Q.vt)();tm(e,t,r,i)?this._extent=r:this._extent=null}this._setDirty()}scaleRangeActive(){return this._scaleRangeActive}updateScaleRangeActive(){var e,t;let i=this.layer,r=i.effectiveScaleRange,s=this.layerScaleEnabled&&null!=r&&(e=r.minScale,t=r.maxScale,e>0||t>0);i.labelingInfo&&!s&&(s=i.labelingInfo.some(e=>{var t,i;return e&&(t=e.minScale??0,i=e.maxScale??0,t>0||i>0)}));let a=this._scaleRangeActive!==s;return this._scaleRangeActive=s,s&&!this.hasHandles(iz)&&this.basemapTerrain?(this.addHandles(this.basemapTerrain.on("scale-change",e=>this._scaleUpdateHandler(e)),iz),this.layerScaleEnabled&&this.addHandles(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),iz)):!s&&this.hasHandles(iz)&&this.removeHandles(iz),a}get running(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}runTask(e){let t=this.graphicsCoreOwner.view.basemapTerrain;if(this._extent&&t&&t.ready&&this._scaleRangeActive&&this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return tK.G;{this._layerScaleRangeVisibilityQuery=!0;let{minScale:e,maxScale:i}=this.layer.effectiveScaleRange;t.queryVisibleScaleRange(this._extent,e,i,e=>this._finishUpdate(e))}}else this._finishUpdate(!0);e.madeProgress()}_finishUpdate(e){this._layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e),this._dirty=!1}_visibleAtLayerScale(e){let t=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||(0,iU.JU)(e,t.minScale||0,t.maxScale||0)}_visibleAtLabelScale(e,t){return(0,iU.JU)(e,t.minScale||0,t.maxScale||0)}_graphicScale(e){let t;return(null!=e.centroid?t=e.centroid:null!=e.graphic.geometry&&"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t)?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(t):1:null}_graphicVisible(e){if(!this.layerScaleEnabled)return!0;let t=this._graphicScale(e);return this._visibleAtLayerScale(t)}updateVisibility(e){if(this._scaleRangeActive){let t=this._graphicVisible(e);return e.setVisibilityFlag(s.GRAPHIC,r.SCALE_RANGE,t)}return!1}updateGraphicLabelScaleVisibility(e){if(!this._scaleRangeActive||!e.labelLayers||0===e.labelLayers.length)return!1;let t=this._graphicScale(e),i=this._updateLabelScaleVisibility(e,t);return i&&(this.graphicsCore.deconflictor?.setDirty(),this.graphicsCore.labeler?.setDirty()),i}_updateLabelScaleVisibility(e,t){if(!e.labelLayers||0===e.labelLayers.length)return!1;let i=e.labelLayers[0]._labelClass;if(null!=i?.minScale&&null!=i.maxScale){let a=this._visibleAtLabelScale(t,i);if(e.setVisibilityFlag(s.LABEL,r.SCALE_RANGE,a))return!0}return!1}_scaleUpdateHandler(e){if(this._setDirty(),!this.graphicsCore.visible)return;let t=e.extent,i=e.scale,a=this._visibleAtLayerScale(i),n=!1,l=this.graphicsCoreOwner.view.spatialReference,o=e.spatialReference;if(null==o)return void p.A.getLogger(this).error("scaleUpdate: Internal error, no SpatialReference given for tiles");let h=!o.equals(l);if(h&&!tm(t,o,iB,l))return void p.A.getLogger(this).error("scaleUpdate: Internal error, cannot project AABR from "+o+" to wkid "+l);let d=h?iB:t;this.queryGraphicUIDsInExtent(d,l,e=>{let l=this.graphicsCore.getGraphics3DGraphicById(e);if(null==l)return;let o=l.centroid;null!=o&&(t[0]>o.x||t[1]>o.y||t[2]<o.x||t[3]<o.y)||(l.setVisibilityFlag(s.GRAPHIC,r.SCALE_RANGE,a)&&(n=!0),this._updateLabelScaleVisibility(l,i)&&(n=!0))}),n&&(this.graphicsCore.deconflictor?.setDirty(),this.graphicsCore.labeler?.setDirty())}layerMinMaxScaleChangeHandler(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(e=>e.setVisibilityFlag(s.GRAPHIC,r.SCALE_RANGE,!0)):this._scaleRangeActive&&this.graphicsCore.updateGraphicsVisibilities(),this._setDirty()}};(0,l._)([(0,c.MZ)()],iV.prototype,"graphicsCoreOwner",void 0),(0,l._)([(0,c.MZ)()],iV.prototype,"layer",void 0),(0,l._)([(0,c.MZ)()],iV.prototype,"queryGraphicUIDsInExtent",void 0),(0,l._)([(0,c.MZ)()],iV.prototype,"graphicsCore",void 0),(0,l._)([(0,c.MZ)()],iV.prototype,"basemapTerrain",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],iV.prototype,"layerScaleEnabled",void 0),(0,l._)([(0,c.MZ)({readOnly:!0})],iV.prototype,"suspended",void 0),(0,l._)([(0,c.MZ)({readOnly:!0})],iV.prototype,"updating",null),(0,l._)([(0,c.MZ)()],iV.prototype,"_dirty",void 0),iV=(0,l._)([(0,y.$)("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],iV);let iz="terrain-events",iB=(0,Q.vt)();var ij=i(54335),iH=i(48271);let iN=[];(0,g.hA)();let ik=class extends O.A{constructor(e){super(e),this.type="graphics-3d",this.graphicsCore=null,this.drapeSourceType=T.Om.Features,this.scaleVisibilityEnabled=!1,this.frustumVisibilityEnabled=!1,this._suspendResumeExtent=null,this._updatingHandles=new R.U}initialize(){let{layer:e}=this,t="effectiveScaleRange"in e?e:null,i=this.scaleVisibilityEnabled&&null!=t,r=new t3({owner:this,layer:this.owner.layer,preferredUpdatePolicy:t$.q.SYNC,graphicSymbolSupported:!0,componentFactories:{elevationAlignment:(e,t)=>new t7({graphicsCoreOwner:this,graphicsCore:e,queryGraphicUIDsInExtent:t,elevationProvider:this.view.elevationProvider}),scaleVisibility:i?(e,i)=>new iV({graphicsCoreOwner:this,layer:t,queryGraphicUIDsInExtent:i,graphicsCore:e,basemapTerrain:this.owner.view.basemapTerrain}):null,objectStates:e=>new iT(e)}});if(this._set("graphicsCore",r),this.frustumVisibilityEnabled&&this._set("frustumVisibility",new iw({graphicsCoreOwner:this})),"fullOpacity"in this.owner){let e=this.owner;this._updatingHandles.add(()=>e.fullOpacity,()=>this.graphicsCore.opacityChange())}"elevationInfo"in e&&this._updatingHandles.add(()=>e.elevationInfo,(e,t)=>{(0,L.Ui)(e,t)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())}),this._set("initializePromise",this._initializeAsync()),this._updatingHandles.addPromise(this.initializePromise)}async _initializeAsync(){try{await this.graphicsCore.initializePromise}catch(e){if((0,m.zf)(e))return;throw e}this.destroyed||(this.addHandles((0,d.wB)(()=>this.view.clippingArea,()=>this._updateClippingExtent(),d.OH)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this._updatingHandles.destroy(),this._set("frustumVisibility",(0,h.pR)(this.frustumVisibility)),this._set("graphicsCore",(0,h.pR)(this.graphicsCore))}get layer(){return this.owner.layer}get view(){return this.owner.view}get scaleVisibility(){return this.graphicsCore?.scaleVisibility}get elevationAlignment(){return this.graphicsCore?.elevationAlignment}get scaleVisibilitySuspended(){return!(null==this.scaleVisibility||!this.scaleVisibility.suspended)}get frustumVisibilitySuspended(){return null!=this.frustumVisibility&&this.frustumVisibility.suspended}get suspended(){return this.owner.suspended??!1}get updating(){return!!(this.graphicsCore?.updating||null!=this.scaleVisibility&&this.scaleVisibility.updating||null!=this.frustumVisibility&&this.frustumVisibility.updating||this._updatingHandles.updating)}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner.fullOpacity??1}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}getRenderingInfo(e,t,i){let r=(0,M.vl)(e,{renderer:t,arcade:i});if(r?.color){let e=r.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return r}getRenderingInfoAsync(e,t,i,r){return(0,M.LO)(e,{renderer:t,arcade:i,...r})}getHit(e){if(this.owner.loadedGraphics){let t=this.owner.loadedGraphics.find(t=>t.uid===e);if(t){let e=this.layer instanceof I.A?this.layer:null,i=(0,D.wP)(t,e);return{type:"graphic",graphic:i,layer:i.layer}}}return null}whenGraphicBounds(e,t){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(e,t):Promise.reject()}computeAttachmentOrigin(e,t){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(e,t):null}getSymbolLayerSize(e,t){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(e,t):null}maskOccludee(e){let t=this.graphicsCore?.objectStates;if(!t)return(0,g.hA)();let{set:i,handle:r}=t.acquireOccludeeSet(null);return t.setUid(i,e.uid),r}highlight(e,t){var i;let r=this.graphicsCore?.objectStates;if(!r||e instanceof F.A)return iZ;let s=ij.A.isCollection(e)?e.toArray():Array.isArray(e)?e:"number"==typeof(i=e)||"string"==typeof i||(0,iH.DU)(e)||"esri.views.3d.layers.i3s.PointCloudGraphic"===e.declaredClass?[e]:iN;if(0===s.length)return iZ;if(s[0]instanceof A.A){let e=s.map(e=>e.uid),{set:i,handle:a}=r.acquireHighlightSet(t,null);return r.setUids(i,e),a}if("number"==typeof s[0]){let{set:e,handle:i}=r.acquireHighlightSet(t,null);return r.setObjectIds(e,s),i}return iZ}_setupSuspendResumeExtent(){let{scaleVisibility:e,frustumVisibility:t}=this;if(null==e&&null==t)return;let i=({computedExtent:i,extentPadding:r})=>{this._suspendResumeExtent=(0,eT.t8)(i,this._suspendResumeExtent,U.qD,r),null!=e&&e.setExtent(this._suspendResumeExtent),null!=t&&t.setExtent(this._suspendResumeExtent)};this.addHandles((0,d.wB)(()=>({computedExtent:this.graphicsCore?.computedExtent,extentPadding:this.graphicsCore?.extentPadding}),e=>i(e),d.pc))}_updateClippingExtent(){let e=this.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}};(0,l._)([(0,c.MZ)()],ik.prototype,"type",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],ik.prototype,"owner",void 0),(0,l._)([(0,c.MZ)()],ik.prototype,"layer",null),(0,l._)([(0,c.MZ)()],ik.prototype,"view",null),(0,l._)([(0,c.MZ)({constructOnly:!0})],ik.prototype,"graphicsCore",void 0),(0,l._)([(0,c.MZ)()],ik.prototype,"scaleVisibility",null),(0,l._)([(0,c.MZ)({constructOnly:!0})],ik.prototype,"frustumVisibility",void 0),(0,l._)([(0,c.MZ)()],ik.prototype,"elevationAlignment",null),(0,l._)([(0,c.MZ)()],ik.prototype,"scaleVisibilitySuspended",null),(0,l._)([(0,c.MZ)({readOnly:!0})],ik.prototype,"frustumVisibilitySuspended",null),(0,l._)([(0,c.MZ)()],ik.prototype,"suspended",null),(0,l._)([(0,c.MZ)({readOnly:!0})],ik.prototype,"updating",null),(0,l._)([(0,c.MZ)()],ik.prototype,"loadedGraphics",null),(0,l._)([(0,c.MZ)()],ik.prototype,"fullOpacity",null),(0,l._)([(0,c.MZ)()],ik.prototype,"slicePlaneEnabled",null),(0,l._)([(0,c.MZ)()],ik.prototype,"drapeSourceType",void 0),(0,l._)([(0,c.MZ)()],ik.prototype,"updatePolicy",null),(0,l._)([(0,c.MZ)({constructOnly:!0})],ik.prototype,"scaleVisibilityEnabled",void 0),(0,l._)([(0,c.MZ)({constructOnly:!0})],ik.prototype,"frustumVisibilityEnabled",void 0),(0,l._)([(0,c.MZ)()],ik.prototype,"initializePromise",void 0),ik=(0,l._)([(0,y.$)("esri.views.3d.layers.graphics.GraphicsProcessor")],ik);let iZ=(0,g.hA)();async function iq(e,t,i){if(null==e||0===t.candidates.length)return iW;let r=e.graphics3DGraphicsByObjectID??e.graphics3DGraphics,s=[],a=[],{renderer:n}=e,l=null!=n&&"arcadeRequired"in n&&n.arcadeRequired?(0,en.lw)():null,o=async(t,{graphic:r,graphics3DSymbol:s})=>{let a=await l,o=await e.getRenderingInfoAsync(r,n,a,{signal:i});return null==o?[]:s.queryForSnapping(t,d,o,i)},{candidates:h,spatialReference:d}=t;for(let e=0;e<h.length;++e){let t=h[e],{objectId:i}=t,n="number"==typeof i?r?.get(i):void 0;if(null==n)continue;let{graphics3DSymbol:l}=n;l.symbologySnappingSupported&&(s.push(o(t,n)),a.push(e))}if(0===s.length)return iW;let c=await Promise.all(s);(0,m.Te)(i);let u=[],p=[];for(let e=0;e<c.length;++e){let t=c[e],i=a[e];for(let e of t)u.push(e),p.push(i)}return{candidates:u,sourceCandidateIndices:p}}let iW={candidates:[],sourceCandidateIndices:[]};class iY{constructor(e,t=0,i=0,r=0,s=0,a=null){this.usedMemory=e,this.displayedFeatures=t,this.totalFeatures=i,this.maximumFeatures=r,this.nodes=s,this.core=a}}var i$=i(6322),iX=i(3724);async function iQ(e){let t=e.view.spatialReference,i=e.layer.fullExtent,r=null!=i&&i.spatialReference;if(null==i||!r)return null;if(r.equals(t))return i.clone();let s=(0,i$.Cv)(i,t);if(null!=s)return s;if(e.view.state.isLocal)try{let r=await (0,iX.projectGeometry)(i,t,e.layer.portalItem);return e.destroyed||null==r?null:r}catch{}return null}var iJ=i(85511),iK=i(28544);let i0=class extends _(iJ.A){constructor(){super(...arguments),this.type="graphics-3d",this.symbologySnappingSupported=!0,this._slicePlaneEnabled=!1,this.fullExtentInLocalViewSpatialReference=null,this.ignoresMemoryFactor=!0}get highlightOptions(){return null}initialize(){this._set("processor",new ik({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0})),this.addResolvingPromise(this.processor.initializePromise),this.addHandles(this.layer.on("graphic-update",e=>this.processor.graphicsCore.graphicUpdateHandler(e))),this.layer.internal?this.notifyChange("updating"):(this.addResolvingPromise(iQ(this).then(e=>this.fullExtentInLocalViewSpatialReference=e)),this.addHandles((0,d.z7)(()=>this.view?.basemapTerrain?.ready,()=>()=>this.notifyChange("updating"),{once:!0})))}destroy(){this._updatingHandles.removeAll(),this._set("processor",(0,h.pR)(this.processor))}get loadedGraphics(){return this.layer.graphics}get legendEnabled(){return this.canResume()&&!this.processor?.frustumVisibilitySuspended}get visibleAtCurrentScale(){return!this.processor?.scaleVisibilitySuspended}get slicePlaneEnabled(){let e=this.layer.internal;return this._slicePlaneEnabled&&!e}set slicePlaneEnabled(e){this._slicePlaneEnabled=e}getSuspendInfo(){let e=super.getSuspendInfo();return e.outsideOfView=this.processor?.frustumVisibilitySuspended??!1,e}getHit(e){return this.processor.getHit(e)}whenGraphicBounds(e,t){return this.processor.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){return this.processor?.computeAttachmentOrigin(e,t)}getSymbolLayerSize(e,t){return this.processor.getSymbolLayerSize(e,t)}queryGraphics(){return Promise.resolve(this.loadedGraphics)}maskOccludee(e){return this.processor.maskOccludee(e)}highlight(e,t){return this.processor.highlight(e,t?.name??iK.Tv)}async elevationAlignPointsInFeatures(e,t){let{processor:i}=this;if(null==i?.graphics3DGraphics)throw new o.A("graphicslayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");let{graphics3DGraphics:r}=i;return P(this.view,this.layer,e=>"number"==typeof e?r.get(e):void 0,e,t)}async queryForSymbologySnapping(e,t){return iq(this.processor,e,t)}get updatePolicy(){return this.processor?.graphicsCore.effectiveUpdatePolicy||t$.q.SYNC}isUpdating(){return this.view&&this.layer&&!(!this.processor?.updating&&(this.layer.internal||this.view.basemapTerrain?.ready))}get performanceInfo(){return new iY(this.usedMemory,this.loadedGraphics.length,-1,-1)}get usedMemory(){return this.processor?.graphicsCore?.usedMemory??0}get unloadedMemory(){return this.processor?.graphicsCore?.unprocessedMemoryEstimate}get test(){return{graphics3DProcessor:this.processor,loadedGraphics:this.loadedGraphics}}};(0,l._)([(0,c.MZ)()],i0.prototype,"highlightOptions",null),(0,l._)([(0,c.MZ)()],i0.prototype,"loadedGraphics",null),(0,l._)([(0,c.MZ)({readOnly:!0})],i0.prototype,"legendEnabled",null),(0,l._)([(0,c.MZ)()],i0.prototype,"layer",void 0),(0,l._)([(0,c.MZ)({readOnly:!0})],i0.prototype,"processor",void 0),(0,l._)([(0,c.MZ)({readOnly:!0})],i0.prototype,"visibleAtCurrentScale",null),(0,l._)([(0,c.MZ)()],i0.prototype,"_slicePlaneEnabled",void 0),(0,l._)([(0,c.MZ)({type:Boolean})],i0.prototype,"slicePlaneEnabled",null);let i1=i0=(0,l._)([(0,y.$)("esri.views.3d.layers.GraphicsLayerView3D")],i0)},45773:(e,t,i)=>{var r;i.d(t,{x:()=>r}),function(e){e[e.TRANSPARENT=0]="TRANSPARENT",e[e.OPAQUE=1]="OPAQUE"}(r||(r={}))},49180:(e,t,i)=>{i.d(t,{$:()=>r});class r{constructor(e,t){this.renderer=e,this.symbol=t}}},51525:(e,t,i)=>{i.d(t,{P:()=>r,x:()=>n});var r,s=i(40941),a=i(92753);class n{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=r.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===r.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===r.FAILED?(t&&t(this._loadError),this._loader??Promise.resolve()):(null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=r.LOADED},e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=r.FAILED,!(0,a.zf)(e)&&this.logger&&e.message&&this.logger.warn(e.message),e})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){null!=this._abortController?this._abortController=(0,s.DC)(this._abortController):this._loadStatus===r.LOADING&&(this._loadStatus=r.FAILED),this._loader=null}}!function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"}(r||(r={}))},57473:(e,t,i)=>{var r,s;i.d(t,{G:()=>s,w:()=>r}),function(e){e[e.RecreateSymbol=0]="RecreateSymbol",e[e.RecreateGraphics=1]="RecreateGraphics",e[e.FastUpdate=2]="FastUpdate"}(r||(r={})),function(e){e[e.Slow=0]="Slow",e[e.Fast=1]="Fast",e[e.Mixed=2]="Mixed",e[e.Loading=3]="Loading",e[e.Undefined=4]="Undefined"}(s||(s={}))},61102:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(81856),s=i(71017),a=i(92713),n=i(91838);i(57845),i(61939),i(33638);var l=i(33498),o=i(12709),h=i(56911);let d=class extends s.A.ClonableMixin(a.A){constructor(e){super(e),this.type="local",this.origin=(0,h.vt)()}};(0,r._)([(0,l.e)({local:"local"},{readOnly:!0})],d.prototype,"type",void 0),(0,r._)([(0,n.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],d.prototype,"origin",void 0);let c=d=(0,r._)([(0,o.$)("esri.geometry.support.MeshLocalVertexSpace")],d)},61859:(e,t,i)=>{i.d(t,{B6:()=>y,G8:()=>g,Jf:()=>f,Zd:()=>_});var r=i(40998),s=i(38715),a=i(63599),n=i(56911),l=i(26270),o=i(70983),h=i(74558),d=i(34124),c=i(98524),u=i(5951),p=i(53041);function y(e,t,i,r,s){let a=e.stageObject,n=a.geometries,l=0;for(let e of n){if(!(0,u.p)(e))continue;let{update:n,averageGeometrySampledElevation:o}=G(e,t,i,r,s);l+=o,n&&a.geometryVertexAttributeUpdated(e,p.r.POSITION)}return l/n.length}function g(e,t,i,s,n,o){let c=e.stageObject,u=t.centerPointInElevationSR,p=0;c.usesVerticalDistanceToGround?(s(u,E),(0,h.ai)(c,E.verticalDistanceToGround),p=E.sampledElevation):(s(u,E),"absolute-height"!==t.mode&&(p=E.sampledElevation));let y=(0,r.C)(m,o??c.transformation),g=(0,a.i)(w,y[12],y[13],y[14]);d.b.TESTS_DISABLE_OPTIMIZATIONS?(v[0]=u.x,v[1]=u.y,v[2]=E.z,(0,l.l)(u.spatialReference,v,y,n.spatialReference)&&(o?(0,r.C)(o,y):c.transformation=y)):n.setAltitudeOfTransformation(E.z,y);let f=b/n.unitInMeters;return(Math.abs(y[12]-g[0])>=f||Math.abs(y[13]-g[1])>=f||Math.abs(y[14]-g[2])>=f)&&(o?(0,r.C)(o,y):c.transformation=y),p}let m=(0,s.vt)();function f(e,t,i,r,s){let n=e.graphics3DSymbolLayer.lodRenderer;if(null==n)return 0;let o=t.centerPointInElevationSR;r(o,E);let h="absolute-height"!==t.mode?E.sampledElevation:0,c=n.instanceData,u=e.instanceIndex;c.getGlobalTransform(u,x);let p=(0,a.i)(w,x[12],x[13],x[14]);d.b.TESTS_DISABLE_OPTIMIZATIONS?(v[0]=o.x,v[1]=o.y,v[2]=E.z,(0,l.l)(o.spatialReference,v,x,s.spatialReference)&&c.setGlobalTransform(u,x)):s.setAltitudeOfTransformation(E.z,x);let y=b/s.unitInMeters;return(d.b.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(x[12]-p[0])>=y||Math.abs(x[13]-p[1])>=y||Math.abs(x[14]-p[2])>=y)&&c.setGlobalTransform(u,x),h}function _(e,t,i,r,s){let a=e.stageObject,n=a.geometries;if(0===n.length)return 0;let l=0,o=null,h=0,d=!1;for(let e of n){if(!(0,u.p)(e))continue;let n=e.attributes.get(p.r.POSITION);if(n!==o){let{update:a,averageGeometrySampledElevation:l}=G(e,t,i,r,s);h=l,o=n,d=a}d&&a.geometryVertexAttributeUpdated(e,p.r.POSITION),l+=h}return l/n.length}let b=.01,v=(0,n.vt)(),S=(0,n.vt)(),C=(0,n.vt)(),x=(0,s.vt)(),w=(0,n.vt)(),E=new h.Uk;function G(e,t,i,r,s){let a=!1,n=e.transformation,l=t.requiresSampledElevationInfo;S[0]=n[12],S[1]=n[13],S[2]=n[14],e.invalidateBoundingInfo();let h=e.getMutableAttribute(p.r.POSITION),u=h.data,y=h.size,g=u.length/y,m=new c.aY(e.mapPositions,i),f=0,_=0;for(let e=0;e<g;e++){if(C[0]=u[f],C[1]=u[f+1],C[2]=u[f+2],r(m,E),l&&(_+=E.sampledElevation),d.b.TESTS_DISABLE_OPTIMIZATIONS)u[f]=m.array[m.offset],u[f+1]=m.array[m.offset+1],u[f+2]=E.z,(0,o.projectBuffer)(u,i,f,u,s.spatialReference,f,1),u[f]-=S[0],u[f+1]-=S[1],u[f+2]-=S[2],a=!0;else{v[0]=u[f]+S[0],v[1]=u[f+1]+S[1],v[2]=u[f+2]+S[2],s.setAltitude(v,E.z),u[f]=v[0]-S[0],u[f+1]=v[1]-S[1],u[f+2]=v[2]-S[2];let e=b/s.unitInMeters;(Math.abs(C[0]-u[f])>=e||Math.abs(C[1]-u[f+1])>=e||Math.abs(C[2]-u[f+2])>=e)&&(a=!0)}f+=y,m.offset+=3}return{update:a,averageGeometrySampledElevation:_/=g}}},65909:(e,t,i)=>{i.d(t,{LO:()=>o,kg:()=>h,or:()=>d,vl:()=>n});var r=i(70152),s=i(49180),a=i(72919);function n(e,t){let i=function(e,t){if(null!=e.symbol)return e.symbol;let i=t?.renderer;return null!=i&&"dot-density"!==i.type?i.getSymbol(e,t):null}(e,t);if(null==i)return null;let r=t?.renderer,n=new s.$(r,i);if(null==r||!("visualVariables"in r)||!r.visualVariables)return n;let l=(0,a.getVisualVariableValues)(r,e,t)??[],o=["proportional","proportional","proportional"];for(let{variable:e,value:t}of l)switch(e.type){case"color":n.color=t.toRgba();break;case"size":if("outline"===e.target)n.outlineSize=t;else{let i=e.axis,r=e.useSymbolValue?"symbol-value":t;switch(i){case"width":o[0]=r;break;case"depth":o[1]=r;break;case"height":o[2]=r;break;case"width-and-depth":o[0]=o[1]=r;break;default:o[0]=o[1]=o[2]=r}}break;case"opacity":n.opacity=t;break;case"rotation":switch(e.axis){case"tilt":n.tilt=t;break;case"roll":n.roll=t;break;default:n.heading=t}}return"proportional"===o[0]&&"proportional"===o[1]&&"proportional"===o[2]||(n.size=o),n}async function l(e,t){return null!=e.symbol?e.symbol:t?.renderer?.getSymbolAsync(e,t)??null}async function o(e,t){let i=await l(e,t);if(!i)return null;let n=t?.renderer,o=new s.$(n,i);if(!n||!("visualVariables"in n)||!n.visualVariables)return o;let h=(0,a.getVisualVariableValues)(n,e,t)??[],d=["proportional","proportional","proportional"];for(let{variable:e,value:t}of h)if("color"===e.type)o.color=r.A.toUnitRGBA(t);else if("size"===e.type)if("outline"===e.target)o.outlineSize=t;else{let i=e.axis,r=e.useSymbolValue?"symbol-value":t;"width"===i?d[0]=r:"depth"===i?d[1]=r:"height"===i?d[2]=r:d[0]=d[1]="width-and-depth"===i?r:d[2]=r}else"opacity"===e.type?o.opacity=t:"rotation"===e.type&&"tilt"===e.axis?o.tilt=t:"rotation"===e.type&&"roll"===e.axis?o.roll=t:"rotation"===e.type&&(o.heading=t);return(isFinite(d[0])||isFinite(d[1])||isFinite(d[2]))&&(o.size=d),o}function h(e,t=0){let i=e[t];return"number"==typeof i&&isFinite(i)?i:null}function d(e){for(let t=0;t<3;t++){let i=e[t];if("number"==typeof i)return isFinite(i)?i:0}return 0}},68186:(e,t,i)=>{i.d(t,{D8:()=>a,TO:()=>s,d0:()=>n});var r=i(39265);async function s(e,t=e.popupTemplate){if(null==t)return[];let i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:a}=t,{objectIdField:n,typeIdField:l,globalIdField:o,relationships:h}=e;if(i.includes("*"))return["*"];let d=a?(0,r.eX)(e):[],c=(0,r.DB)(e.fieldsIndex,[...i,...d]);return l&&c.push(l),c&&n&&e.fieldsIndex?.has(n)&&!c.includes(n)&&c.push(n),c&&o&&e.fieldsIndex?.has(o)&&!c.includes(o)&&c.push(o),h&&h.forEach(t=>{let{keyField:i}=t;c&&i&&e.fieldsIndex?.has(i)&&!c.includes(i)&&c.push(i)}),c}function a(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function n(e,t){return null!=a(e,{defaultPopupTemplateEnabled:t})}},69520:(e,t,i)=>{i.d(t,{L:()=>C,b:()=>v});var r=i(54036),s=i(35430),a=i(44120),n=i(80194),l=i(63943),o=i(53297),h=i(36885),d=i(71955),c=i(54126),u=i(43417),p=i(61627),y=i(85263),g=i(62809),m=i(76085),f=i(86416),_=i(53041),b=i(90564);function v(e){let t=new b.N5,{vertex:i,fragment:s}=t,{terrainDepthTest:v}=e;return i.include(l.K),t.include(o.Q,e),t.vertex.include(n.rA,e),t.attributes.add(_.r.UV0,"vec2"),i.uniforms.add(new y.I("viewport",e=>e.camera.fullViewport),new m.m("lineSize",(e,t)=>e.size>0?Math.max(1,e.size)*t.camera.pixelRatio:0),new u.E("pixelToNDC",e=>(0,r.hZ)(S,2/e.camera.fullViewport[2],2/e.camera.fullViewport[3])),new m.m("borderSize",(e,t)=>e.borderColor?t.camera.pixelRatio:0),new p.G("screenOffset",(e,t)=>(0,r.hZ)(S,e.horizontalScreenOffset*t.camera.pixelRatio,0))),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),v&&t.varyings.add("depth","float"),e.occlusionTestEnabled&&t.include(h.y),e.hasScreenSizePerspective&&(0,c.OH)(i),i.main.add((0,f.H)`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${(0,f.If)(e.occlusionTestEnabled,(0,f.H)`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${e.hasScreenSizePerspective?(0,f.H)`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled = screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${(0,f.If)(v,"depth = posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${(0,f.If)(e.hudDepth,e.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?(0,f.H)`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:(0,f.H)`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`),s.uniforms.add(new g.E("uColor",e=>e.color??a.uY),new g.E("borderColor",e=>e.borderColor??a.uY)),v&&(s.include(d.H,e),s.uniforms.add(new u.E("inverseViewport",e=>e.inverseViewport))),s.main.add((0,f.H)`
    ${(0,f.If)(v,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${(0,f.If)(!e.hudDepth,(0,f.H)`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`),t}let S=(0,s.vt)(),C=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},71955:(e,t,i)=>{i.d(t,{H:()=>n});var r=i(18977),s=i(86416),a=i(70762);function n(e){e.include(r.E),e.uniforms.add(new a.x("geometryDepthTexture",e=>e.geometryDepth?.attachment)),e.code.add((0,s.H)`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}},72977:(e,t,i)=>{i.d(t,{Fe:()=>y,Rn:()=>h,dI:()=>d,hr:()=>p,iC:()=>u});var r=i(31461),s=i(94264),a=i(64835),n=i(119),l=i(53041),o=i(4547);class h{constructor(e,t,i,r){this.material=e,this.bufferWriter=e.createBufferWriter(),this.vertexBufferLayout=this.bufferWriter.vertexBufferLayout,this.buffer=t,this.elementCount=i,this.boundingInfo=r}get numTriangles(){return this.elementCount/3}get numVertices(){return this.elementCount}computeUsedMemory(){return this.buffer.byteLength+s.i5}getRenderGeometry(){return this}intersect(e,t,i,r,s,a,n,l){let o=this.bufferWriter,h=this.buffer;o.intersect(h,e,i,r,(i,r,o,h,d)=>c(i,r,o,d,e,t,a,n,s,l))}}class d{constructor(e){this.engineGeometry=e}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.attributes.get(l.r.POSITION).indices.length}get numTriangles(){return this.engineGeometry.indexCount/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((e,t)=>e+(0,s.Qf)(t.data,t.indices),0)}getRenderGeometry(){let e=this.material,t=this.engineGeometry,i=t.attributes,r=t.boundingInfo,s=e.createBufferWriter(),a=s.vertexBufferLayout,n=s.elementCount(i),l=a.createBuffer(n);return s.write(null,null,i,null,l,0),new h(e,l.buffer,n,r)}intersect(e,t,i,r,s,a,n,l){let o=this.engineGeometry;this.material.intersect(o,e.transform.transform,e,i,r,(i,r,o,h,d)=>c(i,r,o,d,e,t,a,n,s,l))}}function c(e,t,i,r,s,l,h,d,c,u){if(e<0||l&&!l(s.rayBegin,s.rayEnd,e))return;let p=new o.h(h.layerUid,h.graphicUid(c),i,d,u);if((null==s.results.min.drapedLayerOrder||r>=s.results.min.drapedLayerOrder)&&(null==s.results.min.dist||e<s.results.min.dist)&&s.results.min.set(n.dz.LOD,p,e,t,s.transform.transform,r),s.options.store!==n.oH.MIN&&(null==s.results.max.drapedLayerOrder||r>=s.results.max.drapedLayerOrder)&&(null==s.results.max.dist||e>s.results.max.dist)&&s.results.max.set(n.dz.LOD,p,e,t,s.transform.transform,r),s.options.store===n.oH.ALL){let i=(0,a.G7)(s.results.min.ray);i.set(n.dz.LOD,p,e,t,s.transform.transform,r),s.results.all.push(i)}}class u{constructor(e,t=null){this.geometry=e,this.textures=t}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}}class p{constructor(e,t,i){this.components=e,this.minScreenSpaceRadius=t,this.pivotOffset=i;let s=(0,r.Am)(this.components.map(e=>e.geometry));this.numVertices=s.reduce((e,t)=>e+t.numVertices,0)}}class y{constructor(e){this.levels=e,this.levels.sort((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius)}getMaterials(){let e=[];return this.levels.forEach(t=>t.components.forEach(t=>e.push(t.geometry.material))),(0,r.Am)(e)}getTextures(){let e=[];return this.levels.forEach(t=>t.components.forEach(t=>{null!=t.textures&&e.push(...t.textures)})),(0,r.Am)(e)}getGeometries(){let e=[];return this.levels.forEach(t=>t.components.forEach(t=>{e.push(t.geometry)})),(0,r.Am)(e)}getEngineGeometries(){return this.getGeometries().map(e=>e.engineGeometry).filter(e=>null!=e)}computeUsedMemory(){let e=this.getGeometries(),t=this.getTextures(),i=e.reduce((e,t)=>e+t.computeUsedMemory(),0);return t.reduce((e,t)=>e+t.memoryEstimate,0)+i}}},74662:(e,t,i)=>{i.d(t,{RL:()=>s,ZC:()=>a,kf:()=>r});let r=3,s=3,a=10},75838:(e,t,i)=>{i.d(t,{_:()=>n,k:()=>a}),i(57845);var r=i(96319),s=i(72977);function a(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function n(e,t){let i=(e,t,i=!1)=>new s.Fe(e.map(e=>{let a=t(e.tesselation);return i&&(0,r.zC)(a),new s.hr([new s.iC(new s.dI(a))],e.minScreenSpaceRadius)}));switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],e=>(0,r.uX)(t,.5,e,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>(0,r.C1)(t,1));case"cone":return i(l,e=>(0,r.EE)(t,1,.5,e,!1),!0);case"inverted-cone":return i(l,e=>(0,r.EE)(t,1,.5,e,!0),!0);case"cylinder":return i(l,e=>(0,r.nW)(t,1,.5,e,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>(0,r.Ho)(t,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>(0,r.td)(t,1),!0);default:return}}let l=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},76277:(e,t,i)=>{i.d(t,{A:()=>c});var r,s=i(81856),a=i(71017),n=i(92713),l=i(91838);i(57845),i(61939),i(33638);var o=i(33498),h=i(12709);let d=r=class extends a.A.ClonableMixin(n.A){constructor(e){super(e),this.type="georeferenced",this.origin=null}};d.absolute=new r,(0,s._)([(0,o.e)({georeferenced:"georeferenced"},{readOnly:!0})],d.prototype,"type",void 0),(0,s._)([(0,l.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],d.prototype,"origin",void 0);let c=d=r=(0,s._)([(0,h.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],d)},83048:(e,t,i)=>{i.d(t,{EL:()=>m,RS:()=>f,gr:()=>h,wP:()=>c,wZ:()=>u});var r=i(97135);i(57845);var s=i(33715),a=i(48678),n=i(91463),l=i(31789),o=i(40838);function h(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function c(e,t){return e?"declaredClass"in e?e:new r.A({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,s.o8)(e.symbol),attributes:(0,s.o8)(e.attributes),geometry:u(e.geometry)}):null}function u(e){return null==e?null:h(e)?e:(0,l.rS)(function(e){let{wkid:t,wkt:i,wkt2:r,latestWkid:s}=e.spatialReference,a={wkid:t,wkt:i,wkt2:r,latestWkid:s};switch(e.type){case"point":{let{x:t,y:i,z:r,m:s}=e;return{x:t,y:i,z:r,m:s,spatialReference:a}}case"polygon":{let{rings:t,hasZ:i,hasM:r}=e;return{rings:p(t),hasZ:i,hasM:r,spatialReference:a}}case"polyline":{let{paths:t,hasZ:i,hasM:r}=e;return{paths:p(t),hasZ:i,hasM:r,spatialReference:a}}case"extent":{let{xmin:t,xmax:i,ymin:r,ymax:s,zmin:n,zmax:l,mmin:o,mmax:h,hasZ:d,hasM:c}=e;return{xmin:t,xmax:i,ymin:r,ymax:s,zmin:n,zmax:l,mmin:o,mmax:h,hasZ:d,hasM:c,spatialReference:a}}case"multipoint":{let{points:t,hasZ:i,hasM:r}=e;return{points:g(t)?y(t):t,hasZ:i,hasM:r,spatialReference:a}}default:return}}(e))}function p(e){return!function(e){for(let t of e)if(0!==t.length)return g(t);return!1}(e)?e:e.map(e=>y(e))}function y(e){return e.map(e=>Array.from(e))}function g(e){return e.length>0&&((0,a.vZ)(e[0])||(0,a.aI)(e[0]))}function m(e,t){let i;if(!e)return null;if(d(e)){if(null==t)return e.clone();if(d(t))return t.copy(e)}return null!=t?((i=t).x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=void 0,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=(0,o.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}function f(e){let{wkid:t,wkt:i,wkt2:r,latestWkid:s}=e;return n.A.fromJSON({wkid:t,wkt:i,wkt2:r,latestWkid:s})}},86681:(e,t,i)=>{i.d(t,{Cc:()=>c,CC:()=>u,RF:()=>d});var r,s,a,n=i(70152);i(57845);var l=i(55048),o=i(44120),h=i(45773);function d(e){return e&&e.enabled&&("extrude"===e.type||"fill"===e.type)&&null!=e.edges}function c(e,t){return function(e,t){if(null==e)return null;let i=null!=e.color?(0,o.ci)(n.A.toUnitRGBA(e.color)):(0,o.fA)(0,0,0,0),r=(0,l.Lz)(e.size),a=(0,l.Lz)(e.extensionLength);switch(e.type){case"solid":return u({color:i,size:r,extensionLength:a,...t});case"sketch":var h;return h={color:i,size:r,extensionLength:a,...t},{...y,...h,type:s.Sketch};default:return}}(e&&e.enabled&&e.edges||null,t)}function u(e){return{...p,...e,type:s.Solid}}i(28255),i(62377),i(68586),i(4538),i(58710),i(61004),i(86416),i(2907),i(73024).n,i(717),i(95554),i(53041),function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"}(r||(r={})),i(72853),i(98684),i(47947),i(70058),i(87156),i(28097),i(86032),!function(e){e[e.Solid=0]="Solid",e[e.Sketch=1]="Sketch",e[e.Mixed=2]="Mixed",e[e.COUNT=3]="COUNT"}(s||(s={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.SILHOUETTE=1]="SILHOUETTE"}(a||(a={}));let p={color:(0,o.fA)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:h.x.OPAQUE,hasSlicePlane:!1},y={color:(0,o.fA)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:h.x.OPAQUE,hasSlicePlane:!1}},92446:(e,t,i)=>{i.d(t,{Eg:()=>c,GI:()=>m,JV:()=>g,Tf:()=>u,k9:()=>p,pg:()=>f,uD:()=>d});var r=i(28255),s=i(50460),a=i(74662),n=i(75838),l=i(40893),o=i(86681),h=i(82243);let d=new l.hk({});function c(e){return"web-style"===e.type?d:u(e.symbolLayers.toArray().map(t=>g(e,t)))}function u(e){let t=0,i=0,r=0,s=!1,a=0,n=new l.i3;for(let l of e)null!=l&&(t+=l.verticesPerFeature,i+=l.verticesPerCoordinate,r+=l.drawCallsPerFeature,n.bytesPerFeature+=l.memory.bytesPerFeature,n.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,n.resourceBytes+=l.memory.resourceBytes,n.draped.bytesPerFeature+=l.memory.bytesPerFeature,n.draped.bytesPerFeatureLabel+=l.memory.bytesPerFeatureLabel,s=s||l.estimated,++a);return s?new l.a8(a,{verticesPerFeature:t,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:n}):new l.MT(a,{verticesPerFeature:t,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:n})}function p(e){let t=u(e);return t.numComplexities>0&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities),t}let y={};function g(e,t){let i=m(e,t),d=2*!!(0,o.RF)(t);switch(t.type){case"extrude":return new l.rz({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:d,memory:i});case"fill":if("mesh-3d"===e.type)return new l.rz({drawCallsPerFeature:d,memory:i});if(null!=t.outline&&t.outline.size>0)return new l.rz({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new l.rz({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new l.rz({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return t.resource?.href?new l.hk({verticesPerFeature:100,memory:i}):{...function(e){let t=y[e];if(t)return t;let i=f((0,n._)(e,new h.$U({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})).levels);return y[e]=new l.rz({verticesPerFeature:i}),y[e]}(t.resource?.primitive??s.r),memory:i};case"path":{let e=0,s=0;switch(t.profile){case"circle":e=a.ZC;break;case"quad":e=4;break;default:return void(0,r.Xb)(t.profile)}switch(t.join){case"round":s=a.kf;break;case"miter":case"bevel":s=1;break;default:return}let n=2*e,o=e*s*2,h=-2*o-n;switch(t.cap){case"none":break;case"butt":case"square":h+=2*(e-1);break;case"round":h+=2*(e*(a.RL-1)*2+e);break;default:return}return new l.rz({verticesPerFeature:h,verticesPerCoordinate:o+n,memory:i})}case"text":case"icon":return new l.rz({verticesPerFeature:6,memory:i});default:return}}function m(e,t){let i="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?_.EXTRUDE_EDGES:_.EXTRUDE;case"fill":return null!=t.outline&&t.outline.size>0?_.FILL_OUTLINE:_.FILL;case"water":return _.FILL;case"line":return"round"===t.join?_.LINE_ROUND:_.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return _.PATH_ROUND_CIRCLE;case"quad":return _.PATH_ROUND_QUAD;default:return void(0,r.Xb)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return _.PATH_MITER_CIRCLE;case"quad":return _.PATH_MITER_QUAD;default:return void(0,r.Xb)(t.profile)}default:return}case"object":return i?_.OBJECT_POINT:_.OBJECT_POLYGON;case"icon":case"text":return i?_.ICON_POINT:_.ICON_POLYGON;default:return}}function f(e){return e.reduce((e,t,i)=>e+t.numVertices*(1/10**i),0)/e.reduce((e,t,i)=>e+1/10**i,0)}let _={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}}},95946:(e,t,i)=>{i.d(t,{qD:()=>s,r4:()=>a});var r=i(44120);let s=1.2,a=r.uY}}]);