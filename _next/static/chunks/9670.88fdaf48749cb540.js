"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9670],{7859:(e,t,r)=>{r.d(t,{B:()=>l});var n=r(31461),i=r(19158),s=r(61939),o=r(92753),a=r(6675);class l{constructor(e,t,r,n,i={}){this._mainMethod=t,this._transferLists=r,this._listeners=[],this._promise=(0,a.ho)(e,{...i,schedule:n}).then(e=>{if(void 0===this._thread)for(let t of(this._thread=e,this._promise=null,i.hasInitialize&&this.broadcast({},"initialize"),this._listeners))this._connectListener(t);else e.close()}),this._promise.catch(t=>s.A.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${t}`))}on(e,t){let r={removed:!1,eventName:e,callback:t,threadHandle:null};return this._listeners.push(r),this._connectListener(r),(0,i.hA)(()=>{r.removed=!0,(0,n.TF)(this._listeners,r),this._thread&&null!=r.threadHandle&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,r){if(this._thread){let n=this._transferLists[e],i=n?n(t):[];return this._thread.invoke(e,t,{transferList:i,signal:r})}return this._promise?this._promise.then(()=>((0,o.Te)(r),this.invokeMethod(e,t,r))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,t)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(t=>{e.removed||(e.threadHandle=t)})}}},9416:(e,t,r)=>{r.d(t,{K:()=>l});var n=r(20538),i=r(87196),s=r(63599),o=r(56911);class a{constructor(){this.position0=(0,o.vt)(),this.position1=(0,o.vt)(),this.faceNormal0=(0,o.vt)(),this.faceNormal1=(0,o.vt)(),this.componentIndex=0,this.cosAngle=0}}function l(e,t,r){let i=e.vertices.position,o=e.vertices.componentIndex,a=f.position0,l=f.position1,c=f.faceNormal0,v=f.faceNormal1,{edges:y,normals:T}=function(e){let t=e.faces.length/3,r=e.faces,n=e.neighbors,i=e.vertices.position;u.length=h.length=0;for(let e=0;e<t;e++){let t=3*e,o=n[t],a=n[t+1],l=n[t+2],c=r[t],d=r[t+1],f=r[t+2];i.getVec(c,E),i.getVec(d,S),i.getVec(f,I),(0,s.d)(S,S,E),(0,s.d)(I,I,E),(0,s.e)(E,S,I),(0,s.n)(E,E),h.pushArray(E),(-1===o||c<d)&&(u.push(c),u.push(d),u.push(e),u.push(o)),(-1===a||d<f)&&(u.push(d),u.push(f),u.push(e),u.push(a)),(-1===l||f<c)&&(u.push(f),u.push(c),u.push(e),u.push(l))}return{edges:u,normals:h}}(e),_=y.length/4,m=t.allocate(_),w=0,L=r?.allocate(_),R=0,C=0,M=0;d.length=0;for(let e=0;e<_;++e){let t=4*e;i.getVec(y.data[t],a),i.getVec(y.data[t+1],l);let r=d.pushNew();r.index=4*e,r.length=(0,s.j)(a,l)}d.sort((e,t)=>t.length-e.length);let b=[],P=[];d.forAll(({length:e,index:d})=>{var u,h,E,S;let I=y.data[d],_=y.data[d+1],D=y.data[d+2],k=y.data[d+3],U=-1===k;if(i.getVec(I,a),i.getVec(_,l),U){let e=3*D;(0,s.i)(c,T.data[e],T.data[e+1],T.data[e+2]),(0,s.c)(v,c),f.componentIndex=o.get(I),f.cosAngle=(0,s.f)(c,v)}else{let e=3*D;if((0,s.i)(c,T.data[e],T.data[e+1],T.data[e+2]),e=3*k,(0,s.i)(v,T.data[e],T.data[e+1],T.data[e+2]),f.componentIndex=o.get(I),f.cosAngle=(0,s.f)(c,v),u=f,h=N,u.cosAngle>h)return;f.cosAngle<-.9999&&(0,s.c)(v,c)}C+=e,M++,U||(E=f,S=A,E.cosAngle<S)?(t.write(m,w++,f),b.push(e)):function(e,t){let r=(0,n.XM)(e.cosAngle);return(0,s.o)(g,e.position1,e.position0),r*((0,s.f)((0,s.e)(p,e.faceNormal0,e.faceNormal1),g)>0?-1:1)>t}(f,O)&&(L&&r&&r.write(L,R++,f),P.push(e))});let D=new Float32Array(b.reverse()),k=new Float32Array(P.reverse()),U=L&&r?{instancesData:L.slice(0,R),lodInfo:{lengths:k}}:void 0;return{regular:{instancesData:m.slice(0,w),lodInfo:{lengths:D}},silhouette:U,averageEdgeLength:C/M}}class c{constructor(){this.index=0,this.length=0}}let d=new i.A({allocator:e=>e||new c,deallocator:null}),u=new i.A({deallocator:null}),h=new i.A({deallocator:null}),f=new a,p=(0,o.vt)(),g=(0,o.vt)(),E=(0,o.vt)(),S=(0,o.vt)(),I=(0,o.vt)(),O=(0,n.kU)(4),N=Math.cos(O),A=Math.cos((0,n.kU)(35))},26434:(e,t,r)=>{r.d(t,{U:()=>s});var n=r(93446),i=r(99419);function s(e,t=0){let r=e.stride;return Array.from(e.fields.keys()).map(n=>{let s=e.fields.get(n),a=s.constructor.ElementCount,l=function(e){let t=o[e];if(t)return t;throw Error("BufferType not supported in WebGL")}(s.constructor.ElementType),c=s.offset,d=s.optional?.glNormalized??!1;return new i._(n,a,l,c,r,d,t)})}let o={u8:n.pe.UNSIGNED_BYTE,u16:n.pe.UNSIGNED_SHORT,u32:n.pe.UNSIGNED_INT,i8:n.pe.BYTE,i16:n.pe.SHORT,i32:n.pe.INT,f32:n.pe.FLOAT}},35715:(e,t,r)=>{r.d(t,{L:()=>i,s:()=>s});var n=r(83094);function i(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:new n.l5(e.layout)}}function s(e){return new n.q3(e.layout).createView(e.buffer)}},50082:(e,t,r)=>{r.d(t,{C:()=>o});var n=r(64088),i=r(99392),s=r(55186);class o extends i.w{constructor(e){super({...e,constraint:new n.i7(e.targetPoint)})}get hints(){return[new s._(this.targetPoint,this.isDraped,this.domain)]}}},53041:(e,t,r)=>{var n;function i(e){return e===n.POSITION}r.d(t,{b:()=>i,r:()=>n}),function(e){e.POSITION="position",e.NORMAL="normal",e.NORMALCOMPRESSED="normalCompressed",e.UV0="uv0",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.ROTATION="rotation",e.TANGENT="tangent",e.OFFSET="offset",e.PERSPECTIVEDIVIDE="perspectiveDivide",e.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",e.LENGTH="length",e.PREVPOSITION="prevPosition",e.NEXTPOSITION="nextPosition",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.INSTANCEMODELORIGINHI="instanceModelOriginHi",e.INSTANCEMODELORIGINLO="instanceModelOriginLo",e.INSTANCEMODEL="instanceModel",e.INSTANCEMODELNORMAL="instanceModelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMAL2COMPRESSED="normal2Compressed",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.START_UP="startUp",e.END_UP="endUp",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"}(n||(n={}))},55186:(e,t,r)=>{r.d(t,{_:()=>s});var n=r(63599),i=r(62358);class s extends i.m{constructor(e,t,r){super(t,r),this.point=e}equals(e){return e instanceof s&&(0,n.p)(this.point,e.point)}}},78651:(e,t,r)=>{r.d(t,{aT:()=>i,fA:()=>s});var n=r(20538);function i(e,t,r,n,s,a=2){let l=1/(Math.abs(r)+Math.abs(n)+Math.abs(s)),c=r*l,d=n*l,u=s<=0?(c>=0?1:-1)*(1-Math.abs(d)):c,h=s<=0?(d>=0?1:-1)*(1-Math.abs(c)):d,f=t*a;e[f]=o(u),e[f+1]=o(h)}function s(e){let t=e.length/3,r=new Int16Array(2*t),n=0;for(let s=0;s<t;++s)i(r,s,e[n++],e[n++],e[n++]);return r}function o(e){return(0,n.qE)(Math.round(32767*e),-32767,32767)}r(63599),r(56911),r(75169)},89887:(e,t,r)=>{r.d(t,{o6:()=>_,HY:()=>M,hx:()=>m,Jb:()=>C});var n=r(91819);function i(e,t,r){let n=t/3,i=new Uint32Array(r+1),s=new Uint32Array(r+1),o=(e,t)=>{e<t?i[e+1]++:s[t+1]++};for(let t=0;t<n;t++){let r=e[3*t],n=e[3*t+1],i=e[3*t+2];o(r,n),o(n,i),o(i,r)}let a=0,l=0;for(let e=0;e<r;e++){let t=i[e+1],r=s[e+1];i[e+1]=a,s[e+1]=l,a+=t,l+=r}let c=new Uint32Array(6*n),d=i[r],u=(e,t,r)=>{if(e<t){let n=i[e+1]++;c[2*n]=t,c[2*n+1]=r}else{let n=s[t+1]++;c[2*d+2*n]=e,c[2*d+2*n+1]=r}};for(let t=0;t<n;t++){let r=e[3*t],n=e[3*t+1],i=e[3*t+2];u(r,n,t),u(n,i,t),u(i,r,t)}let h=(e,t)=>{let r=2*e,n=t-e;for(let e=1;e<n;e++){let t=c[r+2*e],n=c[r+2*e+1],i=e-1;for(;i>=0&&c[r+2*i]>t;i--)c[r+2*i+2]=c[r+2*i],c[r+2*i+3]=c[r+2*i+1];c[r+2*i+2]=t,c[r+2*i+3]=n}};for(let e=0;e<r;e++)h(i[e],i[e+1]),h(d+s[e],d+s[e+1]);let f=new Int32Array(3*n),p=(t,r)=>t===e[3*r]?0:t===e[3*r+1]?1:t===e[3*r+2]?2:-1,g=(e,t)=>{let r=p(e,t);f[3*t+r]=-1},E=(e,t,r,n)=>{let i=p(e,t);f[3*t+i]=n;let s=p(r,n);f[3*n+s]=t};for(let e=0;e<r;e++){let t=i[e],r=i[e+1],n=s[e],o=s[e+1];for(;t<r&&n<o;){let r=c[2*t],i=c[2*d+2*n];r===i?(E(e,c[2*t+1],i,c[2*d+2*n+1]),t++,n++):r<i?(g(e,c[2*t+1]),t++):(g(i,c[2*d+2*n+1]),n++)}for(;t<r;)g(e,c[2*t+1]),t++;for(;n<o;)g(c[2*d+2*n],c[2*d+2*n+1]),n++}return f}var s=r(83094),o=r(53041),a=r(91458),l=r(33638),c=r(63599),d=r(56911),u=r(26434),h=r(78651);class f{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?I:S}write(e,t,r){var n;y.seed=this._edgeHashFunction(r);let i=y.getIntRange(0,255),s=y.getIntRange(0,this.settings.variants-1),o=y.getFloat(),a=255*(.5*(Math.abs(n=-(1-Math.min(o/.7,1))+Math.max(0,o-.7)/.30000000000000004)**1.2*Math.sign(n))+.5);e.position0.setVec(t,r.position0),e.position1.setVec(t,r.position1),e.componentIndex.set(t,r.componentIndex),e.variantOffset.set(t,i),e.variantStroke.set(t,s),e.variantExtension.set(t,a)}}let p=new Float32Array(6),g=new Uint32Array(p.buffer),E=new Uint32Array(1);function S(e){return p[0]=e.position0[0],p[1]=e.position0[1],p[2]=e.position0[2],p[3]=e.position1[0],p[4]=e.position1[1],p[5]=e.position1[2],E[0]=31*(31*(31*(31*(31*(166811+g[0])+g[1])+g[2])+g[3])+g[4])+g[5],E[0]}function I(e){p[0]=O(e.position0[0]),p[1]=O(e.position0[1]),p[2]=O(e.position0[2]),p[3]=O(e.position1[0]),p[4]=O(e.position1[1]),p[5]=O(e.position1[2]),E[0]=5381;for(let e=0;e<g.length;e++)E[0]=31*E[0]+g[e];return E[0]}function O(e){return Math.round(1e4*e)/1e4}class N{constructor(){this._commonWriter=new f}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return a.gr.createBuffer(e)}write(e,t,r){this._commonWriter.write(e,t,r),(0,c.g)(v,r.faceNormal0,r.faceNormal1),(0,c.n)(v,v);let{typedBuffer:n,typedBufferStride:i}=e.normalCompressed;(0,h.aT)(n,t,v[0],v[1],v[2],i)}}N.Layout=a.gr,N.glLayout=(0,u.U)(a.gr,1);class A{constructor(){this._commonWriter=new f}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return a.In.createBuffer(e)}write(e,t,r){this._commonWriter.write(e,t,r);{let{typedBuffer:n,typedBufferStride:i}=e.normalCompressed;(0,h.aT)(n,t,r.faceNormal0[0],r.faceNormal0[1],r.faceNormal0[2],i)}{let{typedBuffer:n,typedBufferStride:i}=e.normal2Compressed;(0,h.aT)(n,t,r.faceNormal1[0],r.faceNormal1[1],r.faceNormal1[2],i)}}}A.Layout=a.In,A.glLayout=(0,u.U)(a.In,1);let v=(0,d.vt)(),y=new l.A;var T=r(9416);function _(e){let t=m(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return L.updateSettings(e.writerSettings),R.updateSettings(e.writerSettings),(0,T.K)(t,L,R)}function m(e,t,r,s){if(t){let t=i(r,s,e.count);return new w(r,s,t,e)}let o=(0,n.b)(e.buffer,e.stride/4,{originalIndices:r,originalIndicesLength:s}),l=i(o.indices,s,o.uniqueCount);return{faces:o.indices,facesLength:o.indices.length,neighbors:l,vertices:a.I$.createView(o.buffer)}}class w{constructor(e,t,r,n){this.faces=e,this.facesLength=t,this.neighbors=r,this.vertices=n}}let L=new N,R=new A,C=(0,s.BP)().vec3f(o.r.POSITION0).vec3f(o.r.POSITION1),M=(0,s.BP)().vec3f(o.r.POSITION0).vec3f(o.r.POSITION1).u16(o.r.COMPONENTINDEX)},91458:(e,t,r)=>{r.d(t,{I$:()=>o,In:()=>c,gr:()=>l});var n=r(26434),i=r(83094),s=r(53041);let o=(0,i.BP)().vec3f(s.r.POSITION).u16(s.r.COMPONENTINDEX).freeze(),a=(0,i.BP)().vec2u8(s.r.SIDENESS).freeze(),l=((0,n.U)(a),(0,i.BP)().vec3f(s.r.POSITION0).vec3f(s.r.POSITION1).vec2i16(s.r.NORMALCOMPRESSED).u16(s.r.COMPONENTINDEX).u8(s.r.VARIANTOFFSET,{glNormalized:!0}).u8(s.r.VARIANTSTROKE).u8(s.r.VARIANTEXTENSION,{glNormalized:!0}).freeze()),c=(0,i.BP)().vec3f(s.r.POSITION0).vec3f(s.r.POSITION1).vec2i16(s.r.NORMALCOMPRESSED).vec2i16(s.r.NORMAL2COMPRESSED).u16(s.r.COMPONENTINDEX).u8(s.r.VARIANTOFFSET,{glNormalized:!0}).u8(s.r.VARIANTSTROKE).u8(s.r.VARIANTEXTENSION,{glNormalized:!0}).freeze();s.r.POSITION0,s.r.POSITION1,s.r.COMPONENTINDEX,s.r.VARIANTOFFSET,s.r.VARIANTSTROKE,s.r.VARIANTEXTENSION,s.r.NORMALCOMPRESSED,s.r.NORMAL2COMPRESSED,s.r.SIDENESS},91819:(e,t,r)=>{r.d(t,{b:()=>s});var n=r(20538),i=r(95775);function s(e,t,r){let s=Array.isArray(e),a=s?e.length/t:e.byteLength/(4*t),l=s?e:new Uint32Array(e,0,a*t),c=r?.minReduction??0,d=r?.originalIndices||null,u=d?d.length:0,h=r?.componentOffsets||null,f=0;if(h)for(let e=0;e<h.length-1;e++){let t=h[e+1]-h[e];t>f&&(f=t)}else f=a;let p=Math.floor(1.1*f)+1;(null==o||o.length<2*p)&&(o=new Uint32Array((0,n.cU)(2*p)));for(let e=0;e<2*p;e++)o[e]=0;let g=0,E=!!h&&!!d,S=E?u:a,I=(0,i.my)(a),O=new Uint32Array(u),N=0!==c?Math.ceil(15.366399999999999/(c*c)*c*(1-c)):S,A=1,v=h?h[1]:S;for(let e=0;e<S;e++){if(e===N){let t=1-g/e;if(t+1.96*Math.sqrt(t*(1-t)/e)<c)return null;N*=2}if(e===v){for(let e=0;e<2*p;e++)o[e]=0;if(d)for(let e=h[A-1];e<h[A];e++)O[e]=I[d[e]];v=h[++A]}let r=E?d[e]:e,n=r*t,i=function(e,t,r){let n=0;for(let i=0;i<r;i++)n=(n=e[t+i]+n|0)+(n<<11)+(n>>>2)|0;return n>>>0}(l,n,t),s=i%p,a=g;for(;0!==o[2*s+1];){if(o[2*s]===i){let e=o[2*s+1]-1;if(function(e,t,r,n){for(let i=0;i<n;i++)if(e[t+i]!==e[r+i])return!1;return!0}(l,n,e*t,t)){a=I[e];break}}++s>=p&&(s-=p)}a===g&&(o[2*s]=i,o[2*s+1]=r+1,g++),I[r]=a}if(0!==c&&1-g/a<c)return null;if(E){for(let e=h[A-1];e<O.length;e++)O[e]=I[d[e]];I=(0,i.Dg)(O)}let y=s?Array(g):new Uint32Array(g*t);g=0;for(let e=0;e<S;e++)I[e]===g&&(function(e,t,r,n,i){for(let s=0;s<i;s++)r[n+s]=e[t+s]}(l,(E?d[e]:e)*t,y,g*t,t),g++);if(d&&!E){let e=new Uint32Array(u);for(let t=0;t<e.length;t++)e[t]=I[d[t]];I=(0,i.Dg)(e)}return{buffer:Array.isArray(y)?y:y.buffer,indices:I,uniqueCount:g}}let o=null},99670:(e,t,r)=>{r.r(t),r.d(t,{SceneLayerSnappingSource:()=>L});var n=r(81856),i=r(28690),s=r(31461),o=r(92753),a=r(91838);r(57845),r(61939);var l=r(12709),c=r(19158),d=r(40941);r(33638);var u=r(18524),h=r(48678),f=r(7859),p=r(35715),g=r(89887);class E extends f.B{constructor(e){super("EdgeProcessingWorker","extract",{extract:e=>[e.dataBuffer],extractComponentsEdgeLocations:e=>[e.dataBuffer],extractEdgeLocations:e=>[e.dataBuffer]},e)}async process(e,t,r){var n;return r?(0,g.o6)(e):(n=await this.invoke(new S(e),t),{regular:{instancesData:(0,p.s)(n.regular.instancesData),lodInfo:{lengths:new Float32Array(n.regular.lodInfo.lengths)}},silhouette:{instancesData:(0,p.s)(n.silhouette.instancesData),lodInfo:{lengths:new Float32Array(n.silhouette.lodInfo.lengths)}},averageEdgeLength:n.averageEdgeLength})}async extractEdgeLocations(e,t){let r=await this.invokeMethod("extractEdgeLocations",new S(e),t);return(0,p.s)(r)}async extractComponentsEdgeLocations(e,t){let r=await this.invokeMethod("extractComponentsEdgeLocations",new S(e),t);return(0,p.s)(r)}}class S{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=(0,h.iu)(e.indices)?e.indices.buffer:e.indices,this.indicesType=(0,h.iu)(e.indices)?(0,h.XJ)(e.indices)?"Uint32Array":"Uint16Array":"Array",this.indicesLength=e.indicesLength}}var I=r(56911),O=r(7916),N=r(73541),A=r(87255),v=r(50082);let y=class extends i.A{constructor(e){super(e),this.availability=0,this._ids=new Set}destroy(){this._workerHandle.destroy(),this._workerHandle=null}initialize(){this._workerHandle=new T(this.schedule,{fetchAllEdgeLocations:(e,t)=>this._fetchAllEdgeLocations(e,t)})}async fetchCandidates(e,t){let r=e.coordinateHelper,{point:n}=e;this.renderCoordsHelper.toRenderCoords(n,r.spatialReference,_);let i=e.distance,s="number"==typeof i?i:i.distance,o=await this._workerHandle.invoke({bounds:(0,O.f)(_[0],_[1],_[2],s),returnEdge:e.returnEdge,returnVertex:"none"!==e.vertexMode},t);return o.candidates.sort((e,t)=>e.distance-t.distance),o.candidates.map(e=>this._convertCandidate(r,e))}async add(e,t){this._ids.add(e.id),await this._workerHandle.invokeMethod("add",e,t)}async remove(e,t){this._ids.delete(e.id),await this._workerHandle.invokeMethod("remove",e,t)}_convertCandidate(e,t){switch(t.type){case"edge":return new A.z({objectId:t.objectId,targetPoint:(0,N.de)(this._convertRenderCoordinate(e,t.target)),edgeStart:this._convertRenderCoordinate(e,t.start),edgeEnd:this._convertRenderCoordinate(e,t.end),isDraped:!1});case"vertex":return new v.C({objectId:t.objectId,targetPoint:(0,N.de)(this._convertRenderCoordinate(e,t.target)),isDraped:!1})}}_convertRenderCoordinate({spatialReference:e},t){let r=(0,I.vt)();return this.renderCoordsHelper.fromRenderCoords(t,r,e),(0,N._7)(r)}async _fetchAllEdgeLocations(e,t){let r=[],n=[];for(let{id:i,uid:s}of e.components)this._ids.has(i)&&r.push((async()=>{let e=await this.fetchEdgeLocations(i,t.signal),r=e.locations.buffer;return n.push(r),{id:i,uid:s,objectIds:e.objectIds,locations:r,origin:e.origin,type:e.type}})());return{result:{components:(await Promise.all(r)).filter(({id:e})=>this._ids.has(e))},transferList:n}}};(0,n._)([(0,a.MZ)({constructOnly:!0})],y.prototype,"renderCoordsHelper",void 0),(0,n._)([(0,a.MZ)({constructOnly:!0})],y.prototype,"fetchEdgeLocations",void 0),(0,n._)([(0,a.MZ)({constructOnly:!0})],y.prototype,"schedule",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],y.prototype,"availability",void 0),y=(0,n._)([(0,l.$)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorkerHandle")],y);class T extends f.B{constructor(e,t){super("SceneLayerSnappingSourceWorker","fetchCandidates",{},e,{strategy:"dedicated",client:t})}}let _=(0,I.vt)(),m=class extends i.A{get updating(){return this._updatingHandles.updating}constructor(e){super(e),this.availability=1,this._updatingHandles=new u.U,this._abortController=new AbortController}destroy(){this._tracker=(0,d.xt)(this._tracker),this._abortController=(0,d.DC)(this._abortController),this._updatingHandles.destroy()}initialize(){let{view:e}=this,t=e.resourceController;this._edgeWorker=new E(w(t)),this._workerHandle=new y({renderCoordsHelper:this.view.renderCoordsHelper,schedule:w(t),fetchEdgeLocations:async(e,t)=>{if(null==this._tracker)throw Error("tracker-not-initialized");return this._tracker.fetchEdgeLocations(e,this._edgeWorker,t)}}),this._updatingHandles.addPromise(this._setupLayerView()),this.addHandles([(0,c.DQ)(this._workerHandle),(0,c.DQ)(this._edgeWorker)])}async fetchCandidates(e,t){return this._workerHandle.fetchCandidates(e,t)}refresh(){}async _setupLayerView(){if(this.destroyed)return;let e=this._abortController?.signal,t=await this.getLayerView();null==t||(0,o.G4)(e)||(this._tracker=t.trackSnappingSources({add:(t,r)=>{this._updatingHandles.addPromise(this._workerHandle.add({id:t,bounds:r},e))},remove:t=>{this._updatingHandles.addPromise(this._workerHandle.remove({id:t},e))}}))}};function w(e){return t=>e.immediate.schedule(t)}(0,n._)([(0,a.MZ)({constructOnly:!0})],m.prototype,"getLayerView",void 0),(0,n._)([(0,a.MZ)({constructOnly:!0})],m.prototype,"view",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],m.prototype,"updating",null),(0,n._)([(0,a.MZ)({readOnly:!0})],m.prototype,"availability",void 0),m=(0,n._)([(0,l.$)("esri.views.interactive.snapping.featureSources.I3SSnappingSource")],m);let L=class extends i.A{get updating(){return this._i3sSources.some(e=>e.updating)}constructor(e){super(e),this.availability=1,this._i3sSources=[]}destroy(){this._i3sSources.forEach(e=>e.destroy()),this._i3sSources.length=0}initialize(){let{view:e}=this,t=this.layerSource.layer;this._i3sSources="building-scene"===t.type?this._getBuildingSceneI3SSources(e,t):[this._getSceneLayerI3SSource(e,t)]}async fetchCandidates(e,t){let r=await Promise.all(this._i3sSources.map(r=>r.fetchCandidates(e,t)));return(0,o.Te)(t),r.flat()}refresh(){this._i3sSources.forEach(e=>e.refresh())}_getBuildingSceneI3SSources(e,t){return t.allSublayers.toArray().map(r=>"building-component"===r.type?new m({getLayerView:async()=>(await e.whenLayerView(t)).whenSublayerView(r),view:e}):null).filter(s.Ru)}_getSceneLayerI3SSource(e,t){return new m({getLayerView:async()=>{let r=await e.whenLayerView(t);return"scene-layer-graphics-3d"===r.type?void 0:r},view:e})}};(0,n._)([(0,a.MZ)({constructOnly:!0})],L.prototype,"layerSource",void 0),(0,n._)([(0,a.MZ)({constructOnly:!0})],L.prototype,"view",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],L.prototype,"updating",null),(0,n._)([(0,a.MZ)({readOnly:!0})],L.prototype,"availability",void 0),L=(0,n._)([(0,l.$)("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],L)}}]);