"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5885],{51775:(e,t,i)=>{i.d(t,{m:()=>a});let n=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]];function a(e){return null!=e&&n.some(([t,i])=>e>=t&&e<=i)}},95885:(e,t,i)=>{i.r(t),i.d(t,{default:()=>er});var n=i(81856),a=i(39267),r=i(71017),s=i(32391),o=i(21892),l=i(92753),u=i(45257),p=i(91838);i(57845);var d=i(61939);i(33638);var m=i(12709),c=i(64171),f=i(24743),g=i(60349),h=i(78218),v=i(2043),y=i(54882),b=i(6255),w=i(23281),x=i(70442),C=i(76572),I=i(80824),S=i(11984),A=i(61414),D=i(51775),T=i(39166),L=i(48298);function V(e){return e.endsWith("?")?e.slice(0,-1):e}function M(e){return e.filter(({coverageSubType:e})=>null==e||""===e||/^rectified(grid|dataset)/i.test(e))}function N(e){let t=(0,L.V6)(e.querySelector("Operation[name=GetCapabilities]"),"Get")?.getAttribute("xlink:href")||"",i=(0,L.V6)(e.querySelector("Operation[name=DescribeCoverage]"),"Get")?.getAttribute("xlink:href")||"",n=(0,L.V6)(e.querySelector("Operation[name=GetCoverage]"),"Get")?.getAttribute("xlink:href")||"";return{getCapabilities:V(t),describeCoverage:V(i),getCoverage:V(n)}}var R=i(87960),P=i(65018),E=i(24088);function $(e){e.variables.forEach(e=>e.dimensions.forEach(e=>e.values??=(0,E.Xg)(e)))}function O(e,t){let i=(0,L.Dy)(e,"1.0.0"===t?"interpolationMethod":"InterpolationMethod"),n="1.0.0"===t?e.getAttribute("default"):(0,L.mX)(e,"InterpolationMethods/Default");return null!=n?[n].concat(i.filter(e=>e.toLowerCase()!==n.toLowerCase())):i}function _(e){return null==e?["nearest"]:e.map(e=>{let t=e.toLowerCase();return t.includes("nearest")?"nearest":t.includes("linear")?"bilinear":t.includes("cubic")?"cubic":null}).filter(e=>!!e)}function X(e,t){let i=(0,L.Dy)(e,t);return i?.length&&""!==i[0]&&!isNaN(Number(i[0]))?i.map(e=>Number(e)):null}function k(e){return null==e?null:e.every(t=>t===e[0])?e[0]:e}function F(e){let t=(0,L.IC)(e,"timeposition");if(t.length>0){let e=[];for(let i=0;i<t.length;i++)e.push(new Date((0,L.mX)(t[i])));return{begin:e[0],end:e[e.length-1],values:e}}let i=(0,L.V6)(e,"timePeriod")||(0,L.V6)(e,"TimePeriod");return i?{begin:new Date((0,L.mX)(i,"beginPosition")||(0,L.mX)(i,"BeginPosition")),end:new Date((0,L.mX)(i,"endPosition")||(0,L.mX)(i,"EndPosition")),...function(e=null){let t,i,n;if(!e)return{resolution:null,units:null};let a=e.toUpperCase(),r=["Years","Months","Days","Hours","Minutes","Seconds"];return a.includes("PT")?(a=a.slice(2),t=r[3+(n=["H","M","S"].findIndex(e=>a.includes(e)))]):(a=a.slice(1),(n=["Y","M","D"].findIndex(e=>a.includes(e)))>-1&&(t=r[n])),{resolution:parseFloat(a.slice(0,-1)),units:t}}((0,L.mX)(i,"timeResolution")||(0,L.mX)(i,"TimeResolution"))}:null}async function G(e,t){let{version:i,customParameters:n,signal:a}=t??{},r=i?.startsWith("1.0")?"version":"acceptVersions",o={service:"WCS",request:"GetCapabilities",[r]:i,...n};try{let{data:i}=await (0,T.A)(e,{query:o,responseType:"xml",signal:a});return t?.version||function(e){let t=null,i=("string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e).documentElement.getAttribute("version"),n=i?.slice(0,3);return null!=n&&n<"2.1"}(i)||(o[r]="2.0.1",{data:i}=await (0,T.A)(e,{query:o,responseType:"xml",signal:a})),function(e,t=null){let i,n=null,a=(n="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e).documentElement.getAttribute("version");"1.0"===a?a="1.0.0":"1.1"===a&&(a="1.1.0");let r=a||t||"1.0.0",o=r.slice(0,3);if("2.0"===o)i=function(e){let t=(0,L.V6)(e,"ServiceIdentification"),i=(0,L.mX)(t,"Title"),n=(0,L.Dy)(t,"ServiceTypeVersion"),a=(0,L.Dy)(t,"Profile"),r=N((0,L.V6)(e,"OperationsMetadata")),s=(0,L.IC)(e,"Contents/CoverageSummary"),o=[];for(let e=0;e<s.length;e++){let t,i=s[e],n=(0,L.mX)(i,"CoverageId"),a=(0,L.V6)(i,"WGS84BoundingBox");if(a){let e=(0,L.pN)(a,"LowerCorner"),i=(0,L.pN)(a,"UpperCorner");t=new A.A({xmin:e[0],ymin:e[1],xmax:i[0],ymax:i[1],spatialReference:{wkid:4326}})}let r=(0,L.mX)(i,"CoverageSubtype")||"RectifiedGridCoverage";o.push({id:n,lonLatEnvelope:t,coverageSubType:r})}let l=(0,L.V6)(e,"ServiceMetadata");return{name:i,supportedVersions:n,supportedFormats:(0,L.Dy)(l,"formatSupported"),supportedInterpolations:(0,L.Dy)(l,"interpolationSupported").concat((0,L.Dy)(l,"InterpolationSupported")),onlineResources:r,profiles:a,coverages:o,gridCoverages:M(o),version:"2.0.1"}}(n);else if("1.1"===o)i=function(e){let t=(0,L.mX)(e,"ServiceIdentification/Title"),i=(0,L.Dy)(e,"ServiceIdentification/ServiceTypeVersion"),n=N((0,L.V6)(e,"OperationsMetadata")),a=[],r=(0,L.V6)(e,"Contents");for(let e=0;e<r.childNodes.length;e++){let t=r.childNodes[e];1===t.nodeType&&(0,L.g7)(t,"CoverageSummary")&&function e(t,i){if(t.coverageSummaries)for(let n=0;n<t.coverageSummaries.length;n++)t.coverageSummaries[n].abstract=t.coverageSummaries[n].abstract||t.abstract,t.coverageSummaries[n].lonLatEnvelope=t.coverageSummaries[n].lonLatEnvelope||t.lonLatEnvelope,t.coverageSummaries[n].title=t.coverageSummaries[n].title||t.title,e(t.coverageSummaries[n],i);null!=t.id&&i.push(t)}(function e(t){let i={};for(let n=0;n<t.childNodes.length;n++){let a=t.childNodes[n];if(1!==a.nodeType)continue;let r=(0,L.vv)(a).toLowerCase();switch(r){case"title":case"abstract":i[r]=(0,L.mX)(a);break;case"identifier":i.id=(0,L.mX)(a);break;case"wgs84boundingbox":{let e=(0,L.pN)(a,"LowerCorner"),t=(0,L.pN)(a,"UpperCorner");i.lonLatEnvelope=new A.A({xmin:e[0],ymin:e[1],xmax:t[0],ymax:t[1],spatialReference:{wkid:4326}})}break;case"coveragesummary":i.coverageSummaries=i.coverageSummaries||[],i.coverageSummaries.push(e(a))}}return i}(t),a)}let s=(0,L.Dy)(r,"SupportedFormat");return{name:t,onlineResources:n,coverages:a,gridCoverages:M(a),supportedVersions:i,supportedFormats:s,version:"1.1.0"}}(n);else{if("1.0"!==o)throw new s.A("wcsraster:parsecapabilities","the capabilities version is not supported");i=function(e){let t=(0,L.mX)(e,"Service/name"),i=(0,L.V6)(e,"Capability"),n=(0,L.V6)(i,"GetCapabilities/Get/OnlineResource")?.getAttribute("xlink:href")??"",a=(0,L.V6)(i,"DescribeCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"",r=(0,L.V6)(i,"GetCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"",s={getCapabilities:V(n),describeCoverage:V(a),getCoverage:V(r)},o=(0,L.IC)(e,"CoverageOfferingBrief"),l=[];for(let e=0;e<o.length;e++){let t=o[e],i=(0,L.mX)(t,"name"),n=(0,L.IC)(t,"pos"),a=(0,L.pN)(n[0]),r=(0,L.pN)(n[1]),s=new A.A({xmin:a[0],ymin:a[1],xmax:r[0],ymax:r[1],spatialReference:{wkid:4326}});l.push({id:i,lonLatEnvelope:s})}return{name:t,onlineResources:s,coverages:l,gridCoverages:M(l),supportedVersions:["1.0.0"],version:"1.0.0"}}(n)}return i.version=r,i}(i)}catch(e){if(!(0,l.zf)(e))throw new s.A("wcslayer:open","wcs capabilities is not valid or supported");throw e}}async function B(e,t){let{coverageIds:i,version:n,customParameters:a,signal:r}=t,o=n.slice(0,3),u={service:"WCS",request:"DescribeCoverage",version:n,["1.0"===o?"coverage":"1.1"===o?"identifiers":"coverageId"]:i.join(","),...a};try{let{data:t}=await (0,T.A)(e,{query:u,responseType:"xml",signal:r}),i=null;if(i="string"==typeof t?(new DOMParser).parseFromString(t,"text/xml"):t,"1.0.0"===n)return(0,L.IC)(i,"CoverageOffering").map(e=>(function(e){let t={version:"1.0"},i,n=[];for(let a=0;a<e.childNodes.length;a++){let r=e.childNodes[a];if(1===r.nodeType)if((0,L.g7)(r,"description"))t.description=(0,L.mX)(r);else if((0,L.g7)(r,"name"))t.name=(0,L.mX)(r);else if((0,L.g7)(r,"label"))t.label=(0,L.mX)(r);else if((0,L.g7)(r,"supportedFormats"))t.supportedFormats=(0,L.Dy)(r,"formats");else if((0,L.g7)(r,"supportedCRSs"))t.supportedCRSs={requestResponseCRSs:(0,L.Dy)(r,"requestResponseCRSs").map(e=>e.split(":")[1]),nativeCRSs:(0,L.Dy)(r,"nativeCRSs").map(e=>e.split(":")[1])};else if((0,L.g7)(r,"supportedInterpolations"))t.supportedInterpolations=O(r,"1.0.0");else if((0,L.g7)(r,"lonLatEnvelope"))t.lonLatEnvelope=function(e){let t=(0,L.IC)(e,"pos"),i=(0,L.pN)(t[0]),n=(0,L.pN)(t[1]);return new A.A({xmin:i[0],ymin:i[1],xmax:n[0],ymax:n[1],spatialReference:{wkid:4326}})}(r);else if((0,L.g7)(r,"rangeSet")){let e=function(e){let t=[],i=(0,L.IC)(e,"RangeSet"),n=[];for(let e=0;e<i.length;e++){let a=(0,L.mX)(i[e],"name"),r=(0,L.mX)(i[e],"label"),s=[],o=X(i[e],"nullValues/singleValue"),l=(0,L.IC)(i[e],"AxisDescription");for(let e=0;e<l.length;e++){let t=(0,L.mX)(l[e],"name"),i=(0,L.mX)(l[e],"label"),a=(0,L.Dy)(l[e],"singleValue");if(0===a.length){let t=(0,L.mX)(l[e],"min"),i=(0,L.mX)(l[e],"max"),n=Number((0,L.mX)(l[e],"res"))||1;if(null!==t&&null!==i)for(let e=parseInt(t,10);e<=parseInt(i,10);e+=n)a.push(e.toString())}"band"===t.toLowerCase()&&(n=a),s.push({name:t,label:i,values:a})}t.push({name:a,label:r,nullValues:o,axis:s})}return{rangeSet:t,bandNames:n}}(r);t.rangeSet=e.rangeSet,n=e.bandNames;let a=e.rangeSet[0].nullValues;a?.length&&(i=k(a))}else(0,L.g7)(r,"domainSet")&&(t.domainSet=function(e){let t=(0,L.V6)(e,"spatialDomain"),i=(0,L.V6)(t,"Envelope")||(0,L.V6)(t,"EnvelopeWithTimePeriod"),n=i.getAttribute("srsName").split(":"),a=n[n.length-1],r=(0,L.IC)(i,"pos"),s=(0,L.pN)(r[0]),o=(0,L.pN)(r[1]),l=parseInt(a,10),u=isNaN(l)?null:{wkid:l},p=new A.A({xmin:s[0],ymin:s[1],xmax:o[0],ymax:o[1],spatialReference:u}),d=(0,L.V6)(t,"RectifiedGrid"),m=(0,L.mX)(d,"low").split(" "),c=(0,L.mX)(d,"high").split(" "),f=parseInt(c[0],10)-parseInt(m[0],10)+1,g=parseInt(c[1],10)-parseInt(m[1],10)+1,h=(0,L.pN)(t,"origin/pos"),v=(0,L.IC)(t,"offsetVector"),y={envelope:p,columns:f,rows:g,offset:{x:parseFloat((0,L.mX)(v[0]).split(" ")[0]),y:parseFloat((0,L.mX)(v[1]).split(" ")[1])},origin:{x:h[0],y:h[1]}},b=(0,L.V6)(e,"temporalDomain")||(0,L.V6)(e,"TemporalDomain");return{spatialDomain:y,temporalDomain:b?F(b):null}}(r))}let a=_(t.supportedInterpolations),{name:r,description:s,label:o,lonLatEnvelope:l,supportedFormats:u}=t,{spatialDomain:p}=t.domainSet,d={x:Math.abs(p.offset.x),y:Math.abs(p.offset.y)},m=function(e){if(!e.temporalDomain)return null;let{begin:t,end:i,values:n,units:a,resolution:r}=e.temporalDomain,s={variables:[{name:"default",description:"",dimensions:[{name:"StdTime",description:"",unit:"ISO8601",values:n?.map(e=>e.getTime()),hasRegularIntervals:!n,interval:r,intervalUnit:a,extent:[t.getTime(),i.getTime()]}]}]};return $(s),s}(t.domainSet),c=new P.A({width:p.columns,height:p.rows,pixelSize:d,pixelType:"unknown",extent:p.envelope,spatialReference:p.envelope.spatialReference,bandCount:n.length||1,noDataValue:i,multidimensionalInfo:m});return{id:r,title:t.name,description:s||o,lonLatEnvelope:l,rasterInfo:c,bandNames:n,supportedFormats:u,supportedInterpolations:a,coverageDescription:t,version:"1.0.0",useEPSGAxis:!1}})(e));let a=(0,L.IC)(i,"CoverageDescription");return"1.1.0"===n||"1.1.1"===n||"1.1.2"===n?a.map(e=>(function(e,t){let i=[],n=[],a={supportedFormats:i,supportedCRSs:n,version:"1.1"},r,s,o=[];for(let t=0;t<e.childNodes.length;t++){let l=e.childNodes[t];if(1!==l.nodeType)continue;let u=(0,L.vv)(l).toLowerCase();switch(u){case"title":case"abstract":case"identifier":a[u]=(0,L.mX)(l);break;case"supportedformat":{let e=(0,L.mX)(l);i.includes(e)||i.push(e)}break;case"supportedcrs":{let e=(0,L.mX)(l);n.includes(e)||n.push(e)}break;case"range":{let e=function(e,t){let i=[],n=(0,L.IC)(e,"Field"),a,r=[];for(let e=0;e<n.length;e++){let s=(0,L.mX)(n[e],"Identifier"),o=(0,L.mX)(n[e],"Description"),l=(0,L.mX)(n[e],"Definition"),u=(0,L.mX)(n[e],"Abstract"),p=(0,L.mX)(n[e],"Title"),d=X(n[e],"NullValue"),m=(0,L.V6)(n[e],"AllowedValues"),c=m?function(e){let t=(0,L.pN)(e,"MinimumValue"),i=(0,L.pN)(e,"MaximumValue");return t.length&&i.length?t.map((e,t)=>({min:e,max:i[t],avg:-1,stddev:-1})):null}(m):null,f=O(n[e],"1.1.0"),g=[],h=(0,L.IC)(n[e],"Axis");for(let e=0;e<h.length;e++){let i=h[e].getAttribute("identifier"),n=(0,L.mX)(h[e],"UOM"),s=(0,L.mX)(h[e],"DataType"),o=(0,L.Dy)(h[e],"Key");t&&!i.toLowerCase().includes("band")||(r=o,a=d),g.push({identifier:i,uom:n,dataType:s,values:o,bandNoDataValues:a})}i.push({identifier:s,description:o,definition:l,abstract:u,title:p,supportedInterpolations:f,axis:g,nullValues:d,statistics:c})}return{rangeSet:i,bandNames:r,bandNoDataValues:a,statistics:i[0].statistics}}(l,!!a.domain?.temporalDomain);a.range=e.rangeSet,o=e.bandNames;let{bandNoDataValues:t}=e;t?.length&&(r=k(t)),s=e.statistics}break;case"domain":a.domain=function(e){let t,i,n,a,r=(0,L.V6)(e,"SpatialDomain"),s=(0,L.V6)(r,"GridCRS"),o=(0,L.mX)(s,"GridBaseCRS"),l=(0,L.mX)(s,"GridOrigin"),u=l?.split(" ").map(e=>parseFloat(e))??[0,0],p=(0,L.pN)(s,"GridOffsets"),d=(0,L.IC)(r,"BoundingBox");for(let e=0;e<d.length;e++){let r=d[e].getAttribute("crs")?.toLowerCase();if(null!=r){if(r.includes("imagecrs")){let n=(0,L.pN)(d[e],"LowerCorner"),a=(0,L.pN)(d[e],"UpperCorner");t=a[0]-n[0]+1,i=a[1]-n[1]+1}else if(r.indexOf("epsg")>0){let t=r.split(":");n=parseInt(t[t.length-1],10);let i=(0,L.pN)(d[e],"LowerCorner"),s=(0,L.pN)(d[e],"UpperCorner");a=new A.A({xmin:i[0],ymin:i[1],xmax:s[0],ymax:s[1],spatialReference:{wkid:n}})}}}let m=t>i,c=a.xmax-a.xmin>a.ymax-a.ymin,f=!1;(0,D.m)(n)&&(m===c?f=!1:(f=!0,a=new A.A({xmin:a.ymin,ymin:a.xmin,xmax:a.ymax,ymax:a.xmax,spatialReference:{wkid:n}})));let g={columns:t,rows:i,origin:{x:u[0],y:u[1]},offset:{x:p[0],y:p[p.length-1]},gridBaseCRS:o,envelope:a,useEPSGAxis:f},h=(0,L.V6)(e,"temporalDomain")||(0,L.V6)(e,"TemporalDomain");return{spatialDomain:g,temporalDomain:h?F(h):null}}(l)}}let l=_(a.range[0].supportedInterpolations),{identifier:u,abstract:p,title:d,domain:m,range:c}=a,f={x:Math.abs(m.spatialDomain.offset.x),y:Math.abs(m.spatialDomain.offset.y)},g=function(e,t){if(!t.temporalDomain)return null;let i=e.filter(e=>!e.identifier.toLowerCase().includes("field_1")&&!e.axis.some(e=>e.identifier.includes("band"))),n=[];if(i.length&&i.forEach(e=>{let t=e.axis.map(e=>{let t=e.values.map(t=>"ISO8601"===e.uom?(t=t.trim()).toLowerCase().includes("z")?new Date(t).getTime():new Date(t+"Z").getTime():parseFloat(t.trim())),i=[Math.min.apply(null,t),Math.max.apply(null,t)];return{name:e.identifier.trim(),description:"",field:e.identifier.trim(),unit:e.uom?e.uom.trim():"",hasRegularIntervals:!1,values:t,extent:i}});n.push({name:e.identifier.trim(),description:e.description?.trim()??"",unit:"",dimensions:t,statistics:e.statistics})}),t.temporalDomain){let{begin:e,end:i,values:a,units:r,resolution:s}=t.temporalDomain;n.some(e=>e.dimensions.some(e=>"stdtime"===e.name.toLowerCase()))||n.forEach(t=>{t.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:a?.map(e=>e.getTime()),hasRegularIntervals:!a,interval:s,intervalUnit:r,extent:[e.getTime(),i.getTime()]})})}if(n.length){let e={variables:n};return $(e),e}return null}(c,m);g&&(r=c[0].nullValues,1===r?.length&&(r=r[0]));let h=new P.A({width:m.spatialDomain.columns,height:m.spatialDomain.rows,pixelSize:f,pixelType:"unknown",extent:m.spatialDomain.envelope,spatialReference:m.spatialDomain.envelope.spatialReference,bandCount:o.length||1,noDataValue:r,statistics:s,multidimensionalInfo:g});return{id:u,title:a.title,description:p||d,bandNames:o,rasterInfo:h,supportedFormats:i,supportedInterpolations:l,coverageDescription:a,version:t,useEPSGAxis:m.spatialDomain.useEPSGAxis}})(e,n)):a.map(e=>(function(e){let t={version:"2.0"},i,n,a=[];for(let r=0;r<e.childNodes.length;r++){let s=e.childNodes[r];if(1===s.nodeType){if((0,L.g7)(s,"coverageId"))t.coverageId=(0,L.mX)(s);else if((0,L.g7)(s,"ServiceParameters"))t.serviceParameters={supportedFormats:(0,L.Dy)(s,"nativeFormat")};else if((0,L.g7)(s,"boundedBy"))t.boundedBy=function(e){let t,i,n,a=(0,L.V6)(e,"Envelope")||(0,L.V6)(e,"EnvelopeWithTimePeriod"),r=a.getAttribute("srsName"),s=r.slice(r.lastIndexOf("/")+1),o=a.getAttribute("axisLabels").split(" ").map(e=>e.trim()).filter(e=>""!==e.trim()),l=(0,L.pN)(a,"lowerCorner"),u=(0,L.pN)(a,"upperCorner"),p=!["y","lat","latitude","north","nor","n","b"].includes(o[0].toLowerCase()),d=parseInt(s,10),m=isNaN(d)?null:{wkid:d};t=new A.A(p?{xmin:l[0],ymin:l[1],xmax:u[0],ymax:u[1],spatialReference:m}:{xmin:l[1],ymin:l[0],xmax:u[1],ymax:u[0],spatialReference:m});let c=a.getAttribute("uomLabels").trim().split(" ");if((0,L.g7)(a,"EnvelopeWithTimePeriod")){i=new Date((0,L.mX)(e,"beginPosition")||(0,L.mX)(e,"BeginPosition")),n=new Date((0,L.mX)(e,"endPosition")||(0,L.mX)(e,"EndPosition"));let t=c?.findIndex(e=>"oledatetime"===e?.toLowerCase());t>-1&&(c[t]="ISO8601")}return{envelope:t,axisLabels:o,uomLabels:c.length?c:null,envelopeAllDims:{mins:l,maxs:u},beginPosition:i,endPosition:n,isEastFirst:p}}(s);else if((0,L.g7)(s,"rangeType")){let e=function(e,t){let i=[],n=(0,L.IC)(e,"DataRecord"),a=[],r,s=[];for(let e=0;e<n.length;e++){let o=(0,L.IC)(n[e],"field"),l=[];for(let e=0;e<o.length;e++){let i=o[e].getAttribute("name"),n=(0,L.mX)(o[e],"description")||"",u=(0,L.V6)(o[e],"uom")?.getAttribute("code")||"",p=(0,L.pN)(o[e],"interval"),d=X(o[e],"nilValue")?.[0];t&&!i.toLowerCase().includes("band")||(a.push(i),p?.length&&(r=r||[]).push({min:p[0],max:p[1],avg:-1,stddev:-1}),s.push(d)),l.push({name:i,description:n,uom:u,allowedValues:p,nilValue:d})}i.push(l)}return s.some(e=>null!=e)||(s=null),{rangeType:i,bandNames:a,bandStats:r,bandNoDataValues:s}}(s,t.boundedBy?.axisLabels.length>2||t.domainSet?.axisLabels.length>2);t.rangeType=e.rangeType,a=e.bandNames,i=e.bandStats;let{bandNoDataValues:r}=e;r?.length&&(n=k(r))}else if((0,L.g7)(s,"domainSet"))t.domainSet=function(e,t){let i,n,a,r=(0,L.V6)(e,"RectifiedGrid"),s=(0,L.pN)(r,"low"),o=(0,L.pN)(r,"high"),l=[];for(let e=0;e<s.length;e++)l.push(o[e]-s[e]+1);let u=(0,L.mX)(r,"axisLabels").split(" "),p=(0,L.pN)(r,"origin/pos"),d=(0,L.IC)(r,"offsetVector"),m=[];for(let e=0;e<d.length;e++){let t=(0,L.pN)(d[e]),i=t.findIndex(e=>0!==e);m[i]=t[i]}let c=!1;return t?.length&&u?.length&&(c=[...t].sort((e,t)=>e<t?-1:1).join(",")===[...u].sort((e,t)=>e<t?-1:1).join(",")),["y","lat","latitude","north","nor","n","b"].includes((c?u:t)[0].toLowerCase())?(i=l[1],n=l[0],a={y:Math.abs(m[0]),x:Math.abs(m[1])}):(i=l[0],n=l[1],a={x:Math.abs(m[0]),y:Math.abs(m[1])}),{columns:i,rows:n,origin:p,offset:m,resolution:a,gridSamples:l,axisLabels:u,hasSameAxisLabelsAsBoundedBy:c}}(s,t.boundedBy?.axisLabels);else if((0,L.g7)(s,"metadata")){let e=(0,L.V6)(s,"EOMetadata");t.eoMetadata=e?function(e){let t=(0,L.V6)(e,"EarthObservation");if(!t)return null;let i=(0,L.V6)(t,"phenomenonTime"),n=i?F(i):null,a=(0,L.V6)(t,"phenomenonTime"),r=a?F(a):null,s=(0,L.mX)(t,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList"),o=null;if(s){let e=s.split(" ").map(e=>e.trim()).filter(e=>null!=e&&""!==e).map(Number);if(e.length){let t=[];for(let i=0;i<e.length/2;i+=2)t.push(e[i],e[i+1]);o=new R.A({rings:[[t]]})}}return{observation:{phenomenonTime:n,resultTime:r,footprint:o,identifier:(0,L.mX)(e,"metaDataProperty/EarthObservationMetaData/identifier"),acquisitionType:(0,L.mX)(e,"metaDataProperty/EarthObservationMetaData/acquisitionType"),status:(0,L.mX)(e,"metaDataProperty/EarthObservationMetaData/status")}}}(e):null}}}let{coverageId:r,boundedBy:s,domainSet:o,rangeType:l,serviceParameters:u}=t,p=function(e,t,i){if(i.axisLabels.length<=2)return null;let n=[];for(let t=0;t<e.length;t++){let i=e[t];for(let e=0;e<i.length;e++)i[e].name.toLowerCase().includes("band")||n.push(i[e])}let a=[];if(n.length){let e=[];for(let n=2;n<i.axisLabels.length;n++){let a,r,s=t.uomLabels?.[n]?.trim()??"",o=i.axisLabels[n].toLowerCase().includes("time")||"iso8601"===s.toLowerCase()||"oledatetime"===s.toLowerCase();if(o){let e=function(e){let t=1,i="";return Math.abs(e-1/24)<1/24*.01?i="Hours":.01>Math.abs(e-1)?i="Days":e<1?(t=Math.round(24*e),i="Hours"):e>27.99&&e<31.01||12>Math.round(e/30)?i="Months":e>364.99&&e<366.01&&(i="Years"),{interval:t,intervalUnit:i}}(i.offset[n]);a=e.interval,r=e.intervalUnit}else a=i.offset[n],r=s;let l=[];o?(l.push((0,E.$E)(t.envelopeAllDims.mins[n])),l.push((0,E.$E)(t.envelopeAllDims.maxs[n]))):(l.push(t.envelopeAllDims.mins[n]),l.push(t.envelopeAllDims.maxs[n])),e.push({name:i.axisLabels[n].trim(),description:i.axisLabels[n].trim(),unit:o?"ISO8601":s,hasRegularIntervals:!0,extent:l,interval:a,intervalUnit:r})}if(n.forEach(t=>{let{allowedValues:i}=t,n=2===i?.length?[{min:i[0],max:i[1],avg:-1,stddev:-1}]:null;a.push({name:t.name.trim(),description:t.description?.trim()??"",unit:t.uom.trim(),statistics:n,dimensions:[...e]})}),a.length){let e={variables:a};return $(e),e}}return null}(l,s,o);return!i&&p&&(i=p?.variables[0].statistics),null!=p&&(n=l[0][0].nilValue),{id:r,title:r,description:r,bandNames:a,rasterInfo:new P.A({width:o.columns,height:o.rows,pixelSize:o.resolution,pixelType:"unknown",extent:s.envelope,spatialReference:s.envelope.spatialReference,bandCount:a.length||1,statistics:i,noDataValue:n,multidimensionalInfo:p}),supportedFormats:u.supportedFormats,coverageDescription:t,version:"2.0.1",useEPSGAxis:!1}})(e))}catch(e){if(!(0,l.zf)(e))throw new s.A("wcslayer:open","wcs coverage description is not valid or supported");throw e}}var j=i(22580),W=i(82245);function q(e,t){let i=String.fromCharCode.apply(null,e.subarray(0,Math.min(300,e.length))).split("\n"),n=Math.min(i.length,7),a={contentDisposition:"inline"},r=0;for(let s=0;s<n;s++)if(i[s].length<4)r=r+i[s].length+1;else if("content"===i[s].slice(0,7).toLowerCase()){r=r+i[s].length+1;let e=i[s].indexOf(":");if(-1===e)continue;let t=i[s].slice(0,e).trim(),n=i[s].slice(e+1).trim();switch(t.toLowerCase()){case"content-type":a.contentType=n;break;case"content-description":a.contentDescription=n;break;case"content-transfer-encoding":a.contentTransferEncoding=n;break;case"content-id":a.contentID=n;break;case"content-disposition":a.contentDisposition=n;break;case"content-location":a.contentLocation=n}}else{if(a.contentDisposition.toLowerCase().includes("inline")&&i[s].length>=4&&a.contentType?.toLowerCase().indexOf("image")>-1){let t=!0,i=e.subarray(r,e.length);if(a.contentType.toLowerCase().indexOf("tif")>0){if("base64"===a.contentTransferEncoding){let e="",t=i;for(let i=0;i<t.length;i+=65535){let n=t.subarray(i,i+65535>t.length-1?t.length-1:i+65535);e+=String.fromCharCode.apply(null,n)}let n=atob(e);i=new Uint8Array(n.length);for(let e=0;e<i.length;e++)i[e]=n.charCodeAt(e)}t=73===i[0]&&73===i[1]||77===i[0]&&77===i[1]}if(t){let t=i.buffer;"base64"!==a.contentTransferEncoding&&(i=new Uint8Array(t=new ArrayBuffer(e.length-r))).set(e.subarray(r,e.length)),a.contentData=t,a.isValidImage=!0}break}if((""===t.start||a.contentID===t.start)&&a.contentType){if(a.contentType.includes("text")||a.contentType.includes("xml")){a.contentData=String.fromCharCode.apply(null,e.subarray(r,e.length));break}a.contentData=e.subarray(r,e.length)}}return a}var Z=i(10303),U=i(93782);let z=["nearest neighbor","bilinear","bicubic"],H=["nearest","linear","cubic"],Y="response is not a supported multipart/related mediaType with inline tiff,  switching to compatibility mode",Q=new Set(["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"]),J=class extends W.A{constructor(){super(...arguments),this.datasetFormat="WCSServer",this.tileType="Raster"}get rasterId(){return`${this.url}-${this.coverageId}-${this.version}`}async fetchRawTile(e,t,i,n={}){let a;if(this.isBlockOutside(e,t,i))return null;let{nativePixelSize:r,spatialReference:o}=this.rasterInfo,l=2**e,u=r.x*l,p=r.y*l,{blockWidth:d,blockHeight:m}=this.getBlockWidthHeight(e),{origin:c}=this.rasterInfo.storageInfo.tileInfo,f=this.getTileExtent({x:u,y:p},t,i,c,o,[d,m]),g=this.rasterInfo.extent,h=f.xmax>g.xmax,v=f.ymin<g.ymin,y=h||v,b=f,w=d,x=m;if(y&&null!=(b=f.clone().intersection(g))&&(h&&(w=Math.floor((b.xmax-b.xmin)/u),b.xmax=b.xmin+u*w),v&&(x=Math.floor((b.ymax-b.ymin)/p),b.ymin=b.ymax-p*x)),null==b||w<=1||x<=1)return null;let C=await this._getCoverage(b,w,x,l,n);if(!C)return null;let{coverageDescription:I}=this.coverageInfo,{noDataValue:S,multidimensionalInfo:A}=this.rasterInfo,{multidimensionalDefinition:D}=n;if(null!=A&&null!=D&&D.length){let e=D[0].variableName;if("2.0"===I.version){let t=I.rangeType[0].find(t=>t.name===e);a=t?.nilValue}else if("1.1"===I.version){let t=I.range.find(t=>t.identifier===e);a=t?.nullValues}}let T=a??S,L=await this.decodePixelBlock(C,{width:w,height:x,planes:null,pixelType:null,tiffNoDataValue:Array.isArray(T)?T[0]:T,matchAllNoData:!0});if(null==L)return null;if(L&&(L.width!==w||L.height!==x))throw new s.A("wcsraster-fetch",`the response has unexpected dimension width: ${L.width}, height: {pixelBlock.height}`);return y?(0,U.$Q)(L,{x:0,y:0},{width:m,height:m}):L}async _open(e){let{customFetchParameters:t}=this.ioConfig,i=e?.signal,n=await G(this.url,{version:t?.version??this.version,customParameters:t,signal:i});if(this.capabilities=n,!this.version){let e=n.version.slice(0,3);"2.0"===e||"1.1"===e||"1.0"===e?this.version=n.version:(e=n.supportedVersions.find(e=>"2.0.1"===e)||n.supportedVersions.find(e=>"2.0"===e.slice(0,3))||n.supportedVersions.find(e=>"1.1"===e.slice(0,3))||n.supportedVersions.find(e=>"1.0"===e.slice(0,3))||"1.0.0",this.version=e)}let{version:a}=this;if(!Q.has(a))throw new s.A("wcsraster-open",`unsupported WCS version ${a}`);let{gridCoverages:r}=n;if(!r.length)throw new s.A("wcsraster-open","cannot find rectified grid coverages");this.coverageId??=r[0].id;let{coverageId:o}=this,l=r.find(e=>e.id===o);if(null==l)throw new s.A("wcsraster-open",`the coverageId ${o} does not exist in capabilities`);let u=await B(this.url,{coverageIds:[o],version:a,customParameters:t,signal:i});if(this.coverageInfo=u[0],"2.0"===a.slice(0,3)){let{coverageInfo:e}=this;e.lonLatEnvelope=l.lonLatEnvelope,e.supportedInterpolations=_(n.supportedInterpolations),this._patchDimensionValues201(o,i)}this.datasetName=this.coverageInfo.title;let{rasterInfo:p}=this.coverageInfo;if(this.createRemoteDatasetStorageInfo(p,512,512),this._set("rasterInfo",p),null==p.spatialReference)throw new s.A("wcsraster-open",`coverage without spatial reference is not supported: ${o}`);let{pixelType:d,bandCount:m}=await this._getPixelTypeAndBandCount(i);p.pixelType=d,1===p.bandCount&&m>1&&(p.bandCount=m),this.updateTileInfo()}async _patchDimensionValues201(e,t){let{coverageInfo:i}=this,n=i.rasterInfo.multidimensionalInfo?.variables,a=Q.has("1.1.2")?"1.1.2":Q.has("1.1.1")?"1.1.1":Q.has("1.1.0")?"1.1.0":null,{customFetchParameters:r}=this.ioConfig;if(n&&a)try{let i=this.url.includes("/ImageServer/"),s=e.length>8&&e.startsWith("Coverage")&&i?e.slice(8):e,o=await B(this.url,{coverageIds:[s??e],version:a,customParameters:r,signal:t}).catch(()=>{if(s)return B(this.url,{coverageIds:[e],version:a,customParameters:r,signal:t})}),l=o?.[0].rasterInfo.multidimensionalInfo?.variables;if(l)for(let e of n){let t=l.find(({name:t})=>t===e.name);if(t?.dimensions?.length)for(let n=e.dimensions.length-1;n>=0;n--){let a=e.dimensions[n],r=t.dimensions.find(({name:e})=>e===a.name);r?r.values&&r.extent?.join(",")===a.extent?.join(",")&&(e.dimensions[n]={...a,values:r.values}):i&&e.dimensions.splice(n,1)}}}catch{}}async _getPixelTypeAndBandCount(e){let t,{pixelSize:i,extent:n,multidimensionalInfo:a}=this.rasterInfo,r=n.center,o=new A.A({xmin:r.x-i.x,xmax:r.x+i.x,ymin:r.y-i.y,ymax:r.y+i.y,spatialReference:n.spatialReference}),l=[];if(null!=a){let e=a.variables[0];l=[],e.dimensions.forEach(t=>{l.push(new j.A({variableName:e.name,dimensionName:t.name,values:t.hasRegularIntervals?t.extent?.[0]:t.values?.[0],isSlice:!0}))})}let{coverageDescription:u}=this.coverageInfo,p={interpolation:"nearest",multidimensionalDefinition:l,signal:e},{version:m}=u,{ioConfig:c}=this,f="2.0"===m&&null==c.allowAnyMediaType||"1.1"===m&&null==c.use2GridOffsets;try{t=await this._getCoverage(o,2,2,1,p,!0)}catch(e){if(!f)throw e;if("1.1"===m){if(!e.details?.isResolutionMismatch)throw e;c.use2GridOffsets=!0}}if(!t&&f&&("2.0"===m&&(c.allowAnyMediaType=!0),(t=await this._getCoverage(o,2,2,1,p))&&d.A.getLogger(this).warn("wcsraster:getcoverage",Y)),!t)throw new s.A("wcsraster-open","unable to determine pixel type");let g=await this.decodePixelBlock(t,{width:2,height:2,planes:null,pixelType:null});if(null==g)throw new s.A("wcsraster-open","unable to determine pixel type");return{pixelType:g.pixelType,bandCount:g.getPlaneCount()??0}}async _getCoverage(e,t,i,n,a,r=!1){let{coverageDescription:o}=this.coverageInfo,{version:l}=o,u="2.0"===l?this._getCoverage201Parameters(e,t,i,n,a,o):"1.1"===l?this._getCoverage110Parameters(e,t,i,a,o):this._getCoverage100Parameters(e,t,i,a),p="2.0"===l?await this.request(this._constructWCS201Url(u),{signal:a.signal,responseType:"array-buffer"}):await this.request(this.url,{query:u,signal:a.signal,responseType:"array-buffer"});if("1.0"===l)return p.data;if("2.0"===l&&!1!==this.ioConfig.allowAnyMediaType&&"tiff"===(0,Z.g)(p.data))return r&&(this.ioConfig.allowAnyMediaType=!0,d.A.getLogger(this).warn("wcsraster:getcoverage",Y)),p.data;let m=function(e){let t=function(e){let t=e.getHeader?.("Content-Type")?.split(";");if(!t||!(t[0].trim()??"").startsWith("multipart/"))return null;let i={boundary:"",start:"",type:""};for(let e=1;e<t.length;e++){let n=t[e].indexOf("=");if(n>0){let a=t[e].slice(0,n).trim(),r=t[e].slice(n+1).trim();i[a]=r.startsWith('"')?r.slice(1,-1):r}}return i}(e);return t?{isMultipart:!0,data:t.boundary?function(e,t,i=0){let n="--"+t.boundary,a=[];for(let e=0;e<n.length;e++)a.push(n.charCodeAt(e));let r=[],s="\n--"+t.boundary+"--";for(let e=0;e<s.length;e++)r.push(s.charCodeAt(e));let o=[],l=a.length,u=new Uint8Array(e,i),p=u.length-l,d=0,m=0;for(let e=0;e<p;e++){for(m=0;m<l&&u[e+m]===a[m];m++);if(m!==l)continue;let i=!1;if(d){let n=q(u.subarray(d,e),t);o.push(n),i=!!n.isValidImage}if(10===u[(e+=l-1)+1]?e+=1:13===u[e+1]&&10===u[e+2]&&(e+=2),d=e+1,i)break}let c=r.length;for(let e=u.length-c-10;e<u.length-c;e++){for(m=0;m<c&&u[e+m]===r[m];m++);if(m===c){o.push(q(u.subarray(d,e),t));break}}return o}(e.data,t,0):null}:{isMultipart:!1,data:null}}(p);if(m.isMultipart&&m.data){let e=m.data.find(e=>e.isValidImage);return r&&"base64"===e?.contentTransferEncoding&&d.A.getLogger(this).warn("wcsraster:getcoverage","response is base64 encoded which may impact layer display performance"),e?.contentData}let c=new Uint8Array(p.data,0,Math.min(p.data.byteLength,2e3)),f=String.fromCharCode.apply(null,c).toLowerCase().includes("exception"),g=f&&String.fromCharCode.apply(null,c).includes("A non-zero RESX/RESY or WIDTH/HEIGHT is required but neither was provided");if(f)throw new s.A("wcsraster:getcoverage","server returns an exception",{isResolutionMismatch:g});throw new s.A("wcsraster:getcoverage","response is not a supported multipart mediaType with inline tiff")}_getInterpolationIndex(e){return e&&this.coverageInfo.supportedInterpolations?.includes(e)?"nearest"===e?0:"bilinear"===e?1:2*("cubic"===e):0}_getCoverage100Parameters(e,t,i,n){let a,r=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`,s=e.spatialReference.wkid,o=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes("tiff"))||"GEOTIFF",{bandIds:l,interpolation:u}=n,p=this._getInterpolationIndex(u),d=l?l.map(e=>this.coverageInfo.bandNames[e]):null,m=z[p],{multidimensionalDefinition:c}=n;if(null!=c&&null!=this.rasterInfo.multidimensionalInfo){let e=c.find(e=>"StdTime"===e.dimensionName),t=e?.values;t&&t.length>0&&(Array.isArray(t[0])&&(t=t[0]),a=t.map(e=>K(e)).join(","))}return{service:"WCS",request:"GetCoverage",version:this.version,coverage:this.coverageId,format:o,crs:`EPSG:${s}`,bbox:r,width:t,height:i,time:a,interpolation:m,band:d?.join(",")}}_getCoverage110Parameters(e,t,i,n,a){let{multidimensionalDefinition:r,bandIds:s,interpolation:o}=n,l=e.spatialReference.wkid,u=`urn:ogc:def:crs:EPSG::${l}`,p=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes("tiff"))||"image/tiff",d=H[this._getInterpolationIndex(o)],m=null==o||0===this.coverageInfo.supportedInterpolations?.indexOf(o),c=a.domain.spatialDomain,f=c.origin.x<=c.envelope.xmin&&c.origin.y<=c.envelope.ymin,g=e.width/t,h=e.height/i*(f?1:-1),v=f?[e.xmin,e.ymin]:[e.xmin,e.ymax],y=c.useEPSGAxis&&(0,D.m)(l),b=y?`${v[1]},${v[0]}`:`${v[0]},${v[1]}`,w=this.ioConfig.use2GridOffsets,x=y?w?`${h},${g}`:`${h},0,0,${g}`:w?`${g},${h}`:`${g},0,0,${h}`,C=g/2,I=e.xmin+C,S=e.xmax-C,A=Math.abs(h)/2,T=e.ymin+A,L=e.ymax-A,V=y?`${T},${I},${L},${S},${u}`:`${I},${T},${S},${L},${u}`,M=a.range.find(e=>e.axis.some(e=>e.identifier.toLowerCase().includes("band"))),N,R=M&&d&&s?m?`${M.identifier}[${M.axis[0].identifier}[${s.join(",")}]]`:`${M.identifier}:${d}[${M.axis[0].identifier}[${s.join(",")}]]`:null;if(null!=r&&r.length)for(let e=0;e<r.length;e++){let t=r[e].values,i=r[e].dimensionName?.toLowerCase(),n=r[e].variableName?.toLowerCase(),s=a.range.find(e=>e.identifier.toLowerCase()===n);if(t.length>0){if(Array.isArray(t[0])&&(t=t[0]),"stdtime"===i)N=t.map(e=>K(e)).join(",");else if(s){let e=s.axis.find(e=>e.identifier.toLowerCase()===i);e&&(R=m?s.identifier+"["+e.identifier+"["+t.join(",")+"]]":s.identifier+":"+d+"["+e.identifier+"["+t.join(",")+"]]")}}e===r.length-1&&s&&!R&&(R=m?s.identifier:s.identifier+":"+d)}return{service:"WCS",request:"GetCoverage",version:this.version,identifier:this.coverageId,format:p,crs:`EPSG:${l}`,boundingbox:V,gridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",gridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",gridOrigin:b,gridOffsets:x,gridBaseCRS:u,timeSequence:N,rangeSubset:R}}_getCoverage201Parameters(e,t,i,n,a,r){let{multidimensionalDefinition:s,interpolation:o}=a,l=this._getInterpolationIndex(o),u=null,{supportedInterpolations:p}=this.capabilities;if(p?.length)switch(l){case 0:u=p.find(e=>e.toLowerCase().includes("nearest"));break;case 1:u=p.find(e=>e.toLowerCase().includes("linear"));break;case 2:u=p.find(e=>e.toLowerCase().includes("cubic")||e.toLowerCase().includes("quadratic"))}let d=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes("tiff"))||"image/tiff",{bandNames:m}=this.coverageInfo,{boundedBy:c,domainSet:f,rangeType:g}=r,h=+!c.isEastFirst,{axisLabels:v}=c,y=v[h],b=v[1-h],w=`http://www.opengis.net/def/crs/EPSG/0/${e.spatialReference.wkid}`,x=[];x.push(`${y}(${e.xmin},${e.xmax})`),x.push(`${b}(${e.ymin},${e.ymax})`);let C=[];if(v.length>2)for(let e=2;e<v.length;e++){let t=f.origin[e];if(v[e].toLowerCase().includes("time")){let i=t.toString();c.uomLabels?.[e].toLowerCase().includes("ole")&&(C.push(v[e]),i=K(t,!0)),x.push(v[e]+",http://www.opengis.net("+i+")")}else x.push(v[e]+",http://www.opengis.net("+t+")")}let I=null;if(null!=s&&s.length){let e=[];g.forEach(t=>t.forEach(t=>e.push(t.name)));let t=[];for(let i=0;i<s.length;i++){let n=v.find(e=>e===s[i].dimensionName),a=e.find(e=>e===s[i].variableName);if(t.includes(a)||t.push(a),n){let e=s[i].values;if(e.length>0){Array.isArray(e[0])&&(e=e[0]);let t="";t=n.toLowerCase().includes("time")?e.map(e=>K(e)).join(","):e.join(",");let i=x.findIndex(e=>0===e.indexOf(n+",http://www.opengis.net"));-1===i&&x.push(n+",http://www.opengis.net("+t+")"),-1===i||x[i].includes("("+t+")")||x.splice(i,1,n+",http://www.opengis.net("+t+")")}}}t.length&&(I=t.join(","))}else m?.length>=2&&(I=(a.bandIds?a.bandIds.map(e=>m[e]):m).join(","));let S=x.join("&subset="),A=!r.domainSet.hasSameAxisLabelsAsBoundedBy&&!1!==this.ioConfig.allowScaleFactor,D=A?null:`${y}(${t}),${b}(${i})`;return{service:"WCS",request:"GetCoverage",version:this.version,coverageId:this.coverageId,rangesubset:I,interpolation:u,scaleSize:D,scaleFactor:A?1/n:null,subset:S,format:d,mediaType:this.ioConfig.allowAnyMediaType?null:"multipart/related",outputcrs:w,subsettingcrs:w}}_constructWCS201Url(e){let t={...this.ioConfig.customFetchParameters,...e},i=[];return Object.keys(t).forEach(e=>{let n=t[e];null!=n&&("subset"===e?"string"==typeof n&&n.split("&subset=").forEach(e=>{e&&i.push(`subset=${encodeURIComponent(e)}`)}):i.push(`${e}=${encodeURIComponent(n)}`))}),`${encodeURI(this.url)}?${i.join("&")}`}};function K(e,t=!1){return new Date(t?(0,E.$E)(e):e).toISOString()}(0,n._)([(0,p.MZ)({type:String,json:{write:!0}})],J.prototype,"datasetFormat",void 0),(0,n._)([(0,p.MZ)({readOnly:!0})],J.prototype,"tileType",void 0),(0,n._)([(0,p.MZ)({type:String,json:{write:!0}})],J.prototype,"version",void 0),(0,n._)([(0,p.MZ)({type:String,json:{write:!0}})],J.prototype,"coverageId",void 0),(0,n._)([(0,p.MZ)({readOnly:!0})],J.prototype,"rasterId",null);let ee=J=(0,n._)([(0,m.$)("esri.layers.support.rasterDatasets.WCSRaster")],J);var et=i(52438),ei=i(84090);let en=new Set(["milliseconds","seconds","minutes","hours","days","weeks","months","years","decades","centuries"]),ea=class extends(0,f.dM)((0,w.j)((0,v.q)((0,y.A)((0,g.d)((0,h.o)((0,x.e)((0,b.J)((0,o.P)(r.A.ClonableMixin(c.A)))))))))){constructor(...e){super(...e),this.coverageId=null,this.version=null,this.isReference=null,this.legendEnabled=!0,this.noData=0,this.operationalLayerType="WCS",this.type="wcs",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null,this._debouncedSaveOperations=(0,l.sg)(async(e,t,n)=>{let{save:a,saveAs:r}=await i.e(4611).then(i.bind(i,64611));switch(e){case ei.X.SAVE:return a(this,t);case ei.X.SAVE_AS:return r(this,n,t)}})}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){let t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WCS"]},e).catch(l.QP).then(()=>this._openRaster(t))),Promise.resolve(this)}get coverageInfo(){return this.raster.coverageInfo}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){return[(0,S.rZ)("Pixel Value")]}createPopupTemplate(e){return(0,et.tn)({fields:this.rasterFields,title:this.title},e)}async save(e){return this._debouncedSaveOperations(ei.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(ei.X.SAVE_AS,t,e)}async _openRaster(e){let t=new ee({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters}});if(await t.open({signal:e}),!t.rasterInfo)throw t.destroy(),new s.A("wcs-layer:load","cannot load resources on "+this.url);let{rasterInfo:i}=t;null==i.noDataValue&&(i.noDataValue=this.noData),this._set("serviceRasterInfo",i),this._set("spatialReference",i.spatialReference),null==this.title&&this.setAtOrigin("title",t.datasetName,"service"),null==this.coverageId&&this.setAtOrigin("coverageId",t.coverageInfo.id,"service"),null==this.version&&t.version&&this.setAtOrigin("version",t.version,"service"),this.setAtOrigin("tileInfo",t.rasterInfo.storageInfo.tileInfo,"service");let{multidimensionalInfo:n}=i;if(null!=n){let e=n.variables[0].dimensions.find(({name:e})=>"StdTime"===e);if(e){let t=e.extent?.[0]??e.values[0];Array.isArray(t)&&(t=t[0]);let i=e.extent?.[1]??e.values[e.values.length-1];Array.isArray(i)&&(i=i[1]);let n=en.has(e.intervalUnit?.toLowerCase())?e.intervalUnit?.toLowerCase():null;this.set("timeInfo",{startField:"StdTime",fullTimeExtent:{start:t,end:i},timeZone:null,interval:n?{value:e.interval,unit:n}:null})}}this.raster=t,this._configDefaultSettings(),this.addHandles((0,u.wB)(()=>this.customParameters,e=>this.raster.ioConfig.customFetchParameters=e))}};(0,n._)([(0,p.MZ)({type:String,nonNullable:!0,json:{name:"wcsInfo.coverageId",write:{isRequired:!0,ignoreOrigin:!0}}})],ea.prototype,"coverageId",void 0),(0,n._)([(0,p.MZ)()],ea.prototype,"coverageInfo",null),(0,n._)([(0,p.MZ)({type:["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"],nonNullable:!0,json:{name:"wcsInfo.version",write:{isRequired:!0,ignoreOrigin:!0}}})],ea.prototype,"version",void 0),(0,n._)([(0,p.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],ea.prototype,"isReference",void 0),(0,n._)([(0,p.MZ)({json:{read:!0,write:!0}})],ea.prototype,"blendMode",void 0),(0,n._)([(0,p.MZ)(C.fV)],ea.prototype,"legendEnabled",void 0),(0,n._)([(0,p.MZ)({type:["show","hide"]})],ea.prototype,"listMode",void 0),(0,n._)([(0,p.MZ)()],ea.prototype,"noData",void 0),(0,n._)([(0,p.MZ)({type:["WCS"]})],ea.prototype,"operationalLayerType",void 0),(0,n._)([(0,p.MZ)()],ea.prototype,"raster",void 0),(0,n._)([(0,p.MZ)({readOnly:!0})],ea.prototype,"type",void 0),(0,n._)([(0,p.MZ)(C.M6)],ea.prototype,"popupEnabled",void 0),(0,n._)([(0,p.MZ)({type:a.A,json:{name:"popupInfo",write:!0}})],ea.prototype,"popupTemplate",void 0),(0,n._)([(0,p.MZ)({readOnly:!0})],ea.prototype,"defaultPopupTemplate",null),(0,n._)([(0,p.MZ)({readOnly:!0,type:[I.A]})],ea.prototype,"fields",void 0),(0,n._)([(0,p.MZ)({readOnly:!0,type:[I.A]})],ea.prototype,"rasterFields",null);let er=ea=(0,n._)([(0,m.$)("esri.layers.WCSLayer")],ea)}}]);