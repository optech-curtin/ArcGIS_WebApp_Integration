"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6098],{2609:(t,e,l)=>{l.d(e,{$Q:()=>g,FI:()=>d,KL:()=>h,Lu:()=>u,MD:()=>o,Rn:()=>m,Ud:()=>U,Wu:()=>T,Y2:()=>c,gf:()=>P});var i=l(30781),n=l(93409),r=l(93782);let a=new Map;a.set("meter-per-second",1),a.set("kilometer-per-hour",.277778),a.set("knots",.514444),a.set("feet-per-second",.3048),a.set("mile-per-hour",.44704);let s=180/Math.PI,o=new i.J({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function h(t,e){return a.get(t)/a.get(e)||1}function f(t){return(450-t)%360}function u(t,e="geographic"){let[l,i]=t,n=Math.sqrt(l*l+i*i),r=Math.atan2(i,l)*s;return r=(360+r)%360,"geographic"===e&&(r=f(r)),[n,r]}function p(t,e="geographic"){let l=t[1];"geographic"===e&&(l=f(l)),l%=360;let i=t[0];return[i*Math.cos(l/s),i*Math.sin(l/s)]}function c(t,e,l,i="geographic"){if(!(0,r.AB)(t)||null==l)return t;let n="vector-magdir"===e?t.clone():d(t,e),a=n.pixels[1];for(let t=0;t<a.length;t++)a[t]="geographic"===i?(a[t]+l[t]+270)%360:(a[t]+360-l[t])%360;return"vector-magdir"===e?n:d(n,"vector-magdir")}function d(t,e,l="geographic",i=1){if(!(0,r.AB)(t))return t;let{pixels:a,width:s,height:o}=t,h=s*o,f=a[0],c=a[1],m=t.pixelType.startsWith("f")?t.pixelType:"f32",g=n.A.createEmptyBand(m,h),x=n.A.createEmptyBand(m,h),w=0;for(let t=0;t<o;t++)for(let t=0;t<s;t++)"vector-uv"===e?([g[w],x[w]]=u([f[w],c[w]],l),g[w]*=i):([g[w],x[w]]=p([f[w],c[w]],l),g[w]*=i,x[w]*=i),w++;let y=new n.A({pixelType:m,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[g,x]});return y.updateStatistics(),y}function m(t,e,l=1){if(1===l||!(0,r.AB)(t))return t;let i=t.clone(),{pixels:n,width:a,height:s}=i,o=n[0],h=n[1],f=0;for(let t=0;t<s;t++)for(let t=0;t<a;t++)"vector-uv"===e?(o[f]*=l,h[f]*=l):o[f]*=l,f++;return i.updateStatistics(),i}function g(t,e,l,i,n){if(null==n||!n.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(e/i),height:Math.round(l/i),resolution:t.width/e};let r=n.xmin,a=n.ymax,s=(t.xmax-t.xmin)/e*i,o=(t.ymax-t.ymin)/l*i;return t.xmin=r+Math.floor((t.xmin-r)/s)*s,t.xmax=r+Math.ceil((t.xmax-r)/s)*s,t.ymin=a+Math.floor((t.ymin-a)/o)*o,t.ymax=a+Math.ceil((t.ymax-a)/o)*o,{extent:t,width:Math.round(t.width/s),height:Math.round(t.height/o),resolution:(s+o)/2}}let x=w(0,0,0);function w(t=0,e=0,l=Math.PI,i=!0){i&&(l=(2*Math.PI-l)%(2*Math.PI));let n=i?-1:1,r=-7*n,a=-2*n,s=-16*n,[o,h]=y(0,e+13*n,l,21.75),[f,u]=y(t-5.5,e+r,l,21.75),[p,c]=y(t+5.5,e+r,l,21.75),[d,m]=y(t-1.5,e+a,l,21.75),[g,x]=y(t+1.5,e+a,l,21.75),[A,M]=y(t-1.5,e+s,l,21.75),[k,b]=y(t+1.5,e+s,l,21.75);return[o,h,f,u,d,m,g,x,p,c,A,M,k,b]}function y(t,e,l,i=1){return[Math.sqrt(t*t+e*e)/i,(2*Math.PI+(2*Math.PI+Math.atan2(e,t))%(2*Math.PI)-l)%(2*Math.PI)]}let A=[0,1,3,6,10,16,21,27,33,40,47,55,63],M=[0,.5,1,1.5,2],k=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function b(t,e,l,i){let n,r=h(i||"knots",l);for(n=1;n<e.length;n++)if(n===e.length-1){if(t<e[n]*r)break}else if(t<=e[n]*r)break;return Math.min(n-1,e.length-2)}let v=[];function U(t,e){let l=0,i=0,{width:n,height:r,mask:a}=t,s=t.pixels[0],f=[],u=[],p=h(o.fromJSON(e.inputUnit),"knots"),c="wind_speed"===e.style?5:Number.MAX_VALUE;for(let t=0;t<r;t++)for(let e=0;e<n;e++){let o=s[t*n+e]*p;if((!a||a[t*n+e])&&o<c){for(let i=0;i<4;i++)f[l++]=(e+.5)/n,f[l++]=(t+.5)/r,f[l++]=i<2?-.5:.5,f[l++]=i%2==0?-.5:.5,f[l++]=0,f[l++]=o;let a=4*(l/24-1);u[i++]=a,u[i++]=a+1,u[i++]=a+2,u[i++]=a+1,u[i++]=a+2,u[i++]=a+3}}return{vertexData:new Float32Array(f),indexData:new Uint32Array(u)}}function P(t,e){return"simple_scalar"===e.style?U(t,e):"wind_speed"===e.style?function(t,e){if(0===v.length)for(let t=0;t<30;t++)v.push(function(t=0,e=Math.PI,l=!0){l&&(e=(2*Math.PI-e)%(2*Math.PI));let i=l?-1:1,n=5*i,r=20*i,a=25*i,s=2*i,o=l?1:-1,h=5*o,[f,u]=[0+h,0-r],[p,c]=[f+2*o,u],[d,m]=[p-0*o,c+s],[g,x]=[0-h,0-a],[w,A]=[g+0*o,x-s],M=Math.ceil(t/5),k=Math.floor(M/10);M-=8*k;let b=[],v=[];for(let t=0;t<M/2;t++,k--){k<=0&&M%2==1&&t===(M-1)/2&&(w=(g=0)+0*o,A=(x=(x+u)/2)-s);let[l,i]=y(g,x,e,45);if(k>0){let[t,n]=y(p,x,e,45),[r,a]=y(f,u,e,45);b.push(t),b.push(n),b.push(l),b.push(i),b.push(r),b.push(a)}else{let[t,n]=y(p,c,e,45),[r,a]=y(d,m,e,45),[s,o]=y(w,A,e,45);v.push(l),v.push(i),v.push(s),v.push(o),v.push(r),v.push(a),v.push(t),v.push(n)}x+=n,u+=n,c+=n,m+=n,A+=n}let[U,P]=y(0+h,0+r,e,45),T=7*o,[I,B]=y(0+T,0+r,e,45),[_,S]=y(0+h,0-a,e,45),[F,C]=y(0+T,0-a,e,45);return{pennants:b,barbs:v,shaft:[U,P,I,B,_,S,F,C]}}(5*t,0,!e.invertDirection));let l=h(o.fromJSON(e.inputUnit),"knots"),{width:i,height:n,mask:r}=t,a=t.pixels[0],s=t.pixels[1],f=[],u=[],p=0,c=0;for(let t=0;t<n;t++)for(let e=0;e<i;e++){let o=t*i+e,h=a[o]*l;if((!r||r[t*i+e])&&h>=5){let l=(s[o]+360)%360/180*Math.PI,{pennants:r,barbs:a,shaft:d}=v[Math.min(Math.floor(h/5),29)];if(r.length+a.length===0)continue;let m=f.length/6,g=(e+.5)/i,x=(t+.5)/n;for(let t=0;t<r.length;t+=2)f[p++]=g,f[p++]=x,f[p++]=r[t],f[p++]=r[t+1]+l,f[p++]=0,f[p++]=h;for(let t=0;t<a.length;t+=2)f[p++]=g,f[p++]=x,f[p++]=a[t],f[p++]=a[t+1]+l,f[p++]=0,f[p++]=h;for(let t=0;t<d.length;t+=2)f[p++]=g,f[p++]=x,f[p++]=d[t],f[p++]=d[t+1]+l,f[p++]=0,f[p++]=h;for(let t=0;t<r.length/6;t++)u[c++]=m,u[c++]=m+1,u[c++]=m+2,m+=3;for(let t=0;t<a.length/8;t++)u[c++]=m,u[c++]=m+1,u[c++]=m+2,u[c++]=m+1,u[c++]=m+2,u[c++]=m+3,m+=4;u[c++]=m+0,u[c++]=m+1,u[c++]=m+2,u[c++]=m+1,u[c++]=m+3,u[c++]=m+2,m+=4}}return{vertexData:new Float32Array(f),indexData:new Uint32Array(u)}}(t,e):function(t,e){let{style:l,inputUnit:i,outputUnit:n,breakValues:r}=e,a=o.fromJSON(i),s=o.fromJSON(n),h=0,f=0,{width:u,height:p,mask:c}=t,d=t.pixels[0],m=t.pixels[1],g=null!=c?c.filter(t=>t>0).length:u*p,y=new Float32Array(42*g),v=new Uint32Array(15*g),U=e.invertDirection?w(0,0,0,!1):x;for(let t=0;t<p;t++)for(let e=0;e<u;e++){let i=t*u+e;if(!c||c[t*u+e]){let n=(m[i]+360)%360/180*Math.PI,o=function(t,e,l,i,n){let r=0;switch(e){case"beaufort_kn":r=b(t,A,"knots",l);break;case"beaufort_km":r=b(t,A,"kilometer-per-hour",l);break;case"beaufort_ft":r=b(t,A,"feet-per-second",l);break;case"beaufort_m":r=b(t,A,"meter-per-second",l);break;case"classified_arrow":r=b(t,n??[],i,l);break;case"ocean_current_m":r=b(t,M,"meter-per-second",l);break;case"ocean_current_kn":r=b(t,k,"knots",l)}return r}(d[i],l,a,s,r);for(let l=0;l<U.length;l+=2)y[h++]=(e+.5)/u,y[h++]=(t+.5)/p,y[h++]=U[l],y[h++]=U[l+1]+n,y[h++]=o,y[h++]=d[i];let c=7*(h/42-1);v[f++]=c,v[f++]=c+1,v[f++]=c+2,v[f++]=c+0,v[f++]=c+4,v[f++]=c+3,v[f++]=c+0,v[f++]=c+2,v[f++]=c+3,v[f++]=c+2,v[f++]=c+5,v[f++]=c+3,v[f++]=c+5,v[f++]=c+6,v[f++]=c+3}}return{vertexData:y,indexData:v}}(t,e)}function T(t,e,l,i=[0,0],r=.5){let{width:a,height:s,mask:o}=t,[h,f]=t.pixels,[c,d]=i,m=Math.round((a-c)/l),g=Math.round((s-d)/l),x=m*g,w=new Float32Array(x),y=new Float32Array(x),A=new Uint8Array(x),M="vector-uv"===e;for(let t=0;t<g;t++)for(let e=0;e<m;e++){let i=0,n=t*m+e,g=Math.max(0,t*l+d),x=Math.max(0,e*l+c),k=Math.min(s,g+l),b=Math.min(a,x+l);for(let t=g;t<k;t++)for(let e=x;e<b;e++){let l=t*a+e;if(!o||o[l]){i++;let t=M?[h[l],f[l]]:[h[l],(360+f[l])%360],[e,r]=M?t:p(t);w[n]+=e,y[n]+=r}}if(i>=(k-g)*(b-x)*(1-r)){A[n]=1;let[t,e]=u([w[n]/i,y[n]/i]);w[n]=t,y[n]=e}else A[n]=0,w[n]=0,y[n]=0}let k=new n.A({width:m,height:g,pixels:[w,y],mask:A});return k.updateStatistics(),k}},37810:(t,e,l)=>{l.d(e,{CW:()=>u,pH:()=>c});var i=l(57845),n=l(61939),r=l(20538),a=l(92753),s=l(33638),o=l(61414),h=l(71760);let f=()=>n.A.getLogger("esri.views.2d.engine.flow.dataUtils");async function u(t,e,l,n){let r=performance.now(),o=function(t,e){let l=function(t,e,l,i){if(0===i)return t;let n=Math.round(3*i),r=Array(2*n+1),a=0;for(let t=-n;t<=n;t++){let e=Math.exp(-t*t/(i*i));r[t+n]=e,a+=e}for(let t=-n;t<=n;t++)r[t+n]/=a;let s=new Float32Array(t.length);for(let i=0;i<l;i++)for(let l=0;l<e;l++){let a=0,o=0;for(let s=-n;s<=n;s++){if(l+s<0||l+s>=e)continue;let h=r[s+n];a+=h*t[2*(i*e+(l+s))],o+=h*t[2*(i*e+(l+s))+1]}s[2*(i*e+l)]=a,s[2*(i*e+l)+1]=o}let o=new Float32Array(t.length);for(let t=0;t<e;t++)for(let i=0;i<l;i++){let a=0,h=0;for(let o=-n;o<=n;o++){if(i+o<0||i+o>=l)continue;let f=r[o+n];a+=f*s[2*((i+o)*e+t)],h+=f*s[2*((i+o)*e+t)+1]}o[2*(i*e+t)]=a,o[2*(i*e+t)+1]=h}return o}(e.data,e.width,e.height,t.smoothing);return t.interpolate?(t,i)=>{let n=Math.floor(t),r=Math.floor(i);if(n<0||n>=e.width||r<0||r>=e.height)return[0,0];let a=t-n,s=i-r,o=n<e.width-1?n+1:n,h=r<e.height-1?r+1:r,f=l[2*(r*e.width+n)],u=l[2*(r*e.width+o)],p=l[2*(h*e.width+n)],c=l[2*(h*e.width+o)],d=l[2*(r*e.width+n)+1],m=l[2*(r*e.width+o)+1];return[(f*(1-s)+p*s)*(1-a)+(u*(1-s)+c*s)*a,(d*(1-s)+l[2*(h*e.width+n)+1]*s)*(1-a)+(m*(1-s)+l[2*(h*e.width+o)+1]*s)*a]}:(t,i)=>{let n=Math.round(t),r=Math.round(i);return n<0||n>=e.width||r<0||r>=e.height?[0,0]:[l[2*(r*e.width+n)],l[2*(r*e.width+n)+1]]}}(e,l),h=performance.now(),u=function(t,e,l,i){let n=[],r=new s.A,a=1/Math.max(t.lineCollisionWidth,1),o=Math.round(l*a),h=Math.round(i*a),f=new Int32Array(o*h);for(let t=0;t<f.length;t++)f[t]=-1;let u=[];for(let e=0;e<i;e+=t.lineSpacing)for(let i=0;i<l;i+=t.lineSpacing)u.push({x:i,y:e,sort:r.getFloat()});for(let{x:l,y:i}of(u.sort((t,e)=>t.sort-e.sort),u))if(r.getFloat()<t.density){let r=function(t,e,l,i,n,r,a,s,o){let h,f,u=[],p=l,c=i,d=0,[m,g]=e(p,c),x=Math.sqrt((m*=t.velocityScale)*m+(g*=t.velocityScale)*g);u.push({x:p,y:c,t:d,speed:x});for(let l=0;l<t.verticesPerLine;l++){let[l,i]=e(p,c),m=Math.sqrt((l*=t.velocityScale)*l+(i*=t.velocityScale)*i);if(m<t.minSpeedThreshold)break;let g=l/m,x=i/m;if(p+=g*t.segmentLength,c+=x*t.segmentLength,d+=t.segmentLength/m,Math.acos(g*h+x*f)>t.maxTurnAngle)break;if(t.collisions){let t=Math.round(p*o),e=Math.round(c*o);if(t<0||t>a-1||e<0||e>s-1)return u;let l=r[e*a+t];if(-1!==l&&l!==n)return u;r[e*a+t]=n}u.push({x:p,y:c,t:d,speed:m}),h=g,f=x}return u}(t,e,l,i,n.length,f,o,h,a);if(r.length<2)continue;n.push(r)}return n}(e,o,l.width,l.height),p=performance.now(),c=function(t,e){let l=new s.A,i=new Float32Array(4*t.reduce((t,e)=>t+e.length,0)),n=Array(t.length),r=0,a=0;for(let s of t){let t=r;for(let t of s)i[4*r]=t.x,i[4*r+1]=t.y,i[4*r+2]=t.t,i[4*r+3]=t.speed,r++;n[a++]={startVertex:t,numberOfVertices:s.length,totalTime:s[s.length-1].t,timeSeed:e?l.getFloat():0}}return{lineVertices:i,lineDescriptors:n}}(u,!0),d=performance.now(),m="Streamlines"===t?function(t,e){let{lineVertices:l,lineDescriptors:i}=t,n=0,r=0;for(let t of i)n+=2*t.numberOfVertices,r+=6*(t.numberOfVertices-1);let a=new Float32Array(9*n),s=new Uint32Array(r),o=0,h=0;function f(t,e,l,i,n,r,s,h){let f=9*o,u=0;a[f+u++]=t,a[f+u++]=e,a[f+u++]=1,a[f+u++]=l,a[f+u++]=r,a[f+u++]=s,a[f+u++]=i/2,a[f+u++]=n/2,a[f+u++]=h,o++,a[f+u++]=t,a[f+u++]=e,a[f+u++]=-1,a[f+u++]=l,a[f+u++]=r,a[f+u++]=s,a[f+u++]=-i/2,a[f+u++]=-n/2,a[f+u++]=h,o++}for(let t of i){let{totalTime:e,timeSeed:i}=t,n=null,r=null,a=null,u=null,p=null,c=null;for(let d=0;d<t.numberOfVertices;d++){let m=l[4*(t.startVertex+d)],g=l[4*(t.startVertex+d)+1],x=l[4*(t.startVertex+d)+2],w=l[4*(t.startVertex+d)+3],y=null,A=null,M=null,k=null;if(d>0){let t=Math.sqrt((y=m-n)*y+(A=g-r)*A);if(y/=t,A/=t,d>1){let t=y+p,e=A+c,l=Math.sqrt(t*t+e*e),i=Math.min(1/((t/=l)*y+(e/=l)*A),10);t*=i,e*=i,M=-e,k=t}else M=-A,k=y;null!==M&&null!==k&&(f(n,r,a,M,k,e,i,w),s[h++]=o-2,s[h++]=o,s[h++]=o-1,s[h++]=o,s[h++]=o+1,s[h++]=o-1)}n=m,r=g,a=x,p=y,c=A,u=w}f(n,r,a,-c,p,e,i,u)}return{vertexData:a,indexData:s}}(c,10):function(t){let{lineVertices:e,lineDescriptors:l}=t,i=0,n=0;for(let t of l){let e=t.numberOfVertices-1;i+=4*e*2,n+=6*e*2}let r=new Float32Array(16*i),a=new Uint32Array(n),s,o,h,f,u,p,c,d,m,g,x,w,y,A,M=0,k=0;function b(t,e){let l=m+x,i=g+w,n=Math.sqrt(l*l+i*i);l/=n,i/=n;let b=m*l+g*i;l/=b,i/=b;let v=x+y,U=w+A,P=Math.sqrt(v*v+U*U);v/=P,U/=P;let T=x*v+w*U;v/=T,U/=T,function(t,e,l,i,n,a,s,o,h,f,u,p,c,d){let m=16*M,g=0;for(let x of[1,2])for(let w of[1,2,3,4])r[m+g++]=t,r[m+g++]=e,r[m+g++]=l,r[m+g++]=i,r[m+g++]=s,r[m+g++]=o,r[m+g++]=h,r[m+g++]=f,r[m+g++]=x,r[m+g++]=w,r[m+g++]=c,r[m+g++]=d,r[m+g++]=n/2,r[m+g++]=a/2,r[m+g++]=u/2,r[m+g++]=p/2,M++}(s,o,h,f,-i,l,u,p,c,d,-U,v,t,e),a[k++]=M-8,a[k++]=M-7,a[k++]=M-6,a[k++]=M-7,a[k++]=M-5,a[k++]=M-6,a[k++]=M-4,a[k++]=M-3,a[k++]=M-2,a[k++]=M-3,a[k++]=M-1,a[k++]=M-2}for(let t of l){s=null,o=null,h=null,f=null,u=null,p=null,c=null,d=null,m=null,g=null,x=null,w=null,y=null,A=null;let{totalTime:l,timeSeed:i}=t;for(let n=0;n<t.numberOfVertices;n++)!function(t,e,l,i,n,r){if(m=x,g=w,x=y,w=A,null==m&&null==g&&(m=x,g=w),null!=u&&null!=p){let l=Math.sqrt((y=t-u)*y+(A=e-p)*A);y/=l,A/=l}null!=m&&null!=g&&b(n,r),s=u,o=p,h=c,f=d,u=t,p=e,c=l,d=i}(e[4*(t.startVertex+n)],e[4*(t.startVertex+n)+1],e[4*(t.startVertex+n)+2],e[4*(t.startVertex+n)+3],l,i);m=x,g=w,x=y,w=A,null==m&&null==g&&(m=x,g=w),null!=m&&null!=g&&b(l,i)}return{vertexData:r,indexData:a}}(c),g=performance.now();return(0,i.A)("esri-2d-profiler")&&(f().info("I.1","_createFlowFieldFromData (ms)",Math.round(h-r)),f().info("I.2","_getStreamlines (ms)",Math.round(p-h)),f().info("I.3","createAnimatedLinesData (ms)",Math.round(d-p)),f().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(g-d)),f().info("I.5","createFlowMesh (ms)",Math.round(g-r)),f().info("I.6","Mesh size (bytes)",m.vertexData.buffer.byteLength+m.indexData.buffer.byteLength)),await Promise.resolve(),(0,a.Te)(n),m}function p(t,e){let l=e.pixels,{width:i,height:n}=e,a=new Float32Array(i*n*2),s=e.mask||new Uint8Array(i*n*2);if(e.mask||s.fill(255),"vector-uv"===t)for(let t=0;t<i*n;t++)a[2*t]=l[0][t],a[2*t+1]=-l[1][t];else if("vector-magdir"===t)for(let t=0;t<i*n;t++){let e=l[0][t],i=(0,r.kU)(l[1][t]),n=Math.cos(i-Math.PI/2),s=Math.sin(i-Math.PI/2);a[2*t]=n*e,a[2*t+1]=s*e}return{data:a,mask:s,width:i,height:n}}async function c(t,e,l,n,r,a){let s=performance.now(),u=(0,h.Vp)(e.spatialReference);if(!u){let o=await d(t,e,l,n,r,a);return(0,i.A)("esri-2d-profiler")&&f().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-s)),(0,i.A)("esri-2d-profiler")&&f().info("I.9","Number of parts",1),o}let[p,c]=u.valid,m=Math.ceil(e.width/(c-p)),g=e.width/m,x=Math.round(l/m),w=e.xmin,y=[],A=performance.now();for(let l=0;l<m;l++){let l=new o.A({xmin:w,xmax:w+g,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});y.push(d(t,l,x,n,r,a)),w+=g}let M=await Promise.all(y);(0,i.A)("esri-2d-profiler")&&f().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-A)),(0,i.A)("esri-2d-profiler")&&f().info("I.9","Number of parts",M.length);let k={data:new Float32Array(l*n*2),mask:new Uint8Array(l*n),width:l,height:n},b=0;for(let t of M){for(let e=0;e<t.height;e++)for(let i=0;i<t.width;i++)b+i>=l||(k.data[2*(e*l+b+i)]=t.data[2*(e*t.width+i)],k.data[2*(e*l+b+i)+1]=t.data[2*(e*t.width+i)+1],k.mask[e*l+b+i]=t.mask[e*t.width+i]);b+=t.width}return(0,i.A)("esri-2d-profiler")&&f().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-s)),k}async function d(t,e,l,i,n,r){let a={requestProjectedLocalDirections:!0,signal:r};if(null!=n&&(a.timeExtent=n),"imagery"===t.type){await t.load({signal:r});let n=t.rasterInfo.dataType,s=await t.fetchImage(e,l,i,a);return null==s?.pixelData?.pixelBlock?{data:new Float32Array(l*i*2),mask:new Uint8Array(l*i),width:l,height:i}:p(n,s.pixelData.pixelBlock)}await t.load({signal:r});let s=t.serviceRasterInfo.dataType,o=await t.fetchPixels(e,l,i,a);return null==o?.pixelBlock?{data:new Float32Array(l*i*2),mask:new Uint8Array(l*i),width:l,height:i}:p(s,o.pixelBlock)}},50518:(t,e,l)=>{l.d(e,{$p:()=>o,Sp:()=>h,X1:()=>r,hP:()=>n,yM:()=>s,zw:()=>a});let i={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,0xffffffff],s32:[-0x80000000,0x7fffffff],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function n(t){return i[t]??[-34028234663852886e22,34028234663852886e22]}function r(t,e){return null==t||null==e?"s32":t<0?t>=-128&&e<128?"s8":t>=-32768&&e<32768?"s16":"s32":e<256?"u8":e<65536?"u16":"u32"}function a(t){return(t?.startsWith("s")||t?.startsWith("u"))??!1}function s(t,e,l,i){let[r,s]=n(l),o=a(l);return o&&(r-=1e-5,s+=1e-5),o?l.startsWith("u")?function(t,e,l,i){let[n,r]=i;for(let i=0;i<e.length;i++)if(e[i]){let a=t[i];a<n||a>r?e[i]=0:l[i]=a+.5|0}}(t,e,i,[r,s]):function(t,e,l,i){let[n,r]=i;for(let i=0;i<e.length;i++)if(e[i]){let a=t[i];a<n||a>r?e[i]=0:l[i]=a+(a>0?.5:-.5)|0}}(t,e,i,[r,s]):function(t,e,l,i){let[n,r]=i;for(let i=0;i<e.length;i++)if(e[i]){let a=t[i];a<n||a>r?e[i]=0:l[i]=a}}(t,e,i,[r,s])}function o(t,e){for(let l=0;l<e.length;l++)e[l]&&isNaN(t[l])&&(e[l]=0,t[l]=0)}function h(t,e,l){if(t.depthCount&&t.depthCount>1)return;let{pixels:i,statistics:r,pixelType:a}=t,s=i[0].length,o=t.bandMasks??[],h=t.mask??new Uint8Array(s).fill(255),f="f32"===a||"f64"===a,u=n(a),p=!1;for(let t=0;t<i.length;t++){let n="number"==typeof e?e:e[t];if(null==n)continue;let s=r?.[t]?.minValue??u[0],c=r?.[t]?.maxValue??u[1];if(s>n+Number.EPSILON||c<n-Number.EPSILON)continue;let d=o[t]||h.slice(),m=i[t],g=l?.customFloatTolerance;if(f&&0!==g){let t=g;t||(t=Math.abs(n)>=9999999e31?2e-7*Math.abs(n):"f32"===a?11920928955078125e-23:Number.EPSILON);for(let e=0;e<m.length;e++)d[e]&&Math.abs(m[e]-n)<t&&(m[e]=0,d[e]=0,h[e]=0,p=!0)}else for(let t=0;t<m.length;t++)d[t]&&m[t]===n&&(m[t]=0,d[t]=0,h[t]=0,p=!0);o[t]=d}if(p){let e=t.bandMasks||t.pixels.length>1?o:null;l?.matchAllNoData?t.mask=e&&e.length>1?function(t){if(t.length<2)return t[0];let e=t[0].length,l=new Uint8Array(e).fill(0);for(let i=0;i<t.length;i++){let n=t[i];for(let t=0;t<e;t++)n[t]&&(l[t]=255)}return l}(e):h:(t.bandMasks=e,t.mask=h)}p&&"updateStatistics"in t&&t.updateStatistics()}},84298:(t,e,l)=>{l.d(e,{z:()=>i});class i{constructor(t=null,e=null,l=null){this.minValue=t,this.maxValue=e,this.noDataValue=l}}},93409:(t,e,l)=>{l.d(e,{A:()=>m});var i,n=l(81856),r=l(32391),a=l(92713),s=l(33715),o=l(61939),h=l(91838),f=l(16352),u=l(12709),p=l(84298),c=l(50518);let d=i=class extends a.A{static createEmptyBand(t,e){return new(i.getPixelArrayConstructor(t))(e)}static combineBandMasks(t){if(t.length<2)return t[0];let e=t[0].length,l=new Uint8Array(e).fill(255);for(let i=0;i<t.length;i++){let n=t[i];for(let t=0;t<e;t++)n[t]||(l[t]=0)}return l}static getPixelArrayConstructor(t){let e;switch(t){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":e=Float32Array;break;case"f64":e=Float64Array}return e}constructor(t){super(t),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(t){if(!t)return"f32";let e=t.toLowerCase();return["u1","u2","u4"].includes(e)?e="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(e)||(e="f32"),e}getPlaneCount(){return this.pixels?.length}addData(t){if(!t.pixels||t.pixels.length!==this.width*this.height)throw new r.A("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(t.pixels),this.statistics.push(t.statistics??new p.z)}getAsRGBA(){let t=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(t);break;default:this._fillFrom8Bit(t)}return new Uint8ClampedArray(t)}getAsRGBAFloat(){let t=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(t),t}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map(t=>(function(t,e){let l=1/0,i=-1/0,n=t.length,r,a=0;if(null!=e)for(r=0;r<n;r++)e[r]&&(l=(a=t[r])<l?a:l,i=a>i?a:i);else for(r=0;r<n;r++)l=(a=t[r])<l?a:l,i=a>i?a:i;return new p.z(l,i)})(t,this.mask));let t=this.mask,e=0;if(null!=t)for(let l=0;l<t.length;l++)t[l]&&e++;else e=this.width*this.height;this.validPixelCount=e}clamp(t){let e,l,n;if(!t||"f64"===t||"f32"===t||!this.pixels)return;let[r,a]=(0,c.hP)(t),s=this.pixels,o=this.width*this.height,h=s.length,f=[];for(let u=0;u<h;u++){n=i.createEmptyBand(t,o),e=s[u];for(let t=0;t<o;t++)l=e[t],n[t]=l>a?a:l<r?r:l;f.push(n)}this.pixels=f,this.pixelType=t}extractBands(t){let{pixels:e,statistics:l}=this;if(null==t||0===t.length||!e||0===e.length)return this;let n=e.length,r=t.some(t=>t>=e.length),a=n===t.length&&!t.some((t,e)=>t!==e);if(r||a)return this;let s=this.bandMasks?.length===n?t.map(t=>this.bandMasks[t]):void 0,{mask:o,validPixelCount:h}=this,{width:f,height:u}=this;return s?.length&&(h=(o=i.combineBandMasks(s)).filter(t=>!!t).length),new i({pixelType:this.pixelType,width:f,height:u,mask:o,bandMasks:s,validPixelCount:h,maskIsAlpha:this.maskIsAlpha,pixels:t.map(t=>e[t]),statistics:l&&t.map(t=>l[t])})}clone(){let t,e=new i({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});null!=this.mask&&(e.mask=new Uint8Array(this.mask)),this.bandMasks&&(e.bandMasks=this.bandMasks.map(t=>new Uint8Array(t)));let l=i.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){e.pixels=[];let i=!!this.pixels[0].slice;for(t=0;t<this.pixels.length;t++)e.pixels[t]=i?this.pixels[t].slice():new l(this.pixels[t])}if(this.statistics)for(e.statistics=[],t=0;t<this.statistics.length;t++)e.statistics[t]=(0,s.o8)(this.statistics[t]);return e.premultiplyAlpha=this.premultiplyAlpha,e}_fillFrom8Bit(t){let e,l,i,n,{mask:r,maskIsAlpha:a,premultiplyAlpha:s,pixels:h}=this;if(!t||!h?.length)return void o.A.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");e=l=i=h[0],h.length>=3?(l=h[1],i=h[2]):2===h.length&&(l=h[1]);let f=new Uint32Array(t),u=this.width*this.height;if(e.length===u)if(null!=r&&r.length===u)if(a)for(n=0;n<u;n++){let t=r[n];if(t){let r=t/255;f[n]=s?t<<24|i[n]*r<<16|l[n]*r<<8|e[n]*r:t<<24|i[n]<<16|l[n]<<8|e[n]}}else for(n=0;n<u;n++)r[n]&&(f[n]=-0x1000000|i[n]<<16|l[n]<<8|e[n]);else for(n=0;n<u;n++)f[n]=-0x1000000|i[n]<<16|l[n]<<8|e[n];else o.A.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(t){let e,l,i,n,r,{pixels:a,mask:s,statistics:h}=this;if(!t||!a?.length)return void o.A.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let f=this.pixelType,u=1,p=0,c=1;if(h&&h.length>0){for(let t of h)null!=t.minValue&&(p=Math.min(p,t.minValue)),null!=t.maxValue&&null!=t.minValue&&(c=Math.max(c,t.maxValue-t.minValue));u=255/c}else{let t=255;"s8"===f?(p=-128,t=127):"u16"===f?t=65535:"s16"===f?(p=-32768,t=32767):"u32"===f?t=0xffffffff:"s32"===f?(p=-0x80000000,t=0x7fffffff):"f32"===f?(p=-34e38,t=34e38):"f64"===f&&(p=-Number.MAX_VALUE,t=Number.MAX_VALUE),u=255/(t-p)}let d=new Uint32Array(t),m=this.width*this.height;if((e=l=i=a[0]).length!==m)return o.A.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(a.length>=2)if(l=a[1],a.length>=3&&(i=a[2]),null!=s&&s.length===m)for(n=0;n<m;n++)s[n]&&(d[n]=-0x1000000|(i[n]-p)*u<<16|(l[n]-p)*u<<8|(e[n]-p)*u);else for(n=0;n<m;n++)d[n]=-0x1000000|(i[n]-p)*u<<16|(l[n]-p)*u<<8|(e[n]-p)*u;else if(null!=s&&s.length===m)for(n=0;n<m;n++)r=(e[n]-p)*u,s[n]&&(d[n]=-0x1000000|r<<16|r<<8|r);else for(n=0;n<m;n++)r=(e[n]-p)*u,d[n]=-0x1000000|r<<16|r<<8|r}_fillFrom32Bit(t){let e,l,i,n,{pixels:r,mask:a}=this;if(!t||!r?.length)return o.A.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");e=l=i=r[0],r.length>=3?(l=r[1],i=r[2]):2===r.length&&(l=r[1]);let s=this.width*this.height;if(e.length!==s)return o.A.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let h=0;if(null!=a&&a.length===s)for(n=0;n<s;n++)t[h++]=e[n],t[h++]=l[n],t[h++]=i[n],t[h++]=1&a[n];else for(n=0;n<s;n++)t[h++]=e[n],t[h++]=l[n],t[h++]=i[n],t[h++]=1}};(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"width",void 0),(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"height",void 0),(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"pixelType",void 0),(0,n._)([(0,f.w)("pixelType")],d.prototype,"castPixelType",null),(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"validPixelCount",void 0),(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"mask",void 0),(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"maskIsAlpha",void 0),(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"pixels",void 0),(0,n._)([(0,h.MZ)()],d.prototype,"premultiplyAlpha",void 0),(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"statistics",void 0),(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"depthCount",void 0),(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"noDataValues",void 0),(0,n._)([(0,h.MZ)({json:{write:!0}})],d.prototype,"bandMasks",void 0);let m=d=i=(0,n._)([(0,u.$)("esri.layers.support.PixelBlock")],d)},93782:(t,e,l)=>{l.d(e,{$Q:()=>B,$i:()=>D,AB:()=>o,Ew:()=>m,Hx:()=>d,IB:()=>i,J$:()=>F,LY:()=>k,QF:()=>V,UK:()=>c,Wb:()=>n,Wt:()=>M,Wy:()=>h,XU:()=>A,dK:()=>y,eH:()=>p,et:()=>s,lD:()=>S,qL:()=>u,z$:()=>U,z7:()=>v,zg:()=>f});var i,n,r=l(93409),a=l(50518);!function(t){t[t.matchAny=0]="matchAny",t[t.matchAll=1]="matchAll"}(i||(i={})),function(t){t[t.bestMatch=0]="bestMatch",t[t.fail=1]="fail"}(n||(n={}));let s=6;function o(t){return null!=t&&"esri.layers.support.PixelBlock"===t.declaredClass&&t.pixels&&t.pixels.length>0}function h(t){if(!t?.length||t.some(t=>!o(t)))return null;if(1===t.length)return t[0]?.clone()??null;let{width:e,height:l,pixelType:i}=t[0];if(t.some(t=>t.width!==e||t.height!==l))return null;let n=t.map(({mask:t})=>t).filter(t=>null!=t),a=null;n.length&&((a=new Uint8Array(e*l)).set(n[0]),n.length>1&&w(n.slice(1),a));let s=[];t.forEach(({pixels:t})=>s.push(...t));let h=t.map(({statistics:t})=>t).filter(t=>t?.length),f=[];return h.forEach(t=>f.push(...t)),new r.A({pixelType:i,width:e,height:l,mask:a,pixels:s,statistics:f.length?f:null})}function f(t){if(!t)return;let e=t.colormap;if(!e||0===e.length)return;let l=e.sort((t,e)=>t[0]-e[0]),i=0;l[0][0]<0&&(i=l[0][0]);let n=Math.max(256,l[l.length-1][0]-i+1),r=new Uint8Array(4*n),a=[],s,o=0,h=0,f=5===l[0].length;if(n>65536)return l.forEach(t=>{a[t[0]-i]=f?t.slice(1):t.slice(1).concat([255])}),{indexed2DColormap:a,offset:i,alphaSpecified:f};if(t.fillUnspecified)for(o=(s=l[h])[0]-i;o<n;o++)r[4*o]=s[1],r[4*o+1]=s[2],r[4*o+2]=s[3],r[4*o+3]=f?s[4]:255,o===s[0]-i&&(s=h===l.length-1?s:l[++h]);else for(o=0;o<l.length;o++)r[h=4*((s=l[o])[0]-i)]=s[1],r[h+1]=s[2],r[h+2]=s[3],r[h+3]=f?s[4]:255;return{indexedColormap:r,offset:i,alphaSpecified:f}}function u(t,e){if(!o(t)||!e||!e.indexedColormap&&!e.indexed2DColormap)return t;let l=t.clone(),i=l.pixels,n=l.mask,r=l.width*l.height;if(1!==i.length)return t;let{indexedColormap:a,indexed2DColormap:s,offset:h,alphaSpecified:f}=e,u=0,p=i[0],c=new Uint8Array(p.length),d=new Uint8Array(p.length),m=new Uint8Array(p.length),g,x=0;if(a){let t=a.length-1;if(null!=n)for(u=0;u<r;u++)n[u]&&((x=4*(p[u]-h))<h||x>t?n[u]=0:(c[u]=a[x],d[u]=a[x+1],m[u]=a[x+2],n[u]=a[x+3]));else{for(n=new Uint8Array(r),u=0;u<r;u++)(x=4*(p[u]-h))<h||x>t?n[u]=0:(c[u]=a[x],d[u]=a[x+1],m[u]=a[x+2],n[u]=a[x+3]);l.mask=n}}else if(s)if(null!=n)for(u=0;u<r;u++)n[u]&&(g=s[p[u]],c[u]=g[0],d[u]=g[1],m[u]=g[2],n[u]=g[3]);else{for(n=new Uint8Array(r),u=0;u<r;u++)g=s[p[u]],c[u]=g[0],d[u]=g[1],m[u]=g[2],n[u]=g[3];l.mask=n}return l.pixels=[c,d,m],l.statistics=null,l.pixelType="u8",l.maskIsAlpha=f,l}function p(t,e){if(!o(t))return null;let{pixels:l,mask:i}=t,n=l.length,a=e.lut,{offset:s}=e;a&&1===a[0].length&&(a=l.map(()=>a));let h=[],f=e.outputPixelType||"u8";for(let t=0;t<n;t++){let e=c(l[t],i,a[t],s||0,f);h.push(e)}let u=new r.A({width:t.width,height:t.height,pixels:h,mask:i,pixelType:f});return u.updateStatistics(),u}function c(t,e,l,i,n){let a=t.length,s=r.A.createEmptyBand(n,a);if(e)for(let n=0;n<a;n++)e[n]&&(s[n]=l[t[n]-i]);else for(let e=0;e<a;e++)s[e]=l[t[e]-i];return s}function d(t,e){if(!o(t))return null;let l=t.clone(),{pixels:i}=l,n=l.width*l.height,r=e.length,a=Math.floor(r/2),s=e[Math.floor(a)],h=i[0],f,u,p,c,d,m,g=!1,x=new Uint8Array(n),w=new Uint8Array(n),y=new Uint8Array(n),A=l.mask,M=4===e[0].mappedColor.length;for(A||((A=new Uint8Array(n)).fill(M?255:1),l.mask=A),d=0;d<n;d++)if(A[d]){for(f=h[d],g=!1,m=a,u=s,p=0,c=r-1;c-p>1;){if(f===u.value){g=!0;break}f>u.value?p=m:c=m,u=e[Math.floor(m=Math.floor((p+c)/2))]}g||(f===e[p].value?(u=e[p],g=!0):f===e[c].value?(u=e[c],g=!0):f<e[p].value?(g=!1,u=null):f>e[p].value&&(f<e[c].value?(u=e[p],g=!0):c===r-1?(g=!1,u=null):(u=e[c],g=!0))),g?(x[d]=u.mappedColor[0],w[d]=u.mappedColor[1],y[d]=u.mappedColor[2],A[d]=u.mappedColor[3]):x[d]=w[d]=y[d]=A[d]=0}return l.pixels=[x,w,y],l.mask=A,l.pixelType="u8",l.maskIsAlpha=M,l}function m(t,e){if(!o(t))return null;let{width:l,height:i}=t,{inputRanges:n,outputValues:s,outputPixelType:h,noDataRanges:f,allowUnmatched:u,isLastInputRangeInclusive:p}=e,c=t.pixels[0],d=r.A.createEmptyBand(h,c.length),m=t.mask,g=new Uint8Array(l*i);m?g.set(m):g.fill(255);let x=1e-6*!!t.pixelType.startsWith("f"),w=n.map(t=>t-x);w[0]=n[0],w[w.length-1]=n[n.length-1]+1e-6*!!p;let y=n.length/2,[A,M]=(0,a.hP)(h);for(let t=0;t<i;t++)for(let e=0;e<l;e++){let i=t*l+e;if(g[i]){let t=c[i],e=!1;for(let l=y-1;l>=0;l--)if(t===w[2*l]||t>w[2*l]&&t<w[2*l+1]){d[i]=s[l],e=!0;break}e||(u?d[i]=t>M?M:t<A?A:t:g[i]=0)}}let k=f?.length;if(k)for(let t=0;t<i;t++)for(let e=0;e<l;e++){let i=t*l+e;if(!m||m[i]){let t=c[i];for(let e=0;e<k;e+=2)if(t>=f[e]&&t<=f[e+1]){d[i]=0,g[i]=0;break}}}return new r.A({width:l,height:i,pixelType:h,pixels:[d],mask:g})}function g(t,e,l,i){let n=null!=l&&l.length>=2?new Set(l):null,r=1===l?.length?l[0]:null,a=!!e?.length;for(let l=0;l<t.length;l++)if(i[l]){let s=t[l];if(a){let t=!1;for(let l=0;l<e.length;l+=2)if(s>=e[l]&&s<=e[l+1]){t=!0;break}t||(i[l]=0)}i[l]&&(s===r||n?.has(s))&&(i[l]=0)}}function x(t,e){let l=t[0].length;for(let i=0;i<l;i++)if(e[i]){let l=!1;for(let e=0;e<t.length;e++)if(t[e][i]){l=!0;break}l||(e[i]=0)}}function w(t,e){let l=t[0].length;for(let i=0;i<l;i++)if(e[i]){let l=!1;for(let e=0;e<t.length;e++)if(0===t[e][i]){l=!0;break}l&&(e[i]=0)}}function y(t,e){if(!o(t))return null;let{width:l,height:i,pixels:n}=t,a=l*i,s=new Uint8Array(a);t.mask?s.set(t.mask):s.fill(255);let h=n.length,{includedRanges:f,noDataValues:u,outputPixelType:p,matchAll:d,lookups:m}=e;if(m){let t=[];for(let e=0;e<h;e++){let l=m[e],i=c(n[e],s,l.lut,l.offset||0,"u8");t.push(i)}1===t.length?s.set(t[0]):d?x(t,s):w(t,s)}else if(d){let t=[];for(let e=0;e<h;e++){let l=new Uint8Array(a);l.set(s),g(n[e],f?.slice(2*e,2*e+2),u?.[e],l),t.push(l)}1===t.length?s.set(t[0]):x(t,s)}else for(let t=0;t<h;t++)g(n[t],f?.slice(2*t,2*t+2),u?.[t],s);return new r.A({width:l,height:i,pixelType:p,pixels:n,mask:s})}function A(t){let{srcPixelType:e,inputRanges:l,outputValues:i,allowUnmatched:n,noDataRanges:s,isLastInputRangeInclusive:o,outputPixelType:h}=t;if("u8"!==e&&"s8"!==e&&"u16"!==e&&"s16"!==e)return null;let f=e.includes("16")?65536:256,u=e.includes("s")?-f/2:0,p=r.A.createEmptyBand(h,f),c=new Uint8Array(f);n&&c.fill(255);let[d,m]=(0,a.hP)(h);if(l?.length&&i?.length){let t=l.map(t=>t-1e-6);t[0]=l[0],o&&(t[t.length-1]=l[l.length-1]);for(let e=0;e<t.length;e++){let l=i[e]>m?m:i[e]<d?d:i[e],n=Math.ceil(t[2*e]-u),r=Math.floor(t[2*e+1]-u);for(let t=n;t<=r;t++)p[t]=l,c[t]=255}}if(s?.length)for(let t=0;t<s.length;t++){let e=Math.ceil(s[2*t]-u),l=Math.floor(s[2*t+1]-u);for(let t=e;t<=l;t++)c[t]=0}return{lut:p,offset:u,mask:c}}function M(t,e,l){if("u8"!==t&&"s8"!==t&&"u16"!==t&&"s16"!==t)return null;let i=t.includes("16")?65536:256,n=t.includes("s")?-i/2:0,r=new Uint8Array(i);if(e)for(let t=0;t<e.length;t++){let l=Math.ceil(e[2*t]-n),i=Math.floor(e[2*t+1]-n);for(let t=l;t<=i;t++)r[t]=255}else r.fill(255);if(l)for(let t=0;t<l.length;t++)r[l[t]-n]=0;return{lut:r,offset:n}}function k(t,e){if(!t||0===t.length)return null;let l=t.find(t=>t.pixelBlock);if(null==l?.pixelBlock)return null;let i=(l.extent.xmax-l.extent.xmin)/l.pixelBlock.width,n=(l.extent.ymax-l.extent.ymin)/l.pixelBlock.height,r=.01*Math.min(i,n),a=t.sort((t,e)=>Math.abs(t.extent.ymax-e.extent.ymax)>r?e.extent.ymax-t.extent.ymax:Math.abs(t.extent.xmin-e.extent.xmin)>r?t.extent.xmin-e.extent.xmin:0),s=Math.min.apply(null,a.map(t=>t.extent.xmin)),o=Math.min.apply(null,a.map(t=>t.extent.ymin)),h=Math.max.apply(null,a.map(t=>t.extent.xmax)),f=Math.max.apply(null,a.map(t=>t.extent.ymax)),u={x:Math.round((e.xmin-s)/i),y:Math.round((f-e.ymax)/n)},p={width:Math.round((h-s)/i),height:Math.round((f-o)/n)},c={width:Math.round((e.xmax-e.xmin)/i),height:Math.round((e.ymax-e.ymin)/n)};return Math.round(p.width/l.pixelBlock.width)*Math.round(p.height/l.pixelBlock.height)!==a.length||u.x<0||u.y<0||p.width<c.width||p.height<c.height?null:{extent:e,pixelBlock:v(a.map(t=>t.pixelBlock),p,{clipOffset:u,clipSize:c})}}function b(t,e,l,i,n,r){let{width:a,height:s}=l.block,{x:o,y:h}=l.offset,{width:f,height:u}=l.mosaic,p={xmin:o<=i*a?0:o<i*a+a?o-i*a:a,ymin:h<=n*s?0:h<n*s+s?h-n*s:s,xmax:o+f<=i*a?0:o+f<i*a+a?o+f-i*a:a,ymax:h+u<=n*s?0:h+u<n*s+s?h+u-n*s:s},c=0,d=0;if(r){let t=r.hasGCSSShiftTransform?360:r.halfWorldWidth??0,e=a*r.resolutionX,l=r.startX+i*e;l<t&&l+e>t?d=r.rightPadding:l>=t&&(c=r.leftMargin-r.rightPadding,d=0)}if(p.xmax-=d,"number"!=typeof e)for(let l=p.ymin;l<p.ymax;l++){let r=(n*s+l-h)*f+(i*a-o)+c,u=l*a;for(let l=p.xmin;l<p.xmax;l++)t[r+l]=e[u+l]}else for(let l=p.ymin;l<p.ymax;l++){let r=(n*s+l-h)*f+(i*a-o)+c;for(let l=p.xmin;l<p.xmax;l++)t[r+l]=e}}function v(t,e,l={}){let i,{clipOffset:n,clipSize:a,alignmentInfo:s,blockWidths:h}=l;if(h)return function(t,e,l){let i=t.find(t=>null!=t);if(null==i)return null;let n=t.some(t=>null==t||!!t.mask),{width:a,height:s}=e,h=n?new Uint8Array(a*s):null,{blockWidths:f}=l,u=[],p=i.getPlaneCount(),c=r.A.getPixelArrayConstructor(i.pixelType);if(n)for(let e=0,l=0;e<t.length;l+=f[e],e++){let i=t[e];if(!o(i))continue;let n=i.mask;for(let t=0;t<s;t++)for(let r=0;r<f[e];r++)h[t*a+r+l]=null==n?255:n[t*i.width+r]}let d=t.some(t=>t?.bandMasks&&t.bandMasks.length>1),m=d?[]:void 0,g=a*s;for(let e=0;e<p;e++){let l=new c(g),i=d?new Uint8Array(g):void 0;for(let n=0,r=0;n<t.length;r+=f[n],n++){let h=t[n];if(!o(h))continue;let u=h.pixels[e];if(null!=u){for(let t=0;t<s;t++)for(let e=0;e<f[n];e++)l[t*a+e+r]=u[t*h.width+e];if(i){let t=h.bandMasks?.[e]??h.mask;for(let e=0;e<s;e++)for(let l=0;l<f[n];l++)i[e*a+l+r]=t?t[e*h.width+l]:255}}}u.push(l),m&&i&&m.push(i)}let x=new r.A({width:a,height:s,mask:h,bandMasks:m,pixels:u,pixelType:i.pixelType});return x.updateStatistics(),x}(t,e,{blockWidths:h});let f=t.find(t=>o(t));if(null==f)return null;let u=a?a.width:e.width,p=a?a.height:e.height,c=f.width,d=f.height,m=e.width/c,g=e.height/d,x={offset:n||{x:0,y:0},mosaic:a||e,block:{width:c,height:d}},w=f.pixelType,y=r.A.getPixelArrayConstructor(w),A=f.pixels.length,M=[];for(let e=0;e<A;e++){i=new y(u*p);for(let l=0;l<g;l++)for(let n=0;n<m;n++){let r=t[l*m+n];o(r)&&b(i,r.pixels[e],x,n,l,s)}M.push(i)}let k=t.some(t=>null==t||null!=t.mask&&t.mask.length>0),U=t.some(t=>t?.bandMasks&&t.bandMasks.length>1),P=k?new Uint8Array(u*p):void 0,T=U?[]:void 0;if(P){for(let e=0;e<g;e++)for(let l=0;l<m;l++){let i=t[e*m+l],n=null!=i?i.mask:null;b(P,null!=n?n:255*!!i,x,l,e,s)}if(T)for(let e=0;e<A;e++){let l=new Uint8Array(u*p);for(let i=0;i<g;i++)for(let n=0;n<m;n++){let r=t[i*m+n],a=r?.bandMasks?.[e]??r?.mask;b(l,null!=a?a:255*!!r,x,n,i,s)}T.push(l)}}let I=new r.A({width:u,height:p,pixels:M,pixelType:w,bandMasks:T,mask:P});return I.updateStatistics(),I}function U(t,e,l){if(!o(t))return null;let{width:i,height:n}=t,r=e.x,a=e.y,s=l.width+r,h=l.height+a;if(r<0||a<0||s>i||h>n||0===r&&0===a&&s===i&&h===n)return t;t.mask||(t.mask=new Uint8Array(i*n));let f=t.mask;for(let t=0;t<n;t++){let e=t*i;for(let l=0;l<i;l++)f[e+l]=t<a||t>=h||l<r||l>=s?0:1}return t.updateStatistics(),t}function P(t){if(0===t.size)return 0;let e=0,l=-1,i=0,n=t.keys(),r=n.next();for(;!r.done;)(i=t.get(r.value))>e&&(l=r.value,e=i),r=n.next();return l}function T(t,e,l){if(0===l)return;let i=t.get(e);1===i?t.delete(e):t.set(e,i-1)}function I(t,e,l){0!==l&&t.set(e,t.has(e)?t.get(e)+1:1)}function B(t,e,l){let{x:i,y:n}=e,{width:a,height:s}=l;if(0===i&&0===n&&s===t.height&&a===t.width)return t;let{width:h,height:f}=t,u=Math.max(0,n),p=Math.max(0,i),c=Math.min(i+a,h),d=Math.min(n+s,f);if(c<0||d<0||!o(t))return null;i=Math.max(0,-i),n=Math.max(0,-n);let{pixels:m}=t,g=a*s,x=m.length,w=[];for(let e=0;e<x;e++){let l=m[e],s=r.A.createEmptyBand(t.pixelType,g);for(let t=u;t<d;t++){let e=t*h,r=(t+n-u)*a+i;for(let t=p;t<c;t++)s[r++]=l[e+t]}w.push(s)}let y=new Uint8Array(g),A=t.mask;for(let t=u;t<d;t++){let e=t*h,l=(t+n-u)*a+i;for(let t=p;t<c;t++)y[l++]=A?A[e+t]:1}let M=new r.A({width:l.width,height:l.height,pixelType:t.pixelType,pixels:w,mask:y});return M.updateStatistics(),M}function _(t,e=!0){if(!o(t))return null;let{pixels:l,width:i,height:n,mask:a,pixelType:s}=t,h=[],f=Math.round(i/2),u=Math.round(n/2),p=n-1,c=i-1;for(let t=0;t<l.length;t++){let a=l[t],o=r.A.createEmptyBand(s,f*u),d=0;for(let t=0;t<n;t+=2)for(let l=0;l<i;l+=2){let n=a[t*i+l];if(e){let e=l===c?n:a[t*i+l+1],r=t===p?n:a[t*i+l+i],s=l===c?r:t===p?e:a[t*i+l+i+1];o[d++]=(n+e+r+s)/4}else o[d++]=n}h.push(o)}let d=null;if(null!=a){d=new Uint8Array(f*u);let t=0;for(let l=0;l<n;l+=2)for(let n=0;n<i;n+=2){let r=a[l*i+n];if(e){let e=n===c?r:a[l*i+n+1],s=l===p?r:a[l*i+n+i],o=n===c?s:l===p?e:a[l*i+n+i+1];d[t++]=r*e*s*o?1:0}else d[t++]=r}}return new r.A({width:f,height:u,pixelType:s,pixels:h,mask:d})}function S(t,e,l=0,i=!0){if(!o(t))return null;let{width:n,height:r}=e,{width:a,height:s}=t,h=new Map,f={x:0,y:0},u=1+l,p=t;for(let t=0;t<u;t++){let l=Math.ceil(a/n),o=Math.ceil(s/r);for(let i=0;i<o;i++){f.y=i*r;for(let r=0;r<l;r++){f.x=r*n;let l=B(p,f,e);h.set(`${t}/${i}/${r}`,l)}}t<u-1&&(p=_(p,i)),a=Math.round(a/2),s=Math.round(s/2)}return h}function F(t){let{pixelBlock:e,tileSize:l,level:i,row:n,col:r,useBilinear:a}=t;if(!o(e))return null;let{width:s,height:h}=l,f=2**i,u=f*s,p=f*h,c=B(e,{y:n*p,x:r*u},{width:u,height:p});if(!c)return null;for(let t=i;t>0;t--)c=_(c,a);return c}function C(t,e,l,i,n=0){let r,a,s,o,h,f,u,{width:p,height:c}=t,{width:d,height:m}=e,g=i.cols,x=i.rows,w=Math.ceil(d/g-.1/g),y=Math.ceil(m/x-.1/x),A=w*g,M=A*y*x,k=new Float32Array(M),b=new Float32Array(M),v=new Uint32Array(M),U=new Uint32Array(M),P,T,I=0;for(let t=0;t<y;t++)for(let e=0;e<w;e++){a=l[r=12*(t*w+e)],s=l[r+1],o=l[r+2],h=l[r+3],f=l[r+4],u=l[r+5];for(let l=0;l<x;l++){I=(t*x+l)*A+e*g,T=(l+.5)/x;for(let t=0;t<l;t++)P=(t+.5)/g,k[I+t]=(a*P+s*T+o)*p+n,b[I+t]=(h*P+f*T+u)*c+n,v[I+t]=Math.floor(k[I+t]),U[I+t]=Math.floor(b[I+t])}r+=6,a=l[r],s=l[r+1],o=l[r+2],h=l[r+3],f=l[r+4],u=l[r+5];for(let l=0;l<x;l++){I=(t*x+l)*A+e*g,T=(l+.5)/x;for(let t=l;t<g;t++)P=(t+.5)/g,k[I+t]=(a*P+s*T+o)*p+n,b[I+t]=(h*P+f*T+u)*c+n,v[I+t]=Math.floor(k[I+t]),U[I+t]=Math.floor(b[I+t])}}return{offsets_x:k,offsets_y:b,offsets_xi:v,offsets_yi:U,gridWidth:A}}function V(t,e){let{coefficients:l,spacing:i}=e,{offsets_x:n,offsets_y:r,gridWidth:a}=C(t,t,l,{rows:i[0],cols:i[1]}),{width:s,height:o}=t,h=new Float32Array(s*o),f=180/Math.PI;for(let t=0;t<o;t++)for(let e=0;e<s;e++){let l=t*a+e,i=0===t?l:l-a,u=t===o-1?l:l+a,p=n[i]-n[u],c=r[u]-r[i];if(isNaN(p)||isNaN(c))h[t*s+e]=90;else{let l=Math.atan2(c,p)*f;l=(360+l)%360,h[t*s+e]=l}}return h}function D(t,e,l,i,n="nearest"){let a,s;if(!o(t))return null;"majority"===n&&(t=function(t){if(!o(t))return null;let e=t.clone(),{width:l,height:i,pixels:n}=t,r=n[0],a=e.pixels[0],s=t.mask;for(let t=2;t<i-1;t++){let e=new Map;for(let i=t-2;i<t+2;i++)for(let t=0;t<4;t++){let n=i*l+t;I(e,r[n],s?s[n]:1)}a[t*l]=P(e),a[t*l+1]=a[t*l+2]=a[t*l];let i=3;for(;i<l-1;i++){let n=(t-2)*l+i+1;I(e,r[n],s?s[n]:1),I(e,r[n=(t-1)*l+i+1],s?s[n]:1),I(e,r[n=t*l+i+1],s?s[n]:1),I(e,r[n=(t+1)*l+i+1],s?s[n]:1),T(e,r[n=(t-2)*l+i-3],s?s[n]:1),T(e,r[n=(t-1)*l+i-3],s?s[n]:1),T(e,r[n=t*l+i-3],s?s[n]:1),T(e,r[n=(t+1)*l+i-3],s?s[n]:1),a[t*l+i]=P(e)}a[t*l+i+1]=a[t*l+i]}for(let t=0;t<l;t++)a[t]=a[l+t]=a[2*l+t],a[(i-1)*l+t]=a[(i-2)*l+t];return e.updateStatistics(),e}(t));let{pixels:h,mask:f,bandMasks:u,pixelType:p}=t,c=t.width,d=t.height,m=r.A.getPixelArrayConstructor(p),g=h.length,{width:x,height:w}=e,y=!1;for(let t=0;t<l.length;t+=3)-1===l[t]&&-1===l[t+1]&&-1===l[t+2]&&(y=!0);let{offsets_x:A,offsets_y:M,offsets_xi:k,offsets_yi:b,gridWidth:v}=C({width:c,height:d},e,l,i,.5*("majority"===n)),U=(t,e,l,i)=>{let n=t instanceof Float32Array||t instanceof Float64Array?0:.5;for(let r=0;r<w;r++){a=r*v;for(let s=0;s<x;s++){if(A[a]<0||M[a]<0)t[r*x+s]=0;else if(i)t[r*x+s]=e[k[a]+b[a]*c];else{let i=Math.floor(A[a]),o=Math.floor(M[a]),h=Math.ceil(A[a]),f=Math.ceil(M[a]),u=A[a]-i,p=M[a]-o;if(!l||l[i+o*c]&&l[h+o*c]&&l[i+f*c]&&l[h+f*c]){let l=(1-u)*e[i+o*c]+u*e[h+o*c],a=(1-u)*e[i+f*c]+u*e[h+f*c];t[r*x+s]=(1-p)*l+p*a+n}else t[r*x+s]=e[k[a]+b[a]*c]}a++}}},B=[],_=u?.length===g,S=[];for(let t=0;t<g;t++){if(_){let e=new Uint8Array(x*w);U(e,u[t],u[t],!0),S.push(e)}U(s=new m(x*w),h[t],_?u[t]:f,"nearest"===n||"majority"===n),B.push(s)}let F=new r.A({width:x,height:w,pixelType:p,pixels:B,bandMasks:_?S:void 0});if(null!=f)F.mask=new Uint8Array(x*w),U(F.mask,f,f,!0);else if(y){F.mask=new Uint8Array(x*w);for(let t=0;t<x*w;t++)F.mask[t]=A[t]<0||M[t]<0?0:1}return F.updateStatistics(),F}}}]);