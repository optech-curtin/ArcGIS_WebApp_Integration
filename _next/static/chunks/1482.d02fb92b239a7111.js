"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1482],{78724:(e,t,n)=>{var a;n.d(t,{n:()=>a}),function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"}(a||(a={}))},81482:(e,t,n)=>{let a,r;n.r(t),n.d(t,{TextureCompressionWorkerOutput:()=>B,compress:()=>c,compressRGBADataToKTX2:()=>A,createTextureDataKTX2:()=>G,initializeBasisEncoder:()=>T,initializeDXTEncoder:()=>o});var l=n(81048),s=n(78724),i=n(93446);let _,C,u=null,R=null;class B{constructor(e,t){this.internalFormat=e,this.compressedTexture=t}}async function c(e){let t=function(e,t=!1){let n=new OffscreenCanvas(e.width,e.height),a=n.getContext("2d");return t&&a.scale(1,-1),a.drawImage(e,0,t?-e.height:0),a.getImageData(0,0,n.width,n.height).data}(e.data,e.flipped);if(e.hasS3TC){R||await o();let n=new Uint8Array(t.length);R?.encode(new Uint8Array(t),e.width,e.height,n);let a=function(e,t){let n,a,r,l=new Int32Array(e.buffer,e.byteOffset,31);switch(l[21]){case h:n=8,a=i.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case f:n=16,a=i.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case w:n=16,a=i.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}let s=1,_=l[4],C=l[3];(3&_||3&C)&&(_=_+3&-4,C=C+3&-4);let u=_,R=C;131072&l[2]&&!1!==t&&(s=Math.max(1,l[7]));let B=e.byteOffset+l[1]+4,c=[];for(let t=0;t<s;++t)r=(_+3>>2)*(C+3>>2)*n,c.push(new Uint8Array(e.buffer,B,r)),B+=r,_=Math.max(1,_>>1),C=Math.max(1,C>>1);return{textureData:{type:"compressed",levels:c},internalFormat:a,width:u,height:R}}(n,!0),r=[n.buffer];return{result:new B(a?.internalFormat??null,a?.textureData??null),transferList:r}}if(e.hasETC){u||await T();let n=await A(t,e.width,e.height,e.hasMipmap),a=n?await G(n):null,r=a?.compressedTexture?.levels.map(e=>e.buffer)||[];return{result:new B(a?.internalFormat??null,a?.compressedTexture??null),transferList:r}}return{result:new B(null,null)}}async function T(){u||(u=await (_??=a??=(async()=>{let e=await n.e(1065).then(n.bind(n,61065)),t=await e.default({locateFile:e=>(0,l.s)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})()))}async function o(){R||(R=await (C??=r??=(async()=>{let e=await Promise.all([n.e(5263),n.e(2802)]).then(n.bind(n,75263));return await e.default({locateFile:e=>(0,l.s)(`esri/libs/dxtEncoder/${e}`)})})()))}async function A(e,t,n,a,r=255,l=0,s=!1,i=!1){if(!u)return null;let _=new u.BasisEncoder;_.setPerceptual(!i),_.setCheckForAlpha(!0),_.setForceAlpha(!1),_.setRenormalize(i),_.setMipGen(a),_.setMipSRGB(!i),_.setCreateKTX2File(!0),_.setKTX2SRGBTransferFunc(!i),_.setQualityLevel(r),_.setCompressionLevel(l);let C=new Uint8Array(e.byteLength);_.setSliceSourceImage(0,new Uint8Array(e),t,n,s);let R=_.encode(C),B=new Uint8Array(C.buffer,0,R),c=new u.KTX2File(new Uint8Array(B));return c.isValid()?(_.delete(),B):(c.close(),c.delete(),_.delete(),null)}async function G(e){if(!u)return new B(null,null);let t=new u.KTX2File(new Uint8Array(e));t.startTranscoding();let[n,a]=t.getHasAlpha()?[s.n.ETC2_RGBA,i.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[s.n.ETC1_RGB,i.CQ.COMPRESSED_RGB8_ETC2],r=t.getLevels(),l=[];for(let e=0;e<r;e++)l.push(new Uint8Array(t.getImageTranscodedSizeInBytes(e,0,0,n))),t.transcodeImage(l[e],e,0,0,n,0,-1,-1);return t.close(),t.delete(),{internalFormat:a,compressedTexture:{type:"compressed",levels:l}}}function d(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}let h=d("DXT1"),f=d("DXT3"),w=d("DXT5")}}]);