"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8721,9156],{29767:(e,t,a)=>{a.d(t,{S:()=>l,r:()=>i});var r=a(32391),o=a(92753),n=a(11568),s=a(58721);async function i(e,t,a){let r=await p(e,t,a);await c(r,t,a)}async function l(e,t,a,r,o){let n=await p(a,r,o);await e.update({data:t}),await c(n,r,o)}async function p(e,t,i){if(!t?.resources)return;let l=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;let p=new Set(t.resources.toKeep.map(e=>e.resource.path)),c=new Set,u=[];p.forEach(t=>{l.delete(t),e.paths.push(t)});let d=[],f=[],m=[];for(let a of t.resources.toUpdate)if(l.delete(a.resource.path),p.has(a.resource.path)||c.has(a.resource.path)){let{resource:t,content:r,finish:o}=a,i=(0,s.bg)(t,(0,n.lk)());e.paths.push(i.path),d.push({resource:i,content:await (0,s.cL)(r),compress:a.compress}),o&&m.push(()=>o(i))}else{e.paths.push(a.resource.path),f.push({resource:a.resource,content:await (0,s.cL)(a.content),compress:a.compress});let t=a.finish;t&&m.push(()=>t(a.resource)),c.add(a.resource.path)}for(let a of t.resources.toAdd)if(e.paths.push(a.resource.path),l.has(a.resource.path))l.delete(a.resource.path);else{d.push({resource:a.resource,content:await (0,s.cL)(a.content),compress:a.compress});let e=a.finish;e&&m.push(()=>e(a.resource))}if(d.length||f.length){let{addOrUpdateResources:e}=await Promise.resolve().then(a.bind(a,58721));await e(t.portalItem,d,"add",i),await e(t.portalItem,f,"update",i)}if(m.forEach(e=>e()),0===u.length)return l;let h=await (0,o.Ol)(u);if((0,o.Te)(i),h.length>0)throw new r.A("save:resources","Failed to save one or more resources",{errors:h});return l}async function c(e,t,a){if(!e||!t.portalItem)return;let r=[];for(let o of e){let e=t.portalItem.resourceFromPath(o);r.push(e.portalItem.removeResource(e,a))}await (0,o.Lx)(r)}},30508:(e,t,a)=>{a.d(t,{H:()=>r});function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}},58721:(e,t,a)=>{a.d(t,{addOrUpdateResources:()=>i,bg:()=>d,cL:()=>u,fetchResources:()=>s,removeAllResources:()=>p,removeResource:()=>l});var r=a(39166),o=a(32391),n=a(90525);async function s(e,t={},a){await e.load(a);let r=(0,n.fj)(e.itemUrl,"resources"),{start:o=1,num:i=10,sortOrder:l="asc",sortField:p="resource"}=t,c={query:{start:o,num:i,sortOrder:l,sortField:p,token:e.apiKey},signal:a?.signal},u=await e.portal.request(r,c);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map(({created:t,size:a,resource:r})=>({created:new Date(t),size:a,resource:e.resourceFromPath(r)}))}}async function i(e,t,a,r){let s=new Map;for(let{resource:e,content:r,compress:n,access:i}of t){if(!e.hasPath())throw new o.A(`portal-item-resource-${a}:invalid-path`,"Resource does not have a valid path");let[t,l]=c(e.path),p=`${t}/${n??""}/${i??""}`;s.has(p)||s.set(p,{prefix:t,compress:n,access:i,files:[]}),s.get(p).files.push({fileName:l,content:r})}await e.load(r);let i=(0,n.fj)(e.userItemUrl,"add"===a?"addResources":"updateResources");for(let{prefix:t,compress:a,access:o,files:n}of s.values())for(let s=0;s<n.length;s+=25){let l=n.slice(s,s+25),p=new FormData;t&&"."!==t&&p.append("resourcesPrefix",t),a&&p.append("compress","true"),o&&p.append("access",o);let c=0;for(let{fileName:e,content:t}of l)p.append("file"+ ++c,t,e);p.append("f","json"),await e.portal.request(i,{method:"post",body:p,signal:r?.signal})}}async function l(e,t,a){if(!t.hasPath())throw new o.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(a);let r=(0,n.fj)(e.userItemUrl,"removeResources");await e.portal.request(r,{method:"post",query:{resource:t.path},signal:a?.signal}),t.portalItem=null}async function p(e,t){await e.load(t);let a=(0,n.fj)(e.userItemUrl,"removeResources");return e.portal.request(a,{method:"post",query:{deleteAll:!0},signal:t?.signal})}function c(e){let t=e.lastIndexOf("/");return -1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}async function u(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await (0,r.A)(e.url,{responseType:"blob"})).data}function d(e,t){if(!e.hasPath())return null;let[a,,r]=function(e){let[t,a]=function(e){let t=(0,n.Zo)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[r,o]=c(t);return[r,o,a]}(e.path);return e.portalItem.resourceFromPath((0,n.fj)(a,t+r))}},83863:(e,t,a)=>{a.d(t,{v:()=>o});var r=a(30508);function o(e){e?.writtenProperties&&e.writtenProperties.forEach(({target:e,propName:t,newOrigin:a})=>{(0,r.H)(e)&&a&&e.originOf(t)!==a&&e.updateOrigin(t,a)})}},94668:(e,t,a)=>{a.d(t,{c:()=>s,d:()=>o});var r=a(32391);async function o(e){let t=[];for(let a of e.allLayers)if("beforeSave"in a&&"function"==typeof a.beforeSave){let e=a.beforeSave();e&&t.push(e)}await Promise.allSettled(t)}let n=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function s(e,t,a){let o=(e.messages??[]).filter(({type:e})=>"error"===e).map(({name:e,message:t,details:a})=>new r.A(e,t,a));if(e.blockedRelativeUrls&&(o=o.concat(e.blockedRelativeUrls.map(e=>new r.A("url:unsupported",`Relative url '${e}' is not supported`)))),a){let{ignoreUnsupported:e,supplementalUnsupportedErrors:t=[],requiredPropertyChecksDisabled:r}=a;e&&(o=o.filter(({name:e})=>!(n.has(e)||t.includes(e)))),r&&(o=o.filter(e=>"web-document-write:property-required"!==e.name))}if(o.length>0)throw new r.A(t.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:o})}},99156:(e,t,a)=>{a.d(t,{save:()=>R,saveAs:()=>I});var r=a(32391),o=a(21892),n=a(45257),s=a(90525),i=a(83863),l=a(91463),p=a(71760),c=a(6322),u=a(21371),d=a(71086),f=a(14307),m=a(28015),h=a(39577),w=a(23226),y=a(29597),g=a(74497),v=a(12723),b=a(29767),_=a(94668);let O=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(e=>e.toLowerCase());async function R(e,t,a){a??={},function(e,t){if(!t.portalItem)throw new r.A(`${e.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");P(e,t.portalItem)}(e,t),await (0,n.C_)(()=>!t.updatingFromView),await t.load(),await M(t),await (0,_.d)(t),await S(e,t);let o=t.portalItem,{json:s,jsonContext:i}=await A(t,o,e.origin);return(0,_.c)(i,{errorName:`${e.name}:save`},a),await W(t,o),await H(e,t,o,s,i),await Promise.all([t.updateItemThumbnail(),(0,b.r)(t.resourceReferences,i)]),o}async function A(e,t,a){let r=(0,h.m)(t,a,!0),o=e.write({},r);return await Promise.all(r.resources.pendingOperations),{json:o,jsonContext:r}}async function I(e,t,a,r){var o,s;let i;r??={};let l=(o=e,s=a,(i=m.default.from(s)).id&&((i=i.clone()).id=null),i.type||(i.type=o.itemType),i.portal||(i.portal=f.A.getDefault()),P(o,i),i);await (0,n.C_)(()=>!t.updatingFromView),await t.load(),await M(t),await (0,_.d)(t),await S(e,t);let{json:p,jsonContext:c}=await A(t,l,e.origin);(0,_.c)(c,{errorName:`${e.name}:save`},r),await N(t,l);let u=t.getThumbnailState();return await Y(e,t,l,p,c,r)&&(t.resourceReferences.portalItem=l),t.restoreThumbnailFromState(u),await Promise.all([t.updateItemThumbnail(),(0,b.r)(t.resourceReferences,c)]),l}function P(e,t){if(t.type!==e.itemType)throw new r.A(`${e.name}:portal-item-wrong-type`,`Portal item needs to have type "${e.itemType}"`)}async function S(e,t){if("linkchart"===e.name)return;if(!t.basemap?.baseLayers.length)throw new r.A(`${e.name}:save`,"Map does not have a valid basemap with a base layer.");let a=null;if(await (0,n.C_)(()=>{let e=(0,v.n8)(t.initialViewProperties,t.basemap);return a=e.spatialReference,!e.updating}),!(0,p.aI)(a,t.initialViewProperties.spatialReference))throw new r.A(`${e.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:t.initialViewProperties.spatialReference,actual:a})}function M(e){let t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then(()=>{})}async function W(e,t){t.extent=await B(e.portalItem,e.initialViewProperties.viewpoint.targetGeometry),await F(e,t)}let L=w.mm.JSAPI,C="CollectorDisabled",T="Collector",k="Data Editing",j="OfflineDisabled",E="Offline",G="Workforce Project",U="Workforce Worker",x="Workforce Dispatcher",D=w.mm.DEVELOPER_BASEMAP,$="UtilityNetwork";async function N(e,t){(0,w.OM)(t,C),(0,w.OM)(t,"FieldMapsDisabled"),(0,w.OM)(t,w.mm.METADATA),(0,w.OM)(t,j),(0,w.OM)(t,"Offline Map Areas"),(0,w.OM)(t,x),(0,w.OM)(t,G),(0,w.OM)(t,U),await W(e,t)}async function F(e,t){var a,r,o,n,s,i,l,p,c,f;(0,w.LG)(t,L),await Promise.allSettled(V(e).map(e=>e.load()).toArray()).then(()=>{}),a=e,r=t,(0,w.Y)(r,C)||(0,w.Y)(r,G)||(0,w.Y)(r,U)||(0,w.Y)(r,x)||!q(a)?(0,w.OM)(r,T):(0,w.LG)(r,T),o=e,n=t,q(o)?(0,w.LG)(n,k):(0,w.OM)(n,k),function(e,t){!(0,w.Y)(t,j)&&V(e).filter(e=>"group"!==e.type).every(t=>t.loaded&&function(e,t){var a,r,o;return(0,d.W_)(t)&&t.capabilities.operations.supportsSync||((0,d.Ov)(t)||"map-notes"===t.type||"route"===t.type)&&!t.portalItem||("tile"===(a=t).type||"vector-tile"===a.type)&&(a.capabilities.operations.supportsExportTiles||"tile"===(r=a).type&&(0,u.tK)(r.url)&&O.some(e=>r.url?.toLowerCase().includes("/"+e+"/"))||(0,v.JT)(a))&&!("vector-tile"===(o=t).type&&Object.keys(o.sourceNameToSource).length>1)&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}(e,t))?(0,w.LG)(t,E):(0,w.OM)(t,E)}(e,t),s=e,i=t,(0,v.Rc)(s.basemap)?(0,w.LG)(i,D):(0,w.OM)(i,D),l=e,p=t,l.utilityNetworks?.length?(0,w.LG)(p,$):(0,w.OM)(p,$),c=e,f=t,c.ipsInfo?(0,w.LG)(f,"IPS"):(0,w.OM)(f,"IPS"),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((e,t,a)=>a.indexOf(e)===t))}function V(e){return e.allLayers.concat(e.allTables)}function q(e){return V(e).some(e=>e.loaded&&(0,d.W_)(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&("subtype-group"!==e.type||e.sublayers.some(e=>e.editingEnabled)))}async function B(e,t){let a,r=t.clone().normalize();if(r.length>1)for(let e of r)a?e.width>a.width&&(a=e):a=e;else a=r[0];return K(e,a)}async function K(e,t){let r=t.spatialReference;if(r.isWGS84)return t.clone();if(r.isWebMercator)return(0,c.ci)(t);let{getGeometryServiceURL:o}=await a.e(3724).then(a.bind(a,3724)),n=await o(e),s=new g.A({geometries:[t],outSpatialReference:l.A.WGS84});return(await (0,y.C)(n,s))[0]}async function H(e,t,a,r,o){await a.update({data:r}),Z(e,t,a,r,o)}async function Y(e,t,a,o,n,s){let i=t.portalItem,l={item:i,authenticated:!(!i?.id||!i.portal.user)},p=a.portal;await p.signIn();let{copyAllowed:c,itemReloaded:u}=await z(l,p);if(l.authenticated||=u,!c)throw new r.A(`${e.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");let d=await J(a,l,o,s);return t.portalItem=a,Z(e,t,a,o,n),d}async function z(e,t){let{item:a,authenticated:r}=e;return a?.id&&a.typeKeywords?.includes("useOnly")?a.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await a.reload(),{copyAllowed:"admin"===a.itemControl||"update"===a.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function J(e,t,a,r){let o=e.portal,{item:n}=t,{folder:i,copyAllResources:l}=r,p=!1;if(l&&n?.id&&(0,s.b8)(n.portal.url,o.url)&&parseInt(n.portal.currentVersion,10)>=2023){let{total:e}=await n.fetchResources();p=!!e}if(p){let t=await n.copy({copyResources:"all",folder:i});e.id=t.id,e.portal=t.portal;let r=e.toJSON();await e.load(),e.read(r),await e.update({data:a})}else await o.user.addItem({item:e,folder:i,data:a});return p}function Z(e,t,a,r,n){o.L.prototype.read.call(t,{version:r.version,authoringApp:r.authoringApp,authoringAppVersion:r.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:a.itemUrl?(0,s.An)(a.itemUrl):void 0}),(0,i.v)(n),t.resourceInfo=r}}}]);