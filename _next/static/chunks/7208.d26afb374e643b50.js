"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7208],{717:(t,s,o)=>{o.d(s,{o:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"sampler2D",c.c.Draw,(o,c,u)=>o.bindTexture(t,s(c,u)))}}},817:(t,s,o)=>{o.d(s,{IR:()=>h,Mv:()=>u,uT:()=>d,vM:()=>f});var c=o(32391);function u(t){return 16*Math.ceil(t/16)}function d(t){return 16*Math.floor(t/16)}function h(t,s){let o=t.width*t.height;if(o<4096)return t instanceof ImageData?p(t):t;let c=t.width,u=t.height;do o=(c=Math.ceil(c/2))*(u=Math.ceil(u/2));while(o>1048576||null!=s&&(c>s||u>s));return v(t,c,u)}function f(t,s){let o=Math.max(t.width,t.height);if(o<=s)return t;let c=s/o;return v(t,Math.round(t.width*c),Math.round(t.height*c))}function v(t,s,o){if(t instanceof ImageData)return v(p(t),s,o);let c=document.createElement("canvas");return c.width=s,c.height=o,c.getContext("2d").drawImage(t,0,0,c.width,c.height),c}function p(t){let s=document.createElement("canvas");s.width=t.width,s.height=t.height;let o=s.getContext("2d");if(null==o)throw new c.A("Failed to create 2d context from HTMLCanvasElement");return o.putImageData(t,0,0),s}},4111:(t,s,o)=>{o.d(s,{E:()=>p});var c=o(81856),u=o(4538),d=o(95421);class h extends d.K{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}(0,c._)([(0,d.W)()],h.prototype,"instancedDoublePrecision",void 0),(0,c._)([(0,d.W)()],h.prototype,"hasModelTransformation",void 0);var f=o(69214),v=o(2907);class p extends h{constructor(){super(...arguments),this.output=u.V.Color,this.oitPass=f.Y.NONE,this.hasSlicePlane=!1,this.bindType=v.c.Pass,this.writeDepth=!0}}(0,c._)([(0,d.W)({count:u.V.COUNT})],p.prototype,"output",void 0),(0,c._)([(0,d.W)({count:f.Y.COUNT})],p.prototype,"oitPass",void 0),(0,c._)([(0,d.W)()],p.prototype,"hasSlicePlane",void 0)},4318:(t,s,o)=>{o.d(s,{Gc:()=>d,O4:()=>h,Vt:()=>f});var c=o(20456),u=o(86416);function d(t){t.uniforms.add(new c.d("mainLightDirection",t=>t.lighting.mainLight.direction))}function h(t){t.uniforms.add(new c.d("mainLightIntensity",t=>t.lighting.mainLight.intensity))}function f(t){d(t.fragment),h(t.fragment),t.fragment.code.add((0,u.H)`vec3 applyShading(vec3 shadingNormalWorld, float shadow) {
float dotVal = clamp(dot(shadingNormalWorld, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)}},4538:(t,s,o)=>{var c;function u(t){return t===c.Shadow||t===c.ShadowHighlight||t===c.ShadowExcludeHighlight||t===c.ViewshedShadow}function d(t){var s;return A(s=t)||b(s)||t===c.Normal}function h(t){return S(t)||t===c.Normal}function f(t){return t===c.Highlight||t===c.ObjectAndLayerIdColor}function v(t){return p(t)||f(t)}function p(t){return t===c.Color}function m(t){return p(t)||x(t)}function g(t){return p(t)||t===c.ObjectAndLayerIdColor}function _(t){return m(t)||t===c.ObjectAndLayerIdColor}function T(t){return p(t)||t===c.Highlight||b(t)}function A(t){return p(t)||f(t)}function E(t){return m(t)||f(t)}function S(t){return E(t)||b(t)}function b(t){return t===c.Depth}function x(t){return t===c.ColorEmission}o.d(s,{CL:()=>f,LG:()=>x,Mb:()=>E,PJ:()=>u,QG:()=>_,RN:()=>m,T2:()=>S,V:()=>c,XY:()=>d,_o:()=>p,aD:()=>T,dX:()=>A,eh:()=>b,i3:()=>v,iq:()=>h,zW:()=>g}),!function(t){t[t.Color=0]="Color",t[t.ColorEmission=1]="ColorEmission",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal",t[t.Shadow=4]="Shadow",t[t.ShadowHighlight=5]="ShadowHighlight",t[t.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",t[t.ViewshedShadow=7]="ViewshedShadow",t[t.Highlight=8]="Highlight",t[t.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",t[t.COUNT=10]="COUNT"}(c||(c={}))},5012:(t,s,o)=>{o.d(s,{N:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"sampler2D",c.c.Pass,(o,c,u)=>o.bindTexture(t,s(c,u)))}}},7320:(t,s,o)=>{var c,u;o.d(s,{N:()=>c,z:()=>u}),function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"}(c||(c={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(u||(u={}))},10240:(t,s,o)=>{o.d(s,{S:()=>u});var c=o(48678);function u(t){if(t.length<c.y9)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return(0,c.jq)(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}},13636:(t,s,o)=>{function c(t,s,o){for(let c=0;c<o;++c)s[2*c]=t[c],s[2*c+1]=t[c]-s[2*c]}function u(t,s){let o=t.length;for(let c=0;c<o;++c)h[0]=t[c],s[c]=h[0];return s}function d(t,s){let o=t.length;for(let c=0;c<o;++c)h[0]=t[c],h[1]=t[c]-h[0],s[c]=h[1];return s}o.d(s,{Zo:()=>u,jA:()=>d,jS:()=>c});let h=new Float32Array(2)},15907:(t,s,o)=>{o.d(s,{i$:()=>p,oD:()=>m,xJ:()=>v});var c=o(4538),u=o(31357),d=o(43417),h=o(86416);function f(t){t.varyings.add("linearDepth","float")}function v(t){t.vertex.uniforms.add(new d.E("nearFar",t=>t.camera.nearFar))}function p(t){t.vertex.code.add((0,h.H)`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function m(t,s){let{vertex:o}=t;switch(s.output){case c.V.Color:case c.V.ColorEmission:if(s.receiveShadows)return f(t),void o.code.add((0,h.H)`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case c.V.Shadow:case c.V.ShadowHighlight:case c.V.ShadowExcludeHighlight:case c.V.ViewshedShadow:return t.include(u.em,s),f(t),v(t),p(t),void o.code.add((0,h.H)`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}o.code.add((0,h.H)`void forwardLinearDepth() {}`)}},16337:(t,s,o)=>{o.d(s,{dg:()=>_,ou:()=>x});var c=o(6815),u=o(3391),d=o(40998),h=o(38715),f=o(63599),v=o(56911),p=o(7916),m=o(10954),g=o(37769);class _{constructor(){this._transform=(0,h.vt)(),this._transformInverse=new T({value:this._transform},d.B8,h.vt),this._transformInverseTranspose=new T(this._transformInverse,d.mg,h.vt),this._transformTranspose=new T({value:this._transform},d.mg,h.vt),this._transformInverseRotation=new T({value:this._transform},c.dR,u.vt)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){(0,d.C)(this._transform,t)}multiplyTransform(t){(0,d.lw)(this._transform,this._transform,t)}set(t){(0,d.C)(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,s){this.setTransformMatrix(t),this.multiplyTransform(s),this._invalidateLazyTransforms()}}class T{constructor(t,s,o){this._original=t,this._update=s,this._dirty=!0,this._transform=o()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}class A{constructor(t=0){this.offset=t,this.tmpVertex=(0,v.vt)()}applyToVertex(t,s,o){let c=(0,f.i)(C,t,s,o),u=(0,f.g)(O,c,this.localOrigin),d=this.offset/(0,f.l)(u);return(0,f.b)(this.tmpVertex,c,u,d),this.tmpVertex}applyToAabb(t){for(let s=0;s<3;++s)I[s]=t[0+s]+this.localOrigin[s],R[s]=t[3+s]+this.localOrigin[s],y[s]=I[s];let s=this.applyToVertex(I[0],I[1],I[2]);for(let o=0;o<3;++o)t[o]=s[o],t[o+3]=s[o];let o=s=>{let o=this.applyToVertex(s[0],s[1],s[2]);for(let s=0;s<3;++s)t[s]=Math.min(t[s],o[s]),t[s+3]=Math.max(t[s+3],o[s])};for(let t=1;t<8;++t){for(let s=0;s<3;++s)y[s]=t&1<<s?R[s]:I[s];o(y)}let c=0;for(let t=0;t<3;++t)I[t]*R[t]<0&&(c|=1<<t);if(0!==c&&7!==c){for(let t=0;t<8;++t)if(!(c&t)){for(let s=0;s<3;++s)y[s]=c&1<<s?0:t&1<<s?I[s]:R[s];o(y)}}for(let s=0;s<3;++s)t[s]-=this.localOrigin[s],t[s+3]-=this.localOrigin[s];return t}}class E{constructor(t=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=(0,v.vt)(),this._tmpMbs=(0,p.c)(),this._tmpObb=new g.ab,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=(0,f.l)(t)}applyToVertex(t,s,o){let c=(0,f.i)(C,t,s,o),u=(0,f.i)(O,t,s,o+this.componentLocalOriginLength),d=this._totalOffset/(0,f.l)(u);return(0,f.b)(this._tmpVertex,c,u,d),this._tmpVertex}applyToAabb(t){let s=this.componentLocalOriginLength,o=t[0],c=t[1],u=t[2]+s,d=t[3],h=t[4],f=t[5]+s,v=Math.abs(o),p=Math.abs(c),m=Math.abs(u),g=Math.abs(d),_=Math.abs(h),T=Math.abs(f),A=.5*(1+Math.sign(o*d))*Math.min(v,g),E=.5*(1+Math.sign(c*h))*Math.min(p,_),S=.5*(1+Math.sign(u*f))*Math.min(m,T),b=Math.max(v,g),x=Math.max(p,_),C=Math.max(m,T),O=Math.sqrt(A*A+E*E+S*S),I=Math.sign(v+o),R=Math.sign(p+c),y=Math.sign(m+u),M=Math.sign(g+d),w=Math.sign(_+h),N=Math.sign(T+f),P=this._totalOffset;if(O<P)return t[0]-=(1-I)*P,t[1]-=(1-R)*P,t[2]-=(1-y)*P,t[3]+=M*P,t[4]+=w*P,t[5]+=N*P,t;let L=P/Math.sqrt(b*b+x*x+C*C),D=P/O,H=D-L,F=-H;return t[0]+=o*(I*F+D),t[1]+=c*(R*F+D),t[2]+=u*(y*F+D),t[3]+=d*(M*H+L),t[4]+=h*(w*H+L),t[5]+=f*(N*H+L),t}applyToMbs(t){let s=(0,f.l)((0,p.a)(t)),o=this._totalOffset/s;return(0,f.b)((0,p.a)(this._tmpMbs),(0,p.a)(t),(0,p.a)(t),o),this._tmpMbs[3]=t[3]+t[3]*this._totalOffset/s,this._tmpMbs}applyToObb(t){return(0,g.gm)(t,this._totalOffset,this._totalOffset,m.RT.Global,this._tmpObb),this._tmpObb}}class S{constructor(t=0){this.offset=t,this.sphere=(0,p.c)(),this.tmpVertex=(0,v.vt)()}applyToVertex(t,s,o){let c=this.objectTransform.transform,u=(0,f.i)(C,t,s,o),d=(0,f.t)(u,u,c),h=this.offset/(0,f.l)(d);(0,f.b)(d,d,d,h);let v=this.objectTransform.inverse;return(0,f.t)(this.tmpVertex,d,v),this.tmpVertex}applyToMinMax(t,s){let o=this.offset/(0,f.l)(t);(0,f.b)(t,t,t,o);let c=this.offset/(0,f.l)(s);(0,f.b)(s,s,s,c)}applyToAabb(t){let s=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*s,t[1]+=t[1]*s,t[2]+=t[2]*s;let o=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*o,t[4]+=t[4]*o,t[5]+=t[5]*o,t}applyToBoundingSphere(t){let s=(0,f.l)((0,p.a)(t)),o=this.offset/s;return(0,f.b)((0,p.a)(this.sphere),(0,p.a)(t),(0,p.a)(t),o),this.sphere[3]=t[3]+t[3]*this.offset/s,this.sphere}}let b=new S;function x(t){return null!=t?(b.offset=t,b):null}new E,new A;let C=(0,v.vt)(),O=(0,v.vt)(),I=(0,v.vt)(),R=(0,v.vt)(),y=(0,v.vt)()},17323:(t,s,o)=>{o.d(s,{Q:()=>g});var c=o(75769),u=o(4538),d=o(86416),h=o(2907),f=o(73024);class v extends f.n{constructor(t,s){super(t,"ivec2",h.c.Bind,(o,c)=>o.setUniform2iv(t,s(c)))}}var p=o(25743),m=o(70762);function g(t,s){let{fragment:o}=t;s.output===u.V.Highlight?(o.uniforms.add(new m.x("depthTexture",t=>t.mainDepth),new m.x("highlightTexture",t=>t.highlightMixTexture),new p.W("highlightLevel",t=>t.highlightLevel??0),new v("highlightMixOrigin",t=>t.highlightMixOrigin)),t.outputs.add("fragHighlight","vec2",0),t.include(c.y),o.code.add((0,d.H)`vec2 getAccumulatedHighlight() {
return texelFetch(highlightTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = vec2(float(bits) / 255.0, 0.0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
vec2 combinedHighlight = getAccumulatedHighlight();
uint accumulatedI = uint(combinedHighlight[li] * 255.0);
combinedHighlight[li] = float(bits | accumulatedI) / 255.0;
fragHighlight = combinedHighlight;
}
}
bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}
void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`),s.canHaveOverlay&&o.code.add((0,d.H)`void calculateOcclusionAndOutputHighlightOverlay(vec2 highlightToAdd) {
uint levelBits = readLevelBits(highlightToAdd, highlightLevel);
if ((levelBits & 1u) == 0u) { discard; }
outputHighlight(isHighlightOccluded());
}`)):o.code.add((0,d.H)`void calculateOcclusionAndOutputHighlight() {}`)}},17914:(t,s,o)=>{let c;o.d(s,{g:()=>q}),o(57845);var u,d=o(32391),h=o(74652),f=o(40941),v=o(92753),p=o(48678),m=o(90525),g=o(49216),_=o(48671),T=o(18189),A=o(81048),E=o(78724),S=o(93446),b=o(87155),x=o(90040);let C=null,O=null;async function I(){return null==O&&(O=c??=(async()=>{let t=await o.e(1740).then(o.bind(o,61740)),s=await t.default({locateFile:t=>(0,A.s)(`esri/libs/basisu/${t}`)});return s.initializeBasis(),s})(),C=await O),O}function R(t,s,o,c,u){return Math.ceil(o*c*(0,x.IB)(s?S.CQ.COMPRESSED_RGBA8_ETC2_EAC:S.CQ.COMPRESSED_RGB8_ETC2)*(u&&t>1?(4**t-1)/(3*4**(t-1)):1))}function y(t){return t.getNumImages()>=1&&!t.isUASTC()}function M(t){return t.getFaces()>=1&&t.isETC1S()}async function w(t,s,o){null==C&&(C=await I());let c=new C.BasisFile(new Uint8Array(o));if(!y(c))return null;c.startTranscoding();let u=P(t,s,c.getNumLevels(0),c.getHasAlpha(),c.getImageWidth(0,0),c.getImageHeight(0,0),(t,s)=>c.getImageTranscodedSizeInBytes(0,t,s),(t,s,o)=>c.transcodeImage(o,0,t,s,0,0));return c.close(),c.delete(),u}async function N(t,s,o){null==C&&(C=await I());let c=new C.KTX2File(new Uint8Array(o));if(!M(c))return null;c.startTranscoding();let u=P(t,s,c.getLevels(),c.getHasAlpha(),c.getWidth(),c.getHeight(),(t,s)=>c.getImageTranscodedSizeInBytes(t,0,0,s),(t,s,o)=>c.transcodeImage(o,t,0,0,s,0,-1,-1));return c.close(),c.delete(),u}function P(t,s,o,c,u,d,h,f){let{compressedTextureETC:v,compressedTextureS3TC:p}=t.capabilities,[m,g]=v?c?[E.n.ETC2_RGBA,S.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[E.n.ETC1_RGB,S.CQ.COMPRESSED_RGB8_ETC2]:p?c?[E.n.BC3_RGBA,S.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[E.n.BC1_RGB,S.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT]:[E.n.RGBA32,S.Ab.RGBA],_=s.hasMipmap?o:Math.min(1,o),T=[];for(let t=0;t<_;t++)T.push(new Uint8Array(h(t,m))),f(t,m,T[t]);return s.internalFormat=g,s.hasMipmap=T.length>1,s.samplingMode=s.hasMipmap?S.Cj.LINEAR_MIPMAP_LINEAR:S.Cj.LINEAR,s.width=u,s.height=d,new b.g(t,s,{type:"compressed",levels:T})}var L=o(19069),D=o(74405),H=o(61939);let F=()=>H.A.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function B(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}let z=B("DXT1"),U=B("DXT3"),V=B("DXT5");var W=o(817),G=o(97681),k=o(15494);class q extends L.J{constructor(t,s){super(),this._data=t,this.type=D.X.Texture,this.events=new h.A,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this._parameters={...Y,...s},this._startPreload(t)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(t){null!=t&&(t instanceof HTMLVideoElement?(this.frameUpdate=s=>this._frameUpdate(t,s),this._startPreloadVideoElement(t)):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!((0,m.w8)(t.src)||"auto"===t.preload&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";let s=!t.paused;if(t.src=t.src,s&&t.autoplay){let s=()=>{t.removeEventListener("canplay",s),t.play()};t.addEventListener("canplay",s)}}}_startPreloadImageElement(t){(0,m.DB)(t.src)||(0,m.w8)(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}_createDescriptor(t){let s=new k.R;return s.wrapMode=this._parameters.wrap??S.pF.REPEAT,s.flipped=!this._parameters.noUnpackFlip,s.samplingMode=this._parameters.mipmap?S.Cj.LINEAR_MIPMAP_LINEAR:S.Cj.LINEAR,s.hasMipmap=!!this._parameters.mipmap,s.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,s.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?t.parameters.maxMaxAnisotropy:1),s}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||function(t,s){if(null==t)return 0;if((0,p.mw)(t)||(0,p.mg)(t))return s.encoding===T.JS.KTX2_ENCODING?function(t,s){if(null==C)return t.byteLength;let o=new C.KTX2File(new Uint8Array(t)),c=M(o)?R(o.getLevels(),o.getHasAlpha(),o.getWidth(),o.getHeight(),s):0;return o.close(),o.delete(),c}(t,!!s.mipmap):s.encoding===T.JS.BASIS_ENCODING?function(t,s){if(null==C)return t.byteLength;let o=new C.BasisFile(new Uint8Array(t)),c=y(o)?R(o.getNumLevels(0),o.getHasAlpha(),o.getImageWidth(0,0),o.getImageHeight(0,0),s):0;return o.close(),o.delete(),c}(t,!!s.mipmap):t.byteLength;let{width:o,height:c}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?j(t):s;return(s.mipmap?4/3:1)*o*c*(s.components||4)||0}(this._data,this._parameters)}load(t){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;let s=this._data;return null==s?(this._glTexture=new b.g(t,this._createDescriptor(t),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),"string"==typeof s?this._loadFromURL(t,s):s instanceof Image?this._loadFromImageElement(t,s):s instanceof HTMLVideoElement?this._loadFromVideoElement(t,s):s instanceof ImageData||s instanceof HTMLCanvasElement?this._loadFromImage(t,s):(0,p.mg)(s)&&this._parameters.encoding===T.JS.DDS_ENCODING?this._loadFromDDSData(t,s):(0,p.mw)(s)&&this._parameters.encoding===T.JS.DDS_ENCODING?this._loadFromDDSData(t,new Uint8Array(s)):((0,p.mw)(s)||(0,p.mg)(s))&&this._parameters.encoding===T.JS.KTX2_ENCODING?this._loadFromKTX2(t,s):((0,p.mw)(s)||(0,p.mg)(s))&&this._parameters.encoding===T.JS.BASIS_ENCODING?this._loadFromBasis(t,s):(0,p.mg)(s)?this._loadFromPixelData(t,s):(0,p.mw)(s)?this._loadFromPixelData(t,new Uint8Array(s)):null)}_frameUpdate(t,s){return null==this._glTexture||t.readyState<u.HAVE_CURRENT_DATA||s===t.currentTime?s:(this._glTexture.setData(t),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),t.currentTime)}_loadFromDDSData(t,s){return this._glTexture=function(t,s,o){let c=function(t,s){let o,c,u,d=new Int32Array(t.buffer,t.byteOffset,31);if(0x20534444!==d[0])return F().error("Invalid magic number in DDS header"),null;if(!(4&d[20]))return F().error("Unsupported format, must contain a FourCC code"),null;let h=d[21];switch(h){case z:o=8,c=S.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case U:o=16,c=S.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case V:o=16,c=S.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return F().error("Unsupported FourCC code:",String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255)),null}let f=1,v=d[4],p=d[3];(3&v||3&p)&&(F().warn("Rounding up compressed texture size to nearest multiple of 4."),v=v+3&-4,p=p+3&-4);let m=v,g=p;131072&d[2]&&!1!==s&&(f=Math.max(1,d[7]));let _=t.byteOffset+d[1]+4,T=[];for(let s=0;s<f;++s)u=(v+3>>2)*(p+3>>2)*o,T.push(new Uint8Array(t.buffer,_,u)),_+=u,v=Math.max(1,v>>1),p=Math.max(1,p>>1);return{textureData:{type:"compressed",levels:T},internalFormat:c,width:m,height:g}}(o,s.hasMipmap??!1);if(null==c)throw Error("DDS texture data is null");let{textureData:u,internalFormat:d,width:h,height:f}=c;return s.samplingMode=u.levels.length>1?S.Cj.LINEAR_MIPMAP_LINEAR:S.Cj.LINEAR,s.hasMipmap=u.levels.length>1,s.internalFormat=d,s.width=h,s.height=f,new b.g(t,s,u)}(t,this._createDescriptor(t),s),this._glTexture}_loadFromKTX2(t,s){return this._loadAsync(()=>N(t,this._createDescriptor(t),s).then(t=>(this._glTexture=t,t)))}_loadFromBasis(t,s){return this._loadAsync(()=>w(t,this._createDescriptor(t),s).then(t=>(this._glTexture=t,t)))}_loadFromPixelData(t,s){(0,G.vA)(this._parameters.width>0&&this._parameters.height>0);let o=this._createDescriptor(t);return o.pixelFormat=1===this._parameters.components?S.Ab.LUMINANCE:3===this._parameters.components?S.Ab.RGB:S.Ab.RGBA,o.width=this._parameters.width??0,o.height=this._parameters.height??0,this._glTexture=new b.g(t,o,s),this._glTexture}_loadFromURL(t,s){return this._loadAsync(async o=>{let c=await (0,g.D)(s,{signal:o});return(0,v.Te)(o),this._loadFromImage(t,c)})}_loadFromImageElement(t,s){return s.complete?this._loadFromImage(t,s):this._loadAsync(async o=>{let c=await (0,_.Sx)(s,s.src,!1,o);return(0,v.Te)(o),this._loadFromImage(t,c)})}_loadFromVideoElement(t,s){return s.readyState>=u.HAVE_CURRENT_DATA?this._loadFromImage(t,s):this._loadFromVideoElementAsync(t,s)}_loadFromVideoElementAsync(t,s){return this._loadAsync(o=>new Promise((c,h)=>{let p=()=>{s.removeEventListener("loadeddata",m),s.removeEventListener("error",g),(0,f.xt)(_)},m=()=>{s.readyState>=u.HAVE_CURRENT_DATA&&(p(),c(this._loadFromImage(t,s)))},g=t=>{p(),h(t||new d.A("Failed to load video"))};s.addEventListener("loadeddata",m),s.addEventListener("error",g);let _=(0,v.u7)(o,()=>g((0,v.NK)()))}))}_loadFromImage(t,s){let o=s;if(!(o instanceof HTMLVideoElement)){let{maxTextureSize:s}=t.parameters;o=this._parameters.downsampleUncompressed?(0,W.IR)(o,s):(0,W.vM)(o,s)}let c=j(o);this._parameters.width=c.width,this._parameters.height=c.height;let u=this._createDescriptor(t);return u.pixelFormat=3===this._parameters.components?S.Ab.RGB:S.Ab.RGBA,u.width=c.width,u.height=c.height,u.shouldCompress=this._parameters.shouldCompress,this._glTexture=new b.g(t,u,o),this._glTexture}_loadAsync(t){let s=new AbortController;this._loadingController=s;let o=t(s.signal);this._loadingPromise=o;let c=()=>{this._loadingController===s&&(this._loadingController=null),this._loadingPromise===o&&(this._loadingPromise=null)};return o.then(c,c),o}unload(){if(this._glTexture=(0,f.WD)(this._glTexture),null!=this._loadingController){let t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}}function j(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}!function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(u||(u={}));let Y={wrap:{s:S.pF.REPEAT,t:S.pF.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1,shouldCompress:!1}},18189:(t,s,o)=>{var c,u,d,h,f,v,p,m;o.d(s,{Am:()=>h,C7:()=>d,JS:()=>m,Mg:()=>v,dd:()=>f,it:()=>u,s2:()=>c,sf:()=>p}),function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"}(c||(c={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(u||(u={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(d||(d={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(h||(h={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(f||(f={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee"}(v||(v={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(p||(p={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(m||(m={}))},18945:(t,s,o)=>{o.d(s,{C:()=>p,Cr:()=>g,H6:()=>E,_I:()=>T,dz:()=>S,fA:()=>m,kb:()=>_,ld:()=>b,sd:()=>A,vt:()=>v});var c=o(20538),u=o(17656),d=o(63599),h=o(56911),f=o(42378);function v(t){return t?{origin:(0,h.o8)(t.origin),vector:(0,h.o8)(t.vector)}:{origin:(0,h.vt)(),vector:(0,h.vt)()}}function p(t,s=v()){return m(t.origin,t.vector,s)}function m(t,s,o=v()){return(0,d.c)(o.origin,t),(0,d.c)(o.vector,s),o}function g(t,s,o=v()){return(0,d.c)(o.origin,t),(0,d.d)(o.vector,s,t),o}function _(t,s){let o=(0,d.d)(f.rq.get(),s,t.origin),u=(0,d.f)(t.vector,o),h=(0,d.f)(t.vector,t.vector),v=(0,c.qE)(u/h,0,1),p=(0,d.d)(f.rq.get(),(0,d.h)(f.rq.get(),t.vector,v),o);return(0,d.f)(p,p)}function T(t,s,o){return E(t,s,0,1,o)}function A(t,s,o){return(0,d.g)(o,t.origin,(0,d.h)(o,t.vector,s))}function E(t,s,o,u,h){let{vector:v,origin:p}=t,m=(0,d.d)(f.rq.get(),s,p),g=(0,d.f)(v,m)/(0,d.k)(v);return(0,d.h)(h,v,(0,c.qE)(g,o,u)),(0,d.g)(h,h,t.origin)}function S(t,s){if(x(t,function(t,s){let o=O.get();return o.origin=t,o.vector=s,o}(s.origin,s.direction),!1,C)){let{tA:s,pB:o,distance2:c}=C;if(s>=0&&s<=1)return c;if(s<0)return(0,d.s)(t.origin,o);if(s>1)return(0,d.s)((0,d.g)(f.rq.get(),t.origin,t.vector),o)}return null}function b(t,s,o){return!!x(t,s,!0,C)&&((0,d.c)(o,C.pA),!0)}function x(t,s,o,u){let h=t.origin,v=(0,d.g)(f.rq.get(),h,t.vector),p=s.origin,m=(0,d.g)(f.rq.get(),p,s.vector),g=f.rq.get(),_=f.rq.get();if(g[0]=h[0]-p[0],g[1]=h[1]-p[1],g[2]=h[2]-p[2],_[0]=m[0]-p[0],_[1]=m[1]-p[1],_[2]=m[2]-p[2],1e-6>Math.abs(_[0])&&1e-6>Math.abs(_[1])&&1e-6>Math.abs(_[2]))return!1;let T=f.rq.get();if(T[0]=v[0]-h[0],T[1]=v[1]-h[1],T[2]=v[2]-h[2],1e-6>Math.abs(T[0])&&1e-6>Math.abs(T[1])&&1e-6>Math.abs(T[2]))return!1;let A=g[0]*_[0]+g[1]*_[1]+g[2]*_[2],E=_[0]*T[0]+_[1]*T[1]+_[2]*T[2],S=g[0]*T[0]+g[1]*T[1]+g[2]*T[2],b=_[0]*_[0]+_[1]*_[1]+_[2]*_[2],x=(T[0]*T[0]+T[1]*T[1]+T[2]*T[2])*b-E*E;if(1e-6>Math.abs(x))return!1;let C=(A*E-S*b)/x,O=(A+E*C)/b;o&&(C=(0,c.qE)(C,0,1),O=(0,c.qE)(O,0,1));let I=f.rq.get(),R=f.rq.get();return I[0]=h[0]+C*T[0],I[1]=h[1]+C*T[1],I[2]=h[2]+C*T[2],R[0]=p[0]+O*_[0],R[1]=p[1]+O*_[1],R[2]=p[2]+O*_[2],u.tA=C,u.tB=O,u.pA=I,u.pB=R,u.distance2=(0,d.s)(I,R),!0}let C={tA:0,tB:0,pA:(0,h.vt)(),pB:(0,h.vt)(),distance2:0},O=new u.I(()=>v())},18977:(t,s,o)=>{o.d(s,{E:()=>f});var c=o(54036),u=o(35430),d=o(43417),h=o(86416);function f(t){t.uniforms.add(new d.E("zProjectionMap",t=>(function(t){let s=t.projectionMatrix;return(0,c.hZ)(v,s[14],s[10])})(t.camera))),t.code.add((0,h.H)`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add((0,h.H)`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add((0,h.H)`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}let v=(0,u.vt)()},19039:(t,s,o)=>{o.d(s,{JG:()=>p,Uy:()=>g,Wb:()=>y,Z$:()=>A,b_:()=>E});var c=o(63599),u=o(56911),d=o(42845),h=o(74405),f=o(97681),v=o(53041);class p{constructor(t=!1,s=!0){this.isVerticalRay=t,this.normalRequired=s}}let m=(0,d.vt)();function g(t,s,o,u,g,A){if(!t.visible)return;let E=(0,c.a)(N,u,o),b=(t,s,o)=>{A(t,o,s,!1)},x=new p(!1,s.options.normalRequired);if(t.boundingInfo){(0,f.vA)(t.type===h.X.Mesh);let u=s.tolerance;!function t(s,o,u,h,f,v,p){var g,A;if(null==s)return;let E=(g=u,A=_,(0,c.i)(A,1/g[0],1/g[1],1/g[2]));if((0,d.Ne)(m,s.bbMin),(0,d.vI)(m,s.bbMax),null!=f&&f.applyToAabb(m),y(m,o,E,h)){let{primitiveIndices:c,position:d}=s,m=c?c.length:d.indices.length/3;if(m>M){let c=s.getChildren();if(void 0!==c){for(let s of c)t(s,o,u,h,f,v,p);return}}!function(t,s,o,c,u,d,h,f,v,p,m){let g=t[0],_=t[1],A=t[2],E=s[0],S=s[1],b=s[2],{normalRequired:x}=p;for(let t=0;t<c;++t){let s=f[t],o=3*s,c=h*u[o],p=d[c],C=d[c+1],I=d[c+2],R=h*u[o+1],y=d[R],M=d[R+1],N=d[R+2],P=h*u[o+2],L=d[P],D=d[P+1],H=d[P+2];null!=v&&([p,C,I]=v.applyToVertex(p,C,I,t),[y,M,N]=v.applyToVertex(y,M,N,t),[L,D,H]=v.applyToVertex(L,D,H,t));let F=y-p,B=M-C,z=N-I,U=L-p,V=D-C,W=H-I,G=S*W-V*b,k=b*U-W*E,q=E*V-U*S,j=F*G+B*k+z*q;if(Math.abs(j)<=w)continue;let Y=g-p,$=_-C,X=A-I,Z=Y*G+$*k+X*q;if(j>0){if(Z<0||Z>j)continue}else if(Z>0||Z<j)continue;let K=$*z-B*X,Q=X*F-z*Y,J=Y*B-F*$,ee=E*K+S*Q+b*J;if(j>0){if(ee<0||Z+ee>j)continue}else if(ee>0||Z+ee<j)continue;let et=(U*K+V*Q+W*J)/j;et>=0&&m(et,s,x?O(F,B,z,U,V,W,T):null)}}(o,u,0,m,d.indices,d.data,d.stride,c,f,v,p)}}(t.boundingInfo,o,E,u,g,x,b)}else{let s=t.attributes.get(v.r.POSITION),c=s.indices;S(o,E,0,c.length/3,c,s.data,s.stride,g,x,b)}}let _=(0,u.vt)(),T=(0,u.vt)();function A(t,s,o,u,d,h,f,v,p){let{data:m,stride:g}=h;S(t,(0,c.a)(N,s,t),o,u,d,m,g,f,v,p)}function E(t,s,o,c,u,d,h,f){let v=t[0],p=t[1],m=t[2],g=s[0],_=s[1],A=s[2];for(let t=o;t<c;++t){let s=3*t,o=s+1,c=s+2,E=d*s,S=u[E],b=u[E+1],x=u[E+2],C=d*o,I=d*c,R=u[C]-S,y=u[C+1]-b,M=u[C+2]-x,N=u[I]-S,P=u[I+1]-b,L=u[I+2]-x,D=_*L-P*A,H=A*N-L*g,F=g*P-N*_,B=R*D+y*H+M*F;if(Math.abs(B)<=w)continue;let z=v-S,U=p-b,V=m-x,W=z*D+U*H+V*F;if(B>0){if(W<0||W>B)continue}else if(W>0||W<B)continue;let G=U*M-y*V,k=V*R-M*z,q=z*y-R*U,j=g*G+_*k+A*q;if(B>0){if(j<0||W+j>B)continue}else if(j>0||W+j<B)continue;let Y=(N*G+P*k+L*q)/B;Y>=0&&f(Y,t,h?O(R,y,M,N,P,L,T):null)}}function S(t,s,o,u,d,h,f,v,p,m){let g=Math.abs(s[0]),_=Math.abs(s[1]),A=Math.abs(s[2]),E=g>=_?g>=A?0:2:_>=A?1:2,S=s[E]<0?2:1,O=(E+S)%3,y=(E+(3-S))%3,M=s[O]/s[E],w=s[y]/s[E],N=1/s[E],{normalRequired:L}=p;for(let s=o;s<u;++s){var D;let o=3*s,u=f*d[o];(0,c.i)(P[0],h[u+0],h[u+1],h[u+2]);let p=f*d[o+1];(0,c.i)(P[1],h[p+0],h[p+1],h[p+2]);let g=f*d[o+2];(0,c.i)(P[2],h[g+0],h[g+1],h[g+2]),v&&((0,c.c)(P[0],v.applyToVertex(P[0][0],P[0][1],P[0][2],s)),(0,c.c)(P[1],v.applyToVertex(P[1][0],P[1][1],P[1][2],s)),(0,c.c)(P[2],v.applyToVertex(P[2][0],P[2][1],P[2][2],s))),(0,c.a)(b,P[0],t),(0,c.a)(x,P[1],t),(0,c.a)(C,P[2],t);let _=b[O]-M*b[E],A=b[y]-w*b[E],S=x[O]-M*x[E],H=x[y]-w*x[E],F=C[O]-M*C[E],B=C[y]-w*C[E],z=F*H-B*S,U=_*B-A*F,V=S*A-H*_;if((z<0||U<0||V<0)&&(z>0||U>0||V>0))continue;let W=z+U+V;if(0===W)continue;let G=z*(N*b[E])+U*(N*x[E])+V*(N*C[E]);if(G*Math.sign(W)<0)continue;let k=G/W;k>=0&&m(k,s,L?(D=P,(0,c.a)(I,D[1],D[0]),(0,c.a)(R,D[2],D[0]),(0,c.e)(T,I,R),(0,c.n)(T,T),T):null)}}let b=(0,u.vt)(),x=(0,u.vt)(),C=(0,u.vt)();function O(t,s,o,u,d,h,f){return(0,c.i)(I,t,s,o),(0,c.i)(R,u,d,h),(0,c.e)(f,I,R),(0,c.n)(f,f),f}let I=(0,u.vt)(),R=(0,u.vt)();function y(t,s,o,c){return function(t,s,o,c,u){let d=(t[0]-c-s[0])*o[0],h=(t[3]+c-s[0])*o[0],f=Math.min(d,h),v=Math.max(d,h),p=(t[1]-c-s[1])*o[1],m=(t[4]+c-s[1])*o[1];if((v=Math.min(v,Math.max(p,m)))<0||(f=Math.max(f,Math.min(p,m)))>v)return!1;let g=(t[2]-c-s[2])*o[2],_=(t[5]+c-s[2])*o[2];return!((v=Math.min(v,Math.max(g,_)))<0)&&!((f=Math.max(f,Math.min(g,_)))>v)&&f<u}(t,s,o,c,1/0)}let M=1e3,w=1e-7,N=(0,u.vt)(),P=[(0,u.vt)(),(0,u.vt)(),(0,u.vt)()]},19069:(t,s,o)=>{o.d(s,{J:()=>u});var c=o(54635);class u{constructor(){this.id=(0,c.c)()}}},20456:(t,s,o)=>{o.d(s,{d:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"vec3",c.c.Bind,(o,c)=>o.setUniform3fv(t,s(c)))}}},22045:(t,s,o)=>{var c;o.d(s,{N:()=>c}),function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.HUD_MATERIAL=12]="HUD_MATERIAL",t[t.LABEL_MATERIAL=13]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=14]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",t[t.OVERLAY=16]="OVERLAY",t[t.DRAPED_MATERIAL=17]="DRAPED_MATERIAL",t[t.DRAPED_WATER=18]="DRAPED_WATER",t[t.VOXEL=19]="VOXEL",t[t.MAX_SLOTS=20]="MAX_SLOTS"}(c||(c={}))},25576:(t,s,o)=>{o.d(s,{a:()=>u});var c=o(86416);function u(t){t.code.add((0,c.H)`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},25743:(t,s,o)=>{o.d(s,{W:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"int",c.c.Bind,(o,c)=>o.setUniform1i(t,s(c)))}}},26475:(t,s,o)=>{o.d(s,{Gd:()=>z,J_:()=>F,VC:()=>W,b3:()=>V,s_:()=>H,ul:()=>G,wI:()=>P}),o(57845);var c,u,d=o(20538),h=o(6815),f=o(3391),v=o(40998),p=o(38715),m=o(63599),g=o(56911),_=o(81713),T=o(48271),A=o(34124),E=o(73375);!function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"}(c||(c={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(u||(u={}));class S{constructor(t){this.field=t}}class b extends S{constructor(t){super(t),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[c.Undefined,c.Undefined,c.Undefined]}}class x extends S{constructor(t){super(t),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}}class C extends S{constructor(t){super(t),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class O{}function I(t){return null!=t}function R(t,s){t&&t.push(s)}function y(t,s,o,u,d){let h=t.minSize,f=t.maxSize;if(t.useSymbolValue){let t=u.symbolSize[o];return s.minSize[o]=t,s.maxSize[o]=t,s.offset[o]=s.minSize[o],s.factor[o]=0,s.type[o]=c.DefinedSize,!0}if(I(t.field))return I(t.stops)?2===t.stops.length&&(0,T.Et)(t.stops[0].size)&&(0,T.Et)(t.stops[1].size)?(M(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,s,o),s.type[o]=c.DefinedSize,!0):(R(d,"Could not convert size info: stops only supported with 2 elements"),!1):(0,T.Et)(h)&&(0,T.Et)(f)&&I(t.minDataValue)&&I(t.maxDataValue)?(M(h,f,t.minDataValue,t.maxDataValue,s,o),s.type[o]=c.DefinedSize,!0):"unknown"===t.valueUnit?(R(d,"Could not convert size info: proportional size not supported"),!1):null!=_.j[t.valueUnit]?(s.minSize[o]=-1/0,s.maxSize[o]=1/0,s.offset[o]=0,s.factor[o]=1/_.j[t.valueUnit],s.type[o]=c.DefinedSize,!0):(R(d,"Could not convert size info: scale-dependent size not supported"),!1);if(!I(t.field)){if(t.stops?.[0]&&(0,T.Et)(t.stops[0].size))return s.minSize[o]=t.stops[0].size,s.maxSize[o]=t.stops[0].size,s.offset[o]=s.minSize[o],s.factor[o]=0,s.type[o]=c.DefinedSize,!0;if((0,T.Et)(h))return s.minSize[o]=h,s.maxSize[o]=h,s.offset[o]=h,s.factor[o]=0,s.type[o]=c.DefinedSize,!0}return R(d,"Could not convert size info: unsupported variant of sizeInfo"),!1}function M(t,s,o,c,u,d){let h=Math.abs(c-o)>0?(s-t)/(c-o):0;u.minSize[d]=h>0?t:s,u.maxSize[d]=h>0?s:t,u.offset[d]=t-o*h,u.factor[d]=h}function w(t,s,o){t[4*s]=o.r/255,t[4*s+1]=o.g/255,t[4*s+2]=o.b/255,t[4*s+3]=o.a}function N(t,s,o){let c=2===o&&"arithmetic"===t.rotationType;s.offset[o]=90*!!c,s.factor[o]=c?-1:1,s.type[o]=1}class P{constructor(t,s=[1,1,1],o=[1,1,1],c=1,u=[0,0,0],d=[1,1,1],h=[0,0,0]){this.supports=t,this.modelSize=s,this.symbolSize=o,this.unitInMeters=c,this.anchor=u,this.scale=d,this.rotation=h}}function L(t,s,o){if(!t)return null;let u=t.reduce((t,c)=>{if(!t)return t;if(c.valueExpression)return R(o,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return s.supports.size?function(t,s,o,c){let u;if(t.normalizationField||t.valueRepresentation)return R(c,"Could not convert size info: unsupported property"),null;if(!(0,T.CO)(t.field))return R(c,"Could not convert size info: field is not a string"),null;if(s.size){if(t.field)if(s.size.field){if(t.field!==s.size.field)return R(c,"Could not convert size info: multiple fields in use"),null}else s.size.field=t.field}else s.size=new b(t.field);switch(t.axis){case"width":return(u=y(t,s.size,0,o,c))?s:null;case"height":return(u=y(t,s.size,2,o,c))?s:null;case"depth":return(u=y(t,s.size,1,o,c))?s:null;case"width-and-depth":return(u=y(t,s.size,0,o,c))&&y(t,s.size,1,o,c),u?s:null;case null:case void 0:case"all":return(u=(u=(u=y(t,s.size,0,o,c))&&y(t,s.size,1,o,c))&&y(t,s.size,2,o,c))?s:null;default:return R(c,`Could not convert size info: unknown axis "${t.axis}""`),null}}(c,t,s,o):t;case"color":return s.supports.color?function(t,s,o){if(t.normalizationField)return R(o,"Could not convert color info: unsupported property"),null;if((0,T.Kg)(t.field)){if(!t.stops)return R(o,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return R(o,"Could not convert color info: too many color stops"),null;s.color=new x(t.field);let c=t.stops;for(let t=0;t<8;++t){let o=c[Math.min(t,c.length-1)];s.color.values[t]=o.value,w(s.color.colors,t,o.color)}}}else{if(!(t.stops&&t.stops.length>=0))return R(o,"Could not convert color info: no field and no colors/stops"),null;{let o=t.stops&&t.stops.length>=0&&t.stops[0].color;s.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let t=0;t<8;t++)s.color.values[t]=1/0,w(s.color.colors,t,o)}}return s}(c,t,o):t;case"opacity":return s.supports.opacity?function(t,s,o){if(t.normalizationField)return R(o,"Could not convert opacity info: unsupported property"),null;if((0,T.Kg)(t.field)){if(!t.stops)return R(o,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return R(o,"Could not convert opacity info: too many opacity stops"),null;s.opacity=new C(t.field);let c=t.stops;for(let t=0;t<8;++t){let o=c[Math.min(t,c.length-1)];s.opacity.values[t]=o.value,s.opacity.opacityValues[t]=o.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return R(o,"Could not convert opacity info: no field and no opacities/stops"),null;{let o=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;s.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let t=0;t<8;t++)s.opacity.values[t]=1/0,s.opacity.opacityValues[t]=o}}return s}(c,t,o):null;case"rotation":return s.supports.rotation?function(t,s,o){if(!(0,T.Kg)(t.field))return R(o,"Could not convert rotation info: field is not a string"),null;if(s.rotation){if(t.field)if(s.rotation.field){if(t.field!==s.rotation.field)return R(o,"Could not convert rotation info: multiple fields in use"),null}else s.rotation.field=t.field}else s.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return N(t,s.rotation,0),s;case"roll":return N(t,s.rotation,1),s;case null:case void 0:case"heading":return N(t,s.rotation,2),s;default:return R(o,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}(c,t,o):t;default:return null}},new O);return!(t.length>0&&u)||u.size||u.color||u.opacity||u.rotation?u?.size&&!function(t,s,o){let u;for(let o=0;o<3;++o){let u=s.unitInMeters;t.type[o]===c.DefinedSize&&(u*=s.modelSize[o],t.type[o]=c.DefinedScale),t.minSize[o]=t.minSize[o]/u,t.maxSize[o]=t.maxSize[o]/u,t.offset[o]=t.offset[o]/u,t.factor[o]=t.factor[o]/u}if(t.type[0]!==c.Undefined)u=0;else if(t.type[1]!==c.Undefined)u=1;else{if(t.type[2]===c.Undefined)return R(o,"No size axis contains a valid size or scale"),!1;u=2}for(let s=0;s<3;++s)t.type[s]===c.Undefined&&(t.minSize[s]=t.minSize[u],t.maxSize[s]=t.maxSize[u],t.offset[s]=t.offset[u],t.factor[s]=t.factor[u],t.type[s]=t.type[u]);return!0}(u.size,s,o)?null:u:null}class D{constructor(t,s,o){this.visualVariables=t,this.materialParameters=s,this.requiresShaderTransformation=o}}function H(t,s){if(!t||A.b.TESTS_DISABLE_FAST_UPDATES)return null;let o=L(t.visualVariables,s);return o?new D(o,U(o,s),!!o.size):null}function F(t,s,o){if(!s||!t)return!1;let c=t.visualVariables,u=L(s.visualVariables,o);return!!u&&!!(B(c.size,u.size,"size")&&B(c.color,u.color,"color")&&B(c.rotation,u.rotation,"rotation")&&B(c.opacity,u.opacity,"opacity"))&&(t.visualVariables=u,t.materialParameters=U(u,o),t.requiresShaderTransformation=!!u.size,!0)}function B(t,s,o){if(!!t!=!!s||t&&t.field!==s?.field)return!1;if(t&&"rotation"===o){for(let o=0;o<3;o++)if(t.type[o]!==s.type[o]||t.offset[o]!==s.offset[o]||t.factor[o]!==s.factor[o])return!1}return!0}class z extends E.Y{constructor(t){super(),this.vvSize=t?.size??null,this.vvColor=t?.color??null,this.vvOpacity=t?.opacity??null}}function U(t,s){let o=new z(t);return o.vvSize&&(o.vvSymbolAnchor=s.anchor,(0,v.D_)(j),function(t,s,o,c=(0,p.vt)()){let u=t||0,d=s||0,h=o||0;0!==u&&(0,v.Qr)(c,c,-u/180*Math.PI),0!==d&&(0,v.eL)(c,c,d/180*Math.PI),0!==h&&(0,v.Z8)(c,c,h/180*Math.PI)}(s.rotation[2],s.rotation[0],s.rotation[1],j),o.vvSymbolRotationMatrix=o.vvSymbolRotationMatrix||(0,f.vt)(),(0,h.z0)(o.vvSymbolRotationMatrix,j)),o}function V(t,s,o){if(!t.vvSize)return o;(0,v.C)(k,o);let c=t.vvSymbolRotationMatrix;(0,v.hZ)(j,c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,0,0,0,1),(0,v.lw)(k,k,j);for(let o=0;o<3;++o){let c=t.vvSize.offset[o]+s[0]*t.vvSize.factor[o];q[o]=(0,d.qE)(c,t.vvSize.minSize[o],t.vvSize.maxSize[o])}return(0,v.hs)(k,k,q),(0,v.Tl)(k,k,t.vvSymbolAnchor),k}function W(t,s,o){if(!s.vvSize)return(0,m.i)(t,1,1,1),t;for(let c=0;c<3;++c){let u=s.vvSize.offset[c]+o[0]*s.vvSize.factor[c];t[c]=(0,d.qE)(u,s.vvSize.minSize[c],s.vvSize.maxSize[c])}return t}function G(t,s){let o=null==t?0:s.attributes[t];return"number"==typeof o&&isFinite(o)?o:0}let k=(0,p.vt)(),q=(0,g.vt)(),j=(0,p.vt)()},26847:(t,s,o)=>{o.d(s,{I:()=>c,U:()=>f});var c,u=o(28255),d=o(86416),h=o(53041);function f(t,s){switch(s.textureCoordinateType){case c.Default:return t.attributes.add(h.r.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add((0,d.H)`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case c.Compressed:return t.attributes.add(h.r.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add((0,d.H)`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case c.Atlas:return t.attributes.add(h.r.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(h.r.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add((0,d.H)`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:(0,u.Xb)(s.textureCoordinateType);case c.None:return void t.vertex.code.add((0,d.H)`void forwardTextureCoordinates() {}`);case c.COUNT:return}}!function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"}(c||(c={}))},28097:(t,s,o)=>{o.d(s,{k:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"mat3",c.c.Pass,(o,c,u)=>o.setUniformMatrix3fv(t,s(c,u)))}}},30066:(t,s,o)=>{o.d(s,{NL:()=>_,ZX:()=>c});var c,u=o(4538),d=o(94934),h=o(47947),f=o(70058),v=o(86416),p=o(717),m=o(5012);o(88936);var g=o(2907);function _(t,s){if(!(0,u.RN)(s.output))return;let{emissionSource:o,hasEmissiveTextureTransform:_,bindType:T}=s,A=o===c.Texture;A&&(t.include(d.r,s),t.fragment.uniforms.add(T===g.c.Pass?new m.N("texEmission",t=>t.textureEmissive):new p.o("texEmission",t=>t.textureEmissive)));let E=o===c.Value||A;E&&t.fragment.uniforms.add(T===g.c.Pass?new f.t("emissionFactor",t=>t.emissiveFactor):new h.W("emissionFactor",t=>t.emissiveFactor)),t.fragment.code.add((0,v.H)`
    vec4 getEmissions() {
      vec4 emissions = ${E?"vec4(emissionFactor, 1.0)":"vec4(0.0)"};
      ${(0,v.If)(A,`emissions *= textureLookup(texEmission, ${_?"emissiveUV":"vuv0"});
         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)}
      return emissions;
    }
  `)}!function(t){t[t.None=0]="None",t[t.Value=1]="Value",t[t.Texture=2]="Texture",t[t.COUNT=3]="COUNT"}(c||(c={}))},31357:(t,s,o)=>{o.d(s,{EM:()=>b,dO:()=>S,em:()=>E});var c=o(3391),u=o(38715),d=o(56911),h=o(69201),f=o(98684),v=o(47947),p=o(70058),m=o(86416),g=o(87156),_=o(28097),T=o(56978),A=o(73375);function E(t,s){t.include(h.I);let o=t.vertex;o.include(f.u,s),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),o.uniforms.add(new p.t("transformWorldFromViewTH",t=>t.transformWorldFromViewTH),new p.t("transformWorldFromViewTL",t=>t.transformWorldFromViewTL),new _.k("transformViewFromCameraRelativeRS",t=>t.transformViewFromCameraRelativeRS),new T.X("transformProjFromView",t=>t.transformProjFromView),new g.h("transformWorldFromModelRS",t=>t.transformWorldFromModelRS),new v.W("transformWorldFromModelTH",t=>t.transformWorldFromModelTH),new v.W("transformWorldFromModelTL",t=>t.transformWorldFromModelTL)),o.code.add((0,m.H)`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),o.code.add((0,m.H)`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${s.spherical?(0,m.H)`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:(0,m.H)`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new p.t("transformWorldFromViewTL",t=>t.transformWorldFromViewTL)),o.code.add((0,m.H)`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add((0,m.H)`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class S extends A.Y{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,d.vt)(),this.transformWorldFromViewTL=(0,d.vt)(),this.transformViewFromCameraRelativeRS=(0,c.vt)(),this.transformProjFromView=(0,u.vt)()}}class b extends A.Y{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,c.vt)(),this.transformWorldFromModelTH=(0,d.vt)(),this.transformWorldFromModelTL=(0,d.vt)()}}},34124:(t,s,o)=>{o.d(s,{b:()=>v});var c=o(81856),u=o(28690),d=o(91838);o(57845),o(61939),o(33638);var h=o(12709);let f=class extends u.A{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,c._)([(0,d.MZ)()],f.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"LABELS_SHOW_BORDER",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"TEXT_SHOW_BASELINE",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"TEXT_SHOW_BORDER",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"SHOW_POI",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,c._)([(0,d.MZ)()],f.prototype,"LINE_WIREFRAMES",void 0);let v=new(f=(0,c._)([(0,h.$)("esri.views.3d.support.debugFlags")],f))},38220:(t,s,o)=>{o.d(s,{$p:()=>u,Qx:()=>h,_y:()=>d,e_:()=>f});var c=o(56911);class u{constructor(t=(0,c.Ul)()){this.intensity=t}}class d{constructor(t=(0,c.Ul)(),s=(0,c.fA)(.57735,.57735,.57735)){this.intensity=t,this.direction=s}}class h{constructor(t=(0,c.Ul)(),s=(0,c.fA)(.57735,.57735,.57735),o=!0,u=1,d=1){this.intensity=t,this.direction=s,this.castShadows=o,this.specularStrength=u,this.environmentStrength=d}}class f{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},40389:(t,s,o)=>{o.d(s,{j:()=>f});var c=o(87196),u=o(63599),d=o(56911),h=o(97681);class f{constructor(t,s,o){this.primitiveIndices=t,this._numIndexPerPrimitive=s,this.position=o,this._children=void 0,(0,h.vA)(t.length>=1),(0,h.vA)(3===o.size||4===o.size);let{data:c,size:f,indices:p}=o;(0,h.vA)(p.length%this._numIndexPerPrimitive==0),(0,h.vA)(p.length>=t.length*this._numIndexPerPrimitive);let m=t.length,g=f*p[this._numIndexPerPrimitive*t[0]];v.clear(),v.push(g);let _=(0,d.fA)(c[g],c[g+1],c[g+2]),T=(0,d.o8)(_);for(let s=0;s<m;++s){let o=this._numIndexPerPrimitive*t[s];for(let t=0;t<this._numIndexPerPrimitive;++t){g=f*p[o+t],v.push(g);let s=c[g];_[0]=Math.min(s,_[0]),T[0]=Math.max(s,T[0]),s=c[g+1],_[1]=Math.min(s,_[1]),T[1]=Math.max(s,T[1]),s=c[g+2],_[2]=Math.min(s,_[2]),T[2]=Math.max(s,T[2])}}this.bbMin=_,this.bbMax=T;let A=(0,u.m)((0,d.vt)(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(T[0]-_[0],T[1]-_[1]),T[2]-_[2]);let E=this.radius*this.radius;for(let t=0;t<v.length;++t){let s=c[g=v.at(t)]-A[0],o=c[g+1]-A[1],u=c[g+2]-A[2],d=s*s+o*o+u*u;if(d<=E)continue;let h=Math.sqrt(d),f=.5*(h-this.radius);this.radius=this.radius+f,E=this.radius*this.radius;let p=f/h;A[0]+=s*p,A[1]+=o*p,A[2]+=u*p}this.center=A,v.clear()}getChildren(){if(this._children||1>=(0,u.s)(this.bbMin,this.bbMax))return this._children;let t=(0,u.m)((0,d.vt)(),this.bbMin,this.bbMax,.5),s=this.primitiveIndices.length,o=new Uint8Array(s),c=Array(8);for(let t=0;t<8;++t)c[t]=0;let{data:h,size:v,indices:p}=this.position;for(let u=0;u<s;++u){let s=0,d=this._numIndexPerPrimitive*this.primitiveIndices[u],f=v*p[d],m=h[f],g=h[f+1],_=h[f+2];for(let t=1;t<this._numIndexPerPrimitive;++t){let s=h[f=v*p[d+t]],o=h[f+1],c=h[f+2];s<m&&(m=s),o<g&&(g=o),c<_&&(_=c)}m<t[0]&&(s|=1),g<t[1]&&(s|=2),_<t[2]&&(s|=4),o[u]=s,++c[s]}let m=0;for(let t=0;t<8;++t)c[t]>0&&++m;if(m<2)return;let g=Array(8);for(let t=0;t<8;++t)g[t]=c[t]>0?new Uint32Array(c[t]):void 0;for(let t=0;t<8;++t)c[t]=0;for(let t=0;t<s;++t){let s=o[t];g[s][c[s]++]=this.primitiveIndices[t]}this._children=[];for(let t=0;t<8;++t)void 0!==g[t]&&this._children.push(new f(g[t],this._numIndexPerPrimitive,this.position));return this._children}static prune(){v.prune()}}let v=new c.A({deallocator:null})},43417:(t,s,o)=>{o.d(s,{E:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"vec2",c.c.Bind,(o,c)=>o.setUniform2fv(t,s(c)))}}},44761:(t,s,o)=>{o.d(s,{c:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"int",c.c.Pass,(o,c,u)=>o.setUniform1i(t,s(c,u)))}}},47120:(t,s,o)=>{o.d(s,{D:()=>u});var c=o(53041);let u=new Map([[c.r.POSITION,0],[c.r.NORMAL,1],[c.r.NORMALCOMPRESSED,1],[c.r.UV0,2],[c.r.COLOR,3],[c.r.COLORFEATUREATTRIBUTE,3],[c.r.SIZE,4],[c.r.TANGENT,4],[c.r.CENTEROFFSETANDDISTANCE,5],[c.r.SYMBOLCOLOR,5],[c.r.FEATUREATTRIBUTE,6],[c.r.INSTANCEFEATUREATTRIBUTE,6],[c.r.INSTANCECOLOR,7],[c.r.OBJECTANDLAYERIDCOLOR,7],[c.r.INSTANCEOBJECTANDLAYERIDCOLOR,7],[c.r.ROTATION,8],[c.r.INSTANCEMODEL,8],[c.r.INSTANCEMODELNORMAL,12],[c.r.INSTANCEMODELORIGINHI,11],[c.r.INSTANCEMODELORIGINLO,15]])},47947:(t,s,o)=>{o.d(s,{W:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"vec3",c.c.Draw,(o,c,u,d)=>o.setUniform3fv(t,s(c,u,d)))}}},48410:(t,s,o)=>{o.d(s,{Fm:()=>f,Q7:()=>v});var c=o(17656),u=o(63599),d=o(56911),h=o(18945);function f(t,s,o){let c=s[0]-t[0],u=s[1]-t[1],d=o[0]-t[0];return .5*Math.abs(c*(o[1]-t[1])-u*d)}function v(t,s,o){return(0,u.d)(p,s,t),(0,u.d)(m,o,t),.5*(0,u.l)((0,u.e)(p,p,m))}o(42378),new c.I(h.vt),new c.I(()=>(function(t){return{p0:(0,d.vt)(),p1:(0,d.vt)(),p2:(0,d.vt)()}})());let p=(0,d.vt)(),m=(0,d.vt)()},49216:(t,s,o)=>{o.d(s,{D:()=>u});var c=o(39166);async function u(t,s){let{data:o}=await (0,c.A)(t,{responseType:"image",...s});return o}},51027:(t,s,o)=>{o.d(s,{S:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"mat4",c.c.Draw,(o,c,u)=>o.setUniformMatrix4fv(t,s(c,u)))}}},51103:(t,s,o)=>{o.d(s,{p:()=>c});function c(t){t.vertex.constants.add("PI","float",3.141592653589793),t.fragment.constants.add("PI","float",3.141592653589793),t.fragment.constants.add("LIGHT_NORMALIZATION","float",.3183098861837907),t.fragment.constants.add("INV_PI","float",.3183098861837907),t.fragment.constants.add("HALF_PI","float",1.570796326794897),t.fragment.constants.add("TWO_PI","float",6.28318530717958)}},51338:(t,s,o)=>{o.d(s,{O:()=>c,b:()=>u});let c=3e5,u=5e5},51704:(t,s,o)=>{o.d(s,{d:()=>d});var c=o(15907),u=o(86416);function d(t){(0,c.i$)(t),t.vertex.code.add((0,u.H)`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add((0,u.H)`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},54126:(t,s,o)=>{o.d(s,{OH:()=>p,Y6:()=>f,pM:()=>v});var c=o(63599),u=o(56911),d=o(70058),h=o(86416);function f(t){t.vertex.code.add((0,h.H)`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add((0,h.H)`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add((0,h.H)`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add((0,h.H)`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add((0,h.H)`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add((0,h.H)`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function v(t){t.uniforms.add(new d.t("screenSizePerspective",t=>m(t.screenSizePerspective)))}function p(t){t.uniforms.add(new d.t("screenSizePerspectiveAlignment",t=>m(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function m(t){return(0,c.i)(g,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}let g=(0,u.vt)()},54971:(t,s,o)=>{var c,u;o.d(s,{OG:()=>u,hM:()=>c}),o(38715),o(26270),o(70983),!function(t){t.OPAQUE="opaque-color",t.TRANSPARENT="transparent-color",t.COMPOSITE="composite-color",t.FINAL="final-color"}(c||(c={})),function(t){t.SSAO="ssao",t.LASERLINES="laserline-color",t.ANTIALIASING="aa-color",t.HIGHLIGHTS="highlight-color",t.MAGNIFIER="magnifier-color",t.OCCLUDED="occluded-color",t.VIEWSHED="viewshed-color",t.OPAQUE_ENVIRONMENT="opaque-environment-color",t.TRANSPARENT_ENVIRONMENT="transparent-environment-color",t.FOCUSAREA="focus-area"}(u||(u={}))},56429:(t,s,o)=>{o.d(s,{a:()=>O,b:()=>Q,d:()=>C,f:()=>I,g:()=>M,h:()=>F,u:()=>R}),o(57845);var c=o(61939),u=o(20538),d=o(17656),h=o(40998),f=o(38715),v=o(63599),p=o(56911),m=o(84766),g=o(97067),_=o(18945),T=o(72500),A=o(23146),E=o(47325),S=o(42378);let b=()=>c.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class x{constructor(){this.plane=(0,T.vt)(),this.origin=(0,p.vt)(),this.basis1=(0,p.vt)(),this.basis2=(0,p.vt)()}}function C(t=k){return{plane:(0,T.vt)(t.plane),origin:(0,p.o8)(t.origin),basis1:(0,p.o8)(t.basis1),basis2:(0,p.o8)(t.basis2)}}function O(t,s=C()){return I(t.origin,t.basis1,t.basis2,s)}function I(t,s,o,c=C()){var u,d;return(0,v.c)(c.origin,t),(0,v.c)(c.basis1,s),(0,v.c)(c.basis2,o),R(c),u=c,d="fromValues()",Math.abs((0,v.f)(u.basis1,u.basis2)/((0,v.l)(u.basis1)*(0,v.l)(u.basis2)))>1e-6&&b().warn(d,"Provided basis vectors are not perpendicular"),Math.abs((0,v.f)(u.basis1,z(u)))>1e-6&&b().warn(d,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,v.f)(z(u),u.origin)-u.plane[3])>1e-6&&b().warn(d,"Plane offset is not consistent with plane origin"),c}function R(t){(0,T.mR)(t.basis2,t.basis1,t.origin,t.plane)}function y(t,s,o){t!==o&&O(t,o);let c=(0,v.h)(S.rq.get(),z(t),s);return(0,v.g)(o.origin,o.origin,c),o.plane[3]-=s,o}function M(t,s=C()){let o=(t[2]-t[0])/2,c=(t[3]-t[1])/2;return(0,v.i)(s.origin,t[0]+o,t[1]+c,0),(0,v.i)(s.basis1,o,0,0),(0,v.i)(s.basis2,0,c,0),(0,T.fA)(0,0,1,0,s.plane),s}function w(t,s,o){return!!(0,T.Ui)(t.plane,s,o)&&U(t,o)}function N(t,s,o){let c=q.get();G(t,s,c,q.get());let d=Number.POSITIVE_INFINITY;for(let h of X){let f=W(t,h,j.get()),p=S.rq.get();if((0,T.T7)(c,f,p)){let t=(0,v.o)(S.rq.get(),s.origin,p),c=Math.abs((0,u.XM)((0,v.f)(s.direction,t)));c<d&&(d=c,(0,v.c)(o,p))}}return d===Number.POSITIVE_INFINITY?P(t,s,o):o}function P(t,s,o){if(w(t,s,o))return o;let c=q.get(),u=q.get();G(t,s,c,u);let d=Number.POSITIVE_INFINITY;for(let h of X){let f=W(t,h,j.get()),p=S.rq.get();if((0,T.gv)(c,f,p)){let t=(0,A.kb)(s,p);if(!(0,T.Tj)(u,p))continue;t<d&&(d=t,(0,v.c)(o,p))}}return H(t,s.origin)<d&&L(t,s.origin,o),o}function L(t,s,o){let c=(0,T._I)(t.plane,s,S.rq.get()),u=(0,_.H6)(V(t,t.basis1),c,-1,1,S.rq.get()),d=(0,_.H6)(V(t,t.basis2),c,-1,1,S.rq.get());return(0,v.d)(o,(0,v.g)(S.rq.get(),u,d),t.origin),o}function D(t,s,o){let{origin:c,basis1:u,basis2:d}=t,h=(0,v.d)(S.rq.get(),s,c),f=(0,E.gr)(u,h),p=(0,E.gr)(d,h),m=(0,E.gr)(z(t),h);return(0,v.i)(o,f,p,m)}function H(t,s){let o=D(t,s,S.rq.get()),{basis1:c,basis2:u}=t,d=(0,v.l)(c),h=(0,v.l)(u),f=Math.max(Math.abs(o[0])-d,0),p=Math.max(Math.abs(o[1])-h,0),m=o[2];return f*f+p*p+m*m}function F(t,s){return Math.sqrt(H(t,s))}function B(t,s){let o=-t.plane[3];return(0,E.gr)(z(t),s)-o}function z(t){return(0,T.Qj)(t.plane)}function U(t,s){let o=(0,v.d)(S.rq.get(),s,t.origin),c=(0,v.k)(t.basis1),u=(0,v.k)(t.basis2),d=(0,v.f)(t.basis1,o),h=(0,v.f)(t.basis2,o);return-d-c<0&&d-c<0&&-h-u<0&&h-u<0}function V(t,s){let o=j.get();return(0,v.c)(o.origin,t.origin),(0,v.c)(o.vector,s),o}function W(t,s,o){let{basis1:c,basis2:u,origin:d}=t,h=(0,v.h)(S.rq.get(),c,s.origin[0]),f=(0,v.h)(S.rq.get(),u,s.origin[1]);(0,v.g)(o.origin,h,f),(0,v.g)(o.origin,o.origin,d);let p=(0,v.h)(S.rq.get(),c,s.direction[0]),m=(0,v.h)(S.rq.get(),u,s.direction[1]);return(0,v.h)(o.vector,(0,v.g)(p,p,m),2),o}function G(t,s,o,c){let u=z(t);(0,T.mR)(u,s.direction,s.origin,o),(0,T.mR)((0,T.Qj)(o),u,s.origin,c)}let k={plane:(0,T.vt)(),origin:(0,p.fA)(0,0,0),basis1:(0,p.fA)(1,0,0),basis2:(0,p.fA)(0,1,0)},q=new d.I(T.vt),j=new d.I(_.vt),Y=(0,p.vt)(),$=new d.I(()=>C()),X=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Z=(0,f.vt)(),K=(0,f.vt)(),Q=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:x,altitudeAt:B,axisAt:function(t,s,o,c){var u=t,d=o,h=c;switch(d){case g._.X:(0,v.c)(h,u.basis1),(0,v.n)(h,h);break;case g._.Y:(0,v.c)(h,u.basis2),(0,v.n)(h,h);break;case g._.Z:(0,v.c)(h,z(u))}return h},cameraFrustumCoverage:function(t,s){return(s-t)/s},closestPoint:P,closestPointOnSilhouette:N,copy:O,copyWithoutVerify:function(t,s){(0,v.c)(s.origin,t.origin),(0,v.c)(s.basis1,t.basis1),(0,v.c)(s.basis2,t.basis2),(0,T.C)(s.plane,t.plane)},create:C,distance:F,distance2:H,distanceToSilhouette:function(t,s){let o=Number.NEGATIVE_INFINITY;for(let c of X){let u=W(t,c,j.get()),d=(0,_.kb)(u,s);d>o&&(o=d)}return Math.sqrt(o)},elevate:y,equals:function(t,s){return(0,v.p)(t.basis1,s.basis1)&&(0,v.p)(t.basis2,s.basis2)&&(0,v.p)(t.origin,s.origin)},extrusionContainsPoint:function(t,s){return(0,T.Tj)(t.plane,s)&&U(t,s)},fromAABoundingRect:M,fromValues:I,getExtent:function(t,s){let o=t.basis1[0],c=t.basis2[1],[u,d]=t.origin;return(0,m.fA)(u-o,d-c,u+o,d+c,s)},intersectRay:w,intersectRayClosestSilhouette:function(t,s,o){if(w(t,s,o))return o;let c=N(t,s,S.rq.get());return(0,v.g)(o,s.origin,(0,v.h)(S.rq.get(),s.direction,(0,v.j)(s.origin,c)/(0,v.l)(s.direction))),o},normal:z,projectPoint:L,projectPointLocal:D,rotate:function(t,s,o,c){return t!==c&&O(t,c),(0,h.$0)(K,s,o),(0,v.t)(c.basis1,t.basis1,K),(0,v.t)(c.basis2,t.basis2,K),R(c),c},setAltitudeAt:function(t,s,o,c){let u=B(t,s),d=(0,v.h)(Y,z(t),o-u);return(0,v.g)(c,s,d),c},setExtent:function(t,s,o){return M(s,o),y(o,B(t,t.origin),o),o},transform:function(t,s,o){return t!==o&&O(t,o),(0,h.B8)(Z,s),(0,h.mg)(Z,Z),(0,v.t)(o.basis1,t.basis1,Z),(0,v.t)(o.basis2,t.basis2,Z),(0,v.t)((0,T.Qj)(o.plane),(0,T.Qj)(t.plane),Z),(0,v.t)(o.origin,t.origin,s),(0,T.mP)(o.plane,o.plane,o.origin),o},up:k,updateUnboundedPlane:R,wrap:function(t,s,o){let c=$.get();return c.origin=t,c.basis1=s,c.basis2=o,c.plane=(0,T.LV)(0,0,0,0),R(c),c}},Symbol.toStringTag,{value:"Module"}))},56978:(t,s,o)=>{o.d(s,{X:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"mat4",c.c.Pass,(o,c,u)=>o.setUniformMatrix4fv(t,s(c,u)))}}},57323:(t,s,o)=>{o.d(s,{h:()=>h,p:()=>f});var c=o(54635),u=o(18189);class d{constructor(){this.uid=(0,c.c)()}}class h extends d{constructor(t){super(),this.highlightName=t,this.channel=u.Mg.Highlight}}class f extends d{constructor(){super(...arguments),this.channel=u.Mg.MaskOccludee}}},59722:(t,s,o)=>{o.d(s,{x:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s,o){super(t,"float",c.c.Pass,(o,c,u)=>o.setUniform1fv(t,s(c,u)),o)}}},60048:(t,s,o)=>{o.d(s,{im:()=>m,m$:()=>c,qA:()=>g});var c,u=o(56911),d=o(19069),h=o(74405),f=o(47120),v=o(81605),p=o(73375);class m extends d.J{constructor(t,s){super(),this.type=h.X.Material,this.supportsEdges=!1,this._renderPriority=0,this.vertexAttributeLocations=f.D,this._pp0=(0,u.fA)(0,0,1),this._pp1=(0,u.fA)(0,0,0),this._parameters=new s,(0,v.MB)(this._parameters,t),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(t){return!1}setParameters(t,s=!0){(0,v.MB)(this._parameters,t)&&(this.validateParameters(this._parameters),s&&this._parametersChanged())}validateParameters(t){}shouldRender(t){return this.visible&&this.isVisibleForOutput(t.output)&&(!this.parameters.isDecoration||t.bind.decorations)&&!!(this.parameters.renderOccluded&t.renderOccludedMask)}isVisibleForOutput(t){return!0}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(t){return this.visible&&this.parameters.renderOccluded===t}get hasEmissions(){return!1}intersectDraped(t,s,o,c,u,d){return this._pp0[0]=this._pp1[0]=c[0],this._pp0[1]=this._pp1[1]=c[1],this.intersect(t,s,o,this._pp0,this._pp1,u)}}!function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"}(c||(c={}));class g extends p.Y{constructor(){super(...arguments),this.renderOccluded=c.Occlude,this.isDecoration=!1}}},60136:(t,s,o)=>{o.d(s,{c:()=>f,f:()=>v});var c=o(86416);function u(t){let s=t.fragment.code;s.add((0,c.H)`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),s.add((0,c.H)`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),s.add((0,c.H)`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var d=o(61456),h=o(51103);function f(t,s){let o=t.fragment.code;t.include(h.p),s.pbrMode!==d.A9.Normal&&s.pbrMode!==d.A9.Schematic&&s.pbrMode!==d.A9.Simplified&&s.pbrMode!==d.A9.TerrainWithWater||(o.add((0,c.H)`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),o.add((0,c.H)`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),s.pbrMode!==d.A9.Normal&&s.pbrMode!==d.A9.Schematic||(t.include(u),o.add((0,c.H)`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),o.add((0,c.H)`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),o.add((0,c.H)`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),o.add((0,c.H)`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function v(t,s){let o=t.fragment.code;t.include(h.p),o.add((0,c.H)`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${s.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),o.add((0,c.H)`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),o.add((0,c.H)`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),o.add((0,c.H)`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),o.add((0,c.H)`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)}},60649:(t,s,o)=>{o.d(s,{$:()=>c});class c{constructor(t,s){this._module=t,this._load=s}get(){return this._module}async reload(){return this._module=await this._load(),this._module}}},61456:(t,s,o)=>{o.d(s,{A9:()=>c,_Z:()=>_});var c,u=o(94934),d=o(47947),h=o(70058),f=o(86416),v=o(717),p=o(5012),m=o(88936),g=(o(87903),o(2907));function _(t,s){let o=s.pbrMode,m=t.fragment;if(o!==c.Schematic&&o!==c.Disabled&&o!==c.Normal)return void m.code.add((0,f.H)`void applyPBRFactors() {}`);if(o===c.Disabled)return void m.code.add((0,f.H)`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(o===c.Schematic)return void m.code.add((0,f.H)`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);let{hasMetallicRoughnessTexture:_,hasMetallicRoughnessTextureTransform:T,hasOcclusionTexture:A,hasOcclusionTextureTransform:E,bindType:S}=s;(_||A)&&t.include(u.r,s),m.code.add((0,f.H)`vec3 mrr;
float occlusion;`),_&&m.uniforms.add(S===g.c.Pass?new p.N("texMetallicRoughness",t=>t.textureMetallicRoughness):new v.o("texMetallicRoughness",t=>t.textureMetallicRoughness)),A&&m.uniforms.add(S===g.c.Pass?new p.N("texOcclusion",t=>t.textureOcclusion):new v.o("texOcclusion",t=>t.textureOcclusion)),m.uniforms.add(S===g.c.Pass?new h.t("mrrFactors",t=>t.mrrFactors):new d.W("mrrFactors",t=>t.mrrFactors)),m.code.add((0,f.H)`
    ${(0,f.If)(_,(0,f.H)`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${(0,f.If)(A,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${A?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${(0,f.If)(_,`applyMetallicRoughness(${T?"metallicRoughnessUV":"vuv0"});`)}
      ${(0,f.If)(A,`applyOcclusion(${E?"occlusionUV":"vuv0"});`)}
    }
  `)}!function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"}(c||(c={})),m.NV},61627:(t,s,o)=>{o.d(s,{G:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"vec2",c.c.Pass,(o,c,u)=>o.setUniform2fv(t,s(c,u)))}}},62809:(t,s,o)=>{o.d(s,{E:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"vec4",c.c.Pass,(o,c,u)=>o.setUniform4fv(t,s(c,u)))}}},63497:(t,s,o)=>{o.d(s,{V:()=>C});var c=o(38715),u=o(63599),d=o(95775),h=o(10240),f=o(40389),v=o(19069),p=o(74405),m=o(56911),g=o(48410);let _=(0,m.vt)(),T=(0,m.vt)(),A=(0,m.vt)(),E=(0,m.vt)();var S=o(57323),b=o(97681),x=o(53041);class C extends v.J{constructor(t,s,o=null,c=p.X.Mesh,u=null,h=-1){for(let[f,v]of(super(),this.material=t,this.mapPositions=o,this.type=c,this.objectAndLayerIdColor=u,this.edgeIndicesLength=h,this.highlights=new Set,this._highlightOptionsCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null,s))this._attributes.set(f,{...v,indices:(0,d.Dg)(v.indices)}),f===x.r.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(f).indices.length:this.edgeIndicesLength)}instantiate(t={}){let s=new C(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((t,o)=>{t.exclusive=!1,s._attributes.set(o,t)}),s._boundingInfo=this._boundingInfo,s.transformation=t.transformation||this.transformation,s}get attributes(){return this._attributes}getMutableAttribute(t){let s=this._attributes.get(t);return s&&!s.exclusive&&(s={...s,exclusive:!0,data:(0,h.S)(s.data)},this._attributes.set(t,s)),s}setAttributeData(t,s){let o=this._attributes.get(t);o&&this._attributes.set(t,{...o,exclusive:!0,data:s})}get indexCount(){let t=this._attributes.values().next().value?.indices;return t?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===p.X.Mesh?this._computeAttachmentOriginTriangles(t):this.type===p.X.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(null!=this._transformation&&(0,u.t)(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){return function(t,s){if(!t)return!1;let{size:o,data:c,indices:d}=t;(0,u.i)(s,0,0,0),(0,u.i)(E,0,0,0);let h=0,f=0;for(let t=0;t<d.length-2;t+=3){let v=d[t]*o,p=d[t+1]*o,m=d[t+2]*o;(0,u.i)(_,c[v],c[v+1],c[v+2]),(0,u.i)(T,c[p],c[p+1],c[p+2]),(0,u.i)(A,c[m],c[m+1],c[m+2]);let S=(0,g.Q7)(_,T,A);S?((0,u.g)(_,_,T),(0,u.g)(_,_,A),(0,u.h)(_,_,1/3*S),(0,u.g)(s,s,_),h+=S):((0,u.g)(E,E,_),(0,u.g)(E,E,T),(0,u.g)(E,E,A),f+=3)}return(0!==f||0!==h)&&(0!==h?((0,u.h)(s,s,1/h),!0):0!==f&&((0,u.h)(s,E,1/f),!0))}(this.attributes.get(x.r.POSITION),t)}_computeAttachmentOriginLines(t){var s,o;let c=this.attributes.get(x.r.POSITION);return function(t,s,o){if(!t)return!1;(0,u.i)(o,0,0,0),(0,u.i)(E,0,0,0);let c=0,d=0,{size:h,data:f,indices:v}=t,p=v.length-1,m=p+2*!!s;for(let t=0;t<m;t+=2){let s=t<p?t+1:0,m=v[t<p?t:p]*h,g=v[s]*h;_[0]=f[m],_[1]=f[m+1],_[2]=f[m+2],T[0]=f[g],T[1]=f[g+1],T[2]=f[g+2],(0,u.h)(_,(0,u.g)(_,_,T),.5);let A=(0,u.G)(_,T);A>0?((0,u.g)(o,o,(0,u.h)(_,_,A)),c+=A):0===c&&((0,u.g)(E,E,_),d++)}return 0!==c?((0,u.h)(o,o,1/c),!0):0!==d&&((0,u.h)(o,E,1/d),!0)}(c,(s=this.material.parameters,o=c,!(!("isClosed"in s)||!s.isClosed)&&o.indices.length>2),t)}_computeAttachmentOriginPoints(t){return function(t,s){if(!t)return!1;let{size:o,data:c,indices:d}=t;(0,u.i)(s,0,0,0);let h=-1,f=0;for(let t=0;t<d.length;t++){let u=d[t]*o;h!==u&&(s[0]+=c[u],s[1]+=c[u+1],s[2]+=c[u+2],f++),h=u}return f>1&&(0,u.h)(s,s,1/f),f>0}(this.attributes.get(x.r.POSITION),t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let t=this.attributes.get(x.r.POSITION);if(!t||0===t.indices.length)return null;let s=this.type===p.X.Mesh?3:1;(0,b.vA)(t.indices.length%s==0,"Indexing error: "+t.indices.length+" not divisible by "+s);let o=(0,d.tM)(t.indices.length/s);return new f.j(o,s,t)}get transformation(){return this._transformation??c.zK}set transformation(t){this._transformation=t&&t!==c.zK?(0,c.o8)(t):null}get highlightNames(){return this._highlightOptionsCounts}get hasHighlights(){return this._highlightOptionsCounts.size>0}foreachHighlightOptions(t){this._highlightOptionsCounts.forEach((s,o)=>t(o))}allocateIdAndHighlight(t){let s=new S.h(t);return this.addHighlight(s)}addHighlight(t){this.highlights.add(t);let{highlightName:s}=t,o=(this._highlightOptionsCounts.get(s)??0)+1;return this._highlightOptionsCounts.set(s,o),t}removeHighlight(t){if(this.highlights.delete(t)){let{highlightName:s}=t,o=this._highlightOptionsCounts.get(s)??0;o<=1?this._highlightOptionsCounts.delete(s):this._highlightOptionsCounts.set(s,o-1)}}}},64367:(t,s,o)=>{o.d(s,{MD:()=>v,cJ:()=>f,hs:()=>p,m0:()=>h});var c=o(20538);o(56429);var u=o(7916);function d(t,s,o){let c=o.parameters;return g.scale=Math.min(c.divisor/(s-c.offset),1),g.factor=Math.abs(t*t*t),g}function h(t,s){return(0,c.Cc)(t*Math.max(s.scale,s.minScaleFactor),t,s.factor)}function f(t,s,o,c){c.scale=function(t,s,o){let c=d(t,s,o);return c.minScaleFactor=0,h(1,c)}(t,s,o),c.factor=0,c.minScaleFactor=o.minScaleFactor}function v(t,s,o=[0,0]){let c=Math.min(Math.max(s.scale,s.minScaleFactor),1);return o[0]=t[0]*c,o[1]=t[1]*c,o}function p(t,s,o,c){return h(t,d(s,o,c))}o(10954);class m{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(t,s,o,c={camera:{distance:0,fovY:0},divisor:0,offset:0},u){this._viewingMode=t,this._description=s,this._ellipsoidRadius=o,this.parameters=c,this._fontHeight=u,this._viewingMode===l.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(t){return t!==this._fontHeight?new m(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,s,o){let{scaleStart:c,scaleFallOffRange:u}=this._description,{fovY:d,distance:h}=t,f=this._calculateCurvatureDependentParameters(t,s),v=this._coverageCompensation(t,s,f),{tiltAngle:p,scaleFallOffFactor:m}=f,g=Math.sin(p)*h,_=.5*Math.PI-p-d*(.5-c*v),T=g/Math.cos(_),A=(T-g/Math.cos(_+d*u*v)*m)/(1-m);return o.camera.fovY=t.fovY,o.camera.distance=t.distance,o.offset=A,o.divisor=T-A,o}_calculateCurvatureDependentParametersLocal(t,s,o=_){return o.tiltAngle=this._description.curvatureDependent.min.tiltAngle,o.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,o}_calculateCurvatureDependentParametersGlobal(t,s,o=_){let c=this._description.curvatureDependent,u=1+t.distance/s,d=Math.sqrt(u*u-1),[h,f]=[c.min.curvature,c.max.curvature],v=a((d-h)/(f-h),0,1),[p,m]=[c.min,c.max];return o.tiltAngle=e(p.tiltAngle,m.tiltAngle,v),o.scaleFallOffFactor=e(p.scaleFallOffFactor,m.scaleFallOffFactor,v),o}_surfaceCoverageCompensationLocal(t,s,o){return r(o.tiltAngle,t.fovY)}_surfaceCoverageCompensationGlobal(t,s,o){return n(T,s),i(T,o.tiltAngle,t.distance,t.fovY)}}(0,c.kU)(10),(0,c.kU)(12),(0,c.kU)(70),(0,c.kU)(40);let g={scale:0,factor:0,minScaleFactor:0},_={tiltAngle:0,scaleFallOffFactor:0},T=(0,u.c)()},67880:(t,s,o)=>{o.d(s,{I$:()=>g,a9:()=>m,m:()=>d,mK:()=>_,qh:()=>p,r8:()=>v,sf:()=>h,v0:()=>f});var c=o(18189),u=o(93446);let d={func:u.MT.LESS},h={func:u.MT.ALWAYS},f={mask:255},v={mask:0},p={function:{func:u.MT.ALWAYS,ref:c.dd.OutlineVisualElementMask,mask:c.dd.OutlineVisualElementMask},operation:{fail:u.eA.KEEP,zFail:u.eA.KEEP,zPass:u.eA.ZERO}},m={function:{func:u.MT.ALWAYS,ref:c.dd.OutlineVisualElementMask,mask:c.dd.OutlineVisualElementMask},operation:{fail:u.eA.KEEP,zFail:u.eA.KEEP,zPass:u.eA.REPLACE}},g={function:{func:u.MT.EQUAL,ref:c.dd.OutlineVisualElementMask,mask:c.dd.OutlineVisualElementMask},operation:{fail:u.eA.KEEP,zFail:u.eA.KEEP,zPass:u.eA.KEEP}},_={function:{func:u.MT.NOTEQUAL,ref:c.dd.OutlineVisualElementMask,mask:c.dd.OutlineVisualElementMask},operation:{fail:u.eA.KEEP,zFail:u.eA.KEEP,zPass:u.eA.KEEP}}},68191:(t,s,o)=>{o.d(s,{S:()=>d,p:()=>h});var c=o(26475),u=o(60048);class d extends c.Gd{constructor(){super(...arguments),this.renderOccluded=u.m$.Occlude,this.isDecoration=!1}}let h=8},69201:(t,s,o)=>{o.d(s,{I:()=>d});var c=o(86416),u=o(53041);function d(t){t.attributes.add(u.r.POSITION,"vec3"),t.vertex.code.add((0,c.H)`vec3 positionModel() { return position; }`)}},69214:(t,s,o)=>{var c;o.d(s,{Y:()=>c}),function(t){t[t.NONE=0]="NONE",t[t.ColorAlpha=1]="ColorAlpha",t[t.FrontFace=2]="FrontFace",t[t.COUNT=3]="COUNT"}(c||(c={}))},69804:(t,s,o)=>{o.d(s,{A:()=>_});var c=o(81856),u=o(28690),d=o(32391),h=o(45257),f=o(91838),v=o(12709),p=o(54971),m=o(18189);let g=class extends u.A{constructor(t){super(t),this.view=null,this.consumes={required:[]},this.produces=p.hM.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([(0,h.wB)(()=>this.view.ready,t=>{t&&this.view._stage?.renderer.addRenderNode(this)},h.Vh)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new d.A("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}get techniques(){return this.view._stage.renderView.techniques}acquireOutputFramebuffer(){let t=this._frameBuffer?.getTexture()?.descriptor,s=this.view._stage.renderer.fboCache.acquire(t?.width??640,t?.height??480,this.produces);return s.fbo?.initializeAndBind(),s}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(t){t===m.C7.UPDATE&&this.view._stage?.renderView.requestRender(t),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view._stage.renderView.renderingContext}get renderContext(){return this.view._stage?.renderer.renderContext}updateAnimation(t){return!!this._dirty&&(this._dirty=!1,!0)}doRender(t){this._frameBuffer=t.find(({name:t})=>t===this.produces);try{return this.render(t)}finally{this._frameBuffer=null}}};(0,c._)([(0,f.MZ)({constructOnly:!0})],g.prototype,"view",void 0),(0,c._)([(0,f.MZ)({constructOnly:!0})],g.prototype,"consumes",void 0),(0,c._)([(0,f.MZ)()],g.prototype,"produces",void 0),(0,c._)([(0,f.MZ)({readOnly:!0})],g.prototype,"techniques",null);let _=g=(0,c._)([(0,v.$)("esri.views.3d.webgl.RenderNode")],g)},70058:(t,s,o)=>{o.d(s,{t:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"vec3",c.c.Pass,(o,c,u)=>o.setUniform3fv(t,s(c,u)))}}},70760:(t,s,o)=>{o.d(s,{z:()=>m});var c=o(4538),u=o(30066),d=o(17323),h=o(25576),f=o(86416),v=o(69214),p=o(92961);function m(t,s){t.include(d.Q,s),t.include(u.NL,s),t.fragment.include(h.a);let o=s.output===c.V.ObjectAndLayerIdColor,m=(0,c.LG)(s.output),g=(0,c.RN)(s.output)&&s.oitPass===v.Y.ColorAlpha,_=(0,c.RN)(s.output)&&s.oitPass!==v.Y.ColorAlpha,T=s.discardInvisibleFragments,A=0;(_||m||g)&&t.outputs.add("fragColor","vec4",A++),m&&t.outputs.add("fragEmission","vec4",A++),g&&t.outputs.add("fragAlpha","float",A++),t.fragment.code.add((0,f.H)`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition) {
      ${(0,f.If)(o,"finalColor.a = 1.0;")}

      ${(0,f.If)(T,`if (finalColor.a < ${f.H.float(p.Q)}) { discard; }`)}

      finalColor = applySlice(finalColor, vWorldPosition);
      ${(0,f.If)(g,(0,f.H)`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${(0,f.If)(_,"fragColor = finalColor;")}
      ${(0,f.If)(m,"fragEmission = finalColor.a * getEmissions();")}
      calculateOcclusionAndOutputHighlight();
      ${(0,f.If)(o,"outputObjectAndLayerIdColor();")}
    }
  `)}},70762:(t,s,o)=>{o.d(s,{x:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"sampler2D",c.c.Bind,(o,c)=>o.bindTexture(t,s(c)))}}},70950:(t,s,o)=>{o.d(s,{Hk:()=>_,Pq:()=>g,SA:()=>S,Ut:()=>m,p1:()=>T,tH:()=>E,tb:()=>A,uO:()=>f,zC:()=>b});var c=o(40998),u=o(96772),d=o(97681),h=o(53041);function f(t,s,o,c=1){let{data:u,indices:d}=t,h=s.typedBuffer,v=s.typedBufferStride,p=d.length;if(o*=v,1===c)for(let t=0;t<p;++t)h[o]=u[d[t]],o+=v;else for(let t=0;t<p;++t){let s=u[d[t]];for(let t=0;t<c;t++)h[o]=s,o+=v}}function v(t,s,o){let{data:c,indices:u}=t,d=s.typedBuffer,h=s.typedBufferStride,f=u.length;o*=h;for(let t=0;t<f;++t){let s=2*u[t];d[o]=c[s],d[o+1]=c[s+1],o+=h}}function p(t,s,o,c){let{data:u,indices:d}=t,h=s.typedBuffer,f=s.typedBufferStride,v=d.length;if(o*=f,null==c||1===c)for(let t=0;t<v;++t){let s=3*d[t];h[o]=u[s],h[o+1]=u[s+1],h[o+2]=u[s+2],o+=f}else for(let t=0;t<v;++t){let s=3*d[t];for(let t=0;t<c;++t)h[o]=u[s],h[o+1]=u[s+1],h[o+2]=u[s+2],o+=f}}function m(t,s,o,c=1){let{data:u,indices:d}=t,h=s.typedBuffer,f=s.typedBufferStride,v=d.length;if(o*=f,1===c)for(let t=0;t<v;++t){let s=4*d[t];h[o]=u[s],h[o+1]=u[s+1],h[o+2]=u[s+2],h[o+3]=u[s+3],o+=f}else for(let t=0;t<v;++t){let s=4*d[t];for(let t=0;t<c;++t)h[o]=u[s],h[o+1]=u[s+1],h[o+2]=u[s+2],h[o+3]=u[s+3],o+=f}}function g(t,s,o){let c=t.typedBuffer,u=t.typedBufferStride;s*=u;for(let t=0;t<o;++t)c[s]=0,c[s+1]=0,c[s+2]=0,c[s+3]=0,s+=u}function _(t,s,o,u,d=1){if(!s)return void p(t,o,u,d);let{data:h,indices:f}=t,v=o.typedBuffer,m=o.typedBufferStride,g=f.length,T=s[0],A=s[1],E=s[2],S=s[4],b=s[5],x=s[6],C=s[8],O=s[9],I=s[10],R=s[12],y=s[13],M=s[14];u*=m;let w=0,N=0,P=0,L=(0,c.tZ)(s)?t=>{w=h[t]+R,N=h[t+1]+y,P=h[t+2]+M}:t=>{let s=h[t],o=h[t+1],c=h[t+2];w=T*s+S*o+C*c+R,N=A*s+b*o+O*c+y,P=E*s+x*o+I*c+M};if(1===d)for(let t=0;t<g;++t)L(3*f[t]),v[u]=w,v[u+1]=N,v[u+2]=P,u+=m;else for(let t=0;t<g;++t){L(3*f[t]);for(let t=0;t<d;++t)v[u]=w,v[u+1]=N,v[u+2]=P,u+=m}}function T(t,s,o,u,d=1){if(!s)return void p(t,o,u,d);let{data:h,indices:f}=t,v=o.typedBuffer,m=o.typedBufferStride,g=f.length,_=s[0],A=s[1],E=s[2],S=s[4],b=s[5],x=s[6],C=s[8],O=s[9],I=s[10],R=!(0,c.ut)(s);u*=m;let y=0,M=0,w=0,N=(0,c.tZ)(s)?t=>{y=h[t],M=h[t+1],w=h[t+2]}:t=>{let s=h[t],o=h[t+1],c=h[t+2];y=_*s+S*o+C*c,M=A*s+b*o+O*c,w=E*s+x*o+I*c};if(1===d)if(R)for(let t=0;t<g;++t){N(3*f[t]);let s=y*y+M*M+w*w;if(s<.999999&&s>1e-6){let t=1/Math.sqrt(s);v[u]=y*t,v[u+1]=M*t,v[u+2]=w*t}else v[u]=y,v[u+1]=M,v[u+2]=w;u+=m}else for(let t=0;t<g;++t)N(3*f[t]),v[u]=y,v[u+1]=M,v[u+2]=w,u+=m;else for(let t=0;t<g;++t){if(N(3*f[t]),R){let t=y*y+M*M+w*w;if(t<.999999&&t>1e-6){let s=1/Math.sqrt(t);y*=s,M*=s,w*=s}}for(let t=0;t<d;++t)v[u]=y,v[u+1]=M,v[u+2]=w,u+=m}}function A(t,s,o,c,u=1){let{data:d,indices:h}=t,f=o.typedBuffer,v=o.typedBufferStride,p=h.length;if(c*=v,s!==d.length||4!==s)if(1!==u)if(4!==s)for(let t=0;t<p;++t){let s=3*h[t];for(let t=0;t<u;++t)f[c]=d[s],f[c+1]=d[s+1],f[c+2]=d[s+2],f[c+3]=255,c+=v}else for(let t=0;t<p;++t){let s=4*h[t];for(let t=0;t<u;++t)f[c]=d[s],f[c+1]=d[s+1],f[c+2]=d[s+2],f[c+3]=d[s+3],c+=v}else{if(4===s){for(let t=0;t<p;++t){let s=4*h[t];f[c]=d[s],f[c+1]=d[s+1],f[c+2]=d[s+2],f[c+3]=d[s+3],c+=v}return}for(let t=0;t<p;++t){let s=3*h[t];f[c]=d[s],f[c+1]=d[s+1],f[c+2]=d[s+2],f[c+3]=255,c+=v}}else{f[c]=d[0],f[c+1]=d[1],f[c+2]=d[2],f[c+3]=d[3];let t=new Uint32Array(o.typedBuffer.buffer,o.start),s=v/4,h=t[c/=4];c+=s;let m=p*u;for(let o=1;o<m;++o)t[c]=h,c+=s}}function E(t,s,o,c,u=1){let d=s.typedBuffer,h=s.typedBufferStride;if(c*=h,1===u)for(let s=0;s<o;++s)d[c]=t[0],d[c+1]=t[1],d[c+2]=t[2],d[c+3]=t[3],c+=h;else for(let s=0;s<o;++s)for(let s=0;s<u;++s)d[c]=t[0],d[c+1]=t[1],d[c+2]=t[2],d[c+3]=t[3],c+=h}function S(t,s,o,c,d,f,v){for(let p of o.fields.keys()){let o=t.get(p),m=o?.indices;if(o&&m)b(p,o,c,d,f,v);else if(p===h.r.OBJECTANDLAYERIDCOLOR&&null!=s){let o=t.get(h.r.POSITION)?.indices;if(o){let t=o.length;E(s,f.getField(p,u.XP),t,v)}}}}function b(t,s,o,f,p,g){switch(t){case h.r.POSITION:{(0,d.vA)(3===s.size);let c=p.getField(t,u.xs);(0,d.vA)(!!c,`No buffer view for ${t}`),c&&_(s,o,c,g);break}case h.r.NORMAL:{(0,d.vA)(3===s.size);let o=p.getField(t,u.xs);(0,d.vA)(!!o,`No buffer view for ${t}`),o&&T(s,f,o,g);break}case h.r.NORMALCOMPRESSED:{(0,d.vA)(2===s.size);let o=p.getField(t,u.mJ);(0,d.vA)(!!o,`No buffer view for ${t}`),o&&v(s,o,g);break}case h.r.UV0:{(0,d.vA)(2===s.size);let o=p.getField(t,u.gH);(0,d.vA)(!!o,`No buffer view for ${t}`),o&&v(s,o,g);break}case h.r.COLOR:case h.r.SYMBOLCOLOR:{let o=p.getField(t,u.XP);(0,d.vA)(!!o,`No buffer view for ${t}`),(0,d.vA)(3===s.size||4===s.size),o&&(3===s.size||4===s.size)&&A(s,s.size,o,g);break}case h.r.COLORFEATUREATTRIBUTE:{let o=p.getField(t,u.Y$);(0,d.vA)(!!o,`No buffer view for ${t}`),(0,d.vA)(1===s.size),o&&1===s.size&&function(t,s,o){let{data:c,indices:u}=t,d=s.typedBuffer,h=s.typedBufferStride,f=u.length,v=c[0];o*=h;for(let t=0;t<f;++t)d[o]=v,o+=h}(s,o,g);break}case h.r.TANGENT:{(0,d.vA)(4===s.size);let h=p.getField(t,u.Eq);(0,d.vA)(!!h,`No buffer view for ${t}`),h&&function(t,s,o,u,d=1){if(!s)return m(t,o,u,d);let{data:h,indices:f}=t,v=o.typedBuffer,p=o.typedBufferStride,g=f.length,_=s[0],T=s[1],A=s[2],E=s[4],S=s[5],b=s[6],x=s[8],C=s[9],O=s[10],I=!(0,c.ut)(s);if(u*=p,1===d)for(let t=0;t<g;++t){let s=4*f[t],o=h[s],c=h[s+1],d=h[s+2],m=h[s+3],g=_*o+E*c+x*d,R=T*o+S*c+C*d,y=A*o+b*c+O*d;if(I){let t=g*g+R*R+y*y;if(t<.999999&&t>1e-6){let s=1/Math.sqrt(t);g*=s,R*=s,y*=s}}v[u]=g,v[u+1]=R,v[u+2]=y,v[u+3]=m,u+=p}else for(let t=0;t<g;++t){let s=4*f[t],o=h[s],c=h[s+1],m=h[s+2],g=h[s+3],R=_*o+E*c+x*m,y=T*o+S*c+C*m,M=A*o+b*c+O*m;if(I){let t=R*R+y*y+M*M;if(t<.999999&&t>1e-6){let s=1/Math.sqrt(t);R*=s,y*=s,M*=s}}for(let t=0;t<d;++t)v[u]=R,v[u+1]=y,v[u+2]=M,v[u+3]=g,u+=p}}(s,o,h,g);break}case h.r.PROFILERIGHT:case h.r.PROFILEUP:case h.r.PROFILEVERTEXANDNORMAL:case h.r.FEATUREVALUE:{(0,d.vA)(4===s.size);let o=p.getField(t,u.Eq);(0,d.vA)(!!o,`No buffer view for ${t}`),o&&m(s,o,g)}}}},72768:(t,s,o)=>{o.d(s,{Ir:()=>m});var c=o(54036),u=o(35430),d=o(13784),h=o(44120),f=o(43417),v=o(85263),p=o(86416);function m(t){t.fragment.uniforms.add(new v.I("projInfo",t=>(function(t){let s=t.projectionMatrix;return 0===s[11]?(0,d.s)(g,2/(t.fullWidth*s[0]),2/(t.fullHeight*s[5]),(1+s[12])/s[0],(1+s[13])/s[5]):(0,d.s)(g,-2/(t.fullWidth*s[0]),-2/(t.fullHeight*s[5]),(1-s[8])/s[0],(1-s[9])/s[5])})(t.camera))),t.fragment.uniforms.add(new f.E("zScale",t=>0===t.camera.projectionMatrix[11]?(0,c.hZ)(_,0,1):(0,c.hZ)(_,1,0))),t.fragment.code.add((0,p.H)`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}let g=(0,h.vt)(),_=(0,u.vt)()},72936:(t,s,o)=>{o.d(s,{A:()=>m});var c=o(70058),u=o(73110),d=o(59722),h=o(86416),f=o(28097),v=o(53041),p=o(68191);function m(t,s){let{vertex:o,attributes:m}=t;s.hasVvInstancing&&(s.vvSize||s.vvColor)&&m.add(v.r.INSTANCEFEATUREATTRIBUTE,"vec4"),s.vvSize?(o.uniforms.add(new c.t("vvSizeMinSize",t=>t.vvSize.minSize)),o.uniforms.add(new c.t("vvSizeMaxSize",t=>t.vvSize.maxSize)),o.uniforms.add(new c.t("vvSizeOffset",t=>t.vvSize.offset)),o.uniforms.add(new c.t("vvSizeFactor",t=>t.vvSize.factor)),o.uniforms.add(new f.k("vvSymbolRotationMatrix",t=>t.vvSymbolRotationMatrix)),o.uniforms.add(new c.t("vvSymbolAnchor",t=>t.vvSymbolAnchor)),o.code.add((0,h.H)`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),o.code.add((0,h.H)`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${s.hasVvInstancing?(0,h.H)`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):o.code.add((0,h.H)`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),s.vvColor?(o.constants.add("vvColorNumber","int",p.p),o.uniforms.add(new d.x("vvColorValues",t=>t.vvColor.values,p.p),new u.F("vvColorColors",t=>t.vvColor.colors,p.p)),o.code.add((0,h.H)`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${s.hasVvInstancing?(0,h.H)`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):o.code.add((0,h.H)`vec4 vvColor() { return vec4(1.0); }`)}},73024:(t,s,o)=>{o.d(s,{n:()=>u}),o(57845);var c=o(2907);class u{constructor(t,s,o,u,d=null){if(this.name=t,this.type=s,this.arraySize=d,this.bind={[c.c.Bind]:null,[c.c.Pass]:null,[c.c.Draw]:null},u)switch(o){case void 0:break;case c.c.Bind:this.bind[c.c.Bind]=u;break;case c.c.Pass:this.bind[c.c.Pass]=u;break;case c.c.Draw:this.bind[c.c.Draw]=u}}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}},73110:(t,s,o)=>{o.d(s,{F:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s,o){super(t,"vec4",c.c.Pass,(o,c,u)=>o.setUniform4fv(t,s(c,u)),o)}}},73375:(t,s,o)=>{o.d(s,{Y:()=>u,m:()=>d});class c{}let u=c,d=new u},74405:(t,s,o)=>{var c;o.d(s,{X:()=>c}),function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"}(c||(c={}))},75648:(t,s,o)=>{o.d(s,{TA:()=>O,uH:()=>C});var c=o(20538),u=o(63599),d=o(56911),h=o(38220);function f(t,s,o){(o=o||t).length=t.length;for(let c=0;c<t.length;c++)o[c]=t[c]*s;return o}function v(t,s,o){(o=o||t).length=t.length;for(let c=0;c<t.length;c++)o[c]=t[c]+s[c];return o}function p(t,s,o){let c=t[0],u=t[1],d=t[2],h=o||[];return h.length=(s+1)*(s+1),s>=0&&(h[0]=.28209479177),s>=1&&(h[1]=.4886025119*c,h[2]=.4886025119*d,h[3]=.4886025119*u),s>=2&&(h[4]=1.09254843059*c*u,h[5]=1.09254843059*u*d,h[6]=.31539156525*(3*d*d-1),h[7]=1.09254843059*c*d,h[8]=.54627421529*(c*c-u*u)),h}let m=[],g=[],_=[],T=[0],A=[0],E=(0,d.vt)(),S=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class b{constructor(){this.color=(0,d.vt)(),this.intensity=1}}class x{constructor(){this.direction=(0,d.vt)(),this.ambient=new b,this.diffuse=new b}}let C=.4;class O{constructor(){this._shOrder=2,this._legacy=new x,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new h.e_,this._mainLight=new h.Qx((0,d.vt)(),(0,d.fA)(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(t){(function(t,s,o,d){(function(t,s){let o=(t+1)*(t+1),c=s||{r:[],g:[],b:[]};c.r.length=c.g.length=c.b.length=o;for(let t=0;t<o;t++)c.r[t]=c.g[t]=c.b[t]=0})(s,d),(0,u.i)(o.intensity,0,0,0);let b=!1;for(let s of(m.length=0,g.length=0,_.length=0,t))s instanceof h.Qx&&!b?((0,u.c)(o.direction,s.direction),(0,u.c)(o.intensity,s.intensity),o.specularStrength=s.specularStrength,o.environmentStrength=s.environmentStrength,o.castShadows=s.castShadows,b=!0):s instanceof h.Qx||s instanceof h._y?m.push(s):s instanceof h.$p?g.push(s):s instanceof h.e_&&_.push(s);for(let t of(function(t,s){var o;let d=(o=s.r.length,(0,c.qE)(Math.floor(Math.sqrt(o)-1),0,2));for(let o of t)(0,u.v)(E,o.direction),p(E,d,T),function(t,s,o){(o=o||t).length=t.length;for(let c=0;c<t.length;c++)o[c]=t[c]*s[c]}(T,S),f(T,o.intensity[0],A),v(s.r,A),f(T,o.intensity[1],A),v(s.g,A),f(T,o.intensity[2],A),v(s.b,A)}(m,d),function(t,s){for(let o of(p(E,0,T),t))s.r[0]+=T[0]*S[0]*o.intensity[0]*4*Math.PI,s.g[0]+=T[0]*S[0]*o.intensity[1]*4*Math.PI,s.b[0]+=T[0]*S[0]*o.intensity[2]*4*Math.PI}(g,d),_))v(d.r,t.r),v(d.g,t.g),v(d.b,t.b)})(t,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,u.c)(this._legacy.direction,this._mainLight.direction);let s=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*s,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*s,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*s,(0,u.h)(this._legacy.diffuse.color,this._mainLight.intensity,s),(0,u.c)(I,this._legacy.diffuse.color),(0,u.h)(I,I,C*this.globalFactor),(0,u.g)(this._legacy.ambient.color,this._legacy.ambient.color,I)}copyFrom(t){this._sphericalHarmonics.r=Array.from(t.sh.r),this._sphericalHarmonics.g=Array.from(t.sh.g),this._sphericalHarmonics.b=Array.from(t.sh.b),(0,u.c)(this._mainLight.direction,t.mainLight.direction),(0,u.c)(this._mainLight.intensity,t.mainLight.intensity),this._mainLight.castShadows=t.mainLight.castShadows,this._mainLight.specularStrength=t.mainLight.specularStrength,this._mainLight.environmentStrength=t.mainLight.environmentStrength,this.globalFactor=t.globalFactor,this.noonFactor=t.noonFactor}lerpLighting(t,s,o){if((0,u.m)(this._mainLight.intensity,t.mainLight.intensity,s.mainLight.intensity,o),this._mainLight.environmentStrength=(0,c.Cc)(t.mainLight.environmentStrength,s.mainLight.environmentStrength,o),this._mainLight.specularStrength=(0,c.Cc)(t.mainLight.specularStrength,s.mainLight.specularStrength,o),(0,u.c)(this._mainLight.direction,s.mainLight.direction),this._mainLight.castShadows=s.mainLight.castShadows,this.globalFactor=(0,c.Cc)(t.globalFactor,s.globalFactor,o),this.noonFactor=(0,c.Cc)(t.noonFactor,s.noonFactor,o),t.sh.r.length===s.sh.r.length)for(let u=0;u<s.sh.r.length;u++)this._sphericalHarmonics.r[u]=(0,c.Cc)(t.sh.r[u],s.sh.r[u],o),this._sphericalHarmonics.g[u]=(0,c.Cc)(t.sh.g[u],s.sh.g[u],o),this._sphericalHarmonics.b[u]=(0,c.Cc)(t.sh.b[u],s.sh.b[u],o);else for(let t=0;t<s.sh.r.length;t++)this._sphericalHarmonics.r[t]=s.sh.r[t],this._sphericalHarmonics.g[t]=s.sh.g[t],this._sphericalHarmonics.b[t]=s.sh.b[t]}}let I=(0,d.vt)()},75769:(t,s,o)=>{o.d(s,{y:()=>u});var c=o(86416);function u(t){let{fragment:s}=t;s.code.add((0,c.H)`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}},76085:(t,s,o)=>{o.d(s,{m:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"float",c.c.Pass,(o,c,u)=>o.setUniform1f(t,s(c,u)))}}},76257:(t,s,o)=>{o.d(s,{c:()=>d});var c=o(86416),u=o(53041);function d(t,s){s.hasVertexColors?(t.attributes.add(u.r.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add((0,c.H)`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add((0,c.H)`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add((0,c.H)`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},77414:(t,s,o)=>{o.d(s,{t:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"vec2",c.c.Draw,(o,c,u,d)=>o.setUniform2fv(t,s(c,u,d)))}}},78724:(t,s,o)=>{var c;o.d(s,{n:()=>c}),function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"}(c||(c={}))},80194:(t,s,o)=>{o.d(s,{HQ:()=>p,rA:()=>m});var c=o(40998),u=o(38715),d=o(63599),h=o(56911),f=o(47947);o(70058);var v=o(86416);function p(t,s){(function(t,s,...o){_(t,s,...o),s.hasSlicePlane?t.code.add("\n    void discardBySlice(vec3 pos) {\n      if (sliceByPlane(pos)) {\n        discard;\n      }\n    }\n\n    vec4 applySliceOutline(vec4 color, vec3 pos) {\n      SliceFactors factors = calculateSliceFactors(pos);\n\n      factors.front /= 2.0 * fwidth(factors.front);\n      factors.side0 /= 2.0 * fwidth(factors.side0);\n      factors.side1 /= 2.0 * fwidth(factors.side1);\n      factors.side2 /= 2.0 * fwidth(factors.side2);\n      factors.side3 /= 2.0 * fwidth(factors.side3);\n\n      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth\n      if (sliceByFactors(factors)) {\n        return color;\n      }\n\n      float outlineFactor = (1.0 - step(0.5, factors.front))\n        * (1.0 - step(0.5, factors.side0))\n        * (1.0 - step(0.5, factors.side1))\n        * (1.0 - step(0.5, factors.side2))\n        * (1.0 - step(0.5, factors.side3));\n\n      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);\n    }\n\n    vec4 applySlice(vec4 color, vec3 pos) {\n      return sliceEnabled() ? applySliceOutline(color, pos) : color;\n    }\n  "):t.code.add((0,v.H)`void discardBySlice(vec3 pos) { }
vec4 applySlice(vec4 color, vec3 pos) { return color; }`)})(t,s,new f.W("slicePlaneOrigin",(t,o)=>S(s,t,o)),new f.W("slicePlaneBasis1",(t,o)=>b(s,t,o,o.slicePlane?.basis1)),new f.W("slicePlaneBasis2",(t,o)=>b(s,t,o,o.slicePlane?.basis2)))}function m(t,s){_(t,s,new f.W("slicePlaneOrigin",(t,o)=>S(s,t,o)),new f.W("slicePlaneBasis1",(t,o)=>b(s,t,o,o.slicePlane?.basis1)),new f.W("slicePlaneBasis2",(t,o)=>b(s,t,o,o.slicePlane?.basis2)))}o(73375).Y;let g=(0,v.H)`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
bool rejectBySlice(vec3 pos) {
return sliceByPlane(pos);
}`;function _(t,s,...o){s.hasSlicePlane?(t.uniforms.add(...o),t.code.add(g)):t.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function T(t,s,o){return t.instancedDoublePrecision?(0,d.i)(x,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]):s.slicePlaneLocalOrigin}function A(t,s){return null!=t?(0,d.d)(C,s.origin,t):s.origin}function E(t,s,o){return t.hasSliceTranslatedView?null!=s?(0,c.Tl)(I,o.camera.viewMatrix,s):o.camera.viewMatrix:null}function S(t,s,o){if(null==o.slicePlane)return h.uY;let c=T(t,s,o),u=A(c,o.slicePlane),f=E(t,c,o);return null!=f?(0,d.t)(C,u,f):u}function b(t,s,o,c){if(null==c||null==o.slicePlane)return h.uY;let u=T(t,s,o),f=A(u,o.slicePlane),v=E(t,u,o);return null!=v?((0,d.g)(O,c,f),(0,d.t)(C,f,v),(0,d.t)(O,O,v),(0,d.d)(O,O,C)):c}let x=(0,h.vt)(),C=(0,h.vt)(),O=(0,h.vt)(),I=(0,u.vt)()},81605:(t,s,o)=>{o.d(s,{MB:()=>f,Um:()=>v,kE:()=>h});var c=o(31461),u=o(20538),d=o(64367);function h(t,s,o,c,h){let f=(o.screenLength||0)*t.pixelRatio;null!=h&&(f=(0,d.hs)(f,c,s,h));let v=f*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return(0,u.qE)(v*s,o.minWorldLength||0,null!=o.maxWorldLength?o.maxWorldLength:1/0)}function f(t,s){let o=!1;for(let u in s){let d=s[u];void 0!==d&&(Array.isArray(d)?Array.isArray(t[u])&&(0,c.aI)(d,t[u])||(t[u]=d.slice(),o=!0):t[u]!==d&&(o=!0,t[u]=d))}return o}let v={multiply:1,ignore:2,replace:3,tint:4}},82454:(t,s,o)=>{o.d(s,{Z:()=>p});var c=o(63599),u=o(56911),d=o(96772),h=o(19039),f=o(53041),v=o(70950);class p{constructor(t){this.vertexBufferLayout=t}elementCount(t){return t.get(f.r.POSITION).indices.length}write(t,s,o,c,u,d){(0,v.SA)(o,c,this.vertexBufferLayout,t,s,u,d)}intersect(t,s,o,u,v){let p=this.vertexBufferLayout.createView(t).getField(f.r.POSITION,d.xs);if(null==p)return;let g=(0,c.a)(m,u,o),_=p.elementCount/3,T=s.options.normalRequired;(0,h.b_)(o,g,0,_,p.typedBuffer,p.typedBufferStride,T,(t,s,o)=>{v(t,o,s,!1)})}}let m=(0,u.vt)()},82784:(t,s,o)=>{o.d(s,{NB:()=>T,Nz:()=>b,S7:()=>S,yu:()=>_});var c=o(40998),u=o(38715),d=o(63599),h=o(56911),f=o(20456),v=o(47947),p=o(90475),m=o(86032),g=o(51027);function _(t,s){s.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",h.uY):t.uniforms.add(new v.W("cameraPosition",(t,s)=>(0,d.i)(E,s.camera.viewInverseTransposeMatrix[3]-t.origin[0],s.camera.viewInverseTransposeMatrix[7]-t.origin[1],s.camera.viewInverseTransposeMatrix[11]-t.origin[2])))}function T(t,s){if(!s.instancedDoublePrecision)return void t.uniforms.add(new m.F("proj",t=>t.camera.projectionMatrix),new g.S("view",(t,s)=>(0,c.Tl)(A,s.camera.viewMatrix,t.origin)),new v.W("localOrigin",t=>t.origin));let o=({camera:t})=>(0,d.i)(E,t.viewInverseTransposeMatrix[3],t.viewInverseTransposeMatrix[7],t.viewInverseTransposeMatrix[11]);t.uniforms.add(new m.F("proj",t=>t.camera.projectionMatrix),new m.F("view",t=>(0,c.Tl)(A,t.camera.viewMatrix,o(t))),new f.d("localOrigin",t=>o(t)))}let A=(0,u.vt)(),E=(0,h.vt)();function S(t){t.uniforms.add(new m.F("viewNormal",t=>t.camera.viewInverseTransposeMatrix))}function b(t){t.uniforms.add(new p.U("pixelRatio",t=>t.camera.pixelRatio/t.overlayStretch))}},84153:(t,s,o)=>{o.d(s,{Ey:()=>E,Ky:()=>p,Ms:()=>G,Os:()=>v,Uy:()=>T,Xt:()=>_,gh:()=>f,hG:()=>g,kn:()=>A,p3:()=>h});var c=o(18189),u=o(93446);function d(t,s,o=u.Tb.ADD,c=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:s,dstAlpha:s,opRgb:o,opAlpha:o,color:{r:c[0],g:c[1],b:c[2],a:c[3]}}}function h(t,s,o,c,d=u.Tb.ADD,f=u.Tb.ADD,v=[0,0,0,0]){return{srcRgb:t,srcAlpha:s,dstRgb:o,dstAlpha:c,opRgb:d,opAlpha:f,color:{r:v[0],g:v[1],b:v[2],a:v[3]}}}let f=d(u.dn.ZERO,u.dn.ONE_MINUS_SRC_ALPHA),v=(d(u.dn.ONE,u.dn.ZERO),d(u.dn.ONE,u.dn.ONE),d(u.dn.ONE,u.dn.ONE_MINUS_SRC_ALPHA)),p=h(u.dn.SRC_ALPHA,u.dn.ONE,u.dn.ONE_MINUS_SRC_ALPHA,u.dn.ONE_MINUS_SRC_ALPHA),m={face:u.Y7.BACK,mode:u.Ac.CCW},g={face:u.Y7.FRONT,mode:u.Ac.CCW},_=t=>t===c.s2.Back?m:t===c.s2.Front?g:null,T={zNear:0,zFar:1},A={r:!0,g:!0,b:!0,a:!0};function E(t){return W.intern(t)}class S{constructor(t,s){this._makeKey=t,this._makeRef=s,this._interns=new Map}intern(t){if(!t)return null;let s=this._makeKey(t),o=this._interns;return o.has(s)||o.set(s,this._makeRef(t)),o.get(s)??null}}function b(t){return"["+t.join(",")+"]"}let x=new S(C,t=>({__tag:"Blending",...t}));function C(t){return t?b([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}let O=new S(I,t=>({__tag:"Culling",...t}));function I(t){return t?b([t.face,t.mode]):null}let R=new S(y,t=>({__tag:"PolygonOffset",...t}));function y(t){return t?b([t.factor,t.units]):null}let M=new S(w,t=>({__tag:"DepthTest",...t}));function w(t){return t?b([t.func]):null}let N=new S(P,t=>({__tag:"StencilTest",...t}));function P(t){return t?b([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}let L=new S(D,t=>({__tag:"DepthWrite",...t}));function D(t){return t?b([t.zNear,t.zFar]):null}let H=new S(F,t=>({__tag:"ColorWrite",...t}));function F(t){return t?b([t.r,t.g,t.b,t.a]):null}let B=new S(z,t=>({__tag:"StencilWrite",...t}));function z(t){return t?b([t.mask]):null}let U=new S(V,t=>({__tag:"DrawBuffers",...t}));function V(t){return t?b(t.buffers):null}let W=new S(function(t){return t?b([C(t.blending),I(t.culling),y(t.polygonOffset),w(t.depthTest),P(t.stencilTest),D(t.depthWrite),F(t.colorWrite),z(t.stencilWrite),V(t.drawBuffers)]):null},t=>{var s,o,c,u,d,h,f,v,p;return{blending:(s=t.blending,x.intern(s)),culling:(o=t.culling,O.intern(o)),polygonOffset:(c=t.polygonOffset,R.intern(c)),depthTest:(u=t.depthTest,M.intern(u)),stencilTest:(d=t.stencilTest,N.intern(d)),depthWrite:(h=t.depthWrite,L.intern(h)),colorWrite:(f=t.colorWrite,H.intern(f)),stencilWrite:(v=t.stencilWrite,B.intern(v)),drawBuffers:(p=t.drawBuffers,U.intern(p))}});class G{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._setDrawBuffers(t.drawBuffers),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(t){this._drawBuffers=this._setSubState(t,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(t,s,o,c){return(o||t!==s)&&(c(t),this._pipelineInvalid=!0),t}}},84797:(t,s,o)=>{o.d(s,{G:()=>p,V:()=>g});var c=o(13784),u=o(44120),d=o(54126),h=o(82784),f=o(62809),v=o(86416);function p(t,s){let o=t.vertex;s.hasVerticalOffset?(g(o),s.hasScreenSizePerspective&&(t.include(d.Y6),(0,d.OH)(o),(0,h.yu)(t.vertex,s)),o.code.add((0,v.H)`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${s.spherical?(0,v.H)`vec3 worldNormal = normalize(worldPos + localOrigin);`:(0,v.H)`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${s.hasScreenSizePerspective?(0,v.H)`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:(0,v.H)`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):o.code.add((0,v.H)`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}let m=(0,u.vt)();function g(t){t.uniforms.add(new f.E("verticalOffset",(t,s)=>{let{minWorldLength:o,maxWorldLength:u,screenLength:d}=t.verticalOffset,h=Math.tan(.5*s.camera.fovY)/(.5*s.camera.fullViewport[3]),f=s.camera.pixelRatio||1;return(0,c.s)(m,d*f,h,o,u)}))}},85263:(t,s,o)=>{o.d(s,{I:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"vec4",c.c.Bind,(o,c)=>o.setUniform4fv(t,s(c)))}}},85267:(t,s,o)=>{o.d(s,{g:()=>h});var c=o(4538),u=o(86416),d=o(53041);function h(t,s){if(s.output!==c.V.ObjectAndLayerIdColor)return t.vertex.code.add((0,u.H)`void forwardObjectAndLayerIdColor() {}`),void t.fragment.code.add((0,u.H)`void outputObjectAndLayerIdColor() {}`);let o=s.objectAndLayerIdColorInstanced;t.varyings.add("objectAndLayerIdColorVarying","vec4"),t.attributes.add(o?d.r.INSTANCEOBJECTANDLAYERIDCOLOR:d.r.OBJECTANDLAYERIDCOLOR,"vec4"),t.vertex.code.add((0,u.H)`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${o?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor"} * 0.003921568627451;
    }`),t.fragment.code.add((0,u.H)`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}},86032:(t,s,o)=>{o.d(s,{F:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"mat4",c.c.Bind,(o,c)=>o.setUniformMatrix4fv(t,s(c)))}}},86416:(t,s,o)=>{function c(t,...s){let o="";for(let c=0;c<s.length;c++)o+=t[c]+s[c];return o+t[t.length-1]}function u(t,s,o=""){return t?s:o}o.d(s,{H:()=>c,If:()=>u}),function(t){t.int=function(t){return Math.round(t).toString()},t.float=function(t){return t.toPrecision(8)}}(c)},87156:(t,s,o)=>{o.d(s,{h:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"mat3",c.c.Draw,(o,c,u)=>o.setUniformMatrix3fv(t,s(c,u)))}}},87903:(t,s,o)=>{o.d(s,{Bt:()=>f,Jr:()=>d,SY:()=>v,mb:()=>h});var c=o(63599),u=o(56911);function d({normalTexture:t,metallicRoughnessTexture:s,metallicFactor:o,roughnessFactor:d,emissiveTexture:h,emissiveFactor:f,occlusionTexture:v}){return null==t&&null==s&&null==h&&(null==f||(0,c.p)(f,u.uY))&&null==v&&(null==d||1===d)&&(null==o||1===o)}let h=(0,u.CN)(1,1,.5),f=(0,u.CN)(0,.6,.2),v=(0,u.CN)(0,1,.2)},88795:(t,s,o)=>{o.d(s,{Z:()=>h});var c=o(18977),u=o(86416),d=o(70762);function h(t,{occlusionPass:s,terrainDepthTest:o,cullAboveTerrain:h}){let f=t.vertex,v=t.fragment;if(!o)return f.code.add("void forwardViewPosDepth(vec3 pos) {}"),void v.code.add(`${s?"bool":"void"} discardByTerrainDepth() { ${(0,u.If)(s,"return false;")}}`);t.varyings.add("viewPosDepth","float"),f.code.add("void forwardViewPosDepth(vec3 pos) {\n    viewPosDepth = pos.z;\n  }"),v.include(c.E),v.uniforms.add(new d.x("terrainDepthTexture",t=>t.terrainDepth?.attachment)).code.add((0,u.H)`
    ${s?"bool":"void"} discardByTerrainDepth() {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${s?"return viewPosDepth < linearDepth && depth < 1.0;":`if(viewPosDepth ${h?">":"<="} linearDepth) discard;`}
    }`)}},88936:(t,s,o)=>{o.d(s,{NV:()=>m,m8:()=>v});var c=o(40941),u=o(92753),d=o(18189),h=o(93895),f=o(73375);class v extends h.A{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textures=t.textures,this.updateTexture(t.textureId),this._acquire(t.normalTextureId,t=>this._textureNormal=t),this._acquire(t.emissiveTextureId,t=>this._textureEmissive=t),this._acquire(t.occlusionTextureId,t=>this._textureOcclusion=t),this._acquire(t.metallicRoughnessTextureId,t=>this._textureMetallicRoughness=t)}dispose(){super.dispose(),this._texture=(0,c.Gz)(this._texture),this._textureNormal=(0,c.Gz)(this._textureNormal),this._textureEmissive=(0,c.Gz)(this._textureEmissive),this._textureOcclusion=(0,c.Gz)(this._textureOcclusion),this._textureMetallicRoughness=(0,c.Gz)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return 0===this._numLoading?d.Am.LOADED:d.Am.LOADING}get textureBindParameters(){return new m(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){null!=this._texture&&t===this._texture.id||(this._texture=(0,c.Gz)(this._texture),this._textureId=t,this._acquire(this._textureId,t=>this._texture=t))}_acquire(t,s){if(null==t)return void s(null);let o=this._textures.acquire(t);if((0,u.$X)(o))return++this._numLoading,void o.then(t=>{if(this._disposed)return(0,c.Gz)(t),void s(null);s(t)}).finally(()=>--this._numLoading);s(o)}}class p extends f.Y{constructor(t=null){super(),this.textureEmissive=t}}class m extends p{constructor(t=null,s=null,o=null,c=null,u=null,d,h){super(o),this.texture=t,this.textureNormal=s,this.textureOcclusion=c,this.textureMetallicRoughness=u,this.scale=d,this.normalTextureTransformMatrix=h}}},90475:(t,s,o)=>{o.d(s,{U:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"float",c.c.Bind,(o,c)=>o.setUniform1f(t,s(c)))}}},91845:(t,s,o)=>{o.d(s,{c:()=>d});var c=o(86416),u=o(53041);function d(t,s=!0){t.attributes.add(u.r.POSITION,"vec2"),s&&t.varyings.add("uv","vec2"),t.vertex.main.add((0,c.H)`
      gl_Position = vec4(position, 0.0, 1.0);
      ${s?(0,c.H)`uv = position * 0.5 + vec2(0.5);`:""}
  `)}},92961:(t,s,o)=>{o.d(s,{Q:()=>c});let c=1/255.5},93205:(t,s,o)=>{o.d(s,{o:()=>d});var c=o(2907),u=o(73024);class d extends u.n{constructor(t,s){super(t,"bool",c.c.Bind,(o,c)=>o.setUniform1b(t,s(c)))}}},93895:(t,s,o)=>{o.d(s,{A:()=>u});var c=o(18189);class u{constructor(t){this._material=t.material,this._techniques=t.techniques,this._output=t.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}getTechnique(t,s){return this._techniques.get(t,this._material.getConfiguration(this._output,s))}ensureResources(t){return c.Am.LOADED}}},94934:(t,s,o)=>{o.d(s,{r:()=>h});var c=o(26847),u=o(86416);function d(t){t.fragment.code.add((0,u.H)`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function h(t,s){let{textureCoordinateType:o}=s;if(o===c.I.None||o===c.I.COUNT)return;t.include(c.U,s);let h=o===c.I.Atlas;h&&t.include(d),t.fragment.code.add((0,u.H)`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${h?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}},95421:(t,s,o)=>{o.d(s,{K:()=>f,W:()=>v});var c=o(32391),u=o(31461);class d{constructor(t){this._bits=[...t]}equals(t){return(0,u.aI)(this._bits,t.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}}var h=o(73375);class f extends h.Y{constructor(){super(),this._parameterBits=this._parameterBits?.map(()=>0)??[],this._parameterNames??=[]}get key(){return this._key??=new d(this._parameterBits),this._key}decode(t=this.key){let s=this._parameterBits;this._parameterBits=[...t.bits];let o=this._parameterNames.map(t=>`    ${t}: ${this[t]}`).join("\n");return this._parameterBits=s,o}}function v(t={}){return(s,o)=>{s.hasOwnProperty("_parameterNames")||Object.defineProperty(s,"_parameterNames",{value:s._parameterNames?.slice()??[],configurable:!0,writable:!0}),s.hasOwnProperty("_parameterBits")||Object.defineProperty(s,"_parameterBits",{value:s._parameterBits?.slice()??[0],configurable:!0,writable:!0}),s._parameterNames.push(o);let u=Math.ceil(Math.log2(t.count||2)),d=s._parameterBits,h=0;for(;d[h]+u>16;)++h>=d.length&&d.push(0);let f=d[h],v=(1<<u)-1<<f;d[h]+=u,t.count?Object.defineProperty(s,o,{get(){return(this._parameterBits[h]&v)>>f},set(s){if(this[o]!==s){if(this._key=null,this._parameterBits[h]=this._parameterBits[h]&~v|s<<f&v,"number"!=typeof s)throw new c.A(`Configuration value for ${o} must be a number, got ${typeof s}`);if(null==t.count)throw new c.A(`Configuration value for ${o} must provide a count option`)}}}):Object.defineProperty(s,o,{get(){return!!((this._parameterBits[h]&v)>>f)},set(t){if(this[o]!==t&&(this._key=null,this._parameterBits[h]=this._parameterBits[h]&~v|t<<f&v,"boolean"!=typeof t))throw new c.A(`Configuration value for ${o} must be boolean, got ${typeof t}`)}})}}},95554:(t,s,o)=>{o.d(s,{E:()=>u});var c=o(57845);function u(){return!!(0,c.A)("enable-feature:objectAndLayerId-rendering")}},96741:(t,s,o)=>{o.d(s,{w:()=>_});var c=o(61939),u=o(40941),d=o(47120),h=o(87196),f=o(53701);class v{constructor(t,s,o){this._context=t,this._locations=o,this._textures=new Map,this._freeTextureUnits=new h.A({deallocator:null}),this._glProgram=t.programCache.acquire(s.generate("vertex",!0),s.generate("fragment",!0),o),this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly")},this.bind=s.generateBind(this),this.bindPass=s.generateBindPass(this),this.bindDraw=s.generateBindDraw(this),this._fragmentUniforms=(0,f.en)()?s.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(t,s){this._glProgram.setUniform1i(t,+!!s)}setUniform1i(t,s){this._glProgram.setUniform1i(t,s)}setUniform1f(t,s){this._glProgram.setUniform1f(t,s)}setUniform2fv(t,s){this._glProgram.setUniform2fv(t,s)}setUniform3fv(t,s){this._glProgram.setUniform3fv(t,s)}setUniform4fv(t,s){this._glProgram.setUniform4fv(t,s)}setUniformMatrix3fv(t,s){this._glProgram.setUniformMatrix3fv(t,s)}setUniformMatrix4fv(t,s){this._glProgram.setUniformMatrix4fv(t,s)}setUniform1fv(t,s){this._glProgram.setUniform1fv(t,s)}setUniform1iv(t,s){this._glProgram.setUniform1iv(t,s)}setUniform2iv(t,s){this._glProgram.setUniform2iv(t,s)}setUniform3iv(t,s){this._glProgram.setUniform3iv(t,s)}setUniform4iv(t,s){this._glProgram.setUniform4iv(t,s)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,s){if(null==s?.glName){let s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let o=this._textures.get(t);return null==o?(o=this._allocTextureUnit(s),this._textures.set(t,o)):o.texture=s,this._context.useProgram(this),this.setUniform1i(t,o.unit),this._context.bindTexture(s,o.unit),o.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,s)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(s,t.unit)}),this._fragmentUniforms?.forEach(t=>{"sampler2D"!==t.type&&"samplerCube"!==t.type||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var p=o(93446),m=o(84153);let g=()=>c.A.getLogger("esri.views.3d.webgl.ShaderTechnique");class _{constructor(t,s,o,c=d.D){this.locations=c,this.primitiveType=p.WR.TRIANGLES,this.key=s.key,this._program=new v(t.rctx,o.get().build(s),c),this._pipeline=this.initializePipeline(s),this.reload=async d=>{d&&await o.reload(),this.key.equals(s.key)||g().warn("Configuration was changed after construction, cannot reload shader.",o),(0,u.WD)(this._program),this._program=new v(t.rctx,o.get().build(s),c),this._pipeline=this.initializePipeline(s)}}destroy(){this._program=(0,u.WD)(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}getPipeline(t,s){return this._pipeline}initializePipeline(t){return(0,m.Ey)({blending:m.Os,colorWrite:m.kn})}}},97305:(t,s,o)=>{o.d(s,{K_:()=>A,SE:()=>_,Yf:()=>p,aB:()=>T,ez:()=>v,m6:()=>E,xt:()=>g,z5:()=>m});var c=o(4538),u=o(69214),d=o(93446),h=o(84153);let f=(0,h.p3)(d.dn.ONE,d.dn.ZERO,d.dn.ONE,d.dn.ONE_MINUS_SRC_ALPHA);function v(t){return t===u.Y.FrontFace?null:f}function p(t){switch(t){case u.Y.NONE:return h.Ky;case u.Y.ColorAlpha:return f;case u.Y.FrontFace:case u.Y.COUNT:return null}}function m(t){if(t.draped)return null;switch(t.oitPass){case u.Y.NONE:case u.Y.FrontFace:return t.writeDepth?h.Uy:null;case u.Y.ColorAlpha:case u.Y.COUNT:return null}}let g=5e5,_={factor:-1,units:-2};function T(t){return t?_:null}function A(t,s=d.MT.LESS){return t===u.Y.NONE||t===u.Y.FrontFace?s:d.MT.LEQUAL}function E(t,s){let o=(0,c.LG)(s);return t===u.Y.ColorAlpha?o?{buffers:[d.Nm.COLOR_ATTACHMENT0,d.Nm.COLOR_ATTACHMENT1,d.Nm.COLOR_ATTACHMENT2]}:{buffers:[d.Nm.COLOR_ATTACHMENT0,d.Nm.COLOR_ATTACHMENT1]}:o?{buffers:[d.Nm.COLOR_ATTACHMENT0,d.Nm.COLOR_ATTACHMENT1]}:null}},98684:(t,s,o)=>{o.d(s,{u:()=>u});var c=o(86416);function u({code:t},s){s.doublePrecisionRequiresObfuscation?t.add((0,c.H)`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add((0,c.H)`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}}}]);