"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1590,5123],{10435:(e,t,i)=>{var r;i.d(t,{DW:()=>b,GA:()=>v,mv:()=>r}),function(e){e.Local="Local",e.Global="Global"}(r||(r={}));class o{generateSource(e){let t=[];for(let i=1;i<this.length;i++)t.push(`vec4 atom${i} = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;");for(let e=0;e<this.ins;e++)t.push("top--;"),t.push(`vec4 in${this.ins-e-1} = stack[top];`);for(let e=0;e<this.outs;e++)t.push(`vec4 out${e};`);let{microcode:i}=this;for(let e of i)t.push(e);for(let e=0;e<this.outs;e++)t.push(`stack[top] = out${e};`),t.push("top++;"),t.push(`if (top >= ${g}) { top = ${g-1}; }`);return t}}let s=128;class a extends o{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}class n extends o{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(e){return[[this.opcode,e,0,0]]}}class l extends o{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(e){return[[this.opcode,e[0]||0,e[1]||0,e[2]||0]]}}class u extends o{constructor(){super(...arguments),this.opcode=++s,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(e){return[[this.opcode,0,0,0],e]}}function p(e){return[`float duration = clamp(${e.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${e.startTimeOffset};`,`float repeatDelay = ${e.repeatDelay};`,`float timeOriginSelector = ${e.timeOriginSelector};`,`float repeatType = ${e.repeatType};`,`float easing = ${e.easing};`,`float playAnimation = ${e.playAnimation} * (1.0 - step(0.0, -${e.duration}));`,`float reverseAnimation = ${e.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${e.out} = oscillate ? 1.0 - of : of;`]}let d={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},c={Loop:1,None:2,Oscillate:3},h={Local:1,Global:2};function m(e){let t=d[e.easing],i=c[e.repeatType],r=h[e.timeOriginSelector];return[[e.duration,e.startTimeOffset,e.repeatDelay,r],[i,t,e.playAnimation,e.reverseAnimation]]}class f extends o{constructor(){super(...arguments),this.opcode=++s,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...p({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...p({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...p({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;","\n    vec2 translation = vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 = vec4(translation, rotation, scale);"]}encode(e){return[[this.opcode,0,0,0],[e.translation.from[0],e.translation.from[1],e.translation.to[0],e.translation.to[1]],[e.rotation.from,e.rotation.to,e.scale.from,e.scale.to],...m(e.translation.timing),...m(e.rotation.timing),...m(e.scale.timing),[+!!e.relativeTranslation,+!!e.absoluteScale,0,0]]}}class y extends o{constructor(){super(...arguments),this.opcode=++s,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...p({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...p({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(e){return[[this.opcode,e.opacity.from,e.opacity.to,0],[e.color.from[0],e.color.from[1],e.color.from[2],e.color.from[3]],[e.color.to[0],e.color.to[1],e.color.to[2],e.color.to[3]],...m(e.color.timing),...m(e.opacity.timing)]}}let v={scalar:new n,vector3:new l,vector4:new u,animatedTransform:new f,animatedColor:new y,ret:new a},g=4;function b(e){let t=[];for(let i in t.push(`float globalTime = ${e.globalTime};`),t.push(`float localTimeOrigin = ${e.localTimeOrigin};`),t.push(`vec2 pointer = ${e.animationPointer};`),t.push(`vec2 size = ${e.animationTextureSize};`),t.push("int top = 0;"),t.push(`vec4 stack[${g}];`),t.push("for (int counter = 0; counter < 40; counter++) {"),t.push(`vec4 atom0 = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;"),t.push(`vec2 pixelDimensions = ${e.pixelDimensions};`),t.push("if (false) {"),v){let r=v[i];for(let i of(t.push(`} else if (int(atom0.x) == ${r.opcode}) {`),r.generateSource(e)))t.push(i)}return t.push("} // End if-else."),t.push("} // End for."),t.push(`${e.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),t.join("\n")}},12702:(e,t,i)=>{i.d(t,{Q:()=>r});let r={isAlongLine:0,isAbsoluteSize:1,isDiscrete:2}},15062:(e,t,i)=>{i.d(t,{j:()=>n});var r=i(92753),o=i(61590),s=i(38526);class a{constructor(){this.type="override-batch",this.messages=[],this._resovler=(0,r.Tw)()}get promise(){return this._resovler.promise}resolve(){this._resovler.resolve()}add(e){this.messages.push(e)}}class n{constructor(e){this.updateTracking=new s.F({debugName:"FeatureCommandQueue"}),this.process=e.process,this._queueProcessor=new o.QueueProcessor({concurrency:1,process:async e=>{if("override-batch"===e.type){let e=this._nextOverrideBatch;if(null==e)throw Error("InternalError: Override should be defined");return this._nextOverrideBatch=null,await this.process(e),void e.resolve()}return this.process(e)}})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(e){return(0,r.QZ)(this.updateTracking.addPromise(this._doPush(e)))}async _doPush(e){let t=this._queueProcessor,i=t.last();switch(e.type){case"update":case"highlight":if(i?.type===e.type)return;return t.push(e);case"override":case"edit":return this._pushOverride(e)}}_pushOverride(e){return null==this._nextOverrideBatch&&(this._nextOverrideBatch=new a,this._queueProcessor.push(this._nextOverrideBatch)),this._nextOverrideBatch.add(e),this._nextOverrideBatch.promise}}},17168:(e,t,i)=>{i.d(t,{R:()=>l,e:()=>u});var r=i(32391),o=i(61939),s=i(55048),a=i(2698);let n=()=>o.A.getLogger("esri.views.2d.layers.features.support.rendererUtils");function l(e){return e.map(e=>{var t,i,r,o;return("size"===(t=e).type||"color"===t.type||"opacity"===t.type)&&null!=t.stops?(r=(i=e.clone()).type,i.stops=(o=i.stops??[]).length<=8?o:(n().warn(`Found ${o.length} Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified.`),o.length>16?function(e,t){let[i,...r]=t,o=r.pop(),a=r[0].value,n=r[r.length-1].value,l=(n-a)/6,u=[];for(let i=a;i<n;i+=l){var p,d,c,h,m,f,y,v,g,b;let o=0;for(;i>=r[o].value;)o++;let a=r[o],n=t[o-1],l=i-n.value,x=a.value===n.value?1:l/(a.value-n.value);if("color"===e){let e=r[o],s=t[o-1],a=e.color.clone();p=s.color.r,d=a.r,a.r=(1-x)*p+x*d,c=s.color.g,h=a.g,a.g=(1-x)*c+x*h,m=s.color.b,f=a.b,a.b=(1-x)*m+x*f,y=s.color.a,v=a.a,a.a=(1-x)*y+x*v,u.push({value:i,color:a,label:e.label})}else if("size"===e){let e=r[o],a=t[o-1],n=(0,s.cr)(e.size),l=(g=(0,s.cr)(a.size),(1-x)*g+x*n);u.push({value:i,size:l,label:e.label})}else{let e=r[o],s=(b=t[o-1].opacity,(1-x)*b+x*e.opacity);u.push({value:i,opacity:s,label:e.label})}}return[i,...u,o]}(r,o):function(e){let[t,...i]=e,r=i.pop();for(;i.length>6;){let e=0,t=0;for(let r=1;r<i.length;r++){let o=i[r-1],s=Math.abs(i[r].value-o.value);s>t&&(t=s,e=r)}i.splice(e,1)}return[t,...i,r]}(o)),i):e})}function u(e){if(!e)return!0;switch(e.type){case"dot-density":break;case"heatmap":if(!function(){let{supportsColorBufferFloat:e,supportsColorBufferFloatBlend:t,supportsColorBufferHalfFloat:i}=(0,a.C)();return e&&t||i}()){let e=(0,a.C)(),t=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(t=>!e[t]).join(", ");return n().errorOnce(new r.A("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${t}`)),!1}}return!0}},17569:(e,t,i)=>{i.d(t,{KQ:()=>r,Q4:()=>o,Ss:()=>s});let r=8388607,o=e=>e&r;function s(e,t){return(8388608*!!t|e)>>>0}},25097:(e,t,i)=>{i.d(t,{H:()=>s});var r=i(57845);class o{get forceStaticPath(){return"disabled"===(0,r.A)("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===(0,r.A)("esri-cim-animations-enable-status")}get freezeGlobalTime(){return(0,r.A)("esri-cim-animations-freeze-time")??!1}get spotlightAnimatedSymbols(){return!!(0,r.A)("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==(0,r.A)("esri-cim-animations-freeze-time")}}let s=new o},29742:(e,t,i)=>{i.d(t,{Dr:()=>x,EM:()=>b,Gn:()=>m,IQ:()=>_,Jk:()=>d,NZ:()=>g,TY:()=>u,Zi:()=>h,gF:()=>c,mp:()=>y,oF:()=>f});var r=i(5886),o=i(96657),s=i(46499),a=i(75962),n=i(80841),l=i(90344);function u(e){return e.minScale||e.maxScale?{minScale:e.minScale??0,maxScale:e.maxScale??0}:null}function p(e){if(null==e)return null;if(Array.isArray(e)){let[t,i,r,o]=e;return[t,i,r,255*o]}return"string"==typeof e?e:{...e,defaultValue:p(e?.defaultValue)}}async function d(e,t){let{cimResourceManager:i,cimAnalyzer:o,scaleExpression:s}=t.schemaOptions;await Promise.all(r.wp.fetchResources(e.symbol,i,[]));let l=o.analyzeSymbolReference(e,!1),p={scaleInfo:u(e),scaleExpression:s},d=[];for(let e of l)switch(e.type){case"marker":d.push(...function(e,t,i){let{uniforms:r,schemaOptions:o}=t,{store:s}=o,l=e.isOutline?{...n.Dk,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops}:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue,visualVariableRotation:r.visualVariableRotation};return e.animationParams?c(s.ensureInstance(a.YS.animatedMarker,{uniforms:l,optionalAttributes:{zoomRange:!0}}),e,n.Dk,i):h(s.ensureInstance(a.YS.marker,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,r,i)}(e,t,p));break;case"fill":d.push(...function(e,t,i){if(!e.spriteRasterizationParam){let{uniforms:r,schemaOptions:o}=t,{store:s}=o;return m(s.ensureInstance(a.YS.fill,{uniforms:{visualVariableColor:e.colorLocked?null:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}let{uniforms:r,schemaOptions:o}=t,{store:s}=o;return f(s.ensureInstance(a.YS.complexFill,{uniforms:{visualVariableColor:e.colorLocked?null:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,null!=r.visualVariableColor,i)}(e,t,p));break;case"gradientFill":d.push(...function(e,t,i){let{uniforms:r,schemaOptions:o}=t,{store:s}=o;return y(s.ensureInstance(a.YS.gradientFill,{uniforms:{visualVariableColor:null,visualVariableOpacity:r.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}(e,t,p));break;case"line":d.push(...function(e,t,i){let{uniforms:r,schemaOptions:o}=t,{store:s}=o,l=e.isOutline?{...n.Dk,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops}:{visualVariableColor:e.colorLocked?null:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue},u={uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}},p=!!(l.visualVariableSizeMinMaxValue||l.visualVariableSizeScaleStops||l.visualVariableSizeStops||l.visualVariableSizeUnitValue);return e.spriteRasterizationParam?b(s.ensureInstance(a.YS.texturedLine,u),e,p,i):g(s.ensureInstance(a.YS.line,u),e,p,i)}(e,t,p));break;case"gradientStroke":d.push(...function(e,t,i){let{uniforms:r,schemaOptions:o}=t,{store:s}=o;return x(s.ensureInstance(a.YS.gradientStroke,{uniforms:e.isOutline?{...n.Dk,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops}:{visualVariableColor:null,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}(e,t,p));break;case"text":d.push(...function(e,t,i){let{uniforms:r,schemaOptions:o}=t,{store:s}=o;return _(s.ensureInstance(a.YS.text,{uniforms:{visualVariableColor:e.colorLocked?null:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableRotation:r.visualVariableRotation,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),e,r,i)}(e,t,p))}return d}function c(e,t,i,r){return t.animationParams?[e.createMeshInfo({pixelDimensions:t.pixelDimensions,texelDimensions:t.texelDimensions,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,sprite:t.spriteRasterizationParam,animations:t.animationParams,scaleInfo:r.scaleInfo,scaleSymbolsProportionally:t.scaleSymbolsProportionally,strokeWidth:t.outlineWidth,isMapAligned:t.alignment===s.C1.MAP,colorLocked:t.colorLocked,isStroke:t.isStroke,baseSize:t.baseSize,referenceSize:t.referenceSize,angleToLine:!!t.markerPlacement&&t.markerPlacement.placement&&"angleToLine"in t.markerPlacement.placement&&t.markerPlacement.placement.angleToLine,sizeRatio:t.sizeRatio})]:[]}function h(e,t,i,{scaleInfo:r,scaleExpression:s}){let a=(0,l.I)(i);return[e.createMeshInfo({size:t.size,scaleX:t.scaleX,anchorX:t.anchorPoint.x,anchorY:t.anchorPoint.y,angle:t.rotation,color:p(t.color)??[0,0,0,0],colorLocked:t.colorLocked,frameHeight:t.frameHeight,widthRatio:t.widthRatio,scaleInfo:r,offsetX:t.offsetX,offsetY:t.offsetY,outlineColor:p(t.outlineColor)??[0,0,0,0],outlineSize:t.outlineWidth,referenceSize:t.referenceSize||o.D.CIMVectorMarker.size,rotateClockwise:t.rotateClockwise,scaleFactor:s??1,sizeRatio:t.sizeRatio,alignment:t.alignment,isAbsoluteAnchorPoint:t.isAbsoluteAnchorPoint,scaleSymbolsProportionally:t.scaleSymbolsProportionally,sprite:t.spriteRasterizationParam,hasSizeVV:a,placement:t.markerPlacement,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,transforms:t.transform,minPixelBuffer:(0,n.j0)(i)})]}function m(e,t,{scaleInfo:i}){return[e.createMeshInfo({color:p(t.color)??[0,0,0,0],scaleInfo:i,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function f(e,t,i,{scaleInfo:r}){if(!t.spriteRasterizationParam)throw Error("InternalError: Sprite should always be defined");let o=!!t.hasUnresolvedReplacementColor&&(!i||t.colorLocked),s=t.sampleAlphaOnly&&!o,a=t.spriteRasterizationParam;return[e.createMeshInfo({color:p(t.color)??[0,0,0,0],height:t.height,aspectRatio:t.scaleX,offsetX:t.offsetX,offsetY:t.offsetY,scaleX:1,scaleY:1,angle:t.angle,applyRandomOffset:t.applyRandomOffset,sampleAlphaOnly:s,scaleProportionally:"CIMHatchFill"===a.resource.type,sprite:a,scaleInfo:r,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function y(e,t,{scaleInfo:i}){if(!t.spriteRasterizationParam)throw Error("InternalError: Sprite should always be defined");let r=t.spriteRasterizationParam;return[e.createMeshInfo({color:p(t.color)??[0,0,0,0],angle:t.angle,gradientMethod:t.gradientMethod,gradientSize:t.gradientSize,gradientSizeUnits:t.gradientSizeUnits,gradientType:t.gradientType,sprite:r,scaleInfo:i,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function v(e,t,{scaleInfo:i}){return{color:p(e.color)??[0,0,0,0],width:e.width,referenceWidth:e.referenceWidth,capType:e.cap,joinType:e.join,miterLimit:e.miterLimit,scaleInfo:i,hasSizeVV:t,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null}}function g(e,t,i,r){if(t.spriteRasterizationParam)throw Error("InternalError: Sprite should not be defined");let o=v(t,i,r);return[e.createMeshInfo(o)]}function b(e,t,i,r){let{spriteRasterizationParam:o,scaleDash:s,sampleAlphaOnly:a}=t;if(!o)throw Error("InternalError: Sprite should be defined");return[e.createMeshInfo({...v(t,i,r),offsetAlongLine:t.offsetAlongLine??0,shouldScaleDash:s??!1,shouldSampleAlphaOnly:a,isSDF:"CIMPictureStroke"!==o.resource.type&&"CIMGradientStroke"!==o.resource.type,sprite:o})]}function x(e,t,i){if(!t.spriteRasterizationParam)throw Error("InternalError: Sprite should always be defined");let r=t.spriteRasterizationParam;return[e.createMeshInfo({...v(t,!1,i),gradientMethod:t.gradientMethod,gradientSize:t.gradientSize,gradientSizeUnits:t.gradientSizeUnits,gradientType:t.gradientType,sprite:r,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function _(e,t,i,{scaleInfo:r,scaleExpression:o}){return[e.createMeshInfo({boxBackgroundColor:p(t.backgroundColor),boxBorderLineColor:p(t.borderLineColor),boxBorderLineSize:t.borderLineWidth??0,color:p(t.color)??[0,0,0,0],offsetX:t.offsetX,offsetY:t.offsetY,postAngle:t.angle,fontSize:t.size,referenceSize:t.referenceSize,decoration:t.decoration,haloColor:p(t.haloColor)??[0,0,0,0],haloSize:t.haloSize??0,outlineColor:p(t.outlineColor)??[0,0,0,0],outlineSize:t.outlineSize,lineWidth:t.lineWidth||512,lineHeightRatio:1,horizontalAlignment:t.horizontalAlignment??"center",verticalAlignment:t.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:t.textRasterizationParam,scaleInfo:r,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,placement:t.markerPlacement,transforms:t.transform,scaleFactor:o??1,minPixelBuffer:(0,n.j0)(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}},35161:(e,t,i)=>{i.d(t,{c:()=>r});let r={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}}},37390:(e,t,i)=>{var r;i.d(t,{$w:()=>p,Fb:()=>n,Fz:()=>y,H_:()=>r,J5:()=>l,M:()=>c,Ni:()=>d,V5:()=>a,Xx:()=>f,YV:()=>_,au:()=>u,b5:()=>g,bg:()=>b,cZ:()=>S,cn:()=>m,eo:()=>w,kx:()=>v,os:()=>o,qM:()=>h,rp:()=>s,ti:()=>x,v9:()=>z}),function(e){e[e.Geographic=0]="Geographic",e[e.Arithmatic=1]="Arithmatic"}(r||(r={}));let o=3.14159265359/180,s=3.14159265359/128,a=1,n=1.1,l=1,u=24,p=8,d=1e-5,c=.05,h=1e-30,m=4,f=0,y=2,v=2,g=3,b=0,x=3,_=0x1000000,w=1.1,S=16,z=128},37699:(e,t,i)=>{function r(e,t){let i=e.slice(0,t),r=t-i.length;for(let e=0;e<r;e++){let e=i[i.length-1];i.push(e)}return i}function o(e){if(!e)return[0,0,0,0];let{r:t,g:i,b:r,a:o}=e;return[o/255*t,o/255*i,o/255*r,o]}i.d(t,{p:()=>o,r:()=>r})},38526:(e,t,i)=>{i.d(t,{F:()=>d});var r=i(81856),o=i(28690),s=i(57845),a=i(69358),n=i(45257),l=i(91838);i(61939),i(33638);var u=i(12709),p=i(18524);let d=class extends o.A{constructor(e){super(e),this.debugName="",this._updatingHandles=new p.U,this._idToUpdatingState=new a.A}get updating(){let e=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(e=>e);if((0,s.A)("esri-2d-log-updating")){let t=Array.from(this._idToUpdatingState.entries()).map(([e,t])=>`-> ${e}: ${t}`).join("\n");console.log(`${this.debugName}: Updating: ${e}
-> Handles: ${this._updatingHandles.updating}
${t}`)}return e}addUpdateTracking(e,t){let i=(0,n.wB)(()=>t.updating,t=>this._idToUpdatingState.set(e,t),{sync:!0});this.addHandles(i)}addPromise(e){return this._updatingHandles.addPromise(e)}};(0,r._)([(0,l.MZ)({constructOnly:!0})],d.prototype,"debugName",void 0),(0,r._)([(0,l.MZ)({readOnly:!0})],d.prototype,"updating",null),d=(0,r._)([(0,u.$)("esri.views.2d.layers.support.UpdateTracking2D")],d)},42646:(e,t,i)=>{i.d(t,{Q:()=>o,m:()=>r});let r={linear:0,rectangular:1,circular:2},o={isAbsolute:0,isDiscrete:1}},48653:(e,t,i)=>{i.d(t,{g:()=>l});var r=i(86524),o=i(82307),s=i(93446),a=i(99419);let n={position:{type:s.pe.SHORT,count:2}};class l extends o.e{static create(e,t){let i=[],{stride:o}=t;if(null==o)for(let[e,{count:i,type:s,offset:a}]of(o=0,Object.entries(t.layout))){if(null!=a)throw Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");o+=i*r.I[s]}let s=0;for(let[e,{count:n,offset:l,type:u,normalized:p}]of Object.entries(t.layout)){null!=l&&(s=l);let t=new a._(e,n,u,s,o,null!=p&&p,0);i.push(t),s+=n*r.I[u]}let n={primitive:t.primitive};null!=t.index&&(n.index="indexData");let{count:u}=t;if(null==u&&Math.floor(u=t.index?t.index.length:t.vertex.byteLength/o)!==u)throw Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${o}.`);let p={start:0,count:u,group:0,primitive:t.primitive},d={vertex:{vertexData:{data:t.vertex,attributes:i}},parts:[p],groups:[n]};return null!=t.index&&(d.index={indexData:{data:t.index}}),new l(e,d,t.layout)}static fromVertexStream(e,t){return l.create(e,{primitive:s.WR.TRIANGLE_STRIP,vertex:new Uint16Array(t),layout:n})}constructor(e,t,i){super(e,t),this._spec=i}bind(e,t,i=0){super.bind(e,t,i)}}},61590:(e,t,i)=>{i.d(t,{QueueProcessor:()=>p});var r=i(40941),o=i(92753),s=i(27298),a=i(69358),n=i(77089),l=i(22303);class u{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class p{constructor(e){this._schedule=null,this._deferreds=new a.A,this._controllers=new a.A,this._processingItems=new a.A,this._pausedSignal=(0,l.v)(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new s.A(e.peeker),this.process=e.process}destroy(){this.clear(),this._schedule=(0,r.xt)(this._schedule)}get updating(){return this.running}get length(){return this._processingItems.size+this._queue.length}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}abort(e){let t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();let e=[];this._controllers.forEach(t=>e.push(t)),this._controllers.clear(),e.forEach(e=>e.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((t,i)=>e(i))}get(e){let t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){let i=this.get(e);if(i)return i;let r=new AbortController,s=null;t&&(s=(0,o.u7)(t,()=>r.abort()));let a=()=>{n.remove(),null!=s&&s.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},n=(0,o.NY)(r.signal,()=>{let t=this._processingItems.get(e);t&&t.controller.abort(),a(),l.reject((0,o.NK)())}),l=(0,o.Tw)();return this._deferreds.set(e,l),this._controllers.set(e,r),l.promise.then(a,a),this._queue.push(e),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){let e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){let e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject((0,o.NK)()),this._removeItem(e)),e}reset(){let e=Array.from(this._processingItems.values());for(let t of(this._processingItems.clear(),e))this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){let e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._pausedSignal.value||this._schedule||(this._schedule=(0,n._)(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){let t;if(null==e)return;let i=new AbortController,r=new u(e,i);this._processingItems.set(e,r);try{t=this.process(e,i.signal)}catch(e){this._processError(r,e)}(0,o.$X)(t)?(r.promise=t,t.then(e=>this._processResult(r,e),e=>this._processError(r,e))):this._processResult(r,t)}}},62062:(e,t,i)=>{i.d(t,{K5:()=>d,Kt:()=>m,M8:()=>n,Rj:()=>f,_9:()=>a,i6:()=>c,mh:()=>p,nb:()=>u,p8:()=>g,tL:()=>l,xf:()=>y,yS:()=>h,zb:()=>v,zy:()=>b});var r=i(94360),o=i(59715),s=i(37390);function a(e){let t=(0,o.fV)(12.9898),i=(0,o.fV)(78.233),r=(0,o.fV)(43758.5453),s=(0,o.Om)(e,(0,o.Zc)(t,i)),a=(0,o.zi)(s,(0,o.fV)(3.14));return(0,o.jc)((0,o.F8)(a).multiply(r))}function n(e){return(0,o.LC)(e,(0,o.fV)(s.qM))}function l(e,t){return e.x.multiply(t.y).subtract(t.x.multiply(e.y))}function u(e){return e.multiply(2).subtract(1)}function p(e,t){let i=(0,o.fV)(2**t);return(0,o.zi)((0,o.RI)(e.divide(i)),(0,o.fV)(2))}function d(e,t){return(0,o.MM)(p(e,t),(0,o.fV)(.5))}function c(e,t){return p(e,t+r.U5)}function h(e,t){return p(e,t)}function m(e){let t=p(e.z,7),i=(0,o.fV)(1).subtract(t),r=e.xyz.subtract((0,o.eR)(0,0,(0,o.fV)(128)));return i.multiply(e).add(t.multiply(r))}function f(e){let t=(0,o.ln)(255/256,255/65536,255/0x1000000,255/0x100000000);return(0,o.Om)(e,t)}function y(e){return(0,o.T9)((0,o.T9)((0,o.T9)(e.x,e.y),e.z),e.w)}function v(e){return new o.nt(1).subtract(e)}function g(e){return e.subtract(new o.nt(1))}function b(e,t){return e.subtract(new o.nt(t))}},66294:(e,t,i)=>{var r;i.d(t,{Aw:()=>n,DN:()=>o,EA:()=>a,Gm:()=>s,t0:()=>r,xq:()=>l});let o="__esri_stream_id__",s="__esri_timestamp__",a="__esri_track_part__",n="__esri_time_received__",l="__esri_track_line__";!function(e){e[e.TrackLine=0]="TrackLine",e[e.LatestObservation=1]="LatestObservation",e[e.PreviousObservation=2]="PreviousObservation"}(r||(r={}))},75962:(e,t,i)=>{i.d(t,{YS:()=>it,n_:()=>ir,Wn:()=>ii});var r,o,s=i(52548),a=i(77804),n=i(81856),l=i(25097),u=i(21866),p=i(59715),d=i(10435);class c extends u.k2{}(0,n._)([(0,u.Pi)(p.nt)],c.prototype,"globalTime",void 0),(0,n._)([(0,u.Pi)(p.ZY)],c.prototype,"animationTextureSize",void 0),(0,n._)([(0,u.Pi)(p.z7)],c.prototype,"animationTexture",void 0),(0,n._)([(0,u.Pi)(p.U)],c.prototype,"toScreen",void 0),(0,n._)([(0,u.Pi)(p.U)],c.prototype,"toNdc",void 0),(0,n._)([(0,u.Pi)(p.nt)],c.prototype,"mapRotation",void 0),(0,n._)([(0,u.Pi)(p.nt)],c.prototype,"pixelRatio",void 0);var h=i(94360),m=i(57845),f=i(62062);class y extends u.k2{getVisualVariableData(e){if(!this._vvData){let t=this.getAttributeDataCoords(e);this._vvData=(0,p.US)(this.visualVariableData,t).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(e){if(!this._uv){let t=(0,f.Kt)(e),i=this.size,r=(0,p.Wh)(t.x),o=(0,p.Wh)(t.y).multiply((0,p.Wh)(256)),s=(0,p.Wh)(t.z).multiply((0,p.Wh)(256)).multiply((0,p.Wh)(256)),a=(0,p.fV)(r.add(o).add(s)),n=(0,p.zi)(a,i),l=a.subtract(n).divide(i);this._uv=new p.ZY(n,l).add(.5).divide(i)}return this._uv}getFilterData(e){let t=this.getAttributeDataCoords(e);return(0,p.US)(this.filterFlags,t).setDebugName("storage0")}getAnimationData(e){let t=this.getAttributeDataCoords(e);return(0,p.US)(this.animation,t).setDebugName("storage1")}getVVData(e){return this.getVisualVariableData(e)}getDataDrivenData0(e){let t=this.getAttributeDataCoords(e);return(0,p.US)(this.dataDriven0,t).setDebugName("storage30")}getDataDrivenData1(e){let t=this.getAttributeDataCoords(e);return(0,p.US)(this.dataDriven1,t).setDebugName("storage31")}getDataDrivenData2(e){let t=this.getAttributeDataCoords(e);return(0,p.US)(this.dataDriven2,t).setDebugName("storage32")}getGPGPUData(e){let t=this.getAttributeDataCoords(e);return(0,p.US)(this.gpgpu,t).setDebugName("storage4")}getLocalTimeOrigin(e){let t=this.getAttributeDataCoords(e);return(0,p.US)(this.localTimeOrigin,t).x.setDebugName("storage5")}getFilterFlags(e){return(0,m.A)("webgl-ignores-sampler-precision")?(0,p.mk)(this.getFilterData(e).x.multiply((0,p.fV)(255))):this.getFilterData(e).x.multiply((0,p.fV)(255))}getLabelVisibility(e){let t=this.getFilterData(e).y.multiply(255);return new p.nt(1).subtract(t)}getAnimationValue(e){return this.getAnimationData(e).x}getSizeValue(e){return this.getVisualVariableData(e).x}getColorValue(e){return this.getVisualVariableData(e).y}getOpacityValue(e){return this.getVisualVariableData(e).z}getRotationValue(e){return this.getVisualVariableData(e).w}}(0,n._)([(0,u.Pi)(p.z7)],y.prototype,"filterFlags",void 0),(0,n._)([(0,u.Pi)(p.z7)],y.prototype,"animation",void 0),(0,n._)([(0,u.Pi)(p.z7)],y.prototype,"gpgpu",void 0),(0,n._)([(0,u.Pi)(p.z7)],y.prototype,"localTimeOrigin",void 0),(0,n._)([(0,u.Pi)(p.z7)],y.prototype,"visualVariableData",void 0),(0,n._)([(0,u.Pi)(p.z7)],y.prototype,"dataDriven0",void 0),(0,n._)([(0,u.Pi)(p.z7)],y.prototype,"dataDriven1",void 0),(0,n._)([(0,u.Pi)(p.z7)],y.prototype,"dataDriven2",void 0),(0,n._)([(0,u.Pi)(p.nt)],y.prototype,"size",void 0);class v extends u.k2{}(0,n._)([(0,u.Pi)(p.nt)],v.prototype,"activeReasons",void 0),(0,n._)([(0,u.Pi)(p.nt)],v.prototype,"highlightAll",void 0);class g extends u.k2{}(0,n._)([(0,u.Pi)(p.ZY)],g.prototype,"position",void 0),(0,n._)([(0,u.Pi)(p.nt)],g.prototype,"distance",void 0),(0,n._)([(0,u.Pi)(p.nt)],g.prototype,"smallSymbolDistance",void 0),(0,n._)([(0,u.Pi)(p.nt)],g.prototype,"smallSymbolSizeThreshold",void 0);class b extends u.k2{}(0,n._)([(0,u.Pi)(p.U)],b.prototype,"displayViewScreenMat3",void 0),(0,n._)([(0,u.Pi)(p.U)],b.prototype,"displayViewMat3",void 0),(0,n._)([(0,u.Pi)(p.U)],b.prototype,"displayMat3",void 0),(0,n._)([(0,u.Pi)(p.U)],b.prototype,"viewMat3",void 0),(0,n._)([(0,u.Pi)(p.U)],b.prototype,"tileMat3",void 0),(0,n._)([(0,u.Pi)(p.nt)],b.prototype,"displayZoomFactor",void 0),(0,n._)([(0,u.Pi)(p.nt)],b.prototype,"requiredZoomFactor",void 0),(0,n._)([(0,u.Pi)(p.ZY)],b.prototype,"tileOffset",void 0),(0,n._)([(0,u.Pi)(p.nt)],b.prototype,"currentScale",void 0),(0,n._)([(0,u.Pi)(p.nt)],b.prototype,"currentZoom",void 0),(0,n._)([(0,u.Pi)(p.nt)],b.prototype,"metersPerSRUnit",void 0),(0,n._)([(0,u.Pi)(p.nt)],b.prototype,"rotation",void 0),(0,n._)([(0,u.Pi)(p.nt)],b.prototype,"pixelRatio",void 0);class x extends u.ZA{}(0,n._)([(0,u.C5)(0,p.eB)],x.prototype,"id",void 0),(0,n._)([(0,u.C5)(1,p.nt)],x.prototype,"bitset",void 0),(0,n._)([(0,u.C5)(2,p.ZY)],x.prototype,"pos",void 0);class _ extends u.Y7{}(0,n._)([(0,u.C5)(14,p.ZY)],_.prototype,"nextPos1",void 0),(0,n._)([(0,u.C5)(15,p.ZY)],_.prototype,"nextPos2",void 0);class w extends u.HS{}class S extends u.A{clip(e,t){let i=new p.nt(0),r=this.storage.getFilterFlags(e);if(i=i.add((0,p.fV)(2).multiply((0,p.fV)(1).subtract((0,f.i6)(r,0)))),this.inside?i=i.add((0,p.fV)(2).multiply((0,p.fV)(1).subtract((0,f.i6)(r,1)))):this.outside?i=i.add((0,p.fV)(2).multiply((0,f.i6)(r,1))):this.highlight&&(i=i.add((0,p.fV)(2).multiply((0,p.fV)(1).subtract(this._checkHighlight(r))))),null!=t){let e=new p.nt(1).subtract((0,p.PM)(t.x,this.view.currentZoom)),r=(0,p.PM)(t.y,this.view.currentZoom);i=i.add(new p.nt(2).multiply(e.add(r)))}return i}getFragmentOutput(e,t,i=new p.nt(1/255)){let r=new u.mm;return r.fragColor=this._maybeWriteHittest(t)??this._maybeHighlight(e,i)??e,r}_maybeHighlight(e,t){return this.highlight?new p.Zb(e.rgb,(0,p.PM)(t,e.a)):null}_checkHighlight(e){let t=this._checkHighlightBit(e,0);for(let i=1;i<h.U5;i++)t=t.add(this._checkHighlightBit(e,i));return(0,p.PM)(new p.nt(.1),t.add(this.highlight.highlightAll))}_checkHighlightBit(e,t){return(0,f.yS)(e,t).multiply((0,f.mh)(this.highlight.activeReasons,t))}maybeRunHittest(e,t,i){if(null==this.hittestRequest)return null;let r=this.hittest(e,t,i),o=(0,p.Tk)((0,p.MM)(r,this.hittestRequest.distance),new p.nt(2),new p.nt(0)),s=this.storage.getAttributeDataCoords(e.id),a=(0,f.nb)(s);o=o.add(this.clip(e.id,e.zoomRange));let n=new p.Zb(new p.nt(1/255),0,0,0);return{glPointSize:new p.nt(1),glPosition:new p.Zb(a,o,1),color:n}}_maybeWriteHittest(e){return null!=this.hittestRequest?e.color:null}}(0,n._)([u.E8],S.prototype,"inside",void 0),(0,n._)([u.E8],S.prototype,"outside",void 0),(0,n._)([(0,u.uK)(v)],S.prototype,"highlight",void 0),(0,n._)([(0,u.Pi)(y)],S.prototype,"storage",void 0),(0,n._)([(0,u.Pi)(b)],S.prototype,"view",void 0),(0,n._)([(0,u.uK)(g)],S.prototype,"hittestRequest",void 0);var z=i(37390);class V extends u.k2{}(0,n._)([(0,u.Pi)(p.ZY)],V.prototype,"size",void 0),(0,n._)([(0,u.Pi)(p.z7)],V.prototype,"texture",void 0);class P extends u.k2{getColor(e,t,i){return(0,p.j1)([(0,p.or)((0,f.M8)(e),i),t],[(0,p.$5)(e,this.values.first()),this.colors.first()],[(0,p.aX)(e,this.values.last()),this.colors.last()],[!0,()=>{let t=this.values.findIndex(t=>(0,p.MM)(t,e)),i=this.values.get(t),r=t.subtract(1),o=this.values.get(r),s=e.subtract(o).divide(i.subtract(o));return(0,p.jh)(this.colors.get(r),this.colors.get(t),s)}])}}(0,n._)([(0,u.Pi)(p.My.ofType(p.Zb,8))],P.prototype,"colors",void 0),(0,n._)([(0,u.Pi)(p.My.ofType(p.nt,8))],P.prototype,"values",void 0);class T extends u.k2{getOpacity(e){return(0,p.j1)([(0,f.M8)(e),new p.nt(1)],[(0,p.$5)(e,this.opacityValues.first()),this.opacities.first()],[(0,p.aX)(e,this.opacityValues.last()),this.opacities.last()],[!0,()=>{let t=this.opacityValues.findIndex(t=>(0,p.MM)(t,e)),i=this.opacityValues.get(t),r=t.subtract(1),o=this.opacityValues.get(r),s=e.subtract(o).divide(i.subtract(o));return(0,p.jh)(this.opacities.get(r),this.opacities.get(t),s)}])}}(0,n._)([(0,u.Pi)(p.My.ofType(p.nt,8))],T.prototype,"opacities",void 0),(0,n._)([(0,u.Pi)(p.My.ofType(p.nt,8))],T.prototype,"opacityValues",void 0);class C extends u.k2{getVVRotationMat4(e){return(0,p.Tk)((0,f.M8)(e),p.$I.identity(),()=>{let t=this.getNormalizedAngle(e).multiply(z.os),i=(0,p.F8)(t),r=(0,p.gn)(t);return new p.$I(r,i,0,0,i.multiply(new p.nt(-1)),r,0,0,0,0,1,0,0,0,0,1)})}getVVRotationMat3(e){return(0,p.Tk)((0,f.M8)(e),p.U.identity(),()=>{let t=this.getNormalizedAngle(e).multiply(z.os),i=(0,p.F8)(t),r=(0,p.gn)(t);return new p.U(r,i,0,i.multiply(new p.nt(-1)),r,0,0,0,1)})}getNormalizedAngle(e){let t=(0,p.LC)(this.rotationType,new p.nt(z.H_.Arithmatic));return(0,p.Tk)(t,new p.nt(90).subtract(e),e)}}(0,n._)([(0,u.Pi)(p.nt)],C.prototype,"rotationType",void 0);class M extends u.k2{getSize(e,t){let i=this.minMaxValueAndSize.xy,r=this.minMaxValueAndSize.zw;return(0,p.Tk)((0,f.M8)(e),t,()=>{let t=e.subtract(i.x).divide(i.y.subtract(i.x)),o=(0,p.qE)(t,new p.nt(0),new p.nt(1));return r.x.add(o.multiply(r.y.subtract(r.x)))})}}(0,n._)([(0,u.Pi)(p.Zb)],M.prototype,"minMaxValueAndSize",void 0);class A extends u.k2{getSizeForViewScale(e){return(0,p.j1)([(0,p.$5)(e,this.values.first()),this.sizes.first()],[(0,p.aX)(e,this.values.last()),this.sizes.last()],[!0,()=>{let t=this.values.findIndex(t=>(0,p.MM)(t,e)),i=this.values.get(t),r=t.subtract(1),o=this.values.get(r),s=e.subtract(o).divide(i.subtract(o));return(0,p.jh)(this.sizes.get(r),this.sizes.get(t),s)}])}}(0,n._)([(0,u.Pi)(p.My.ofType(p.nt,8))],A.prototype,"sizes",void 0),(0,n._)([(0,u.Pi)(p.My.ofType(p.nt,8))],A.prototype,"values",void 0);class O extends u.k2{getSize(e,t){let i=(0,p.j1)([(0,f.M8)(e),t],[(0,p.$5)(e,this.values.first()),this.sizes.first()],[(0,p.aX)(e,this.values.last()),this.sizes.last()],[!0,()=>{let t=this.values.findIndex(t=>(0,p.MM)(t,e)),i=this.values.get(t),r=t.subtract(1),o=this.values.get(r),s=e.subtract(o).divide(i.subtract(o));return(0,p.jh)(this.sizes.get(r),this.sizes.get(t),s)}]);return(0,p.Tk)((0,f.M8)(i),t,i)}}(0,n._)([(0,u.Pi)(p.My.ofType(p.nt,8))],O.prototype,"sizes",void 0),(0,n._)([(0,u.Pi)(p.My.ofType(p.nt,8))],O.prototype,"values",void 0);class R extends u.k2{getSize(e,t){return(0,p.Tk)((0,f.M8)(e),t,e.multiply(this.unitValueToPixelsRatio))}}function F(e){return null!=e.visualVariableSizeMinMaxValue||null!=e.visualVariableSizeScaleStops||null!=e.visualVariableSizeStops||null!=e.visualVariableSizeUnitValue}function D(e,t,i){if(F(e)){let r=e.storage.getSizeValue(t);return e.visualVariableSizeMinMaxValue?.getSize(r,i)??e.visualVariableSizeScaleStops?.getSizeForViewScale(e.view.currentScale)??e.visualVariableSizeStops?.getSize(r,i)??e.visualVariableSizeUnitValue?.getSize(r,i)}return i}function I(e,t,i,r=new p.x(!1)){if(null==e.visualVariableColor)return i;let o=e.storage.getColorValue(t);return e.visualVariableColor.getColor(o,i,r)}function k(e,t){if(null==e.visualVariableOpacity)return new p.nt(1);let i=e.storage.getOpacityValue(t);return e.visualVariableOpacity.getOpacity(i)}function E(e,t){if(null==e.visualVariableRotation)return p.U.identity();let i=e.storage.getRotationValue(t);return e.visualVariableRotation.getVVRotationMat3(i)}(0,n._)([(0,u.Pi)(p.nt)],R.prototype,"unitValueToPixelsRatio",void 0);class Z extends x{}(0,n._)([(0,u.C5)(3,p.Zb)],Z.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0),(0,n._)([(0,u.C5)(4,p.ZY)],Z.prototype,"zoomRange",void 0);class L extends w{}class B extends S{_getScreenPosition(e){let{pos:t,translation:i,rotation:r,scale:o,offset:s,id:a,vvScale:n}=e,l=(function(e,t){if(null==e.visualVariableRotation)return new p.nt(0);let i=e.storage.getRotationValue(t);return e.visualVariableRotation.getNormalizedAngle(i)})(this,a).multiply(Math.PI/180),u=i.x.multiply(4/3),d=i.y.multiply(-1).multiply(4/3),c=(0,p.F8)(l),h=(0,p.gn)(l),m=h.multiply(u).add((0,p.ze)(c).multiply(d)),f=c.multiply(u).add(h.multiply(d)),y=(0,p.F8)(r.subtract(l)),v=(0,p.gn)(r.subtract(l)),g=new p.nt(0),b=new p.nt(1),{pixelRatio:x}=this.animationInfo,_=new p.U(b,g,g,g,b,g,m.multiply(x),f.multiply(x),b),w=new p.U(v,y.multiply(-1),g,y,v,g,0,0,b),S=o.multiply(n).multiply(x).multiply(4/3),z=w.multiply(S),V=this.animationInfo.toScreen.multiply(new p.eB(t,1)),P=_.multiply(V).xy,T=z.multiply(new p.eB(s,0)).xy;return P.add(T)}_clip(e,t){let i=super.clip(e,t),r=(0,p.$5)(this._getLocalTimeOrigin(e),new p.nt(0));return l.H.forceGlobalTimeOrigin||(i=i.add((0,p.j1)([r,()=>new p.nt(2)],[!0,()=>new p.nt(0)]))),i}_getLocalTimeOrigin(e){return this.storage.getLocalTimeOrigin(e)}_toNdc(e){return this.animationInfo.toNdc.multiply(new p.eB(e,1)).xy}_getEvalParams(e,t){let{globalTime:i,animationTextureSize:r,animationTexture:o}=this.animationInfo;return{globalTime:i,localTimeOrigin:this._getLocalTimeOrigin(e.id),animationTextureSize:r,animationTexture:o,pixelDimensions:t}}_getColor(e,t){return(0,p.Tk)((0,p.LC)(t.isSDF,new p.nt(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return(0,p.US)(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){let i=(0,p.US)(this.mosaicInfo.texture,e),r=new p.nt(.5).subtract((0,f.Rj)(i)).multiply(t.distanceToPx).multiply(z.V5),o=(0,p.qE)(new p.nt(.5).subtract(r),new p.nt(0),new p.nt(1)),s=t.color.multiply(o),a=t.outlineSize.multiply(.5),n=(0,p.tn)(r).subtract(a),l=(0,p.qE)(new p.nt(.5).subtract(n),new p.nt(0),new p.nt(1)),u=t.outlineColor.multiply(l);return new p.nt(1).subtract(u.a).multiply(s).add(u)}}function U(e,t,i){let r=e.add(new p.ZY(t,0)),o=(0,p.US)(i.animationTexture,r.add(.5).divide(i.animationTextureSize)).xy;return e=e.add(o),(0,p.om)({animationPointer:e,...i},p.Zb,null,e=>{let{out:t}=e;if(!t)throw Error("out is null");return(0,d.DW)({...e,out:t})})}(0,n._)([(0,u.Pi)(V)],B.prototype,"mosaicInfo",void 0),(0,n._)([(0,u.Pi)(c)],B.prototype,"animationInfo",void 0),(0,n._)([(0,u.uK)(P)],B.prototype,"visualVariableColor",void 0),(0,n._)([(0,u.uK)(T)],B.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,u.uK)(M)],B.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,u.uK)(A)],B.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,u.uK)(O)],B.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,u.uK)(R)],B.prototype,"visualVariableSizeUnitValue",void 0),(0,n._)([(0,u.uK)(C)],B.prototype,"visualVariableRotation",void 0),function(e){e[e.transform=0]="transform",e[e.fromColor=1]="fromColor",e[e.toColor=2]="toColor",e[e.colorMix=3]="colorMix",e[e.toOpacity=4]="toOpacity",e[e.opacityMix=5]="opacityMix"}(r||(r={}));var N=i(35161);function Y(e,t,i){var r;let o=i.subtract(t),s=(r=e.subtract(t),(0,p.Om)(r,(0,p.S8)(o))),a=(0,p.qE)(s.divide((0,p.Bw)(o)),new p.nt(0),new p.nt(1));return(0,p.Io)(e,t.add(a.multiply(i.subtract(t))))}function q(e){let t=(0,p.tn)(e);return(0,p.PM)(t.x.add(t.y).add(t.z),new p.nt(1.05))}function H(e,t,i,r){let o=new p.U(i.x.multiply(r.y).subtract(r.x.multiply(i.y)),r.x.multiply(t.y).subtract(t.x.multiply(r.y)),t.x.multiply(i.y).subtract(i.x.multiply(t.y)),i.y.subtract(r.y),r.y.subtract(t.y),t.y.subtract(i.y),r.x.subtract(i.x),t.x.subtract(r.x),i.x.subtract(t.x)),s=t.x.multiply(i.y.subtract(r.y)),a=i.x.multiply(r.y.subtract(t.y)),n=r.x.multiply(t.y.subtract(i.y)),l=s.add(a).add(n);return new p.nt(1).divide(l).multiply(o.multiply(new p.eB(1,e)))}function j(e,t,i,r){var o;let s=i.subtract(t),a=r.subtract(t),n=(0,f.tL)(s,a),l=(0,p.Uo)((0,p.Xe)(n,new p.nt(z.M)),(0,p.MM)(n,new p.nt(-.05)));return(0,p.j1)([(0,p.Uo)((0,p.AU)(l),(o=e.xy,(0,p.LC)(q(H(o,t,i,r)),new p.nt(1)))),new p.nt(-1)],[!0,()=>{let o=Y(e,t,i),s=Y(e,i,r),a=Y(e,r,t);return(0,p.jk)((0,p.jk)(o,s),a)}])}function K(e){return e.distance.add(1)}function Q(e,t,i){let{viewMat3:r,tileMat3:o}=e.view,s=r.multiply(o),a=s.multiply(new p.eB(t.pos,1)),n=s.multiply(new p.eB(i.nextPos1,1)),l=s.multiply(new p.eB(i.nextPos2,1));return j(e.hittestRequest.position,a.xy,n.xy,l.xy)}class $ extends Z{}(0,n._)([(0,u.C5)(5,p.ZY)],$.prototype,"offset",void 0),(0,n._)([(0,u.C5)(6,p.ZY)],$.prototype,"uv",void 0),(0,n._)([(0,u.C5)(7,p.Zb)],$.prototype,"sizing",void 0),(0,n._)([(0,u.C5)(8,p.nt)],$.prototype,"angle",void 0);class G extends u.Y7{}(0,n._)([(0,u.C5)(12,p.ZY)],G.prototype,"offsetNextVertex1",void 0),(0,n._)([(0,u.C5)(13,p.ZY)],G.prototype,"offsetNextVertex2",void 0),(0,n._)([(0,u.C5)(14,p.ZY)],G.prototype,"textureUVNextVertex1",void 0),(0,n._)([(0,u.C5)(15,p.ZY)],G.prototype,"textureUVNextVertex2",void 0);class W extends L{}function X(e,t,i,r){return t.multiply(e.x).add(i.multiply(e.y)).add(r.multiply(e.z))}class J extends B{constructor(){super(...arguments),this.type="AnimatedMarkerShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}_vertexPreamble(e){let{id:t,pos:i,offset:o,animationPointerAndBaseSizeAndReferenceSize:s,uv:a,sizing:n,angle:l}=e,u=s.xy,d=s.z,c=s.w,h=n.xy,m=n.z,y=(0,f.mh)(e.bitset,N.c.bitset.isStroke),v=n.w,g=(0,f.mh)(e.bitset,N.c.bitset.scaleSymbolsProportionally),b=this._getEvalParams(e,h),x=U(u,r.transform,b),_=(0,p.j1)([(0,p.LC)((0,f.mh)(e.bitset,N.c.bitset.isMapAligned),new p.nt(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new p.nt(0)]),w=new p.Ny((0,p.gn)(_),(0,p.F8)(_.multiply(-1)),(0,p.F8)(_),(0,p.gn)(_)).multiply(x.xy),S=x.z.subtract(_).subtract(l.multiply(z.rp)),V=x.w,P=(0,f.mh)(e.bitset,N.c.bitset.isSDF),T=D(this,t,new p.nt(c)).divide(new p.nt(c));return{baseSize:d,animationPointer:u,strokeWidth:m,isOutline:y,unscaledDistanceToPx:v,scaleSymbolsProportionally:g,isSDF:P,position:this._getScreenPosition({id:t,pos:i,offset:o,referenceSize:c,translation:w,rotation:S,scale:V,vvScale:T}),uv:a,evalParams:b,vvScale:T,scale:V}}vertex(e,t){let{position:i,animationPointer:o,evalParams:s,isOutline:a,unscaledDistanceToPx:n,vvScale:l,uv:u,strokeWidth:d,scaleSymbolsProportionally:c,scale:h,isSDF:m,baseSize:y}=this._vertexPreamble(e),v=this._toNdc(i),g=U(o,r.fromColor,s);g=new p.Zb(g.rgb.multiply(g.a),g.a);let b=U(o,r.toColor,s);b=new p.Zb(b.rgb.multiply(b.a),b.a);let x=U(o,r.colorMix,s);x=new p.Zb(x.rgb.multiply(x.a),x.a);let _=U(o,r.toOpacity,s).a,w=U(o,r.opacityMix,s).a,S=I(this,e.id,g,(0,p.or)((0,f.K5)(e.bitset,N.c.bitset.colorLocked),new p.x(a))),z=(0,p.jh)(S,b,x),V=k(this,e.id),P=(0,p.jh)(V,_,w),T=z.multiply(P),C=this.clip(e.id,e.zoomRange),M=n.multiply(l);return{glPosition:new p.Zb(v,C,1),uv:u.divide(this.mosaicInfo.size),color:T.multiply(new p.nt(1).subtract(a)),outlineColor:T.multiply(a),distanceToPx:M,strokeWidth:d.multiply((0,p.jh)(new p.nt(1),h,c)),isOutline:a,isSDF:m,...this.maybeRunHittest(e,t,{pos:e.pos,size:y,sizeCorrection:new p.nt(1),isMapAligned:new p.nt(1),vvRotationMat3:new p.U(1,0,0,0,1,0,0,0,1),placementMat3:new p.U(1,0,0,0,1,0,0,0,1),outlineSize:new p.nt(1),distanceToPx:M,isSDF:m})}}fragment(e){let t=this._getColor(e.uv,{color:e.color,distanceToPx:e.distanceToPx,isSDF:e.isSDF,outlineColor:e.outlineColor,outlineSize:e.strokeWidth});return l.H.spotlightAnimatedSymbols&&(t=t.add(new p.Zb(0,.3,0,.3))),this.getFragmentOutput(t,e)}hittest(e,t,i){return(0,p.Tk)((0,p.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(e,t,i),this._hittestMarker(e,t,i))}_hittestSmallMarker(e,t,i){let{position:r,distance:o,smallSymbolDistance:s}=this.hittestRequest,a=o.subtract(s),{viewMat3:n,tileMat3:l}=this.view,u=n.multiply(l).multiply(new p.eB(i.pos,1)).xy,d=i.size.multiply(.5);return(0,p.Io)(u,r).subtract(d).add(a)}_hittestMarker(e,t,i){let r=this._vertexPreamble({...e}).position,o=this._vertexPreamble({...e,offset:t.offsetNextVertex1,uv:t.textureUVNextVertex1}).position,s=this._vertexPreamble({...e,offset:t.offsetNextVertex2,uv:t.textureUVNextVertex2}).position,a=this.hittestRequest.position,n=this.hittestRequest.distance,l=j(a,r,o,s);return(0,p.Tk)((0,p.MM)(l,n),l,this._hittestSamples(r,o,s,e,t,i))}_hittestSamples(e,t,i,r,o,s){let{outlineSize:a,isSDF:n,distanceToPx:l}=s,u=this.hittestRequest.position,d=this.hittestRequest.distance,c=H(u.add(new p.ZY((0,p.ze)(d),(0,p.ze)(d))),e,t,i),h=H(u.add(new p.ZY(0,(0,p.ze)(d))),e,t,i),m=H(u.add(new p.ZY(d,(0,p.ze)(d))),e,t,i),f=H(u.add(new p.ZY((0,p.ze)(d),0)),e,t,i),y=H(u,e,t,i),v=H(u.add(new p.ZY(d,0)),e,t,i),g=H(u.add(new p.ZY((0,p.ze)(d),d)),e,t,i),b=H(u.add(new p.ZY(0,d)),e,t,i),x=H(u.add(new p.ZY(d,d)),e,t,i),_=r.uv.divide(this.mosaicInfo.size),w=o.textureUVNextVertex1.divide(this.mosaicInfo.size),S=o.textureUVNextVertex2.divide(this.mosaicInfo.size),z={color:new p.Zb(1,1,1,1),outlineSize:a,outlineColor:new p.Zb(1,1,1,1),isSDF:n,distanceToPx:l},V=new p.nt(0);return V=(V=(V=(V=(V=(V=(V=(V=(V=V.add(q(c).multiply(this._getColor(X(c,_,w,S),z).a))).add(q(h).multiply(this._getColor(X(h,_,w,S),z).a))).add(q(m).multiply(this._getColor(X(m,_,w,S),z).a))).add(q(f).multiply(this._getColor(X(f,_,w,S),z).a))).add(q(y).multiply(this._getColor(X(y,_,w,S),z).a))).add(q(v).multiply(this._getColor(X(v,_,w,S),z).a))).add(q(g).multiply(this._getColor(X(g,_,w,S),z).a))).add(q(b).multiply(this._getColor(X(b,_,w,S),z).a))).add(q(x).multiply(this._getColor(X(x,_,w,S),z).a)),(0,p.PM)(V,new p.nt(.05)).multiply(K(this.hittestRequest))}}(0,n._)([(0,n.a)(0,(0,u.hF)($)),(0,n.a)(1,(0,u.hF)(G))],J.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(W))],J.prototype,"fragment",null);var ee=i(6815),et=i(19284),ei=i(90476);class er extends ei.j{constructor(){super(...arguments),this.symbologyPlane=s.uC.FILL,this._input=null}}var eo=i(74723);class es extends er{render(e,t){let{context:i,painter:r}=e,{target:o}=t,{freezeGlobalTime:s}=l.H,a=r.textureManager.animationStore.getTexture(i,0),n=[2/e.state.size[0],0,0,0,-2/e.state.size[1],0,-1,1,1],u=Array.from((0,ee.B8)((0,et.vt)(),n)),p=Array.from((0,ee.lw)((0,et.vt)(),u,o.transforms.displayViewScreenMat3)),d=t.instance.getInput();r.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,d.uniforms),...(0,eo.QA)(e,t.target),mosaicInfo:r.textureManager.getMosaicInfo(i,t.textureKey,!0),animationInfo:{globalTime:!1===s?e.time/1e3:s,animationTextureSize:[a.descriptor.width,a.descriptor.height],animationTexture:{unit:6,texture:a},toScreen:p,toNdc:n,mapRotation:e.state.rotation,pixelRatio:e.state.pixelRatio}},defines:{...(0,eo.vT)(e)},optionalAttributes:{zoomRange:!0},useComputeBuffer:!0}),r.setPipelineState({...(0,eo.Qu)(e)}),r.submitDraw(e,t),!1===s&&o.requestRender()}}class ea extends es{constructor(){super(...arguments),this.type=a.N.AnimatedMarker,this.symbologyPlane=s.uC.MARKER,this.shaders={geometry:new J}}}class en extends u.ZA{}(0,n._)([(0,u.C5)(0,p.ZY)],en.prototype,"pos",void 0);class el extends w{}class eu extends u.k2{}(0,n._)([(0,u.Pi)(p.nt)],eu.prototype,"dotSize",void 0);class ep extends u.k2{}(0,n._)([(0,u.Pi)(p.z7)],ep.prototype,"locations",void 0),(0,n._)([(0,u.Pi)(p.nt)],ep.prototype,"pixelRatio",void 0),(0,n._)([(0,u.Pi)(p.nt)],ep.prototype,"tileZoomFactor",void 0);class ed extends u.A{constructor(){super(...arguments),this.type="DotDensityPointShader"}vertex(e){let t=new p.U(1,0,0,0,-1,0,0,1,1).multiply(new p.eB(e.pos.xy.divide(h.CQ),1)),i=(0,p.US)(this.draw.locations,t.xy),r=(0,p.T9)(this.instance.dotSize.divide(2),new p.nt(1)),o=new p.nt(0);o=o.add((0,p.PM)(i.a,new p.nt(1e-6)).multiply(2));let s=r.add(this.instance.dotSize),a=this.view.displayViewScreenMat3.multiply(new p.eB(e.pos.add(.5),1)),n=new p.Zb(a.xy,o,1),l=this.instance.dotSize.divide(s),u=new p.nt(-1).divide(r.divide(s));return{glPosition:n,glPointSize:s=s.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),color:i,ratio:l,invEdgeRatio:u}}fragment(e){let t=(0,p.Bw)(e.glPointCoord.subtract(.5)).multiply(2),i=(0,p.TF)(new p.nt(0),new p.nt(1),e.invEdgeRatio.multiply(t.subtract(e.ratio)).add(1)),r=new u.mm;return r.fragColor=e.color.multiply(i),r}}(0,n._)([(0,u.Pi)(eu)],ed.prototype,"instance",void 0),(0,n._)([(0,u.Pi)(ep)],ed.prototype,"draw",void 0),(0,n._)([(0,u.Pi)(b)],ed.prototype,"view",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(en))],ed.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(el))],ed.prototype,"fragment",null);class ec extends x{}(0,n._)([(0,u.C5)(3,p.nt)],ec.prototype,"inverseArea",void 0);class eh extends u.k2{}(0,n._)([(0,u.Pi)(p.My.ofType(p.Zb,2))],eh.prototype,"isActive",void 0),(0,n._)([(0,u.Pi)(p.My.ofType(p.Zb,8))],eh.prototype,"colors",void 0),(0,n._)([(0,u.Pi)(p.nt)],eh.prototype,"dotValue",void 0);class em extends u.k2{}(0,n._)([(0,u.Pi)(p.z7)],em.prototype,"dotTexture0",void 0),(0,n._)([(0,u.Pi)(p.z7)],em.prototype,"dotTexture1",void 0),(0,n._)([(0,u.Pi)(p.nt)],em.prototype,"tileZoomFactor",void 0),(0,n._)([(0,u.Pi)(p.nt)],em.prototype,"pixelRatio",void 0),(0,n._)([(0,u.Pi)(p.nt)],em.prototype,"tileDotsOverArea",void 0);class ef extends S{constructor(){super(...arguments),this.type="DotDensityPolygonShader"}_dotThreshold(e,t,i){return e.divide(t).divide(i)}vertex(e){let t=new p.U(2/h.CQ,0,0,0,-2/h.CQ,0,-1,1,1).multiply(new p.eB(e.pos,1)),i=this.clip(e.id),r=new p.Zb(t.xy,i,1),o=this.storage.getVVData(e.id).multiply(this.instance.isActive.get(0)).multiply(e.inverseArea),s=this.storage.getDataDrivenData0(e.id).multiply(this.instance.isActive.get(1)).multiply(e.inverseArea),a=this.draw.tileZoomFactor.multiply(h.CQ).divide(this.draw.pixelRatio),n=this._dotThreshold(o,this.instance.dotValue,this.draw.tileDotsOverArea),l=this._dotThreshold(s,this.instance.dotValue,this.draw.tileDotsOverArea),u=e.pos.add(.5).divide(a);return{glPosition:r,color:new p.Zb(0,0,0,0),textureCoords:u,thresholds0:n,thresholds1:l}}fragment(e){let t,i=new u.mm,r=(0,p.US)(this.draw.dotTexture0,e.textureCoords),o=(0,p.US)(this.draw.dotTexture1,e.textureCoords),s=e.thresholds0.subtract(r),a=e.thresholds1.subtract(o),n=p.$I.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),l=p.$I.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){let e=(0,p.PM)(new p.nt(0),s),i=(0,p.PM)(new p.nt(0),a),r=(0,p.Om)(e,s).add((0,p.Om)(i,a)),o=(0,p.PM)(r,new p.nt(0)),u=new p.nt(1).subtract(o),d=r.add(o),c=s.multiply(e).divide(d),h=a.multiply(i).divide(d),m=n.multiply(c).add(l.multiply(h));t=u.multiply(m)}else{let e=(0,p.T9)((0,f.xf)(s),(0,f.xf)(a)),i=(0,p.PM)(e,new p.nt(0)),r=new p.nt(1).subtract(i),o=(0,p.PM)(e,s),u=(0,p.PM)(e,a),d=n.multiply(o).add(l.multiply(u));t=r.multiply(d)}return i.fragColor=t,i}hittest(e){return K(this.hittestRequest)}}(0,n._)([u.E8],ef.prototype,"blending",void 0),(0,n._)([(0,u.Pi)(eh)],ef.prototype,"instance",void 0),(0,n._)([(0,u.Pi)(em)],ef.prototype,"draw",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(ec))],ef.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(w))],ef.prototype,"fragment",null);var ey=i(33638),ev=i(48653),eg=i(93446),eb=i(98232),ex=i(52566),e_=i(7299),ew=i(87155),eS=i(15494);let ez={pos:{count:2,type:eg.pe.UNSIGNED_SHORT}};class eV{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(e){if(null==this._dotFBO){let t=h.CQ,i=h.CQ,r=new eS.R(t,i);r.samplingMode=eg.Cj.NEAREST,r.wrapMode=eg.pF.CLAMP_TO_EDGE;let o=new ex.l(e,new e_.q(eg.yQ.DEPTH_STENCIL,t,i));this._dotFBO=new eb.H(e,r,o)}return this._dotFBO}getDotDensityMesh(e){if(null==this._dotMesh){let t=h.CQ,i=t*t,r=new Int16Array(2*i);for(let e=0;e<t;e++)for(let i=0;i<t;i++)r[2*(i+e*t)]=i,r[2*(i+e*t)+1]=e;this._dotMesh=ev.g.create(e,{primitive:eg.WR.POINTS,vertex:r,count:i,layout:ez})}return this._dotMesh}getDotDensityTextures(e,t,i){if(this._dotTextureSize===t&&this._seed===i||(this._disposeTextures(),this._dotTextureSize=t,this._seed=i),null===this._dotTextures){let r=new ey.A(i);this._dotTextures=[this._allocDotDensityTexture(e,t,r),this._allocDotDensityTexture(e,t,r)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let e=0;e<this._dotTextures.length;e++)this._dotTextures[e].dispose();this._dotTextures=null}}_allocDotDensityTexture(e,t,i){let r=new Float32Array(t*t*4);for(let e=0;e<r.length;e++)r[e]=i.getFloat();let o=new eS.R;return o.dataType=eg.ld.FLOAT,o.samplingMode=eg.Cj.NEAREST,o.width=t,o.height=t,new ew.g(e,o,r)}}class eP extends x{}(0,n._)([(0,u.C5)(3,p.Zb)],eP.prototype,"color",void 0),(0,n._)([(0,u.C5)(4,p.ZY)],eP.prototype,"zoomRange",void 0);class eT extends S{constructor(){super(...arguments),this.type="FillShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){let i=k(this,e.id),r=I(this,e.id,e.color).multiply(i),o=this.view.displayViewScreenMat3.multiply(new p.eB(e.pos.xy,1)),s=this.clip(e.id,e.zoomRange);return{glPosition:new p.Zb(o.xy,s,1),color:r,...this.maybeRunHittest(e,t,null)}}fragment(e){return this.getFragmentOutput(e.color,e,new p.nt(0))}hittest(e,t){return Q(this,e,t)}}(0,n._)([(0,u.uK)(P)],eT.prototype,"visualVariableColor",void 0),(0,n._)([(0,u.uK)(T)],eT.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(eP)),(0,n.a)(1,(0,u.hF)(_))],eT.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(w))],eT.prototype,"fragment",null);class eC extends er{constructor(){super(...arguments),this.type=a.N.DotDensity,this.shaders={polygon:new ef,point:new ed,fill:new eT},this._resources=new Map}render(e,t){(0,eo.dJ)(e)||(0,eo.Eq)(e)?this._renderPolygons(e,t):this._renderDotDensity(e,t)}_renderPolygons(e,t){let{painter:i}=e;i.setShader({shader:this.shaders.fill,uniforms:{...(0,eo.QA)(e,t.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,eo.vT)(e)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,eo.Eq)(e)}),i.setPipelineState((0,eo.Qu)(e)),i.submitDraw(e,t)}_renderDotDensity(e,t){let{context:i,painter:r,requiredLevel:o}=e,s=t.instance.getInput().uniforms,a=this._getOrCreateResourcesRecord(i),n=a.getDotDensityTextures(i,h.CQ,s.seed),l=1/2**(o-t.target.key.level),u=h.CQ,p=u*window.devicePixelRatio*u*window.devicePixelRatio,d=1/l*(1/l),c=s.dotScale?e.state.scale/s.dotScale:1,m=s.dotValue*c*d;r.setShader({shader:this.shaders.polygon,uniforms:{...(0,eo.QA)(e,t.target),instance:{isActive:s.isActive,colors:s.colors,dotValue:Math.max(1,m)},draw:{dotTexture0:{unit:h.Cp,texture:n[0]},dotTexture1:{unit:h.vN,texture:n[1]},tileZoomFactor:l,pixelRatio:window.devicePixelRatio,tileDotsOverArea:p/(h.CQ*window.devicePixelRatio*h.CQ*window.devicePixelRatio)}},defines:{...(0,eo.vT)(e),blending:s.blending},optionalAttributes:{},useComputeBuffer:!1});let f=i.getViewport();i.setViewport(0,0,h.CQ,h.CQ);let y=i.getBoundFramebufferObject(),v=a.getFBO(i);i.bindFramebuffer(v),i.setClearColor(0,0,0,0),i.clear(eg.NV.COLOR),r.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),r.updatePipelineState(i),r.submitDraw(e,t),i.bindFramebuffer(y),i.setViewport(f.x,f.y,f.width,f.height);let g=a.getFBO(i).colorTexture,b={shader:this.shaders.point,uniforms:{view:(0,eo.L4)(e,t.target),instance:{dotSize:s.dotSize},draw:{locations:{unit:h.Cp,texture:g},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,eo.vT)(e)},optionalAttributes:{},useComputeBuffer:!1};r.setPipelineState((0,eo.Qu)(e)),r.submitDrawMesh(i,b,a.getDotDensityMesh(i))}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e)}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new eV,this._resources.set(e,t)),t}}class eM extends u.k2{getPatternOffsetAtTileOrigin(e,t=new p.nt(0),i=new p.nt(1)){let r=new p.ZY(z.YV).divide(e),o=e.multiply((0,p.jc)(this.maxIntsToLocalOrigin.multiply(r))).add(this.tileOffsetFromLocalOrigin).subtract(new p.nt(.5).multiply(e));return o=new p.ZY(o.x.multiply(i).subtract(o.y.multiply(t)),o.x.multiply(t).add(o.y.multiply(i))),(0,p.zi)(o,e)}}(0,n._)([(0,u.Pi)(p.ZY)],eM.prototype,"tileOffsetFromLocalOrigin",void 0),(0,n._)([(0,u.Pi)(p.ZY)],eM.prototype,"maxIntsToLocalOrigin",void 0);class eA extends eP{}(0,n._)([(0,u.C5)(5,p.Zb)],eA.prototype,"tlbr",void 0),(0,n._)([(0,u.C5)(6,p.nt)],eA.prototype,"width",void 0),(0,n._)([(0,u.C5)(7,p.nt)],eA.prototype,"height",void 0),(0,n._)([(0,u.C5)(8,p.ZY)],eA.prototype,"offset",void 0),(0,n._)([(0,u.C5)(9,p.ZY)],eA.prototype,"scale",void 0),(0,n._)([(0,u.C5)(10,p.nt)],eA.prototype,"angle",void 0);class eO extends w{}function eR(e,t){let i=e.view.requiredZoomFactor,r=new p.ZY(t.width,t.height),o=r.multiply(t.scale).multiply(i),s=t.angle.multiply(z.rp),a=(0,p.F8)(s),n=(0,p.gn)(s),l=function(e,t,i,r,o){let s=(0,p.LC)((0,f.mh)(o,z.Fz),(0,p.fV)(1)),a=(0,f.Rj)(new p.Zb(e,0));return(0,p.Tk)(s,(0,p.w0)(r.divide(t.x),i.divide(t.y),0,(0,p.ze)(i.divide(t.x)),r.divide(t.y),0,(0,f._9)((0,p.Zc)(a,0)),(0,f._9)((0,p.Zc)(0,a)),1),(0,p.w0)(r.divide(t.x),i.divide(t.y),0,(0,p.ze)(i.divide(t.x)),r.divide(t.y),0,0,0,1))}(t.id,o,a,n,t.bitset),u=e.localTileOffset.getPatternOffsetAtTileOrigin(r,a,n),d=i.multiply(t.scale).multiply(t.offset.subtract(u)).divide(o),c=new p.eB(t.pos,1),h=l.multiply(c).xy.subtract(d),m=t.tlbr.divide(e.mosaicInfo.size.xyxy),y=(0,f.mh)(t.bitset,z.cn);return null!=e.visualVariableColor&&(y=(0,p.Tk)((0,f.M8)(e.storage.getColorValue(t.id)),new p.nt(0),y)),{tileTextureCoord:h,tlbr:m,sampleAlphaOnly:y}}function eF(e,t){let i=(0,p.zi)(t.tileTextureCoord,new p.nt(1)),r=(0,p.jh)(t.tlbr.xy,t.tlbr.zw,i),o=(0,p.US)(e.mosaicInfo.texture,r);return o=(0,p.Tk)((0,p.MM)(t.sampleAlphaOnly,new p.nt(.5)),o.aaaa,o),t.color.multiply(o)}class eD extends eT{constructor(){super(...arguments),this.type="ComplexFillShader"}vertex(e,t){return{...super.vertex(e,t),...eR(this,e)}}fragment(e){let t=eF(this,e);return this.getFragmentOutput(t,e,new p.nt(0))}}(0,n._)([(0,u.Pi)(V)],eD.prototype,"mosaicInfo",void 0),(0,n._)([(0,u.Pi)(eM)],eD.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(eA)),(0,n.a)(1,(0,u.hF)(_))],eD.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(eO))],eD.prototype,"fragment",null);class eI extends er{constructor(){super(...arguments),this.type=a.N.ComplexFill,this.shaders={geometry:new eD}}render(e,t){let{context:i,painter:r}=e,o=t.instance.getInput();r.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,o.uniforms),...(0,eo.QA)(e,t.target),mosaicInfo:r.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,eo.Pr)(t.target)},defines:{...(0,eo.vT)(e)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}),r.setPipelineState((0,eo.Qu)(e)),r.submitDraw(e,t)}}function ek(e){let t=1/e;return{antialiasing:t,blur:0+t}}class eE extends x{}(0,n._)([(0,u.C5)(3,p.Zb)],eE.prototype,"color",void 0),(0,n._)([(0,u.C5)(4,p.ZY)],eE.prototype,"offset",void 0),(0,n._)([(0,u.C5)(5,p.ZY)],eE.prototype,"normal",void 0),(0,n._)([(0,u.C5)(6,p.nt)],eE.prototype,"halfWidth",void 0),(0,n._)([(0,u.C5)(7,p.nt)],eE.prototype,"referenceHalfWidth",void 0),(0,n._)([(0,u.C5)(8,p.ZY)],eE.prototype,"zoomRange",void 0);class eZ extends w{}class eL extends u.k2{}function eB(e){return(0,p.T9)(new p.nt(z.Fb).multiply((0,p.PM)(e,new p.nt(z.J5))),new p.nt(1))}function eU(e,t){let{halfWidth:i,normal:r}=e,o=eB(i),s=(0,p.Bw)(r).multiply(i);return(0,p.qE)(o.multiply(i.subtract(s)).divide(t.add(o).subtract(new p.nt(1))),new p.nt(0),new p.nt(1))}function eN(e,t){let{id:i,offset:r,pos:o,normal:s,zoomRange:a}=t,{displayViewScreenMat3:n,displayViewMat3:l}=e.view,u=I(e,i,t.color),d=k(e,i),c=function(e,t){let{id:i,halfWidth:r,referenceHalfWidth:o}=t;if(F(e)){let t=D(e,i,new p.nt(2).multiply(o));return new p.nt(.5).multiply(r.divide((0,p.T9)(o,new p.nt(z.Ni)))).multiply(t)}return r}(e,t),h=new p.nt(.5).multiply(e.antialiasingControls.antialiasing),m=(0,p.T9)(c.add(h),new p.nt(.45)).add(new p.nt(.1).multiply(h)),f=eB(m).multiply(m).multiply(r),y=l.multiply(new p.eB(f,new p.nt(0))),v=n.multiply(new p.eB(o,new p.nt(1))).add(y),g=new p.nt(2).multiply((0,p.PM)(c,new p.nt(0))).add(e.clip(i,a)),b=new p.Zb(v.xy,g,1);return{color:u,opacity:d,halfWidth:m,normal:s,scaledOffset:f,scaledHalfWidth:c,glPosition:new p.Zb(b.xy,g,1)}}function eY(e,t){let{opacity:i,color:r}=e,o=eU(e,t);return i.multiply(r).multiply(o)}(0,n._)([(0,u.Pi)(p.nt)],eL.prototype,"antialiasing",void 0),(0,n._)([(0,u.Pi)(p.nt)],eL.prototype,"blur",void 0);class eq extends S{constructor(){super(...arguments),this.type="LineShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){let i=eN(this,e);return{...i,...this.maybeRunHittest(e,t,i.halfWidth)}}fragment(e){let t=eY(e,this.antialiasingControls.blur);return this.getFragmentOutput(t,e)}hittest(e,t,i){let{viewMat3:r,tileMat3:o}=this.view,s=r.multiply(o),a=s.multiply(new p.eB(e.pos,1)),n=s.multiply(new p.eB(t.nextPos1,1)),l=s.multiply(new p.eB(t.nextPos2,1)),{distance:u,smallSymbolDistance:d,smallSymbolSizeThreshold:c}=this.hittestRequest,h=(0,p.PM)(i,c.multiply(.5)).multiply(u.subtract(d)),m=this.hittestRequest.position;return(0,p.jk)(Y(m,a.xy,n.xy),Y(m,a.xy,l.xy)).subtract(i).add(h)}}(0,n._)([(0,u.Pi)(eL)],eq.prototype,"antialiasingControls",void 0),(0,n._)([(0,u.uK)(P)],eq.prototype,"visualVariableColor",void 0),(0,n._)([(0,u.uK)(T)],eq.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,u.uK)(M)],eq.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,u.uK)(A)],eq.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,u.uK)(O)],eq.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,u.uK)(R)],eq.prototype,"visualVariableSizeUnitValue",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(eE)),(0,n.a)(1,(0,u.hF)(_))],eq.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(eZ))],eq.prototype,"fragment",null);class eH extends x{}(0,n._)([(0,u.C5)(3,p.ZY)],eH.prototype,"offset",void 0),(0,n._)([(0,u.C5)(4,p.Zb)],eH.prototype,"color",void 0),(0,n._)([(0,u.C5)(5,p.ZY)],eH.prototype,"normal",void 0),(0,n._)([(0,u.C5)(6,p.nt)],eH.prototype,"halfWidth",void 0),(0,n._)([(0,u.C5)(7,p.nt)],eH.prototype,"referenceHalfWidth",void 0),(0,n._)([(0,u.C5)(8,p.ZY)],eH.prototype,"zoomRange",void 0);class ej extends eZ{}function eK(e,t,i){let{id:r,bitset:o}=t,s=(0,f.mh)(o,z.Xx),a=(0,p.MM)(s,new p.nt(.5)),n=eN(e,t),l=(0,p.Tk)(a,n.halfWidth,new p.nt(0)),u=k(e,r),d=I(e,r,t.color),c=(0,p.Tk)(a,t.color,d.multiply(u)),h=e.view.displayViewScreenMat3.multiply(new p.eB(t.pos.xy,1)),m=e.clip(t.id),y=new p.Zb(h.xy,m,1),v=(0,p.Tk)(a,n.glPosition,y),g=i&&e.maybeRunHittest(t,i,a);return{isOutline:s,color:c,opacity:new p.nt(1),halfWidth:l,normal:n.normal,glPosition:v,...g}}class eQ extends S{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,n._)([(0,u.Pi)(eL)],eQ.prototype,"antialiasingControls",void 0),(0,n._)([(0,u.uK)(P)],eQ.prototype,"visualVariableColor",void 0),(0,n._)([(0,u.uK)(T)],eQ.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,u.uK)(M)],eQ.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,u.uK)(A)],eQ.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,u.uK)(O)],eQ.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,u.uK)(R)],eQ.prototype,"visualVariableSizeUnitValue",void 0);class e$ extends eQ{constructor(){super(...arguments),this.type="OutlineFillShader"}vertex(e,t){return eK(this,e,t)}fragment(e){let{color:t,isOutline:i}=e,r=(0,p.MM)(i,new p.nt(.5)),o=eY(e,this.antialiasingControls.blur),s=(0,p.Tk)(r,o,t),a=(0,p.Tk)(r,new p.nt(1/255),new p.nt(0));return this.getFragmentOutput(s,e,a)}hittest(e,t,i){return(0,p.Tk)(i,K(this.hittestRequest),Q(this,e,t))}}(0,n._)([(0,n.a)(0,(0,u.hF)(eH)),(0,n.a)(1,(0,u.hF)(_))],e$.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(ej))],e$.prototype,"fragment",null);class eG extends eP{}(0,n._)([(0,u.C5)(5,p.Zb)],eG.prototype,"tlbr",void 0),(0,n._)([(0,u.C5)(6,p.nt)],eG.prototype,"inverseRasterizationScale",void 0);class eW extends w{}function eX(e,t){let i=t.tlbr.xy,r=t.tlbr.zw,o=r.x.subtract(i.x),s=i.y.subtract(r.y),a=new p.ZY(o,s).multiply(t.inverseRasterizationScale),n=a.multiply(e.view.requiredZoomFactor),l=function(e){let t=new p.nt(1),i=new p.nt(0);return new p.U(t.divide(e.x),i.divide(e.y),0,(0,p.ze)(i.divide(e.x)),t.divide(e.y),0,0,0,1)}(n),u=e.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(n),d=new p.eB(t.pos,1);return{tileTextureCoord:l.multiply(d).xy.subtract(u),tlbr:t.tlbr.divide(e.mosaicInfo.size.xyxy)}}function eJ(e,t){let i=(0,p.zi)(e.tileTextureCoord,new p.nt(1)),r=(0,p.jh)(e.tlbr.xy,e.tlbr.zw,i),o=(0,p.US)(t.texture,r);return e.color.multiply(o)}class e0 extends eT{constructor(){super(...arguments),this.type="PatternFillShader"}vertex(e,t){return{...super.vertex(e,t),...eX(this,e)}}fragment(e){let t=eJ(e,this.mosaicInfo);return this.getFragmentOutput(t,e,new p.nt(0))}}(0,n._)([(0,u.Pi)(V)],e0.prototype,"mosaicInfo",void 0),(0,n._)([(0,u.Pi)(eM)],e0.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(eG)),(0,n.a)(1,(0,u.hF)(_))],e0.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(eW))],e0.prototype,"fragment",null);class e1 extends eH{}(0,n._)([(0,u.C5)(9,p.Zb)],e1.prototype,"tlbr",void 0),(0,n._)([(0,u.C5)(10,p.nt)],e1.prototype,"inverseRasterizationScale",void 0);class e5 extends ej{}class e2 extends e${constructor(){super(...arguments),this.type="PatternOutlineFillShader"}vertex(e,t){return{...eK(this,e,t),...eX(this,e)}}fragment(e){let{isOutline:t}=e,i=(0,p.MM)(t,new p.nt(.5)),r=eY(e,this.antialiasingControls.blur),o=eJ(e,this.mosaicInfo),s=(0,p.Tk)(i,r,o),a=(0,p.Tk)(i,new p.nt(1/255),new p.nt(0));return this.getFragmentOutput(s,e,a)}}(0,n._)([(0,u.Pi)(V)],e2.prototype,"mosaicInfo",void 0),(0,n._)([(0,u.Pi)(eM)],e2.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(e1)),(0,n.a)(1,(0,u.hF)(_))],e2.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(e5))],e2.prototype,"fragment",null);let e3=1/z.cZ;class e8 extends x{}(0,n._)([(0,u.C5)(3,p.Zb)],e8.prototype,"color",void 0),(0,n._)([(0,u.C5)(4,p.Zb)],e8.prototype,"tlbr",void 0),(0,n._)([(0,u.C5)(5,p.nt)],e8.prototype,"angle",void 0),(0,n._)([(0,u.C5)(6,p.nt)],e8.prototype,"aux1",void 0),(0,n._)([(0,u.C5)(7,p.nt)],e8.prototype,"aux2",void 0),(0,n._)([(0,u.C5)(8,p.ZY)],e8.prototype,"aux3",void 0),(0,n._)([(0,u.C5)(9,p.ZY)],e8.prototype,"aux4",void 0),(0,n._)([(0,u.C5)(10,p.ZY)],e8.prototype,"zoomRange",void 0);class e4 extends e5{}class e6 extends eQ{constructor(){super(...arguments),this.type="ComplexOutlineFillShader"}vertex(e,t){let{aux1:i,aux2:r,aux3:o,aux4:s}=e,a={...e,width:i,height:r,offset:o,scale:s.multiply(e3)},n=eK(this,{...e,halfWidth:i,referenceHalfWidth:r,offset:o,normal:s.subtract(z.v9).multiply(e3)}),l=eR(this,a),u=(0,p.MM)(n.isOutline,new p.nt(.5));return{...n,...l,...this.maybeRunHittest(e,t,u)}}fragment(e){let{isOutline:t}=e,i=(0,p.MM)(t,new p.nt(.5)),r=eY(e,this.antialiasingControls.blur),o=eF(this,e),s=(0,p.Tk)(i,r,o),a=(0,p.Tk)(i,new p.nt(1/255),new p.nt(0));return this.getFragmentOutput(s,e,a)}hittest(e,t,i){return(0,p.Tk)(i,K(this.hittestRequest),Q(this,e,t))}}(0,n._)([(0,u.Pi)(V)],e6.prototype,"mosaicInfo",void 0),(0,n._)([(0,u.Pi)(eM)],e6.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(e8)),(0,n.a)(1,(0,u.hF)(_))],e6.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(e4))],e6.prototype,"fragment",null);class e9 extends er{constructor(){super(...arguments),this.type=a.N.ComplexOutlineFill,this.shaders={geometry:new e6}}render(e,t){let{context:i,painter:r,pixelRatio:o}=e,s=t.instance.getInput();r.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,s.uniforms),...(0,eo.QA)(e,t.target),antialiasingControls:ek(o),mosaicInfo:r.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,eo.Pr)(t.target)},defines:{...(0,eo.vT)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}),r.setPipelineState((0,eo.Qu)(e)),r.submitDraw(e,t)}}class e7 extends er{constructor(){super(...arguments),this.type=a.N.Fill,this.shaders={geometry:new eT}}render(e,t){let{painter:i}=e,r=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,r.uniforms),...(0,eo.QA)(e,t.target)},defines:(0,eo.vT)(e),optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}),i.setPipelineState((0,eo.Qu)(e)),i.submitDraw(e,t)}}var te=i(42646);class tt extends eP{}(0,n._)([(0,u.C5)(5,p.Zb)],tt.prototype,"tlbr",void 0),(0,n._)([(0,u.C5)(6,p.ZY)],tt.prototype,"relativePosition",void 0),(0,n._)([(0,u.C5)(7,p.nt)],tt.prototype,"gradientMethod",void 0),(0,n._)([(0,u.C5)(8,p.ZY)],tt.prototype,"relativeGradientSize",void 0);class ti extends w{}class tr extends eT{constructor(){super(...arguments),this.type="GradientFillShader"}vertex(e,t){let{tlbr:i,relativePosition:r,gradientMethod:o,relativeGradientSize:s}=e,a=(0,p.Tk)((0,f.K5)(e.bitset,te.Q.isAbsolute),this.view.displayZoomFactor,new p.nt(1));return{...super.vertex(e,t),tlbr:i,relativePosition:r,gradientMethod:o,gradientSize:s.multiply(a),isDiscrete:(0,f.mh)(e.bitset,te.Q.isDiscrete)}}fragment(e){let{tlbr:t,relativePosition:i,gradientMethod:r,gradientSize:o,isDiscrete:s}=e,a=(0,p.Tk)((0,p.MM)(s,new p.nt(.5)),o.subtract(1),new p.ZY(0)),n=(0,p.j1)([(0,p.LC)(r,new p.nt(te.m.rectangular)),()=>{let e=(0,p.tn)(i).add(a).divide(o);return(0,f.zb)((0,p.T9)(e.x,e.y))}],[(0,p.LC)(r,new p.nt(te.m.circular)),(0,f.zb)((0,p.RZ)((0,p.Om)(i,i)).add(a.x).divide(o.x))],[!0,(0,f.zb)(i.x.add(a.x).divide(o.x))]),l=new p.ZY((0,p.qE)(n,new p.nt(0),new p.nt(1)),.5),u=(0,p.jh)(t.xy,t.zw,l).divide(this.mosaicInfo.size),d=(0,p.US)(this.mosaicInfo.texture,u),c=e.color.a;return this.getFragmentOutput(d.multiply(c),e,new p.nt(0))}}(0,n._)([(0,u.Pi)(V)],tr.prototype,"mosaicInfo",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(tt)),(0,n.a)(1,(0,u.hF)(_))],tr.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(ti))],tr.prototype,"fragment",null);class to extends er{constructor(){super(...arguments),this.type=a.N.GradientFill,this.shaders={geometry:new tr},this.symbologyPlane=s.uC.FILL}render(e,t){let{context:i,painter:r}=e,o=t.instance.getInput();r.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,o.uniforms),...(0,eo.QA)(e,t.target),mosaicInfo:r.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...(0,eo.vT)(e)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}),r.setPipelineState((0,eo.Qu)(e)),r.submitDraw(e,t)}}class ts extends er{constructor(){super(...arguments),this.type=a.N.OutlineFill,this.shaders={geometry:new e$}}render(e,t){let{painter:i,pixelRatio:r}=e,o=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,o.uniforms),...(0,eo.QA)(e,t.target),antialiasingControls:ek(r)},defines:{...(0,eo.vT)(e)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}),i.setPipelineState((0,eo.Qu)(e)),i.submitDraw(e,t)}}class ta extends er{constructor(){super(...arguments),this.type=a.N.PatternFill,this.shaders={geometry:new e0}}render(e,t){let{context:i,painter:r}=e,o=t.instance.getInput();r.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,o.uniforms),...(0,eo.QA)(e,t.target),mosaicInfo:r.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,eo.Pr)(t.target)},defines:{...(0,eo.vT)(e)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}),r.setPipelineState((0,eo.Qu)(e)),r.submitDraw(e,t)}}class tn extends er{constructor(){super(...arguments),this.type=a.N.PatternOutlineFill,this.shaders={geometry:new e2}}render(e,t){let{context:i,painter:r,pixelRatio:o}=e,s=t.instance.getInput();r.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,s.uniforms),...(0,eo.QA)(e,t.target),antialiasingControls:ek(o),mosaicInfo:r.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,eo.Pr)(t.target)},defines:{...(0,eo.vT)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}),r.setPipelineState((0,eo.Qu)(e)),r.submitDraw(e,t)}}var tl=i(61939),tu=i(40941),tp=i(32391);class td{constructor(e,t,i,r){this.dataType=e,this.samplingMode=t,this.pixelFormat=i,this.internalFormat=r}}new td(eg.ld.HALF_FLOAT,eg.Cj.NEAREST,eg.Ab.RGBA,eg.Ab.RGBA);let tc=()=>tl.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources");class th{destroy(){this._accumulateFramebuffer=(0,tu.WD)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,tu.WD)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(e){if(null==this._qualityProfile){let t=function(e,t){let{textureFloatLinear:i,colorBufferFloat:r}=e.capabilities,o=r?.textureFloat,s=r?.textureHalfFloat,a=r?.floatBlend,n=e.driverTest.floatBufferBlend.result;if(!o&&!s)throw new tp.A("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(a&&n||s))throw new tp.A("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(n?"":" This device claims support for EXT_float_blend, but does not actually support it."));let l=!!r?.R32F,u=!!r?.R16F;if(o&&a&&n&&i)return i||t.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new td(eg.ld.FLOAT,i?eg.Cj.LINEAR:eg.Cj.NEAREST,l?eg.Ab.RED:eg.Ab.RGBA,l?eg.H0.R32F:eg.Ab.RGBA);if(s)return new td(eg.ld.HALF_FLOAT,eg.Cj.LINEAR,u?eg.Ab.RED:eg.Ab.RGBA,u?eg.H0.R16F:eg.Ab.RGBA);throw new tp.A("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(e,tc());this._qualityProfile={...t,defines:{usesHalfFloatPrecision:t.dataType!==eg.ld.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(e,t,i){if(null==this._accumulateFramebuffer){let{dataType:r,samplingMode:o,pixelFormat:s,internalFormat:a}=this.loadQualityProfile(e),n=new eS.R(t,i);n.pixelFormat=s,n.internalFormat=a,n.dataType=r,n.samplingMode=o,n.wrapMode=eg.pF.CLAMP_TO_EDGE;let l=new e_.q(eg.yQ.DEPTH_STENCIL,t,i);this._accumulateFramebuffer=new eb.H(e,n,l)}else{let{width:e,height:r}=this._accumulateFramebuffer;e===t&&r===i||this._accumulateFramebuffer.resize(t,i)}return this._accumulateFramebuffer}ensureResolveGradientTexture(e,t,i){if(null==this._resolveGradientTexture){let t=new eS.R;t.wrapMode=eg.pF.CLAMP_TO_EDGE,this._resolveGradientTexture=new ew.g(e,t),this._prevGradientHash=null}return this._prevGradientHash!==t&&(this._resolveGradientTexture.resize(i.length/4,1),this._resolveGradientTexture.setData(i),this._prevGradientHash=t),this._resolveGradientTexture}}class tm extends x{}(0,n._)([(0,u.C5)(5,p.ZY)],tm.prototype,"offset",void 0);class tf extends w{}class ty extends u.k2{}(0,n._)([(0,u.Pi)(p.nt)],ty.prototype,"radius",void 0),(0,n._)([(0,u.Pi)(p.nt)],ty.prototype,"isFieldActive",void 0);class tv extends S{constructor(){super(...arguments),this.type="HeatmapAccumulateShader",this.usesHalfFloatPrecision=!1}vertex(e){let{radius:t,isFieldActive:i}=this.kernelControls,r=e.offset,o=i.multiply(this.storage.getVVData(e.id).x).add(new p.nt(1).subtract(i)),s=this.view.displayViewScreenMat3.multiply(new p.eB(e.pos,1)).add(this.view.displayViewMat3.multiply(new p.eB(r,0)).multiply(t)),a=this.clip(e.id);return{glPosition:new p.Zb(s.xy,a,1),offset:r,fieldValue:o,color:new p.Zb(0),...this.maybeRunHittest(e,{},null)}}fragment(e){let{offset:t,fieldValue:i}=e,r=(0,p.Bw)(t),o=(0,p.PM)(r,new p.nt(1)),s=new p.nt(1).subtract(r.multiply(r)),a=s.multiply(s),n=o.multiply(a).multiply(i).multiply(new p.nt(this.usesHalfFloatPrecision?.25:1));return this.getFragmentOutput(new p.Zb(n),e)}hittest(e){var t,i,r;let{viewMat3:o,tileMat3:s}=this.view;return t=o.multiply(s).multiply(new p.eB(e.pos,1)).xy,i=this.kernelControls.radius,r=this.hittestRequest.position,(0,p.Io)(t,r).subtract(i)}}(0,n._)([u.E8],tv.prototype,"usesHalfFloatPrecision",void 0),(0,n._)([(0,u.Pi)(ty)],tv.prototype,"kernelControls",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(tm))],tv.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(tf))],tv.prototype,"fragment",null);class tg extends u.ZA{}(0,n._)([(0,u.C5)(0,p.ZY)],tg.prototype,"position",void 0);class tb extends u.HS{}class tx extends u.k2{}(0,n._)([(0,u.Pi)(p.z7)],tx.prototype,"texture",void 0),(0,n._)([(0,u.Pi)(p.ZY)],tx.prototype,"minAndInvRange",void 0),(0,n._)([(0,u.Pi)(p.nt)],tx.prototype,"normalization",void 0);class t_ extends u.k2{}(0,n._)([(0,u.Pi)(p.z7)],t_.prototype,"texture",void 0);class tw extends u.A{constructor(){super(...arguments),this.type="HeatmapResolveShader",this.usesHalfFloatPrecision=!1}vertex(e){return{glPosition:new p.Zb(e.position.multiply(2).subtract(1),1,1),uv:e.position}}fragment(e){let{accumulatedDensity:t,gradient:i}=this,r=(0,p.US)(t.texture,e.uv).r.divide(new p.nt(this.usesHalfFloatPrecision?.25:1));r=(r=r.multiply(t.normalization)).subtract(t.minAndInvRange.x).multiply(t.minAndInvRange.y);let o=(0,p.US)(i.texture,new p.ZY(r,.5)),s=new u.mm;return s.fragColor=new p.Zb(o.rgb.multiply(o.a),o.a),s}}(0,n._)([u.E8],tw.prototype,"usesHalfFloatPrecision",void 0),(0,n._)([(0,u.Pi)(tx)],tw.prototype,"accumulatedDensity",void 0),(0,n._)([(0,u.Pi)(t_)],tw.prototype,"gradient",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(tg))],tw.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(tb))],tw.prototype,"fragment",null);class tS extends er{constructor(){super(...arguments),this.type=a.N.Heatmap,this.drawPhase=s.S5.MAP|s.S5.HITTEST|s.S5.DEBUG,this.shaders={accumulate:new tv,resolve:new tw},this._isBound=!1,this._resources=new Map}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e),this._prevFBO=null,this._unbind()}render(e,t){let{context:i,painter:r,state:o}=e,s=t.instance.getInput(),{isFieldActive:a}=s.uniforms,n=this._getOrCreateResourcesRecord(i),l=n.loadQualityProfile(i);(0,eo.Eq)(e)||this._bind(e,n,s),r.setShader({shader:this.shaders.accumulate,uniforms:{...(0,eo.QA)(e,t.target),kernelControls:{radius:tC(s,o),isFieldActive:+!!a}},defines:{...(0,eo.vT)(e),...l.defines},optionalAttributes:{},useComputeBuffer:(0,eo.Eq)(e)});let u=(0,eo.Eq)(e)?tP:tV;r.setPipelineState(u),r.submitDraw(e,t)}getStencilReference(e){return tz(e)}renderResolvePass(e,t){if((0,eo.Eq)(e))return;let{context:i,painter:r}=e,o=this._resources.get(i);if(null==this._prevFBO||null==this._prevViewport||!o?.initialized)return;let{defines:s}=o.loadQualityProfile(i),{minDensity:a,maxDensity:n,radius:l}=t.getInput().uniforms,u=o.accumulateFramebuffer,p=o.resolveGradientTexture,d={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:u.colorTexture},minAndInvRange:[a,1/(n-a)],normalization:3/(l*l*Math.PI)},gradient:{texture:{unit:9,texture:p}}},defines:s,optionalAttributes:{},useComputeBuffer:!1};i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(u.colorTexture,8),i.bindTexture(p,9),r.setPipelineState(tT),r.submitDrawMesh(i,d,r.quadMesh),this._unbind()}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new th,this._resources.set(e,t)),t}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(e,t,i){if(this._isBound)return;let{context:r,state:o,pixelRatio:s}=e,a=r.getBoundFramebufferObject(),n=r.getViewport();this._prevFBO=a,this._prevViewport=n;let{gradient:l,gradientHash:u}=i.uniforms;t.ensureResolveGradientTexture(r,u,l);let{width:p,height:d}=n,c=function(e,t){let i=t>1.5?.25:.5;return e<1/(2*i)?1:i}(tC(i,o),s),h=t.ensureAccumulateFBO(r,p*c,d*c);r.blitFramebuffer(a,h,0,0,a.width,a.height,0,0,h.width,h.height,eg.NV.STENCIL,eg.Cj.NEAREST),r.bindFramebuffer(h),r.setViewport(0,0,h.width,h.height),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.clear(eg.NV.COLOR),this._isBound=!0}}function tz(e){return e.key.level+1}let tV={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:tz,compare:eg.MT.GEQUAL,mask:255,op:{fail:eg.eA.KEEP,zFail:eg.eA.KEEP,zPass:eg.eA.REPLACE}}}},tP={...tV,stencil:!1},tT={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function tC(e,t){let{referenceScale:i,radius:r}=e.uniforms;return r*(0!==i?i/t.scale:1)}let tM=360/254;!function(e){e[e.Color=0]="Color",e[e.Outline=1]="Outline",e[e.Halo=2]="Halo"}(o||(o={}));class tA extends x{}(0,n._)([(0,u.C5)(3,p.Zb)],tA.prototype,"color",void 0),(0,n._)([(0,u.C5)(4,p.ZY)],tA.prototype,"offset",void 0),(0,n._)([(0,u.C5)(5,p.ZY)],tA.prototype,"textureUV",void 0),(0,n._)([(0,u.C5)(6,p.nt)],tA.prototype,"fontSize",void 0),(0,n._)([(0,u.C5)(7,p.nt)],tA.prototype,"referenceSize",void 0),(0,n._)([(0,u.C5)(8,p.Zb)],tA.prototype,"outlineColor",void 0),(0,n._)([(0,u.C5)(9,p.Zb)],tA.prototype,"haloColor",void 0),(0,n._)([(0,u.C5)(10,p.ZY)],tA.prototype,"outlineAndHaloSize",void 0),(0,n._)([(0,u.C5)(11,p.ZY)],tA.prototype,"zoomRange",void 0),(0,n._)([(0,u.C5)(12,p.nt)],tA.prototype,"clipAngle",void 0),(0,n._)([(0,u.C5)(13,p.Zb)],tA.prototype,"referenceSymbol",void 0);class tO extends u.Y7{}(0,n._)([(0,u.C5)(14,p.ZY)],tO.prototype,"offsetNextVertex1",void 0),(0,n._)([(0,u.C5)(15,p.ZY)],tO.prototype,"offsetNextVertex2",void 0);class tR extends w{}class tF extends S{constructor(){super(...arguments),this.type="TextShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.textRenderPassType=o.Color,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(e,t,i){let r=t.multiply(tM),o=(0,p.tn)(this.view.rotation.subtract(r)),s=(0,p.jk)(new p.nt(360).subtract(o),o),a=new p.nt(0),n=(0,p.RI)(this.view.currentZoom.multiply(h.fq)).divide(h.fq),l=e.x,u=e.y,d=new p.nt(1).subtract((0,p.PM)(l,n)).multiply(2),c=(0,p.PM)(new p.nt(90),s).multiply(2),m=new p.nt(2).multiply(new p.nt(1).subtract((0,p.PM)(n,u)));return(a=(a=a.add(i.multiply(d))).add(i.multiply(c))).add(m)}vertex(e,t){let i=(0,f.mh)(e.bitset,z.bg),r=new p.nt(1).subtract(i),s=e.fontSize,a=s.divide(z.au),n=this.textRenderPassType===o.Outline?e.outlineColor:this.textRenderPassType===o.Halo?e.haloColor:this._getVertexColor(e),l=this.isLabel?this.storage.getLabelVisibility(e.id):new p.nt(1),u=this.isLabel?n.multiply(l):n,d=this.view.displayViewScreenMat3.multiply(new p.eB(e.pos,1)),c=e.offset,m=new p.nt(1),y=p.U.identity(),v=new p.ZY(0);if(this.isLabel){if(!e.referenceSymbol)throw Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");let t=e.referenceSymbol,i=t.xy,r=t.z,o=this._unpackDirection(t.w),s=D(this,e.id,r).divide(2),a=o.multiply(s.add(h.C2));v=i.add(a),c=c.add(v)}else m=D(this,e.id,e.referenceSize).divide(e.referenceSize),s=s.multiply(m),a=a.multiply(m),c=c.multiply(m),c=(y=E(this,e.id)).multiply(new p.eB(c,0)).xy;let g=(0,f.mh)(e.bitset,z.ti),b=this._getViewRotationMatrix(g).multiply(new p.eB(c,0)),x=this.isLabel?this.clipLabel(e.zoomRange,e.clipAngle,g):this.clip(e.id,e.zoomRange);x=this.isBackgroundPass?x.add(r.multiply(2)):x.add(i.multiply(2));let _=new p.nt(0);if(this.textRenderPassType===o.Outline&&(x=x.add((0,p.Tk)((0,p.LC)(e.outlineAndHaloSize.x,new p.nt(0)),new p.nt(2),new p.nt(0))),_=new p.nt(e.outlineAndHaloSize.x).divide(a).divide(z.$w)),this.textRenderPassType===o.Halo){let t=e.outlineAndHaloSize.x,i=new p.nt(e.outlineAndHaloSize.y);x=x.add((0,p.Tk)((0,p.LC)(i,new p.nt(0)),new p.nt(2),new p.nt(0))),_=i.add(t).divide(a).divide(z.$w)}let w=this.isLabel?(0,p.or)((0,p.MM)(x,new p.nt(1)),(0,p.$5)(l,new p.nt(0))):new p.x(!1);return{glPosition:new p.Zb(d.xy.add(b.xy),x,1),color:u,size:a,textureUV:e.textureUV.divide(this.mosaicInfo.size),antialiasingWidth:new p.nt(.105*z.au).divide(s).divide(this.view.pixelRatio),outlineDistanceOffset:_,...this.maybeRunHittest(e,t,{vvSizeAdjustment:m,vvRotation:y,labelOffset:v,labelClipped:w})}}_getViewRotationMatrix(e){let t=this.view.displayViewMat3,i=this.view.displayMat3,r=new p.nt(1).subtract(e);return t.multiply(e).add(i.multiply(r))}fragment(e){let t=new p.nt(2/8),i=new p.nt(1).subtract(t),r=(0,p.US)(this.mosaicInfo.texture,e.textureUV).a,o=i.subtract(e.outlineDistanceOffset);this.highlight&&(o=o.divide(2));let s=e.antialiasingWidth,a=(0,p.TF)(o.subtract(s),o.add(s),r);return this.getFragmentOutput(e.color.multiply(a),e)}hittest(e,t,{vvSizeAdjustment:i,vvRotation:r,labelOffset:o,labelClipped:s}){let a,n,l;this.isLabel?(a=new p.eB(e.offset.add(o),0),n=new p.eB(t.offsetNextVertex1.add(o),0),l=new p.eB(t.offsetNextVertex2.add(o),0)):(a=r.multiply(new p.eB(e.offset.multiply(i),0)),n=r.multiply(new p.eB(t.offsetNextVertex1.multiply(i),0)),l=r.multiply(new p.eB(t.offsetNextVertex2.multiply(i),0)));let{viewMat3:u,tileMat3:d}=this.view,c=u.multiply(d).multiply(new p.eB(e.pos,1)),h=c.add(d.multiply(a)).xy,m=c.add(d.multiply(n)).xy,f=c.add(d.multiply(l)).xy,y=j(this.hittestRequest.position,h.xy,m.xy,f.xy);return this.isLabel?(0,p.Tk)(s,K(this.hittestRequest),y):y}_unpackDirection(e){let t=new p.Ai(e),i=(0,p.Sj)(t,new p.Ai(2)),r=(0,p.nf)(t,new p.Ai(3));return new p.ZY(new p.nt(i).subtract(1),new p.nt(r).subtract(1))}_getVertexColor(e){let t=e.color;if(this.visualVariableColor){let i=this.storage.getColorValue(e.id);t=this.visualVariableColor.getColor(i,e.color,new p.x(!1))}if(this.visualVariableOpacity){let i=this.storage.getOpacityValue(e.id),r=this.visualVariableOpacity.getOpacity(i);t=t.multiply(r)}return t}}(0,n._)([(0,u.uK)(P)],tF.prototype,"visualVariableColor",void 0),(0,n._)([(0,u.uK)(T)],tF.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,u.uK)(C)],tF.prototype,"visualVariableRotation",void 0),(0,n._)([(0,u.uK)(M)],tF.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,u.uK)(A)],tF.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,u.uK)(O)],tF.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,u.uK)(R)],tF.prototype,"visualVariableSizeUnitValue",void 0),(0,n._)([(0,u.Pi)(V)],tF.prototype,"mosaicInfo",void 0),(0,n._)([u.E8],tF.prototype,"textRenderPassType",void 0),(0,n._)([u.E8],tF.prototype,"isBackgroundPass",void 0),(0,n._)([u.E8],tF.prototype,"isLabel",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(tA)),(0,n.a)(1,(0,u.hF)(tO))],tF.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(tR))],tF.prototype,"fragment",null);class tD extends er{constructor(){super(...arguments),this.type=a.N.Label,this.shaders={geometry:new tF},this.drawPhase=s.S5.LABEL|s.S5.LABEL_ALPHA|s.S5.HITTEST,this.symbologyPlane=s.uC.TEXT}render(e,t){let{context:i,painter:r}=e,s=(0,eo.vT)(e),a={...(0,eo.Qu)(e)},n=t.instance.getInput(),l={shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,n.uniforms),...(0,eo.QA)(e,t.target),mosaicInfo:r.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...s,textRenderPassType:o.Color,isBackgroundPass:!0,isLabel:!0},optionalAttributes:n.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)};r.setPipelineState(a),r.setShader(l),r.submitDraw(e,t),r.setShader({...l,defines:{...s,textRenderPassType:o.Halo,isBackgroundPass:!1,isLabel:!0}}),r.submitDraw(e,t),r.setShader({...l,defines:{...s,textRenderPassType:o.Color,isBackgroundPass:!1,isLabel:!0}}),r.submitDraw(e,t)}}var tI=i(12702);class tk extends eE{}(0,n._)([(0,u.C5)(9,p.nt)],tk.prototype,"accumulatedDistance",void 0),(0,n._)([(0,u.C5)(10,p.nt)],tk.prototype,"totalLength",void 0),(0,n._)([(0,u.C5)(11,p.nt)],tk.prototype,"gradientSize",void 0),(0,n._)([(0,u.C5)(12,p.ZY)],tk.prototype,"segmentDirection",void 0),(0,n._)([(0,u.C5)(13,p.Zb)],tk.prototype,"tlbr",void 0);class tE extends u.k2{}(0,n._)([(0,u.Pi)(p.nt)],tE.prototype,"isColorPass",void 0);class tZ extends eq{constructor(){super(...arguments),this.type="GradientStrokeShader"}vertex(e,t){let{totalLength:i,gradientSize:r,segmentDirection:o,tlbr:s}=e,a=eN(this,e),n=(0,f.mh)(e.bitset,tI.Q.isAlongLine),l=i.divide(this.view.displayZoomFactor),u=(0,p.Tk)((0,f.K5)(e.bitset,tI.Q.isAbsoluteSize),()=>{let e=(0,p.Tk)((0,p.MM)(n,new p.nt(.5)),l,a.halfWidth);return r.divide(e)},r),d=e.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,p.Om)(o,a.scaledOffset)).divide(l),c=s.divide(this.mosaicInfo.size.xyxy);return{...a,tlbr:c,relativePositionAlongLine:d,relativeGradientSize:u,isAlongLine:(0,f.mh)(e.bitset,tI.Q.isAlongLine),isDiscrete:(0,f.mh)(e.bitset,tI.Q.isDiscrete),...this.maybeRunHittest(e,t,a.halfWidth)}}fragment(e){let{isAlongLine:t,isDiscrete:i,relativePositionAlongLine:r,relativeGradientSize:o,normal:s,tlbr:a}=e,n=eU(e,this.antialiasingControls.blur),l=new p.nt(.5).multiply(s.y).add(new p.nt(.5)),u=(0,p.Tk)((0,p.MM)(t,new p.nt(.5)),r,l),d=(0,p.Tk)((0,p.MM)(i,new p.nt(.5)),o.subtract(1),new p.nt(0)),c=(0,f.zb)(u.add(d).divide(o)),h=(0,p.jh)(a.xy,a.zw,new p.ZY((0,p.qE)(c,new p.nt(0),new p.nt(1)),.5)),y=(0,p.US)(this.mosaicInfo.texture,h),v=e.opacity.multiply(n),g=this.getFragmentOutput(y.multiply(v),e),b=(0,p.PM)(new p.nt(.5),this.technique.isColorPass).multiply((0,m.A)("gradient-depth-epsilon")),x=(0,p.PM)(new p.nt(0),s.y).multiply(new p.nt((0,m.A)("gradient-depth-bias")).subtract(b));return g.glFragDepth=(0,p.qE)((0,p.Bw)(s).add(x),new p.nt(0),new p.nt(1)),g}}(0,n._)([(0,u.Pi)(V)],tZ.prototype,"mosaicInfo",void 0),(0,n._)([(0,u.Pi)(tE)],tZ.prototype,"technique",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(tk)),(0,n.a)(1,(0,u.hF)(_))],tZ.prototype,"vertex",null);class tL extends er{constructor(){super(...arguments),this.type=a.N.GradientStroke,this.shaders={geometry:new tZ},this.symbologyPlane=s.uC.LINE}_getShaderOptions(e,t,i){let{context:r,painter:o,pixelRatio:s}=e,a=t.instance.getInput();return{shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,a.uniforms),...(0,eo.QA)(e,t.target),antialiasingControls:ek(s),mosaicInfo:o.textureManager.getMosaicInfo(r,t.textureKey),technique:{isColorPass:i}},defines:{...(0,eo.vT)(e)},optionalAttributes:a.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}}render(e,t){let{painter:i}=e;if((0,eo.Eq)(e)||(0,eo.dJ)(e)){let r=(0,eo.Qu)(e);return i.setPipelineState(r),i.setShader(this._getShaderOptions(e,t,1)),void i.submitDraw(e,t)}e.context.setClearDepth(1),e.context.clear(eg.NV.DEPTH);let r={color:!1,depth:{write:{zNear:0,zFar:1},test:eg.MT.LESS},stencil:{write:!1,test:{ref:e=>e.stencilRef,compare:eg.MT.EQUAL,mask:255,op:{fail:eg.eA.KEEP,zFail:eg.eA.KEEP,zPass:eg.eA.KEEP}}}};i.setShader(this._getShaderOptions(e,t,0)),i.setPipelineState(r),i.submitDraw(e,t);let o={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:{write:!1,test:eg.MT.LEQUAL},stencil:{write:!1,test:{ref:e=>e.stencilRef,compare:eg.MT.EQUAL,mask:255,op:{fail:eg.eA.KEEP,zFail:eg.eA.KEEP,zPass:eg.eA.KEEP}}}};i.setShader(this._getShaderOptions(e,t,1)),i.setPipelineState(o),i.submitDraw(e,t)}}class tB extends er{constructor(){super(...arguments),this.type=a.N.Line,this.shaders={geometry:new eq},this.symbologyPlane=s.uC.LINE}render(e,t){let{painter:i,pixelRatio:r}=e,o=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,o.uniforms),...(0,eo.QA)(e,t.target),antialiasingControls:ek(r)},defines:{...(0,eo.vT)(e)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}),i.setPipelineState((0,eo.Qu)(e)),i.submitDraw(e,t)}}var tU=i(55048),tN=i(77700);class tY extends eE{}(0,n._)([(0,u.C5)(9,p.nt)],tY.prototype,"accumulatedDistance",void 0),(0,n._)([(0,u.C5)(10,p.ZY)],tY.prototype,"segmentDirection",void 0),(0,n._)([(0,u.C5)(11,p.nt)],tY.prototype,"offsetAlongLine",void 0),(0,n._)([(0,u.C5)(12,p.nt)],tY.prototype,"capType",void 0),(0,n._)([(0,u.C5)(13,p.Zb)],tY.prototype,"tlbr",void 0);class tq extends eq{constructor(){super(...arguments),this.type="TexturedLineShader"}_getDistanceRatio(e,t){let i=(0,f.mh)(e.bitset,z.kx);return i.multiply((0,p.T9)(t,new p.nt(.25)).multiply(new p.nt(2))).add(new p.nt(1).subtract(i).multiply((0,tU.Lz)(1)))}_getSDFAlpha(e){let{halfWidth:t,normal:i,tlbr:r,patternSize:o,accumulatedDistance:s,offsetAlongLine:a,dashToPx:n,capType:l}=e,u=o.x.divide(tN.zA).multiply(n),d=(0,p.jc)(s.add(a).divide(u)),c=(0,p.jh)(r.xy,r.zw,new p.ZY(d,.5)),h=(0,f.Rj)((0,p.US)(this.mosaicInfo.texture,c)).multiply(2).subtract(1).multiply(tN.gR).multiply(n),m=i.y.multiply(t),y=(0,p.j1)([(0,p.LC)(l,new p.nt(1)),h.subtract(t)],[(0,p.LC)(l,new p.nt(2)),(0,p.RZ)((0,p.n7)((0,p.T9)(h,new p.nt(0)),new p.nt(2)).add(m.multiply(m))).subtract(t)],[!0,h]),v=(0,p.qE)(new p.nt(.25).subtract(y),new p.nt(0),new p.nt(1));return new p.Zb(v)}_getPatternColor(e){let{halfWidth:t,normal:i,color:r,accumulatedDistance:o,patternSize:s,sampleAlphaOnly:a,tlbr:n}=e,l=s.y.multiply(new p.nt(2).multiply(t).divide(s.x)),u=(0,p.jc)(o.divide(l)),d=new p.nt(.5).multiply(i.y).add(new p.nt(.5)),c=(0,p.jh)(n.xy,n.zw,new p.ZY(d,u)),h=(0,p.US)(this.mosaicInfo.texture,c);return null!=this.visualVariableColor&&(h=(0,p.Tk)((0,p.MM)(a,new p.nt(.5)),new p.Zb(r.a),r)),h}vertex(e,t){let{segmentDirection:i,tlbr:r,bitset:o}=e,s=eN(this,e),a=e.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,p.Om)(i,s.scaledOffset)),n=new p.ZY(r.z.subtract(r.x),r.w.subtract(r.y)),l=r.divide(this.mosaicInfo.size.xyxy),u=(0,f.mh)(o,z.b5),d=(0,f.mh)(o,z.cn),c=(0,p.Tk)((0,p.MM)(u,new p.nt(.5)),this._getDistanceRatio(e,s.scaledHalfWidth),new p.nt(1));return{...s,tlbr:l,patternSize:n,accumulatedDistance:a,isSDF:u,sampleAlphaOnly:d,dashToPx:c,offsetAlongLine:e.offsetAlongLine,capType:e.capType,...this.maybeRunHittest(e,t,s.halfWidth)}}fragment(e){let{color:t,opacity:i,isSDF:r}=e,o=eU(e,this.antialiasingControls.blur),s=(0,p.Tk)((0,p.MM)(r,new p.nt(.5)),this._getSDFAlpha(e),this._getPatternColor(e)),a=t.multiply(i).multiply(o).multiply(s);return this.getFragmentOutput(a,e)}}(0,n._)([(0,u.Pi)(V)],tq.prototype,"mosaicInfo",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(tY)),(0,n.a)(1,(0,u.hF)(_))],tq.prototype,"vertex",null);class tH extends er{constructor(){super(...arguments),this.type=a.N.TexturedLine,this.shaders={geometry:new tq},this.symbologyPlane=s.uC.LINE}render(e,t){let{context:i,painter:r,pixelRatio:o}=e,s=t.instance.getInput();r.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,s.uniforms),...(0,eo.QA)(e,t.target),antialiasingControls:ek(o),mosaicInfo:r.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...(0,eo.vT)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}),r.setPipelineState((0,eo.Qu)(e)),r.submitDraw(e,t)}}class tj extends x{}(0,n._)([(0,u.C5)(3,p.Zb)],tj.prototype,"color",void 0),(0,n._)([(0,u.C5)(4,p.Zb)],tj.prototype,"outlineColor",void 0),(0,n._)([(0,u.C5)(5,p.ZY)],tj.prototype,"offset",void 0),(0,n._)([(0,u.C5)(6,p.ZY)],tj.prototype,"textureUV",void 0),(0,n._)([(0,u.C5)(7,p.Zb)],tj.prototype,"sizing",void 0),(0,n._)([(0,u.C5)(8,p.nt)],tj.prototype,"placementAngle",void 0),(0,n._)([(0,u.C5)(9,p.nt)],tj.prototype,"sdfDecodeCoeff",void 0),(0,n._)([(0,u.C5)(10,p.ZY)],tj.prototype,"zoomRange",void 0);class tK extends u.Y7{}(0,n._)([(0,u.C5)(12,p.ZY)],tK.prototype,"offsetNextVertex1",void 0),(0,n._)([(0,u.C5)(13,p.ZY)],tK.prototype,"offsetNextVertex2",void 0),(0,n._)([(0,u.C5)(14,p.ZY)],tK.prototype,"textureUVNextVertex1",void 0),(0,n._)([(0,u.C5)(15,p.ZY)],tK.prototype,"textureUVNextVertex2",void 0);class tQ extends w{}function t$(e,t,i,r){return t.multiply(e.x).add(i.multiply(e.y)).add(r.multiply(e.z))}function tG(e){return e.multiply(e).divide(128)}class tW extends S{constructor(){super(...arguments),this.type="MarkerShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(e,t){let i=tG(e.sizing.x),r=tG(e.sizing.y),o=tG(e.sizing.z),s=e.placementAngle,a=(0,f.mh)(e.bitset,N.c.bitset.isSDF),n=(0,f.mh)(e.bitset,N.c.bitset.isMapAligned),l=(0,f.mh)(e.bitset,N.c.bitset.scaleSymbolsProportionally),u=(0,f.K5)(e.bitset,N.c.bitset.colorLocked),d=k(this,e.id),c=I(this,e.id,e.color,u).multiply(d),h=this.view.displayViewScreenMat3.multiply(new p.eB(e.pos.xy,1)),m=D(this,e.id,o).divide(o),y=i.multiply(m),v=e.offset.xy.multiply(m),g=r.multiply(l.multiply(m.subtract(1)).add(1));g=(0,p.jk)(g,(0,p.T9)(y.subtract(.99),new p.nt(0)));let b=(0,p.T9)(g,new p.nt(1)),x=(0,p.jk)(g,new p.nt(1)),_=p.U.fromRotation(s.multiply(z.rp)),w=E(this,e.id),S=this._getViewRotationMatrix(n).multiply(w).multiply(_).multiply(new p.eB(v.xy,0)),V=this.clip(e.id,e.zoomRange),P=new p.Zb(h.xy.add(S.xy),V,1),T=e.textureUV.divide(this.mosaicInfo.size),C=e.outlineColor.multiply(x),M=(0,f.mh)(e.bitset,N.c.bitset.overrideOutlineColor),A=e.sdfDecodeCoeff.multiply(y);return{glPosition:P,color:c,textureUV:T,outlineColor:C,outlineSize:b,distanceToPx:A,isSDF:a,overrideOutlineColor:M,...this.maybeRunHittest(e,t,{pos:e.pos,size:y,sizeCorrection:m,isMapAligned:n,vvRotationMat3:w,placementMat3:_,outlineSize:b,distanceToPx:A,isSDF:a})}}fragment(e){let t=this._getColor(e.textureUV,e);return this.getFragmentOutput(t,e)}hittest(e,t,i){return(0,p.Tk)((0,p.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(e,t,i),this._hittestMarker(e,t,i))}_getViewRotationMatrix(e){let t=this.view.displayViewMat3,i=this.view.displayMat3,r=new p.nt(1).subtract(e);return t.multiply(e).add(i.multiply(r))}_getViewScreenMatrix(e){let t=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,r=new p.nt(1).subtract(e);return t.multiply(e).add(i.multiply(r))}_getColor(e,t){return(0,p.Tk)((0,p.LC)(t.isSDF,new p.nt(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return(0,p.US)(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){let i=(0,p.US)(this.mosaicInfo.texture,e),r=new p.nt(.5).subtract((0,f.Rj)(i)).multiply(t.distanceToPx).multiply(z.V5),o=(0,p.qE)(new p.nt(.5).subtract(r),new p.nt(0),new p.nt(1)),s=t.color.multiply(o),a=t.outlineSize;this.highlight&&(a=(0,p.T9)(a,t.overrideOutlineColor.multiply(4)));let n=a.multiply(.5),l=(0,p.tn)(r).subtract(n),u=(0,p.qE)(new p.nt(.5).subtract(l),new p.nt(0),new p.nt(1)),d=(0,p.jh)(t.outlineColor,t.color,t.overrideOutlineColor).multiply(u);return new p.nt(1).subtract(d.a).multiply(s).add(d)}_hittestSmallMarker(e,t,i){let{position:r,distance:o,smallSymbolDistance:s}=this.hittestRequest,a=o.subtract(s),{viewMat3:n,tileMat3:l}=this.view,u=n.multiply(l).multiply(new p.eB(i.pos,1)).xy,d=i.size.multiply(.5);return(0,p.Io)(u,r).subtract(d).add(a)}_hittestMarker(e,t,i){let{pos:r,sizeCorrection:o,isMapAligned:s}=i,a=new p.eB(e.offset.multiply(o),0),n=new p.eB(t.offsetNextVertex1.multiply(o),0),l=new p.eB(t.offsetNextVertex2.multiply(o),0),{viewMat3:u,tileMat3:d}=this.view,c=u.multiply(d).multiply(new p.eB(r,1)),h=this._getViewScreenMatrix(s).multiply(i.vvRotationMat3).multiply(i.placementMat3),m=c.add(h.multiply(a)).xy,f=c.add(h.multiply(n)).xy,y=c.add(h.multiply(l)).xy,v=this.hittestRequest.position,g=this.hittestRequest.distance,b=j(v,m,f,y);return(0,p.Tk)((0,p.MM)(b,g),b,this._hittestSamples(m,f,y,e,t,i))}_hittestSamples(e,t,i,r,o,s){let{outlineSize:a,isSDF:n,distanceToPx:l}=s,u=this.hittestRequest.position,d=this.hittestRequest.distance,c=H(u.add(new p.ZY((0,p.ze)(d),(0,p.ze)(d))),e,t,i),h=H(u.add(new p.ZY(0,(0,p.ze)(d))),e,t,i),m=H(u.add(new p.ZY(d,(0,p.ze)(d))),e,t,i),f=H(u.add(new p.ZY((0,p.ze)(d),0)),e,t,i),y=H(u,e,t,i),v=H(u.add(new p.ZY(d,0)),e,t,i),g=H(u.add(new p.ZY((0,p.ze)(d),d)),e,t,i),b=H(u.add(new p.ZY(0,d)),e,t,i),x=H(u.add(new p.ZY(d,d)),e,t,i),_=r.textureUV.divide(this.mosaicInfo.size),w=o.textureUVNextVertex1.divide(this.mosaicInfo.size),S=o.textureUVNextVertex2.divide(this.mosaicInfo.size),z={color:new p.Zb(1),outlineColor:new p.Zb(1),overrideOutlineColor:new p.nt(1),outlineSize:a,distanceToPx:l,isSDF:n},V=new p.nt(0);return V=(V=(V=(V=(V=(V=(V=(V=(V=V.add(q(c).multiply(this._getColor(t$(c,_,w,S),z).a))).add(q(h).multiply(this._getColor(t$(h,_,w,S),z).a))).add(q(m).multiply(this._getColor(t$(m,_,w,S),z).a))).add(q(f).multiply(this._getColor(t$(f,_,w,S),z).a))).add(q(y).multiply(this._getColor(t$(y,_,w,S),z).a))).add(q(v).multiply(this._getColor(t$(v,_,w,S),z).a))).add(q(g).multiply(this._getColor(t$(g,_,w,S),z).a))).add(q(b).multiply(this._getColor(t$(b,_,w,S),z).a))).add(q(x).multiply(this._getColor(t$(x,_,w,S),z).a)),(0,p.PM)(V,new p.nt(.05)).multiply(K(this.hittestRequest))}}(0,n._)([(0,u.uK)(P)],tW.prototype,"visualVariableColor",void 0),(0,n._)([(0,u.uK)(T)],tW.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,u.uK)(C)],tW.prototype,"visualVariableRotation",void 0),(0,n._)([(0,u.uK)(M)],tW.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,u.uK)(A)],tW.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,u.uK)(O)],tW.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,u.uK)(R)],tW.prototype,"visualVariableSizeUnitValue",void 0),(0,n._)([(0,u.Pi)(V)],tW.prototype,"mosaicInfo",void 0),(0,n._)([(0,n.a)(0,(0,u.hF)(tj)),(0,n.a)(1,(0,u.hF)(tK))],tW.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,u.hF)(tQ))],tW.prototype,"fragment",null);class tX extends er{constructor(){super(...arguments),this.type=a.N.Marker,this.shaders={geometry:new tW},this.symbologyPlane=s.uC.MARKER}render(e,t){let{context:i,painter:r}=e,o=t.instance.getInput();r.setShader({shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,o.uniforms),...(0,eo.QA)(e,t.target),mosaicInfo:r.textureManager.getMosaicInfo(i,t.textureKey,!0)},defines:{...(0,eo.vT)(e)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)}),r.setPipelineState((0,eo.Qu)(e)),r.submitDraw(e,t)}}var tJ=i(45714),t0=i(98632);class t1{constructor(){this.computeAttributes={}}get locationsMap(){let e=new Map;for(let t in this.locations)e.set(t,this.locations[t].index);return e}get optionPropertyKeys(){if(!this._optionPropertyKeys){let e=new Set(Object.keys(this.options));this._optionPropertyKeys=e}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){let e=this.locationsMap,t=Array.from(e.entries()).map(([e,t])=>`${e}.${t}`).join("."),i=(0,tJ.Wm)(t);this._locationInfo={hash:i,stringHash:t,locations:e,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){let e=new Map;for(let[t,i]of this.locationsMap.entries())e.set("a_"+t,i);return e}getShaderKey(e,t,i){return`${Object.keys(e).map(t=>`${t}.${e[t]}`).join(".")}.${Object.keys(i).filter(e=>i[e]).map(e=>`${e}_${i[e].toString()}`).join(".")}.${Object.keys(t).filter(e=>this.optionPropertyKeys.has(e)).join(".")}`}getProgram(e,t,i,r){let o="",s="";for(let e in i)if(i[e]){let t="boolean"==typeof i[e]?`#define ${e}
`:`#define ${e} ${i[e]}
`;o+=t,s+=t}return o+=this.vertexShader,s+=this.fragmentShader,new t0.K(o,s,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(t),this._transformFeedbackBindings)}_getUniformBindings(e){let t=[];for(let e in this.required){let i=this.required[e];t.push({uniformHydrated:null,shaderModulePath:e,uniformName:e,uniformType:i.type,uniformArrayElementType:t5(i),uniformArrayLength:t2(i)})}for(let i in e){let r=this.options[i];if(e[i])for(let e in r){let o=r[e];t.push({uniformHydrated:null,shaderModulePath:`${i}.${e}`,uniformName:e,uniformType:o.type,uniformArrayElementType:t5(o),uniformArrayLength:t2(o)})}}return t}}let t5=e=>"array"===e.type?e.elementType?.type:void 0,t2=e=>"array"===e.type?e.size:void 0;var t3=i(25124);let t8={hittestDist:p.nt,hittestPos:p.ZY},t4={filterFlags:p.z7,animation:p.z7,visualVariableData:p.z7,dataDriven0:p.z7,dataDriven1:p.z7,dataDriven2:p.z7,gpgpu:p.z7,size:p.nt},t6={displayViewScreenMat3:p.U,displayViewMat3:p.U,displayMat3:p.U,viewMat3:p.U,tileMat3:p.U,displayZoomFactor:p.nt,requiredZoomFactor:p.nt,tileOffset:p.ZY,currentScale:p.nt,currentZoom:p.nt,metersPerSRUnit:p.nt};class t9 extends t1{constructor(){super(...arguments),this.vertexShader=(0,t3.Q)("materials/pie/pie.vert"),this.fragmentShader=(0,t3.Q)("materials/pie/pie.frag"),this.required={...t4,...t6,outlineWidth:p.nt,colors:p.My,defaultColor:p.Zb,othersColor:p.Zb,outlineColor:p.Zb,donutRatio:p.nt,sectorThreshold:p.nt},this.options={hittestUniforms:t8,visualVariableSizeMinMaxValue:{minMaxValueAndSize:p.Zb},visualVariableSizeScaleStops:{sizes:{...p.My.ofType(p.nt,8),type:"array",elementType:p.nt,size:8},values:{...p.My.ofType(p.nt,8),type:"array",elementType:p.nt,size:8}},visualVariableSizeStops:{sizes:{...p.My.ofType(p.nt,8),type:"array",elementType:p.nt,size:8},values:{...p.My.ofType(p.nt,8),type:"array",elementType:p.nt,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:p.nt},visualVariableOpacity:{opacities:{...p.My.ofType(p.nt,8),type:"array",elementType:p.nt,size:8},opacityValues:{...p.My.ofType(p.nt,8),type:"array",elementType:p.nt,size:8}}},this.locations={pos:{index:0,type:p.ZY},id:{index:1,type:p.eB},bitset:{index:2,type:p.nt},offset:{index:3,type:p.ZY},texCoords:{index:4,type:p.ZY},size:{index:5,type:p.ZY},referenceSize:{index:6,type:p.nt},zoomRange:{index:7,type:p.ZY}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(e){this.required.colors={...p.My.ofType(p.Zb,e),type:"array",elementType:p.Zb,size:e}}}class t7 extends er{constructor(){super(...arguments),this.type=a.N.PieChart,this.shaders={geometry:new t9},this.symbologyPlane=s.uC.MARKER}render(e,t){let{painter:i}=e,{instance:r,target:o}=t,s=this.shaders.geometry,a=r.getInput(),n=a.uniforms.numberOfFields,l=(0,eo.Eq)(e),u=(0,eo.QA)(e,o),p=(0,eo.vT)(e);s.setNumberOfFields(n),i.setShader({shader:s,uniforms:{...(0,eo.r3)(e,t.target,a.uniforms.shader),...u.storage,...u.view,hittestUniforms:u.hittestRequest?{hittestDist:u.hittestRequest?.distance,hittestPos:u.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!a.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!a.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!a.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!a.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!a.uniforms.shader.visualVariableOpacity,HITTEST:l,highlight:+!!u.highlight,...p,numberOfFields:n},optionalAttributes:{},useComputeBuffer:l}),i.setPipelineState((0,eo.Qu)(e)),i.submitDraw(e,t)}}class ie extends er{constructor(){super(...arguments),this.type=a.N.Text,this.shaders={geometry:new tF},this.symbologyPlane=s.uC.TEXT}render(e,t){let{context:i,painter:r}=e,s=(0,eo.vT)(e),a=t.instance.getInput(),n={shader:this.shaders.geometry,uniforms:{...(0,eo.r3)(e,t.target,a.uniforms),...(0,eo.QA)(e,t.target),mosaicInfo:r.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...s,isBackgroundPass:!0,isLabel:!1,textRenderPassType:o.Color},optionalAttributes:a.optionalAttributes,useComputeBuffer:(0,eo.Eq)(e)};r.setShader(n),r.setPipelineState((0,eo.Qu)(e)),r.submitDraw(e,t),r.setShader({...n,defines:{...s,isBackgroundPass:!1,isLabel:!1,textRenderPassType:o.Halo}}),r.submitDraw(e,t),r.setShader({...n,defines:{...s,isBackgroundPass:!1,isLabel:!1,textRenderPassType:o.Outline}}),r.submitDraw(e,t),r.setShader({...n,defines:{...s,isBackgroundPass:!1,isLabel:!1,textRenderPassType:o.Color}}),r.submitDraw(e,t)}}let it={fill:new e7,patternFill:new ta,complexFill:new eI,gradientFill:new to,outlineFill:new ts,patternOutlineFill:new tn,complexOutlineFill:new e9,marker:new tX,pieChart:new t7,line:new tB,texturedLine:new tH,gradientStroke:new tL,text:new ie,label:new tD,heatmap:new tS,dotDensity:new eC,animatedMarker:new ea};function ii(){for(let e in it)it[e].startup()}function ir(e){for(let t in it)it[t].shutdown(e)}},80841:(e,t,i)=>{i.d(t,{Dk:()=>c,K4:()=>m,j0:()=>h}),i(57845);var r=i(55048),o=i(8922),s=i(81713),a=i(94360),n=i(37390),l=i(37699),u=i(17168);function p(e){if(!e.stops?.length)return null;if(e.stops.some(e=>e.useMaxValue||e.useMinValue))return(t,i)=>{let o=t.statisticsByLevel.get(i.key.level),s=e.stops.map(t=>({value:t.useMaxValue?o?.get(e.field)?.maxValue??0:t.useMinValue?o?.get(e.field)?.minValue??0:t.value,size:t.size?(0,r.Lz)(t.size):a.qM})).sort((e,t)=>e.value-t.value),n=(0,l.r)(s,8);return{values:n.map(({value:e})=>e),sizes:n.map(({size:e})=>e)}};let t=e.stops.sort((e,t)=>e.value-t.value),i=(0,l.r)(t,8);return{values:i.map(({value:e})=>e),sizes:i.map(({size:e})=>(0,r.Lz)(e))}}function d(e,t){let i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let r=1;r<i;r++)if(e<t[r].value){let i=(e-t[r-1].value)/(t[r].value-t[r-1].value);return t[r-1].size+i*(t[r].size-t[r-1].size)}return t[i-1].size}let c={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function h(e,t=128,i=1.25){if(e.visualVariableSizeMinMaxValue)return e.visualVariableSizeMinMaxValue instanceof Function?128:Math.max(e.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,t);if(e.visualVariableSizeScaleStops){if(e.visualVariableSizeScaleStops instanceof Function)return 128;let r=e.visualVariableSizeScaleStops.sizes;return Math.max(r[r.length-1]*i,t)}if(e.visualVariableSizeStops){if(e.visualVariableSizeStops instanceof Function)return 128;let r=e.visualVariableSizeStops.sizes;return Math.max(r[r.length-1]*i,t)}return 256*!!e.visualVariableSizeUnitValue}function m(e){let t={...c};if(!e||!("visualVariables"in e)||!e.visualVariables)return t;for(let a of(0,u.R)(e.visualVariables))switch(a.type){case"color":t.visualVariableColor=function(e){if(!e.stops?.length)return null;let t=e.stops.sort((e,t)=>e.value-t.value),i=(0,l.r)(t,8);return{values:i.map(({value:e})=>e),colors:i.map(({color:e})=>(0,l.p)(e))}}(a);break;case"opacity":t.visualVariableOpacity=function(e){if(!e.stops?.length)return null;let t=e.stops.sort((e,t)=>e.value-t.value),i=(0,l.r)(t,8);return{opacityValues:i.map(({value:e})=>e),opacities:i.map(({opacity:e})=>e)}}(a);break;case"rotation":t.visualVariableRotation={rotationType:"geographic"===a.rotationType?n.H_.Geographic:n.H_.Arithmatic};break;case"size":var i;switch("number"==typeof(i=a).minDataValue&&"number"==typeof i.maxDataValue&&null!=i.minSize&&null!=i.maxSize?"min-max":"$view.scale"===i?.valueExpression&&Array.isArray(i.stops)?"scale-stops":(null!=i.field||"$view.scale"!==i?.valueExpression)&&(Array.isArray(i.stops)||"levels"in i&&i.levels)?"field-stops":null!=i.field||"$view.scale"!==i?.valueExpression?"unit-value":null){case"field-stops":t.visualVariableSizeStops=p(a);break;case"scale-stops":"outline"===a.target?t.visualVariableSizeOutlineScaleStops=p(a):t.visualVariableSizeScaleStops=p(a);break;case"min-max":t.visualVariableSizeMinMaxValue=function(e){let{minDataValue:t,maxDataValue:i,minSize:o,maxSize:s}=e;if("object"==typeof o&&"object"==typeof s)return(e,a)=>{let n=e.state.scale;return{minMaxValueAndSize:[t,i,(0,r.Lz)(d(n,o.stops)),(0,r.Lz)(d(n,s.stops))]}};if("object"==typeof o||"object"==typeof s)throw Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[t,i,(0,r.Lz)(o),(0,r.Lz)(s)]}}(a);break;case"unit-value":t.visualVariableSizeUnitValue=function(e){return t=>{let{state:i}=t;return{unitValueToPixelsRatio:(0,o.GA)(i.spatialReference)/s.j[e.valueUnit??"meters"]/i.resolution}}}(a)}}return t}},82307:(e,t,i)=>{i.d(t,{e:()=>n});var r=i(62233);i(98232),i(57845),i(53701);var o=i(93446);i(87816),i(87155);var s=i(84172),a=i(86524);class n{constructor(e,t){for(let i in this._boundPart=null,this.vertexBuffers=new Map,this.indexBuffers=new Map,this.groups=[],t.vertex){let{data:s,attributes:a}=t.vertex[i],n=r.g.createVertex(e,o._U.STATIC_DRAW,s);this.vertexBuffers.set(i,{buffer:n,attributes:a})}for(let i in t.index){let{data:s}=t.index[i],a=r.g.createIndex(e,o._U.STATIC_DRAW,s);this.indexBuffers.set(i,{buffer:a})}for(let e of t.groups)this.groups.push({...e,vertexArrays:new Map});this.parts=t.parts}bind(e,t,i){this._boundPart=i;let{group:r}=this.parts[this._boundPart],o=this.groups[r];if(!o)throw Error(`Missing group ${r}.`);let a=o.vertexArrays.get(t.stringHash);if(!a){let i=new Set(t.locations.keys()),r=o.index?this.indexBuffers.get(o.index)?.buffer:null,n=new Map,l=new Map;for(let[e,{buffer:t,attributes:r}]of this.vertexBuffers){let o=r.filter(e=>i.has(e.name));o.length>0&&(n.set(e,o),l.set(e,t))}a=new s.Z(e,t.locations,n,l,r),o.vertexArrays.set(t.stringHash,a)}e.bindVAO(a)}draw(e){if(null==this._boundPart)throw Error("Mesh.bind() has not been called.");let{start:t,count:i}=this.parts[this._boundPart],{group:r}=this.parts[this._boundPart],{primitive:o,index:s}=this.groups[r];if(s){let r=this.indexBuffers.get(s);if(!r)throw Error(`Missing index buffer "${s}".`);let{indexType:n}=r.buffer;if(!n)throw Error("Buffer type error.");e.drawElements(o,i,n,t*a.I[n])}else e.drawArrays(o,t,i)}unbind(e){this._boundPart=null,e.bindVAO(null)}destroy(){for(let{vertexArrays:e}of this.groups)for(let[t,i]of e)i.disposeVAOOnly();for(let{buffer:e}of this.vertexBuffers.values())e.dispose();for(let{buffer:e}of this.indexBuffers.values())e.dispose()}}},84105:(e,t,i)=>{i.d(t,{Jz:()=>c,T9:()=>l,uH:()=>u});var r=i(31461),o=i(66294),s=i(52548),a=i(17168),n=i(2698);function l(e,t){return{type:"simple",filters:t,capabilities:{maxTextureSize:(0,n.C)().maxTextureSize},bindings:d(e)}}function u(e,t){let i=(0,n.C)();return{type:"multi",target:"feature",keyField:o.EA,filters:t,capabilities:{maxTextureSize:i.maxTextureSize},bindings:{[o.t0.TrackLine]:d(e.trackLines.renderer),[o.t0.LatestObservation]:d(e.latestObservations.renderer),[o.t0.PreviousObservation]:d(e.previousObservations.renderer)}}}function p(e){switch(e){case"opacity":return s.Gn.OPACITY;case"color":return s.Gn.COLOR;case"rotation":return s.Gn.ROTATION;case"size":return s.Gn.SIZE;default:return null}}function d(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return c(e);case"dot-density":var t=e;let i=[];for(let e of t.attributes)i.push({binding:i.length,expression:e.valueExpression,field:e.field});return i;case"pie-chart":var r=e;let o=c(r),s=4;for(let e of r.attributes)o.push({binding:s++,expression:e.valueExpression,field:e.field});return o;case"heatmap":return function({valueExpression:e,field:t}){return e||t?[{binding:0,expression:e,field:t}]:[]}(e)}}function c(e){return"visualVariables"in e&&e.visualVariables?.length?(0,a.R)(e.visualVariables).map(e=>(function(e){switch(e.type){case"size":return"$view.scale"===e.valueExpression?null:{binding:p(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation};case"color":case"opacity":return{binding:p(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression};case"rotation":return{binding:p(e.type),expression:e.valueExpression,field:e.field}}})(e)).filter(r.Ru):[]}},86524:(e,t,i)=>{i.d(t,{I:()=>o});var r=i(93446);let o={[r.pe.BYTE]:1,[r.pe.UNSIGNED_BYTE]:1,[r.pe.SHORT]:2,[r.pe.UNSIGNED_SHORT]:2,[r.pe.HALF_FLOAT]:2,[r.pe.INT]:4,[r.pe.UNSIGNED_INT]:4,[r.pe.FLOAT]:4}},90344:(e,t,i)=>{function r(e){return!!(e.visualVariableSizeMinMaxValue||e.visualVariableSizeScaleStops||e.visualVariableSizeStops||e.visualVariableSizeUnitValue||e.visualVariableSizeOutlineScaleStops)}function o(e){return!!e.visualVariableRotation}i.d(t,{I:()=>r,N:()=>o})}}]);