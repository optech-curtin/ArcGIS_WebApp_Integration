"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6058],{9212:(e,t,r)=>{r.d(t,{a:()=>l,f:()=>i,n:()=>a});var n=r(48678);function a(e,t){l(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function l(e,t,r=2,a=r){let i=t.length/2,o=0,s=0;if(!(0,n.iu)(t)||(0,n.dk)(t)){for(let n=0;n<i;++n)e[o]=t[s],e[o+1]=t[s+1],o+=r,s+=a;return}let u=(0,n.a3)(t);if((0,n.JI)(t))for(let n=0;n<i;++n)e[o]=Math.max(t[s]/u,-1),e[o+1]=Math.max(t[s+1]/u,-1),o+=r,s+=a;else for(let n=0;n<i;++n)e[o]=t[s]/u,e[o+1]=t[s+1]/u,o+=r,s+=a}function i(e,t,r,n){let a=e.typedBuffer,l=e.typedBufferStride,i=n?.count??e.count,o=(n?.dstIndex??0)*l;for(let e=0;e<i;++e)a[o]=t,a[o+1]=r,o+=l}Object.freeze(Object.defineProperty({__proto__:null,fill:i,normalizeIntegerBuffer:l,normalizeIntegerBufferView:a},Symbol.toStringTag,{value:"Module"}))},13815:(e,t,r)=>{r.d(t,{x:()=>i});var n=r(48678),a=r(95775),l=r(93446);function i(e,t){switch(t){case l.WR.TRIANGLES:var r;return"number"==typeof(r=e)?(0,a.tM)(r):(0,n.mg)(r)?new Uint16Array(r):r;case l.WR.TRIANGLE_STRIP:return function(e){let t="number"==typeof e?e:e.length;if(t<3)return[];let r=t-2,n=(0,a.my)(3*r);if("number"==typeof e){let e=0;for(let t=0;t<r;t+=1)t%2==0?(n[e++]=t,n[e++]=t+1):(n[e++]=t+1,n[e++]=t),n[e++]=t+2}else{let t=0;for(let a=0;a<r;a+=1)a%2==0?(n[t++]=e[a],n[t++]=e[a+1]):(n[t++]=e[a+1],n[t++]=e[a]),n[t++]=e[a+2]}return n}(e);case l.WR.TRIANGLE_FAN:return function(e){let t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);let r=t-2,n=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if("number"==typeof e){let e=0;for(let t=0;t<r;++t)n[e++]=0,n[e++]=t+1,n[e++]=t+2;return n}let a=e[0],l=e[1],i=0;for(let t=0;t<r;++t){let r=e[t+2];n[i++]=a,n[i++]=l,n[i++]=r,l=r}return n}(e)}}},47946:(e,t,r)=>{r.d(t,{R:()=>s});var n=r(39166),a=r(83610),l=r(32391),i=r(92753),o=r(90525);class s{constructor(e){this._streamDataRequester=e}async loadJSON(e,t){return this._load("json",e,t)}async loadBinary(e,t){return(0,o.DB)(e)?((0,i.Te)(t),(0,o.lJ)(e)):this._load("binary",e,t)}async loadImage(e,t){return this._load("image",e,t)}async _load(e,t,r){if(null==this._streamDataRequester)return(await (0,n.A)(t,{responseType:u[e]})).data;let o=await (0,a.Ke)(this._streamDataRequester.request(t,e,r));if(!0===o.ok)return o.value;throw(0,i.QP)(o.error),new l.A("glt-loader-request-error",`Request for resource failed: ${o.error}`)}}let u={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},69828:(e,t,r)=>{r.d(t,{G:()=>i});var n=r(3391),a=r(25561),l=r(6815);function i(e){if(null==e)return null;let t=null!=e.offset?e.offset:a.uY,r=null!=e.rotation?e.rotation:0,i=null!=e.scale?e.scale:a.Un,o=(0,n.fA)(1,0,0,0,1,0,t[0],t[1],1),s=(0,n.fA)(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),u=(0,n.fA)(i[0],0,0,0,i[1],0,0,0,1),f=(0,n.vt)();return(0,l.lw)(f,s,u),(0,l.lw)(f,o,f),f}},75550:(e,t,r)=>{r.d(t,{a:()=>i,b:()=>c,l:()=>f,n:()=>s,t:()=>o});var n=r(50737);r(57845);var a=r(61939);let l=()=>a.A.getLogger("esri.views.3d.support.buffer.math");function i(e,t,r){o(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function o(e,t,r,n=4,a=n){if(e.length/n!=t.length/a)return;let l=e.length/n,i=r[0],s=r[1],u=r[2],f=r[3],c=r[4],d=r[5],m=r[6],p=r[7],h=r[8],g=0,y=0;for(let r=0;r<l;r++){let r=t[g],l=t[g+1],o=t[g+2],x=t[g+3];e[y]=i*r+f*l+m*o,e[y+1]=s*r+c*l+p*o,e[y+2]=u*r+d*l+h*o,e[y+3]=x,g+=a,y+=n}}function s(e,t){let r=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,l=t.typedBuffer,i=t.typedBufferStride;for(let e=0;e<r;e++){let t=e*a,r=e*i,o=l[r],s=l[r+1],u=l[r+2],f=o*o+s*s+u*u;if(f>0){let e=1/Math.sqrt(f);n[t]=e*o,n[t+1]=e*s,n[t+2]=e*u}}}function u(e,t,r,n=4){let a=Math.min(e.length/n,t.count),l=t.typedBuffer,i=t.typedBufferStride,o=0,s=0;for(let t=0;t<a;t++)e[s]=r*l[o],e[s+1]=r*l[o+1],e[s+2]=r*l[o+2],e[s+3]=r*l[o+3],o+=i,s+=n}function f(e,t,r,n){c(e.typedBuffer,t,r,n,e.typedBufferStride)}function c(e,t,r,a,l=4){let i=Math.min(e.length/l,t.count),o=t.typedBuffer,s=t.typedBufferStride,u=0,f=0,d=1/n.Tf;for(let t=0;t<i;t++)e[f]=a*(r*o[u])**d,e[f+1]=a*(r*o[u+1])**d,e[f+2]=a*(r*o[u+2])**d,e[f+3]=a*r*o[u+3],u+=s,f+=l}Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:c,linearToSRGBView:f,normalize:s,scale:u,scaleView:function(e,t,r){u(e.typedBuffer,t,r,e.typedBufferStride)},transformMat3:o,transformMat3View:i,transformMat4:function(e,t,r,n=4,a=n){if(e.length/n!=t.length/a)return void l().error("source and destination buffers need to have the same number of elements");let i=e.length/n,o=r[0],s=r[1],u=r[2],f=r[3],c=r[4],d=r[5],m=r[6],p=r[7],h=r[8],g=r[9],y=r[10],x=r[11],b=r[12],T=r[13],w=r[14],B=r[15],v=0,S=0;for(let r=0;r<i;r++){let r=t[v],l=t[v+1],i=t[v+2],M=t[v+3];e[S]=o*r+c*l+h*i+b*M,e[S+1]=s*r+d*l+g*i+T*M,e[S+2]=u*r+m*l+y*i+w*M,e[S+3]=f*r+p*l+x*i+B*M,v+=a,S+=n}},transformMat4View:function(e,t,r){if(e.count!==t.count)return;let n=e.count,a=r[0],l=r[1],i=r[2],o=r[3],s=r[4],u=r[5],f=r[6],c=r[7],d=r[8],m=r[9],p=r[10],h=r[11],g=r[12],y=r[13],x=r[14],b=r[15],T=e.typedBuffer,w=e.typedBufferStride,B=t.typedBuffer,v=t.typedBufferStride;for(let e=0;e<n;e++){let t=e*w,r=e*v,n=B[r],S=B[r+1],M=B[r+2],R=B[r+3];T[t]=a*n+s*S+d*M+g*R,T[t+1]=l*n+u*S+m*M+y*R,T[t+2]=i*n+f*S+p*M+x*R,T[t+3]=o*n+c*S+h*M+b*R}}},Symbol.toStringTag,{value:"Module"}))},78863:(e,t,r)=>{r.d(t,{a:()=>c,b:()=>o,c:()=>i,d:()=>a,e:()=>d,f:()=>f,l:()=>u,n:()=>m,t:()=>l});var n=r(50737);function a(e,t,r){l(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function l(e,t,r,n=3,a=n){if(e.length/n!==Math.ceil(t.length/a))return e;let i=e.length/n,o=r[0],s=r[1],u=r[2],f=r[4],c=r[5],d=r[6],m=r[8],p=r[9],h=r[10],g=r[12],y=r[13],x=r[14],b=0,T=0;for(let r=0;r<i;r++){let r=t[b],l=t[b+1],i=t[b+2];e[T]=o*r+f*l+m*i+g,e[T+1]=s*r+c*l+p*i+y,e[T+2]=u*r+d*l+h*i+x,b+=a,T+=n}return e}function i(e,t,r){o(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function o(e,t,r,n=3,a=n){if(e.length/n!==Math.ceil(t.length/a))return;let l=e.length/n,i=r[0],s=r[1],u=r[2],f=r[3],c=r[4],d=r[5],m=r[6],p=r[7],h=r[8],g=0,y=0;for(let r=0;r<l;r++){let r=t[g],l=t[g+1],o=t[g+2];e[y]=i*r+f*l+m*o,e[y+1]=s*r+c*l+p*o,e[y+2]=u*r+d*l+h*o,g+=a,y+=n}}function s(e,t,r,n=3,a=n){let l=Math.min(e.length/n,t.length/a),i=0,o=0;for(let s=0;s<l;s++)e[o]=r*t[i],e[o+1]=r*t[i+1],e[o+2]=r*t[i+2],i+=a,o+=n;return e}function u(e,t,r,n){f(e.typedBuffer,t.typedBuffer,r,n,e.typedBufferStride,t.typedBufferStride)}function f(e,t,r,a,l=3,i=l){let o=Math.min(e.length/l,t.length/i),s=0,u=0,c=1/n.Tf;for(let n=0;n<o;n++)e[u]=a*(r*t[s])**c,e[u+1]=a*(r*t[s+1])**c,e[u+2]=a*(r*t[s+2])**c,s+=i,u+=l}function c(e,t,r,n=3,a=n){let l=e.length/n;if(l!==Math.ceil(t.length/a))return e;let i=0,o=0;for(let s=0;s<l;s++)e[o]=t[i]+r[0],e[o+1]=t[i+1]+r[1],e[o+2]=t[i+2]+r[2],i+=a,o+=n;return e}function d(e,t){m(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function m(e,t,r=3,n=r){let a=Math.min(e.length/r,t.length/n),l=0,i=0;for(let o=0;o<a;o++){let a=t[l],o=t[l+1],s=t[l+2],u=a*a+o*o+s*s;if(u>0){let t=1/Math.sqrt(u);e[i]=t*a,e[i+1]=t*o,e[i+2]=t*s}l+=n,i+=r}}r(57845),r(61939),Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:f,linearToSRGBView:u,normalize:m,normalizeView:d,scale:s,scaleView:function(e,t,r){s(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)},shiftRight:function(e,t,r){let n=Math.min(e.count,t.count),a=e.typedBuffer,l=e.typedBufferStride,i=t.typedBuffer,o=t.typedBufferStride,s=0,u=0;for(let e=0;e<n;e++)a[u]=i[s]>>r,a[u+1]=i[s+1]>>r,a[u+2]=i[s+2]>>r,s+=o,u+=l},transformMat3:o,transformMat3View:i,transformMat4:l,transformMat4View:a,translate:c},Symbol.toStringTag,{value:"Module"}))},85860:(e,t,r)=>{function n(e){return e=e||globalThis.location.hostname,u.some(t=>null!=e?.match(t))}function a(e,t){return e?(t=t||globalThis.location.hostname)?null!=t.match(l)||null!=t.match(o)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(i)||null!=t.match(s)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e:null}r.d(t,{EM:()=>a,b5:()=>n});let l=/^devext\.arcgis\.com$/,i=/^qaext\.arcgis\.com$/,o=/^[\w-]*\.mapsdevext\.arcgis\.com$/,s=/^[\w-]*\.mapsqa\.arcgis\.com$/,u=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,l,i,/^jsapps\.esri\.com$/,o,s]},96058:(e,t,r)=>{r.d(t,{fetch:()=>Z});var n=r(50737),a=r(85860),l=r(20538),i=r(6815),o=r(3391),s=r(40998),u=r(38715),f=r(35430),c=r(63599),d=r(56911),m=r(42845),p=r(75169),h=r(96772),g=r(78863),y=r(75550),x=r(9212),b=r(47946),T=r(13815),w=r(99183),B=r(69828);class v{constructor(){this.geometries=[],this.materials=[],this.textures=[]}}class S{constructor(e,t,r){this.name=e,this.lodThreshold=t,this.pivotOffset=r,this.stageResources=new v,this.numberOfVertices=0}}var M=r(39166),R=r(83610),A=r(32391),I=r(61939),E=r(94264),O=r(61910),P=r(92753),_=r(12513),U=r(95775),L=r(49216),k=r(4023),q=r(18189),C=r(63497),G=r(17914),N=r(53041),j=r(82243),F=r(93446);let V=()=>I.A.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");class ${constructor(e,t,r){this.resource=e,this.textures=t,this.cachedMemory=r}}async function D(e,t){let r=await z(e,t),n=await K(r.textureDefinitions??{},t),a=0;for(let e in n)if(n.hasOwnProperty(e)){let t=n[e];a+=t?.image?t.image.width*t.image.height*4:0}return new $(r,n,a+(0,E.Qh)(r))}async function z(e,t){let r=t?.streamDataRequester;if(r)return W(e,r,t);let n=await (0,R.Ke)((0,M.A)(e,t));if(!0===n.ok)return n.value.data;(0,P.QP)(n.error),J(n.error)}async function W(e,t,r){let n=await (0,R.Ke)(t.request(e,"json",r));if(!0===n.ok)return n.value;(0,P.QP)(n.error),J(n.error.details.url)}function J(e){throw new A.A("",`Request for object resource failed: ${e}`)}async function K(e,t){let r=[];for(let n in e){let a=e[n],l=a.images[0].data;if(!l){V().warn("Externally referenced texture data is not yet supported");continue}let i=a.encoding+";base64,"+l,o="/textureDefinitions/"+n,s="rgba"===a.channels?a.alphaChannelUsage||"transparency":"none",u={noUnpackFlip:!0,wrap:{s:F.pF.REPEAT,t:F.pF.REPEAT},preMultiplyAlpha:Q(s)!==q.sf.Opaque},f=t?.disableTextures?Promise.resolve(null):(0,L.D)(i,t);r.push(f.then(e=>({refId:o,image:e,parameters:u,alphaChannelUsage:s})))}let n=await Promise.all(r),a={};for(let e of n)a[e.refId]=e;return a}function Q(e){switch(e){case"mask":return q.sf.Mask;case"maskAndTransparency":return q.sf.MaskBlend;case"none":return q.sf.Opaque;default:return q.sf.Blend}}let X=new _.R(1,2,"wosr");var H=r(72853),Y=r(87903);async function Z(e,t){let o,v=function(e){let t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}((0,a.EM)(e));if("wosr"===v.fileType){let{engineResources:e,referenceBoundingBox:r}=function(e,t){let r=[],n=[],a=[],l=new O.O,i=e.resource,o=_.R.parse(i.version||"1.0","wosr");X.validate(o);let s=i.model.name,u=i.model.geometries,f=i.materialDefinitions??{},c=e.textures,p=0,h=new Map;for(let e=0;e<u.length;e++){let i=u[e];if(!function(e){let t=e.params,r=t.topology,n=!0;switch(t.vertexAttributes||(V().warn("Geometry must specify vertex attributes"),n=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{let e=t.faces;if(e){if(t.vertexAttributes)for(let r in t.vertexAttributes){let t=e[r];t?.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(V().warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),n=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(V().warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),n=!1)):(V().warn(`Indexed geometry does not specify face indices for '${r}' attribute`),n=!1)}}else V().warn("Indexed geometries must specify faces"),n=!1;break}default:V().warn(`Unsupported topology '${r}'`),n=!1}e.params.material||(V().warn("Geometry requires material"),n=!1);let a=e.params.vertexAttributes;for(let e in a)a[e].values||(V().warn("Geometries with externally defined attributes are not yet supported"),n=!1);return n}(i))continue;let o=function(e){let t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}(i),s=i.params.vertexAttributes,m=[],g=e=>{if("PerAttributeArray"===i.params.topology)return null;let t=i.params.faces;for(let r in t)if(r===e)return t[r].values;return null},y=s[N.r.POSITION],x=y.values.length/y.valuesPerElement;for(let e in s){let t=s[e],r=t.values,n=g(e)??(0,U.tM)(x);m.push([e,new k.n(r,n,t.valuesPerElement,!0)])}let b=o.texture,T=c&&c[b];if(T&&!h.has(b)){let{image:e,parameters:t}=T,r=new G.g(e,t);n.push(r),h.set(b,r)}let w=h.get(b),B=w?w.id:void 0,v=o.material,S=l.get(v,b);if(null==S){let e=f[v.slice(v.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);let r=T&&T.alphaChannelUsage,n=e.transparency>0||"transparency"===r||"maskAndTransparency"===r,a=T?Q(T.alphaChannelUsage):void 0,i={ambient:(0,d.ci)(e.diffuse),diffuse:(0,d.ci)(e.diffuse),opacity:1-(e.transparency||0),transparent:n,textureAlphaMode:a,textureAlphaCutoff:.33,textureId:B,doubleSided:!0,cullFace:q.s2.None,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:T?.parameters.preMultiplyAlpha??!1};t?.materialParameters&&Object.assign(i,t.materialParameters),S=new j.$U(i,t),l.set(v,b,S)}a.push(S);let M=new C.V(S,m);p+=m.find(e=>e[0]===N.r.POSITION)?.[1]?.indices.length??0,r.push(M)}return{engineResources:[{name:s,stageResources:{textures:n,materials:a,geometries:r},pivotOffset:i.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:function(e){let t=(0,m.Ie)();return e.forEach(e=>{let r=e.boundingInfo;null!=r&&((0,m.iT)(t,r.bbMin),(0,m.iT)(t,r.bbMax))}),t}(r)}}(await (t.cache?t.cache.loadWOSR(v.url,t):D(v.url,t)),t);return{lods:e,referenceBoundingBox:r,isEsriSymbolResource:!1,isWosr:!0}}if(t.cache)o=await t.cache.loadGLTF(v.url,t,!!t.usePBR);else{let{loadGLTF:e}=await r.e(2288).then(r.bind(r,82288));o=await e(new b.R(t.streamDataRequester),v.url,t,t.usePBR)}let M=o.model.meta?.ESRI_proxyEllipsoid,R=o.meta.isEsriSymbolResource&&null!=M&&"EsriRealisticTreesStyle"===o.meta.ESRI_webstyle;R&&!o.customMeta.esriTreeRendering&&(o.customMeta.esriTreeRendering=!0,function(e,t){for(let r=0;r<e.model.lods.length;++r)for(let a of e.model.lods[r].parts){let l=a.attributes.normal;if(null==l)return;let i=a.attributes.position,o=i.count,f=(0,d.vt)(),m=(0,d.vt)(),p=(0,d.vt)(),g=new Float32Array(4*o),y=new Float32Array(3*o),x=(0,s.B8)((0,u.vt)(),a.transform),b=0,T=0;for(let s=0;s<o;s++){i.getVec(s,m),l.getVec(s,f),(0,c.t)(m,m,a.transform),(0,c.d)(p,m,t.center),(0,c.E)(p,p,t.radius);let o=p[2],u=(0,c.l)(p),d=Math.min(.45+.55*u*u,1)**n.Tf;(0,c.E)(p,p,t.radius),null!==x&&(0,c.t)(p,p,x),(0,c.n)(p,p),r+1!==e.model.lods.length&&e.model.lods.length>1&&(0,c.m)(p,p,f,o>-1?.2:Math.min(-4*o-3.8,1)),y[b]=p[0],y[b+1]=p[1],y[b+2]=p[2],b+=3,g[T]=d,g[T+1]=d,g[T+2]=d,g[T+3]=1,T+=4}a.attributes.normal=new h.xs(y),a.attributes.color=new h.Eq(g)}}(o,M));let A=!!t.usePBR,I=o.meta.isEsriSymbolResource?{usePBR:A,isSchematic:!1,treeRendering:R,mrrFactors:Y.SY}:{usePBR:A,isSchematic:!1,treeRendering:!1,mrrFactors:Y.mb},{engineResources:E,referenceBoundingBox:P}=function(e,t,r,a,o){let s=e.model,u=[],c=new Map,d=new Map,b=s.lods.length,v=(0,m.Ie)();return s.lods.forEach((e,M)=>{let R=!0===a.skipHighLods&&(b>1&&0===M||b>3&&1===M)||!1===a.skipHighLods&&null!=o&&M!==o;if(R&&0!==M)return;let A=new S(e.name,e.lodThreshold,[0,0,0]);e.parts.forEach(e=>{let o=R?new j.$U({},a):function(e,t,r,a,l,i,o,s){let u=e.materials.get(t.material);if(null==u)return null;let{normal:c,color:d,texCoord0:m,tangent:p}=t.attributes,h=t.material+(c?"_normal":"")+(d?"_color":"")+(m?"_texCoord0":"")+(p?"_tangent":""),g=null!=t.attributes.texCoord0,y=null!=t.attributes.normal,x=function(e){switch(e){case"BLEND":return q.sf.Blend;case"MASK":return q.sf.Mask;case"OPAQUE":case null:case void 0:return q.sf.Opaque}}(u.alphaMode);if(!i.has(h)){if(g){let t=(t,r=!1)=>{if(null!=t&&!o.has(t)){let n=e.textures.get(t);if(n){let e=n.data;o.set(t,new G.g((0,w.x3)(e)?e.data:e,{...n.parameters,preMultiplyAlpha:!(0,w.x3)(e)&&r,encoding:(0,w.x3)(e)?e.encoding:void 0}))}}};t(u.colorTexture,x!==q.sf.Opaque),t(u.normalTexture),t(u.occlusionTexture),t(u.emissiveTexture),t(u.metallicRoughnessTexture)}let r=1/n.Tf,c=u.color[0]**r,d=u.color[1]**r,m=u.color[2]**r,p=u.emissiveFactor[0]**r,b=u.emissiveFactor[1]**r,T=u.emissiveFactor[2]**r,v=null!=u.colorTexture&&g?o.get(u.colorTexture):null,S=(0,Y.Jr)(u),M=null!=u.normalTextureTransform?.scale?u.normalTextureTransform?.scale:f.Un;i.set(h,new j.$U({...a,transparent:x===q.sf.Blend,customDepthTest:q.it.Lequal,textureAlphaMode:x,textureAlphaCutoff:u.alphaCutoff,diffuse:[c,d,m],ambient:[c,d,m],opacity:u.opacity,doubleSided:u.doubleSided,doubleSidedType:"winding-order",cullFace:u.doubleSided?q.s2.None:q.s2.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:y?H.W.Attribute:H.W.ScreenDerivative,castShadows:!0,receiveShadows:u.receiveShadows,receiveAmbientOcclusion:u.receiveAmbientOcclustion,textureId:null!=v?v.id:void 0,colorMixMode:u.colorMixMode,normalTextureId:null!=u.normalTexture&&g?o.get(u.normalTexture).id:void 0,textureAlphaPremultiplied:null!=v&&!!v.parameters.preMultiplyAlpha,occlusionTextureId:null!=u.occlusionTexture&&g?o.get(u.occlusionTexture).id:void 0,emissiveTextureId:null!=u.emissiveTexture&&g?o.get(u.emissiveTexture).id:void 0,metallicRoughnessTextureId:null!=u.metallicRoughnessTexture&&g?o.get(u.metallicRoughnessTexture).id:void 0,emissiveFactor:[p,b,T],mrrFactors:S?Y.Bt:[u.metallicFactor,u.roughnessFactor,a.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:(0,B.G)(u.colorTextureTransform),normalTextureTransformMatrix:(0,B.G)(u.normalTextureTransform),scale:[M[0],M[1]],occlusionTextureTransformMatrix:(0,B.G)(u.occlusionTextureTransform),emissiveTextureTransformMatrix:(0,B.G)(u.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:(0,B.G)(u.metallicRoughnessTextureTransform),...l},s))}let b=i.get(h);if(r.stageResources.materials.push(b),g){let e=e=>{null!=e&&r.stageResources.textures.push(o.get(e))};e(u.colorTexture),e(u.normalTexture),e(u.occlusionTexture),e(u.emissiveTexture),e(u.metallicRoughnessTexture)}return b}(s,e,A,t,r,c,d,a),{geometry:u,vertexCount:b}=function(e,t){let r=e.attributes.position.count,n=(0,T.x)(e.indices||r,e.primitiveType),a=(0,p.oe)(3*r),{typedBuffer:o,typedBufferStride:s}=e.attributes.position;(0,g.t)(a,o,e.transform,3,s);let u=[[N.r.POSITION,new k.n(a,n,3,!0)]];if(null!=e.attributes.normal){let t=(0,p.oe)(3*r),{typedBuffer:a,typedBufferStride:o}=e.attributes.normal;(0,i.Ge)(ee,e.transform),(0,g.b)(t,a,ee,3,o),(0,l.or)(ee)&&(0,g.n)(t,t),u.push([N.r.NORMAL,new k.n(t,n,3,!0)])}if(null!=e.attributes.tangent){let t=(0,p.oe)(4*r),{typedBuffer:a,typedBufferStride:o}=e.attributes.tangent;(0,i.z0)(ee,e.transform),(0,y.t)(t,a,ee,4,o),(0,l.or)(ee)&&(0,g.n)(t,t,4),u.push([N.r.TANGENT,new k.n(t,n,4,!0)])}if(null!=e.attributes.texCoord0){let t=(0,p.oe)(2*r),{typedBuffer:a,typedBufferStride:l}=e.attributes.texCoord0;(0,x.a)(t,a,2,l),u.push([N.r.UV0,new k.n(t,n,2,!0)])}let f=e.attributes.color;if(null!=f){let t=new Uint8Array(4*r);4===f.elementCount?f instanceof h.Eq?(0,y.b)(t,f,1,255):(f instanceof h.XP||f instanceof h.Uz)&&(0,y.b)(t,f,1/255,255):(t.fill(255),f instanceof h.xs?(0,g.f)(t,f.typedBuffer,1,255,4,f.typedBufferStride):(e.attributes.color instanceof h.eI||e.attributes.color instanceof h.nS)&&(0,g.f)(t,f.typedBuffer,1/255,255,4,e.attributes.color.typedBufferStride)),u.push([N.r.COLOR,new k.n(t,n,4,!0)])}return{geometry:new C.V(t,u),vertexCount:r}}(e,o??new j.$U({},a)),S=u.boundingInfo;null!=S&&0===M&&((0,m.iT)(v,S.bbMin),(0,m.iT)(v,S.bbMax)),null!=o&&(A.stageResources.geometries.push(u),A.numberOfVertices+=b)}),R||u.push(A)}),{engineResources:u,referenceBoundingBox:v}}(o,I,{...t.materialParameters,treeRendering:R},t,v.specifiedLodIndex);return{lods:E,referenceBoundingBox:P,isEsriSymbolResource:o.meta.isEsriSymbolResource,isWosr:!1}}let ee=(0,o.vt)()},99183:(e,t,r)=>{r.d(t,{KB:()=>o,Xi:()=>l,pn:()=>s,x3:()=>i});var n=r(57845),a=r(18189);class l{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=a.JS.KTX2_ENCODING}}function i(e){return"encoded-mesh-texture"===e?.type}async function o(e){let t=new Blob([e]);return JSON.parse(await t.text())}async function s(e,t){if(t===a.JS.KTX2_ENCODING)return new l(e);let r=new Blob([e],{type:t}),i=URL.createObjectURL(r);switch(t){case"image/jpeg":i+="#.jpg";break;case"image/png":i+="#.png"}let o=new Image;if((0,n.A)("esri-iPhone"))return new Promise((e,t)=>{let r=()=>{a(),e(o)},n=e=>{a(),t(e)},a=()=>{URL.revokeObjectURL(i),o.removeEventListener("load",r),o.removeEventListener("error",n)};o.addEventListener("load",r),o.addEventListener("error",n),o.src=i});try{o.src=i,await o.decode()}catch(e){console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(i),o}}}]);