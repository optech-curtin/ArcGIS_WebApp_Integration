"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6041,7275],{7275:(e,t,i)=>{i.r(t),i.d(t,{applyTextFormattingHTML:()=>J,createFieldInfoMap:()=>j,findRelatedLayer:()=>el,findUtilityNetwork:()=>es,fixTokens:()=>N,formatAttributes:()=>Q,formatEditInfo:()=>z,formatValueToFieldInfo:()=>P,getAllFieldInfos:()=>V,getFieldInfo:()=>R,getFieldInfoLabel:()=>M,getFixedFieldName:()=>E,getFixedFieldNames:()=>Z,getHighlightKeyForFeature:()=>ec,getSourceLayer:()=>G,graphicCallback:()=>T,htmlEntities:()=>Y,isAssociatedFeatureSupportedLayer:()=>q,isExpressionField:()=>F,isFeatureSupportedLayer:()=>D,isGraphicForRelatableFeatureSupportedLayer:()=>$,isRelatableFeatureSupportedLayer:()=>C,isRelatableLayer:()=>U,isRelatedField:()=>ee,preLayerQueryCallback:()=>en,preRequestCallback:()=>ea,querySourceLayer:()=>B,queryUpdatedFeature:()=>X,shouldOpenInNewTab:()=>k,substituteAttributes:()=>H,substituteFieldsInLinksAndAttributes:()=>O});var r=i(57845),n=i(61939),a=i(45714),l=i(59983),s=i(71538),o=i(39265),h=i(71086),c=i(32274),u=i(20703),p=i(90628);let d=()=>n.A.getLogger("esri.widgets.Feature.support.featureUtils"),f=/href=(""|'')/gi,y=/(\{([^{\r\n]+)\})/g,m=/'/g,g=/^\s*expression\//i,v=/(\n)/gi,w=/[\u00A0-\u9999<>&]/gim,b=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,x=/^(?:mailto:|tel:)/,_="relationships/",I=(0,l.J2)("short-date-short-time");function G(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function T({type:e,value:t,event:i}){try{return"function"==typeof t?t(i):await t}catch(r){return void d().error("error",`An error occurred when calling the "${e}" function`,{error:r,graphic:i.graphic,value:t})}}function k(e=""){if(e)return!x.test(e.trim().toLowerCase())}function F(e){return!!e&&g.test(e)}function M(e,t){let i=function(e,t){if(!t||!F(t)||!e)return;let i=t.replace(g,"").toLowerCase();return e.find(({name:e})=>e.toLowerCase()===i)}(t,e?.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function E(e,t){let i=A(t,e);return i?i.name:e}function Z(e,t){return e&&e.map(e=>E(e,t))}function A(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function L(e){return`${e}`.trim()}function O({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:n,fieldInfoMap:l}){return r?H({formattedAttributes:t,template:function(e,t,i){let r=N(e,i);return r?r.replaceAll(b,(e,i,r)=>(function(e,t,i){let r=(t=L(t))&&"{"!==t[0];return(0,a.HC)(e,function(e,t=!1){let i={...e};return Object.keys(i).forEach(e=>(function(e,t,i=!1){let r=t[e];if("string"==typeof r){let n=(i?encodeURIComponent(r):r).replaceAll(m,"%27");t[e]=n}})(e,i,t)),i}(i,r||!1))})(e,i||r,t)):r}(r,{...t,...n,...e},i),fieldInfoMap:l}):""}function H({formattedAttributes:e,template:t,fieldInfoMap:i}){return L((0,a.HC)((0,a.HC)(t,e=>(function(e,t){let i=t.get(e.toLowerCase());return`{${i?.fieldName||e}}`})(e,i)),e).replaceAll(f,""))}function N(e,t){return e.replaceAll(y,(e,i,r)=>{let n=A(t,r);return n?`{${n.name}}`:i})}function D(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function U(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function C(e){return D(e)&&U(e)}function q(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function $(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&C(e.sourceLayer)}function P(e,t){var i,r;let{fieldInfos:n,fieldName:a,preventPlacesFormatting:l,layer:h,timeZone:u}=t,p=R(n,a),d=A(h,a);if(p&&!(0,o.JL)(a)){let t=d?.type,i=p.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||i)return(0,c.i0)(e,{format:i,fieldType:t,timeZoneOptions:{layerTimeZone:h&&"preferredTimeZone"in h?h.preferredTimeZone:null,viewTimeZone:u,datesInUnknownTimezone:!(!h||!("datesInUnknownTimezone"in h))&&!!h.datesInUnknownTimezone}})}let f=p?.format;return"string"==typeof e&&(0,o.JL)(a)&&f?(i=e,r=f,i=i.trim(),/\d{2}-\d{2}/.test(i)?i:i.includes(",")?S(i,",",", ",r):i.includes(";")?S(i,";","; ",r):i.includes(" ")?S(i," "," ",r):(0,s.ZV)(Number(i),(0,s.yx)(r))):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){let t=Number(e);if(!isNaN(t))return t}return e}(e,f))||null==e||null==f?J(e):(0,s.ZV)(e,l?{...(0,s.yx)(f),minimumFractionDigits:0,maximumFractionDigits:20}:(0,s.yx)(f))}function S(e,t,i,r){return e.trim().split(t).map(e=>(0,s.ZV)(Number(e),(0,s.yx)(r))).join(i)}function R(e,t){if(e?.length&&t)return e.find(e=>e.fieldName?.toLowerCase()===t.toLowerCase())}function z(e,t,i,r){let{creatorField:n,creationDateField:a,editorField:s,editDateField:o}=e;if(!t)return;let h=(0,p.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,i,I,"date"),c={...I,...h},u=t[o];if("number"==typeof u){let e=t[s];return{type:"edit",date:(0,l.Yq)(u,c),user:e}}let d=t[a];if("number"==typeof d){let e=t[n];return{type:"create",date:(0,l.Yq)(d,c),user:e}}return null}function j(e,t){let i=new Map;if(!e)return i;for(let r of e){if(!r.fieldName)continue;let e=E(r.fieldName,t);r.fieldName=e,i.set(e.toLowerCase(),r)}return i}function V(e){let t=[];if(!e)return t;let{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(e=>{if("fields"===e.type){let i=e?.fieldInfos;i&&t.push(...i)}}),t}function Y(e){return e.replaceAll(w,e=>`&#${e.charCodeAt(0)};`)}function J(e){return"string"==typeof e?e.replaceAll(v,'<br class="esri-text-new-line" />'):e}function K(e){let{value:t,fieldName:i,fieldInfos:n,fieldInfoMap:a,layer:l,graphic:s,timeZone:h}=e;if(null==t)return"";let u=function({fieldName:e,value:t,graphic:i,layer:n}){if(ee(e)||!n||"function"!=typeof n.getFieldDomain)return null;let a=i&&n.getFieldDomain(e,{feature:i,excludeImpliedDomains:(0,r.A)("esri-widget-legacy-field-domain-calculation")});return a&&"coded-value"===a.type?a.getName(t):null}({fieldName:i,value:t,graphic:s,layer:l});if(u)return u;let p=function({fieldName:e,graphic:t,layer:i}){if(ee(e)||!i||"function"!=typeof i.getFeatureType)return null;let{typeIdField:r}=i;if(!r||e!==r)return null;let n=i.getFeatureType(t);return n?n.name:null}({fieldName:i,graphic:s,layer:l});if(p)return p;if(a.get(i.toLowerCase()))return P(t,{fieldInfos:n||Array.from(a.values()),fieldName:i,layer:l,timeZone:h});let d=l?.fieldsIndex?.get(i);return d&&((0,c.fs)(d)||(0,o.OH)(d))?(0,c.i0)(t,{fieldType:d.type,timeZoneOptions:{layerTimeZone:l&&"preferredTimeZone"in l?l.preferredTimeZone:null,viewTimeZone:h,datesInUnknownTimezone:!(!l||!("datesInUnknownTimezone"in l))&&!!l.datesInUnknownTimezone}}):J(t)}function Q({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:n,relatedInfos:a,timeZone:l}){let s={};return a?.forEach(t=>(function({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:n,timeZone:a}){e&&t&&(t.relatedFeatures?.forEach(l=>et({attributes:e,graphic:l,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:n,timeZone:a})),t.relatedStatsFeatures?.forEach(l=>et({attributes:e,graphic:l,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:n,timeZone:a})))})({attributes:s,relatedInfo:t,fieldInfoMap:n,fieldInfos:e,layer:i,timeZone:l})),t&&Object.keys(t).forEach(a=>{let o=t[a];s[a]=K({fieldName:a,fieldInfos:e,fieldInfoMap:n,layer:i,value:o,graphic:r,timeZone:l})}),s}async function B(e,t){let{layer:i,graphic:r,outFields:n,objectIds:a,returnGeometry:l,spatialReference:s}=e,o=a[0];if("number"!=typeof o&&"string"!=typeof o)return d().warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:i,graphic:r,objectId:o,requiredFields:n}),null;if(!(0,h.BR)(i)?.operations?.supportsQuery)return d().warn("The specified layer cannot be queried. The following fields will not be available.",{layer:i,graphic:r,requiredFields:n,returnGeometry:l}),null;let c=i.createQuery();return c.objectIds=a,c.outFields=n?.length?n:[i.objectIdField],c.returnGeometry=!!l,c.returnZ=!!l,c.returnM=!!l,c.outSpatialReference=s,(await i.queryFeatures(c,t)).features[0]}async function W(e){if(!e.expressionInfos?.length)return!1;let{arcadeUtils:{hasGeometryFunctions:t}}=await (0,u.lw)();return t(e)}async function X({graphic:e,popupTemplate:t,layer:i,spatialReference:r},n){if(!i||!t||("function"==typeof i.load&&await i.load(n),!e.attributes))return;let a=i.objectIdField,l=e.attributes[a];if(null==l)return;let s=await t.getRequiredFields(i.fieldsIndex),h=(0,o.Kl)(s,e),c=h?[]:s.includes(a)?s:[...s,a],u=t.returnGeometry||await W(t);if(h&&!u)return;let p=await B({layer:i,graphic:e,outFields:c,objectIds:[l],returnGeometry:u,spatialReference:r},n);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes={...e.attributes,...p.attributes}))}function ee(e=""){return!!e&&e.includes(_)}function et({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:n,layer:a,timeZone:l}){e&&t&&i&&Object.keys(t.attributes).forEach(s=>{var o;let h=(o={layerId:i.relation.id.toString(),fieldName:s},`${_}${o.layerId}/${o.fieldName}`),c=t.attributes[s];e[h]=K({fieldName:h,fieldInfos:r,fieldInfoMap:n,layer:a,value:c,graphic:t,timeZone:l})})}let ei=e=>{if(!e)return!1;let t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},er=({layer:e,method:t,query:i,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||"attachments"===t)return;let n=null!=i.where?i.where:null,a=null!=i.geometry?i.geometry:null;ei(r)||ei(n)||"extent"===a?.type||"tile"===i.resultType||(i.cacheHint=!0)},en=({query:e,layer:t,method:i})=>{er({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},ea=({queryPayload:e,layer:t,method:i})=>{er({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})};function el(e,t,i){return e&&t&&i?"sublayer"===t.type?eh({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:i})||eh({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:i}):eh({layers:e.allLayers,map:e,relatedLayer:t,relationship:i})||eh({layers:e.allTables,map:e,relatedLayer:t,relationship:i}):null}function es(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find(e=>e.isUtilityLayer(t)):null}function eo(e,t){return e?.allTables.find(e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url)}function eh({map:e,relationship:t,relationship:{relatedTableId:i},relatedLayer:r,layers:n}){if(!n)return null;for(let a of n){if("map-image"===a.type){let i=eh({layers:a.sublayers,map:e,relatedLayer:r,relationship:t})||eh({layers:a.subtables,map:e,relatedLayer:r,relationship:t});if(i)return i;continue}if(!C(a))continue;if("sublayer"===r.type){if(a!==r&&a.id===i)return a.isTable?eo(e,a):a;continue}let n="scene"===r.type&&r.associatedLayer?r.associatedLayer.url:r.url;if(!n)break;if("sublayer"!==a.type){if(a!==r&&a.url===n&&a.layerId===i)return a}else if(a!==r&&a.layer?.url===n&&a.id===i)return a.isTable?eo(e,a):a}return null}function ec(e){let t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}},13491:(e,t,i)=>{i.d(t,{A:()=>p});var r=i(81856),n=i(28690),a=i(91838);i(57845),i(61939),i(33638);var l=i(12709),s=i(63667),o=i(28544),h=i(31651),c=i(7275);let u=class extends n.A{constructor(e){super(e),this.view=null,this.highlightName=o.Tv}add(e){let t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach(e=>this._highlight(e))}remove(e){let t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach(e=>this._removeHighlight(e))}removeAll(){this.removeAllHandles()}_highlight(e){let t=(0,s.i)(this.view,e.layer);(0,h.Of)(t)&&this.addHandles(t.highlight(e,{name:this.highlightName}),(0,c.getHighlightKeyForFeature)(e))}_removeHighlight(e){e&&this.removeHandles((0,c.getHighlightKeyForFeature)(e))}};(0,r._)([(0,a.MZ)()],u.prototype,"view",void 0),(0,r._)([(0,a.MZ)({constructOnly:!0})],u.prototype,"highlightName",void 0);let p=u=(0,r._)([(0,l.$)("esri.views.draw.support.HighlightHelper")],u)},32274:(e,t,i)=>{i.d(t,{EG:()=>d,Ll:()=>w,R3:()=>v,UH:()=>o,aM:()=>m,fs:()=>p,i0:()=>b});var r=i(59983),n=i(39265),a=i(20703);i(12723);var l=i(93682),s=i(90628);let o=",",h={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},c=new Set(["integer","small-integer"]),u=null;function p(e){return(0,n.vE)(e)||(0,n.zD)(e)||(0,n.Ah)(e)}async function d(e){let{field:t,field2:i,field3:r,normalizationField:n,valueExpression:l}=e,s=[];if(l){if(!u){let{arcadeUtils:e}=await (0,a.lw)();u=e}s=u.extractFieldNames(l)}return t&&s.push(t),i&&s.push(i),r&&s.push(r),n&&s.push(n),s}function f(e){return String(e).padStart(2,"0")}function y(e,t,i){let r;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),r=`TIMESTAMP'${i?e.getFullYear():e.getUTCFullYear()}-${f((i?e.getMonth():e.getUTCMonth())+1)}-${f(i?e.getDate():e.getUTCDate())} ${f(i?e.getHours():e.getUTCHours())}:${f(i?e.getMinutes():e.getUTCMinutes())}:${f(i?e.getSeconds():e.getUTCSeconds())}'`):r=e,r}function m(e,t,i,r){let{hasQueryEngine:n}=e,a=`(${y(i,g(e,i),n)} - ${y(t,g(e,t),n)})`,l=h[r],s="/";return l<1&&(l=1/l,s="*"),{sqlExpression:1===l?a:`(${a} ${s} ${l})`,sqlWhere:null}}function g(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){let i=e.getField(t);if("<now>"===t.toLowerCase())return;if((0,n.vE)(i))return"field"}}function v(e,t){let i=t&&e.getField(t);return!!i&&c.has(i.type)}function w(e){return`cast(${e} as float)`}function b(e,t){let i,n,{format:a,timeZoneOptions:o,fieldType:h}=t??{};if(o&&({timeZone:i,timeZoneName:n}=(0,s.hv)(o.layerTimeZone,o.datesInUnknownTimezone,o.viewTimeZone,(0,r.J2)(a||"short-date-short-time"),h)),"string"==typeof e&&isNaN(Date.parse("time-only"===h?`1970-01-01T${e}Z`:e)))return e;switch(h){case"date-only":{let t=(0,r.J2)(a||"short-date");return"string"==typeof e?(0,r.iS)(e,{...t}):(0,r.Yq)(e,{...t,timeZone:l.n$})}case"time-only":{let t=(0,r.J2)(a||"short-time");return"string"==typeof e?(0,r.F8)(e,t):(0,r.Yq)(e,{...t,timeZone:l.n$})}case"timestamp-offset":{if(!i&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;let t=a||o?(0,r.J2)(a||"short-date-short-time"):void 0,l=t?{...t,timeZone:i,timeZoneName:n}:void 0;return"string"==typeof e?(0,r.Ey)(e,l):(0,r.Yq)(e,l)}default:{let t=a||o?(0,r.J2)(a||"short-date-short-time"):void 0;return(0,r.Yq)("string"==typeof e?new Date(e):e,t?{...t,timeZone:i,timeZoneName:n}:void 0)}}}},76041:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Z});var r=i(81856),n=i(74652),a=i(33715),l=i(45257),s=i(91838);i(57845),i(61939);var o=i(12709),h=i(54774),c=i(59276),u=i(71230),p=i(22191),d=i(84156),f=i(13491),y=i(63667);class m{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-click"}}class g{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-double-click"}}class v{constructor(e,t,i,r,n,a,l,s,o,h){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=a,this.dy=l,this.totalDx=s,this.totalDy=o,this.viewEvent=h,this.defaultPrevented=!1,this.type="graphic-move-start"}preventDefault(){this.defaultPrevented=!0}}class w{constructor(e,t,i,r,n,a,l,s,o,h){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=a,this.dy=l,this.totalDx=s,this.totalDy=o,this.viewEvent=h,this.defaultPrevented=!1,this.type="graphic-move"}preventDefault(){this.defaultPrevented=!0}}class b{constructor(e,t,i,r,n,a,l,s,o,h){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=a,this.dy=l,this.totalDx=s,this.totalDy=o,this.viewEvent=h,this.defaultPrevented=!1,this.type="graphic-move-stop"}preventDefault(){this.defaultPrevented=!0}}class x{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-over"}}class _{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-out"}}class I{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-down"}}class G{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-up"}}var T=i(83392),k=i(53103),F=i(9247);let M="indicator-symbols",E=class extends n.A.EventedAccessor{constructor(e){super(e),this._activeGraphic=null,this._dragEvent=null,this._hoverGraphic=null,this._indicators=[],this._initialDragGeometry=null,this._manipulators=[],this._layerViews=null,this.type="graphic-mover",this.callbacks={onGraphicClick(){},onGraphicDoubleClick(){},onGraphicMoveStart(){},onGraphicMove(){},onGraphicMoveStop(){},onGraphicPointerOver(){},onGraphicPointerOut(){},onGraphicPointerDown(){},onGraphicPointerUp(){}},this.enableMoveAllGraphics=!1,this.graphics=[],this.indicatorsEnabled=!1,this.layer=new h.A({listMode:"hide",internal:!0,title:"GraphicMover highlight layer"}),this.view=null}initialize(){(0,y.Y)(this.view,this.layer),this._highlightHelper=new f.A({view:this.view}),this.refresh(),this.addHandles([(0,l.wB)(()=>this.graphics.length,()=>this.refresh()),(0,l.z7)(()=>this.view?.ready,()=>{this.addHandles([this.view.on("immediate-click",e=>this._clickHandler(e),T.o.TOOL),this.view.on("double-click",e=>this._doubleClickHandler(e),T.o.TOOL),this.view.on("pointer-down",e=>this._pointerDownHandler(e),T.o.TOOL),this.view.on("pointer-move",e=>this._pointerMoveHandler(e),T.o.TOOL),this.view.on("pointer-up",e=>this._pointerUpHandler(e),T.o.TOOL),this.view.on("drag",e=>this._dragHandler(e),T.o.TOOL),this.view.on("key-down",e=>this._keyDownHandler(e),T.o.TOOL)])},{once:!0,initial:!0}),(0,l.wB)(()=>this.view,e=>{this._highlightHelper.removeAll(),this._highlightHelper.view=e})])}destroy(){this._removeIndicators(),this.view.map?.remove(this.layer),this.layer.destroy(),this.reset(),this._manipulators.forEach(e=>e.destroy()),this._manipulators=null}set highlightsEnabled(e){this._highlightHelper?.removeAll(),this._set("highlightsEnabled",e),e&&this._highlightHelper?.add(this.graphics)}get state(){let e=this.view.ready,t=this.graphics.length>0,i=this._activeGraphic;return e&&t?i?"moving":"active":e?"ready":"disabled"}refresh(){this.reset(),this._setup()}reset(){this._activeGraphic=null,this._hoverGraphic=null,this._dragEvent=null,this._highlightHelper.removeAll()}updateGeometry(e,t){let i=this.graphics[e];i&&(i.set("geometry",t),this._setUpIndicators())}_setup(){this._setUpHighlights(),this._setUpIndicators(),this._setUpManipulators(),this._syncLayerViews()}_clickHandler(e){let t=this._findTargetGraphic((0,F.ZV)(e));if(t){let i=new m(t,this.graphics.indexOf(t),e.x,e.y,e);this.emit("graphic-click",i),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(i)}}_doubleClickHandler(e){let t=this._findTargetGraphic((0,F.ZV)(e));if(t){let i=new g(t,this.graphics.indexOf(t),e.x,e.y,e);this.emit("graphic-double-click",i),this.callbacks.onGraphicDoubleClick&&this.callbacks.onGraphicDoubleClick(i)}}_pointerDownHandler(e){let t=this._findTargetGraphic((0,F.ZV)(e));if(t){this._activeGraphic=t;let{x:i,y:r}=e,n=new I(t,this.graphics.indexOf(t),i,r,e);this.emit("graphic-pointer-down",n),this.callbacks.onGraphicPointerDown&&this.callbacks.onGraphicPointerDown(n)}else this._activeGraphic=null}_pointerUpHandler(e){if(this._activeGraphic){let{x:t,y:i}=e,r=this.graphics.indexOf(this._activeGraphic),n=new G(this._activeGraphic,r,t,i,e);this.emit("graphic-pointer-up",n),this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(n)}}_pointerMoveHandler(e){if(this._dragEvent)return;let t=this._findTargetGraphic((0,F.ZV)(e));if(t){let{x:i,y:r}=e;if(this._hoverGraphic){if(this._hoverGraphic===t)return;let n=this.graphics.indexOf(this._hoverGraphic),a=new _(this.graphics[n],n,i,r,e);this._hoverGraphic=null,this.emit("graphic-pointer-out",a),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(a)}let n=this.graphics.indexOf(t),a=new x(t,n,i,r,e);return this._hoverGraphic=t,this.emit("graphic-pointer-over",a),void(this.callbacks.onGraphicPointerOver&&this.callbacks.onGraphicPointerOver(a))}if(this._hoverGraphic){let{x:t,y:i}=e,r=this.graphics.indexOf(this._hoverGraphic),n=new _(this.graphics[r],r,t,i,e);this._hoverGraphic=null,this.emit("graphic-pointer-out",n),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(n)}}_dragHandler(e){if("start"!==e.action&&!this._dragEvent||!this._activeGraphic?.geometry)return;"start"===e.action&&this._removeIndicators(),e.stopPropagation();let{action:t,x:i,y:r}=e,n=this.graphics.indexOf(this._activeGraphic),l=this._dragEvent?i-this._dragEvent.x:0,s=this._dragEvent?r-this._dragEvent.y:0,o=i-e.origin.x,h=r-e.origin.y,c="start"===t?this._activeGraphic.geometry:this._initialDragGeometry,u=(0,d.lR)(c,o,h,this.view);if(this._activeGraphic.geometry=u,this.enableMoveAllGraphics&&this.graphics.forEach(e=>{e!==this._activeGraphic&&(e.geometry=(0,d.lR)(e.geometry,l,s,this.view))}),this._dragEvent=e,"start"===t){this._initialDragGeometry=(0,a.o8)(c);let t=new v(this._activeGraphic,this.graphics,n,i,r,l,s,o,h,e);this.emit("graphic-move-start",t),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(t),t.defaultPrevented&&this._activeGraphic.set("geometry",c)}else if("update"===t){let t=new w(this._activeGraphic,this.graphics,n,i,r,l,s,o,h,e);this.emit("graphic-move",t),this.callbacks.onGraphicMove&&this.callbacks.onGraphicMove(t),t.defaultPrevented&&(this._activeGraphic.geometry=c)}else{let t=new b(this._activeGraphic,this.graphics,n,i,r,l,s,o,h,e);this._dragEvent=null,this._activeGraphic=null,this._setUpIndicators(),this.emit("graphic-move-stop",t),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(t),t.defaultPrevented&&(this.graphics[n].set("geometry",this._initialDragGeometry),this._setUpIndicators()),this._initialDragGeometry=null}}_keyDownHandler(e){"a"!==e.key&&"d"!==e.key&&"n"!==e.key||"moving"!==this.state||e.stopPropagation()}_findTargetGraphic(e){let t=this.view.toMap(e),i=this.graphics,r=null,n=Number.MAX_VALUE;this._syncLayerViews();let a=this._layerViews.flatMap(e=>"graphicsViews"in e?Array.from(e.graphicsViews(),e=>e.hitTest(t)).flat():e.graphicsView.hitTest(t)).filter(e=>i.includes(e)).sort((e,t)=>i.indexOf(e)-i.indexOf(t));return a.length?a[0]:(this._manipulators.forEach(t=>{let i=t.intersectionDistance(e);null!=i&&i<n&&(n=i,r=t.graphic)}),r)}_syncLayerViews(){this._layerViews=[];let e=new Set;for(let t of this.graphics){let i=(0,y.i)(this.view,t.layer);i&&e.add(i)}this._layerViews=[...e]}_setUpManipulators(){let{graphics:e,view:t}=this;this._manipulators.forEach(e=>e.destroy()),this._manipulators=e.length?e.map(e=>new k.l({graphic:e,view:t})):[]}_setUpHighlights(){this.highlightsEnabled&&this._highlightHelper.add(this.graphics)}_setUpIndicators(){if(this._removeIndicators(),this.indicatorsEnabled){for(let e of this.graphics){let t=e.clone();t.symbol=function(e){if(null==e.symbol)return null;switch(e.symbol.type){case"cim":return new p.A({style:"circle",size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});case"picture-marker":{let{xoffset:t,yoffset:i,height:r,width:n}=e.symbol,a=r===n?n:Math.max(r,n);return new p.A({xoffset:t,yoffset:i,size:a,style:"square",color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-marker":{let{xoffset:t,yoffset:i,size:r,style:n}=e.symbol;return new p.A({xoffset:t,yoffset:i,style:"circle"===n?"circle":"square",size:r+2,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-fill":return new c.A({color:[0,0,0,0],outline:{style:"dash",color:[255,127,0,1],width:1}});case"simple-line":return new u.A({color:[255,127,0,1],style:"dash",width:1});case"text":{let{xoffset:t,yoffset:i}=e.symbol;return new p.A({xoffset:t,yoffset:i,size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}default:return null}}(e),this._indicators.push(t),this.addHandles((0,l.wB)(()=>e.symbol,()=>this._setUpIndicators()),M)}this.layer.addMany(this._indicators)}}_removeIndicators(){this.removeHandles(M),this._indicators.length&&(this.layer.removeMany(this._indicators),this._indicators.forEach(e=>e.destroy()),this._indicators=[])}};(0,r._)([(0,s.MZ)()],E.prototype,"_activeGraphic",void 0),(0,r._)([(0,s.MZ)({readOnly:!0})],E.prototype,"type",void 0),(0,r._)([(0,s.MZ)()],E.prototype,"callbacks",void 0),(0,r._)([(0,s.MZ)()],E.prototype,"enableMoveAllGraphics",void 0),(0,r._)([(0,s.MZ)()],E.prototype,"graphics",void 0),(0,r._)([(0,s.MZ)({value:!1})],E.prototype,"highlightsEnabled",null),(0,r._)([(0,s.MZ)()],E.prototype,"indicatorsEnabled",void 0),(0,r._)([(0,s.MZ)()],E.prototype,"layer",void 0),(0,r._)([(0,s.MZ)({readOnly:!0})],E.prototype,"state",null),(0,r._)([(0,s.MZ)()],E.prototype,"view",void 0);let Z=E=(0,r._)([(0,o.$)("esri.views.draw.support.GraphicMover")],E)},84156:(e,t,i)=>{i.d(t,{UT:()=>u,hs:()=>h,lR:()=>o,wW:()=>c});var r=i(20538),n=i(84766),a=i(3708),l=i(60470);function s(e,t,i,r){if(null==r||e.hasZ||(r=void 0),"point"===e.type)return e.x+=t,e.y+=i,e.hasZ&&null!=r&&(e.z+=r),e;if("multipoint"===e.type){let n=e.points;for(let e=0;e<n.length;e++)n[e]=p(n[e],t,i,r);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=i,e.ymax+=i,null!=r&&(e.zmin??=0,e.zmin+=r,e.zmax??=0,e.zmax+=r),e;let n=(0,l.$K)(e),a="polyline"===e.type?e.paths:e.rings;for(let e=0;e<n.length;e++){let a=n[e];for(let e=0;e<a.length;e++)a[e]=p(a[e],t,i,r)}return"paths"in e?e.paths=a:e.rings=a,e}function o(e,t,i,r,n){let a=e.clone(),o=r.resolution;if("point"===a.type){if(n)s(a,t*o,-i*o);else{let e=r.state.transform,n=r.state.inverseTransform,l=e[0]*a.x+e[2]*a.y+e[4],s=e[1]*a.x+e[3]*a.y+e[5];a.x=n[0]*(l+t)+n[2]*(s+i)+n[4],a.y=n[1]*(l+t)+n[3]*(s+i)+n[5]}return a}if("multipoint"===a.type){if(n)s(a,t*o,-i*o);else{let e=a.points,n=r.state.transform,l=r.state.inverseTransform;for(let r=0;r<e.length;r++){let a=e[r],s=n[0]*a[0]+n[2]*a[1]+n[4],o=n[1]*a[0]+n[3]*a[1]+n[5],h=l[0]*(s+t)+l[2]*(o+i)+l[4],c=l[1]*(s+t)+l[3]*(o+i)+l[5];e[r]=d(a,h,c,void 0)}}return a}if("extent"===a.type){if(n)s(a,t*o,-i*o);else{let e=r.state.transform,n=r.state.inverseTransform,l=e[0]*a.xmin+e[2]*a.ymin+e[4],s=e[1]*a.xmin+e[3]*a.ymin+e[5],o=e[0]*a.xmax+e[2]*a.ymax+e[4],h=e[1]*a.xmax+e[3]*a.ymax+e[5];a.xmin=n[0]*(l+t)+n[2]*(s+i)+n[4],a.ymin=n[1]*(l+t)+n[3]*(s+i)+n[5],a.xmax=n[0]*(o+t)+n[2]*(h+i)+n[4],a.ymax=n[1]*(o+t)+n[3]*(h+i)+n[5]}return a}if(n)s(a,t*o,-i*o);else{let e=(0,l.$K)(a),n="polyline"===a.type?a.paths:a.rings,s=r.state.transform,o=r.state.inverseTransform;for(let r=0;r<e.length;r++){let n=e[r];for(let e=0;e<n.length;e++){let r=n[e],a=s[0]*r[0]+s[2]*r[1]+s[4],l=s[1]*r[0]+s[3]*r[1]+s[5],h=o[0]*(a+t)+o[2]*(l+i)+o[4],c=o[1]*(a+t)+o[3]*(l+i)+o[5];n[e]=d(r,h,c,void 0)}}"paths"in a?a.paths=n:a.rings=n}return a}function h(e,t,i,r){if("point"===e.type){let{x:n,y:a}=e,l=r?r[0]:n,s=r?r[1]:a,o=e.clone();return o.x=(n-l)*t+l,o.y=(a-s)*i+s,o}if("multipoint"===e.type){let s=(0,l.$K)(e),o=(0,n.vt)(),[h,c,u,p]=(0,a.Yz)(o,[s]),f=r?r[0]:(h+u)/2,y=r?r[1]:(p+c)/2,m=e.clone(),g=m.points;for(let e=0;e<g.length;e++){let r=g[e],[n,a]=r,l=(n-f)*t+f,s=(a-y)*i+y;g[e]=d(r,l,s,void 0)}return m}if("extent"===e.type){let{xmin:n,xmax:a,ymin:l,ymax:s}=e,o=r?r[0]:(n+a)/2,h=r?r[1]:(s+l)/2,c=e.clone();if(c.xmin=(n-o)*t+o,c.ymax=(s-h)*i+h,c.xmax=(a-o)*t+o,c.ymin=(l-h)*i+h,c.xmin>c.xmax){let e=c.xmin,t=c.xmax;c.xmin=t,c.xmax=e}if(c.ymin>c.ymax){let e=c.ymin,t=c.ymax;c.ymin=t,c.ymax=e}return c}let s=(0,l.$K)(e),o=(0,n.vt)(),[h,c,u,p]=(0,a.Yz)(o,s),f=r?r[0]:(h+u)/2,y=r?r[1]:(p+c)/2,m=e.clone(),g="polyline"===m.type?m.paths:m.rings;for(let e=0;e<s.length;e++){let r=s[e];for(let n=0;n<r.length;n++){let a=r[n],[l,s]=a,o=(l-f)*t+f,h=(s-y)*i+y;g[e][n]=d(a,o,h,void 0)}}return"paths"in m?m.paths=g:m.rings=g,m}function c(e,t,i,r,n,a){let l=Math.sqrt((i-e)*(i-e)+(r-t)*(r-t));return Math.sqrt((n-e)*(n-e)+(a-t)*(a-t))/l}function u(e,t,i,n=!1){let a=Math.atan2(t.y-i.y,t.x-i.x)-Math.atan2(e.y-i.y,e.x-i.x),l=Math.atan2(Math.sin(a),Math.cos(a));return n?l:(0,r.KJ)(l)}function p(e,t,i,r){return d(e,e[0]+t,e[1]+i,null!=e[2]&&null!=r?e[2]+r:void 0)}function d(e,t,i,r){let n=[t,i];return e.length>2&&n.push(null!=r?r:e[2]),e.length>3&&n.push(e[3]),n}}}]);