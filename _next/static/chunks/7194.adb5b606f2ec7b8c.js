"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7194],{7194:(e,t,r)=>{r.d(t,{GridSnappingEngine:()=>w});var i=r(81856),n=r(28690),l=r(61939),a=r(20538),s=r(8922),o=r(91838);r(57845),r(33638);var u=r(12709),p=r(63599),d=r(65111),c=r(25606),h=r(70429),g=r(34483),f=r(24859),M=r(73541),v=r(3489),y=r(50547),S=r(58562);let w=class extends n.A{constructor(e){super(e),this.options=null}destroy(){this._set("options",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:(0,a.kU)(this.view.rotation??0)}get gridRotation(){return(0,a.kU)(this.grid?.rotation??0)}get gridCenter(){let{spatialReference:e,grid:t}=this;if(!t||!e||!(0,d.isLoadedOrLoadFor)(t.center.spatialReference,e))return null;try{let r=(0,d.project)(t.center,e),i=e.isWrappable&&null!=this.view?.center?(0,c.O7)(r.x,this.view.center.x,e):r.x;return(0,M.vt)(i,r.y,r.z)}catch(e){return l.A.getLogger(this).errorOnce("Grid Snapping - Failed to project grid center.",e),null}}get offsetScaleFactor(){let{pixelsPerStride:e,grid:t}=this;if(!t||!e)return 1;let{majorLineInterval:r,dynamicScaling:i}=t;return r<1?null:(0,f.Ge)(r,e,i)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){let{grid:e}=this;return e?(0,s.oU)(e.spacing,e.units,"meters"):null}get viewMetersPerPixel(){let{viewMetersPerSRUnit:e}=this;return null==e?null:e*(0,h.i1)(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){let{spatialReference:e}=this.view;return this.gridCenter?(0,f.WT)(this.gridCenter[0],this.gridCenter[1],e):null}get pixelsPerStride(){let{gridMetersPerStride:e,viewMetersPerPixel:t}=this;return t&&e?e/t:null}get updating(){return null!=this.grid&&null!=this.spatialReference&&null==this.viewMetersPerSRUnit}async fetchCandidates(e,t,r){let{options:i,view:n}=this;if(!i?.effectiveGridEnabled||!n.grid||r.feature?.attributes&&v.io in r.feature.attributes)return[];let l=r.coordinateHelper.arrayToPoint(e),a=i.distance*("touch"===r.pointer?i.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(l,a)}fetchCandidatesSync(e,t){let r=[],{grid:i,effectiveViewRotation:n,gridRotation:l,gridCenter:a,viewMetersPerPixel:s,viewMetersPerSRUnit:o,offsetScaleFactor:u,spatialReference:p,gridMetersPerStride:c,pixelsPerStride:h}=this;if(!(i&&s&&o&&a&&p&&u&&c&&h)||!i.dynamicScaling&&h<g.b||!(0,d.isLoadedOrLoadFor)(e.spatialReference,p))return r;let f=(0,d.project)(e,p),v=R((0,M.vt)(f.x,f.y,f.z),-l,a,-n),w=c/o*u,b=P(v,w,a),{shouldSnapX:Z,shouldSnapY:G}=x(b,v,t,s,o);if(!Z&&!G)return[];let C=R((0,M.vt)((Z?b:v)[0],(G?b:v)[1]),l,a,n),A=R(b,l,a,n);if(G){let e=R(_(b,v,w,"y"),l,a,n);r.push(new S.o({lineStart:A,lineEnd:e,targetPoint:C,isDraped:!1}))}if(Z){let e=R(_(b,v,w,"x"),l,a,n);r.push(new S.o({lineStart:A,lineEnd:e,targetPoint:C,isDraped:!1}))}return Z&&G&&r.push(new y.N(C,r[0],r[1],!1)),r}};(0,i._)([(0,o.MZ)({constructOnly:!0})],w.prototype,"view",void 0),(0,i._)([(0,o.MZ)()],w.prototype,"options",void 0),(0,i._)([(0,o.MZ)()],w.prototype,"grid",null),(0,i._)([(0,o.MZ)()],w.prototype,"effectiveViewRotation",null),(0,i._)([(0,o.MZ)()],w.prototype,"gridRotation",null),(0,i._)([(0,o.MZ)()],w.prototype,"gridCenter",null),(0,i._)([(0,o.MZ)()],w.prototype,"offsetScaleFactor",null),(0,i._)([(0,o.MZ)()],w.prototype,"spatialReference",null),(0,i._)([(0,o.MZ)()],w.prototype,"gridMetersPerStride",null),(0,i._)([(0,o.MZ)()],w.prototype,"viewMetersPerPixel",null),(0,i._)([(0,o.MZ)()],w.prototype,"viewMetersPerSRUnit",null),(0,i._)([(0,o.MZ)()],w.prototype,"pixelsPerStride",null),(0,i._)([(0,o.MZ)()],w.prototype,"updating",null),w=(0,i._)([(0,u.$)("esri.views.interactive.snapping.GridSnappingEngine")],w);let R=(e,t,r,i)=>{let n=(0,M.Hh)(e[0],e[1],e[2]);return(0,p.L)(n,(0,p.L)(n,n,r,t),r,i)},P=(e,t,r)=>{let i=(e[0]-r[0])/t,n=(e[1]-r[1])/t,l=Math.trunc(i),a=Math.trunc(n),s=Math.round(i%1),o=Math.round(n%1),u=r[0]+(l+s)*t,p=r[1]+(a+o)*t;return(0,M.vt)(u,p)},x=(e,t,r,i,n)=>i<=0?{shouldSnapX:!1,shouldSnapY:!1}:{shouldSnapX:Math.abs((e[0]-t[0])/i*n)<r,shouldSnapY:Math.abs((e[1]-t[1])/i*n)<r},_=(e,t,r,i)=>{if("y"===i){let i=t[0]>e[0]?1:-1;return(0,M.vt)(e[0]+r*i,e[1])}let n=t[1]>e[1]?1:-1;return(0,M.vt)(e[0],e[1]+r*n)}},24859:(e,t,r)=>{r.d(t,{Ge:()=>c,WT:()=>h});var i=r(8922),n=r(39960),l=r(65442),a=r(91463),s=r(75862),o=r(25606),u=r(71760),p=r(6322),d=r(34483);function c(e,t,r){let i=1===e?10:e;return i**(r?Math.round(Math.log(d.X/t)/Math.log(i)):0)}function h(e,t,r){let d,c="number"==typeof e?null:e,h=r??c?.spatialReference;if(null==h||!(0,u.fn)(h)||function(e){let{isGeographic:t,isWebMercator:r}=e;return!t&&!r}(h))return(0,i.GA)(h);let g=c?.x??e,f=c?.y??t,M=1/Math.sqrt(2),v=g+M,y=f+M,{isWebMercator:S,isGeographic:w}=h,R=w&&!(0,s.TT)(h)?a.A.WGS84:h;if(S){let e=new n.A({x:g,y:f,spatialReference:h});(0,p.ci)(e,!0,e),g=e.x,f=e.y,e=new n.A({x:v,y:y,spatialReference:h}),(0,p.ci)(e,!0,e),v=e.x,y=e.y,R=a.A.WGS84}let P=new l.A({paths:[[[g,f],[v,y]]],spatialReference:R}),x=(0,o.XX)(P,10);try{[d]=(0,s.l1)([x],"meters")}catch{return(0,i.GA)(h)}return d}},34483:(e,t,r)=>{r.d(t,{X:()=>i,b:()=>n});let i=50,n=5}}]);