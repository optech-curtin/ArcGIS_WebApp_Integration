"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2493],{6272:(e,a,n)=>{n.d(a,{X:()=>r});let r=Symbol("WebScene")},34455:(e,a,n)=>{n.d(a,{DO:()=>q,FT:()=>V,Hh:()=>S,OM:()=>j,OO:()=>E,Ps:()=>$,Wo:()=>R,_I:()=>k,_l:()=>U,dK:()=>K,eh:()=>J,l0:()=>B,t$:()=>Y,uk:()=>F,vI:()=>A,xh:()=>x});var r,s=n(31461),l=n(32391),o=n(8922),u=n(61414),h=n(54143),c=n(39960),f=n(87960),m=n(65111),d=n(91463),p=n(71760);function x(e,a,n){return!(0,m.canProjectWithoutEngine)(e,a,n)}function y(e,a,n){let r=x(e,a,n);if(r&&!(0,m.isLoaded)())throw new l.A("rasterprojectionhelper-project","projection engine is not loaded");return r}!function(e){e[e.None=0]="None",e[e.North=1]="North",e[e.South=2]="South",e[e.Both=3]="Both"}(r||(r={}));let g=(e,a,n,r=0)=>{if(1===n[0])return[0,0];let s=1,l=-1,o=1,u=-1;for(let a=0;a<e.length;a+=2)isNaN(e[a])||(s=s>e[a]?e[a]:s,l=l>e[a]?l:e[a],o=o>e[a+1]?e[a+1]:o,u=u>e[a+1]?u:e[a+1]);let{cols:h,rows:c}=a,f=(l-s)/h/n[0],m=(u-o)/c/n[1],d=2*r,p=0,x=!1,y=[0,0];for(let a=0;a<h-3;a++){for(let n=0;n<c-3;n++){let r=a*c*2+2*n,s=(e[r]+e[r+4]+e[r+4*c]+e[r+4*c+4])/4,l=(e[r+1]+e[r+5]+e[r+4*c+1]+e[r+4*c+5])/4,o=Math.abs((s-e[r+2*c+2])/f),u=Math.abs((l-e[r+2*c+3])/m);if(o+u>p&&(p=o+u,y=[o,u]),d&&p>d){x=!0;break}}if(x)break}return y},_={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},w=new Map,v=new Map,M=null;async function S(){M&&(0,m.isLoaded)()||((0,m.isLoaded)()||await (0,m.load)(),M=await Promise.all([n.e(472),n.e(5927)]).then(n.bind(n,40636)))}function A(e,a,n){return y(e.spatialReference,a),n?(0,m.getTransformation)(a,e.spatialReference,e):(0,m.getTransformation)(e.spatialReference,a,e)}function R(e,a,n,r=null){let s=e.spatialReference;if(!s||!a||s.equals(a))return e;y(s,a,r);let l=n.center,o=new u.A({xmin:l.x-e.x/2,xmax:l.x+e.x/2,ymin:l.y-e.y/2,ymax:l.y+e.y/2,spatialReference:s}),h=(0,m.project)(o,a,r),c=V(a);return null==h||null!=c&&h.width>=c?b(e,s,a):{x:h.width,y:h.height}}function b(e,a,n){let r=(0,o.GA)(a)/(0,o.GA)(n);return{x:e.x*r,y:e.y*r}}function P(e,a,n){let{spatialReference:r}=n;if(!r||!a||r.equals(a))return e;if(r.isGeographic&&a.isGeographic)return b(e,r,a);if(y(r,a),!M)throw new l.A("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:s,y:u}=e,h=(s+u)/2*(0,o.GA)(r),c=1;h>30&&(s*=c=30/h,u*=c);let d=256*s/2,p=256*u/2,{x:x,y:g}=n.center,_=[];for(let e=0;e<=256;e++)_.push([x-d,g-p+e*u]);for(let e=1;e<=256;e++)_.push([x-d+e*s,g+p]);for(let e=1;e<=256;e++)_.push([x+d,g+p-e*u]);for(let e=1;e<256;e++)_.push([x+d-e*s,g-p]);_.push(_[0]);let w=new f.A({rings:[_],spatialReference:r}),v=(0,m.project)(w,a);if(!v)return b(e,r,a);let S=v.extent,A=V(a);if(null==S||null!=A&&S.width>=A)return b(e,r,a);let R=Math.sqrt(M.planarArea(v)/(s*u*65536))/c,P={x:S.width/c/256,y:S.height/c/256},T={x:s*R,y:u*R},E=P.x*P.y;return Math.abs(E-T.x*T.y)/E<.1?P:T}function T(e,a){return("number"==typeof e?e:(e.x+e.y)/2)*(0,o.GA)(a)*3779.5199999999995}function E(e,a){let{pixelSize:n,extent:r}=e;return T(P(n,a,r),a)}function z(e,a=.01){return(0,o.GA)(e)?a/(0,o.GA)(e):0}function k(e,a,n=null,r=!0){let s=e.spatialReference;if(s.equals(a))return e;y(s,a,n);let l=(0,m.project)(e,a,n);return r&&l&&D([e],[l],s,a),l}function D(e,a,n,r){let s=G(n,!0),l=G(r,!0),o=z(n,500),u=z(r,500);if(o&&null!=s&&null!=l)for(let n=0;n<e.length;n++){let r=a[n];if(!r)continue;let{x:h}=e[n],{x:c}=r;c>=l[1]-u&&Math.abs(h-s[0])<o?r.x-=l[1]-l[0]:c<=l[0]+u&&Math.abs(h-s[1])<o&&(r.x+=l[1]-l[0])}}function O(e,a=!1){let n=e.wkid||e.wkt2||e.wkt;if(!n||e.isGeographic)return null;if(n=String(n),w.has(n)){let e=w.get(n);return a?e?.gcs:e?.pcs}let r=e.wkid?h.P.coordsys(e.wkid):h.P.fromString(e.isGeographic?h.a.PE_TYPE_GEOGCS:h.a.PE_TYPE_PROJCS,e.wkt2||e.wkt),s=I(r,z(e,1e-4)),l=I(r,0,!0);return w.set(n,{pcs:s,gcs:l}),a?l:s}function I(e,a=0,n=!1){let r=h.j.generate(e),s=n?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!r||!s?.length)return null;let l=!1,o=s.find(e=>1===e.getInclusive()&&1===e.getKind());if(!o){if(!(o=s.find(e=>1===e.getInclusive()&&0===e.getKind())))return null;l=!0}let u=n?0:2===r.getNorthPoleLocation()|2*(2===r.getSouthPoleLocation()),c=r.isPannableRectangle(),f=o.getCoord();if(l)return{isEnvelope:l,isPannable:c,vertices:f,coef:null,bbox:[f[0][0]-a,f[0][1]-a,f[1][0]+a,f[1][1]+a],poleLocation:u};let m=0,d=[],[p,x]=f[0],[y,g]=f[0];for(let e=0,a=f.length;e<a;e++){++m===a&&(m=0);let[n,r]=f[e],[s,l]=f[m];if(l===r)d.push([n,s,r,l,2]);else{let e=(s-n)/(l-r||1e-4),a=n-e*r;r<l?d.push([e,a,r,l,0]):d.push([e,a,l,r,1])}p=p<n?p:n,x=x<r?x:r,y=y>n?y:n,g=g>r?g:r}return{isEnvelope:!1,isPannable:c,vertices:f,coef:d,bbox:[p,x,y,g],poleLocation:u}}function N(e,a){let n=[],{cols:r,rows:s,xres:l,yres:o,usePixelCenter:u}=e,{xmin:h,ymax:c}=e;if(u&&(h+=l/2,c-=o/2),null==a){for(let e=0;e<r;e++)for(let a=0;a<s;a++)n.push([h+l*e,c-o*a]);return{points:n}}let f=new Uint8Array(r*s);if(a.isEnvelope){let{bbox:[e,u,m,d]}=a;for(let p=0,x=0;p<r;p++){let r=h+l*p,y=a.isPannable||r>=e&&r<=m;for(let e=0;e<s;e++,x++){let a=c-o*e;y&&a>=u&&a<=d&&(n.push([r,a]),f[x]=1)}}return{points:n,mask:f}}let m=a.coef,d=[];for(let e=0;e<s;e++){let a=c-o*e,n=[],r=[];for(let e=0;e<m.length;e++){let[s,l,o,u,h]=m[e];if(a===o&&o===u)n.push(s),n.push(l),r.push(2),r.push(2);else if(a>=o&&a<=u){let e=s*a+l;n.push(e),r.push(h)}}let s=n;if(n.length>2){let e=2===r[0]?0:r[0],a=n[0];s=[];for(let l=1;l<r.length;l++)2===r[l]&&l!==r.length-1||(r[l]!==e&&(s.push(0===e?Math.min(a,n[l-1]):Math.max(a,n[l-1])),e=r[l],a=n[l]),l===r.length-1&&s.push(0===r[l]?Math.min(a,n[l]):Math.max(a,n[l])));s.sort((e,a)=>e-a)}else n[0]>n[1]&&(s=[n[1],n[0]]);d.push(s)}for(let e=0,a=0;e<r;e++){let r=h+l*e;for(let e=0;e<s;e++,a++){let s=c-o*e,l=d[e];if(2===l.length)r>=l[0]&&r<=l[1]&&(n.push([r,s]),f[a]=1);else if(l.length>2){let e=!1;for(let a=0;a<l.length;a+=2)if(r>=l[a]&&r<=l[a+1]){e=!0;break}e&&(n.push([r,s]),f[a]=1)}}}return{points:n,mask:f}}function C(e,a){let n=V(e[0].spatialReference);if(e.length<2||null==n||(a=a??z(e[0].spatialReference),1===(e=e.filter(e=>e.width>a)).length))return e[0];let{xmin:r,xmax:s,ymin:l,ymax:o}=e[0];for(let a=1;a<e.length;a++){let r=e[a];s=r.xmax+n*a,l=Math.min(l,r.ymin),o=Math.max(o,r.ymax)}return new u.A({xmin:r,xmax:s,ymin:l,ymax:o,spatialReference:e[0].spatialReference})}function U(e,a,n=null,l=!0){let o=e.spatialReference;if(o.equals(a))return e;let h=j(e),c=V(o,!0),d=V(a);if(0===h||null==c||null==d){let s=L(e,a,n,l);if(null==c&&null!=d&&Math.abs(s.width-d)<z(a)&&(0,m.isLoaded)()){let n=O(o);if(null!=n&&n.poleLocation===r.None&&e.width<(n.bbox[2]-n.bbox[0])/2)return function(e,a){let n=V(a);if(null==n)return null;let{xmin:r,ymin:s,xmax:l,ymax:o}=e,h=e.spatialReference,c=new f.A({spatialReference:h,rings:[[[r,s],[l,s],[l,o],[r,o],[r,s]]]}),d=(0,m.project)(c,a);if(2!==d.rings.length||!d.rings[0].length||!d.rings[1].length)return null;let{rings:p}=d,x=z(h),y=new u.A({spatialReference:a});for(let e=0;e<2;e++){r=l=p[e][0][0],s=o=p[e][0][1];for(let a=0;a<p[e].length;a++)r=r>p[e][a][0]?p[e][a][0]:r,l=l<p[e][a][0]?p[e][a][0]:l,s=s>p[e][a][1]?p[e][a][1]:s,o=o<p[e][a][1]?p[e][a][1]:o;if(0===e)y.ymin=s,y.ymax=o,y.xmin=r,y.xmax=l;else if(y.ymin=Math.min(y.ymin,s),y.ymax=Math.max(y.ymax,o),Math.abs(l-n/2)<x)y.xmin=r,y.xmax=y.xmax+n;else{if(!(Math.abs(r+n/2)<x))return null;y.xmax=l+n}}return y}(e,a)||s}return s}let p=e.clone().normalize();if(1===p.length&&e.xmax<c&&e.xmax-c/2>z(o)){let{xmin:a,xmax:n}=e;for(let r=0;r<=h;r++){let s=0===r?a:-c/2,l=r===h?n-c*r:c/2;p[r]=new u.A({xmin:s,xmax:l,ymin:e.ymin,ymax:e.ymax,spatialReference:o})}}return C(p.map(e=>L(e,a,n,l)).filter(s.Ru))}function F(e,a,n){if("extent"===e.type){let{xmin:a,ymin:n,xmax:r,ymax:s,spatialReference:l}=e;e=new f.A({rings:[[[a,s],[r,s],[r,n],[a,n],[a,s]]],spatialReference:l})}return e.spatialReference.equals(a)?e:(y(e.spatialReference,a,n),(0,m.project)(e,a,n))}function L(e,a,n=null,r=!0,s=!0){let l=e.spatialReference;if(l.equals(a)||!a)return e;y(l,a,n);let o=(0,m.project)(e,a,n);if(s&&a.isWebMercator&&o&&(o.ymax=Math.min(20037508.342787,o.ymax),o.ymin=Math.max(-20037508.342787,o.ymin),o.ymin>=o.ymax))return null;if(!r||!o)return o;let u=G(l,!0),h=G(a,!0);if(null==u||null==h)return o;let f=z(l,.001),d=z(l,500),p=z(a,.001);if(Math.abs(o.xmin-h[0])<p&&Math.abs(o.xmax-h[1])<p){let r=Math.abs(e.xmin-u[0]),s=Math.abs(u[1]-e.xmax);if(r<f&&s>d){o.xmin=h[0];let r=[];r.push(new c.A(e.xmax,e.ymin,l)),r.push(new c.A(e.xmax,(e.ymin+e.ymax)/2,l)),r.push(new c.A(e.xmax,e.ymax,l));let s=r.map(e=>k(e,a,n)).filter(e=>!isNaN(e?.x)).map(e=>e.x);o.xmax=Math.max.apply(null,s)}if(s<f&&r>d){o.xmax=h[1];let r=[];r.push(new c.A(e.xmin,e.ymin,l)),r.push(new c.A(e.xmin,(e.ymin+e.ymax)/2,l)),r.push(new c.A(e.xmin,e.ymax,l));let s=r.map(e=>k(e,a,n)).filter(e=>!isNaN(e?.x)).map(e=>e.x);o.xmin=Math.min.apply(null,s)}}else{let e=z(a,.001);Math.abs(o.xmin-h[0])<e&&(o.xmin=h[0]),Math.abs(o.xmax-h[1])<e&&(o.xmax=h[1])}return o}function V(e,a=!1){return e?e.isWebMercator?2*(a?20037508.342787:20037508.342788905):e.wkid&&e.isGeographic?360:2*_[e.wkid]||null:null}function G(e,a=!1){if(e.isGeographic)return[-180,180];let n=V(e,a);return null!=n?[-n/2,n/2]:null}function W(e,a,n,r){let s=(e-a)/n;return s-Math.floor(s)!=0?s=Math.floor(s):r&&(s-=1),s}function j(e,a=!1){let n=V(e.spatialReference);if(null==n)return 0;let r=a?0:-(n/2),s=z(e.spatialReference),l=!a&&Math.abs(e.xmax-n/2)<s?n/2:e.xmax,o=!a&&Math.abs(e.xmin+n/2)<s?-n/2:e.xmin;return W(l,r,n,!0)-W(o,r,n,!1)}function q(e){let a=e.storageInfo.origin.x,n=V(e.spatialReference,!0);if(null==n)return{originX:a,halfWorldWidth:null,pyramidsInfo:null};let r=n/2,{nativePixelSize:s,storageInfo:l,extent:o}=e,{maximumPyramidLevel:u,blockWidth:h,pyramidScalingFactor:c}=l,f=s.x,m=[],d=null!=e.transform&&"gcs-shift"===e.transform.type,p=a+(d?0:r),x=d?n-a:r-a;for(let e=0;e<=u;e++){let e=(o.xmax-a)/f/h,n=e-Math.floor(e)==0?e:Math.ceil(e),r=x/f/h,s=r-Math.floor(r)==0?r:Math.ceil(r),l=Math.floor(p/f/h),u=Math.round(p/f)%h,d=(h-Math.round(x/f)%h)%h;m.push({resolutionX:f,blockWidth:h,datasetColumnCount:n,worldColumnCountFromOrigin:s,leftMargin:u,rightPadding:d,originColumnOffset:l}),f*=c}return{originX:a,halfWorldWidth:r,pyramidsInfo:m,hasGCSSShiftTransform:d}}function B(e){let a=e.isAdaptive&&null==e.spacing,n=e.spacing||[32,32],r=Z(e),s={cols:r.size[0]+1,rows:r.size[1]+1},l=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2,o=r.outofBoundPointCount===r.offsets.length/2||a&&l?[0,0]:g(r.offsets,s,n,4),u=(o[0]+o[1])/2,c=e.projectedExtent.spatialReference,f=e.srcBufferExtent.spatialReference;if(a&&(l||u>4)&&(x(c,f,e.datumTransformation)&&(c.isGeographic||O(c)),n=[4,4],s={cols:(r=Z({...e,spacing:n})).size[0]+1,rows:r.size[1]+1},o=g(r.offsets,s,n,4)),r.error=o,n[0]>1&&(r.coefficients=H(r.offsets,s,l)),e.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(f.isGeographic)r.gcsGrid={offsets:r.offsets,coefficients:r.coefficients,spacing:n};else{let a=O(c);if(null!=a&&!a.isEnvelope){let a=function(e){let a;if(!e||e.isGeographic)return e;let n=String(e.wkid||e.wkt2||e.wkt);return v.has(n)?a=v.get(n):(a=(e.wkid?h.P.coordsys(e.wkid):h.P.fromString(h.a.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),v.set(n,a)),new d.A({wkid:a})}(c),o=U(e.projectedExtent,a),{offsets:u}=Z({...e,srcBufferExtent:o,spacing:n}),f=H(u,s,l);r.gcsGrid={offsets:u,coefficients:f,spacing:n}}}return r}function Z(e){let{projectedExtent:a,srcBufferExtent:n,pixelSize:r,datumTransformation:s,rasterTransform:l}=e,o=a.spatialReference,u=n.spatialReference,f=y(o,u),{xmin:d,ymin:p,xmax:x,ymax:g}=a,_=V(u),w=null!=_&&(e.hasWrapAround||"gcs-shift"===l?.type),v=e.spacing||[32,32],M=v[0]*r.x,S=v[1]*r.y,A=1===v[0],R=Math.ceil((x-d)/M-.1/v[0])+ +!A,b=Math.ceil((g-p)/S-.1/v[1])+ +!A,P=function(e){let{inSR:a,outSR:n,datumTransformation:r,preferPE:s}=e;if(a.equals(n)){let{points:a}=N(e,null);return a}if(a.isWebMercator&&n.isWGS84||a.isWGS84&&n.isWebMercator)return function(e){let{cols:a,rows:n,xres:r,yres:s,usePixelCenter:l,inSR:o,outSR:u}=e,{xmin:h,ymax:f}=e;l&&(h+=r/2,f-=s/2);let d=[],p=[],x=Math.max(a,n);for(let e=0;e<x;e++){let l=h+r*Math.min(a,e),x=f-s*Math.min(n,e),y=(0,m.project)(new c.A({x:l,y:x,spatialReference:o}),u);e<=a&&d.push(y.x),e<=n&&p.push(y.y)}let y=[];for(let e=0;e<a;e++)for(let a=0;a<n;a++)y.push([d[e],p[a]]);return y}(e);if(y(a,n,r)&&s&&(a.isGeographic||null!=O(a)))return function(e){let{inSR:a,outSR:n,datumTransformation:r}=e,{points:s,mask:l}=N(e,O(a));if(!a.isGeographic){let e=a.wkid?h.P.coordsys(a.wkid):h.P.fromString(a.isGeographic?h.a.PE_TYPE_GEOGCS:h.a.PE_TYPE_PROJCS,a.wkt2||a.wkt);h.g.projToGeog(e,s.length,s)}if(null!=r&&r.steps.length){let e;if(n.isGeographic&&(e=s.map(([e])=>e>179.9955?1:e<-179.9955?-1:0)),r.steps.forEach(e=>{let a=e.wkid?h.P.geogtran(e.wkid):h.P.fromString(h.a.PE_TYPE_GEOGTRAN,e.wkt);h.h.geogToGeog(a,s.length,s,null,e.isInverse?h.a.PE_TRANSFORM_2_TO_1:h.a.PE_TRANSFORM_1_TO_2)}),e)for(let a=0;a<s.length;a++){let n=e[a],r=s[a][0],l=r>179.9955?1:r<-179.9955?-1:0;n&&l&&n!==l&&(s[a][0]=n>0?r+360:r-360)}}if(!n.isGeographic){let e=O(n,!0);!function(e,a){let[n,r]=a;for(let a=0;a<e.length;a++){let s=e[a][1];(s<n||s>r)&&(e[a]=[NaN,NaN])}}(s,null!=e&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90]);let a=n.wkid?h.P.coordsys(n.wkid):h.P.fromString(n.isGeographic?h.a.PE_TYPE_GEOGCS:h.a.PE_TYPE_PROJCS,n.wkt2||n.wkt);h.g.geogToProj(a,s.length,s)}let o=s;if(l&&s.length!==l.length){o=[];for(let e=0,a=0;e<l.length;e++)l[e]?o.push(s[a++]):o.push([NaN,NaN])}return o}(e);var l=e;let{points:o}=N(l,null),{inSR:u,outSR:f,datumTransformation:d}=l,p=o.map(e=>new c.A(e[0],e[1],u)),x=(0,m.project)(p,f,d);return d&&D(p,x,u,f),x.map(e=>e?[e.x,e.y]:[NaN,NaN])}({cols:R,rows:b,xmin:d,ymax:g,xres:M,yres:S,inSR:o,outSR:u,datumTransformation:s,preferPE:v[0]<=4,usePixelCenter:A}),T=[],E,k=0,I=A?-1:NaN,{xmin:C,xmax:U,ymax:F,width:L,height:G}=n,W=z(u,500),j=null!=_&&C>0&&U>_/2,q=!1;if(f){let e=O(o);q=null!=e&&e.poleLocation>0}for(let e=0;e<R;e++){let a=[];for(let n=0;n<b;n++){let r=P[e*b+n];if(w&&r[0]>U&&r[0]>_/2-W?r[0]-=_:w&&0===e&&r[0]<0&&j&&!l&&(r[0]+=_),!r||isNaN(r[0])||isNaN(r[1]))T.push(I),T.push(I),a.push(null),k++;else{if(l){let e=l.inverseTransform(new c.A({x:r[0],y:r[1],spatialReference:u}));r=[e.x,e.y]}a.push(r),e>0&&w&&E[n]&&r[0]<E[n][0]&&(r[0]+=_,q&&r[0]>U&&r[0]>_&&(r[0]-=_)),T.push((r[0]-C)/L),T.push((F-r[1])/G)}}E=a}return{offsets:T,error:null,coefficients:null,outofBoundPointCount:k,spacing:v,size:A?[R,b]:[R-1,b-1]}}function H(e,a,n){let{cols:r,rows:s}=a,l=new Float32Array((r-1)*(s-1)*12),o=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),u=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let a=0;a<r-1;a++){for(let n=0;n<s-1;n++){let h=a*s*2+2*n,c=e[h],f=e[h+1],m=e[h+2],d=e[h+3],p=e[h+=2*s],x=e[h+1],y=e[h+2],g=e[h+3],_=0,w=12*(n*(r-1)+a);for(let e=0;e<3;e++)l[w++]=o[_++]*c+o[_++]*m+o[_++]*y;_=0;for(let e=0;e<3;e++)l[w++]=o[_++]*f+o[_++]*d+o[_++]*g;_=0;for(let e=0;e<3;e++)l[w++]=u[_++]*c+u[_++]*p+u[_++]*y;_=0;for(let e=0;e<3;e++)l[w++]=u[_++]*f+u[_++]*x+u[_++]*g}if(n)for(let e=0;e<l.length;e++)isNaN(l[e])&&(l[e]=-1)}return l}function $(e){let{spatialReference:a}=e,n=(0,p.Vp)(a);if(!n)return e;let[r,s]=n.valid,l=s-r,o=0;return e.xmin<r?o=Math.ceil((r-e.xmin)/l):e.xmin>s&&(o=-Math.ceil((e.xmin-s)/l)),new u.A({spatialReference:e.spatialReference,xmin:e.xmin+o*l,ymin:e.ymin,xmax:e.xmax+o*l,ymax:e.ymax})}function Y(e,a,n){let{storageInfo:r,pixelSize:s}=a,l=0,u=!1,{pyramidResolutions:h}=r,f="mixed"===r.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,r.tileInfo.dpi/96)):1,m=(e.x+e.y)/2/f;if(null!=h&&h.length){let e=h[h.length-1],r=(e.x+e.y)/2,f=(s.x+s.y)/2;if(m<=f)l=0;else if(m>=r)l=h.length,u=m/r>8;else{let e,a=f;for(let r=1;r<=h.length;r++){if(m<=(e=(h[r-1].x+h[r-1].y)/2)){m===e?l=r:"down"===n?(l=r-1,u=m/a>8):l="up"===n||m-a>e-m||m/a>2?r:r-1;break}a=e}}let d=0===l?s:h[l-1];return u&&Math.min(d.x,d.y)*(0,o.GA)(a.spatialReference)>19567&&(u=!1),{pyramidLevel:l,pyramidResolution:new c.A({x:d.x,y:d.y,spatialReference:a.spatialReference}),excessiveReading:u}}let d=Math.log(e.x/s.x)/Math.LN2,p=Math.log(e.y/s.y)/Math.LN2,x=a.storageInfo.maximumPyramidLevel||0;(l="down"===n?Math.floor(Math.min(d,p)):"up"===n?Math.ceil(Math.max(d,p)):Math.round((d+p)/2))<0?l=0:l>x&&(u=l>x+3,l=x);let y=2**l;return{pyramidLevel:l,pyramidResolution:new c.A({x:y*a.nativePixelSize.x,y:y*a.nativePixelSize.y,spatialReference:a.spatialReference}),excessiveReading:u}}function J(e,a,n=!1){let{pixelSize:r,extent:s}=e,l=A(s,a,!1),o=U(function(e,a){let n=e.clone().normalize();return 1===n.length?n[0]:C(n,a)}(s,(r.x+r.y)/16),a,l);return n||0===j(o)?o:L(s,a,l)}function K(e,a,n){let r=n?.tileSize??512,s=n?.alignGlobalDatasetWithAGOL??!0,l=!!n?.limitToSrcResolution,{extent:o,spatialReference:u,pixelSize:h}=e,c=P(h,a,o);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};let f=(c.x+c.y)/2,m=T(f,a),p=a.isGeographic?256/r*295828763.7958547:256/r*591657527.591555,x="vector-magdir"===e.dataType||"vector-uv"===e.dataType,y=J(e,a,!0),g=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(p/2/m)/Math.LN2));if(!x&&s&&(a.isGeographic||a.isWebMercator)){let n=V(a);if(!(x=j(y)>0||null!=n&&y.width>n/4)&&null!=n){let a=-1;if(g<3)a=2**g*f*r;else if(e.storageInfo){let{maximumPyramidLevel:n=0,pyramidScalingFactor:s=2}=e.storageInfo;a=s**n*f*r}let s=Math.ceil(n/a);x=1===s||2===s&&n/2-y.xmax<a}}let _,w=m,v=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(x){w=p;let n=a.isGeographic?1341104507446289e-21:.29858214164761665,r=T(n,a),s=a.isGeographic?4326:3857;_=P({x:n,y:n},u,J(e,new d.A({wkid:s}),!0)),_.x*=w/r,_.y*=w/r}else{_={x:h.x,y:h.y};let e=0;for(;w<.5005*p&&e<g;)e++,w*=v,_.x*=v,_.y*=v;Math.max(w,p)/Math.min(w,p)<=1.001&&(w=p)}let M=[w],S=[{x:_.x,y:_.y}],A=Math.min(70.5310735,m)/1.001;for(;w>=A;)w/=v,_.x/=v,_.y/=v,M.push(w),S.push({x:_.x,y:_.y});if(l){let e=.001*h.x,a=S.findIndex(a=>a.x>=h.x-e&&a.x<=h.x+e);a>-1?(S.length=a+1,M.length=a+1):(a=S.findIndex(a=>a.x<=h.x+e))>0&&(S.length=a,M.length=a)}return{projectedPixelSize:c,scales:M,srcResolutions:S,isCustomTilingScheme:!x}}},47646:(e,a,n)=>{n.d(a,{A:()=>el});var r=n(81856),s=n(97135),l=n(28690),o=n(45257),u=n(91838);n(57845);var h=n(61939);n(33638);var c=n(12709),f=n(55048),m=n(6815),d=n(19284);function p(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}function x(e){let a=e.toRgba();return[a[0]/255,a[1]/255,a[2]/255,a[3]]}function y(e){let a;if(!e.hasVisualVariables("size"))return{kind:"constant",value:[(0,f.Lz)(e.trailWidth)]};let n=e.getVisualVariablesForType("size")[0],r=[],s=[];if(n.stops){for(let e of n.stops)r.push(e.value),s.push((0,f.Lz)(e.size));a=n.stops.length}else r.push(n.minDataValue,n.maxDataValue),s.push((0,f.Lz)(n.minSize),(0,f.Lz)(n.maxSize)),a=2;return{kind:"ramp",stops:r,values:s,count:a}}function g(e,a,n,r){switch(a){case"int":e.setUniform1iv(n,r);break;case"float":e.setUniform1fv(n,r);break;case"vec2":e.setUniform2fv(n,r);break;case"vec3":e.setUniform3fv(n,r);break;case"vec4":e.setUniform4fv(n,r)}}function _(e,a,n,r){"constant"===r.kind?g(e,n,`u_${a}`,r.value):(g(e,"float",`u_${a}_stops`,r.stops),g(e,n,`u_${a}_values`,r.values),e.setUniform1i(`u_${a}_count`,r.count))}function w(e,a){return e===a||null!=e&&null!=a&&e.equals(a)}function v(e,a){var n,r;let s;if(n=e.simulationSettings,r=a.simulationSettings,n.collisions!==r.collisions||n.density!==r.density||n.interpolate!==r.interpolate||n.lineCollisionWidth!==r.lineCollisionWidth||n.lineSpacing!==r.lineSpacing||n.maxTurnAngle!==r.maxTurnAngle||n.minSpeedThreshold!==r.minSpeedThreshold||n.segmentLength!==r.segmentLength||n.smoothing!==r.smoothing||n.velocityScale!==r.velocityScale||n.verticesPerLine!==r.verticesPerLine||!w(e.timeExtent,a.timeExtent))return!1;let l=!0;return e.loadImagery===a.loadImagery&&e.createFlowMesh===a.createFlowMesh&&e.color.kind===a.color.kind&&e.opacity.kind===a.opacity.kind&&e.size.kind===a.size.kind}var M=n(92753),S=n(62233),A=n(93446),R=n(87155),b=n(15494),P=n(84172),T=n(99419);class E{constructor(e){this._params=e,this.animated=!1}isCompatible(e){if(!(e instanceof E)||!w(this._params.timeExtent,e._params.timeExtent))return!1;let a=!0;return this._params.loadImagery===e._params.loadImagery&&this._params.color.kind===e._params.color.kind&&this._params.opacity.kind===e._params.opacity.kind}async load(e,a){let{extent:n,size:r}=e;return(0,M.Te)(a),new O(await this._params.loadImagery(n,r[0],r[1],this._params.timeExtent,a),{color:this._params.color,opacity:this._params.opacity})}render(e,a,n){let{context:r}=e,{program:s}=n;r.setFaceCullingEnabled(!1),r.setBlendingEnabled(!0),r.setBlendFunction(A.dn.ONE,A.dn.ONE_MINUS_SRC_ALPHA),r.useProgram(s),s.setUniformMatrix3fv("u_dvsMat3",a.dvsMat3),r.bindTexture(n.texture,0),s.setUniform1i("u_texture",0),s.setUniform1f("u_Min",n.min),s.setUniform1f("u_Max",n.max),_(s,"color","vec4",this._params.color),_(s,"opacity","float",this._params.opacity),r.bindVAO(n.vertexArray),r.drawArrays(A.WR.TRIANGLE_STRIP,0,4)}}let z=new Map;z.set("a_position",0),z.set("a_texcoord",1);let k=new Map([["geometry",[new T._("a_position",2,A.pe.UNSIGNED_SHORT,0,8),new T._("a_texcoord",2,A.pe.UNSIGNED_SHORT,4,8)]]]),D={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:z};class O{constructor(e,a){this._flowData=e,this._values=a}attach(e){let{context:a}=e,{width:n,height:r}=this._flowData,s=new Map([["geometry",S.g.createVertex(a,A._U.STATIC_DRAW,new Uint16Array([0,0,0,1,n,0,1,1,0,r,0,0,n,r,1,0]))]]),l=new P.Z(a,z,k,s),o=[];"ramp"===this._values.color.kind&&o.push("vvColor"),"ramp"===this._values.opacity.kind&&o.push("vvOpacity");let u=e.getProgram(D,o),h=1e6,c=-1e6;for(let e=0;e<r;e++)for(let a=0;a<n;a++)if(0!==this._flowData.mask[e*n+a]){let r=this._flowData.data[2*(e*n+a)],s=this._flowData.data[2*(e*n+a)+1],l=Math.sqrt(r*r+s*s);h=Math.min(h,l),c=Math.max(c,l)}let f=new Uint8Array(4*n*r);for(let e=0;e<r;e++)for(let a=0;a<n;a++)if(0!==this._flowData.mask[e*n+a]){let r=this._flowData.data[2*(e*n+a)],s=this._flowData.data[2*(e*n+a)+1],l=(Math.sqrt(r*r+s*s)-h)/(c-h);f[4*(e*n+a)]=255*l,f[4*(e*n+a)+1]=0,f[4*(e*n+a)+2]=0,f[4*(e*n+a)+3]=255}else f[4*(e*n+a)]=0,f[4*(e*n+a)+1]=0,f[4*(e*n+a)+2]=0,f[4*(e*n+a)+3]=0;let m=new b.R;m.internalFormat=A.Ab.RGBA,m.wrapMode=A.pF.CLAMP_TO_EDGE,m.flipped=!0,m.width=n,m.height=r;let d=new R.g(a,m,f);this.vertexArray=l,this.program=u,this.texture=d,this.min=h,this.max=c,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.compiled}}class I{constructor(e){this._params=e}get animated(){return this._params.flowSpeed>0}isCompatible(e){return e instanceof I&&v(this._params,e._params)}async load(e,a){let{extent:n,size:r}=e;(0,M.Te)(a);let s=await this._params.loadImagery(n,r[0],r[1],this._params.timeExtent,a),{vertexData:l,indexData:o}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,s,a);return new F(l,o,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(e,a,n){let{context:r}=e,{program:s}=n;r.setFaceCullingEnabled(!1),r.setBlendingEnabled(!0),r.setBlendFunction(A.dn.ONE,A.dn.ONE_MINUS_SRC_ALPHA),r.useProgram(s),s.setUniform1f("u_time",a.time),s.setUniform1f("u_trailLength",this._params.trailLength),s.setUniform1f("u_flowSpeed",this._params.flowSpeed),s.setUniform1f("u_featheringSize",this._params.featheringSize),s.setUniform1f("u_featheringOffset",this._params.featheringOffset),s.setUniform1f("u_introFade",+!!this._params.introFade),s.setUniform1f("u_fadeToZero",+!!this._params.fadeToZero),s.setUniform1f("u_decayRate",this._params.decayRate),s.setUniformMatrix3fv("u_dvsMat3",a.dvsMat3),s.setUniformMatrix3fv("u_displayViewMat3",a.displayViewMat3),_(s,"color","vec4",this._params.color),_(s,"opacity","float",this._params.opacity),_(s,"size","float",this._params.size),r.bindVAO(n.vertexArray),r.drawElements(A.WR.TRIANGLES,n.indexCount,A.pe.UNSIGNED_INT,0)}}let N=new Map;N.set("a_xyts0",0),N.set("a_xyts1",1),N.set("a_typeIdDurationSeed",2),N.set("a_extrudeInfo",3);let C=new Map([["geometry",[new T._("a_xyts0",4,A.pe.FLOAT,0,64),new T._("a_xyts1",4,A.pe.FLOAT,16,64),new T._("a_typeIdDurationSeed",4,A.pe.FLOAT,32,64),new T._("a_extrudeInfo",4,A.pe.FLOAT,48,64)]]]),U={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:N};class F{constructor(e,a,n){this._vertexData=e,this._indexData=a,this._values=n}attach(e){let{context:a}=e,n=S.g.createVertex(a,A._U.STATIC_DRAW,this._vertexData),r=S.g.createIndex(a,A._U.STATIC_DRAW,this._indexData),s=new Map([["geometry",n]]),l=new P.Z(a,N,C,s,r),o=[];"ramp"===this._values.color.kind&&o.push("vvColor"),"ramp"===this._values.opacity.kind&&o.push("vvOpacity"),"ramp"===this._values.size.kind&&o.push("vvSize");let u=e.getProgram(U,o);this.vertexArray=l,this.program=u,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}class L{constructor(e){this._styles=e}get animated(){return this._styles.reduce((e,a)=>e||a.animated,!1)}isCompatible(e){if(!(e instanceof L)||this._styles.length!==e._styles.length)return!1;let a=this._styles.length;for(let n=0;n<a;n++)if(!this._styles[n].isCompatible(e._styles[n]))return!1;return!0}async load(e,a){return new V(await Promise.all(this._styles.map(n=>n.load(e,a))))}render(e,a,n){for(let r=0;r<this._styles.length;r++)this._styles[r].render(e,a,n.resources[r])}}class V{constructor(e){this.resources=e}attach(e){for(let a of this.resources)a.attach(e)}detach(){for(let e of this.resources)e.detach()}get ready(){return this.resources.reduce((e,a)=>e&&a.ready,!0)}}class G{constructor(e){this._params=e}get animated(){return this._params.flowSpeed>0}isCompatible(e){return e instanceof G&&v(this._params,e._params)}async load(e,a){let{extent:n,size:r}=e;(0,M.Te)(a);let s=await this._params.loadImagery(n,r[0],r[1],this._params.timeExtent,a),{vertexData:l,indexData:o}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,s,a);return new B(l,o,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(e,a,n){let{context:r}=e,{program:s}=n;r.setFaceCullingEnabled(!1),r.setBlendingEnabled(!0),r.setBlendFunction(A.dn.ONE,A.dn.ONE_MINUS_SRC_ALPHA),r.useProgram(s),s.setUniform1f("u_time",a.time),s.setUniform1f("u_trailLength",this._params.trailLength),s.setUniform1f("u_flowSpeed",this._params.flowSpeed),s.setUniform1f("u_featheringSize",this._params.featheringSize),s.setUniform1f("u_featheringOffset",this._params.featheringOffset),s.setUniform1f("u_introFade",+!!this._params.introFade),s.setUniform1f("u_fadeToZero",+!!this._params.fadeToZero),s.setUniform1f("u_decayRate",this._params.decayRate),s.setUniformMatrix3fv("u_dvsMat3",a.dvsMat3),s.setUniformMatrix3fv("u_displayViewMat3",a.displayViewMat3),_(s,"color","vec4",this._params.color),_(s,"opacity","float",this._params.opacity),_(s,"size","float",this._params.size),r.bindVAO(n.vertexArray),r.drawElements(A.WR.TRIANGLES,n.indexCount,A.pe.UNSIGNED_INT,0)}}let W=new Map;W.set("a_positionAndSide",0),W.set("a_timeInfo",1),W.set("a_extrude",2),W.set("a_speed",3);let j=new Map([["geometry",[new T._("a_positionAndSide",3,A.pe.FLOAT,0,36),new T._("a_timeInfo",3,A.pe.FLOAT,12,36),new T._("a_extrude",2,A.pe.FLOAT,24,36),new T._("a_speed",1,A.pe.FLOAT,32,36)]]]),q={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:W};class B{constructor(e,a,n){this._vertexData=e,this._indexData=a,this._values=n}attach(e){let{context:a}=e,n=S.g.createVertex(a,A._U.STATIC_DRAW,this._vertexData),r=S.g.createIndex(a,A._U.STATIC_DRAW,this._indexData),s=new Map([["geometry",n]]),l=new P.Z(a,W,j,s,r),o=[];"ramp"===this._values.color.kind&&o.push("vvColor"),"ramp"===this._values.opacity.kind&&o.push("vvOpacity"),"ramp"===this._values.size.kind&&o.push("vvSize");let u=e.getProgram(q,o);this.vertexArray=l,this.program=u,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}var Z=n(37810),H=n(59709);class $ extends H.A{constructor(){super(...arguments),this._visualState={time:0,dvsMat3:(0,d.vt)(),displayViewMat3:(0,d.vt)()}}dispose(){}prepareState(e){let{context:a}=e;a.setColorMask(!0,!0,!0,!0),a.setStencilFunction(A.MT.EQUAL,0,255)}draw(e,a){let{requestRender:n,allowDelayedRender:r}=e,{displayData:s}=a;if(null==s||("loaded"===s.state.name&&s.attach({context:e.context,getProgram:(a,n)=>e.painter.materialManager.getProgram(a,n)}),"attached"!==s.state.name))return;let l=s.state.resources;!r||l.ready||null==n?(this._visualState.time=e.time/1e3,this._visualState.dvsMat3=a.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=e.state.displayViewMat3,s.flowStyle.render({context:e.context,getProgram:(a,n)=>e.painter.materialManager.getProgram(a,n)},this._visualState,l),s.flowStyle.animated&&null!=n&&n()):n()}}var Y=n(52548),J=n(24080);class K extends J.A{constructor(){super(...arguments),this.flowStyle=null}doRender(e){super.doRender(e)}prepareRenderPasses(e){let a=e.registerRenderPass({name:"flow",brushes:[$],target:()=>this.children,drawPhase:Y.S5.MAP});return[...super.prepareRenderPasses(e),a]}}var X=n(20538),Q=n(61414),ee=n(39960);class et{constructor(e,a,n,r){this.state={name:"created"},this.flowStyle=e,this.extent=a,this.size=n,this.pixelRatio=r}async load(){let e=new AbortController;this.state={name:"loading",abortController:e};let a={extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},n=await this.flowStyle.load(a,e.signal);this.state={name:"loaded",resources:n}}attach(e){if("loaded"!==this.state.name)return void h.A.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");let a=this.state.resources;a.attach(e),this.state={name:"attached",resources:a}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(e){return!!this.flowStyle.isCompatible(e.flowStyle)&&!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio)&&(this.flowStyle=e.flowStyle,!0)}}var ea=n(19733);class ei extends ea.q{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(e){this._displayData=e,this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(e){let{displayData:a}=this;if(null==a)return;let n=a.extent.xmin,r=a.extent.ymax,s=[0,0];e.toScreen(s,[n,r]);let l=(a.extent.xmax-a.extent.xmin)/a.size[0]/e.resolution,o=(0,X.kU)(e.rotation),{displayViewScreenMat3:u}=this.transforms;(0,m.kN)(u,[-1,1,0]),(0,m.hs)(u,u,[2/(e.size[0]*e.pixelRatio),-2/(e.size[1]*e.pixelRatio),1]),(0,m.Tl)(u,u,[s[0],s[1],0]),(0,m.e$)(u,u,o),(0,m.hs)(u,u,[l*e.pixelRatio,l*e.pixelRatio,1])}_createTransforms(){return{displayViewScreenMat3:(0,d.vt)()}}}let en=class extends l.A{constructor(e){super(e),this._flowDisplayObject=new ei,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(e){let{flowStyle:a}=this.flowContainer;if(null==a)return void this._clear();let{extent:n,rotation:r,resolution:s,pixelRatio:l}=e.state,o=function(e,a){let n=new ee.A({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),r=e.xmax-e.xmin,s=e.ymax-e.ymin,l=Math.abs(Math.cos((0,X.kU)(a))),o=Math.abs(Math.sin((0,X.kU)(a))),u=l*r+o*s,h=o*r+l*s,c=new Q.A({xmin:n.x-u/2,ymin:n.y-h/2,xmax:n.x+u/2,ymax:n.y+h/2,spatialReference:e.spatialReference});return c.centerAt(n),c}(n,r);o.expand(1.15);let u=[Math.round((o.xmax-o.xmin)/s),Math.round((o.ymax-o.ymin)/s)],c=new et(a,o,u,l);if(null!=this._loading){if(this._loading.update(c))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(c)||(c.load().then(()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null},e=>{(0,M.zf)(e)||(h.A.getLogger(this).error("A resource failed to load.",e),this._loading=null)}),this._loading=c)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}};(0,r._)([(0,u.MZ)()],en.prototype,"_loading",void 0),(0,r._)([(0,u.MZ)()],en.prototype,"flowContainer",void 0),(0,r._)([(0,u.MZ)()],en.prototype,"updating",null);let er=en=(0,r._)([(0,c.$)("esri.views.2d.engine.flow.FlowStrategy")],en),es=class extends l.A{constructor(){super(...arguments),this._loadImagery=(e,a,n,r,s)=>(0,Z.pH)(this.layer,e,a,n,r,s),this._createFlowMesh=(e,a,n,r)=>this.layer.createFlowMesh({meshType:e,flowData:n,simulationSettings:a},{signal:r}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){let{layer:e}=this,a=()=>{this._loadImagery=(a,n,r,s,l)=>(0,Z.pH)(e,a,n,r,s,l),this._updateVisualization()};"multidimensionalDefinition"in e?this.addHandles((0,o.wB)(()=>e.multidimensionalDefinition,a)):this.addHandles([(0,o.wB)(()=>e.mosaicRule,a),(0,o.wB)(()=>e.rasterFunction,a),(0,o.wB)(()=>e.definitionExpression,a)]),this.container=new K,this._strategy=new er({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container?.removeAllChildren(),this.container=null,this.removeHandles()}update(e){e.stationary?this._strategy.update(e):this.layerView.requestUpdate()}hitTest(e){return new s.A({attributes:{},geometry:e.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){let e=this.layer.renderer;if(null==e||"flow"!==e.type)return;let a=function(e,a){let{flowSpeed:n,trailLength:r}=e,s=function(e){let a=p(y(e)),n=Math.max(a/2,5),r=Math.round((0,f.Lz)(e.maxPathLength)/n)+1,{density:s}=e;return{smoothing:(0,f.Lz)(e.smoothing),interpolate:!0,velocityScale:"flow-from"===e.flowRepresentation?1:-1,verticesPerLine:r,minSpeedThreshold:.001,segmentLength:n,maxTurnAngle:1,collisions:!0,lineCollisionWidth:a,lineSpacing:10,density:s}}(e),l=null,o={opacity:function(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};let a=e.getVisualVariablesForType("opacity")[0],n=[],r=[];for(let e of a.stops)n.push(e.value),r.push(e.opacity);return{kind:"ramp",stops:n,values:r,count:a.stops.length}}(e),size:y(e)},u=function(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:x(e.color)};let a=e.getVisualVariablesForType("color")[0],n=[],r=[];for(let e of a.stops)n.push(e.value),Array.prototype.push.apply(r,x(e.color));return{kind:"ramp",stops:n,values:r,count:a.stops.length}}(e);"none"===e.background?o.color=u:("constant"===u.kind&&(u={kind:"ramp",stops:[0,1],values:[0,0,0,1,u.value[0],u.value[1],u.value[2],u.value[3]],count:2}),l=new E({loadImagery:a.loadImagery,timeExtent:a.timeExtent,color:u,opacity:{kind:"constant",value:[1]}}),o.color={kind:"constant",value:[.1,.1,.1,1]});let h={loadImagery:a.loadImagery,createFlowMesh:a.createFlowMesh,simulationSettings:s,timeExtent:a.timeExtent,trailLength:r,flowSpeed:n,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:o.color,opacity:o.opacity,size:o.size},c="butt"===e.trailCap||4>=p(y(e))?new G(h):new I(h);return null!=l?new L([l,c]):c}(e,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=a,this.layerView.requestUpdate()}};(0,r._)([(0,u.MZ)()],es.prototype,"_strategy",void 0),(0,r._)([(0,u.MZ)()],es.prototype,"attached",void 0),(0,r._)([(0,u.MZ)()],es.prototype,"container",void 0),(0,r._)([(0,u.MZ)()],es.prototype,"layer",void 0),(0,r._)([(0,u.MZ)()],es.prototype,"layerView",void 0),(0,r._)([(0,u.MZ)()],es.prototype,"type",void 0),(0,r._)([(0,u.MZ)()],es.prototype,"updating",null),(0,r._)([(0,u.MZ)()],es.prototype,"timeExtent",void 0);let el=es=(0,r._)([(0,c.$)("esri.views.2d.engine.flow.FlowView2D")],es)},72145:(e,a,n)=>{n.d(a,{F:()=>u}),n(31461),n(33715);var r=n(72359),s=n(47840);function l(e){return void 0!==e.timeInfo}n(24927),n(6272);async function o(e,a){if(0===e.length)return i.allTime;await Promise.all(e.map(e=>e.load({signal:a})));let n=e.filter(l),r=e.filter(e=>!l(e)&&null!=e.visibilityTimeExtent);if(0===n.length&&0===r.length)return i.allTime;let s=[],o=[];for(let e of n)("feature"===e?.type||"map-image"===e?.type)&&e.timeInfo?.hasLiveData?s.push(e):o.push(e);let u=e=>null==e||e.isAllTime,h=[...o.map(e=>{let a=e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:n}=e;return a?.intersection(n)??n}),...r.map(e=>e.visibilityTimeExtent)];if(h.some(u))return i.allTime;let c=s.map(async e=>{let n=(await e.fetchRecomputedExtents({signal:a}))?.timeExtent??e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:r}=e;return n?.intersection(r)??r}),f=(await Promise.allSettled(c)).map(e=>"fulfilled"===e.status?e.value:null);if(f.some(u))return i.allTime;let m=[...f,...h].filter(t);return 0===m.length?i.allTime:m.reduce((e,a)=>e.union(a))}function u(e,a,n){if(null==e?.timeInfo)return null;let{datesInUnknownTimezone:l=!1,timeOffset:o,useViewTime:u}=e,h=e.timeExtent;l&&(h=function(e){if(!e)return e;let{start:a,end:n}=e;return new s.A({start:null!=a?(0,r.S1)(a,a.getTimezoneOffset(),"minutes"):a,end:null!=n?(0,r.S1)(n,n.getTimezoneOffset(),"minutes"):n})}(h));let c=u?a&&h?a.intersection(h):a||h:h;return!c||c.isEmpty||c.isAllTime?c:(o&&(c=c.offset(-o.value,o.unit)),l&&(c=function(e){if(!e)return e;let{start:a,end:n}=e;return new s.A({start:null!=a?(0,r.S1)(a,-a.getTimezoneOffset(),"minutes"):a,end:null!=n?(0,r.S1)(n,-n.getTimezoneOffset(),"minutes"):n})}(c)),c.equals(n)?n:c)}},76653:(e,a,n)=>{n.d(a,{X:()=>d}),n(57845);var r=n(6815),s=n(19284),l=n(25561),o=n(2609),u=n(19733),h=n(47607),c=n(62233),f=n(93446),m=n(84172);class d extends u.q{constructor(e=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.key=null,this.offset=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.vaoData=null,this.width=null,this.source=e}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,null!=this.source&&null==this.vaoData){let{style:a}=this.symbolizerParameters;switch(a){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{let a=(0,o.gf)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(e.context,a);this.vaoData={magdir:n}}break;case"simple_scalar":{let a=(0,o.Ud)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(e.context,a);this.vaoData={scalar:n}}break;case"wind_speed":{let a=(0,o.gf)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(e.context,a),r=(0,o.Ud)(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,r);this.vaoData={magdir:n,scalar:s}}}}this.ready(),this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:(0,s.vt)()}}setTransform(e){let a=(0,r.D_)(this.transforms.displayViewScreenMat3),[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.resolution/this.pixelRatio/e.resolution,u=o*this.width,h=o*this.height,c=Math.PI*this.rotation/180;(0,r.Tl)(a,a,(0,l.fA)(n,s)),(0,r.Tl)(a,a,(0,l.fA)(u/2,h/2)),(0,r.e$)(a,a,-c),(0,r.Tl)(a,a,(0,l.fA)(-u/2,-h/2)),(0,r.Oe)(a,a,(0,l.fA)(u,h)),(0,r.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,a)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,a){let{vertexData:n,indexData:r}=a,s=c.g.createVertex(e,f._U.STATIC_DRAW,new Float32Array(n)),l=c.g.createIndex(e,f._U.STATIC_DRAW,new Uint32Array(r)),o=(0,h.ES)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:f.pe.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:f.pe.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:f.pe.FLOAT,normalized:!1}]});return{vao:new m.Z(e,o.attributes,o.bufferLayouts,new Map([["geometry",s]]),l),elementCount:r.length}}}},82488:(e,a,n)=>{n.d(a,{A:()=>c});var r=n(59709),s=n(93446);let l=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),o=new Float32Array([0,92/255,230/255,1]),u={beaufort_ft:l,beaufort_m:l,beaufort_km:l,beaufort_mi:l,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:o,single_arrow:o,wind_speed:new Float32Array([0,0,0,1])},h=[0,20];class c extends r.A{constructor(){super(...arguments),this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:e}){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(s.dn.ONE,s.dn.ONE_MINUS_SRC_ALPHA,s.dn.ONE,s.dn.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilOp(s.eA.KEEP,s.eA.KEEP,s.eA.REPLACE)}draw(e,a){if(null==a.source||0===a.source.validPixelCount)return;let{context:n,timeline:r}=e;if(r.begin(this.name),n.setStencilFunction(s.MT.EQUAL,a.stencilRef,255),a.updateVectorFieldVAO(e),"scalar"===e.renderPass){let n=a.vaoData.scalar;n&&this._drawScalars(e,a,n.vao,n.elementCount)}else{let n=a.vaoData.magdir;n&&this._drawTriangles(e,a,n.vao,n.elementCount)}r.end(this.name)}_drawTriangles(e,a,n,r){let{context:l,painter:o,requestRender:c,allowDelayedRender:f}=e,{symbolizerParameters:m}=a,d=m.dataRange?["dataRange"]:[];"geographic"===m.rotationType&&d.push("rotationGeographic");let p=o.materialManager.getProgram(this._desc.magdir,d);if(f&&null!=c&&!p.compiled)return void c();l.useProgram(p);let{coordScale:x,opacity:y,transforms:g}=a;p.setUniform2fv("u_coordScale",x),p.setUniform1f("u_opacity",y),p.setUniformMatrix3fv("u_dvsMat3",g.displayViewScreenMat3);let{style:_,dataRange:w,rotation:v,symbolPercentRange:M}=m;p.setUniform4fv("u_colors",u[_]),p.setUniform2fv("u_dataRange",w||h),p.setUniform1f("u_rotation",v),p.setUniform2fv("u_symbolPercentRange",M);let S=this._getSymbolSize(e,a);p.setUniform2fv("u_symbolSize",S),l.bindVAO(n),l.drawElements(s.WR.TRIANGLES,r,s.pe.UNSIGNED_INT,0)}_drawScalars(e,a,n,r){let{context:l,painter:o,requestRender:u,allowDelayedRender:c}=e,{symbolizerParameters:f}=a,m=[];"wind_speed"===f.style?m.push("innerCircle"):f.dataRange&&m.push("dataRange"),"geographic"===f.rotationType&&m.push("rotationGeographic");let d=o.materialManager.getProgram(this._desc.scalar,m);if(c&&null!=u&&!d.compiled)return void u();l.useProgram(d);let{coordScale:p,opacity:x,transforms:y}=a;d.setUniform2fv("u_coordScale",p),d.setUniform1f("u_opacity",x),d.setUniformMatrix3fv("u_dvsMat3",y.displayViewScreenMat3);let{dataRange:g,symbolPercentRange:_}=f;d.setUniform2fv("u_dataRange",g||h),d.setUniform2fv("u_symbolPercentRange",_);let w=this._getSymbolSize(e,a);d.setUniform2fv("u_symbolSize",w),l.bindVAO(n),l.drawElements(s.WR.TRIANGLES,r,s.pe.UNSIGNED_INT,0)}_getSymbolSize(e,a){let n=a.key?2**(e.displayLevel-a.key.level):a.resolution/e.state.resolution,{symbolTileSize:r}=a.symbolizerParameters;return[r/(Math.round((a.width-a.offset[0])/r)*r)/n,r/(Math.round((a.height-a.offset[1])/r)*r)/n]}}}}]);