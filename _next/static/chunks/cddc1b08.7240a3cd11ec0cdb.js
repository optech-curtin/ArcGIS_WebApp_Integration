"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4188],{40224:(e,t,s)=>{let r,i,n,a,o,h,l,m,g,u,_,d,p,c,f;s.r(t),s.d(t,{$:()=>rZ,A:()=>A,B:()=>ra,C:()=>so,D:()=>rO,E:()=>o,F:()=>p,G:()=>iD,H:()=>ro,I:()=>rn,J:()=>s1,K:()=>s2,L:()=>is,M:()=>s$,N:()=>s0,O:()=>rE,P:()=>nt,Q:()=>R,R:()=>rW,S:()=>r2,T:()=>sC,U:()=>O,V:()=>rz,W:()=>rY,X:()=>t4,Y:()=>L,Z:()=>m,_:()=>rA,a:()=>rG,a0:()=>et,a1:()=>W,a2:()=>j,a3:()=>rj,a4:()=>l,a5:()=>sY,a6:()=>ee,a7:()=>J,a8:()=>ih,a9:()=>rw,aA:()=>iL,aB:()=>iX,aC:()=>ru,aD:()=>iq,aE:()=>i0,aF:()=>D,aG:()=>np,aH:()=>nc,aI:()=>nf,aJ:()=>nx,aK:()=>nP,aa:()=>iu,ab:()=>im,ac:()=>r8,ad:()=>eZ,ae:()=>eK,af:()=>rP,ag:()=>ry,ah:()=>st,ai:()=>sE,aj:()=>function e(t,s,r,i,n){if(i&&(i.m_reason=0,i.m_vertexIndex1=-1,i.m_vertexIndex2=-1),t.isEmpty())return 5;let a=t.getGeometryType();if(a===S.G.enumPoint)return sV(t,i);let o=(0,I.b)(s,t,!1).total();if(a===S.G.enumEnvelope){let e=new E.J;return t.queryEnvelope(e),e.isDegenerate(o)?(i&&(i.m_reason=4,i.m_vertexIndex1=-1,i.m_vertexIndex2=-1),0):5}if((0,S.f)(a)){let a=new C.P({vd:t.getDescription()});return a.addSegment(t,!0),e(a,s,r,i,n)}(0,S.C)(a),(0,S.i)(a)||(0,S.b)("OGC simplify is not implemented for this geometry type");let h=t.getImpl().getIsSimple(o,[0]),l=r?-1:h;if(5===l||0===l)return l;let m=new sA(t,s,l,n,!0);return a===S.G.enumMultiPoint||a===S.G.enumPolyline||a===S.G.enumPolygon?(l=m.isSimplePlanarImpl(),(0,I.i)(l)&&(l=5)):(0,S.c)(""),t.getImpl().setIsSimple(l,o),i&&i.assign(m.m_nonSimpleResult),l},ak:()=>function e(t,s,r,i){if(t.isEmpty())return t;let n=t.getGeometryType();if(n===S.G.enumPoint){let e=new F;if(sV(t,e),3===e.m_reason){let e=t.clone();return e.replaceNaNs(1,0),e}return 2===e.m_reason?t.createInstance():t}if(n===S.G.enumEnvelope){let e=new E.J;t.queryEnvelope(e);let r=(0,I.b)(s,t,!0).total();return e.isDegenerate(r)?t.createInstance():t}if((0,S.f)(n)){let n=new C.P({vd:t.getDescription()});return n.addSegment(t,!0),e(n,s,r,i)}(0,S.C)(n),(0,S.i)(n)||(0,S.b)("OGC simplify is not implemented for this geometry type");let a=(0,I.b)(s,t,!1).total(),o=t.getImpl().getIsSimple(a,[0]),h=r?-1:o;if(5===h){if(n===S.G.enumPolygon&&0!==t.getFillRule()){let e=t.clone();return e.setFillRule(0),e}return t}return sP(t,(0,I.b)(s,t,!0),!1,h,i,0,!0)},al:()=>sx,am:()=>iF,an:()=>eW,ao:()=>iR,ap:()=>sm,aq:()=>sl,ar:()=>sa,as:()=>sN,at:()=>eg,au:()=>eu,av:()=>er,aw:()=>iW,ax:()=>h,ay:()=>rJ,az:()=>Q,b:()=>iM,c:()=>iA,d:()=>rx,e:()=>rS,f:()=>sB,g:()=>sM,h:()=>rI,i:()=>t2,j:()=>iV,k:()=>si,l:()=>se,m:()=>sc,n:()=>sr,o:()=>eY,p:()=>io,q:()=>t7,r:()=>tr,s:()=>sn,t:()=>c,u:()=>sK,v:()=>sj,w:()=>rB,x:()=>sQ,y:()=>sy,z:()=>iB});var x,P,y,E=s(73750),S=s(16404),C=s(32045),I=s(31632),b=s(92656),v=s(81856),G=s(26251),w=s(23750),T=s(99506),N=s(8288);class D{constructor(e){if(this.m_geom=this.m_sr=null,e){if(e.move)return this.m_geom=e.move.m_geom,e.move.m_geom=null,this.m_sr=e.move.m_sr,void(e.move.m_sr=null);if(e.copy)return this.m_geom=e.copy.m_geom?e.copy.m_geom.clone():null,void(this.m_sr=e.copy.m_sr);e.geom&&(this.m_geom=e.geom),e.sr&&(this.m_sr=e.sr)}}getGeometry(){return this.m_geom}getSpatialReference(){return this.m_sr}setGeometry(e){this.m_geom=e}setSpatialReference(e){this.m_sr=e}equals(e,t){return!(!this.m_sr&&e.m_sr)&&!(this.m_sr&&!e.m_sr)&&!(!this.m_geom&&e.m_geom)&&!(this.m_geom&&!e.m_geom)&&!(this.m_sr&&e.m_sr&&!this.m_sr.equals(e.m_sr))&&!(this.m_geom&&e.m_geom&&!this.m_geom.equals(e.m_geom,t))}clone(){let e=null;return this.m_geom&&(e=this.m_geom.clone()),new D({geom:e,sr:this.m_sr})}hasGeom(){return!!this.m_geom}}class V{constructor(e){this.m_factor=1,this.m_wkid=0,this.m_peUnit=null,e&&(this.m_peUnit=e,this.m_factor=e.getUnitFactor(),this.m_wkid=e.getCode(),this.m_wkid<0&&(this.m_wkid=0))}getName(){return this.m_peUnit.getName()}getID(){return this.m_wkid}getConversionFactor(e){return this.getUnitType()!==e.getUnitType()&&(0,S.t)("unit type mismatch"),this.getUnitToBaseFactor()/e.getUnitToBaseFactor()}getUnitToBaseFactor(){return this.m_factor}getHashCode(){return(0,b.aq)((0,b.ar)(this.getUnitType()),(0,b.ar)(this.getUnitToBaseFactor()))}equals(e){return!!e&&this.getUnitType()===e.getUnitType()&&this.getUnitToBaseFactor()===e.getUnitToBaseFactor()&&this.getID()===e.getID()&&this.getName()===e.getName()}static isValidWkid(e){return!1}}class F{assign(e){this.m_reason=e.m_reason,this.m_vertexIndex1=e.m_vertexIndex1,this.m_vertexIndex2=e.m_vertexIndex2}constructor(e,t,s){void 0!==e?(this.m_reason=e,this.m_vertexIndex1=t,this.m_vertexIndex2=s):(this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-2)}clear(){this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-1}}let H={330:104878,500:104879,1300:104899,1450:104986,2230:104988,3800:104978,5e3:104919,6200:104906,8200:104909,9500:104927,9600:104977,1e4:[104911,104936],11e3:104941,11080:104872,11100:104907,12e3:104920,12400:104995,13e3:104948,14e3:[104923,104989],15e3:[104913,104954],15100:104976,16e3:[104926,104931],18e3:[104922,104982],21e3:104947,21500:104877,27e3:[104950,104957],29e3:104964,3e4:104921,31e3:104949,33e3:104946,4e4:[104914,104967],40600:104897,41900:104937,42e3:104951,43100:104993,49300:104924,50100:104939,54e3:104955,58200:104981,59500:104930,74e3:104961,77e3:104956,79e3:104962,83500:104910,85e3:104917,88800:104934,89200:104985,96e3:104997,104e3:104963,106500:104898,11e4:104938,133e3:104932,135e3:104983,17e4:104965,198200:104987,198630:104935,208e3:104966,235800:104952,249400:104929,252100:104980,255e3:104973,47e4:104972,529800:104942,531e3:104996,56e4:104928,561400:104979,578900:104945,584700:104959,593e3:104970,606e3:104999,718e3:104933,745700:104984,761400:104953,763500:104994,764e3:104940,788900:104958,1188300:104998,1195e3:104969,1352600:104968,1560800:104874,1562090:104915,1737400:104903,1821460:104918,1821490:104876,2409300:104912,2410300:104873,2439400:104974,2439700:104900,2575e3:104943,2631200:104875,2632345:104916,3393400:104904,3396190:[104905,104971],6051e3:104901,6051800:104902,637e4:104128,6370997:[4052,37008],6371e3:4035,6371007:4047,6371228:[4053,10346],6376045:[8042,8043],6376523:[4027,4901,4902],6376896:37007,6378135:[4122,4322,4324,4720,4985,4987],6378136:[4740,4923,7678,7680,9474,9475,104017,104018],6378137:[3823,3824,3888,3889,4017,4019,4023,4031,4040,4046,4055,4074,4075,4080,4081,4121,4126,4130,4133,4140,4141,4148,4151,4152,4163,4166,4167,4170,4171,4172,4173,4176,4180,4189,4190,4258,4269,4283,4318,4319,4326,4463,4466,4469,4470,4480,4482,4483,4490,4557,4558,4612,4617,4619,4624,4627,4659,4661,4667,4669,4670,4674,4686,4687,4693,4694,4702,4737,4742,4747,4749,4750,4755,4756,4757,4758,4759,4761,4762,4763,4764,4765,4883,4885,4887,4889,4893,4895,4898,4907,4909,4921,4925,4927,4929,4931,4933,4935,4937,4939,4941,4943,4945,4947,4949,4951,4953,4955,4957,4959,4961,4963,4965,4967,4971,4975,4977,4979,4981,4983,4989,4997,4999,5012,5013,5245,5246,5251,5252,5263,5264,5323,5324,5340,5342,5353,5354,5359,5360,5364,5365,5370,5371,5372,5373,5380,5381,5392,5393,5488,5489,5545,5546,5592,5593,5885,5886,6134,6135,6310,6311,6318,6319,6321,6322,6324,6325,6364,6365,6667,6668,6705,6706,6782,6783,6980,6982,6983,6987,6989,6990,7034,7035,7036,7037,7038,7039,7040,7041,7042,7072,7073,7084,7085,7086,7087,7133,7135,7136,7138,7139,7372,7373,7657,7659,7661,7663,7665,7685,7686,7797,7798,7816,7843,7844,7880,7881,7885,7886,7900,7901,7902,7903,7904,7905,7906,7907,7908,7909,7910,7911,7912,7915,7917,7919,7921,7923,7925,7927,7929,7931,8085,8086,8231,8232,8235,8237,8239,8240,8244,8246,8248,8249,8251,8252,8254,8255,8399,8403,8426,8427,8449,8542,8544,8545,8684,8685,8698,8699,8817,8818,8860,8888,8899,8900,8901,8902,8906,8907,8916,8918,8920,8922,8924,8926,8928,8930,8932,8934,8936,8938,8940,8942,8944,8946,8948,8949,8972,8973,8974,8975,8976,8977,8978,8979,8980,8981,8982,8983,8984,8985,8986,8987,8988,8989,8990,8991,8992,8993,8994,8995,8996,8997,8998,8999,9e3,9002,9003,9005,9006,9008,9009,9011,9012,9013,9014,9016,9017,9018,9019,9053,9054,9055,9056,9057,9059,9060,9061,9062,9063,9064,9065,9066,9067,9068,9069,9071,9072,9074,9075,9139,9140,9147,9148,9152,9153,9183,9184,9293,9294,9299,9308,9309,9332,9333,9364,9372,9379,9380,9384,9453,9469,9470,9546,9547,9695,9696,9701,9702,9739,9754,9755,9758,9763,9776,9777,9778,9779,9781,9782,9783,9784,9866,9871,9939,9964,9969,9974,9989,9990,10175,10177,10178,10185,10191,10196,10204,10209,10214,10219,10224,10229,10237,10272,10277,10283,10284,10298,10299,10300,10304,10305,10307,10309,10310,10311,10312,10327,10328,10413,10414,10468,10474,10475,10570,10571,10605,10606,10623,10628,20033,20040,20041,20045,20046,104009,104010,104011,104012,104013,104014,104015,104016,104019,104020,104021,104022,104024,104027,104028,104050,104100,104107,104108,104110,104111,104114,104115,104116,104117,104118,104119,104120,104121,104122,104123,104124,104129,104133,104134,104137,104141,104142,104143,104144,104145,104179,104180,104181,104182,104183,104184,104185,104186,104199,104223,104257,104258,104259,104260,104286,104287,104602,104613,104644,104645,104646,104647,104653,104804,104896,104991],6378140:4610,6378145:[4025,4276,4760,4891,37001],6378150:37003,6378155:[37004,37207],6378160:[3821,4003,4021,4036,4202,4203,4237,4238,4291,4618,4708,5527,37231,104023,104136],6378166:37002,6378200:[4020,4229,4286,4303,4706],6378245:[4024,4147,4164,4178,4179,4191,4200,4205,4214,4284,4317,4555,4676,4677,4678,4991,4993,5560,5561,37257,104135],6378270:[4732,37005,37229],6378273:[4054,10345],6378300:[4029,4168,4174],6378388:[4022,4123,4153,4154,4158,4159,4160,4161,4165,4181,4182,4183,4184,4185,4192,4194,4195,4196,4199,4204,4207,4208,4215,4218,4221,4224,4225,4230,4231,4233,4235,4236,4247,4248,4249,4254,4255,4259,4264,4265,4271,4272,4274,4285,4287,4288,4292,4297,4309,4311,4313,4316,4472,4475,4611,4614,4615,4616,4621,4622,4623,4625,4626,4628,4629,4630,4631,4632,4633,4636,4637,4639,4641,4642,4643,4644,4645,4646,4658,4660,4662,4663,4664,4665,4668,4672,4673,4684,4688,4689,4690,4691,4692,4698,4704,4705,4707,4709,4710,4711,4712,4714,4715,4716,4718,4719,4721,4722,4724,4725,4727,4728,4729,4730,4733,4734,4735,4739,4741,4753,4754,4802,4803,4806,4809,4810,4823,4824,4900,5524,6883,8428,8430,8431,9248,9251,9253,9403,9893,10158,10249,10252,37201,37204,37205,37212,37213,37214,37215,37216,37217,37218,37219,37221,37222,37224,37226,37227,37230,37232,37233,37234,37235,37237,37238,37241,37242,37245,37246,37247,37249,37250,37251,37253,37259,104104,104106,104125,104126,104127,104130,104138,104248],6378523:104786,24764e3:104960,25559e3:104944,60268e3:104925,71492e3:104908,6957e5:104975,6377397.155:[3819,3906,4004,4120,4124,4125,4149,4150,4156,4162,4211,4219,4257,4262,4280,4289,4294,4295,4301,4306,4308,4312,4314,4613,4666,4745,4746,4801,4804,4805,4808,4813,4814,4815,4818,4820,4904,5132,5228,5229,5681,5830,8351,9267,10268,37255,104101,104102,104105,104131,104648,104696,104697,104990,104992],6377563.396:[4001,4188,4277,4278,4279],6377340.189:[4002,4299,4300],6377492.018:[4005,4273,4817],6377483.865280418:[4006,4293],6378293.645208759:[4007,4157,4302,4738,5464],6378206.4:[4008,4127,4128,4129,4135,4136,4137,4138,4139,4169,4216,4242,4253,4267,4608,4609,4638,4675,4683,4695,4717,4723,4726,4995,5451,5467,37220,37239,37243,37252,37260,104e3,104109,104112,104113,104132],6378450.047:[4009,4268],6378300.789:[4010,4281],6378249.2:[4011,4014,4155,4193,4206,4213,4223,4226,4227,4228,4252,4261,4266,4275,4282,4296,4304,4310,4315,4671,4807,4811,4816,4821,37223,37225,104139,104140,104261,104304],6378249.145:[4012,4013,4132,4134,4142,4143,4175,4197,4198,4201,4209,4210,4212,4220,4222,4232,4234,4246,4250,4251,4256,4260,4263,4270,4305,4307,4600,4601,4602,4603,4604,4605,4606,4607,4620,4679,4680,4696,4697,4699,4700,4701,4703,4713,4731,4736,4743,4744,4812,4819,6881,6882,6892,6894,8694,37206,37208,37211,37228,37240,37254,104025,104026,104103,104305],6377276.345:[4015,4131,4144,4239,4240,4244,4682,5233,6207,37202,104256,104664,104693],6377298.556:[4016,4298],6377304.063:[4018,4245],6378298.3:[4028,4903],6378136.2:4032,6378136.3:4033,6378249.144808011:[4034,4241],20922931.8:[4042,4243],6377301.243:[4044,4145,37203],6377299.151:[4045,4146],6377019.27:[4657,10256,10260,10265],6378306.3696:[4748,4752],6377295.664:[4751,37006],6378136.5:[7682,7683],6371008.7714:104047,6378418.941:[104700,104726,104760],6378586.581:[104701,104743],6378505.809:104702,6378544.823:104703,6378490.569:104704,6378470.757:[104705,104776],6378403.701:[104706,104750],6378434.181:[104707,104724,104739,104764],6378454.907:104708,6378400.653:104709,6378567.378:104710,6378546.957:[104711,104717,104780],6378476.853:[104712,104736],6378411.321:[104713,104728],6378647.541:[104714,104715],6378514.953:[104716,104782],6378421.989:[104718,104770],6378481.425:[104719,104753,104774,104781],6378518.001:[104720,104725],6378521.049:[104721,104723,104731,104745,104748],6378464.661:104722,6378436.619:104727,6378574.389:[104729,104730],6378472.281:[104732,104756],6378498.189:[104733,104746],6378449.421:[104734,104766],6378525.621:[104735,104754],6378466.185:104737,6378496.665:104738,6378643.579:104740,6378559.758:104741,6378414.369:[104742,104763,104772],6378441.801:104744,6378502.761:[104747,104759,104773,104775],6378617.061:104749,6378624.681:[104751,104765],6378468.623:104752,6378445.763:[104755,104758,104761],6378670.401:104757,6378438.753:104762,6378543.909:104767,6378605.783:104768,6378540.861:104769,6378443.325:[104771,104784],6378548.481:104777,6378463.746:104778,6378426.561:104779,6378453.688:104783,6378530.193:104785,6378376.271:[104800,104828],6378471.92:104801,6378472.931:104802,6378411.351:104803,6378380.991:104805,6378414.96:104806,6378345.09:[104807,104819,104844,104870],6378412.542:104808,6378470.401:104809,6378376.331:104810,6378379.031:104811,6378407.621:104812,6378376.811:[104813,104827],6378313.92:104814,6378414.93:104815,6378413.021:104816,6378380.381:104817,6378530.851:104818,6378591.521:104820,6378378.881:104821,6378408.481:[104822,104832],6378375.601:[104823,104838],6378408.041:104824,6378655.071:104825,6378409.151:104826,6378315.7:[104829,104840,104845,104851],6378285.86:[104830,104835,104859],6378379.301:104831,6378560.121:104833,6378531.821:104834,6378500.6:104836,6378376.041:104837,6378406.601:104839,6378438.991:104841,6378345.42:104842,6378593.86:104843,6378381.271:[104846,104847],6378413.671:104848,6378344.377:104849,6378563.891:104850,6378408.091:104852,6378377.671:104853,6378472.751:104854,6378412.511:104855,6378407.281:104856,6378534.451:104857,6378406.051:104858,6378532.921:104860,6378380.091:104861,6378408.941:104862,6378624.171:104863,6378377.411:104864,6378474.591:104865,6378407.141:104866,6378376.871:104867,6378375.251:104868,6378405.971:104869,6378437.651:104871};class k extends V{constructor(e){if("number"==typeof e)return super(),this.m_factor=e,void(this.m_wkid=0);super(e)}getUnitType(){return 1}convertFromRadians(e){return e/this.getUnitToBaseFactor()}convertToRadians(e){return e*this.getUnitToBaseFactor()}}function A(e){return new iv}class M{constructor(e,t,s){void 0===e?(this.x=new b.F,this.y=new b.F,this.z=new b.F):e instanceof I.h?(this.x=new b.F(e.x),this.y=new b.F(e.y),this.z=new b.F(e.z)):e instanceof b.F?(this.x=e.clone(),this.y=t.clone(),this.z=s.clone()):(0,S.t)("EPoint3D constructor")}dotProduct(e){return this.x.mulE(e.x).addE(this.y.mulE(e.y)).addE(this.z.mulE(e.z))}crossProduct(e){return new M(this.y.mulE(e.z).subE(this.z.mulE(e.y)),this.z.mulE(e.x).subE(this.x.mulE(e.z)),this.x.mulE(e.y).subE(this.y.mulE(e.x)))}crossProductVector(e){let t=this.y.mulE(e.z).subE(e.y.mulE(this.z));return new M(t,e.x.mulE(this.z).subE(this.x.mulE(e.z)),this.x.mulE(e.y).subE(e.x.mulE(this.y)))}sqrLength(){return this.x.mulE(this.x).addE(this.y.mulE(this.y)).addE(this.z.mulE(this.z))}length(){return this.sqrLength().sqrt()}static distance(e,t){return e.sub(t).length()}negate(){return new M(this.x.negate(),this.y.negate(),this.z.negate())}add(e){return new M(this.x.addE(e.x),this.y.addE(e.y),this.z.addE(e.z))}sub(e){return new M(this.x.subE(e.x),this.y.subE(e.y),this.z.subE(e.z))}subThis(e){return this.x.subThisE(e.x),this.y.subThisE(e.y),this.z.subThisE(e.z),this}addThis(e){return this.x.addThisE(e.x),this.y.addThisE(e.y),this.z.addThisE(e.z),this}mul(e){return new M(this.x.mulE(e),this.y.mulE(e),this.z.mulE(e))}div(e){return new M(this.x.divE(e),this.y.divE(e),this.z.divE(e))}eq(e){return this.x.eq(e.x)&&this.y.eq(e.y)&&this.z.eq(e.z)}isZero(){return this.x.isZero()&&this.y.isZero()&&this.z.isZero()}value(){return I.h.construct(this.x.value(),this.y.value(),this.z.value())}}class U{constructor(e){if(this.m_origin=new I.h,this.m_normal=new I.h,this.m_axisX=new I.h,this.m_axisY=new I.h,!e)return this.m_origin=new I.h,this.m_normal=new I.h(0,0,1),this.m_axisX=new I.h(1,0,0),void(this.m_axisY=new I.h(0,1,0));e.pt0&&e.pt1&&e.pt2?this.setFromPoints(e.pt0,e.pt1,e.pt2):(0,S.g)(0,`unimplemented constructor options ${JSON.stringify(e)}`)}assign(e){return(0,S.g)(0),this}set(e,t,s,r){(0,S.g)(0)}setFromPoints(e,t,s){let r=t.sub(e),i=s.sub(e);this.m_normal=r.crossProductVector(i);let n=!0;if(this.m_normal.isZero()){if(n=!1,r.isZero()&&(r=i),r.isZero())return this.m_normal.setCoords(0,0,1),this.m_axisX.setCoords(1,0,0),this.m_axisY.setCoords(0,1,0),this.m_origin=e,!1;this.m_axisX=r.getUnitVector(),this.m_normal=this.m_axisX.createAPerpendicular()}else this.m_normal.normalizeThis(),this.m_axisX=r.getUnitVector();return this.m_axisY=this.m_normal.crossProductVector(this.m_axisX),this.m_origin=e,n}getCoord(e,t){return(0,S.g)(0),{}}getCoord2D(e){return(0,S.g)(0),{}}getCoordX(e,t){return(0,S.g)(0),0}getCoordY(e,t){return(0,S.g)(0),0}getCoordZ(e,t){return(0,S.g)(0),0}setPreferredAxisX(e){(0,S.g)(0)}getOrigin(){return(0,S.g)(0),{}}getNormal(){return(0,S.g)(0),{}}getAxisX(){return this.m_axisX.clone()}getAxisY(){return this.m_axisY.clone()}setAxisX(e,t=!1){(0,S.g)(0)}setAxisY(e,t=!1){(0,S.g)(0)}recalculateAxisY(){(0,S.g)(0)}setOrigin(e){(0,S.g)(0)}setNormal(e,t){(0,S.g)(0)}intersect(e,t){return(0,S.g)(0),!1}intersectLine(e){return(0,S.g)(0),0}intersectLineEx(e,t){return(0,S.g)(0),0}closestCoordinate(e){let t=e.sub(this.m_origin),s=new b.P;return s.x=t.dotProduct(this.m_axisX),s.y=t.dotProduct(this.m_axisY),s}projectVector(e){return(0,S.g)(0),{}}signedDistance(e){return(0,S.g)(0),0}distance(e){return(0,S.g)(0),0}}function q(e,t){return!1}function O(e,t,s,r,i=100,n=q){let a,o,h,l,m,g,u,_,d;(0,S.g)(r>0);let p,c,f,x=0,P=0,y=(0,b.an)();t>s&&(s=(0,b.b)(t,t=s));let E=e(t),C=e(s);E<C?(a=o=h=t,l=m=g=E):(a=o=h=s,l=m=g=C);let I=0;for(;I<i&&(f=.5*(s-t),d=t+f,c=2*(p=r*(Math.abs(a)+.25)),!(n(a,l)||Math.abs(a-d)<=c-f));++I){if(Math.abs(P)>p){let e=(a-o)*(l-g),r=(a-h)*(l-m),i=(a-h)*r-(a-o)*e;(r=2*(r-e))>0&&(i=-i),r=Math.abs(r);let n=P;P=x,Math.abs(i)>=Math.abs(r*n*.5)||i<=r*(t-a)||i>=r*(s-a)?(P=a>=d?t-a:s-a,x=(0,b.an)()*P):((_=a+(x=i/r))-t<c||s-_<c)&&(x=d-a<0?-Math.abs(p):Math.abs(p))}else x=(P=a>=d?t-a:s-a)*y;(u=e(_=a+x))<l?(_>=a?t=a:s=a,h=o,o=a,a=_,g=m,m=l,l=u):(_<a?t=_:s=_,u<=m||o===a?(h=o,o=_,g=m,m=u):(u<=g||h===a||h===o)&&(h=_,g=u))}return(0,b.n)(a,l)}function B(e,t,s){return e>s?e-=Math.ceil((e-s)/b.k)*b.k:e<t&&(e+=Math.ceil((t-e)/b.k)*b.k),e}function R(e,t,s){var r=e,i=t,n=s,a=0;let o=n.x,h=n.y;return Y(r,i,Math.cos(o),Math.sin(o),Math.cos(h),Math.sin(h),0)}function Y(e,t,s,r,i,n,a){let o=e/Math.sqrt(1-t*n*n),h=o+a;return I.h.construct(h*i*s,h*i*r,(o*(1-t)+a)*n)}function X(e,t,s){let r=new b.F,i=new b.F,n=new b.F,a=new b.F;r.setCos(s.x),i.setSin(s.x),n.setCos(s.y),a.setSin(s.y);let o=a.negate().mulE(a.mul(t)).add(1).sqrt(),h=new b.F(e).divE(o),l=h.mulE(n).mulE(r);return new M(l,h.mulE(n).mulE(i),h.mul(1-t).mulE(a))}function L(e,t,s){let r=s.x,i=s.y,n=s.z,a=Math.atan2(i,r),o=Math.atan2(n,(1-t)*Math.sqrt(r*r+i*i));return b.P.construct(a,o)}function z(e,t,s){let r=e/Math.sqrt((0,b.s)(s.x)+(0,b.s)(s.y)+(0,b.s)(s.z)/(1-t));return s.mul(r)}function J(e,t,s){let r=new I.h;return r.setCrossProductVector(t,s),Math.abs(Math.atan2(r.length(),t.dotProduct(s)))*e}function W(e,t,s,r,i){let n=s.getUnitVector(),a=r.getUnitVector(),o=t.getUnitVector(),h=new I.h;if(h.setCrossProductVector(n,a),!h.isZero()){h.normalizeThis();let t=o.sub(h.mul(h.dotProduct(o)));if(!t.isZero()){t.normalizeThis();let s=n.add(a).mul(.5);if(s.dotProduct(t)>s.dotProduct(n)){let s=Math.asin(Math.abs(h.dotProduct(o)));return i.assign(t.getUnitVector().mul(e)),s*e}}}let l=J(1,n,o),m=J(1,a,o);return l<=m?(i.assign(s),l*e):(i.assign(r),m*e)}function j(e,t,s,r,i,n=0,a){if(2===n||3===n)return function(e,t,s,r,i,n=!1,a){let o=z(e,t,s);if(n){let n=new U({pt0:new I.h(0,0,0),pt1:r,pt2:i}),h=n.closestCoordinate(s),l=n.closestCoordinate(r),m=n.closestCoordinate(i),g=b.P.getClosestCoordinate(l,m,h),u=z(e,t,I.h.lerp(r,i,g)),_=I.h.distance(u,o);return a&&a.assign(u),(0,b.n)(g,_)}let h=I.h.distance(r,i);if(h>0){let{first:s,second:n}=O(s=>{let n=z(e,t,I.h.lerp(r,i,s));return I.h.distance(n,o)},0,1,es(e,h));return a&&a.assign(z(e,t,I.h.lerp(r,i,s))),(0,b.n)(s,n)}{let e=I.h.distance(s,r);return a&&a.assign(s),(0,b.n)(.5,e)}}(e,t,s,r,i,3===n,a);let h=L(e,t,s),m=s=>{let a=L(e,t,I.h.lerp(r,i,s));return function(e,t,s,r,i){switch((0,S.g)(s.isFinite()&&r.isFinite()),i){case 0:let n={stack:[],error:void 0,hasError:!1};try{let i=(0,v.b)(n,new o,!1);return p.geodeticDistance(e,t,s.x,s.y,r.x,r.y,i,null,null,l.PE_LINETYPE_GEODESIC),i.val}catch(e){n.error=e,n.hasError=!0}finally{(0,v.c)(n)}return;case 1:var a,h=e,m=t,g=s;let u={stack:[],error:void 0,hasError:!1};try{let e=(0,v.b)(u,new o,!1);return p.greatEllipticDistance(h,m,g.x,g.y,g.x,g.y,e,null,null),e.val}catch(e){u.error=e,u.hasError=!0}finally{(0,v.c)(u)}return;case 2:case 3:{let i=R(e,t,s),n=R(e,t,r);return I.h.distance(i,n)}default:(0,S.b)("")}}(e,t,h,a,n)},g=I.h.distance(r,i);if(g>0){let{first:s,second:n}=O(m,0,1,es(e,g));return a&&a.assign(z(e,t,I.h.lerp(r,i,s))),(0,b.n)(s,n)}{let e=m(0);return a&&a.assign(r),(0,b.n)(.5,e)}}function Z(e,t,s,r,i,n){if(n[0]=Number.NaN,n[1]=Number.NaN,Math.abs(s.x-r.x)>Math.PI||Math.abs(s.y)>b.l||Math.abs(r.y)>b.l||(Math.abs(s.y)===b.l||Math.abs(r.y)===b.l)&&s.x!==r.x||Math.abs(i)>=b.l||s.y>0&&r.y>0&&s.y>i&&r.y>i||s.y<0&&r.y<0&&s.y<i&&r.y<i)return 0;let a=C.W.constructPoint2D(s),o=C.W.constructPoint2D(r),h=X(1,t,a),l=X(1,t,o),m=h.crossProductVector(l);if(m.z.isZero())return b.E.construct(s.y,r.y).containsCoordinate(i)?(n[0]=s.x,1):0;let g=m.x.divE(m.z.negate()),u=m.y.divE(m.z.negate()),_=g.mulE(g).addE(u.mulE(u)).sqrt();if(_.isZero()||g.isZero()&&u.isZero())return 0===i?(n[0]=s.x,n[1]=r.x,2):0;let d=(1-t)*Math.tan(i)/_.value();if(Math.abs(d)>1)return 0;let p=Math.acos(d),c=Math.atan2(u.value(),g.value()),f=c-p,x=c+p,P=Math.min(s.x,r.x),y=Math.max(s.x,r.x);B(f,P,y),0!==i?B(x,P,y):x=f;let E=0;return P<=f&&f<=y&&(n[E]=f,E++),x!==f&&P<=x&&x<=y&&(n[E]=x,E++),E}function K(e,t){t[0]>.5*Math.PI?(e[0]+=Math.PI,t[0]=Math.PI-t[0]):t[0]<-(.5*Math.PI)&&(e[0]-=Math.PI,t[0]=-Math.PI-t[0]),(0,S.g)(t[0]>=-(.5*Math.PI)&&t[0]<=.5*Math.PI)}function Q(e,t,s,r,i){r=(0,b.c)(r,-b.l,b.l),i=(0,b.c)(i,-b.l,b.l);let n=b.l-.03;return .5*(s-t)*(r>n&&i>n||r<-n&&i<-n?function(e,t,s){let r=1;if(t<0&&(r=-1,t=-t,s=-s),0!==e){let i=e*e,n=i*e,a=[1,(1+11*e)/12,(1+118*e+241*i)/360,(1+1089*e+10419*i+8651*n)/20160,(1+9836*e+318246*i+1027436*n+n*e*458881)/1814400],o=t=>{let s=0,r=(0,b.s)(t)/(e-1);for(let e=a.length-1;e>=0;--e)s=a[e]+s*r;return-(s*(0,b.s)(t/(1-e)))},h=o(b.l-t);return(o(b.l-s)-h)*r}{let e=b.l-t,i=b.l-s,n=-4*(0,b.s)(Math.sin(e/2));return(-4*(0,b.s)(Math.sin(i/2))-n)*r}}(e,r,i):$(e,i)-$(e,r))*(1-e)}function $(e,t){if(0===t)return 0;let s=Math.sin(t),r=s,i=s;if(0!==e){r/=1-e*s*s;let t=Math.sqrt(e);i=s*(0,b.y)(t*s)}return r+i}function ee(e,t){return e/Math.sqrt(1-t)}function et(e,t){return(1-t)*e}function es(e,t){return 0!==t?Math.min(e*(0,b.aF)()/t,1e-10):0}class er{constructor(e){this.m_currentShift=63n,this.m_currentElt=0n,this.m_iCurrentElt=-1,this.m_parent=e,this.m_aiSetElts=e.m_bits.flatMap((e,t)=>t)}next(){if(this.m_currentShift++,64n===this.m_currentShift){if(this.m_iCurrentElt++,this.m_iCurrentElt===this.m_aiSetElts.length)return er.npos();this.m_currentShift=0n,this.m_currentElt=this.m_parent.m_bits[this.m_aiSetElts[this.m_iCurrentElt]]}for(;this.m_currentShift<63n&&!(this.m_currentElt&1n<<this.m_currentShift);)this.m_currentShift++;return this.m_currentElt&1n<<this.m_currentShift?64*this.m_aiSetElts[this.m_iCurrentElt]+Number(this.m_currentShift):this.next()}static npos(){return Number.MAX_SAFE_INTEGER}}function ei(e){return 1n<<(63n&BigInt(e))}class en{constructor(e){this.m_bits=[],void 0!==e&&e.copy&&(this.m_bits=e.copy.m_bits.slice())}assignMove(){return this}assignCopy(){return this}hasBit(e){let t=ei(e),s=e>>6;return void 0!==this.m_bits[s]&&!!(this.m_bits[s]&t)}setBit(e){let t=ei(e),s=e>>6;void 0===this.m_bits[s]&&(this.m_bits[s]=0n),this.m_bits[s]|=t}clearBit(e){}flipBit(e){let t=ei(e),s=e>>6;return void 0===this.m_bits[s]&&(this.m_bits[s]=0n),this.m_bits[s]^=t,0n!==(this.m_bits[s]&t)}clear(){this.m_bits.length=0}isZero(){let e=0;return this.m_bits.forEach(t=>{e|=t?2:1}),!(2&e)}equals(e){if(this===e)return!0;if(this.m_bits.length!==e.m_bits.length)return!1;let t=0;return this.m_bits.forEach((s,r)=>{t|=s===e.m_bits[r]?2:1}),!(1&t)&&(e.m_bits.forEach((e,s)=>{t|=e===this.m_bits[s]?2:1}),!(1&t))}notEquals(e){return!this.equals(e)}assignOr(e){return e.m_bits.forEach((e,t)=>{void 0===this.m_bits[t]?this.m_bits[t]=e:this.m_bits[t]|=e}),this}assignSubtract(e){return e.m_bits.forEach((e,t)=>{void 0!==this.m_bits[t]&&(this.m_bits[t]&=~e)}),this}assignAnd(e){return e.m_bits.forEach((e,t)=>{void 0!==this.m_bits[t]&&(this.m_bits[t]&=e)}),this}assignXor(e){return e.m_bits.forEach((e,t)=>{void 0===this.m_bits[t]?this.m_bits[t]=e:this.m_bits[t]^=e}),this}getHashCode(){return this.m_bits.reduce((e,t)=>(0,b.aD)(e,t),(0,b.ar)(0))}getUnorderedBitIterator(){return new er(this)}}class ea{constructor(e,t){this.m_map=new Map,this.m_hf=e,this.m_ef=t}add(e){let t=this.m_hf(e);if(!this.m_map.has(t))return this.m_map.set(t,e),this;let s=this.m_map.get(t);return s instanceof Array?s.find(t=>this.m_ef(t,e))||s.push(e):this.m_ef(s,e)||this.m_map.set(t,[s,e]),this}clear(){this.m_map.clear()}delete(e){return!1}has(e){let t=this.m_hf(e);if(!this.m_map.has(t))return!1;let s=this.m_map.get(t);return s instanceof Array?void 0!==s.find(t=>this.m_ef(t,e)):this.m_ef(s,e)}get(e){let t=this.m_hf(e),s=this.m_map.get(t);if(void 0!==s)return s instanceof Array?s.find(t=>this.m_ef(t,e)):s}get size(){let e=0;for(let t of this.m_map.values())e+=t instanceof Array?t.length:1;return e}forEach(e,t){}[Symbol.iterator](){return(new Set)[Symbol.iterator]()}entries(){return(new Set).entries()}keys(){return(new Set).keys()}values(){return(new Set).values()}get[Symbol.toStringTag](){return"ValueSet"}}class eo extends I.a6{constructor(e){super(),this.m_bufferLeft=new C.S,this.m_bufferRight=new C.S,this.m_intervalLeft=b.E.constructEmpty(),this.m_intervalRight=b.E.constructEmpty(),this.m_yScanline=Number.NaN,this.m_helper=e}compare(e,t,s){let r=e.getElement(s);this.m_helper.querySegmentXY(t,this.m_bufferLeft),this.m_helper.querySegmentXY(r,this.m_bufferRight);let i=this.m_bufferLeft.get(),n=this.m_bufferRight.get();if(this.m_intervalLeft.setCoords(i.getStartX(),i.getEndX()),this.m_intervalRight.setCoords(n.getStartX(),n.getEndX()),this.m_intervalLeft.vmax<this.m_intervalRight.vmin)return -1;if(this.m_intervalLeft.vmin>this.m_intervalRight.vmax)return 1;let a=i.getStartY()===i.getEndY(),o=n.getStartY()===n.getEndY();if(a||o){if(a&&o)return 0;if(i.getStartY()===n.getStartY()&&i.getStartX()===n.getStartX())return a?1:-1;if(i.getEndY()===n.getEndY()&&i.getEndX()===n.getEndX())return a?-1:1}let h=i.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalLeft.vmin),l=n.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalRight.vmin);if(h===l){let e=Math.min(i.getEndY(),n.getEndY()),t=.5*(e+this.m_yScanline);t===this.m_yScanline&&(t=e),h=i.intersectionOfYMonotonicWithAxisX(t,this.m_intervalLeft.vmin),l=n.intersectionOfYMonotonicWithAxisX(t,this.m_intervalRight.vmin)}return h<l?-1:+(h>l)}setY(e){this.m_yScanline=e}}class eh{constructor(e){this.m_segmentBuffer=new C.S,this.m_point=b.P.getNAN(),this.m_parent=e}setPointXY(e){this.m_point.assign(e)}compare(e,t){let s=e.getElement(t);this.m_parent.querySegmentXY(s,this.m_segmentBuffer);let r=this.m_segmentBuffer.get(),i=new b.E;if(i.setCoords(r.getStartX(),r.getEndX()),this.m_point.x<i.vmin)return -1;if(this.m_point.x>i.vmax)return 1;let n=r.intersectionOfYMonotonicWithAxisX(this.m_point.y,this.m_point.x);return this.m_point.x<n?-1:+(this.m_point.x>n)}}function el(e,t){return{parentage:e,rank:t}}function em(e,t,s){s.length=0;let r=!1;{let i=e.getHalfEdgeVertexIterator(t);for(;i!==C.n;){let t=e.getVertexFromVertexIterator(i),n=e.getShape().getSegmentRank(t),a=e.getShape().getSegmentParentage(t);r||=a>=0,s.push(el(a,n)),i=e.incrementVertexIterator(i)}}{let i=e.getHalfEdgeVertexIterator(e.getHalfEdgeTwin(t));for(;i!==C.n;){let t=e.getVertexFromVertexIterator(i),n=e.getShape().getSegmentRank(t),a=e.getShape().getSegmentParentage(t);r||=a>=0,s.push(el(a,n)),i=e.incrementVertexIterator(i)}}r&&s.sort((e,t)=>e.rank>t.rank?-1:e.rank<t.rank?1:e.parentage<t.parentage?-1:+(e.parentage>t.parentage)),-1===s[0].parentage&&(s.length=1)}!function(e){e[e.enumInputModeBuildGraph=0]="enumInputModeBuildGraph",e[e.enumInputModeSimplifyAlternate=1]="enumInputModeSimplifyAlternate",e[e.enumInputModeSimplifyWinding=2]="enumInputModeSimplifyWinding"}(x||(x={})),function(e){e[e.enumSegmentParentageBreakNode=1]="enumSegmentParentageBreakNode",e[e.enumPathBreakNode=2]="enumPathBreakNode"}(P||(P={}));class eg{constructor(){this.m_shape=null,this.m_clusterData=new I.S(8),this.m_clusterVertices=new I.S(2),this.m_firstCluster=C.n,this.m_lastCluster=C.n,this.m_halfEdgeData=new I.S(8),this.m_chainData=new I.S(8),this.m_chainAreas=null,this.m_chainPerimeters=null,this.m_universeChain=-1,this.m_simplifiedGeometry=-1,this.m_edgeIndices=[],this.m_clusterIndices=[],this.m_chainIndices=[],this.m_bBuildGeometryParentageSets=!1,this.m_chainBitSetIndex=-1,this.m_edgeBitSetIndex=-1,this.m_edgeBitSetIndexLeft=-1,this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_uniqueBitSets=null,this.m_chainBitSets=[],this.m_edgeBitSets=[],this.m_checkDirtyPlanesweepTolerance=Number.NaN,this.m_geometryIDIndex=-1,this.m_clusterIndex=-1,this.m_halfEdgeIndex=-1,this.m_tmpHalfEdgeParentageIndex=-1,this.m_tmpHalfEdgeParentageIndexLeft=-1,this.m_tmpHalfEdgeWindingNumberIndex=-1,this.m_tmpHalfEdgeOddEvenNumberIndex=-1,this.m_segmentParentageIndex=-1,this.m_segmentIndexHe=-1,this.m_clusterBreakNodeIndex=-1,this.m_universeGeomID=-1,this.m_pointCount=0,this.m_progressCounter=0,this.m_bBuildChains=!0,this.m_bDirtyCheckFailed=!1}setCheckDirtyPlanesweepTolerance(e){this.m_checkDirtyPlanesweepTolerance=e}dirtyCheckFailed(){return this.m_bDirtyCheckFailed}getShape(){return this.m_shape}setEditShape(e,t,s=!0,r=!1){r?this.setEditShapeImpl3D_(e,x.enumInputModeBuildGraph,null,t,!1):this.setEditShapeImpl_(e,x.enumInputModeBuildGraph,null,t,s)}setAndSimplifyEditShapeAlternate(e,t,s=null,r=!1){let i=[];i.push(t),this.m_simplifiedGeometry=t,r?this.setEditShapeImpl3D_(e,x.enumInputModeSimplifyAlternate,i,s,!1):this.setEditShapeImpl_(e,x.enumInputModeSimplifyAlternate,i,s,e.getGeometryType(t)===S.G.enumPolygon)}setAndSimplifyEditShapeWinding(e,t,s=null){let r=[];r.push(t),this.m_simplifiedGeometry=t,this.setEditShapeImpl_(e,x.enumInputModeSimplifyWinding,r,s,!0)}removeShape(){null!==this.m_shape&&(-1!==this.m_geometryIDIndex&&(this.m_shape.removeGeometryUserIndex(this.m_geometryIDIndex),this.m_geometryIDIndex=-1),-1!==this.m_clusterIndex&&(this.m_shape.removeUserIndex(this.m_clusterIndex),this.m_clusterIndex=-1),-1!==this.m_halfEdgeIndex&&(this.m_shape.removeUserIndex(this.m_halfEdgeIndex),this.m_halfEdgeIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),-1!==this.m_tmpHalfEdgeWindingNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1),-1!==this.m_segmentParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),-1!==this.m_segmentIndexHe&&(this.deleteUserIndexForHalfEdges(this.m_segmentIndexHe),this.m_segmentIndexHe=-1),-1!==this.m_clusterBreakNodeIndex&&(this.deleteUserIndexForClusters(this.m_clusterBreakNodeIndex),this.m_clusterBreakNodeIndex=-1),this.deleteEdgeBitSets_(),this.deleteChainBitSets_(),this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_shape=null,this.m_clusterData.deleteAll(!0),this.m_clusterVertices.deleteAll(!0),this.m_firstCluster=C.n,this.m_lastCluster=C.n,this.m_halfEdgeData.deleteAll(!0),this.m_edgeIndices.length=0,this.m_clusterIndices.length=0,this.m_chainIndices.length=0,this.m_chainData.deleteAll(!0),this.m_universeChain=C.n,this.m_chainAreas=null)}getClusterHalfEdge(e){return this.m_clusterData.getField(e,2)}queryXY(e,t){let s=this.getClusterVertexIndex_(e);t.assign(this.m_shape.getXYWithIndex(s))}queryXYZ(e,t){(0,S.g)(0)}getClusterParentage(e){return this.m_clusterData.getField(e,1)}getFirstCluster(){return this.m_firstCluster}getPrevCluster(e){return this.m_clusterData.getField(e,3)}getNextCluster(e){return this.m_clusterData.getField(e,4)}getClusterChain(e){return this.m_clusterData.getField(e,6)}getClusterVertexIterator(e){return this.m_clusterData.getField(e,7)}incrementVertexIterator(e){return this.m_clusterVertices.getField(e,1)}getVertexFromVertexIterator(e){return this.m_clusterVertices.getField(e,0)}getClusterUserIndex(e,t){let s=this.getClusterIndex_(e),r=this.m_clusterIndices[t];return r.size()<=s?-1:r.read(s)}setClusterUserIndex(e,t,s){let r=this.getClusterIndex_(e),i=this.m_clusterIndices[t];i.size()<=r&&i.resize(this.m_clusterData.size(),-1),i.write(r,s)}hasClusterUserIndexFlags(e,t,s){if(-1===t)return!1;let r=this.getClusterUserIndex(e,t);return -1!==r&&!!(s&r)}setClusterUserIndexFlags(e,t,s){let r=this.getClusterIndex_(e),i=this.m_clusterIndices[t];i.size()<=r&&i.resize(this.m_clusterData.size(),-1);let n=i.read(r);-1===n&&(n=0),i.write(r,s|n)}clearClusterUserIndexFlags(e,t,s){let r=this.getClusterIndex_(e),i=this.m_clusterIndices[t];i.size()<=r&&i.resize(this.m_clusterData.size(),-1);let n=i.read(r);-1===n&&(n=0),i.write(r,~s&n)}createUserIndexForClusters(e=-1){let t=new I.A(this.m_clusterData.capacity(),e);for(let e=0,s=this.m_clusterIndices.length;e<s;e++)if(null===this.m_clusterIndices[e])return this.m_clusterIndices[e]=t,e;return this.m_clusterIndices.push(t),this.m_clusterIndices.length-1}deleteUserIndexForClusters(e){this.m_clusterIndices[e]=null}getHalfEdgeOrigin(e){return this.m_halfEdgeData.getField(e,1)}getHalfEdgeTo(e){return this.getHalfEdgeOrigin(this.getHalfEdgeTwin(e))}getHalfEdgeTwin(e){return this.m_halfEdgeData.getField(e,4)}getHalfEdgePrev(e){return this.m_halfEdgeData.getField(e,5)}getHalfEdgeNext(e){return this.m_halfEdgeData.getField(e,6)}getHalfEdgeChain(e){return this.m_halfEdgeData.getField(e,2)}getHalfEdgeFaceParentage(e){return this.getChainParentage(this.getHalfEdgeChain(e))}getHalfEdgeVertexIterator(e){return this.m_halfEdgeData.getField(e,7)}getHalfEdgeFromXY(e,t){this.queryXY(this.getHalfEdgeOrigin(e),t)}getHalfEdgeToXY(e,t){this.queryXY(this.getHalfEdgeTo(e),t)}isHalfEdgeCurve(e){return -1!==this.m_segmentIndexHe&&-1!==this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe)}getHalfEdgeFromXYZ(e,t){(0,S.g)(0)}getHalfEdgeToXYZ(e,t){(0,S.g)(0)}getHalfEdgeParentage(e){return this.m_halfEdgeData.getField(e,3)&eg.c_EdgeParentageMask}getHalfEdgeUserIndex(e,t){let s=this.getHalfEdgeIndex_(e),r=this.m_edgeIndices[t];return r.size()<=s?-1:r.read(s)}setHalfEdgeUserIndex(e,t,s){let r=this.getHalfEdgeIndex_(e),i=this.m_edgeIndices[t];i.size()<=r&&i.resize(this.m_halfEdgeData.size(),-1),i.write(r,s)}createUserIndexForHalfEdges(e){void 0===e&&(e=-1);let t=new I.A(this.m_halfEdgeData.capacity(),e);for(let e=0,s=this.m_edgeIndices.length;e<s;e++)if(null===this.m_edgeIndices[e])return this.m_edgeIndices[e]=t,e;this.m_edgeIndices.push(t);let s=this.m_edgeIndices.length-1;return(0,S.g)(s>=0&&s<=Number.MAX_SAFE_INTEGER),s}deleteUserIndexForHalfEdges(e){this.m_edgeIndices[e]=null}deleteEdgesBreakFaces_(e){for(let t=0,s=e.length;t<s;t++){let s=e[t],r=this.getHalfEdgeChain(s),i=this.getHalfEdgeTwin(s),n=this.getHalfEdgeChain(i);this.setChainHalfEdge_(r,C.n),this.setChainHalfEdge_(n,C.n),this.updateVertexToHalfEdgeConnection_(s,!0),this.deleteEdgeImpl_(s)}}doesHalfEdgeBelongToAPolygonInterior(e,t){return(0,S.g)(0),!1}doesHalfEdgeBelongToAPolygonExterior(e,t){return(0,S.g)(0),!1}doesHalfEdgeBelongToAPolygonBoundary(e,t){return(0,S.g)(0),!1}doesHalfEdgeBelongToAPolylineInterior(e,t){return(0,S.g)(0),!1}doesHalfEdgeBelongToAPolylineExterior(e,t){return(0,S.g)(0),!1}doesClusterBelongToAPolygonInterior(e,t){return(0,S.g)(0),!1}doesClusterBelongToAPolygonExterior(e,t){return(0,S.g)(0),!1}doesClusterBelongToAPolygonBoundary(e,t){return(0,S.g)(0),!1}getFirstChain(){return this.m_universeChain}getChainHalfEdge(e){return this.m_chainData.getField(e,1)}getChainParentage(e){return this.m_chainData.getField(e,2)}getChainParent(e){return this.m_chainData.getField(e,3)}getChainFirstIsland(e){return this.m_chainData.getField(e,4)}getChainNextInParent(e){return this.m_chainData.getField(e,5)}getChainNext(e){return this.m_chainData.getField(e,7)}getChainArea(e){let t=this.getChainIndex_(e),s=this.m_chainAreas.read(t);return Number.isNaN(s)&&(this.updateChainAreaAndPerimeter_(e),s=this.m_chainAreas.read(t)),s}getChainPerimeter(e){return(0,S.g)(0),0}getChainUserIndex(e,t){let s=this.getChainIndex_(e),r=this.m_chainIndices[t];return r.size()<=s?-1:r.read(s)}setChainUserIndex(e,t,s){let r=this.getChainIndex_(e),i=this.m_chainIndices[t];i.size()<=r&&i.resize(this.m_chainData.size(),-1),i.write(r,s)}createUserIndexForChains(){let e=new I.A(this.m_chainData.capacity(),-1);for(let t=0,s=this.m_chainIndices.length;t<s;t++)if(null===this.m_chainIndices[t])return this.m_chainIndices[t]=e,t;return this.m_chainIndices.push(e),this.m_chainIndices.length-1}deleteUserIndexForChains(e){this.m_chainIndices[e]=null}extractPolygonFromChainAndIslands(e,t,s,r){let i=t===C.n?e.createGeometry(S.G.enumPolygon):t,n=new C.S;this.extractPolygonPathFromChain_(e,i,s,r,n);for(let t=this.getChainFirstIsland(s);t!==C.n;t=this.getChainNextInParent(t))this.extractPolygonPathFromChain_(e,i,t,r,n);return i}getGeometryID(e){let t=this.m_shape.getGeometryUserIndex(e,this.m_geometryIDIndex);return(0,S.g)(t>=0),1<<Math.min(t,31)}getClusterFromVertex(e){return this.m_shape.getUserIndex(e,this.m_clusterIndex)}getHalfEdgeFromVertex(e){return this.m_shape.getUserIndex(e,this.m_halfEdgeIndex)}buildGeometryParentageSets(){this.m_bBuildGeometryParentageSets=!0}getChainBitSet(e){if((0,S.g)(this.m_bBuildGeometryParentageSets),-1===this.m_chainBitSetIndex)return this.getEmptySet();let t=this.getChainUserIndex(e,this.m_chainBitSetIndex);(0,S.g)(t>=0);let s=this.m_chainBitSets.at(t);return s||(s=this.getEmptySet()),s}getChainBoundaryBitSet(e){(0,S.g)(this.m_bBuildGeometryParentageSets);let t=new en,s=e=>{let s=this.getChainHalfEdge(e),r=s;do{let e=this.getEdgeBitSet_(r);null!==e&&t.assignOr(e);let s=this.getEdgeBitSet_(this.getHalfEdgeTwin(r));null!==s&&t.assignOr(s),r=this.getHalfEdgeNext(r)}while(r!==s)};s(e);for(let t=this.getChainFirstIsland(e);t!==C.n;t=this.getChainNextInParent(t))s(e);return t}getChainPolygons(e){return(0,S.g)(0),[]}getGeometriesFromBits(e){if(!this.m_bBuildGeometryParentageSets||null===e)return[];if(null===this.m_geometryMapID){this.m_geometryMapID=new Map;for(let e=this.m_shape.getFirstGeometry();e!==C.n;e=this.m_shape.getNextGeometry(e))this.m_geometryMapID.set(this.m_shape.getGeometryUserIndex(e,this.m_geometryIDIndex),e)}let t=[],s=e.getUnorderedBitIterator();for(let e=s.next();e!==er.npos();e=s.next())(0,S.g)(this.m_geometryMapID.has(e)),t.push(this.m_geometryMapID.get(e));return t}getVertexDominant(e,t){if(t===C.n)return e;let s=this.getClusterFromVertex(e);return this.getVertexDominantFromCluster(s,t)}getVertexDominantFromCluster(e,t){if(t!==C.n){let s=C.n;for(let r=this.getClusterVertexIterator(e);r!==C.n;r=this.incrementVertexIterator(r)){let e=this.getVertexFromVertexIterator(r);s===C.n&&(s=e);let i=this.m_shape.getPathFromVertex(e);if(this.m_shape.getGeometryFromPath(i)===t){s=e;break}}return s}{let t=this.getClusterVertexIterator(e);return t!==C.n?this.getVertexFromVertexIterator(t):C.n}}isBreakNode(e){return this.hasClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,P.enumSegmentParentageBreakNode)}setBreakNode(e,t){(0,S.g)(-1!==this.m_clusterBreakNodeIndex),t?this.setClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,P.enumSegmentParentageBreakNode):this.clearClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,P.enumSegmentParentageBreakNode)}isStrongPathNode(e){return this.hasClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,P.enumPathBreakNode)}setStrongPathNode(e,t){if(-1===this.m_clusterBreakNodeIndex){if(!t)return;this.m_clusterBreakNodeIndex=this.createUserIndexForClusters()}t?this.setClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,P.enumPathBreakNode):this.clearClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,P.enumPathBreakNode)}getSegmentParentage(e){if(-1===this.m_segmentParentageIndex)return -1;let t=this.getHalfEdgeUserIndex(e,this.m_segmentParentageIndex);return t>=0?t:-1}isCrossroadAhead(e){let t=this.getHalfEdgeNext(e);if(this.isStrongPathNode(this.getHalfEdgeOrigin(t)))return!0;let s=this.getHalfEdgeTwin(t),r=this.getHalfEdgeNext(s);return e!==this.getHalfEdgeTwin(r)}isCrossroadBehind(e){return(0,S.g)(0),!1}getHalfEdgeConnector(e,t){let s=this.getClusterHalfEdge(e);if(s===C.n)return C.n;let r=s,i=C.n,n=C.n;do{if(this.getHalfEdgeTo(r)===t)return r;if(i===C.n){if((i=this.getClusterHalfEdge(t))===C.n)return C.n;n=i}if(this.getHalfEdgeTo(n)===e)return this.getHalfEdgeTwin(n);r=this.getHalfEdgeNext(this.getHalfEdgeTwin(r)),n=this.getHalfEdgeNext(this.getHalfEdgeTwin(n))}while(r!==s&&n!==i);return C.n}querySegmentXY(e,t){if(-1!==this.m_segmentIndexHe){let s=this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe);if(-1!==s){if(-2!==s){let e=this.m_shape.getSegmentFromIndex(s);t.copyFrom(e,!0)}else{s=this.getHalfEdgeUserIndex(this.getHalfEdgeTwin(e),this.m_segmentIndexHe);let r=this.m_shape.getSegmentFromIndex(s);t.copyFrom(r,!0),t.get().reverse()}return}}t.createLine();let s=t.get(),r=b.P.getNAN();this.getHalfEdgeFromXY(e,r),s.setStartXY(r),this.getHalfEdgeToXY(e,r),s.setEndXY(r)}isCurveEdge(e){return -1!==this.m_segmentIndexHe&&-1!==this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe)}compareEdgeAnglesCurveHelper_(e,t,s){let r=new C.S,i=new C.S;this.querySegmentXY(e,r),this.querySegmentXY(t,i);let n=r.get(),a=i.get();if(n.equals(a))return 0;let o=new b.P;this.getHalfEdgeFromXY(e,o);let h=new b.P;this.getHalfEdgeToXY(e,h);let l=new b.P;this.getHalfEdgeToXY(t,l),(0,S.g)(!h.isEqualPoint2D(l));let m=n.getTangent(0),g=a.getTangent(0);return b.P.compareVectors(m,g)}compareEdgeAnglesHelper_(e,t,s){if(e===t)return 0;if(this.isHalfEdgeCurve(e)||this.isHalfEdgeCurve(t))return this.compareEdgeAnglesCurveHelper_(e,t,s);let r=b.P.getNAN();this.getHalfEdgeToXY(e,r);let i=b.P.getNAN();if(this.getHalfEdgeToXY(t,i),r.isEqualPoint2D(i))return 0;let n=b.P.getNAN();this.getHalfEdgeFromXY(e,n);let a=b.P.getNAN();a.setSub(r,n);let o=b.P.getNAN();return(o.setSub(i,n),!s||o.y>=0&&a.y>0)?b.P.compareVectors(a,o):0}compareEdgeAngles_(e,t){return this.compareEdgeAnglesHelper_(e,t,!1)}compareEdgeAnglesForPair_(e,t){return this.compareEdgeAnglesHelper_(e,t,!0)}compareEdgeAngles3D_(e,t){return(0,S.g)(0),0}compareEdgeAnglesForPair3D_(e,t){return(0,S.g)(0),0}dbgDumpChains_(){}dbgDumpChainToPolygon_(e,t){}deleteEdgeInternal_(e){let t=this.getHalfEdgeChain(e),s=this.getHalfEdgeTwin(e),r=this.getHalfEdgeChain(s);(0,S.g)(r===t),(0,S.g)(e===this.getHalfEdgeNext(s)||s===this.getHalfEdgeNext(e));let i=this.getHalfEdgeNext(e);i===s&&(i=this.getHalfEdgeNext(i))===e&&(i=C.n);let n=this.getChainIndex_(t);Number.isNaN(this.m_chainAreas.read(n))||(this.setChainArea_(t,Number.NaN),this.setChainPerimeter_(t,Number.NaN));let a=this.getChainHalfEdge(t);a!==e&&a!==s||this.setChainHalfEdge_(t,i),this.updateVertexToHalfEdgeConnection_(e,!0),this.deleteEdgeImpl_(e)}getFirstUnvisitedHalfEdgeOnCluster_(e,t,s){let r=t!==C.n?t:this.getClusterHalfEdge(e);if(r===C.n)return C.n;let i=r;for(;;){if(1!==this.getHalfEdgeUserIndex(r,s))return r;let e=this.getHalfEdgeNext(this.getHalfEdgeTwin(r));if(e===i)return C.n;r=e}}removeSpikes_(){let e=!1,t=this.createUserIndexForHalfEdges();for(let s=this.getFirstCluster();s!==C.n;s=this.getNextCluster(s)){let r=C.n;for(;;){let i=this.getFirstUnvisitedHalfEdgeOnCluster_(s,r,t);if(i===C.n)break;r=this.getHalfEdgeNext(this.getHalfEdgeTwin(i));let n=i;for(;;){let s=this.getHalfEdgeNext(n),a=this.getHalfEdgePrev(n),o=this.getHalfEdgeTwin(n);if(a===o){if(this.deleteEdgeInternal_(n),e=!0,r!==n&&r!==o||(r=C.n),n===i||a===i){if(n===(i=s)||a===i)break;n=s;continue}}else this.setHalfEdgeUserIndex(n,t,1);if((n=s)===i)break}}}return this.deleteUserIndexForHalfEdges(t),e}progress_(e,t=!1){}newCluster_(){let e=this.m_clusterData.newElement();return this.m_clusterData.setField(e,1,0),e}newHalfEdgePair_(){let e=this.m_halfEdgeData.newElement();this.m_halfEdgeData.setField(e,2,0),this.m_halfEdgeData.setField(e,3,0);let t=this.m_halfEdgeData.newElement();return this.m_halfEdgeData.setField(t,2,0),this.m_halfEdgeData.setField(t,3,0),this.setHalfEdgeTwin_(e,t),this.setHalfEdgeTwin_(t,e),e}newChain_(){let e=this.m_chainData.newElement();return this.m_chainData.setField(e,2,0),e}deleteChain_(e){return(0,S.g)(0),0}getClusterIndex_(e){return this.m_clusterData.elementToIndex(e)}setClusterVertexIterator_(e,t){this.m_clusterData.setField(e,7,t)}setClusterHalfEdge_(e,t){this.m_clusterData.setField(e,2,t)}setClusterParentage_(e,t){this.m_clusterData.setField(e,1,t)}setPrevCluster_(e,t){this.m_clusterData.setField(e,3,t)}setNextCluster_(e,t){this.m_clusterData.setField(e,4,t)}setClusterVertexIndex_(e,t){this.m_clusterData.setField(e,5,t)}getClusterVertexIndex_(e){return this.m_clusterData.getField(e,5)}setClusterChain_(e,t){this.m_clusterData.setField(e,6,t)}addClusterToExteriorChain_(e,t){this.setClusterChain_(t,e)}getHalfEdgeIndex_(e){return this.m_halfEdgeData.elementToIndex(e)}setHalfEdgeOrigin_(e,t){this.m_halfEdgeData.setField(e,1,t)}setHalfEdgeTwin_(e,t){this.m_halfEdgeData.setField(e,4,t)}setHalfEdgePrev_(e,t){this.m_halfEdgeData.setField(e,5,t)}setHalfEdgeNext_(e,t){this.m_halfEdgeData.setField(e,6,t)}setHalfEdgeChain_(e,t){this.m_halfEdgeData.setField(e,2,t)}setHalfEdgeParentage_(e,t){this.m_halfEdgeData.setField(e,3,t)}getHalfEdgeParentageMask_(e){return this.m_halfEdgeData.getField(e,3)}setHalfEdgeVertexIterator_(e,t){this.m_halfEdgeData.setField(e,7,t)}updateVertexToHalfEdgeConnectionHelper_(e,t){let s=t?C.n:e;for(let t=this.getHalfEdgeVertexIterator(e);t!==C.n;t=this.incrementVertexIterator(t)){let e=this.getVertexFromVertexIterator(t);this.m_shape.setUserIndex(e,this.m_halfEdgeIndex,s)}}updateVertexToHalfEdgeConnection_(e,t){e!==C.n&&(this.updateVertexToHalfEdgeConnectionHelper_(e,t),this.updateVertexToHalfEdgeConnectionHelper_(this.getHalfEdgeTwin(e),t))}getChainIndex_(e){return this.m_chainData.elementToIndex(e)}setChainHalfEdge_(e,t){this.m_chainData.setField(e,1,t)}setChainParentage_(e,t){this.m_chainData.setField(e,2,t)}setChainParent_(e,t){this.m_chainData.setField(e,3,t);let s=this.getChainFirstIsland(t);this.setChainNextInParent_(e,s),this.setChainFirstIsland_(t,e)}setChainFirstIsland_(e,t){this.m_chainData.setField(e,4,t)}setChainNextInParent_(e,t){this.m_chainData.setField(e,5,t)}setChainPrev_(e,t){this.m_chainData.setField(e,6,t)}setChainNext_(e,t){this.m_chainData.setField(e,7,t)}setChainArea_(e,t){let s=this.getChainIndex_(e);this.m_chainAreas.write(s,t)}setChainPerimeter_(e,t){let s=this.getChainIndex_(e);this.m_chainPerimeters.write(s,t)}updateChainAreaAndPerimeter_(e){let t=this.m_shape.hasCurves(),s=new b.K(0),r=new b.K(0),i=this.getChainHalfEdge(e),n=b.P.getNAN(),a=b.P.getNAN(),o=b.P.getNAN();this.getHalfEdgeFromXY(i,n),a.setCoordsPoint2D(n);let h=i;do this.getHalfEdgeToXY(h,o),t&&this.isCurveEdge(h)||r.pe(b.P.distance(a,o)),this.getHalfEdgeChain(this.getHalfEdgeTwin(h))!==e&&s.pe((o.x-n.x-(a.x-n.x))*(o.y-n.y+(a.y-n.y))*.5),a.setCoordsPoint2D(o),h=this.getHalfEdgeNext(h);while(h!==i);if(t){let t=new C.S;h=i;do{this.getHalfEdgeToXY(h,o);let i=this.isCurveEdge(h);if(i&&(this.querySegmentXY(h,t),r.pe(t.get().calculateLength2D())),this.getHalfEdgeChain(this.getHalfEdgeTwin(h))!==e&&i){let e=t.get().calculateArea2DHelper();s.pe(e)}h=this.getHalfEdgeNext(h)}while(h!==i)}let l=this.getChainIndex_(e);this.m_chainAreas.write(l,s.getResult()),this.m_chainPerimeters.write(l,r.getResult())}getChainTopmostEdge_(e){return(0,S.g)(0),0}planeSweepParentage_(e,t){let s=new eo(this),r=new I.T;r.setCapacity(Math.trunc(this.m_pointCount/2)),r.setComparator(s);let i=[],n=this.createUserIndexForHalfEdges(),a=null,o=b.P.getNAN();for(let h=this.getFirstCluster();h!==C.n;h=this.getNextCluster(h)){this.progress_(t);let l=this.getClusterHalfEdge(h);if(l!==C.n){if(i.length=0,!this.tryOptimizedInsertion_(r,n,i,h,l)){this.queryXY(h,o),s.setY(o.y);let e=l;do{let t=this.getHalfEdgeUserIndex(e,n);-1!==t&&(r.deleteNode(t),this.setHalfEdgeUserIndex(e,n,I.S.impossibleIndex2())),e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(l!==e);e=l;do{if(-1===this.getHalfEdgeUserIndex(e,n)){let t=r.addElement(e);i.push(t)}e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(l!==e)}for(let t=i.length-1;t>=0;t--){let s=i[t],a=r.getElement(s),o=this.getHalfEdgeTwin(a);this.setHalfEdgeUserIndex(o,n,s),this.planeSweepParentagePropagateParentage_(r,s,e)}}else if(this.getClusterChain(h)===C.n){null===a&&(a=new eh(this)),this.queryXY(h,o),a.setPointXY(o);let e=r.searchLowerBound(a),t=this.m_universeChain;if(-1!==e){let s=r.getElement(e);this.getHalfEdgeChain(s)===this.getHalfEdgeChain(this.getHalfEdgeTwin(s))&&(s=this.getLeftSkipPolylines_(r,e)),s!==C.n&&(t=this.getHalfEdgeChain(s))}this.addClusterToExteriorChain_(t,h)}}this.deleteUserIndexForHalfEdges(n)}planeSweepParentagePropagateParentage_(e,t,s){let r=e.getElement(t),i=this.getHalfEdgeChain(r);if(this.getChainParent(i)!==C.n)return;let n=this.getLeftSkipPolylines_(e,t),a=this.getHalfEdgeTwin(r),o=this.getHalfEdgeChain(a),h=this.getChainParent(i),l=this.getChainParent(o);if(n===C.n)h===C.n&&(o===i?(this.setChainParent_(o,this.m_universeChain),h=l=this.m_universeChain):(l===C.n&&(this.setChainParent_(o,this.m_universeChain),l=this.m_universeChain),this.setChainParent_(i,o),h=o));else{let e=this.getHalfEdgeChain(n);if(l===C.n){if(0>=this.getChainArea(e)){let t=this.getChainParent(e);this.setChainParent_(o,t),l=t}else this.setChainParent_(o,e),l=e;o===i&&(h=l)}}h===C.n&&(this.trySetChainParentFromTwin_(i,o),h=this.getChainParent(i)),(0,S.g)(h!==C.n),s===x.enumInputModeBuildGraph?this.propagateParentageBuildGraph_(e,t,r,n):s===x.enumInputModeSimplifyWinding?this.propagateParentageWinding_(e,t,r,n,a,i,o):s===x.enumInputModeSimplifyAlternate&&this.propagateParentageAlternate_(e,t,r,n,a,i,o)}propagateParentageBuildGraph_(e,t,s,r){let i,n=t;r===C.n?(n=e.getNext(n),i=this.getHalfEdgeChain(s)):i=this.getHalfEdgeChain(r);let a=null,o=this.getChainParentage(i);for(this.m_bBuildGeometryParentageSets&&(a=this.getChainBitSet(i));-1!==n;n=e.getNext(n)){let t=e.getElement(n),s=this.getHalfEdgeTwin(t);i=this.getHalfEdgeChain(t);let r=this.getHalfEdgeChain(s);if(this.m_bBuildGeometryParentageSets){let e=this.getChainBitSet(r);(e=new en({copy:e})).assignOr(a),this.setChainBitSet_(r,e);let s=this.getChainBitSet(i),n=this.getLeftEdgeBitSet_(t),o=new en({copy:a});if(o.assignSubtract(n),o.isZero())break;(s=new en({copy:s})).assignOr(o),this.setChainBitSet_(i,s),a=s}let h=this.getChainParentage(r),l=h|o;l!==h&&this.setChainParentage_(r,l);let m=this.getChainParentage(i),g=o&~this.getHalfEdgeUserIndex(t,this.m_tmpHalfEdgeParentageIndexLeft);if(g&&(m|=g,this.setChainParentage_(i,m)),0===g)break;o=m}}propagateParentageWinding_(e,t,s,r,i,n,a){if(n===a)return;let o=this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeWindingNumberIndex);o+=this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeWindingNumberIndex);let h=0,l=[],m=[];m.push(0);for(let s=e.getFirst();s!==t;s=e.getNext(s)){let t=e.getElement(s),r=this.getHalfEdgeTwin(t),i=this.getHalfEdgeChain(t),n=this.getHalfEdgeChain(r);if(i!==n){let e=this.getHalfEdgeUserIndex(t,this.m_tmpHalfEdgeWindingNumberIndex);e+=this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeWindingNumberIndex),h+=e;let s=!1;0!==l.length&&l.at(-1)===n&&(m.pop(),l.pop(),s=!0),(0,S.g)(this.getChainParent(n)!==C.n),s&&this.getChainParent(n)===i||(m.push(h),l.push(i))}}if(h+=o,0!==l.length&&l.at(-1)===a&&(m.pop(),l.pop()),0!==h){if(0===m.at(-1)){let e=this.m_simplifiedGeometry,t=this.getGeometryID(e);this.setChainParentage_(n,t)}}else if(0!==m.at(-1)){let e=this.m_simplifiedGeometry,t=this.getGeometryID(e);this.setChainParentage_(n,t)}}propagateParentageAlternate_(e,t,s,r,i,n,a){let o=this.m_simplifiedGeometry,h=this.getGeometryID(o);if(r===C.n)this.setChainParentage_(a,this.m_universeGeomID),1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(n,h):this.setChainParentage_(n,this.m_universeGeomID);else{let e=this.getChainParentage(a);if(0===e){let e=this.getHalfEdgeChain(r),t=this.getChainParentage(e);this.setChainParentage_(a,t),1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(n,t===h?this.m_universeGeomID:h):this.setChainParentage_(n,t)}else 1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(n,e===h?this.m_universeGeomID:h):this.setChainParentage_(n,e)}}tryOptimizedInsertion_(e,t,s,r,i){let n=i,a=-1,o=C.n,h=0;do{if(2===h)return!1;let e=this.getHalfEdgeUserIndex(n,t);if(-1!==e){if(-1!==a)return!1;a=e}else{if(o!==C.n)return!1;o=n}h++,n=this.getHalfEdgeNext(this.getHalfEdgeTwin(n))}while(i!==n);return o!==C.n&&-1!==a&&(this.setHalfEdgeUserIndex(e.getElement(a),t,I.S.impossibleIndex2()),e.setElement(a,o),s.push(a),!0)}trySetChainParentFromTwin_(e,t){let s=this.getChainArea(e);if(0===s)return!1;let r=this.getChainArea(t);if(s>0&&r<0||s<0&&r>0)return this.setChainParent_(e,t),!0;{let s=this.getChainParent(t);if(s!==C.n)return this.setChainParent_(e,s),!0}return!1}createHalfEdges_(e,t){this.m_halfEdgeIndex=this.m_shape.createUserIndex();for(let s=0,r=t.size();s<r;s++){let r=t.read(s),i=this.m_shape.getUserIndex(r,this.m_clusterIndex),n=this.m_shape.getPathFromVertex(r),a=this.m_shape.getGeometryFromPath(n),o=this.m_shape.getGeometryType(a);if((0,S.h)(o)){let t=this.m_shape.getNextVertex(r);if(t===C.n)continue;let s=this.m_shape.getUserIndex(t,this.m_clusterIndex);if(i===s)continue;let n=this.newHalfEdgePair_(),h=this.getHalfEdgeTwin(n),l=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(l,0,r),this.m_clusterVertices.setField(l,1,-1),this.setHalfEdgeVertexIterator_(n,l),this.m_shape.setUserIndex(r,this.m_halfEdgeIndex,n),this.setHalfEdgeOrigin_(n,i);let m=this.getClusterHalfEdge(i);if(m===C.n)this.setClusterHalfEdge_(i,n),this.setHalfEdgePrev_(n,h),this.setHalfEdgeNext_(h,n);else{let e=this.getHalfEdgePrev(m);this.setHalfEdgePrev_(m,h),this.setHalfEdgeNext_(h,m),this.setHalfEdgeNext_(e,n),this.setHalfEdgePrev_(n,e)}this.setHalfEdgeOrigin_(h,s);let g=this.getClusterHalfEdge(s);if(g===C.n)this.setClusterHalfEdge_(s,h),this.setHalfEdgeNext_(n,h),this.setHalfEdgePrev_(h,n);else{let e=this.getHalfEdgePrev(g);this.setHalfEdgePrev_(g,n),this.setHalfEdgeNext_(n,g),this.setHalfEdgeNext_(e,h),this.setHalfEdgePrev_(h,e)}let u=this.getGeometryID(a);if(e===x.enumInputModeBuildGraph){let e=o===S.G.enumPolygon?u:0;if(this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndex,0),this.setHalfEdgeUserIndex(n,this.m_tmpHalfEdgeParentageIndex,e),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndexLeft,e),this.setHalfEdgeUserIndex(n,this.m_tmpHalfEdgeParentageIndexLeft,0),this.m_bBuildGeometryParentageSets){let e=new en,t=this.m_shape.getGeometryUserIndex(a,this.m_geometryIDIndex);e.setBit(t),this.setEdgeBitSet_(n,e),this.setEdgeBitSet_(h,null),this.setLeftEdgeBitSet_(h,e),this.setLeftEdgeBitSet_(n,null)}}else if(e===x.enumInputModeSimplifyWinding){let e=this.m_shape.getXY(r),s=this.m_shape.getXY(t),i=0,a=0;0>e.compare(s)?i=1:a=-1,this.setHalfEdgeUserIndex(n,this.m_tmpHalfEdgeWindingNumberIndex,i),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeWindingNumberIndex,a)}else e===x.enumInputModeSimplifyAlternate&&(this.setHalfEdgeUserIndex(n,this.m_tmpHalfEdgeOddEvenNumberIndex,1),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeOddEvenNumberIndex,1));let _=o===S.G.enumPolygon?eg.c_EdgeBitMask:0;this.setHalfEdgeParentage_(n,u|_),this.setHalfEdgeParentage_(h,u|_)}}if(this.m_shape.hasCurves()){this.m_segmentIndexHe=this.createUserIndexForHalfEdges();for(let e=0,s=t.size();e<s;e++){let s=t.read(e);if(this.m_shape.getSegment(s)){let e=this.m_shape.getUserIndex(s,this.m_halfEdgeIndex);e!==C.n&&(this.setHalfEdgeUserIndex(e,this.m_segmentIndexHe,this.m_shape.getVertexIndex(s)),this.setHalfEdgeUserIndex(this.getHalfEdgeTwin(e),this.m_segmentIndexHe,-2))}}}}mergeVertexListsOfEdges_(e,t){{let s=this.getHalfEdgeVertexIterator(t);if(s!==C.n){let r=this.getHalfEdgeVertexIterator(e);this.m_clusterVertices.setField(s,1,r),this.setHalfEdgeVertexIterator_(e,s),this.setHalfEdgeVertexIterator_(t,C.n)}}let s=this.getHalfEdgeTwin(e),r=this.getHalfEdgeTwin(t);{let e=this.getHalfEdgeVertexIterator(r);if(e!==C.n){let t=this.getHalfEdgeVertexIterator(s);this.m_clusterVertices.setField(e,1,t),this.setHalfEdgeVertexIterator_(s,e),this.setHalfEdgeVertexIterator_(r,C.n)}}if(-1!==this.m_segmentIndexHe){let i=this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe);if(-1!==i){if(-2===i){let s=this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(e,this.m_segmentIndexHe,s)}if(-2===(i=this.getHalfEdgeUserIndex(s,this.m_segmentIndexHe))){let e=this.getHalfEdgeUserIndex(r,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(s,this.m_segmentIndexHe,e)}}}}sortHalfEdgesByAngle_(e){let t=[];for(let s=this.getFirstCluster();s!==C.n;s=this.getNextCluster(s)){t.length=0;let r=this.getClusterHalfEdge(s);if(r!==C.n){let i=r;do t.push(i),i=this.getHalfEdgeNext(this.getHalfEdgeTwin(i));while(i!==r);if(t.length>1){let i=!0;t.length>2?(t.sort((e,t)=>this.compareEdgeAngles_(e,t)),t.push(t[0])):this.compareEdgeAnglesForPair_(t[0],t[1])>0?t[1]=(0,b.b)(t[0],t[0]=t[1]):i=!1;let n=t[0],a=n,o=this.getHalfEdgeTo(a),h=this.getHalfEdgeTwin(a),l=C.n;for(let s=1,r=t.length;s<r;s++){let r=t[s],i=this.getHalfEdgeTwin(r),m=this.getHalfEdgeOrigin(i);if(m!==o||r===a)this.updateVertexToHalfEdgeConnection_(l,!1),l=C.n,a=r,o=m,h=i;else{if(e===x.enumInputModeBuildGraph){let e=this.getHalfEdgeParentageMask_(a)|this.getHalfEdgeParentageMask_(r);if(this.setHalfEdgeParentage_(a,e),this.setHalfEdgeParentage_(h,e),this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeParentageIndexLeft)),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeParentageIndexLeft)),this.m_bBuildGeometryParentageSets){let e,t,s;e=this.getEdgeBitSet_(a),t=this.getEdgeBitSet_(r),(s=new en({copy:e})).assignOr(t),this.setEdgeBitSet_(a,s),e=this.getEdgeBitSet_(h),t=this.getEdgeBitSet_(i),(s=new en({copy:e})).assignOr(t),this.setEdgeBitSet_(h,s),e=this.getLeftEdgeBitSet_(a),t=this.getLeftEdgeBitSet_(r),(s=new en({copy:e})).assignOr(t),this.setLeftEdgeBitSet_(a,s),e=this.getLeftEdgeBitSet_(h),t=this.getLeftEdgeBitSet_(i),(s=new en({copy:e})).assignOr(t),this.setLeftEdgeBitSet_(h,s)}}else if(-1!==this.m_tmpHalfEdgeWindingNumberIndex){let e=this.getHalfEdgeUserIndex(a,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeWindingNumberIndex),t=this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeWindingNumberIndex);this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeWindingNumberIndex,e),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeWindingNumberIndex,t)}else if(-1!==this.m_tmpHalfEdgeOddEvenNumberIndex){let e=this.getHalfEdgeUserIndex(a,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeOddEvenNumberIndex),t=this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeOddEvenNumberIndex);this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeOddEvenNumberIndex,e),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeOddEvenNumberIndex,t)}this.mergeVertexListsOfEdges_(a,r),this.deleteEdgeImpl_(r),l=a,t[s]=C.n,r===n&&(t[0]=C.n,n=C.n)}}if(this.updateVertexToHalfEdgeConnection_(l,!1),l=C.n,!i){n=C.n;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s!==C.n){n=s;break}}r!==n&&this.setClusterHalfEdge_(s,n);continue}n=C.n;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s===C.n)continue;if(n===C.n){a=n=s,o=this.getHalfEdgeTo(a),h=this.getHalfEdgeTwin(a);continue}if(s===a)continue;let r=this.getHalfEdgeTwin(s),i=this.getHalfEdgeOrigin(r);this.setHalfEdgeNext_(h,s),this.setHalfEdgePrev_(s,h),a=s,o=i,h=r}this.setClusterHalfEdge_(s,n)}}}}sortHalfEdgesByAngle3D_(e){(0,S.g)(0)}buildChains_(e){this.m_universeChain=this.newChain_(),this.setChainHalfEdge_(this.m_universeChain,C.n);let t=this.m_universeChain,s=this.createUserIndexForHalfEdges();for(let e=this.getFirstCluster();e!==C.n;e=this.getNextCluster(e)){let r=this.getClusterHalfEdge(e);if(r!==C.n){let e=r;do{if(1!==this.getHalfEdgeUserIndex(e,s)){let r=this.newChain_();this.setChainHalfEdge_(r,e),this.setChainPrev_(r,t),this.setChainNext_(t,r);let i=null;this.m_bBuildGeometryParentageSets&&(i=new en),t=r;let n=0,a=e;do -1!==this.m_tmpHalfEdgeParentageIndex&&(n|=this.getHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndex)),this.m_bBuildGeometryParentageSets&&i.assignOr(this.getEdgeBitSet_(a)),this.setHalfEdgeChain_(a,r),this.setHalfEdgeUserIndex(a,s,1),a=this.getHalfEdgeNext(a);while(a!==e);this.m_bBuildGeometryParentageSets&&this.setChainBitSet_(r,i),this.setChainParentage_(r,n)}e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(e!==r)}}this.m_chainAreas=new I.y(this.m_chainData.size(),Number.NaN),this.m_chainPerimeters=new I.y(this.m_chainData.size(),Number.NaN),this.setChainArea_(this.m_universeChain,Number.POSITIVE_INFINITY),this.setChainPerimeter_(this.m_universeChain,Number.POSITIVE_INFINITY),this.deleteUserIndexForHalfEdges(s)}simplify_(e){(0,S.g)(0)}simplifyAlternate_(){(0,S.g)(0)}simplifyWinding_(){(0,S.g)(0)}setEditShapeImpl_(e,t,s,r,i){this.removeShape(),this.m_bBuildChains=i,this.m_shape=e,this.m_geometryIDIndex=this.m_shape.createGeometryUserIndex();let n=this.m_shape.getTotalPointCount();if(s)for(let e=0,t=s.length;e<t;e++)this.m_shape.getPointCount(s[e]);let a=new I.A(0),o=0,h=0;{let e=null!=s?s[0]:this.m_shape.getFirstGeometry(),t=1;for(;e!==C.n;){this.m_shape.setGeometryUserIndex(e,this.m_geometryIDIndex,h++);for(let t=this.m_shape.getFirstPath(e);t!==C.n;t=this.m_shape.getNextPath(t)){let e=this.m_shape.getFirstVertex(t);for(let s=0,r=this.m_shape.getPathSize(t);s<r;s++)a.add(e),e=this.m_shape.getNextVertex(e)}(0,S.e)(this.m_shape.getGeometryType(e))||(o+=this.m_shape.getPathCount(e)),null!=s?(e=t<s.length?s[t]:C.n,t++):e=this.m_shape.getNextGeometry(e)}}this.m_universeGeomID=1<<Math.min(h,31),this.m_pointCount=a.size(),this.m_shape.sortVerticesSimpleByY(a,0,this.m_pointCount),this.m_clusterVertices.setCapacity(this.m_pointCount),this.progress_(r,!0),this.m_clusterData.setCapacity(this.m_pointCount+10),this.m_halfEdgeData.setCapacity(2*this.m_pointCount+32),this.m_chainData.setCapacity(Math.max(32,o)),this.m_clusterIndex=this.m_shape.createUserIndex();let l=b.P.getNAN(),m=0,g=b.P.getNAN();for(let e=0;e<=this.m_pointCount;e++){if(e<this.m_pointCount){let t=a.read(e);this.m_shape.queryXY(t,g)}else g.setNAN();if(!l.isEqualPoint2D(g)){if(m<e){let t=this.newCluster_(),s=C.n,r=-1;for(let i=m;i<e;i++){r=a.read(i),this.m_shape.setUserIndex(r,this.m_clusterIndex,t);let e=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(e,0,r),this.m_clusterVertices.setField(e,1,s),s=e;let n=this.m_shape.getPathFromVertex(r),o=this.m_shape.getGeometryFromPath(n),h=this.getGeometryID(o);this.setClusterParentage_(t,this.getClusterParentage(t)|h)}this.setClusterVertexIterator_(t,s),this.setClusterVertexIndex_(t,this.m_shape.getVertexIndex(r)),this.m_lastCluster!==C.n&&this.setNextCluster_(this.m_lastCluster,t),this.setPrevCluster_(t,this.m_lastCluster),this.m_lastCluster=t,this.m_firstCluster===C.n&&(this.m_firstCluster=t)}m=e,l.setCoordsPoint2D(g)}}if(this.m_shape.hasSegmentParentage()){-1===this.m_clusterBreakNodeIndex&&(this.m_clusterBreakNodeIndex=this.createUserIndexForClusters());for(let e=0;e<this.m_pointCount;e++){let t=a.read(e);if(this.m_shape.getSegmentParentageBreakVertex(t)){let e=this.getClusterFromVertex(t);this.setBreakNode(e,!0)}}}this.progress_(r,!0);{let e=null!=s?s[0]:this.m_shape.getFirstGeometry(),t=1;for(;e!==C.n;){for(let t=this.m_shape.getFirstPath(e);t!==C.n;t=this.m_shape.getNextPath(t)){if(this.m_shape.isStrongPathStart(t)){let e=this.m_shape.getFirstVertex(t),s=this.getClusterFromVertex(e);this.setStrongPathNode(s,!0)}if(this.m_shape.isStrongPathEnd(t)){let e=this.m_shape.isClosedPath(t)?this.m_shape.getFirstVertex(t):this.m_shape.getLastVertex(t),s=this.getClusterFromVertex(e);this.setStrongPathNode(s,!0)}}null!=s?(e=t<s.length?s[t]:C.n,t++):e=this.m_shape.getNextGeometry(e)}}if(t===x.enumInputModeBuildGraph&&(this.m_tmpHalfEdgeParentageIndex=this.createUserIndexForHalfEdges(),this.m_tmpHalfEdgeParentageIndexLeft=this.createUserIndexForHalfEdges()),t===x.enumInputModeSimplifyWinding&&(this.m_tmpHalfEdgeWindingNumberIndex=this.createUserIndexForHalfEdges()),t===x.enumInputModeSimplifyAlternate&&(this.m_tmpHalfEdgeOddEvenNumberIndex=this.createUserIndexForHalfEdges()),this.createHalfEdges_(t,a),this.dbgNavigate_(),this.sortHalfEdgesByAngle_(t),!Number.isNaN(this.m_checkDirtyPlanesweepTolerance)&&!this.checkStructureAfterDirtySweep_())return this.m_bDirtyCheckFailed=!0,void this.cleanSetEditShapeImpl_();this.buildChains_(t),-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_bBuildChains&&this.planeSweepParentage_(t,r),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.dbgChkChainParents_(),this.dbgDumpChains_(),this.mergeSegmentParentage_(),this.dbgNavigate_(),this.dbgDumpChains_(),this.cleanSetEditShapeImpl_()}setEditShapeImpl3D_(e,t,s,r,i){(0,S.g)(0)}cleanSetEditShapeImpl_(){-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),-1!==this.m_tmpHalfEdgeWindingNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1)}cleanSetEditShapeImpl3D_(){(0,S.g)(0)}dbgNavigate_(){}dbgChkChainParents_(){}deleteEdgeImpl_(e){let t=this.getHalfEdgeNext(e),s=this.getHalfEdgePrev(e),r=this.getHalfEdgeTwin(e),i=this.getHalfEdgeNext(r),n=this.getHalfEdgePrev(r);t!==r&&(this.setHalfEdgeNext_(n,t),this.setHalfEdgePrev_(t,n)),s!==r&&(this.setHalfEdgeNext_(s,i),this.setHalfEdgePrev_(i,s));let a=this.getHalfEdgeOrigin(e);this.getClusterHalfEdge(a)===e&&(i!==e?this.setClusterHalfEdge_(a,i):this.setClusterHalfEdge_(a,C.n));let o=this.getHalfEdgeOrigin(r);this.getClusterHalfEdge(o)===r&&(t!==r?this.setClusterHalfEdge_(o,t):this.setClusterHalfEdge_(o,C.n)),this.m_halfEdgeData.deleteElement(e),this.m_halfEdgeData.deleteElement(r)}getLeftSkipPolylines_(e,t){let s=t;for(;;){if(-1===(s=e.getPrev(s)))return C.n;{let t=e.getElement(s);if(this.getHalfEdgeChain(t)!==this.getHalfEdgeChain(this.getHalfEdgeTwin(t)))return t}}}checkStructureAfterDirtySweep_(){let e=(0,b.s)(this.m_checkDirtyPlanesweepTolerance),t=new b.P,s=new b.P,r=new b.P,i=new b.P,n=new b.P;for(let a=this.getFirstCluster();a!==C.n;a=this.getNextCluster(a)){let o=this.getClusterHalfEdge(a);if(o!==C.n){let a=o;this.getHalfEdgeFromXY(a,t),this.getHalfEdgeToXY(a,s),r.setSub(s,t);let h=r.sqrLength();do{let o=a;if((a=this.getHalfEdgeNext(this.getHalfEdgeTwin(a)))!==o){this.getHalfEdgeToXY(a,i),n.setSub(i,t);let o=n.sqrLength(),l=n.crossProduct(r),m=l*l/(o*h);if(Math.min(o,h)*m<=e&&n.dotProduct(r)>=0)return!1;r.assign(n),h=o,s.assign(i)}}while(a!==o)}}return!0}extractPolygonPathFromChain_(e,t,s,r,i){let n=this.m_shape.hasSegmentParentage(),a=this.getChainHalfEdge(s),o=a,h=C.n,l=new I.P;do{let a=this.getHalfEdgeTwin(o);if(this.getHalfEdgeChain(a)!==s){let s,a=C.n,m=this.getHalfEdgeOrigin(o);if(r===C.n){let e=this.getClusterVertexIterator(m);a=this.getVertexFromVertexIterator(e)}else for(let e=this.getClusterVertexIterator(m);e!==C.n;e=this.incrementVertexIterator(e)){let t=this.getVertexFromVertexIterator(e);a===C.n&&(a=t);let s=this.m_shape.getPathFromVertex(t);if(this.m_shape.getGeometryFromPath(s)===r){a=t;break}}if(h===C.n&&(h=e.insertPath(t,C.n),e.setClosedPath(h,!0)),this.m_shape===e?s=e.addVertex(h,a):(this.m_shape.queryPoint(a,l),s=e.addPoint(h,l)),this.isHalfEdgeCurve(o)&&(this.querySegmentXY(o,i),e.setSegmentToIndex(e.getVertexIndex(s),i.get().clone())),n){let t=this.getSegmentParentage(o);e.setSegmentParentageAndBreak(s,t,this.isBreakNode(m))}}o=this.getHalfEdgeNext(o)}while(o!==a)}mergeSegmentParentage_(){if(!this.m_shape.hasSegmentParentage())return;(0,S.g)(-1!==this.m_clusterBreakNodeIndex),(0,S.g)(-1===this.m_segmentParentageIndex);for(let e=this.getFirstCluster();e!==C.n;e=this.getNextCluster(e)){let t=0,s=this.getClusterHalfEdge(e);if(s!==C.n){let e=s;do t++,e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e));while(e!==s&&t<3)}2!==t&&this.setBreakNode(e,!0)}let e=[],t=[];this.m_segmentParentageIndex=this.createUserIndexForHalfEdges();let s=this.createUserIndexForHalfEdges();for(let r=this.getFirstCluster();r!==C.n;r=this.getNextCluster(r)){let i=this.getClusterHalfEdge(r);if(i!==C.n){let r=!1,n=i;do{let i=n;for(;-1===this.getHalfEdgeUserIndex(i,s);){let n=this.getHalfEdgeNext(i),a=this.getHalfEdgeTwin(i);em(this,i,t);let o=t.at(-1).parentage;if(!r){let t=this.getHalfEdgeOrigin(i);if(!this.isBreakNode(t)){let t=this.getHalfEdgePrev(i);i!==t&&(em(this,t,e),r=!0)}}if(r&&!function(e,t){let s=e.length;if(s!==t.length)return!1;let r=e[0].parentage;if(r!==t[0].parentage)return!1;if(-1===r)return!0;for(let r=1;r<s;++r)if(e[r].parentage!==t[r].parentage)return!1;return!0}(t,e)){let e=this.getHalfEdgeOrigin(i);this.setBreakNode(e,!0)}e=(0,b.b)(t,t=e),r=!0;let h=this.getHalfEdgeOrigin(n);this.isBreakNode(h)&&(r=!1),this.setHalfEdgeUserIndex(i,this.m_segmentParentageIndex,o),this.setHalfEdgeUserIndex(a,this.m_segmentParentageIndex,o),this.setHalfEdgeUserIndex(i,s,1),this.setHalfEdgeUserIndex(a,s,1),i=n}n=this.getHalfEdgeNext(this.getHalfEdgeTwin(n))}while(n!==i)}}this.deleteUserIndexForHalfEdges(s)}registerNewBitSet(e){return(null===this.m_uniqueBitSets&&(this.m_uniqueBitSets=new ea(e=>e.getHashCode(),(e,t)=>e.equals(t)),this.m_uniqueBitSets.add(this.getEmptySet())),null===e)?this.getEmptySet():this.m_uniqueBitSets.has(e)?this.m_uniqueBitSets.get(e):(this.m_uniqueBitSets.add(e),e)}getLeftEdgeBitSet_(e){let t=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft);return(0,S.g)(t>=0),(0,S.g)(this.m_edgeBitSets.at(t)),this.m_edgeBitSets.at(t)}getEdgeBitSet_(e){let t=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndex);return(0,S.g)(t>=0),this.m_edgeBitSets.at(t)}setEdgeBitSet_(e,t){(0,S.g)(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),-1===this.m_edgeBitSetIndex&&(this.m_edgeBitSetIndex=this.createUserIndexForHalfEdges());let s=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndex);-1!==s?this.m_edgeBitSets[s]=t:(this.setHalfEdgeUserIndex(e,this.m_edgeBitSetIndex,this.m_edgeBitSets.length),this.m_edgeBitSets.push(t))}setLeftEdgeBitSet_(e,t){(0,S.g)(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),-1===this.m_edgeBitSetIndexLeft&&(this.m_edgeBitSetIndexLeft=this.createUserIndexForHalfEdges());let s=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft);-1!==s?this.m_edgeBitSets[s]=t:(this.setHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft,this.m_edgeBitSets.length),this.m_edgeBitSets.push(t))}setChainBitSet_(e,t){(0,S.g)(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),-1===this.m_chainBitSetIndex&&(this.m_chainBitSetIndex=this.createUserIndexForChains());let s=this.getChainUserIndex(e,this.m_chainBitSetIndex);-1!==s?this.m_chainBitSets[s]=t:(this.setChainUserIndex(e,this.m_chainBitSetIndex,this.m_chainBitSets.length),this.m_chainBitSets.push(t))}getEmptySet(){return this.m_emptyBitSet||(this.m_emptyBitSet=new en),this.m_emptyBitSet}deleteEdgeBitSets_(){-1!==this.m_edgeBitSetIndex&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndex),this.m_edgeBitSetIndex=-1),-1!==this.m_edgeBitSetIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndexLeft),this.m_edgeBitSetIndexLeft=-1),this.m_edgeBitSets.length=0,this.m_uniqueBitSets=null}deleteChainBitSets_(){-1!==this.m_chainBitSetIndex&&(this.deleteUserIndexForChains(this.m_chainBitSetIndex),this.m_chainBitSetIndex=-1,this.m_chainBitSets.length=0)}dbgPrintEdge_(e){}dbgVerifyEdgeSegment(e){}}eg.c_EdgeParentageMask=0x7fffffff,eg.c_EdgeBitMask=-0x80000000;class eu{freeNode_(e){this.m_listNodes.deleteElement(e)}newNode_(){return this.m_listNodes.newElement()}freeList_(e){this.m_lists.deleteElement(e)}newList_(){return this.m_lists.newElement()}Init_(e){(0,S.g)(0)}constructor(e){this.m_listNodes=new I.S(2),this.m_listOfLists=eu.st_nullNode(),this.m_bAllowNavigationBetweenLists=!0,void 0===e&&(e=!0),this.m_bAllowNavigationBetweenLists=e,this.m_lists=new I.S(this.m_bAllowNavigationBetweenLists?4:2)}createList(){let e=this.newList_();return this.m_bAllowNavigationBetweenLists&&(this.m_lists.setField(e,3,this.m_listOfLists),this.m_listOfLists!==eu.st_nullNode()&&this.m_lists.setField(this.m_listOfLists,2,e),this.m_listOfLists=e),e}deleteList(e){let t=this.getFirst(e);for(;t!==eu.st_nullNode();){let e=t;t=this.getNext(t),this.freeNode_(e)}if(this.m_bAllowNavigationBetweenLists){let t=this.m_lists.getField(e,2),s=this.m_lists.getField(e,3);t!==eu.st_nullNode()?this.m_lists.setField(t,3,s):this.m_listOfLists=s,s!==eu.st_nullNode()&&this.m_lists.setField(s,2,t)}this.freeList_(e)}reserveLists(e){this.m_lists.setCapacity(e)}addElement(e,t){this.m_lists.getField(e,0);let s=this.m_lists.getField(e,1),r=this.newNode_();return s!==eu.st_nullNode()?this.m_listNodes.setField(s,1,r):this.m_lists.setField(e,0,r),this.m_lists.setField(e,1,r),this.m_listNodes.setField(r,0,t),r}reserveNodes(e){this.m_listNodes.setCapacity(e)}deleteElementDirect(e,t,s){t!==eu.st_nullNode()?(this.m_listNodes.setField(t,1,this.m_listNodes.getField(s,1)),this.m_lists.getField(e,1)===s&&this.m_lists.setField(e,1,t)):(this.m_lists.setField(e,0,this.m_listNodes.getField(s,1)),this.m_lists.getField(e,1)===s&&this.m_lists.setField(e,1,eu.st_nullNode())),this.freeNode_(s)}deleteElementSearch(e,t){let s=-1,r=this.getFirst(e);for(;r!==t;)s=r,r=this.getNext(r);this.deleteElementDirect(e,s,t)}concatenateLists(e,t){let s=this.m_lists.getField(e,1),r=this.m_lists.getField(t,0);if(r!==eu.st_nullNode()&&(s!==eu.st_nullNode()?this.m_listNodes.setField(s,1,r):this.m_lists.setField(e,0,r),this.m_lists.setField(e,1,this.m_lists.getField(t,1))),this.m_bAllowNavigationBetweenLists){let e=this.m_lists.getField(t,2),s=this.m_lists.getField(t,3);e!==eu.st_nullNode()?this.m_lists.setField(e,3,s):this.m_listOfLists=s,s!==eu.st_nullNode()&&this.m_lists.setField(s,2,e)}return this.freeList_(t),e}getElement(e){return this.m_listNodes.getField(e,0)}getData(e){return this.getElement(e)}setElement(e,t){(0,S.g)(0)}getNext(e){return this.m_listNodes.getField(e,1)}getFirst(e){return this.m_lists.getField(e,0)}getFirstElement(e){let t=this.getFirst(e);return this.getElement(t)}static st_nullNode(){return -1}clear(){this.m_listNodes.deleteAll(!0),this.m_lists.deleteAll(!0),this.m_listOfLists=eu.st_nullNode()}isEmpty(e){return(0,S.g)(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getFirstList(){return this.m_listOfLists}getNextList(e){return this.m_lists.getField(e,3)}}function e_(e=-1){return{m_value:e,m_line:new C.L,m_segment:null,m_segmentInfo:new C.a8(-1),m_env:new b.E(0,0),m_dxdy:0x34fb5e3,m_bHorizontal:!1,m_bCurve:!1}}class ed extends I.a6{constructor(e,t,s){super(!0),this.m_bIntersectionDetected=!1,this.m_nonSimpleResult=new F,this.m_tempSimpleEdge1=e_(),this.m_tempSimpleEdge2=e_(),this.m_prev1=C.n,this.m_prev2=C.n,this.m_vertex1=C.n,this.m_vertex2=C.n,this.m_currentNode=-1,this.m_prevX1=Number.NaN,this.m_prevX2=Number.NaN,this.m_prevY=Number.NaN,this.m_prevX=0,this.m_sweepY=Number.NaN,this.m_sweepX=0,this.m_ptSweep=new b.P,this.m_simpleEdgesCache=[],this.m_simpleEdgesRecycle=[],this.m_cOutstandingConstructedEdges=0,this.m_shape=e,this.m_bShapeHasSegments=this.m_shape.hasCurves(),this.m_tolerance=t,this.m_tolerance10=10*t,this.m_bIsSimple=s;let r=Math.min(7,Math.trunc(Math.min(3*e.getTotalPointCount()/2,67)));this.m_simpleEdgesCache.length=r}tryGetCachedEdge_(e){let t=this.m_simpleEdgesCache[(e&(0,b.j)())%this.m_simpleEdgesCache.length];return t&&t.m_value===e?t:null}tryDeleteCachedEdge_(e){let t=(e&(0,b.j)())%this.m_simpleEdgesCache.length,s=this.m_simpleEdgesCache[t];s&&s.m_value===e&&(this.m_simpleEdgesRecycle.push(s),this.m_simpleEdgesCache[t]=null)}tryCreateCachedEdge_(e){let t=(e&(0,b.j)())%this.m_simpleEdgesCache.length,s=this.m_simpleEdgesCache[t];return s?null:(0===this.m_simpleEdgesRecycle.length?(s=e_(),this.m_cOutstandingConstructedEdges++):s=this.m_simpleEdgesRecycle.pop(),s.m_value=e,this.m_simpleEdgesCache[t]=s,s)}initSimpleEdge_(e,t){this.m_bShapeHasSegments&&this.initSimpleEdgeHelper_(e,t)||e.m_bCurve||(this.m_shape.queryLineConnector(t,e.m_line,!0),e.m_segment=e.m_line,e.m_env.setCoordsNoNAN(e.m_line.getStartX(),e.m_line.getEndX()),e.m_env.vmax+=this.m_tolerance,e.m_line.orientBottomUp(),e.m_bHorizontal=e.m_line.getEndY()===e.m_line.getStartY(),e.m_bHorizontal||(e.m_dxdy=(e.m_line.getEndX()-e.m_line.getStartX())/(e.m_line.getEndY()-e.m_line.getStartY())))}initSimpleEdgeHelper_(e,t){if(e.m_segment=this.m_shape.getSegment(t),e.m_segmentInfo=this.m_shape.getOriginalSegmentInfo(t),e.m_bCurve=null!==e.m_segment,e.m_bCurve){let t=e.m_segment.clone();return t.orientBottomUp(),e.m_segment=t,e.m_env=e.m_segment.queryInterval(0,0),e.m_env.vmax+=this.m_tolerance,!0}return!1}compareTwoSegments_(e,t){let s=e.getStartXY(),r=e.getEndXY(),i=t.getStartXY(),n=t.getEndXY();if(this.m_ptSweep.setCoords(this.m_sweepX,this.m_sweepY),s.isEqualPoint2D(i)&&this.m_sweepY===s.y){this.m_ptSweep.assign(0>r.compare(n)?r:n);let s=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),i=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x);if(Math.abs(s-i)>this.m_tolerance)return s<i?-1:1}let a=0>s.compare(i)?i:s,o=0>r.compare(n)?r:n,h=0,l=0;for(let s=1;s<5;s++){(0,b.Z)(a,o,s/5,this.m_ptSweep);let r=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),i=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),n=Math.abs(r-i);n>h&&(h=n,l=r<i?-1:1)}return 0===l?this.errorCracking():l}compareNonHorizontal_(e,t){if(e.m_line.getStartY()===t.m_line.getStartY()&&e.m_line.getStartX()===t.m_line.getStartX())return e.m_line.getEndY()===t.m_line.getEndY()&&e.m_line.getEndX()===t.m_line.getEndX()?this.m_bIsSimple?this.errorCoincident():0:this.compareNonHorizontalUpperEnd_(e,t);if(e.m_line.getEndY()===t.m_line.getEndY()&&e.m_line.getEndX()===t.m_line.getEndX())return this.compareNonHorizontalLowerEnd_(e,t);let s=this.compareNonHorizontalLowerEnd_(e,t),r=this.compareNonHorizontalUpperEnd_(e,t);return s<0&&r<0?-1:s>0&&r>0?1:this.errorCracking()}compareHorizontal1Case1_(e,t){if(e.getEndX()>t.getEndX()){if(t.getEndX()>t.getStartX()&&t.getEndY()-t.getStartY()<2*this.m_tolerance&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((t.getEndY()-t.getStartY())/(t.getEndX()-t.getStartX())*(e.getEndX()-e.getStartX())<this.m_tolerance10&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return 1}compareHorizontal1Case2_(e,t){if(e.getStartX()<t.getStartX()){if(t.getEndX()>t.getStartX()&&t.getEndY()-t.getStartY()<2*this.m_tolerance&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((t.getEndY()-t.getStartY())/(t.getEndX()-t.getStartX())*(e.getStartX()-e.getEndX())<this.m_tolerance10&&t.isIntersectingPoint(e.getStartXY(),this.m_tolerance,!0))return this.errorCracking();return -1}compareHorizontal1Case3_(e,t){let s=b.P.getNAN();s.setSub(t.getEndXY(),t.getStartXY()),s.rightPerpendicularThis(),s.normalize();let r=b.P.getNAN();r.setSub(e.getStartXY(),t.getStartXY());let i=b.P.getNAN();i.setSub(e.getEndXY(),t.getStartXY());let n=r.dotProduct(s),a=i.dotProduct(s),o=Math.abs(n),h=Math.abs(a);if(o<h){if(o<this.m_tolerance10&&t.isIntersectingPoint(e.getStartXY(),this.m_tolerance,!0))return this.errorCracking()}else if(h<this.m_tolerance10&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return n<0&&a<0?-1:n>0&&a>0?1:this.errorCracking()}compareHorizontal1_(e,t){return e.getStartY()===t.getStartY()&&e.getStartX()===t.getStartX()?this.compareHorizontal1Case1_(e,t):e.getEndY()===t.getEndY()&&e.getEndX()===t.getEndX()?this.compareHorizontal1Case2_(e,t):this.compareHorizontal1Case3_(e,t)}compareHorizontal2_(e,t){return e.getEndY()===t.getEndY()&&e.getEndX()===t.getEndX()&&e.getStartY()===t.getStartY()&&e.getStartX()===t.getStartX()?this.m_bIsSimple?this.errorCoincident():0:this.errorCracking()}compareNonHorizontalLowerEnd_(e,t){let s=1;if(e.m_line.getStartY()<t.m_line.getStartY()){s=-1;let r=e;e=t,t=r}let r=e.m_line,i=t.m_line,n=r.getStartX()-i.getStartX(),a=t.m_dxdy*(r.getStartY()-i.getStartY()),o=this.m_tolerance10;return n<a-o?-s:n>a+o?s:i.isIntersectingPoint(r.getStartXY(),this.m_tolerance,!0)?this.errorCracking():n<a?-s:s}compareNonHorizontalUpperEnd_(e,t){let s=1;if(t.m_line.getEndY()<e.m_line.getEndY()){s=-1;let r=e;e=t,t=r}let r=e.m_line,i=t.m_line,n=r.getEndX()-i.getStartX(),a=t.m_dxdy*(r.getEndY()-i.getStartY()),o=this.m_tolerance10;return n<a-o?-s:n>a+o?s:i.isIntersectingPoint(r.getEndXY(),this.m_tolerance,!0)?this.errorCracking():n<a?-s:s}errorCoincident(){return this.m_bIntersectionDetected=!0,this.m_nonSimpleResult=new F(7,this.m_vertex1,this.m_vertex2),-1}errorCracking(){return(this.m_bIntersectionDetected=!0,this.m_bIsSimple)?this.m_nonSimpleResult=new F(6,this.m_vertex1,this.m_vertex2):(this.m_prev1=C.n,this.m_prev2=C.n,this.m_vertex1=C.n,this.m_vertex2=C.n),-1}compareSegments_(e,t,s,r){let i,n;if(s.m_env.vmax<r.m_env.vmin)return -1;if(r.m_env.vmax<s.m_env.vmin)return 1;if(!s.m_bCurve&&!r.m_bCurve){let e=+!!s.m_bHorizontal;return 0==(e|=2*!!r.m_bHorizontal)?this.compareNonHorizontal_(s,r):1===e?this.compareHorizontal1_(s.m_line,r.m_line):2===e?-1*this.compareHorizontal1_(r.m_line,s.m_line):this.compareHorizontal2_(s.m_line,r.m_line)}if(this.m_bIntersectionDetected)return -1;let a=this.m_prevY===this.m_sweepY&&this.m_prevX===this.m_sweepX;if(a&&e===this.m_prev1?i=this.m_prevX1:(i=Number.NaN,this.m_prev1=C.n),a&&t===this.m_prev2?n=this.m_prevX2:(n=Number.NaN,this.m_prev2=C.n),this.m_prevY=this.m_sweepY,this.m_prevX=this.m_sweepX,Number.isNaN(i)){this.m_prev1=e;let t=s.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);i=t,this.m_prevX1=t}if(Number.isNaN(n)){this.m_prev2=t;let e=r.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);n=e,this.m_prevX2=e}let o=(0,C.a2)(!0,!0,s.m_segment,r.m_segment,this.m_tolerance,!0);return 0!==o?2===o?this.m_bIsSimple?this.errorCoincident():s.m_segmentInfo.equals(r.m_segmentInfo)?0:this.errorCracking():this.errorCracking():Math.abs(i-n)<=this.m_tolerance?this.compareTwoSegments_(s.m_segment,r.m_segment):i<n?-1:+(i>n)}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1}intersectionDetected(){return this.m_bIntersectionDetected}getLastComparedNode(){return this.m_currentNode}getResult(){return this.m_nonSimpleResult}setSweepY(e,t){this.m_sweepY=e,this.m_sweepX=t,this.m_prev1=C.n,this.m_prev2=C.n,this.m_vertex1=C.n,this.m_vertex2=C.n}compare(e,t,s){if(this.m_bIntersectionDetected)return -1;let r=e.getElement(s);return this.m_currentNode=s,this.compareSegments(t,t,r,r)}compareSegments(e,t,s,r){let i=this.tryGetCachedEdge_(e);null===i?this.m_vertex1===t?i=this.m_tempSimpleEdge1:(this.m_vertex1=t,null===(i=this.tryCreateCachedEdge_(e))&&(i=this.m_tempSimpleEdge1,this.m_tempSimpleEdge1.m_value=e),this.initSimpleEdge_(i,t)):this.m_vertex1=t;let n=this.tryGetCachedEdge_(s);return null===n?this.m_vertex2===r?n=this.m_tempSimpleEdge2:(this.m_vertex2=r,null===(n=this.tryCreateCachedEdge_(s))&&(n=this.m_tempSimpleEdge2,this.m_tempSimpleEdge2.m_value=s),this.initSimpleEdge_(n,r)):this.m_vertex2=r,this.compareSegments_(t,r,i,n)}onDelete(e){this.tryDeleteCachedEdge_(e)}onSet(e){this.tryDeleteCachedEdge_(e)}onEndSearch(e){this.tryDeleteCachedEdge_(e)}onAddUniqueElementFailed(e){this.tryDeleteCachedEdge_(e)}}class ep{constructor(e,t){this.m_bIntersectionDetected=!1,this.m_pointOfInterest=b.P.getNAN(),this.m_line1=new C.L,this.m_seg1=null,this.m_env=b.E.constructEmpty(),this.m_vertex1=-1,this.m_currentNode=-1,this.m_minDist=Number.MAX_VALUE,this.m_shape=e,this.m_tolerance=t}getCurrentNode(){return this.m_currentNode}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1,this.m_minDist=Number.MAX_VALUE}intersectionDetected(){return this.m_bIntersectionDetected}setPoint(e){this.m_pointOfInterest.assign(e)}compare(e,t){let s=e.getElement(t);return this.compareVertex(e,t,s)}compareVertex(e,t,s){let r,i=this.m_shape.getSegment(s),n=!0;if(null==i)this.m_shape.queryLineConnector(s,this.m_line1,!0),this.m_env.setCoordsNoNAN(this.m_line1.getStartX(),this.m_line1.getEndX()),i=this.m_line1,r=this.m_line1.getStartY()===this.m_line1.getEndY();else{let e=E.J.constructEmpty();i.queryLooseEnvelope(e),e.queryIntervalX(this.m_env),r=0===e.height(),n=!1}if(this.m_pointOfInterest.x+this.m_tolerance<this.m_env.vmin)return -1;if(this.m_pointOfInterest.x-this.m_tolerance>this.m_env.vmax)return 1;if(r)return this.m_currentNode=t,this.m_bIntersectionDetected=!0,0;let a=0;if(n){(0,C.a4)(this.m_line1);let e=this.m_line1.getStartXY(),t=new b.P;t.setSub(this.m_line1.getEndXY(),e),t.rightPerpendicularThis();let s=new b.P;s.setSub(this.m_pointOfInterest,e),a=t.dotProduct(s)/t.length()}else a=i.intersectionOfYMonotonicWithAxisX(this.m_pointOfInterest.y,this.m_pointOfInterest.x)-this.m_pointOfInterest.x;return a<-(10*this.m_tolerance)?-1:a>10*this.m_tolerance?1:(i.isIntersectingPoint(this.m_pointOfInterest,this.m_tolerance)&&(Math.abs(a)<this.m_minDist&&(this.m_currentNode=t,this.m_minDist=a),this.m_bIntersectionDetected=!0),a<0?-1:+(a>0))}}class ec{constructor(e,t){this.m_lists=new eu(!1),this.m_hash=t,this.m_hashBuckets=new Int32Array(e),this.m_hashBuckets.fill(ec.st_nullNode()),this.m_bitFilter=new Int32Array(10*e+31>>5)}reserveElements(e){this.m_lists.reserveLists(Math.min(this.m_hashBuckets.length,e)),this.m_lists.reserveNodes(e)}addElement(e,t){void 0===t&&(t=this.m_hash.getHash(e));let s=t%(this.m_bitFilter.length<<5);this.m_bitFilter[s>>5]|=1<<(31&s);let r=t%this.m_hashBuckets.length,i=this.m_hashBuckets[r];return i===eu.st_nullNode()&&(i=this.m_lists.createList(),this.m_hashBuckets[r]=i),this.m_lists.addElement(i,e)}deleteElement(e,t){void 0===t&&(t=this.m_hash.getHash(e));let s=t%this.m_hashBuckets.length,r=this.m_hashBuckets[s];r===eu.st_nullNode()&&(0,S.t)("");let i=this.m_lists.getFirst(r),n=eu.st_nullNode();for(;i!==eu.st_nullNode();){let t=this.m_lists.getData(i),a=this.m_lists.getNext(i);t===e?(this.m_lists.deleteElementDirect(r,n,i),this.m_lists.getFirst(r)===eu.st_nullNode()&&(this.m_lists.deleteList(r),this.m_hashBuckets[s]=eu.st_nullNode())):n=i,i=a}}getFirstInBucket(e){let t=e%(this.m_bitFilter.length<<5);if(!(this.m_bitFilter[t>>5]&1<<(31&t)))return eu.st_nullNode();let s=e%this.m_hashBuckets.length,r=this.m_hashBuckets[s];return r===eu.st_nullNode()?eu.st_nullNode():this.m_lists.getFirst(r)}getNextInBucket(e){return this.m_lists.getNext(e)}findNode(e){let t=this.m_hash.getHash(e),s=this.getFirstInBucket(t);for(;s!==eu.st_nullNode();){let t=this.m_lists.getData(s);if(this.m_hash.equal(t,e))return s;s=this.m_lists.getNext(s)}return eu.st_nullNode()}deleteNode(e){let t=this.getElement(e),s=this.m_hash.getHash(t)%this.m_hashBuckets.length,r=this.m_hashBuckets[s];r===eu.st_nullNode()&&(0,S.t)(""),this.m_lists.deleteElementSearch(r,e),this.m_lists.getFirst(r)===eu.st_nullNode()&&(this.m_lists.deleteList(r),this.m_hashBuckets[s]=eu.st_nullNode())}getElement(e){return this.m_lists.getData(e)}static st_nullNode(){return eu.st_nullNode()}clear(){(0,S.g)(0)}size(){return this.m_lists.getNodeCount()}dbgPrintBucketHistogram(){}}function ef(e,t,s,r,i){let n=new eS(i);return n.m_shape=e,n.m_sqrTolerance=t*t,n.m_cellSize=2*t,n.m_invCellSize=1/n.m_cellSize,n.m_geometry=s,n.m_bTrackChanges=r,n.m_bHasSegmentParentage=e.hasSegmentParentage(),n.clusterNonReciprocal()}function ex(e,t,s,r,i){let n=e-s,a=t-r;return n*n+a*a<=i}function eP(e,t,s,r,i,n){let a={pt:new b.P,weight:0,rank:0,bMerged:!1},o=s+i,h=!1,l=e.x;e.x!==t.x&&(r===n&&(l=(e.x*s+t.x*i)/o),h=!0);let m=e.y;return e.y!==t.y&&(r===n&&(m=(e.y*s+t.y*i)/o),h=!0),r!==n?r>n?(a.rank=r,a.weight=s,a.pt=e):(a.rank=n,a.weight=i,a.pt=t):(a.pt.setCoords(l,m),a.weight=o,a.rank=r),a.bMerged=h,a}function ey(e,t){let s=(0,b.aH)(e);return(0,b.aG)(s,t)}class eE{constructor(e,t,s,r,i){this.m_workPt=new b.P,this.m_shape=e,this.m_sqrTolerance=s,this.m_invCellSize=r,this.m_origin=t.clone(),this.m_hashValues=i}getHash(e){return this.m_shape.getUserIndex(e,this.m_hashValues)}calculateHashFromVertex(e){return this.m_shape.queryXY(e,this.m_workPt),ey(Math.trunc((this.m_workPt.x-this.m_origin.x)*this.m_invCellSize+.5),Math.trunc((this.m_workPt.y-this.m_origin.y)*this.m_invCellSize+.5))}equal(e,t){return(0,S.g)(0),!1}}class eS{constructor(e){this.m_origin=b.P.getNAN(),this.m_sqrTolerance=0,this.m_cellSize=0,this.m_invCellSize=0,this.m_geometry=C.n,this.m_bucketArray=(0,b.d)(4,Number.NaN),this.m_bucketHash=(0,b.d)(4,Number.NaN),this.m_dbgCandidateCheckCount=0,this.m_nsr=new F,this.m_hashValues=-1,this.m_newClusters=-1,this.m_bTrackChanges=!1,this.m_bHasSegmentParentage=!1,this.m_shape=null,this.m_clusters=new eu,this.m_hashFunction=null,this.m_hashTable=null,this.m_progressCounter=0,this.m_progressTracker=e}progress_(){}collectClusterCandidates(e,t){let s=b.P.getNAN();this.m_shape.queryXY(e,s);let r=(s.x-this.m_origin.x)*this.m_invCellSize,i=(s.y-this.m_origin.y)*this.m_invCellSize,n=Math.trunc(r),a=Math.trunc(i),o=0;for(let e=0;e<=1;e+=1)for(let t=0;t<=1;t+=1){let s=ey(n+e,a+t),r=this.m_hashTable.getFirstInBucket(s);r!==ec.st_nullNode()&&(this.m_bucketArray[o]=r,this.m_bucketHash[o]=s,o++)}for(let e=o-1;e>=1;e--){let t=this.m_bucketArray[e];for(let s=e-1;s>=0;s--)if(t===this.m_bucketArray[s]){this.m_bucketHash[s]=-1,e!==--o&&(this.m_bucketHash[e]=this.m_bucketHash[o],this.m_bucketArray[e]=this.m_bucketArray[o]);break}}for(let r=0;r<o;r++)this.collectNearestNeighbourCandidates(e,this.m_bucketHash[r],s,this.m_bucketArray[r],t)}collectNearestNeighbourCandidates(e,t,s,r,i){let n=b.P.getNAN();for(let a=r;a!==ec.st_nullNode();a=this.m_hashTable.getNextInBucket(a)){let r=this.m_hashTable.getElement(a);e===r||-1!==t&&this.m_shape.getUserIndex(r,this.m_hashValues)!==t||(this.m_shape.queryXY(r,n),ex(s.x,s.y,n.x,n.y,this.m_sqrTolerance)&&i.push(a))}}mergeClusters(e,t,s){let r=this.m_shape.getUserIndex(e,this.m_newClusters),i=this.m_shape.getUserIndex(t,this.m_newClusters);-1===r&&(r=this.m_clusters.createList(),this.m_clusters.addElement(r,e),this.m_shape.setUserIndex(e,this.m_newClusters,r)),-1===i?this.m_clusters.addElement(r,t):this.m_clusters.concatenateLists(r,i),this.m_shape.setUserIndex(t,this.m_newClusters,I.S.impossibleIndex2());let n=this.mergeVertices(e,t);if(s){let t=this.m_hashFunction.calculateHashFromVertex(e);this.m_shape.setUserIndex(e,this.m_hashValues,t)}return n}mergeVertices(e,t){let s=b.P.getNAN();this.m_shape.queryXY(e,s);let r=b.P.getNAN();this.m_shape.queryXY(t,r);let i=this.m_shape.getRank(e),n=this.m_shape.getRank(t),a=this.m_shape.getWeight(e),o=this.m_shape.getWeight(t),h,l,m,g,u=!1;if(i===n?(h=i,l=a+o,m=s.x,s.x!==r.x&&(m=(s.x*a+r.x*o)/l,u=!0),g=s.y,s.y!==r.y&&(g=(s.y*a+r.y*o)/l,u=!0)):(i>n?(m=s.x,g=s.y,l=a,h=i):(m=r.x,g=r.y,l=o,h=n),u=!s.equals(r)),u&&(this.m_shape.setXYMonotonic(e,m,g),this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(e,!0),this.m_bHasSegmentParentage)){let s=this.m_shape.getSegmentParentageBreakVertex(e)||this.m_shape.getSegmentParentageBreakVertex(t);this.m_shape.setSegmentParentageBreakVertex(e,s),this.m_shape.setSegmentParentageBreakVertex(t,s)}return this.m_shape.setWeight(e,l),this.m_shape.setRank(e,h),u}needsClustering(){let e={stack:[],error:void 0,hasError:!1};try{(0,v.b)(e,(0,b.h)(()=>{this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters)}),!1);let t=this.m_shape.getSelectedCount(),s=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin.assign(s.getLowerLeft());let r=Math.max(s.height(),s.width())/((0,b.i)()-1);this.m_cellSize<r&&(this.m_cellSize=r,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(this.m_shape.getSelectedCount()/3+1),this.m_clusters.reserveNodes(this.m_shape.getSelectedCount()/3+1),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new eE(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new ec(4*t/3,this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let i=!1;for(let e=0;e<2;e++){let t=[],s=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let r=s.next();r!==C.n;r=s.next()){let s;if(this.progress_(),!(e>0)||this.m_shape.getUserIndex(r,this.m_newClusters)!==I.S.impossibleIndex2()){if(0===e?(s=this.m_hashFunction.calculateHashFromVertex(r),this.m_shape.setUserIndex(r,this.m_hashValues,s)):s=this.m_shape.getUserIndex(r,this.m_hashValues),this.collectClusterCandidates(r,t),0!==t.length){for(let e=0,s=t.length;e<s;e++){this.progress_();let s=t[e],n=this.m_hashTable.getElement(s);if(this.m_hashTable.deleteNode(s),!this.m_shape.isEqualXY(r,n))return this.m_nsr=new F(5,this.m_shape.getVertexIndex(r),this.m_shape.getVertexIndex(n)),i=!0;this.mergeClusters(r,n,!1)}t.length=0}0===e&&this.m_hashTable.addElement(r,s)}}}return i}catch(t){e.error=t,e.hasError=!0}finally{(0,v.c)(e)}}clusterNonReciprocal(){let e=this.m_shape.getSelectedCount(),t=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin=t.getLowerLeft();let s=Math.max(t.height(),t.width())/((0,b.i)()-1);this.m_cellSize<s&&(this.m_cellSize=s,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_clusters.reserveNodes(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new eE(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new ec(Math.trunc(4*e/3),this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let r=!1;{let e=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let t=e.next();t!==C.n;t=e.next()){this.progress_();let e=this.m_hashFunction.calculateHashFromVertex(t);this.m_shape.setUserIndex(t,this.m_hashValues,e),this.m_hashTable.addElement(t,e)}}{let e=[],t=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let s=t.next();s!==C.n;s=t.next()){if(this.m_shape.getUserIndex(s,this.m_newClusters)===I.S.impossibleIndex2())continue;let t=this.m_shape.getUserIndex(s,this.m_hashValues);this.m_hashTable.deleteElement(s,t);let i=!1;for(;this.collectClusterCandidates(s,e),0!==e.length;){let t=0;for(let r=0,i=e.length;r<i;r++){this.progress_();let n=e[r],a=this.m_hashTable.getElement(n);this.m_hashTable.deleteNode(n);let o=r+1===i;t|=!!this.mergeClusters(s,a,o)}if(i||=0!==t,r||=0!==t,e.length=0,!t)break}i&&(t=this.m_shape.getUserIndex(s,this.m_hashValues)),this.m_hashTable.addElement(s,t)}e.length=0}return r&&this.applyClusterPositions_(),this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters),r}applyClusterPositions_(){let e=b.P.getNAN();for(let t=this.m_clusters.getFirstList();t!==eu.st_nullNode();t=this.m_clusters.getNextList(t)){let s=this.m_clusters.getFirst(t),r=this.m_clusters.getElement(s);this.m_shape.queryXY(r,e);let i=this.m_shape.getRank(r),n=this.m_shape.getWeight(r);for(s=this.m_clusters.getNext(s);s!==eu.st_nullNode();s=this.m_clusters.getNext(s)){let t=this.m_clusters.getElement(s);if(this.m_bTrackChanges?this.m_shape.isEqualXYPoint2D(t,e)||(this.m_shape.setXYMonotonicPoint2D(t,e),this.m_shape.setGeometryModifiedWithVertex(t,!0)):this.m_shape.setXYMonotonicPoint2D(t,e),this.m_bHasSegmentParentage){let e=this.m_shape.getSegmentParentageBreakVertex(r)||this.m_shape.getSegmentParentageBreakVertex(t);this.m_shape.setSegmentParentageBreakVertex(r,e),this.m_shape.setSegmentParentageBreakVertex(t,e)}this.m_shape.setWeight(t,n),this.m_shape.setRank(t,i)}}}}class eC{constructor(){this.m_inputParts=[],this.m_resultParts1=[],this.m_resultParts2=[],this.m_resultSegments=[],this.m_freeSegments=[],this.m_inputSegments=[],this.m_param1=[],this.m_param2=[],this.m_tolerance=0,this.m_toleranceZ=0,this.m_point=new I.P,this.m_pointWeight=1,this.m_maxDensifyLimit=0,this.m_pointRank=0,this.m_changed1=!1,this.m_changed2=!1,this.m_adaptiveDensify=!1}clear(){this.freeAllResultSegments(),this.m_inputSegments.length=0,this.m_inputParts.length=0,this.m_resultParts1.length=0,this.m_resultParts2.length=0,this.m_param1.length=0,this.m_param2.length=0,this.m_adaptiveDensify=!1,this.m_changed1=!1,this.m_changed2=!1}newIntersectionPart_(e,t,s,r,i,n,a,o,h,l){return{segmentIndex:e,weightStart:t,rankStart:s,weightEnd:r,rankEnd:i,weightInterior:n,rankInterior:a,segmentParentage:l,u:{bBigMoveStart:!1,bBigMoveEnd:!1,bBreakStart:o,bBreakEnd:h}}}pushSegment(e,t,s,r,i,n,a,o,h,l){return this.m_inputParts.push(this.newIntersectionPart_(this.m_inputSegments.length,t,s,r,i,n,a,o,h,l)),this.m_inputSegments.push(e),this.m_inputParts.length-1}getResultSegmentCount(e){return this.m_adaptiveDensify?0===e?this.m_param1.length-1:this.m_param2.length-1:0===e?this.m_resultParts1.length:this.m_resultParts2.length}getResultPart_(e,t){return 0===e?this.m_resultParts1[t]:this.m_resultParts2[t]}getResultSegment(e,t){return this.m_resultSegments[this.getResultPart_(e,t).segmentIndex].get()}getSegmentChanged(e){return 0===e?this.m_changed1:this.m_changed2}getResultSegmentStartPointWeight(e,t){return this.getResultPart_(e,t).weightStart}getResultSegmentStartPointRank(e,t){return this.getResultPart_(e,t).rankStart}getResultSegmentSegmentParentage(e,t){return this.getResultPart_(e,t).segmentParentage}getResultSegmentStartPointIsBreak(e,t){return this.getResultPart_(e,t).u.bBreakStart}getResultSegmentEndPointWeight(e,t){return this.getResultPart_(e,t).weightEnd}getResultSegmentEndPointRank(e,t){return this.getResultPart_(e,t).rankEnd}getResultSegmentEndPointIsBreak(e,t){return this.getResultPart_(e,t).u.bBreakEnd}getResultSegmentInteriorRank(e,t){return this.getResultPart_(e,t).rankInterior}getResultSegmentInteriorWeight(e,t){return this.getResultPart_(e,t).weightInterior}getResultPoint(){return this.m_point}getResultPointWeight(){return this.m_pointWeight}getResultPointRank(){return this.m_pointRank}getResultPointChanged(){return this.m_changed2}intersectLines(e,t){2!==this.m_inputSegments.length&&(0,S.c)(""),this.m_changed1=!1,this.m_changed2=!1,this.m_tolerance=e;let s=(0,b.s)(e*eC.c_smallToleranceFactor),r=!1,i=this.m_inputParts[0],n=this.m_inputParts[1],a=this.m_inputSegments[i.segmentIndex],o=this.m_inputSegments[n.segmentIndex];if(t||5&(0,C._)(!0,a,o,e,!0)){let t=(0,C.a0)(!0,a,o,null,this.m_param1,this.m_param2,e);0===t&&(0,S.c)("");let h=Array(t);for(let e=0;e<t;++e)h[e]=b.P.getNAN();let l=new Float64Array(t),m=new Int32Array(t),g=Array(t),u=Array(t);for(let e=0;e<t;++e)g[e]=eI(),u[e]=eI();for(let e=0;e<t;e++){let t=this.m_param1[e],_=this.m_param2[e],d,p=i.rankInterior,c=i.weightInterior;0===t?(p=i.rankStart,c=i.weightStart,d=i.u.bBreakStart):1===t?(p=i.rankEnd,c=i.weightEnd,d=i.u.bBreakEnd):(this.m_changed1=!0,d=!1);let f,x=n.rankInterior,P=n.weightInterior;0===_?(x=n.rankStart,P=n.weightStart,f=n.u.bBreakStart):1===_?(x=n.rankEnd,P=n.weightEnd,f=n.u.bBreakEnd):(this.m_changed2=!0,f=!1);let y=p,E=x,S=1,C=0,I=b.P.getNAN();if(y===E){let r=a.getCoord2D(t),i=o.getCoord2D(_);S=c+P,C=p,(0,b.Z)(r,i,P/S,I);let n=b.P.sqrDistance(I,r),h=b.P.sqrDistance(I,i);g[e].bBigMove=n>s,u[e].bBigMove=h>s,this.m_changed1||r.equals(I)||(this.m_changed1=!0),this.m_changed2||i.equals(I)||(this.m_changed2=!0)}else if(y>E){I=a.getCoord2D(t);let r=o.getCoord2D(_);S=c,C=p;let i=b.P.sqrDistance(I,r);g[e].bBigMove=!1,u[e].bBigMove=i>s,this.m_changed2||r.equals(I)||(this.m_changed2=!0)}else{I=o.getCoord2D(_),S=P,C=x;let r=a.getCoord2D(t),i=b.P.sqrDistance(I,r);g[e].bBigMove=i>s,u[e].bBigMove=!1,this.m_changed1||r.equals(I)||(this.m_changed1=!0)}h[e].assign(I),l[e]=S,m[e]=C,g[e].bIsBreak=d||f,u[e].bIsBreak=d||f,r||=g[e].bBigMove||u[e].bBigMove}let _=i.rankInterior,d=i.weightInterior,p=0,c=-1;for(let s=0;s<=t;s++){let r=s<t?this.m_param1[s]:1;if(r!==p){let n,o,u,f,x=this.allocResultSegment(),P=this.m_resultSegments[x];a.queryCut(p,r,P,!1),P.get().snapControlPoints(e*e);let y=!1,E=!1,S=!1,C=!1,I=!1,v=b.P.getNAN(),G=b.P.getNAN();-1!==c?(o=m[c],n=l[c],y=g[c].bBigMove,v.assign(h[c]),S=g[c].bIsBreak,I=!0):(n=i.weightStart,o=i.rankStart,v=P.get().getStartXY(),S=i.u.bBreakStart),s<t?(f=m[s],u=l[s],E=g[s].bBigMove,G.assign(h[s]),C=g[s].bIsBreak,I=!0):(u=i.weightEnd,f=i.rankEnd,G=P.get().getEndXY(),C=i.u.bBreakEnd),I&&P.get().setCoordsForIntersector(v,G,!0),this.m_resultParts1.push(this.newIntersectionPart_(x,n,o,u,f,d,_,S,C,i.segmentParentage));let w=this.m_resultParts1.at(-1);w.u.bBigMoveStart=y,w.u.bBigMoveEnd=E,p=r,c=s}else -1===c&&(c=s)}let f=(0,b.d)(t,0);for(let e=0;e<t;e++)f[e]=e;t>2?(f.sort((e,t)=>this.m_param2[e]<this.m_param2[t]?-1:+(this.m_param2[e]>this.m_param2[t])),(0,b.v)(this.m_param2)):2===t&&this.m_param2[0]>this.m_param2[1]&&(this.m_param2[1]=(0,b.b)(this.m_param2[0],this.m_param2[0]=this.m_param2[1]),f[1]=(0,b.b)(f[0],f[0]=f[1]));let x=n.rankInterior,P=n.weightInterior;p=0,c=-1;for(let s=0;s<=t;s++){let r=s<t?this.m_param2[s]:1;if(r!==p){let i,a,g,_,d=this.allocResultSegment(),y=this.m_resultSegments[d];o.queryCut(p,r,y,!1),y.get().snapControlPoints(e*e);let E=b.P.getNAN(),S=b.P.getNAN(),C=!1,I=!1,v=!1,G=!1,w=!1;if(-1!==c){let e=f[c];i=l[e],a=m[e],E.assign(h[e]),v=u[e].bBigMove,C=u[e].bIsBreak,w=!0}else i=n.weightStart,a=n.rankStart,E=y.get().getStartXY(),C=n.u.bBreakStart;if(s!==t){let e=f[s];g=l[e],_=m[e],S.assign(h[e]),G=u[e].bBigMove,I=u[e].bIsBreak,w=!0}else g=n.weightEnd,_=n.rankEnd,S=y.get().getEndXY(),I=n.u.bBreakEnd;w&&y.get().setCoordsForIntersector(E,S,!0),this.m_resultParts2.push(this.newIntersectionPart_(d,i,a,g,_,P,x,C,I,n.segmentParentage));let T=this.m_resultParts2.at(-1);T.u.bBigMoveStart=v,T.u.bBigMoveEnd=G,p=r,c=s}else -1===c&&(c=s)}return r?3:2}return 0}intersectLines3D(e,t,s,r){return(0,S.g)(0),1}intersect2D(e,t){let s=this.m_inputParts[0],r=this.m_inputParts[1],i=this.m_inputSegments[s.segmentIndex].getGeometryType(),n=this.m_inputSegments[r.segmentIndex].getGeometryType();return i!==S.G.enumLine||n!==S.G.enumLine?new ew(this).intersectCurves(e,t):this.intersectLines(e,t)}intersect2DEx(e,t,s,r,i){this.m_point.assignCopy(t),1!==this.m_inputSegments.length&&(0,S.c)(""),this.m_tolerance=e,this.m_changed1=!1,this.m_changed2=!1;let n=(0,b.s)(e*eC.c_smallToleranceFactor),a=!1,o=this.m_inputParts[0],h=this.m_inputSegments[o.segmentIndex];if(i||h.isIntersectingPoint(t.getXY(),e,!0)){this.m_param1=(0,b.d)(16,Number.NaN);let i=h.getClosestCoordinate(t.getXY(),!1);this.m_param1[0]=i;let l=o.rankInterior,m=o.weightInterior;0===i?(l=o.rankStart,m=o.weightStart):1===i?(l=o.rankEnd,m=o.weightEnd):this.m_changed1=!0;let g=l;g===s&&h.isCurve()&&(g=s+1);let u=1,_=0,d=new b.P;if(g===s){let e=h.getCoord2D(i),s=t.getXY();u=m+r,_=l,(0,b.Z)(e,s,r/u,d),this.m_changed1||e.equals(d)||(this.m_changed1=!0),this.m_changed2||s.equals(d)||(this.m_changed2=!0),a=b.P.sqrDistance(d,e)>n}else g>s?(d.assign(h.getCoord2D(i)),u=m,_=l,this.m_changed2||d.equals(t.getXY())||(this.m_changed2=!0)):(d.assign(h.getCoord2D(i)),u=r,_=s,this.m_changed1||d.equals(t.getXY())||(this.m_changed1=!0),a=b.P.sqrDistance(d,t.getXY())>n);let p=0,c=-1;for(let t=0;t<=1;t++){let s=t<1?this.m_param1[0]:1;if(s!==p){let r=this.allocResultSegment(),i=this.m_resultSegments[r];h.queryCut(p,s,i),i.get().snapControlPoints(e*e);let n=o.weightStart,a=o.weightEnd,l=o.rankStart,m=o.rankEnd,g=o.rankInterior,f=o.weightInterior,x=o.u.bBreakStart,P=o.u.bBreakEnd;-1!==c&&(n=u,l=_,x=!0,i.get().setCoordsForIntersector(d,i.get().getEndXY(),!0)),1!==t&&(a=u,m=_,P=!0,i.get().setCoordsForIntersector(i.get().getStartXY(),d,!0)),p=s,this.m_resultParts1.push(this.newIntersectionPart_(r,n,l,a,m,f,g,x,P,o.segmentParentage))}c=t}return this.m_point.setXY(d),this.m_pointWeight=u,this.m_pointRank=_,a?3:2}return 0}intersect3D(e,t,s,r){return(0,S.g)(0),1}intersect3DEx(e,t,s,r,i,n,a){return(0,S.g)(0),1}getTolerance(){return this.m_tolerance}freeAllResultSegments(){this.m_resultSegments.length=0,this.m_freeSegments.length=0}freeResultSegment(e){this.m_freeSegments.push(e)}allocResultSegment(){if(this.m_freeSegments.length)return this.m_freeSegments.pop();let e=new C.S,t=this.m_resultSegments.length;return this.m_resultSegments.push(e),t}allocResultSegmentFromBuffer(e){if(this.m_freeSegments.length)return this.m_freeSegments.pop();let t=new C.S({copy:e}),s=this.m_resultSegments.length;return this.m_resultSegments.push(t),s}allocResultSegmentFromSegment(e){if(this.m_freeSegments.length)return this.m_freeSegments.pop();let t=new C.S({segment:e}),s=this.m_resultSegments.length;return this.m_resultSegments.push(t),s}}function eI(){return{bBigMove:!1,bIsBreak:!1}}eC.maxWeight=.1*Number.MAX_VALUE,eC.c_smallToleranceFactor=.01,eC.c_maxGeometryTypeToRankDelta=8;let eb=class{constructor(){this.start=null,this.end=null,this.equalEdge=null,this.segmentIndex=-1,this.segmentParentage=-1,this.weight=0,this.rank=0}hasSegment(){return this.segmentIndex>=0}transferAttributes(e,t,s){if(1===t.getDescription().getAttributeCount())return;let r=e.parent.m_resultSegments[this.segmentIndex].get().getStartXY(),i=e.parent.m_resultSegments[this.segmentIndex].get().getEndXY(),n=new I.P;t.queryStart(n),s?(n.setXY(r),e.parent.m_resultSegments[this.segmentIndex].get().setStart(n)):(n.setXY(i),e.parent.m_resultSegments[this.segmentIndex].get().setEnd(n)),t.queryEnd(n),s?(n.setXY(i),e.parent.m_resultSegments[this.segmentIndex].get().setEnd(n)):(n.setXY(r),e.parent.m_resultSegments[this.segmentIndex].get().setStart(n))}copyFromWhenOverlap(e,t,s){this.equalEdge=t,t.equalEdge=this,this.segmentIndex=e.parent.allocResultSegmentFromBuffer(e.parent.m_resultSegments[t.segmentIndex]),this.segmentParentage=t.segmentParentage,this.weight=t.weight,this.rank=t.rank,s?(this.start.copyFrom(t.start),this.end.copyFrom(t.end)):(this.start.copyFrom(t.end),this.end.copyFrom(t.start),e.parent.m_resultSegments[this.segmentIndex].get().reverse())}getEnd(){return this.end}getNextInChain(){return this.end.nextInChain}getPrevInChain(){return this.start.prevInChain}};class ev{constructor(){this.hash=0,this.pt=new b.P,this.prevInChain=null,this.nextInChain=null,this.prevInHash=null,this.nextInHash=null,this.prevEqual=null,this.nextEqual=null,this.weight=0,this.rank=0,this.bBigMove=!1,this.bIsBreak=!1}copyFrom(e){this.pt.assign(e.pt),this.weight=e.weight,this.rank=e.rank,this.bBigMove=e.bBigMove,this.bIsBreak=e.bIsBreak}nextNode(){return this.nextInChain?this.nextInChain.end:null}prevNode(){return this.prevInChain?this.prevInChain.start:null}equalListHead(){let e=this;for(;null!==e.prevEqual;e=e.prevEqual);return e}}function eG(e,t,s,r){return{edge1:e,edge2:t,recursion:s,bIsIntersecting:r}}class ew{constructor(e){this.m_pairs=[],this.m_chainOrigin1=null,this.m_chainOrigin2=null,this.m_newNodes=[],this.m_hashTableOfEquals=[],this.m_hashTableOfEqualsSize=0,this.m_origin=new b.P,this.m_cell=new b.P,this.parent=e}addSegment(e,t,s,r,i,n,a,o,h,l,m){let g=this.newNode(this.parent.m_resultSegments[e].get().getStartXY(),s,r,h),u=this.newNode(this.parent.m_resultSegments[e].get().getEndXY(),i,n,l);this.newEdge(g,u,e,a,o,m),null===this.m_chainOrigin1?this.m_chainOrigin1=g:null===this.m_chainOrigin2?this.m_chainOrigin2=g:(0,S.g)(0)}intersectCurvesHelper(e,t,s,r,i){let n=this.getSegment(e).get(),a=this.getSegment(t).get();if(n.isDegenerate(0)||a.isDegenerate(0))return 0;let o=this.tryOverlapIntersectCurves(e,t,s,r);if(0!==o)return o;let h=(0,b.s)(.01*s),l=!1,m=this.processSharpCorners(n,a,s,i>4),g=m>0;if(!g){if(!(r||5&(0,C.a2)(!0,!1,n,a,s,!0)))return 0;m=(0,C.a0)(!0,n,a,null,this.parent.m_param1,this.parent.m_param2,s)}0===m&&(0,S.c)("");let u=n.getGeometryType(),_=a.getGeometryType(),d=(0,b.m)(b.P,m),p=(0,b.m)(b.P,m),c=(0,b.d)(m,Number.NaN),f=(0,b.d)(m,Number.NaN),x=(0,b.d)(m,Number.NaN),P=(0,b.d)(m,Number.NaN),y=(0,b.p)(eI,m),E=(0,b.p)(eI,m),I=!1,v=!1;for(let r=0;r<m;r++){let i=this.parent.m_param1[r],o=this.parent.m_param2[r],m=e.rank,S=e.weight,C=!0,G=!1;0===i?(m=e.start.rank,S=e.start.weight,G=e.start.bIsBreak):1===i?(m=e.end.rank,S=e.end.weight,G=e.end.bIsBreak):(I=!0,C=!1);let w=t.rank,T=t.weight,N=!1,D=!0;0===o?(w=t.start.rank,T=t.start.weight,N=t.start.bIsBreak):1===o?(w=t.end.rank,T=t.end.weight,N=t.end.bIsBreak):(v=!0,D=!1);let V=m,F=w;if(V===F&&(V*=eC.c_maxGeometryTypeToRankDelta,F*=eC.c_maxGeometryTypeToRankDelta,V+=eT(u,n,!1),F+=eT(_,a,!1)),C&&D&&F===V){let e=n.getCoord2D(i),t=a.getCoord2D(o);e.equals(t)&&(F=V-1)}let H=1,k=0,A=1,M=0,U=new b.P,q=new b.P,O=n.getCoord2D(i),B=a.getCoord2D(o);if(g&&b.P.distance(O,B)>s)U.setCoordsPoint2D(O),q.setCoordsPoint2D(B),H=S,A=T,k=m,M=w,y[r].bBigMove=!1,E[r].bBigMove=!1,G=!0,N=!0;else if(V===F){A=H=S+T,M=k=m,(0,b.Z)(O,B,T/H,U),q.setCoordsPoint2D(U);let e=b.P.sqrDistance(U,O),t=b.P.sqrDistance(U,B);y[r].bBigMove=e>h,E[r].bBigMove=t>h,I||O.equals(U)||(I=!0),v||B.equals(q)||(v=!0)}else if(V>F){U.setCoordsPoint2D(O),q.setCoordsPoint2D(U),A=H=S,M=k=m;let e=b.P.sqrDistance(U,B);y[r].bBigMove=!1,E[r].bBigMove=e>h,v||B.equals(q)||(v=!0)}else{q.setCoordsPoint2D(B),U.setCoordsPoint2D(q),A=H=T,M=k=w;let e=b.P.sqrDistance(U,O);y[r].bBigMove=e>h,E[r].bBigMove=!1,I||O.equals(U)||(I=!0)}d[r].assign(U),p[r].assign(q),c[r]=H,f[r]=A,x[r]=k,P[r]=M,y[r].bIsBreak=G||N,E[r].bIsBreak=G||N,l||=y[r].bBigMove||E[r].bBigMove,r>0&&(i!==this.parent.m_param1[r-1]&&o!==this.parent.m_param2[r-1]||(x[r]<=x[r-1]?(d[r].assign(p[r-1]),c[r]=f[r-1],x[r]=P[r-1],p[r].assign(p[r-1]),f[r]=f[r-1],P[r]=P[r-1],y[r].bBigMove||=y[r-1].bBigMove,E[r].bBigMove||=E[r-1].bBigMove,y[r].bIsBreak||=y[r-1].bIsBreak,E[r].bIsBreak||=E[r-1].bIsBreak):(d[r-1].assign(d[r]),c[r-1]=c[r],x[r-1]=x[r],p[r-1].assign(p[r]),f[r-1]=f[r],P[r-1]=P[r],y[r-1].bBigMove||=y[r].bBigMove,E[r-1].bBigMove||=E[r].bBigMove,y[r-1].bIsBreak||=y[r].bIsBreak,E[r-1].bIsBreak||=E[r].bIsBreak)))}if(!(I||v||2!==m||u===S.G.enumLine&&_===S.G.enumLine)){if(this.processDoublyConnectedEdges(e,t,i+1,s))return this.parent.m_changed1=!0,this.parent.m_changed2=!0,2;(0,S.g)(0)}this.parent.m_changed1||=I,this.parent.m_changed2||=v;let G=e,w=e.end.weight,T=e.end.rank,N=e.end.bBigMove,D=e.end.bIsBreak,V=0,F=-1;for(let t=0;t<=m;t++){let r=t<m?this.parent.m_param1[t]:1;if(r!==V){let i,a,o,h,l=this.parent.allocResultSegment(),g=this.parent.m_resultSegments[l];n.queryCut(V,r,g,!1),g.get().snapControlPoints(s*s);let u=!1,_=!1,p=!1,f=!1,P=new b.P,E=new b.P;-1!==F?(a=x[F],i=c[F],p=y[F].bBigMove,u=y[F].bIsBreak,P.assign(d[F])):(i=e.start.weight,a=e.start.rank,p=e.start.bBigMove,u=e.start.bIsBreak,P.assign(g.get().getStartXY())),t<m?(h=x[t],o=c[t],f=y[t].bBigMove,_=y[t].bIsBreak,E.assign(d[t])):(o=w,h=T,f=N,_=D,E.assign(g.get().getEndXY()));let S=G;r<1&&(this.splitEdgeInPlace(G),S=G.getNextInChain()),this.updateSegmentOnly(G,l),0===G.start.hash||G.start.pt.equals(P)||(this.m_newNodes.push(G.start),this.removeNodeFromHash(G.start),G.start.hash=0),0===G.end.hash||G.end.pt.equals(E)||(this.m_newNodes.push(G.end),this.removeNodeFromHash(G.end),G.end.hash=0),G.start.pt.assign(P),G.end.pt.assign(E),G.start.bBigMove||=p,G.end.bBigMove||=f,G.start.bIsBreak||=u,G.end.bIsBreak||=_,G.start.weight=i,G.start.rank=a,G.end.weight=o,G.end.rank=h,G=S,V=r,F=t}else -1===F&&(F=t)}let H=G.getNextInChain(),k=[];k.length=m;for(let e=0;e<m;e++)k[e]=e;m>2?(k.sort((e,t)=>(0,b.X)(this.parent.m_param2[e],this.parent.m_param2[t])),this.parent.m_param2.sort(b.X)):2===m&&this.parent.m_param2[0]>this.parent.m_param2[1]&&(this.parent.m_param2[1]=(0,b.b)(this.parent.m_param2[0],this.parent.m_param2[0]=this.parent.m_param2[1]),k[1]=(0,b.b)(k[0],k[0]=k[1])),G=t,w=t.end.weight,T=t.end.rank,N=t.end.bBigMove,D=t.end.bIsBreak,V=0,F=-1;for(let e=0;e<=m;e++){let r=e<m?this.parent.m_param2[e]:1;if(r!==V){let i,n,o,h,l=this.parent.allocResultSegment(),g=this.parent.m_resultSegments[l];a.queryCut(V,r,g,!1),g.get().snapControlPoints(s*s);let u=new b.P,_=new b.P,d=!1,c=!1,x=!1,y=!1;if(-1!==F){let e=k[F];i=f[e],n=P[e],u.assign(p[e]),x=E[e].bBigMove,d=E[e].bIsBreak}else i=t.start.weight,n=t.start.rank,x=t.start.bBigMove,d=t.start.bIsBreak,u.assign(g.get().getStartXY());if(e!==m){let t=k[e];o=f[t],h=P[t],_.assign(p[t]),y=E[t].bBigMove,c=E[t].bIsBreak}else o=w,h=T,y=N,c=D,_.assign(g.get().getEndXY());let S=G;r<1&&(this.splitEdgeInPlace(G),S=G.getNextInChain()),this.updateSegmentOnly(G,l),0===G.start.hash||G.start.pt.equals(u)||(this.m_newNodes.push(G.start),this.removeNodeFromHash(G.start),G.start.hash=0),0===G.end.hash||G.end.pt.equals(_)||(this.m_newNodes.push(G.end),this.removeNodeFromHash(G.end),G.end.hash=0),G.start.pt.assign(u),G.end.pt.assign(_),G.start.bBigMove||=x,G.end.bBigMove||=y,G.start.bIsBreak||=d,G.end.bIsBreak||=c,G.start.weight=i,G.start.rank=n,G.end.weight=o,G.end.rank=h,G=S,V=r,F=e}else -1===F&&(F=e)}let A=G.getNextInChain();return this.postProcessResultPartsForCurves(e,H,t,A,i+1),l?3:2}intersectCurves(e,t){2!==this.parent.m_inputSegments.length&&(0,S.c)(""),this.parent.m_changed1=!1,this.parent.m_changed2=!1,this.parent.m_tolerance=e,this.m_hashTableOfEqualsSize=0,this.m_hashTableOfEquals=(0,b.as)(16);let s=E.J.constructEmpty();for(let e=0;e<2;e++){let t=this.parent.allocResultSegmentFromSegment(this.parent.m_inputSegments[this.parent.m_inputParts[e].segmentIndex]),r=E.J.constructEmpty();this.parent.m_inputSegments[this.parent.m_inputParts[e].segmentIndex].queryLooseEnvelope(r),s.mergeEnvelope2D(r);let i=this.parent.m_inputParts[e];this.addSegment(t,0,i.weightStart,i.rankStart,i.weightEnd,i.rankEnd,i.weightInterior,i.rankInterior,i.u.bBreakStart,i.u.bBreakEnd,i.segmentParentage)}s.inflateCoords(100*e,100*e),this.m_origin.assign(s.getLowerLeft()),this.m_cell.setCoords(2*e,2*e),this.m_pairs.push(eG(this.m_chainOrigin1.nextInChain,this.m_chainOrigin2.nextInChain,0,t));let r=0,i=!0;for(;this.m_pairs.length;){let t=this.m_pairs.at(-1);this.m_pairs.pop(),(0,S.g)(t.recursion>=0),(0,S.g)(t.recursion<=256),this.clusterNodes(e);let s=this.intersectCurvesHelper(t.edge1,t.edge2,e,t.bIsIntersecting,t.recursion);i&&(i=!1,r=s)}for(let e=0;e<2;e++){let t=0===e?this.parent.m_resultParts1:this.parent.m_resultParts2;for(let s=(0===e?this.m_chainOrigin1:this.m_chainOrigin2).nextInChain;null!=s;s=s.getNextInChain())t.push(this.parent.newIntersectionPart_(s.segmentIndex,s.start.weight,s.start.rank,s.end.weight,s.end.rank,s.weight,s.rank,s.start.bIsBreak,s.end.bIsBreak,s.segmentParentage)),t.at(-1).u.bBigMoveStart=s.start.bBigMove,t.at(-1).u.bBigMoveEnd=s.end.bBigMove}return r}tryOverlapIntersectCurves(e,t,s,r){let i=this.parent.m_resultSegments[e.segmentIndex].get(),n=this.parent.m_resultSegments[t.segmentIndex].get(),a=i.getStartXY().equals(n.getStartXY())&&i.getEndXY().equals(n.getEndXY()),o=i.getStartXY().equals(n.getEndXY())&&i.getEndXY().equals(n.getStartXY());if(!a&&!o)return 0;let h=(0,C.a5)(i,n,!0);if(0!==h&&(0,C.a6)(i,n)&&e.segmentParentage===t.segmentParentage){let e=!1;if(h>0)e=i.equals(n);else{(0,S.g)(-1===h);let t=new C.S({segment:n});t.get().reverse(),e=i.equals(t.get())}if(e)return 1}let l=s*eC.c_smallToleranceFactor,m=!1;if(0===h){let e=[.5,.25,.75,.125,.375,.625,.875,.5625,.3125];for(let t=0,r=e.length;t<r;++t){let r=e[t],a=new b.P;i.queryCoord2D(r,a);let o=n.getClosestCoordinate(a,!1),h=new b.P;n.queryCoord2D(o,h);let g=b.P.distance(a,h);if(g>s)return 0;m||=g>l}for(let t=0,r=e.length;t<r;++t){let r=e[t],a=new b.P;n.queryCoord2D(r,a);let o=i.getClosestCoordinate(a,!1),h=new b.P;i.queryCoord2D(o,h);let g=b.P.distance(a,h);if(g>s)return 0;m||=g>l}}let g=e.rank,u=t.rank;return g===u&&(g*=eC.c_maxGeometryTypeToRankDelta,u*=eC.c_maxGeometryTypeToRankDelta,g+=eT(i.getGeometryType(),i,!0),u+=eT(n.getGeometryType(),n,!0)),g>u?(t.copyFromWhenOverlap(this,e,a),t.transferAttributes(this,i,a)):u>g?(e.copyFromWhenOverlap(this,t,a),e.transferAttributes(this,n,a)):e.segmentParentage<=t.segmentParentage?(e.weight=e.weight+t.weight,t.copyFromWhenOverlap(this,e,a),t.transferAttributes(this,i,a)):(t.weight=e.weight+t.weight,e.copyFromWhenOverlap(this,t,a),e.transferAttributes(this,n,a)),m?3:2}postProcessResultPartsForCurves(e,t,s,r,i){i===(0,b.aE)()&&(0,S.c)("curve_helper");for(let s=e;s!==t;s=s.getNextInChain())this.updateSegmentToNodes(s);for(let e=s;e!==r;e=e.getNextInChain())this.updateSegmentToNodes(e);for(let n=e;n!==t;n=n.getNextInChain()){let e=n.end.pt.sub(n.start.pt);for(let t=s;t!==r;t=t.getNextInChain()){let s=0;if(n.start.pt.equals(t.start.pt)&&n.end.pt.equals(t.end.pt)?s=1:n.start.pt.equals(t.end.pt)&&n.end.pt.equals(t.start.pt)&&(s=-1),!s){let s=+!!n.start.pt.equals(t.start.pt);if(s||(s=2*!!n.end.pt.equals(t.end.pt))||(s=3*!!n.end.pt.equals(t.start.pt))||(s=4*!!n.start.pt.equals(t.end.pt)),s){let r,a=t.end.pt.sub(t.start.pt),o=e.dotProduct(a);switch(s){case 1:case 2:r=o>0;break;case 3:case 4:r=o<0;break;default:(0,S.c)("post_process_result_parts_for_curves_")}r&&this.m_pairs.push(eG(n,t,i,!1))}continue}let r=this.parent.m_resultSegments[n.segmentIndex],a=this.parent.m_resultSegments[t.segmentIndex],o=[.5,.25,.75];for(let e=0,t=o.length;e<t;++e){let t=o[e],i=new b.P;r.get().queryCoord2D(t,i);let n=a.get().getClosestCoordinate(i,!1),h=new b.P;if(a.get().queryCoord2D(n,h),b.P.distance(i,h)>this.parent.m_tolerance){s=0;break}}if(!s){this.m_pairs.push(eG(n,t,i,!1));continue}for(let e=0,t=o.length;e<t;++e){let t=o[e],i=new b.P;a.get().queryCoord2D(t,i);let n=r.get().getClosestCoordinate(i,!1),h=new b.P;if(r.get().queryCoord2D(n,h),b.P.distance(i,h)>this.parent.m_tolerance){s=0;break}}if(!s){this.m_pairs.push(eG(n,t,i,!1));continue}n.equalEdge=t,t.equalEdge=n;let h=n.rank,l=t.rank;h===l&&(h*=eC.c_maxGeometryTypeToRankDelta,l*=eC.c_maxGeometryTypeToRankDelta,h+=eT(r.get().getGeometryType(),r.get(),!0),l+=eT(a.get().getGeometryType(),a.get(),!0)),h>l||h===l&&n.segmentParentage<=t.segmentParentage?(r.copyTo(a,!1),t.segmentParentage=n.segmentParentage,-1===s&&a.get().reverse()):(a.copyTo(r,!1),n.segmentParentage=t.segmentParentage,-1===s&&r.get().reverse());break}}this.updateAttachedEdgesAfterNodeChange(e.start),t&&this.updateAttachedEdgesAfterNodeChange(t.start),this.updateAttachedEdgesAfterNodeChange(s.start),r&&this.updateAttachedEdgesAfterNodeChange(r.start)}processDoublyConnectedEdges(e,t,s,r){s===(0,b.aE)()&&(0,S.c)("curve_helper");let i=this.getSegment(e).get(),n=this.getSegment(t).get(),a=i.getStartXY().equals(n.getStartXY())&&i.getEndXY().equals(n.getEndXY())?1:i.getEndXY().equals(n.getStartXY())&&i.getStartXY().equals(n.getEndXY())?-1:0;if(0!==a){let o=new C.S;i.queryCut(0,.5,o),o.get().snapControlPoints(r*r);let h=new C.S;i.queryCut(.5,1,h),h.get().snapControlPoints(r*r),this.splitEdgeInPlace(e),e.end.pt=o.get().getEndXY(),e.segmentIndex=this.parent.allocResultSegmentFromBuffer(o),e.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(h);let l=n.getClosestCoordinate(e.end.pt,!1);return Math.abs(l-.5)>.2&&(l=.5),n.queryCut(0,l,o),o.get().snapControlPoints(r*r),n.queryCut(l,1,h),h.get().snapControlPoints(r*r),this.splitEdgeInPlace(t),t.end.pt=o.get().getEndXY(),t.segmentIndex=this.parent.allocResultSegmentFromBuffer(o),t.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(h),a>0?(this.m_pairs.push(eG(e,t,s,!1)),this.m_pairs.push(eG(e.getNextInChain(),t.getNextInChain(),s,!1))):(this.m_pairs.push(eG(e,t.getNextInChain(),s,!1)),this.m_pairs.push(eG(e.getNextInChain(),t,s,!1))),!0}return!1}newNode(e,t,s,r){let i=new ev;return this.m_newNodes.push(i),i.pt=e,i.rank=s,i.weight=t,i.bIsBreak=r,i}newEdge(e,t,s,r,i,n){let a=new eb;return a.start=e,a.end=t,e.nextInChain=a,t.prevInChain=a,a.segmentIndex=s,a.segmentParentage=n,a.rank=i,a.weight=r,a}splitEdgeInPlace(e){e.segmentIndex=-1;let t=new eb,s=new ev;this.m_newNodes.push(s),s.pt.setNAN(),s.nextInChain=t,s.prevInChain=e,s.prevInHash=null,s.nextInHash=null,s.prevEqual=null,s.nextEqual=null,s.weight=e.weight,s.rank=e.rank,s.bIsBreak=!1,s.bBigMove=!1,t.start=s,t.segmentIndex=-1,t.end=e.end,t.end.prevInChain=t,t.rank=e.rank,t.weight=e.weight,t.segmentParentage=e.segmentParentage,e.end=s,e.equalEdge&&(e.equalEdge.equalEdge=null),e.equalEdge=null}updateSegmentOnly(e,t){e.segmentIndex=t}updateAttachedEdgesAfterNodeChange(e){for(let t=e.equalListHead();null!==t;t=t.nextEqual)this.updateAttachedEdgesAfterNodeChangeImpl(t)}updateAttachedEdgesAfterNodeChangeImpl(e){let t=e.prevInChain;if(t&&t.hasSegment()){let s=this.getSegment(t).get();e.pt.equals(s.getEndXY())||(s.setCoordsForIntersector(t.start.pt,t.end.pt,!1),s.ensureXYMonotone())}let s=e.nextInChain;if(s&&s.hasSegment()){let t=this.getSegment(s).get();e.pt.equals(t.getStartXY())||(t.setCoordsForIntersector(s.start.pt,s.end.pt,!1),t.ensureXYMonotone())}}updateSegmentToNodes(e){let t=this.getSegment(e).get();e.start.pt.equals(t.getStartXY())&&e.end.pt.equals(t.getEndXY())||(t.setCoordsForIntersector(e.start.pt,e.end.pt,!1),t.ensureXYMonotone()),this.updateAttachedEdgesAfterNodeChange(e.start),this.updateAttachedEdgesAfterNodeChange(e.end)}getSegment(e){return this.parent.m_resultSegments[e.segmentIndex]}clusterNodes(e){let t=!1,s=[],r=[],i=[];for(let e=0,t=this.m_newNodes.length;e<t;e++){let s=this.m_newNodes[e];if(null===s)continue;let r=s;for(let i=e+1;i<t;i++){let e=this.m_newNodes[i];null!==e&&s.pt.equals(e.pt)&&(r.nextInHash=e,e.prevInHash=r,r=e,this.m_newNodes[i]=null)}}for(let n=0,a=this.m_newNodes.length;n<a;n++){let a=this.m_newNodes[n];if(null==a)continue;for(a.hash=this.calculateHash(a.pt);;){let n=(0,b.as)(4),o=this.hashTableBinsToCheck(a,n);for(let t=0;t<o;t++)if(null!==n[t])for(let o=n[t];null!==o;){let t=o.nextInHash;b.P.distance(a.pt,o.pt)<=e&&(s.push(o),this.removeNodeFromHash(o),o.hash=0,i.push(o),r.push(o)),o=t}let h=!1;for(let e of s)if(!a.pt.equals(e.pt)){let s=eP(a.pt,e.pt,a.weight,a.rank,e.weight,e.rank);a.pt.assign(s.pt),a.weight=s.weight,a.rank=s.rank,h=!0,t=!0}if(s.length=0,!h)break;a.hash=this.calculateHash(a.pt)}i.push(a),r.push(a);for(let e=a.nextInHash;null!==e;){e.prevInHash=null;let t=e.nextInHash;e.nextInHash=null,i.push(e),r.push(e),e=t}let o=a.hash,h=null,l=null;for(let e of r)a!==e&&(e.hash=o,e.pt.assign(a.pt),e.rank=a.rank,e.weight=a.weight),e.prevInHash=h,h&&(h.nextInHash=e),e.prevEqual=l,e.nextEqual=null,l&&(l.nextEqual=e),l=e,h=e;let m=o%this.m_hashTableOfEquals.length;h.nextInHash=this.m_hashTableOfEquals[m],null!==this.m_hashTableOfEquals[m]&&(this.m_hashTableOfEquals[m].prevInHash=h),this.m_hashTableOfEquals[m]=r[0],this.m_hashTableOfEqualsSize+=r.length,r.length=0,this.rehashIfNeeded()}if(this.m_newNodes.length=0,t)for(let e of i)this.updateAttachedEdgesAfterNodeChange(e)}rehashIfNeeded(){if(2*this.m_hashTableOfEqualsSize>this.m_hashTableOfEquals.length){let e=this.m_hashTableOfEquals;for(let t of(this.m_hashTableOfEquals=(0,b.as)(2*e.length),this.m_hashTableOfEqualsSize=0,e)){let e=t;for(;e;){let t=e.nextInHash;e.nextInHash=null,e.prevInHash=null,this.addNodeToHashImpl(e),e=t}}}}addNodeToHashImpl(e){let t=e.hash%this.m_hashTableOfEquals.length,s=this.m_hashTableOfEquals[t];e.nextInHash=s,null!==s&&(s.prevInHash=e),this.m_hashTableOfEquals[t]=e,this.m_hashTableOfEqualsSize++}removeNodeFromHash(e){let t=e.hash%this.m_hashTableOfEquals.length,s=e.prevInHash,r=e.nextInHash;s?s.nextInHash=r:this.m_hashTableOfEquals[t]=r,r&&(r.prevInHash=s),this.m_hashTableOfEqualsSize--,e.prevInHash=null,e.nextInHash=null}hashTableBinsToCheck(e,t){let s=(e.pt.x-this.m_origin.x)/this.m_cell.x,r=(e.pt.y-this.m_origin.y)/this.m_cell.y,i=(0,b.i)()-1,n=Math.round((0,b.c)(s,-0x7ffffffe,i)),a=Math.round((0,b.c)(r,-0x7ffffffe,i)),o=n|a<<32;o=(0,b.ar)(o),t[0]=this.m_hashTableOfEquals[o%this.m_hashTableOfEquals.length];let h=n+1|a<<32;h=(0,b.ar)(h);let l=1;t[1]=this.m_hashTableOfEquals[h%this.m_hashTableOfEquals.length],t[1]!==t[0]&&(l=2);let m=n+1|a+1<<32;m=(0,b.ar)(m),t[l]=this.m_hashTableOfEquals[m%this.m_hashTableOfEquals.length];for(let e=0;e<l;e++)if(t[l]===t[e]){l--;break}l++;let g=n|a+1<<32;g=(0,b.ar)(g),t[l]=this.m_hashTableOfEquals[g%this.m_hashTableOfEquals.length];for(let e=0;e<l;e++)if(t[l]===t[e]){l--;break}return++l}calculateHash(e){let t=(e.x-this.m_origin.x)/this.m_cell.x,s=(e.y-this.m_origin.y)/this.m_cell.y,r=(0,b.i)()-1,i=Math.round((0,b.c)(t,-0x7ffffffe,r))|Math.round((0,b.c)(s,-0x7ffffffe,r))<<32;return 0===(i=(0,b.ar)(i))&&(i=1),i}processSharpCorners(e,t,s,r){if(this.parent.m_param1.length=0,this.parent.m_param2.length=0,e.getStartXY().equals(t.getStartXY())){let i=[0,0],n=[0,0],a=(0,C.a7)(e,t,0,0,s,2,i,n,r);if(a){this.parent.m_param1.push(0),this.parent.m_param2.push(0);for(let e=0;e<a;e++)this.parent.m_param1.push(i[e]),this.parent.m_param2.push(n[e]);return a+1}}if(e.getEndXY().equals(t.getEndXY())){let i=[0,0],n=[0,0],a=(0,C.a7)(e,t,1,1,s,2,i,n,r);if(a){for(let e=0;e<a;e++)this.parent.m_param1.push(i[e]),this.parent.m_param2.push(n[e]);return this.parent.m_param1.push(1),this.parent.m_param2.push(1),a+1}}if(e.getStartXY().equals(t.getEndXY())){let i=[0,0],n=[0,0],a=(0,C.a7)(e,t,0,1,s,2,i,n,r);if(a){this.parent.m_param1.push(0),this.parent.m_param2.push(1);for(let e=0;e<a;e++)this.parent.m_param1.push(i[e]),this.parent.m_param2.push(n[e]);return a+1}}if(e.getEndXY().equals(t.getStartXY())){let i=[0,0],n=[0,0],a=(0,C.a7)(e,t,1,0,s,2,i,n,r);if(a){for(let e=0;e<a;e++)this.parent.m_param1.push(i[e]),this.parent.m_param2.push(n[e]);return this.parent.m_param1.push(1),this.parent.m_param2.push(0),a+1}}return 0}}function eT(e,t,s){let r=0;switch(e){case S.G.enumLine:r=0;break;case S.G.enumBezier:r=2;break;case S.G.enumRationalBezier2:r=3;break;case S.G.enumBezier2:r=1;break;case S.G.enumEllipticArc:r=0===t.projectionBehavior()?5:4;break;default:(0,S.c)("")}return s?5-r:r}class eN extends ed{constructor(e){super(e.m_shape,e.m_tolerance,!1),this.m_parent=e}compare(e,t,s){if(this.m_bIntersectionDetected)return -1;let r=e.getElement(s),i=this.m_parent.getEdgeOriginVertices(t),n=this.m_parent.m_edgeVertices.getFirstElement(i),a=this.m_parent.getEdgeOriginVertices(r),o=this.m_parent.m_edgeVertices.getFirstElement(a);return this.m_currentNode=s,this.compareSegments(t,n,r,o)}}class eD extends ep{constructor(e){super(e.m_shape,e.m_tolerance),this.m_parent=e}compare(e,t){if(this.m_bIntersectionDetected)return -1;let s=e.getElement(t),r=this.m_parent.getEdgeOriginVertices(s),i=this.m_parent.m_edgeVertices.getFirstElement(r);return this.m_currentNode=t,this.compareVertex(e,t,i)}}class eV extends I.a6{constructor(e){super(),this.pt1=b.P.getNAN(),this.pt2=b.P.getNAN(),this.m_shape=e}compare(e,t,s){this.m_shape.queryXY(t,this.pt1);let r=e.getElement(s);return this.m_shape.queryXY(r,this.pt2),this.pt1.compare(this.pt2)}}class eF{constructor(e){this.m_point=b.P.getNAN(),this.m_pt=b.P.getNAN(),this.m_shape=e}setPoint(e){this.m_point.setCoordsPoint2D(e)}compare(e,t){let s=e.getElement(t);return this.m_shape.queryXY(s,this.m_pt),this.m_point.compare(this.m_pt)}}class eH{constructor(e,t){this.m_shape=null,this.m_progressTracker=null,this.m_edges=new I.S(8),this.m_clusters=new I.S(5),this.m_clusterVertices=new eu(!1),this.m_edgeVertices=new eu(!1),this.m_helperPoint=new I.P,this.m_eventQ=new I.T,this.m_sweepStructure=new I.T,this.m_bComplications=!1,this.m_sweepComparator=null,this.m_tempEdgeBuffer=[],this.m_modifiedClusters=[],this.m_edgesToInsertInSweepStructure=[],this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1,this.m_progressCounter=0,this.m_segmentIntersector=new eC,this.m_segBuf1=new C.S,this.m_segBuf2=new C.S,this.m_sweepPoint=new b.P(0,0),this.m_tolerance=0,this.m_toleranceSqr=0,this.m_sweepPointCluster=-1,this.m_vertexClusterIndex=-1,this.m_bCracked=!1,this.m_bSweepPointClusterWasModified=!1,this.m_progressTracker=e,this.m_bTrackChanges=t}hadComplications(){return this.m_bComplications}sweep(e,t){let s=new G.T;s.setSwapCoordinates(),e.applyTransformation(s),this.setEditShape_(e),this.m_bCracked=!1,this.m_tolerance=t,this.m_toleranceSqr=t*t;let r=this.sweepImpl_();return e.applyTransformation(s),r||(this.fillEventQueuePass2(),r=this.sweepImpl_()||r),this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_shape=null,this.m_bCracked}sweepVertical(e,t){this.setEditShape_(e),this.m_bCracked=!1,this.m_tolerance=t,this.m_toleranceSqr=t*t,this.m_bComplications=!1;let s=this.sweepImpl_();if(!this.m_bComplications){let r=e.filterClosePoints(t,!0,!1,this.m_bTrackChanges,C.n);this.m_bComplications=1===r,s||=1===r}return -1!==this.m_vertexClusterIndex&&(this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_vertexClusterIndex=-1),this.m_shape=null,s}getEdgeCluster(e,t){return this.m_edges.getField(e,0+t)}setEdgeCluster_(e,t,s){this.m_edges.setField(e,0+t,s)}getEdgeOriginVertices(e){return this.m_edges.getField(e,2)}setEdgeOriginVertices_(e,t){this.m_edges.setField(e,2,t)}getNextEdgeEx(e,t){return this.m_edges.getField(e,3+t)}setNextEdgeEx_(e,t,s){this.m_edges.setField(e,3+t,s)}getEdgeSweepNode(e){return this.m_edges.getField(e,7)}setEdgeSweepNode_(e,t){this.m_edges.setField(e,7,t)}getNextEdge(e,t){let s=this.getEdgeEnd(e,t);return this.m_edges.getField(e,3+s)}setNextEdge_(e,t,s){let r=this.getEdgeEnd(e,t);this.m_edges.setField(e,3+r,s)}getPrevEdge(e,t){let s=this.getEdgeEnd(e,t);return this.m_edges.getField(e,5+s)}setPrevEdge_(e,t,s){let r=this.getEdgeEnd(e,t);this.m_edges.setField(e,5+r,s)}getClusterVertices(e){return this.m_clusters.getField(e,0)}setClusterVertices_(e,t){this.m_clusters.setField(e,0,t)}getClusterSweepEdgeList(e){return this.m_clusters.getField(e,2)}setClusterSweepEdgeList_(e,t){this.m_clusters.setField(e,2,t)}getClusterFirstEdge(e){return this.m_clusters.getField(e,1)}setClusterFirstEdge_(e,t){this.m_clusters.setField(e,1,t)}getClusterEventQNode(e){return this.m_clusters.getField(e,3)}setClusterEventQNode_(e,t){this.m_clusters.setField(e,3,t)}newCluster_(e){let t=this.m_clusters.newElement(),s=this.m_clusterVertices.createList();return this.setClusterVertices_(t,s),e!==C.n&&(this.m_clusterVertices.addElement(s,e),this.m_shape.setUserIndex(e,this.m_vertexClusterIndex,t)),t}deleteCluster_(e){this.m_clusters.deleteElement(e)}addVertexToCluster_(e,t){let s=this.getClusterVertices(e);this.m_clusterVertices.addElement(s,t),this.m_shape.setUserIndex(t,this.m_vertexClusterIndex,e)}newEdge_(e){let t=this.m_edges.newElement(),s=this.m_edgeVertices.createList();return this.setEdgeOriginVertices_(t,s),-1!==e&&this.m_edgeVertices.addElement(s,e),t}addVertexToEdge_(e,t){let s=this.getEdgeOriginVertices(e);this.m_edgeVertices.addElement(s,t)}deleteEdge_(e){this.m_edges.deleteElement(e);let t=this.m_edgesToInsertInSweepStructure.findIndex(t=>t===e);t>=0&&(0,b.aA)(this.m_edgesToInsertInSweepStructure,t)}addEdgeToCluster(e,t){-1===this.getEdgeCluster(e,0)?this.setEdgeCluster_(e,0,t):-1===this.getEdgeCluster(e,1)?this.setEdgeCluster_(e,1,t):(0,S.c)(""),this.addEdgeToClusterImpl_(e,t)}addEdgeToClusterImpl_(e,t){let s=this.getClusterFirstEdge(t);if(-1!==s){let r=this.getNextEdge(s,t);this.setPrevEdge_(r,t,e),this.setNextEdge_(e,t,r),this.setNextEdge_(s,t,e),this.setPrevEdge_(e,t,s)}else this.setPrevEdge_(e,t,e),this.setNextEdge_(e,t,e),this.setClusterFirstEdge_(t,e)}getEdgeEnd(e,t){return+(this.getEdgeCluster(e,0)!==t)}mergeClusters_(e,t){this.dbgCheckCluster_(e),this.dbgCheckCluster_(t);let s=this.getClusterEventQNode(t);-1!==s&&(this.m_eventQ.deleteNode(s),this.setClusterEventQNode_(t,-1));let r=this.getClusterFirstEdge(e),i=this.getClusterFirstEdge(t);if(-1!==i){let s=i,n=i,a=!1;do{this.dbgCheckEdge_(s),a=!1;let r=this.getEdgeEnd(s,t),o=this.getNextEdgeEx(s,r);if(this.getEdgeCluster(s,r+1&1)===e){this.disconnectEdge_(s);let e=this.getEdgeOriginVertices(s);if(this.m_edgeVertices.deleteList(e),this.deleteEdge_(s),s===o){i=-1;break}i===s&&(i=this.getClusterFirstEdge(t),n=o,a=!0)}s=o}while(s!==n||a);if(-1!==i){do{let r=this.getEdgeEnd(s,t),i=this.getNextEdgeEx(s,r);this.setEdgeCluster_(s,r,e),s=i}while(s!==n);if(-1!==(r=this.getClusterFirstEdge(e))){let t=this.getNextEdge(r,e),s=this.getNextEdge(i,e);t===r?(this.setClusterFirstEdge_(e,i),this.addEdgeToClusterImpl_(r,e),this.setClusterFirstEdge_(e,r)):s===i&&this.addEdgeToClusterImpl_(i,e),this.setNextEdge_(i,e,t),this.setPrevEdge_(t,e,i),this.setNextEdge_(r,e,s),this.setPrevEdge_(s,e,r)}else this.setClusterFirstEdge_(e,i)}}let n=this.getClusterVertices(e),a=this.getClusterVertices(t);for(let t=this.m_clusterVertices.getFirst(a);-1!==t;t=this.m_clusterVertices.getNext(t)){let s=this.m_clusterVertices.getElement(t);this.m_shape.setUserIndex(s,this.m_vertexClusterIndex,e)}this.m_clusterVertices.concatenateLists(n,a),this.deleteCluster_(t),this.dbgCheckCluster_(e)}mergeEdges_(e,t){this.dbgCheckEdge_(e),this.dbgCheckEdge_(t);let s=this.getEdgeCluster(e,0),r=this.getEdgeCluster(e,1),i=this.getEdgeCluster(t,0),n=this.getEdgeCluster(t,1),a=this.getEdgeOriginVertices(e),o=this.getEdgeOriginVertices(t);if(this.m_edgeVertices.concatenateLists(a,o),t===this.getClusterFirstEdge(s)&&this.setClusterFirstEdge_(s,e),t===this.getClusterFirstEdge(r)&&this.setClusterFirstEdge_(r,e),this.disconnectEdge_(t),this.deleteEdge_(t),(s!==i||r!==n)&&(r!==i||s!==n)){let e=this.getClusterXY(s),t=this.getClusterXY(i);e.isEqualPoint2D(t)?(s!==i&&this.mergeClusters_(s,i),r!==n&&this.mergeClusters_(r,n)):(r!==i&&this.mergeClusters_(r,i),s!==n&&this.mergeClusters_(s,n))}this.dbgCheckEdge_(e)}disconnectEdge_(e){let t=this.getEdgeCluster(e,0),s=this.getEdgeCluster(e,1);this.disconnectEdgeFromCluster_(e,t),this.disconnectEdgeFromCluster_(e,s)}disconnectEdgeFromCluster_(e,t){let s=this.getNextEdge(e,t),r=this.getPrevEdge(e,t),i=this.getClusterFirstEdge(t);s!==e?(this.setNextEdge_(r,t,s),this.setPrevEdge_(s,t,r),i===e&&this.setClusterFirstEdge_(t,s)):this.setClusterFirstEdge_(t,-1)}applyIntersectorToEditShape_(e,t,s){let r=this.m_edgeVertices.getFirst(e),i=this.m_edgeVertices.getElement(r),n=this.getClusterFromVertex(i),a=this.m_shape.getNextVertex(i),o=this.getClusterFromVertex(a),h=this.m_shape.getXY(i),l=this.m_shape.getXY(a),m=!1,g=!1,u=t.getResultSegment(s,0).getStartXY(),_=t.getResultSegment(s,t.getResultSegmentCount(s)-1).getEndXY();h.equals(u)||(m=!0),l.equals(_)||(g=!0),this.m_shape.splitSegmentWithIntersector(i,t,s,!0,!0);let d=this.m_bTrackChanges&&t.getSegmentChanged(s);for(d&&this.m_shape.setGeometryModifiedWithVertex(i,!0),r=this.m_edgeVertices.getNext(r);-1!==r;r=this.m_edgeVertices.getNext(r)){let e=this.m_edgeVertices.getElement(r),i=this.getClusterFromVertex(e)===n;this.m_shape.splitSegmentWithIntersector(e,t,s,i,!0),d&&this.m_shape.setGeometryModifiedWithVertex(e,!0)}if(m&&this.updateClusterXY(!0,n,u,t.getResultSegmentStartPointWeight(s,0),t.getResultSegmentStartPointRank(s,0)),g){let e=t.getResultSegmentCount(s)-1;this.updateClusterXY(!0,o,_,t.getResultSegmentEndPointWeight(s,e),t.getResultSegmentEndPointRank(s,e))}}createEdgesAndClustersFromSplitEdge_(e,t,s){this.dbgCheckNewEdgesArray_();let r=this.getEdgeOriginVertices(e),i=this.getEdgeCluster(e,0),n=this.getEdgeCluster(e,1),a=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(a);let o=I.S.impossibleIndex3();this.setEdgeSweepNode_(a,o),this.m_tempEdgeBuffer.push(a),this.addEdgeToCluster(a,i);let h=t.getResultSegmentCount(s);for(let e=1;e<h;e++){let e=this.newCluster_(-1);this.m_modifiedClusters.push(e),this.m_tempEdgeBuffer.push(e),this.addEdgeToCluster(a,e);let t=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(t),this.setEdgeSweepNode_(t,o),this.m_tempEdgeBuffer.push(t),this.addEdgeToCluster(t,e),a=t}this.addEdgeToCluster(a,n);for(let e=this.m_edgeVertices.getFirst(r);-1!==e;e=this.m_edgeVertices.getNext(e)){let t=this.m_edgeVertices.getElement(e);if(this.getClusterFromVertex(t)===i){let e=0,s=this.m_tempEdgeBuffer.length;do{if(e>0){let s=this.m_tempEdgeBuffer[e-1];this.addVertexToCluster_(s,t)}let s=this.m_tempEdgeBuffer[e];e+=2,this.addVertexToEdge_(s,t),t=this.m_shape.getNextVertex(t)}while(e<s)}else{let e=this.m_tempEdgeBuffer.length-1;do{if(e<this.m_tempEdgeBuffer.length-2){let s=this.m_tempEdgeBuffer[e+1];this.addVertexToCluster_(s,t)}let s=this.m_tempEdgeBuffer[e];e-=2,this.addVertexToEdge_(s,t),t=this.m_shape.getNextVertex(t)}while(e>=0)}}this.m_tempEdgeBuffer.length=0,this.dbgCheckNewEdgesArray_()}getVertexFromClusterIndex(e){let t=this.getClusterVertices(e);return this.m_clusterVertices.getFirstElement(t)}getClusterFromVertex(e){return this.m_shape.getUserIndex(e,this.m_vertexClusterIndex)}processSplitHelper1_(e,t,s){let r=this.getEdgeCluster(t,0),i=this.getClusterXY(r),n=this.getEdgeCluster(t,1),a=this.getClusterXY(n),o=s.getResultSegmentCount(e),h=s.getResultSegment(e,0),l=h.getStartXY();if(i.isEqualPoint2D(l)||(!this.m_bComplications&&i.compare(this.m_sweepPoint)*l.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(r,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(r)),!this.m_bComplications&&o>1){let e=i.compare(a),t=h.getEndXY();(i.compare(t)!==e||t.compare(a)!==e||0>t.compare(this.m_sweepPoint))&&(this.m_bComplications=!0)}let m=(h=s.getResultSegment(e,o-1)).getEndXY();a.isEqualPoint2D(m)||(!this.m_bComplications&&a.compare(this.m_sweepPoint)*m.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(n,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(n)),this.m_tempEdgeBuffer.push(t);for(let e=0,s=this.m_tempEdgeBuffer.length;e<s;e++){let s=this.m_tempEdgeBuffer[e],r=this.getEdgeSweepNode(s);I.S.isValidElement(r)&&(this.m_sweepStructure.deleteNode(r),this.setEdgeSweepNode_(s,-1));let i=I.S.impossibleIndex3();s!==t&&this.getEdgeSweepNode(s)!==i&&(this.m_edgesToInsertInSweepStructure.push(s),this.setEdgeSweepNode_(s,i))}this.m_tempEdgeBuffer.length=0}checkAndFixIntersection_(e,t){let s=this.m_sweepStructure.getElement(e);return this.m_sweepComparator.compare(this.m_sweepStructure,s,t),!!this.m_sweepComparator.intersectionDetected()&&(this.m_sweepComparator.clearIntersectionDetectedFlag(),this.fixIntersection_(e,t),!0)}fixIntersection_(e,t){this.m_bCracked=!0;let s=this.m_sweepStructure.getElement(e),r=this.m_sweepStructure.getElement(t),i=null,n=null,a=this.getEdgeOriginVertices(s),o=this.m_edgeVertices.getFirstElement(a),h=this.getEdgeOriginVertices(r),l=this.m_edgeVertices.getFirstElement(h),m=this.m_shape.querySegment(o,this.m_segBuf1,!1,!1);(0,S.g)(m),i=this.m_segBuf1.get();let g=this.m_shape.getNextVertex(o),u=this.m_shape.getWeight(o),_=this.m_shape.getSegmentParentageBreakVertex(o),d=this.m_shape.getWeight(g),p=this.m_shape.getSegmentParentageBreakVertex(g),c=this.m_shape.getSegmentWeight(o),f=this.m_shape.getRank(o),x=this.m_shape.getRank(g),P=this.m_shape.getSegmentRank(o),y=this.m_shape.getSegmentParentage(o),E=this.m_shape.querySegment(l,this.m_segBuf2,!1,!1);(0,S.g)(E),n=this.m_segBuf2.get();let C=this.m_shape.getNextVertex(l),I=this.m_shape.getWeight(l),b=this.m_shape.getSegmentParentageBreakVertex(l),v=this.m_shape.getWeight(C),G=this.m_shape.getSegmentParentageBreakVertex(C),w=this.m_shape.getSegmentWeight(l),T=this.m_shape.getRank(l),N=this.m_shape.getRank(C),D=this.m_shape.getSegmentRank(l),V=this.m_shape.getSegmentParentage(l);this.m_segmentIntersector.pushSegment(i,u,f,d,x,c,P,_,p,y),this.m_segmentIntersector.pushSegment(n,I,T,v,N,w,D,b,G,V),3===this.m_segmentIntersector.intersect2D(this.m_tolerance,!0)&&(this.m_bComplications=!0),this.splitEdge_(s,r,-1,this.m_segmentIntersector),this.m_segmentIntersector.clear()}fixIntersectionPointSegment_(e,t){this.m_bCracked=!0;let s=this.m_sweepStructure.getElement(t),r=null,i=this.getEdgeOriginVertices(s),n=this.m_edgeVertices.getFirstElement(i),a=this.m_shape.querySegment(n,this.m_segBuf1,!1,!1);(0,S.g)(a),r=this.m_segBuf1.get();let o=this.m_shape.getNextVertex(n),h=this.m_shape.getWeight(n),l=this.m_shape.getSegmentParentageBreakVertex(n),m=this.m_shape.getWeight(o),g=this.m_shape.getSegmentParentageBreakVertex(o),u=this.m_shape.getSegmentWeight(n),_=this.m_shape.getRank(n),d=this.m_shape.getRank(o),p=this.m_shape.getSegmentRank(n),c=this.m_shape.getSegmentParentage(n),f=this.getClusterFirstVertex(e);this.m_segmentIntersector.pushSegment(r,h,_,m,d,u,p,l,g,c),this.m_shape.queryPoint(f,this.m_helperPoint);let x=this.m_shape.getWeight(f),P=this.m_shape.getRank(f);this.m_segmentIntersector.intersect2DEx(this.m_tolerance,this.m_helperPoint,P,x,!0),this.splitEdge_(s,-1,e,this.m_segmentIntersector),this.m_segmentIntersector.clear()}insertNewEdges_(){if(0===this.m_edgesToInsertInSweepStructure.length)return!0;this.dbgCheckNewEdgesArray_();let e=!0,t=0,s=Math.max(2*this.m_edgesToInsertInSweepStructure.length+200,this.m_sweepStructure.size()+200);for(;this.m_edgesToInsertInSweepStructure.length;){if(this.m_edgesToInsertInSweepStructure.length>Math.max(100,this.m_shape.getTotalPointCount())||t>s){this.m_edgesToInsertInSweepStructure.length=0,this.m_bComplications=!0,e=!1;break}let r=this.m_edgesToInsertInSweepStructure.at(-1);this.m_edgesToInsertInSweepStructure.pop(),this.setEdgeSweepNode_(r,-1);let i=this.isEdgeOnSweepLine_(r);I.S.isValidElement(i)?(this.insertNewEdgeToSweepStructure_(r,i),t++):i!==I.S.impossibleIndex2()&&(e=!1),this.m_bContinuingSegmentChainOptimization=!1}return e}insertNewEdgeToSweepStructure_(e,t){let s;if(this.m_bContinuingSegmentChainOptimization?(s=this.m_sweepStructure.addElementAtPosition(this.m_prevNeighbour,this.m_nextNeighbour,e,!0,!0),this.m_bContinuingSegmentChainOptimization=!1):s=this.m_sweepStructure.addUniqueElement(e),-1===s){let t=this.m_sweepStructure.getDuplicateElement(),s=this.m_sweepStructure.getElement(t);return this.mergeEdges_(s,e),!1}if(this.setEdgeSweepNode_(e,s),this.m_sweepComparator.intersectionDetected()){this.m_sweepComparator.clearIntersectionDetectedFlag();let e=this.m_sweepComparator.getLastComparedNode();return this.m_prevNeighbour===e&&(this.m_prevNeighbour=-1),this.m_nextNeighbour===e&&(this.m_nextNeighbour=-1),this.fixIntersection_(e,s),!0}return!1}isEdgeOnSweepLine_(e){let t=this.getEdgeCluster(e,0),s=this.getEdgeCluster(e,1),r=this.getClusterXY(t),i=this.getClusterXY(s);if(b.P.sqrDistance(r,i)<=this.m_toleranceSqr)return this.m_bComplications=!0,-1;let n=r.compare(this.m_sweepPoint),a=i.compare(this.m_sweepPoint);return n<=0&&a>0?s:a<=0&&n>0?t:n>0&&a>0?I.S.impossibleIndex2():-1}fillEventQueue(){let e=new I.A(0),t=this.m_shape.queryVertexIteratorOnSelection();for(let s=t.next();s!==C.n;s=t.next())-1!==this.m_shape.getUserIndex(s,this.m_vertexClusterIndex)&&e.add(s);this.m_shape.sortVerticesSimpleByY(e,0,e.size()),this.progress_(!0),this.m_eventQ.clear(),this.m_eventQ.setCapacity(e.size()),this.m_eventQ.setComparator(new eV(this.m_shape));let s=b.P.getNAN();s.setNAN();let r=-1;for(let t=0,i=e.size();t<i;t++){let i=e.read(t);if(this.m_shape.getXY(i).isEqualPoint2D(s)){let e=this.m_shape.getUserIndex(i,this.m_vertexClusterIndex);this.mergeClusters_(r,e);continue}r=this.getClusterFromVertex(i),this.m_shape.queryXY(i,s);let n=this.m_eventQ.addBiggestElement(i);this.setClusterEventQNode_(r,n)}}fillEventQueuePass2(){let e=new I.A(0);for(let t=this.m_eventQ.getFirst();-1!==t;t=this.m_eventQ.getNext(t)){let s=this.m_eventQ.getElement(t);e.add(s)}this.m_eventQ.clear(),this.m_shape.sortVerticesSimpleByY(e,0,e.size()),this.progress_(!0);for(let t=0,s=e.size();t<s;t++){let s=e.read(t),r=this.getClusterFromVertex(s),i=this.m_eventQ.addBiggestElement(s);this.setClusterEventQNode_(r,i)}}getAffectedEdges(e,t){let s=this.getClusterFirstEdge(e);if(-1===s)return;let r=s;do{let s=this.getEdgeSweepNode(r);I.S.isValidElement(s)&&t.push(r),r=this.getNextEdge(r,e)}while(r!==s)}updateClusterXY(e,t,s,r,i){let n=this.getClusterVertices(t);for(let t=this.m_clusterVertices.getFirst(n);-1!==t;t=this.m_clusterVertices.getNext(t)){let n=this.m_clusterVertices.getElement(t);this.m_shape.setXYMonotonicPoint2D(n,s),this.m_shape.setWeight(n,r),this.m_shape.setRank(n,i),e&&this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(n,!0)}}splitEdge_(e,t,s,r){this.dbgCheckEdge_(e),-1!==t&&this.dbgCheckEdge_(t),this.disconnectEdge_(e),-1!==t&&this.disconnectEdge_(t),this.processSplitHelper1_(0,e,r),-1!==t&&this.processSplitHelper1_(1,t,r),-1!==s&&r.getResultPointChanged()&&this.m_modifiedClusters.push(s);for(let e=0,t=this.m_modifiedClusters.length;e<t;e++){let t=this.m_modifiedClusters[e],s=this.getClusterEventQNode(t);-1!==s&&(this.m_eventQ.deleteNode(s),this.setClusterEventQNode_(t,-1))}let i=this.getEdgeOriginVertices(e),n=-1!==t?this.getEdgeOriginVertices(t):-1;if(this.applyIntersectorToEditShape_(i,r,0),-1!==n)this.applyIntersectorToEditShape_(n,r,1);else{let e=r.getResultPoint().getXY();this.updateClusterXY(r.getResultPointChanged(),s,e,r.getResultPointWeight(),r.getResultPointRank())}this.createEdgesAndClustersFromSplitEdge_(e,r,0),-1!==t&&this.createEdgesAndClustersFromSplitEdge_(t,r,1),this.m_edgeVertices.deleteList(i),this.deleteEdge_(e),-1!==t&&(this.m_edgeVertices.deleteList(n),this.deleteEdge_(t));for(let e=0,t=this.m_modifiedClusters.length;e<t;e++){let t=this.m_modifiedClusters[e];t===this.m_sweepPointCluster&&(this.m_bSweepPointClusterWasModified=!0);let s=this.getClusterEventQNode(t);if(-1===s){let e=this.getClusterFirstVertex(t);if(-1===(s=this.m_eventQ.addUniqueElement(e))){let e=this.m_eventQ.getDuplicateElement(),s=this.m_eventQ.getElement(e),r=this.getClusterFromVertex(s);this.mergeClusters_(r,t)}else this.setClusterEventQNode_(t,s)}}this.m_modifiedClusters.length=0}getClusterXY(e){let t=this.getClusterFirstVertex(e);return this.m_shape.getXY(t)}getClusterFirstVertex(e){let t=this.getClusterVertices(e);return this.m_clusterVertices.getFirstElement(t)}dbgCheckEdge_(e){}dbgCheckCluster_(e){}dbgCheckNewEdgesArray_(){}dbgSaveSweepStructure_(e){}sweepImpl_(){this.progress_(!0),this.m_bSweepPointClusterWasModified=!1,this.m_sweepPointCluster=-1,null===this.m_sweepComparator&&(this.m_sweepStructure.disableBalancing(),this.m_sweepComparator=new eN(this),this.m_sweepStructure.setComparator(this.m_sweepComparator));let e=[],t=null,s=null;this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1;let r=I.S.impossibleIndex2(),i=I.S.impossibleIndex3();for(let n=this.m_eventQ.getFirst();-1!==n;){this.progress_(),this.dbgCheckSweepStructure_(),this.m_bContinuingSegmentChainOptimization=!1,this.m_prevNeighbour=-1,this.m_nextNeighbour=-1;let a=this.m_eventQ.getElement(n);this.m_sweepPointCluster=this.getClusterFromVertex(a),this.m_shape.queryXY(a,this.m_sweepPoint),this.m_sweepComparator.setSweepY(this.m_sweepPoint.y,this.m_sweepPoint.x);let o=!1;{let t=this.getClusterFirstEdge(this.m_sweepPointCluster);if(!(o=-1===t)){let s=t;do{let t=this.getEdgeSweepNode(s);-1===t?(this.m_edgesToInsertInSweepStructure.push(s),this.setEdgeSweepNode_(s,i)):t!==i&&e.push(t),s=this.getNextEdge(s,this.m_sweepPointCluster)}while(s!==t)}}if(!this.m_sweepStructure.isAutoBalancing()&&(this.m_sweepStructure.getMaxDepthEver()>4||this.m_edgesToInsertInSweepStructure.length>10)&&this.m_sweepStructure.enableBalancing(),e.length>0){this.m_bContinuingSegmentChainOptimization=1===e.length&&1===this.m_edgesToInsertInSweepStructure.length;for(let t=0,s=e.length;t<s;t++){let s=this.m_sweepStructure.getElement(e[t]);this.setEdgeSweepNode_(s,r)}let t=r,s=r;for(let i=0,n=e.length;i<n;i++){let n=e[i];if(t===r){let e=this.m_sweepStructure.getPrev(n);if(-1!==e){let s=this.m_sweepStructure.getElement(e);this.getEdgeSweepNode(s)!==r&&(t=e)}else t=-1}if(s===r){let e=this.m_sweepStructure.getNext(n);if(-1!==e){let t=this.m_sweepStructure.getElement(e);this.getEdgeSweepNode(t)!==r&&(s=e)}else s=-1}if(t!==r&&s!==r)break}for(let t=0,s=e.length;t<s;t++){let s=e[t],r=this.m_sweepStructure.getElement(s);this.m_sweepStructure.deleteNode(s),this.setEdgeSweepNode_(r,-1)}e.length=0,this.m_prevNeighbour=t,this.m_nextNeighbour=s,-1!==t&&-1!==s?this.m_bContinuingSegmentChainOptimization||this.checkAndFixIntersection_(t,s):-1===t&&-1===s&&(this.m_bContinuingSegmentChainOptimization=!1)}else o&&(null===t&&(t=new eD(this)),t.setPoint(this.m_sweepPoint),this.m_sweepStructure.searchUpperBound(t),t.intersectionDetected()&&(t.clearIntersectionDetectedFlag(),this.fixIntersectionPointSegment_(this.m_sweepPointCluster,t.getCurrentNode())));let h=this.m_bContinuingSegmentChainOptimization;!this.insertNewEdges_()&&h&&-1!==this.m_prevNeighbour&&-1!==this.m_nextNeighbour&&this.checkAndFixIntersection_(this.m_prevNeighbour,this.m_nextNeighbour),this.m_bSweepPointClusterWasModified?(this.m_bSweepPointClusterWasModified=!1,null===s&&(s=new eF(this.m_shape)),s.setPoint(this.m_sweepPoint),n=this.m_eventQ.searchUpperBound(s)):n=this.m_eventQ.getNext(n)}return this.m_bCracked}setEditShape_(e){this.m_shape=e,this.m_vertexClusterIndex=this.m_shape.createUserIndex(),this.m_edges.setCapacity(e.getSelectedCount()+32),this.m_clusters.setCapacity(e.getSelectedCount()),this.m_clusterVertices.reserveLists(e.getSelectedCount()),this.m_clusterVertices.reserveNodes(e.getSelectedCount()),this.m_edgeVertices.reserveLists(e.getSelectedCount()+32),this.m_edgeVertices.reserveNodes(e.getSelectedCount()+32);for(let t=this.m_shape.getFirstGeometry();t!==C.n;t=this.m_shape.getNextGeometry(t))if((0,S.h)(this.m_shape.getGeometryType(t)))for(let s=this.m_shape.getFirstPath(t);s!==C.n;s=this.m_shape.getNextPath(s)){let t=this.m_shape.getPathSize(s),r=this.m_shape.getFirstVertex(s);if(r===C.n)continue;let i=this.m_shape.getNextVertex(r);if(i===C.n||i===r)continue;let n=-1;e.selected(r)&&(n=this.newCluster_(r));let a=-1;-1!==n&&e.selected(i)&&(a=this.newEdge_(r),this.addEdgeToCluster(a,n));let o=a;for(let e=0,s=t-2;e<s;e++){let e=this.m_shape.getNextVertex(i),t=-1;if(this.m_shape.selected(i)){let s=this.newCluster_(i);-1!==o&&this.addEdgeToCluster(o,s),this.m_shape.selected(e)&&(t=this.newEdge_(i),this.addEdgeToCluster(t,s))}o=t,i=e}if(this.m_shape.isClosedPath(s)){let e=this.m_shape.getNextVertex(i);if(this.m_shape.selected(i)){let t=this.newCluster_(i);if(-1!==o&&this.addEdgeToCluster(o,t),this.m_shape.selected(e)){let e=this.newEdge_(i);this.addEdgeToCluster(e,t),this.addEdgeToCluster(e,n)}}}else{let e=-1;this.m_shape.selected(i)&&(e=this.newCluster_(i),-1!==o&&this.addEdgeToCluster(o,e))}}else for(let e=this.m_shape.getFirstPath(t);e!==C.n;e=this.m_shape.getNextPath(e)){let t=this.m_shape.getFirstVertex(e);for(let s=0,r=this.m_shape.getPathSize(e);s<r;s++)this.m_shape.selected(t)&&this.newCluster_(t),t=this.m_shape.getNextVertex(t)}this.fillEventQueue()}progress_(e=!1){}dbgCheckSweepStructure_(){}}function ek(e,t,s){return{vertex0:e,vertex1:t,dir:s}}class eA{constructor(e){this.m_shape=null,this.m_spikes=[],this.m_points=new I.A(0),this.m_pointsIndex=-1,this.m_dissolvedEdges=0,this.m_progressTracker=e}executeImpl_(e,t){if(this.m_shape=e,2>e.getPathCount(t)&&6>e.getPointCount(t))return;this.m_points.resize(0);for(let s=e.getFirstPath(t);s!==C.n;s=e.getNextPath(s)){let t=e.getFirstVertex(s);for(let r=0,i=e.getPathSize(s);r<i;r++,t=e.getNextVertex(t))this.m_points.add(t)}this.m_pointsIndex=e.createUserIndex();for(let t=0,s=this.m_points.size();t<s;++t)e.setUserIndex(this.m_points.read(t),this.m_pointsIndex,t);e.sortVerticesSimpleByY(this.m_points,0,this.m_points.size());let s=this.m_points.read(0),r=e.getXY(s),i=1,n=0,a=[];for(let t=1;t<this.m_points.size();t++){let o=this.m_points.read(t);if(o===C.n||-1===e.getUserIndex(o,this.m_pointsIndex))continue;let h=e.getXY(o);if(h.isEqualPoint2D(r))i++;else{if(i>1){for(let s=n;s<t;s++){let t=this.m_points.read(s);if(-1===e.getUserIndex(t,this.m_pointsIndex))continue;let i=e.getNextVertex(t),n=e.getPrevVertex(t);if(t!==i&&!e.isEqualXYPoint2D(i,r)){let e=ek(t,i,1);a.push(e)}if(t!==n&&n!==i&&!e.isEqualXYPoint2D(n,r)){let e=ek(t,n,-1);a.push(e)}}a.length>0&&this.processBunch_(a,r)}s=o,r.assign(h),i=1,n=t}}if(0===this.m_dissolvedEdges)return e.removeUserIndex(this.m_pointsIndex),void(this.m_pointsIndex=-1);let o=e.getPointCount(t);for(let t=0;t<this.m_points.size();t++){let s=this.m_points.read(t);if(s===C.n)continue;if(-1!==e.getUserIndex(s,this.m_pointsIndex)){e.setUserIndex(s,this.m_pointsIndex,-1);continue}let r=e.getPathFromVertex(s);e.getFirstVertex(r)===s&&e.setFirstVertex(r,C.n),e.freeVertex(s),this.m_points.write(t,C.n),o--}let h=e.createPathUserIndex(),l=e.getPathCount(t);for(let s=0,r=this.m_points.size();s<r;++s){if(this.m_points.read(s)===C.n)continue;let r=this.m_points.read(s);if(-1!==e.getUserIndex(r,this.m_pointsIndex))continue;let i=e.getPathFromVertex(r),n=-1;if(2===e.getPathUserIndex(i,h)){i=C.n;for(let t=e.getNextVertex(r);t!==r;t=e.getNextVertex(t)){let s=e.getPathFromVertex(t);if(2!==e.getPathUserIndex(s,h)){i=s,r=t;break}}i===C.n&&(i=e.insertPath(t,C.n),e.setClosedPath(i,!0),l++),(0,S.g)(i!==C.n)}e.setPathUserIndex(i,h,2),n=e.getFirstVertex(i);let a=0,o=!1,m=r;do{n===m&&(o=!0),e.setUserIndex(m,this.m_pointsIndex,1);let t=e.getPathFromVertex(m);t!==i&&(2!==e.getPathUserIndex(t,h)&&(e.setPathUserIndex(t,h,1),e.setFirstVertex(t,C.n)),e.setPathToVertex(m,i)),a++,m=e.getNextVertex(m)}while(m!==r);o||e.setFirstVertex(i,r),e.setPathSize(i,a)}for(let s=e.getFirstPath(t);s!==C.n;){let t=e.getNextPath(s);1!==e.getPathUserIndex(s,h)&&e.getFirstVertex(s)!==C.n||(e.removePathOnly(s),l--),s=t}e.setGeometryVertexCount(t,o),e.setGeometryPathCount(t,l),e.removePathUserIndex(h),e.removeUserIndex(this.m_pointsIndex),this.m_pointsIndex=-1,e.dbgVerifyVertexCounts(),e.filterClosePoints(0,!0,!1,!1,t)}processBunch_(e,t){e.sort((e,s)=>{let r=this.m_shape.getXY(e.vertex1).sub(t),i=this.m_shape.getXY(s.vertex1).sub(t),n=b.P.compareVectors(r,i);return 0===n?e.dir<s.dir?-1:1:n});let s=0,r=this.m_shape.getXY(e[0].vertex1),i=1,n=this.m_shape.hasCurves();for(let t=1,a=e.length;t<a;t++){let o=this.m_shape.getXY(e[t].vertex1);if(!(o.isEqualPoint2D(r)&&(i++,t+1<a))){if(2===i){let t=e[s],r=e[s+1],i=t.dir;if(i!==r.dir){let e=!0;if(n&&(e=!this.m_shape.isCurve(1===t.dir?t.vertex0:t.vertex1)&&!this.m_shape.isCurve(1===r.dir?r.vertex0:r.vertex1)),e){if(1===i){let e=t.vertex0,s=r.vertex0;this.m_shape.setNextVertex(e,s),this.m_shape.setPrevVertex(s,e),this.m_shape.getPrevVertex(e)===s&&(this.m_shape.setUserIndex(e,this.m_pointsIndex,-1),this.m_shape.setUserIndex(s,this.m_pointsIndex,-1));let i=t.vertex1,n=r.vertex1;this.m_shape.setPrevVertex(i,n),this.m_shape.setNextVertex(n,i),this.m_shape.getNextVertex(i)===n&&(this.m_shape.setUserIndex(i,this.m_pointsIndex,-1),this.m_shape.setUserIndex(n,this.m_pointsIndex,-1))}else{let e=t.vertex0,s=r.vertex0;this.m_shape.setPrevVertex(e,s),this.m_shape.setNextVertex(s,e),this.m_shape.getNextVertex(e)===s&&(this.m_shape.setUserIndex(e,this.m_pointsIndex,-1),this.m_shape.setUserIndex(s,this.m_pointsIndex,-1));let i=t.vertex1,n=r.vertex1;this.m_shape.setNextVertex(i,n),this.m_shape.setPrevVertex(n,i),this.m_shape.getPrevVertex(i)===n&&(this.m_shape.setUserIndex(i,this.m_pointsIndex,-1),this.m_shape.setUserIndex(n,this.m_pointsIndex,-1))}this.m_dissolvedEdges+=2}}}r.assign(o),s=t,i=1}}e.length=0}}function eM(e){for(let t=e.getFirstGeometry();t!==C.n;t=e.getNextGeometry(t))if((0,S.h)(e.getGeometryType(t)))return!0;return!1}function eU(e,t,s,r,i){if(!eM(t))return!1;let n=new eq(i);if(n.m_shape=t,n.m_tolerance=s,n.m_bAllowCoincident=e,n.m_bNeedsNonSimpleResult=null!==r,n.needsCrackingImpl_())return r&&r.assign(n.m_nonSimpleResult),!0;let a=new G.T;a.setSwapCoordinates(),t.applyTransformation(a),(n=new eq(i)).m_shape=t,n.m_tolerance=s,n.m_bAllowCoincident=e,n.m_bNeedsNonSimpleResult=null!==r;let o=n.needsCrackingImpl_();return t.applyTransformation(a),!!o&&(r&&r.assign(n.m_nonSimpleResult),!0)}class eq{crackBruteForce_(){let e=this.crackBruteForceImpl_();if(!e&&this.m_shape.hasCurves()){let t=new G.T;t.setSwapCoordinates(),this.m_shape.applyTransformation(t),e=this.crackBruteForceImpl_(),this.m_shape.applyTransformation(t)}return e}crackBruteForceImpl_(){let e=!1,t=new C.S,s=new C.S,r=E.J.constructEmpty(),i=E.J.constructEmpty(),n=new I.P,a=new eC,o=this.m_shape.getTotalPointCount(),h=o*o*2,l=this.m_shape.queryVertexIteratorOnSelection();for(let o=l.next();o!==C.n;o=l.next()){let m=this.m_shape.getGeometryType(l.currentGeometry()),g=1,u=1,_=1,d=0,p=0,c=0,f=this.m_shape.getSegmentParentage(o),x=!1,P=!1,y=null,E=!1;if((0,S.e)(m))g=this.m_shape.getWeight(o),d=this.m_shape.getRank(o);else{if(null===(y=this.getSegment_(o,t)))continue;let e=this.m_shape.getVertexIndex(o);g=this.m_shape.getWeightWithIndex(e),d=this.m_shape.getRankWithIndex(e),_=this.m_shape.getSegmentWeightWithIndex(e),c=this.m_shape.getSegmentRankWithIndex(e),x=this.m_shape.getSegmentParentageBreakVertex(o);{let e=this.m_shape.getNextVertex(o);u=this.m_shape.getWeight(e),p=this.m_shape.getRank(e),P=this.m_shape.getSegmentParentageBreakVertex(e)}if(y.queryLooseEnvelope(r),r.inflateCoords(this.m_tolerance,this.m_tolerance),y.isDegenerate(this.m_tolerance)){if(!y.isDegenerate(0))continue;E=!0,y=null}}let I=new C.a1({copy:l}),b=I.next();b!==C.n&&(b=I.next());let v=0;for(;b!==C.n;b=I.next()){if(0!==v){v--;continue}if(this.m_shape.getTotalPointCount()>h)return e;this.progress_();let m=this.m_shape.getGeometryType(I.currentGeometry()),G=null,w=!1,T=0,N=0,D=0,V=0,F=0,H=0,k=!1,A=!1,M=this.m_shape.getSegmentParentage(b);if((0,S.e)(m))T=this.m_shape.getWeight(b),V=this.m_shape.getRank(b);else{if(null===(G=this.getSegment_(b,s)))continue;let e=this.m_shape.getVertexIndex(b);T=this.m_shape.getWeightWithIndex(e),V=this.m_shape.getRankWithIndex(e),D=this.m_shape.getSegmentWeightWithIndex(e),H=this.m_shape.getSegmentRankWithIndex(e),k=this.m_shape.getSegmentParentageBreakVertex(b);{let e=this.m_shape.getNextVertex(b);N=this.m_shape.getWeight(e),F=this.m_shape.getRank(e),A=this.m_shape.getSegmentParentageBreakVertex(e)}if(G.queryLooseEnvelope(i),G.isDegenerate(this.m_tolerance)){if(!G.isDegenerate(0))continue;w=!0,G=null}}let U=0,q=0;if(null!==y&&null!==G)r.isIntersectingNe(i)&&0!==(0,C.a2)(!0,!0,y,G,this.m_tolerance,!0)&&(a.pushSegment(y,g,d,u,p,_,c,x,P,f),a.pushSegment(G,T,V,N,F,D,H,k,A,M),a.intersect2D(this.m_tolerance,!0),e||=a.getSegmentChanged(0)||a.getSegmentChanged(1),(U=a.getResultSegmentCount(0))+(q=a.getResultSegmentCount(1))>0&&(this.m_shape.splitSegmentWithIntersector(o,a,0,!0,!0),this.m_shape.splitSegmentWithIntersector(b,a,1,!0,!0),this.m_bTrackChanges&&(a.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(o,!0),a.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(b,!0))),q>1&&(v+=q-1),a.clear());else if(null!==y){let t=this.m_shape.getXY(b);if(r.contains(t)){if(a.pushSegment(y,g,d,u,p,_,c,x,P,f),this.m_shape.queryPoint(b,n),a.intersect2DEx(this.m_tolerance,n,V,T,!1),e||=a.getSegmentChanged(0)||a.getResultPointChanged(),(U=a.getResultSegmentCount(0))>0)if(this.m_bTrackChanges&&(a.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(o,!0),a.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(b,!0)),this.m_shape.splitSegmentWithIntersector(o,a,0,!0,!0),w){let e=C.n;for(let t=this.m_shape.getNextVertex(b);t!==C.n&&t!==b&&(G=this.getSegment_(t,s),e=t,null!=G&&G.isDegenerate(0));t=this.m_shape.getNextVertex(t));for(let t=b;t!==C.n&&(this.m_shape.setPoint(t,a.getResultPoint(),!0),t!==e);t=this.m_shape.getNextVertex(t));}else this.m_shape.setPoint(b,a.getResultPoint(),!0);a.clear()}}else{if(null===G)continue;{let t=this.m_shape.getXY(o);if(i.inflateCoords(this.m_tolerance,this.m_tolerance),i.contains(t)){if(a.pushSegment(G,T,V,N,F,D,H,k,A,M),this.m_shape.queryPoint(o,n),a.intersect2DEx(this.m_tolerance,n,d,g,!1),e||=a.getSegmentChanged(0)||a.getResultPointChanged(),(q=a.getResultSegmentCount(0))>0)if(this.m_bTrackChanges&&(a.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(b,!0),a.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(o,!0)),this.m_shape.splitSegmentWithIntersector(b,a,0,!0,!0),v+=q-1,E){let e=C.n;for(let t=this.m_shape.getNextVertex(o);t!==C.n&&t!==o&&(G=this.getSegment_(t,s),e=t,null!=G&&G.isDegenerate(0));t=this.m_shape.getNextVertex(t));for(let t=o;t!==C.n&&(this.m_shape.setPoint(t,a.getResultPoint(),!0),t!==e);t=this.m_shape.getNextVertex(t));}else this.m_shape.setPoint(o,a.getResultPoint(),!0);a.clear()}}}if(U+q!==0&&0!==U){let e=!1;for(;null!=(y=this.getSegment_(o,t))&&(y.queryEnvelope(r),y.isDegenerate(this.m_tolerance));){if(!(U>1)){e=!0;break}o=l.next(),U--,(0,S.g)(o!==C.n)}if(e)break}}}return e}crackerPlaneSweep_(){return this.planesweep_()}planesweep_(){return new eH(this.m_progressTracker,this.m_bTrackChanges).sweep(this.m_shape,this.m_tolerance)}needsCrackingImpl_(){let e=!1,t=new I.A(0);t.resize(this.m_shape.getSelectedCount());let s=this.m_shape.queryVertexIteratorOnSelection();for(let e=0,r=s.next();r!==C.n;++e,r=s.next())t.write(e,r);this.m_shape.sortVerticesSimpleByY(t,0,t.size()),t.add(C.n);let r=this.m_shape.createUserIndex(),i=this.m_shape.createUserIndex();this.m_sweepComparator=new ed(this.m_shape,this.m_tolerance,!this.m_bAllowCoincident),this.m_sweepStructure.setComparator(this.m_sweepComparator);let n=null,a=[],o=[],h=0,l=new b.P;for(let s=t.read(h++);s!==C.n;){this.m_shape.queryXY(s,l);let m=!1;do{let e=this.m_shape.getNextVertex(s),n=this.m_shape.getPrevVertex(s);m||=e!==C.n||n!==C.n,e===C.n||this.m_shape.selected(e)||(e=C.n),n===C.n||this.m_shape.selected(n)||(n=C.n),e!==C.n&&0>this.m_shape.compareVerticesSimpleY(s,e)&&(o.push(s),o.push(e)),n!==C.n&&0>this.m_shape.compareVerticesSimpleY(s,n)&&(o.push(n),o.push(n));let l=this.m_shape.getUserIndex(s,r);-1!==l&&(a.push(l),this.m_shape.setUserIndex(s,r,-1));let g=this.m_shape.getUserIndex(s,i);-1!==g&&(a.push(g),this.m_shape.setUserIndex(s,i,-1)),s=t.read(h++)}while(s!==C.n&&this.m_shape.isEqualXYPoint2D(s,l));if(!m&&(null===n&&(n=new ep(this.m_shape,this.m_tolerance)),n.setPoint(l),this.m_sweepStructure.searchUpperBound(n),n.intersectionDetected())){e=!0,this.m_bNeedsNonSimpleResult&&((0,S.c)("needsCrackingIMpl_"),this.m_nonSimpleResult=new F(6,-1,-1));break}let g=1===a.length&&2===o.length;a.length>32&&(0,b.v)(a);let u=-1,_=-1;if(!g)for(let t=0,s=a.length;t<s;t++){let s=a[t],r=this.m_sweepStructure.getPrev(s);if(-1!==r&&-1===a.indexOf(r))if(-1===u)u=r;else{if(e=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new F(6,-1,-1)}let i=this.m_sweepStructure.getNext(s);if(-1!==i&&-1===a.indexOf(i))if(-1===_)_=i;else{if(e=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new F(6,-1,-1)}if(-1!==u&&-1!==_)break}if(e&&!this.m_bNeedsNonSimpleResult)break;if(this.m_sweepComparator.setSweepY(l.y,l.x),!g){for(let e=0,t=a.length;e<t;e++){let t=a[e];this.m_sweepStructure.deleteNode(t)}a.length=0}if(!g&&-1!==u&&-1!==_&&this.checkForIntersections_(u,_)){e=!0,this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult());break}for(let t=0,s=o.length;t<s;t+=2){let s,n=o[t],h=o[t+1];if(g?(s=this.m_sweepStructure.replaceElementAtPosition(a[0],n,!0,!0),a.length=0,g=!1):s=this.m_sweepStructure.addElement(n),this.m_sweepComparator.intersectionDetected()){this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult()),e=!0;break}-1===this.m_shape.getUserIndex(h,r)?this.m_shape.setUserIndex(h,r,s):this.m_shape.setUserIndex(h,i,s)}if(e)break;o.length=0}return this.m_shape.removeUserIndex(r),this.m_shape.removeUserIndex(i),e}checkForIntersections_(e,t){let s=this.m_sweepStructure.getElement(e);this.m_sweepComparator.compare(this.m_sweepStructure,s,t);let r=this.m_sweepComparator.intersectionDetected();return this.m_sweepComparator.clearIntersectionDetectedFlag(),r}getSegment_(e,t){return eq.st_getSegment(this.m_shape,e,t)}static st_getSegment(e,t,s){return e.querySegment(t,s,!1,!1)?s.get():null}dbgPrintSweepEdge(e){}dbgPrintSweepStructure(){}dbgSaveSweepStructure(e=null){}dbgCheckSweepStructure(){}progress_(e=!1){this.m_progressCounter++}crackAWithBMultiPath_(e,t,s){let r=E.J.constructEmpty();e.queryLooseEnvelope(r);let i=E.J.constructEmpty();if(t.queryLooseEnvelope(i),i.inflateCoords(s,s),!i.isIntersecting(r))return e;let n=e.getImpl(),a=n.getAccelerators(),o=null,h=null;a&&(h=a.getQuadTree()),function(e,t){let s=e.getPointCount();return!(s<16)&&2*s+Math.log(s)/Math.log(2)*1*t<s*t}(e,(0,S.v)(t))&&(h=(0,I.G)(n,i));let l=h?h.getIteratorForQT():null,m=t.querySegmentIterator(),g=e.querySegmentIterator(),u=(0,b.d)(15,Number.NaN),_=[];for(;m.nextPath();)for(;m.hasNextSegment();){let e=m.nextSegment();if(h){l.resetIterator(e,s);for(let t=l.next();-1!==t;t=l.next()){this.progress_();let r=h.getElement(t);if(g.resetToVertex(r,-1),g.hasNextSegment()){let t=g.nextSegment().intersect(e,null,u,null,s);for(let e=0;e<t;e++){let t=u[e];if(0===t||1===t)continue;let s={t:t,index:g.getStartPointIndex()};_.push(s)}}}}else{let t=E.J.constructEmpty();if(e.queryLooseEnvelope(t),t.inflateCoords(s,s),!r.isIntersecting(t))continue;for(g.resetToFirstPath();g.nextPath();)for(;g.hasNextSegment();){let r=g.nextSegment(),i=E.J.constructEmpty();if(r.queryLooseEnvelope(i),!i.isIntersecting(t))continue;let n=r.intersect(e,null,u,null,s);for(let e=0;e<n;e++){let t=u[e];if(0===t||1===t)continue;let s={t:t,index:g.getStartPointIndex()};_.push(s)}}}}if(0===_.length)return e;_.sort((e,t)=>e.index<t.index?-1:e.index>t.index?1:e.t<t.t?-1:+(e.t>t.t));let d=e.createInstance();for(d.getGeometryType()===S.G.enumPolygon&&d.setFillRule(e.getFillRule()),g.resetToFirstPath();g.nextPath()&&!g.hasNextSegment(););(0,S.g)(g.hasNextSegment());let p=g.nextSegment(),c=new C.S,f=-1;for(let e=0,t=_.length;e<t;){let s=_[e].index,r=e+1;for(;r<t&&_[r].index===s;)++r;for(;g.getStartPointIndex()<s;){this.progress_();let e=g.hasNextSegment(),t=g.getPathIndex();if((e||!g.isClosingSegment()||g.isCurve())&&((0,S.g)(null!==p),d.addSegment(p,f!==t)),f=t,!e){for(g.isPathClosed();g.nextPath()&&!g.hasNextSegment(););(0,S.g)(g.hasNextSegment())}p=g.nextSegment()}let i=0;for(let t=e;t<r;t++){let e=_[t].t;if(e===i)continue;(0,S.g)(null!==p),p.queryCut(i,e,c),i=e;let s=g.getPathIndex();d.addSegment(c.get(),f!==s),f=s}let n=g.hasNextSegment();if((n||!g.isClosingSegment()||g.isCurve())&&((0,S.g)(null!=p),p.queryCut(i,1,c),d.addSegment(c.get(),!1)),n)p=g.nextSegment();else{for(;g.nextPath()&&!g.hasNextSegment(););p=g.hasNextSegment()?g.nextSegment():null}e=r}if(null!==p){let e=g.getPathIndex();(g.hasNextSegment()||!g.isClosingSegment()||g.isCurve())&&d.addSegment(p,f!==e),f=e}let x=g.hasNextSegment();for(;;){if(!x){for(;g.nextPath()&&!(x=g.hasNextSegment()););if(!x)break}p=g.nextSegment();let e=g.getPathIndex();((x=g.hasNextSegment())||!g.isClosingSegment()||g.isCurve())&&d.addSegment(p,f!==e),f=e}return d}constructor(e){this.m_shape=null,this.m_progressTracker=null,this.m_nonSimpleResult=new F,this.m_tolerance=0,this.m_sweepComparator=null,this.m_progressCounter=0,this.m_bTrackChanges=!1,this.m_bNeedsNonSimpleResult=!1,this.m_bAllowCoincident=!0,this.m_sweepStructure=new I.T,this.m_progressTracker=e}}eq.s_bForceBruteForce=!0;class eO{constructor(e,t){this.m_monotoneParts=(0,b.m)(C.S,16),this.m_xOrds=(0,b.d)(16,Number.NaN),this.m_inputPoint=b.P.getNAN(),this.m_miny=0,this.m_maxy=0,this.m_windnum=0,this.m_bAlternate=e,this.m_tolerance=t,this.m_toleranceSqr=t*t,this.m_bTestBorder=!!t,this.m_bBreak=!1}_DoOne(e){if(!this.m_bTestBorder&&(this.m_bAlternate&&this.m_inputPoint.equals(e.getStartXY())||this.m_inputPoint.equals(e.getEndXY())))return void(this.m_bBreak=!0);if(e.getStartY()===this.m_inputPoint.y&&e.getStartY()===e.getEndY()){if(this.m_bAlternate&&!this.m_bTestBorder){let t=Math.min(e.getStartX(),e.getEndX()),s=Math.max(e.getStartX(),e.getEndX());this.m_inputPoint.x>t&&this.m_inputPoint.x<s&&(this.m_bBreak=!0)}return}let t=!1,s=Math.max(e.getStartX(),e.getEndX());if(this.m_inputPoint.x>s)t=!0;else if(this.m_inputPoint.x>=Math.min(e.getStartX(),e.getEndX())){let r=e.intersectionOfYMonotonicWithAxisX(this.m_inputPoint.y,s);t=!Number.isNaN(r)&&r<=this.m_inputPoint.x}if(t){if(this.m_inputPoint.y===e.getStartY()){if(this.m_inputPoint.y<e.getEndY())return}else if(this.m_inputPoint.y===e.getEndY()&&this.m_inputPoint.y<e.getStartY())return;this.m_bAlternate?this.m_windnum^=1:this.m_windnum+=e.getStartY()>e.getEndY()?1:-1}}_Result(){return!!this.m_windnum}testBorder(e){let t=e.getClosestCoordinate(this.m_inputPoint,!1),s=e.getCoord2D(t);return b.P.sqrDistance(s,this.m_inputPoint)<=this.m_toleranceSqr}setInputPoint(e){this.m_inputPoint.setCoordsPoint2D(e),this.m_miny=e.y-this.m_tolerance,this.m_maxy=e.y+this.m_tolerance}processSegment(e){let t=e.queryInterval(0,1);if(t.vmin>this.m_maxy||t.vmax<this.m_miny)return!1;if(this.m_bTestBorder&&this.testBorder(e))return!0;if(t.vmin>this.m_inputPoint.y||t.vmax<this.m_inputPoint.y)return!1;let s=0;if(e.isCurve()&&(0===this.m_monotoneParts.length&&(this.m_monotoneParts.length=128),s=e.getMonotonicParts(this.m_monotoneParts,!0),(0,S.g)(this.m_monotoneParts.length>=s)),s>0)for(let e=0;e<s;e++){let t=this.m_monotoneParts[e].get(),s=b.E.construct(t.getStartY(),t.getEndY());if(!(s.vmin>this.m_inputPoint.y||s.vmax<this.m_inputPoint.y)&&(this._DoOne(t),this.m_bBreak))return!0}else if(this._DoOne(e),this.m_bBreak)return!0;return!1}result(){return(0,S.g)(0),2}}function eB(e,t,s){if(e.isEmpty())return 0;let r=E.J.constructEmpty();if(e.queryLooseEnvelope(r),r.inflateCoords(s,s),!r.contains(t))return 0;let i=e.getImpl().getAccelerators();if(i){i.getRasterizedGeometry()&&(0,S.g)(0);let r=i.getQuadTree();if(r)return function(e,t,s,r){let i=new E.J;e.queryLooseEnvelope(i),i.inflateCoords(r,r);let n=new eO(0===e.getFillRule(),r);n.setInputPoint(s);let a=i.clone();a.xmax=s.x+r,a.ymin=s.y-r,a.ymax=s.y+r;let o=e.getImpl().querySegmentIterator(),h=t.getIterator(a,r);for(let e=h.next();-1!==e;e=h.next())if(o.resetToVertex(t.getElement(e),-1),o.hasNextSegment()){let e=o.nextSegment();if(n.processSegment(e))return -1}return+!!n._Result()}(e,r,t,s)}let n=new eO(0===e.getFillRule(),s);n.setInputPoint(t);let a=e.getImpl().querySegmentIterator();for(;a.nextPath();)for(;a.hasNextSegment();){let e=a.nextSegment();if(n.processSegment(e))return -1}return+!!n._Result()}function eR(e,t){let s=e.getPointCount();return!(s<16)&&2*s+Math.log(s)/Math.log(2)*1*t<s*t}function eY(e,t,s){let r=new eJ(s);return r.m_shape=e,r.m_geometry=t,r.m_sortedVertices=null,r.m_bFixSelfTangency=!1,r.fixRingOrientationForMp2sp_()}class eX{getDirection_(e){return this.m_shape.getNextVertex(this.getEnd1(e))===this.getEnd2(e)}getEnd_(e){let t=this.getEnd1(e),s=this.getEnd2(e);return this.m_shape.getNextVertex(t)===s?s:t}constructor(e){this.m_end1Nodes=[],this.m_end2Nodes=[],this.m_directions=[],this.m_shape=e,this.m_firstFree=-1}getSegment(e){return this.m_shape.getSegment(this.getStart(e))}isBottomUp(e){let t=this.getEnd1(e),s=this.getEnd2(e);this.m_shape.getPrevVertex(t)===s&&(s=(0,b.b)(t,t=s));let r=b.P.getNAN(),i=b.P.getNAN();return this.m_shape.queryXY(t,r),this.m_shape.queryXY(s,i),(0,S.g)(!r.equals(i)),r.y<i.y}getStart(e){let t=this.getEnd1(e),s=this.getEnd2(e);return this.m_shape.getNextVertex(t)===s?t:s}getEnd1(e){return this.m_end1Nodes[e]}getEnd2(e){return this.m_end2Nodes[e]}freeEdge(e){this.m_end1Nodes[e]=this.m_firstFree,this.m_firstFree=e}newEdge(e){if(-1!==this.m_firstFree){let t=this.m_firstFree;return this.m_firstFree=this.m_end1Nodes[t],this.m_end1Nodes[t]=e,this.m_end2Nodes[t]=this.m_shape.getNextVertex(e),t}let t=this.m_end1Nodes.length;return this.m_end1Nodes.push(e),this.m_end2Nodes.push(this.m_shape.getNextVertex(e)),t}getShape(){return this.m_shape}getPath(e){return this.m_shape.getPathFromVertex(this.getEnd1(e))}}let eL=class extends I.a6{constructor(e){super(),this.m_line1=new C.L,this.m_line2=new C.L,this.m_leftElm=-1,this.m_leftx=0,this.m_seg1=null,this.m_helper=e}compare(e,t,s){let r,i=e.getElement(s),n=this.m_helper.m_edges;this.m_leftElm===t?r=this.m_leftx:((this.m_seg1=n.getSegment(t),this.m_seg1)?r=this.m_seg1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(n.getShape().queryLineConnector(n.getStart(t),this.m_line1,!0),this.m_seg1=this.m_line1,r=this.m_line1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),this.m_leftx=r,this.m_leftElm=t);let a,o=n.getSegment(i);if(o?a=o.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(n.getShape().queryLineConnector(n.getStart(i),this.m_line2,!0),o=this.m_line2,a=this.m_line2.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),r===a){let e=n.isBottomUp(t),s=n.isBottomUp(i),h=Math.min(e?this.m_seg1.getEndY():this.m_seg1.getStartY(),s?o.getEndY():o.getStartY()),l=.5*(h+this.m_helper.m_yScanline);l===this.m_helper.m_yScanline&&(l=h),(r=this.m_seg1.intersectionOfYMonotonicWithAxisX(l,0))===(a=o.intersectionOfYMonotonicWithAxisX(l,0))&&(0,S.D)("")}return r<a?-1:+(r>a)}reset(){this.m_leftElm=-1}};class ez{constructor(e){this.m_node=-1,this.m_index=0,this.m_sortedVertices=e.m_sortedVertices,this.m_sortedVerticesArray=e.m_sortedVerticesArray,this.m_sortedVertices&&(this.m_node=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList()))}next(){if(this.m_sortedVertices){let e=this.m_node;if(-1===e)return C.n;let t=this.m_sortedVertices.getData(e);return this.m_node=this.m_sortedVertices.getNext(e),t}if(this.m_index<this.m_sortedVerticesArray.size()){let e=this.m_sortedVerticesArray.read(this.m_index);return this.m_index++,e}return C.n}}class eJ{constructor(e){this.m_edges=null,this.m_shape=null,this.m_AET=new I.T,this.m_yScanline=0,this.m_geometry=C.n,this.m_unknownRingOrientationCount=-1,this.m_sortedVertices=null,this.m_sortedVerticesArray=null,this.m_unknownNodes=[],this.m_node1UserIndex=-1,this.m_node2UserIndex=-1,this.m_pathOrientationIndex=-1,this.m_pathParentageIndex=-1,this.m_pathParentsIndex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_progressTracker=e,this.m_AET.disableBalancing(),this.m_sweepComparator=new eL(this),this.m_AET.setComparator(this.m_sweepComparator)}fixRingOrientation_(){let e=this.fixRingOrientationImplMain_();return -1===this.m_pathOrientationIndex||this.fixRingOrientationImplSimplify_(),e}fixRingOrientationForMp2sp_(){return this.fixRingOrientationImplMain_(),-1===this.m_pathOrientationIndex?-1:this.fixRingOrientationImplMp2sp_()}processBunchForRingOrientationTest_(e){return this.processBunchForRingOrientationTestOddEven_(e)}processBunchForRingOrientationTestOddEven_(e){let t=!1;if(this.m_edges||(this.m_edges=new eX(this.m_shape)),this.m_unknownNodes.length=0,this.processBunchForRingOrientationRemoveEdges_(e),!this.m_AET.isAutoBalancing()){let t=0;for(let s=0,r=e.length;s<r;s++)-1!==e[s]&&t++;(t>10||this.m_AET.getMaxDepthEver()>4)&&this.m_AET.enableBalancing()}for(let t=0,s=e.length;t<s;t++){let s=e[t];s!==C.n&&this.insertEdge_(s,-1)}for(let e=0;e<this.m_unknownNodes.length&&this.m_unknownRingOrientationCount>0;e++){let s=this.m_unknownNodes[e],r=this.m_AET.getElement(s),i=this.m_edges.getPath(r),n=this.m_shape.getPathUserIndex(i,this.m_pathOrientationIndex),a=C.n;if(0===n){let e=this.m_AET.getPrev(s),r=s,i=!1;for(;e!==I.T.st_nullNode();){let t=this.m_AET.getElement(e),s=this.m_edges.getPath(t);if(0!==this.m_shape.getPathUserIndex(s,this.m_pathOrientationIndex)){a=s;break}r=e,e=this.m_AET.getPrev(e)}if(e===I.T.st_nullNode())i=!0,e=r;else{let t=this.m_AET.getElement(e);i=this.m_edges.isBottomUp(t),e=this.m_AET.getNext(e),i=!i}do{let s=this.m_AET.getElement(e),n=this.m_edges.getPath(s);if(0===this.m_shape.getPathUserIndex(n,this.m_pathOrientationIndex)){if(i!==this.m_edges.isBottomUp(s)){let e=this.m_shape.getFirstVertex(n);this.m_shape.reverseRingInternal(e),this.m_shape.setLastVertex(n,this.m_shape.getPrevVertex(e)),t=!0}if(this.m_shape.setPathUserIndex(n,this.m_pathOrientationIndex,i?3:2),!i){let e=this.m_shape.getPathUserIndex(a,this.m_pathOrientationIndex);2===e&&(a=this.m_shape.getPathUserIndex(a,this.m_pathParentsIndex),e=this.m_shape.getPathUserIndex(a,this.m_pathOrientationIndex)),(0,S.g)(3===e);let t=this.m_shape.getPathUserIndex(a,this.m_pathParentageIndex);this.m_shape.setPathUserIndex(a,this.m_pathParentageIndex,n),this.m_shape.setPathUserIndex(n,this.m_pathParentageIndex,t),this.m_shape.setPathUserIndex(n,this.m_pathParentsIndex,a)}if(this.m_unknownRingOrientationCount--,!this.m_unknownRingOrientationCount)return t}a=n,r=e,e=this.m_AET.getNext(e),i=!i}while(r!==s)}}return t}processBunchForRingOrientationRemoveEdges_(e){for(let t=0,s=e.length;t<s;t++){let s=e[t],r=this.m_shape.getUserIndex(s,this.m_node1UserIndex),i=this.m_shape.getUserIndex(s,this.m_node2UserIndex);if(-1!==r){let e=this.m_AET.getElement(r);this.m_edges.freeEdge(e),this.m_shape.setUserIndex(s,this.m_node1UserIndex,-1)}if(-1!==i){let e=this.m_AET.getElement(i);this.m_edges.freeEdge(e),this.m_shape.setUserIndex(s,this.m_node2UserIndex,-1)}let n=-1;-1!==r&&-1!==i?(this.m_AET.deleteNode(r),this.m_AET.deleteNode(i),e[t]=C.n):n=-1!==r?r:i,-1!==n&&(this.insertEdge_(s,n)||this.m_AET.deleteNode(n),e[t]=C.n)}}dbgVerifyRingOrientation_(){}insertEdge_(e,t){let s=b.P.getNAN(),r=b.P.getNAN();this.m_shape.queryXY(e,s);let i=this.m_shape.getNextVertex(e);this.m_shape.queryXY(i,r);let n=!1;if(s.y<r.y){let s;n=!0;let r=this.m_edges.newEdge(e);-1===t?s=this.m_AET.addElement(r):(s=t,this.m_AET.setElement(s,r)),-1===this.m_shape.getUserIndex(i,this.m_node1UserIndex)?this.m_shape.setUserIndex(i,this.m_node1UserIndex,s):this.m_shape.setUserIndex(i,this.m_node2UserIndex,s);let a=this.m_shape.getPathFromVertex(e);0===this.m_shape.getPathUserIndex(a,this.m_pathOrientationIndex)&&this.m_unknownNodes.push(s)}let a=this.m_shape.getPrevVertex(e);if(this.m_shape.queryXY(a,r),s.y<r.y){let s;n=!0;let r=this.m_edges.newEdge(a);-1===t?s=this.m_AET.addElement(r):(s=t,this.m_AET.setElement(s,r)),-1===this.m_shape.getUserIndex(a,this.m_node1UserIndex)?this.m_shape.setUserIndex(a,this.m_node1UserIndex,s):this.m_shape.setUserIndex(a,this.m_node2UserIndex,s);let i=this.m_shape.getPathFromVertex(e);0===this.m_shape.getPathUserIndex(i,this.m_pathOrientationIndex)&&this.m_unknownNodes.push(s)}return n}fixRingSelfTangency_(){let e=[],t=[],s=-1,r=-1,i=new b.P,n=C.n,a=C.n,o=-1,h=new ez(this);for(let l=h.next();l!==C.n;l=h.next()){let h=new b.P;this.m_shape.queryXY(l,h);let m=this.m_shape.getPathFromVertex(l);i.equals(h)&&a===m?(-1===r&&(s=this.m_shape.createPathUserIndex(),this.m_shape.fillPathUserIndexForGeometry(this.m_geometry,s,-1),r=this.m_shape.createUserIndex(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,r,-1)),-1===o&&(o=t.length,this.m_shape.setUserIndex(n,r,o),t.push(1),-1===this.m_shape.getPathUserIndex(m,s)&&(this.m_shape.setPathUserIndex(m,s,n),e.push(m))),this.m_shape.setUserIndex(l,r,o),t[t.length-1]++):(o=-1,i.assign(h)),n=l,a=m}if(0===e.length)return!1;(0,S.g)(-1!==s);for(let i=0,n=e.length;i<n;i++){let n=e[i],a=this.m_shape.getPathUserIndex(n,s),o=this.m_shape.getUserIndex(a,r),h=[],l=[];h.push(a),l.push(o);for(let e=this.m_shape.getNextVertex(a);e!==a;e=this.m_shape.getNextVertex(e)){let s=e,i=this.m_shape.getUserIndex(s,r);if(-1!==i){if(0===l.length){l.push(i),h.push(s);continue}if(l.at(-1)===i){let n=h.at(-1);this.m_shape.peelALoopIntoAPath(n,s),this.m_shape.setUserIndex(e,r,-1),t[i]--,1===t[i]&&(t[i]=0,l.pop(),h.pop()),a=n,e=n}else h.push(e),l.push(i)}}}return this.m_shape.removePathUserIndex(s),this.m_shape.removeUserIndex(r),this.m_shape.dbgVerifyVertexCounts(),!0}progress_(e=!1){}fixRingOrientationImplMain_(){let e={stack:[],error:void 0,hasError:!1};try{let t,s=!1,r=(0,v.b)(e,(0,b.h)(()=>{this.m_sortedVerticesArray=null}),!1);if(null===this.m_sortedVertices){let e=this.m_shape.getPointCount(this.m_geometry);t=new I.A(0);for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==C.n;e=this.m_shape.getNextPath(e)){let s=this.m_shape.getFirstVertex(e);for(let r=0,i=this.m_shape.getPathSize(e);r<i;r++)t.add(s),s=this.m_shape.getNextVertex(s)}this.m_shape.sortVerticesSimpleByY(t,0,e),this.progress_(!0),this.m_sortedVerticesArray=t}else r.bForget=!0;if(this.m_bFixSelfTangency&&(s=this.fixRingSelfTangency_()),1===this.m_shape.getPathCount(this.m_geometry)){let e=this.m_shape.getFirstPath(this.m_geometry),t=this.m_shape.getRingArea(e);if(this.m_shape.setExterior(e,!0),t<0){let t=this.m_shape.getFirstVertex(e);return this.m_shape.reverseRingInternal(t),this.m_shape.setLastVertex(e,this.m_shape.getPrevVertex(t)),!0}return!1}this.m_shape.dbgVerifyCurves(),this.m_pathOrientationIndex=this.m_shape.createPathUserIndex(),this.m_pathParentageIndex=this.m_shape.createPathUserIndex(),this.m_pathParentsIndex=this.m_shape.createPathUserIndex();for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==C.n;e=this.m_shape.getNextPath(e))this.m_shape.setPathUserIndex(e,this.m_pathOrientationIndex,0),this.m_shape.setPathUserIndex(e,this.m_pathParentageIndex,-1),this.m_shape.setPathUserIndex(e,this.m_pathParentsIndex,-1);let i=[];this.m_yScanline=Number.NaN;let n=b.P.getNAN();this.m_unknownRingOrientationCount=this.m_shape.getPathCount(this.m_geometry),this.m_node1UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node1UserIndex,-1),this.m_node2UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node2UserIndex,-1);let a=new ez(this);for(let e=a.next();e!==C.n&&(this.progress_(),this.m_shape.queryXY(e,n),n.y!==this.m_yScanline&&i.length&&(s=this.processBunchForRingOrientationTest_(i)||s,this.m_sweepComparator.reset(),i.length=0),i.push(e),this.m_yScanline=n.y,0!==this.m_unknownRingOrientationCount);e=a.next());return this.m_unknownRingOrientationCount>0&&(s=this.processBunchForRingOrientationTest_(i)||s,i.length=0),this.m_shape.removeUserIndex(this.m_node1UserIndex),this.m_shape.removeUserIndex(this.m_node2UserIndex),this.dbgVerifyRingOrientation_(),s}catch(t){e.error=t,e.hasError=!0}finally{(0,v.c)(e)}}fixRingOrientationImplSimplify_(){let e=[];for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==C.n;)if(this.progress_(),3===this.m_shape.getPathUserIndex(t,this.m_pathOrientationIndex)){this.m_shape.setExterior(t,!0);for(let s=this.m_shape.getPathUserIndex(t,this.m_pathParentageIndex);s!==C.n;){let r=this.m_shape.getPathUserIndex(s,this.m_pathParentageIndex);e.push(s),this.m_shape.setExterior(s,!1),this.m_shape.setPathUserIndex(s,this.m_pathParentageIndex,t),s=r}let s=t,r=e.length;for(let e=this.m_shape.getNextPath(t);r>0&&e!==C.n;e=this.m_shape.getNextPath(e),--r){if(this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex)!==t){s=C.n;break}s=e}if(0!==r){s=t;for(let t=0,r=e.length;t<r;t++){let r=e[t];this.m_shape.setPathUserIndex(r,this.m_pathParentageIndex,I.X),this.m_shape.movePath(this.m_geometry,this.m_shape.getNextPath(s),r),s=r}}e.length=0,t=this.m_shape.getNextPath(s)}else t=this.m_shape.getNextPath(t);this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex)}fixRingOrientationImplMp2sp_(){let e=this.m_shape.createPathUserIndex(),t=0,s=[];for(let r=this.m_shape.getFirstPath(this.m_geometry);r!==C.n;)if(this.progress_(),3===this.m_shape.getPathUserIndex(r,this.m_pathOrientationIndex)){this.m_shape.setExterior(r,!0),this.m_shape.setPathUserIndex(r,e,t),t++;for(let e=this.m_shape.getPathUserIndex(r,this.m_pathParentageIndex);e!==C.n;){let t=this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex);s.push(e),this.m_shape.setExterior(e,!1),this.m_shape.setPathUserIndex(e,this.m_pathParentageIndex,r),e=t}let i=r,n=s.length,a=t;for(let t=this.m_shape.getNextPath(r);n>0&&t!==C.n;t=this.m_shape.getNextPath(t),--n){if(this.m_shape.getPathUserIndex(t,this.m_pathParentageIndex)!==r){i=C.n;break}i=t,this.m_shape.setPathUserIndex(t,e,-a),a++}if(0!==n){i=r,a=t;for(let t=0,r=s.length;t<r;t++){let r=s[t];this.m_shape.setPathUserIndex(r,e,-a),a++,this.m_shape.setPathUserIndex(r,this.m_pathParentageIndex,I.X)}i=r}t=a,s.length=0,r=this.m_shape.getNextPath(i)}else r=this.m_shape.getNextPath(r);return this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex),e}}function eW(e,t,s,r,i,n){let a=new ej(n);return a.m_shape=e,a.m_geometry=t,a.m_knownSimpleResult=s,a.m_bFixSelfTangency=r,a.m_polylineDegeneracies=i,a.m_bHasSegmentParentage=e.hasSegmentParentage(),a.m_bHasSegments=e.hasCurves(),a.simplify_()}class ej{constructor(e){this.m_shape=null,this.m_geometry=C.n,this.m_sortedVertices=new I.a2,this.m_bunchEdgeEndPoints=[],this.m_bunchEdgeCenterPoints=[],this.m_bunchEdgeIndices=[],this.m_knownSimpleResult=-1,this.m_sortedVerticesListIndex=-1,this.m_polylineDegeneracies=C.n,this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_bHasSegmentParentage=!1,this.m_bHasSegments=!1,this.m_progressTracker=e}compareAngles_(e,t){if(this.m_bHasSegments)return this.compareAnglesCurves_(e,t);let s=this.m_bunchEdgeEndPoints[e],r=new b.P;this.m_shape.queryXY(s,r);let i=new b.P,n=this.m_bunchEdgeEndPoints[t];if(this.m_shape.queryXY(n,i),r.equals(i))return 0;let a=this.m_bunchEdgeCenterPoints[e],o=new b.P;this.m_shape.queryXY(a,o);let h=this.m_bunchEdgeCenterPoints[t],l=new b.P;this.m_shape.queryXY(h,l);let m=new b.P;m.setSub(r,o);let g=new b.P;return g.setSub(i,l),(m.isZero()||g.isZero())&&(0,S.D)(""),b.P.compareVectors(m,g)}compareAnglesCurves_(e,t){let s=this.m_bunchEdgeEndPoints[e],r=this.m_bunchEdgeEndPoints[t],i=this.m_bunchEdgeCenterPoints[e],n=this.m_bunchEdgeCenterPoints[t],a=this.m_shape.getNextVertex(i)===s,o=this.m_shape.getNextVertex(n)===r,h=new C.S,l=new b.P;a?(this.m_shape.querySegment(i,h,!1,!0),l.assign(h.get().getTangent(0))):(this.m_shape.querySegment(s,h,!1,!0),l.assign(h.get().getTangent(1)),l.negateThis());let m=new b.P;return o?(this.m_shape.querySegment(n,h,!1,!0),m.assign(h.get().getTangent(0))):(this.m_shape.querySegment(r,h,!1,!0),m.assign(h.get().getTangent(1)),m.negateThis()),(l.isZero()||m.isZero())&&(0,S.D)(""),b.P.compareVectors(l,m)}beforeRemoveVertex_(e,t){let s=this.m_shape.getUserIndex(e,this.m_userIndexSortedIndexToVertex);if(this.m_nextVertexToProcess===s&&(this.m_nextVertexToProcess=this.m_sortedVertices.getNext(this.m_nextVertexToProcess)),this.m_firstCoincidentVertex===s&&(this.m_firstCoincidentVertex=this.m_sortedVertices.getNext(this.m_firstCoincidentVertex)),this.m_sortedVertices.deleteElement(this.m_sortedVerticesListIndex,s),this.removeAngleSortInfo_(e),t){let t=this.m_shape.getPathFromVertex(e);if(t!==C.n&&this.m_shape.getFirstVertex(t)===e){let s=this.m_shape.getNextVertex(e);if(s!==e){if(this.m_shape.getPathFromVertex(s)===t)return void this.m_shape.setFirstVertex(t,s);{let s=this.m_shape.getPrevVertex(e);if(s!==e&&this.m_shape.getPathFromVertex(s)===t)return void this.m_shape.setFirstVertex(t,s)}}this.m_shape.setFirstVertex(t,C.n),this.m_shape.setLastVertex(t,C.n)}}}processBunch_(){let e=!1,t=new b.P(0,0);for(;;){this.m_bunchEdgeEndPoints.length=0,this.m_bunchEdgeCenterPoints.length=0,this.m_bunchEdgeIndices.length=0;let s=this.m_firstCoincidentVertex,r=0,i=!0;for(;s!==this.m_nextVertexToProcess;){let e=this.m_sortedVertices.getData(s);i&&(this.m_shape.queryXY(e,t),i=!1);let n=this.m_shape.getPrevVertex(e),a=this.m_shape.getNextVertex(e);this.m_shape.getUserIndex(n,this.m_userIndexSortedAngleIndexToVertex)!==I.X&&(this.m_bunchEdgeEndPoints.push(n),this.m_shape.setUserIndex(n,this.m_userIndexSortedAngleIndexToVertex,I.X),this.m_bunchEdgeCenterPoints.push(e),this.m_bunchEdgeIndices.push(r++)),this.m_shape.getUserIndex(a,this.m_userIndexSortedAngleIndexToVertex)!==I.X&&(this.m_bunchEdgeEndPoints.push(a),this.m_shape.setUserIndex(a,this.m_userIndexSortedAngleIndexToVertex,I.X),this.m_bunchEdgeCenterPoints.push(e),this.m_bunchEdgeIndices.push(r++)),s=this.m_sortedVertices.getNext(s)}if(this.m_bunchEdgeEndPoints.length<2){1===this.m_bunchEdgeEndPoints.length&&this.m_shape.setUserIndex(this.m_bunchEdgeEndPoints[0],this.m_userIndexSortedAngleIndexToVertex,-1);break}this.m_bunchEdgeIndices.sort((e,t)=>this.compareAngles_(e,t));for(let e=0,t=this.m_bunchEdgeIndices.length;e<t;e++){let t=this.m_bunchEdgeIndices[e],s=this.m_bunchEdgeEndPoints[t];this.m_shape.setUserIndex(s,this.m_userIndexSortedAngleIndexToVertex,e)}let n=this.processCrossOvers_(t);for(let e=0,t=this.m_bunchEdgeIndices.length;e<t;e++){let t=this.m_bunchEdgeIndices[e];if(-1===t)continue;let s=this.m_bunchEdgeEndPoints[t];this.m_shape.setUserIndex(s,this.m_userIndexSortedAngleIndexToVertex,-1)}if(!n)break;e=!0}return e}processCrossOvers_(e){let t=!1,s=!0;for(;s;){s=!1;let r=0;-1===this.m_bunchEdgeIndices[r]&&(r=this.getNextEdgeIndex_(r));let i=this.getNextEdgeIndex_(r);for(let n=0,a=this.m_bunchEdgeIndices.length;n<a&&-1!==r&&-1!==i&&r!==i;n++){let n=this.m_bunchEdgeIndices[r],a=this.m_bunchEdgeIndices[i],o=this.m_bunchEdgeEndPoints[n],h=this.m_bunchEdgeEndPoints[a],l=this.m_shape.getNextVertex(o),m=!1;this.m_shape.isEqualXYPoint2D(l,e)||(l=this.m_shape.getPrevVertex(o),m=!0);let g=this.m_shape.getNextVertex(h),u=!1;this.m_shape.isEqualXYPoint2D(g,e)||(g=this.m_shape.getPrevVertex(h),u=!0);let _=m?this.m_shape.getPrevVertex(l):this.m_shape.getNextVertex(l),d=u?this.m_shape.getPrevVertex(g):this.m_shape.getNextVertex(g),p=!1;(this.removeSpike_(l)||this.removeSpike_(g)||this.removeSpike_(o)||this.removeSpike_(h)||this.removeSpike_(_)||this.removeSpike_(d))&&(p=!0),l!==g&&(!p&&this.m_shape.isEqualXY(o,h)&&(p=this.resolveOverlap_(m,u,l,o,g,h)),!p&&this.m_shape.isEqualXY(_,d)&&(p=this.resolveOverlap_(!m,!u,l,_,g,d)),!p&&this.m_shape.isEqualXY(o,d)&&(p=this.resolveOverlap_(m,!u,l,o,g,d)),!p&&this.m_shape.isEqualXY(_,h)&&(p=this.resolveOverlap_(!m,u,l,_,g,h))),p&&(t=!0),s||=p,r=p?this.getNextEdgeIndex_(r):i,i=this.getNextEdgeIndex_(r)}}if(!t){let s=0;-1===this.m_bunchEdgeIndices[s]&&(s=this.getNextEdgeIndex_(s));let r=this.getNextEdgeIndex_(s);for(let i=0,n=this.m_bunchEdgeIndices.length;i<n&&-1!==s&&-1!==r&&s!==r;i++){let i=this.m_bunchEdgeIndices[s],n=this.m_bunchEdgeIndices[r],a=this.m_bunchEdgeEndPoints[i],o=this.m_bunchEdgeEndPoints[n],h=this.m_shape.getNextVertex(a);this.m_shape.isEqualXYPoint2D(h,e)||(h=this.m_shape.getPrevVertex(a));let l=this.m_shape.getNextVertex(o);this.m_shape.isEqualXYPoint2D(l,e)||(l=this.m_shape.getPrevVertex(o));let m=this.getDirection_(h,a),g=this.getDirection_(l,o),u=m?this.m_shape.getPrevVertex(h):this.m_shape.getNextVertex(h),_=g?this.m_shape.getPrevVertex(l):this.m_shape.getNextVertex(l),d=this.detectAndResolveCrossOver_(m,g,a,h,u,o,l,_);1!==d?(s=0===d?this.getNextEdgeIndex_(s):this.getPrevEdgeIndex_(s),r=this.getNextEdgeIndex_(s)):t=!0}}return t}simplify_(){this.m_shape.getGeometryType(this.m_geometry)===S.G.enumPolygon&&1===this.m_shape.getFillRule(this.m_geometry)&&new sC(this.m_progressTracker).planarSimplifyNoCrackingAndCluster(this.m_bFixSelfTangency,this.m_shape,this.m_geometry,0);let e=!1;this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=this.m_shape.createUserIndexUninitialized();let t=this.m_shape.getPointCount(this.m_geometry),s=new I.A(0);this.m_shape.dbgVerifyMonotone();for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==C.n;e=this.m_shape.getNextPath(e)){let t=this.m_shape.getFirstVertex(e);for(let r=0,i=this.m_shape.getPathSize(e);r<i;r++)this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,-1),s.add(t),t=this.m_shape.getNextVertex(t)}this.m_shape.sortVerticesSimpleByY(s,0,t),this.progress_(!0),this.m_userIndexSortedIndexToVertex=this.m_shape.createUserIndexUninitialized(),this.m_sortedVertices.reserveNodes(t),this.m_sortedVerticesListIndex=this.m_sortedVertices.createList(0);for(let e=0;e<t;e++){let t=s.read(e),r=this.m_sortedVertices.addElement(this.m_sortedVerticesListIndex,t);this.m_shape.setUserIndex(t,this.m_userIndexSortedIndexToVertex,r)}this.m_nextVertexToProcess=-1,this.cleanupSpikes_()&&(e=!0);let r=0,i=!1;do{i=!1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=this.m_sortedVertices.getFirst(this.m_sortedVerticesListIndex);let t=new b.P(0,0);this.m_firstCoincidentVertex!==I.a2.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(this.m_firstCoincidentVertex),t);let s=0,n=this.m_firstCoincidentVertex;for(;n!==I.a2.st_nullNode()&&(n=this.m_sortedVertices.getNext(n))!==I.a2.st_nullNode();){this.progress_();let e=this.m_sortedVertices.getData(n),r=b.P.getNAN();if(this.m_shape.queryXY(e,r),t.equals(r))s++;else{if(s>0){this.m_nextVertexToProcess=n;let e=this.processBunch_();(n=this.m_nextVertexToProcess)!==I.a2.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(n),r),e&&(i=!0)}t.setCoordsPoint2D(r),this.m_firstCoincidentVertex=n,s=0}}this.m_nextVertexToProcess=-1,s>0&&this.processBunch_()&&(i=!0),r++>10&&(0,S.c)(""),i&&this.fixOrphanVertices_(),this.cleanupSpikes_()&&(i=!0),e||=i}while(i);return this.m_shape.dbgVerifyMonotone(),this.m_shape.dbgVerifyCurves(),this.m_shape.removeUserIndex(this.m_userIndexSortedIndexToVertex),this.m_shape.removeUserIndex(this.m_userIndexSortedAngleIndexToVertex),e=function(e,t,s,r,i){let n=new eJ(i);return n.m_shape=e,n.m_geometry=t,n.m_sortedVertices=s,n.m_bFixSelfTangency=r,n.fixRingOrientation_()}(this.m_shape,this.m_geometry,this.m_sortedVertices,this.m_bFixSelfTangency,this.m_progressTracker)||e,this.m_shape.dbgVerifyCurves(),e}getDirection_(e,t){return this.m_shape.getNextVertex(t)!==e}detectAndResolveCrossOver_(e,t,s,r,i,n,a,o){if(r===a)return this.removeAngleSortInfo_(s),this.removeAngleSortInfo_(n),-1;let h=this.m_shape.getUserIndex(s,this.m_userIndexSortedAngleIndexToVertex),l=this.m_shape.getUserIndex(i,this.m_userIndexSortedAngleIndexToVertex),m=this.m_shape.getUserIndex(n,this.m_userIndexSortedAngleIndexToVertex),g=this.m_shape.getUserIndex(o,this.m_userIndexSortedAngleIndexToVertex),u=(0,b.d)(8,Number.NaN),_=(0,b.d)(4,Number.NaN);u[0]=0,_[0]=h,u[1]=0,_[1]=l,u[2]=1,_[2]=m,u[3]=1,_[3]=g;for(let e=1;e<4;e++){let t=_[e],s=u[e],r=e-1;for(;r>=0&&_[r]>t;)_[r+1]=_[r],u[r+1]=u[r],r--;_[r+1]=t,u[r+1]=s}let d=0;if(u[0]&&(d|=1),u[1]&&(d|=2),u[2]&&(d|=4),u[3]&&(d|=8),5!==d&&10!==d)return 0;if(e!==t&&(o=(0,b.b)(n,n=o)),e)this.m_shape.setNextVertex(o,r),this.m_shape.setPrevVertex(r,o),this.m_shape.setNextVertex(i,a),this.m_shape.setPrevVertex(a,i),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(r,!0),this.m_shape.setSegmentParentageBreakVertex(a,!0));else{if(this.m_shape.setPrevVertex(o,r),this.m_shape.setNextVertex(r,o),this.m_shape.setPrevVertex(i,a),this.m_shape.setNextVertex(a,i),this.m_bHasSegmentParentage){let e=this.m_shape.getSegmentParentage(r),t=this.m_shape.getSegmentParentage(a);this.m_shape.setSegmentParentageAndBreak(r,t,!0),this.m_shape.setSegmentParentageAndBreak(a,e,!0)}if(this.m_bHasSegments){let e=this.m_shape.getVertexIndex(r),t=this.m_shape.getVertexIndex(a),s=this.m_shape.getSegmentFromIndex(e);this.m_shape.setSegmentToIndex(e,null);let i=this.m_shape.getSegmentFromIndex(t);this.m_shape.setSegmentToIndex(t,null),this.m_shape.setSegmentToIndex(e,i),this.m_shape.setSegmentToIndex(t,s)}}return 1}resolveOverlap_(e,t,s,r,i,n){return this.resolveOverlapOddEven_(e,t,s,r,i,n)}resolveOverlapOddEven_(e,t,s,r,i,n){if(e!==t){e||(i=(0,b.b)(s,s=i),n=(0,b.b)(r,r=n));let t=this.m_shape.getNextVertex(i),a=this.m_shape.getNextVertex(s);if(this.m_shape.setNextVertex(s,t),this.m_shape.setPrevVertex(t,s),this.m_shape.setNextVertex(i,a),this.m_shape.setPrevVertex(a,i),this.m_bHasSegments){let e=this.m_shape.getVertexIndex(s),t=this.m_shape.getVertexIndex(i),r=this.m_shape.getSegmentFromIndex(e);this.m_shape.setSegmentToIndex(e,null);let n=this.m_shape.getSegmentFromIndex(t);this.m_shape.setSegmentToIndex(t,null),this.m_shape.setSegmentToIndex(e,n),this.m_shape.setSegmentToIndex(t,r)}if(this.m_bHasSegmentParentage){let e=this.m_shape.getSegmentParentage(s),t=this.m_shape.getSegmentParentage(i);this.m_shape.setSegmentParentageAndBreak(s,t,!0),this.m_shape.setSegmentParentageAndBreak(i,e,!0),this.m_shape.setSegmentParentageBreakVertex(r,!0),this.m_shape.setSegmentParentageBreakVertex(n,!0)}this.removeSpike_(i)}else{let a=e?s:r,o=t?i:n,h=e?r:s,l=t?n:i,m=null;if(this.m_bHasSegments){let e=this.m_shape.getVertexIndex(l);m=this.m_shape.getSegmentFromIndex(e),this.m_shape.setSegmentToIndex(e,null);let t=this.m_shape.getVertexIndex(o);this.m_shape.setSegmentToIndex(t,null);let s=this.m_shape.getVertexIndex(a);this.m_shape.setSegmentToIndex(s,null)}let g=-1;this.m_bHasSegmentParentage&&(g=this.m_shape.getSegmentParentage(l));let u=!1;this.m_shape.setNextVertex(a,o),this.m_shape.setNextVertex(o,a),this.m_shape.setPrevVertex(h,l),this.m_shape.setPrevVertex(l,h);let _=l;for(;_!==o;){let e=this.m_shape.getPrevVertex(_),t=this.m_shape.getNextVertex(_);if(this.m_shape.setPrevVertex(_,t),this.m_shape.setNextVertex(_,e),u||=_===a,this.m_bHasSegments&&_!==a){let e=this.m_shape.getVertexIndex(t),s=m;m=this.m_shape.getSegmentFromIndex(e),null!==s&&s.reverse(),this.m_shape.setSegmentToIndex(e,s)}if(this.m_bHasSegmentParentage){let e=this.m_shape.getSegmentParentage(t);this.m_shape.setSegmentParentagePreserveBreak(t,g),g=e}_=t}let d=null;if(!u){let e=this.m_shape.getPrevVertex(o),t=this.m_shape.getNextVertex(o);if(this.m_shape.setPrevVertex(o,t),this.m_shape.setNextVertex(o,e),this.m_bHasSegments){let e=this.m_shape.getVertexIndex(o);d=this.m_shape.getSegmentFromIndex(e),this.m_shape.setSegmentToIndex(e,null)}}let p=-1,c=-1;if(this.m_bHasSegmentParentage&&(p=u?this.m_shape.getSegmentParentage(a):this.m_shape.getSegmentParentage(o),c=this.m_shape.getSegmentParentage(h)),this.transferVertexData_(o,a),this.beforeRemoveVertex_(o,!0),this.m_shape.removeVertexInternal(o,!0),this.removeAngleSortInfo_(a),this.transferVertexData_(l,h),this.beforeRemoveVertex_(l,!0),this.m_shape.removeVertexInternal(l,!0),this.removeAngleSortInfo_(h),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageAndBreak(a,p,!0),this.m_shape.setSegmentParentageAndBreak(h,c,!0)),d){let e=this.m_shape.getVertexIndex(a);this.m_shape.setSegmentToIndex(e,d)}}return!0}cleanupSpikes_(){let e=!1;for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==C.n;){let s=this.m_shape.getNextPath(t),r=this.m_shape.getFirstVertex(t);for(let s=0,i=this.m_shape.getPathSize(t);s<i&&i>1;){this.progress_();let{v:n,bModified:a}=this.checkAndCleanupSpike_(t,r);if(n===C.n)break;a?(e=!0,r=n,s=0,i=this.m_shape.getPathSize(t)):(r=n,s++)}t=s}return e}checkAndCleanupSpike_(e,t){let s={v:C.n,bModified:!1},r=this.m_shape.getPrevVertex(t),i=this.m_shape.getNextVertex(t),n=C.n,a=C.n;for(;this.m_shape.isEqualXY(r,i)&&(n=r,a=i,i!==t);)r=this.m_shape.getPrevVertex(r),i=this.m_shape.getNextVertex(i);if(n===C.n)return s.v=i,s;s.bModified=!0;for(let e=this.m_shape.getNextVertex(n);this.beforeRemoveVertex_(e,!1),e!==a;e=this.m_shape.getNextVertex(e));if(n===t)return this.m_polylineDegeneracies!==C.n?this.m_shape.movePath(this.m_polylineDegeneracies,C.n,e):this.m_shape.removePath(e),s.v=C.n,s;{let e=this.m_shape.peelALoopIntoAPath(n,a);this.m_polylineDegeneracies!==C.n?this.m_shape.movePath(this.m_polylineDegeneracies,C.n,e):this.m_shape.removePath(e)}return s.v=n,s}removeSpike_(e){let t=this.m_shape.getPrevVertex(e),s=this.m_shape.getNextVertex(e),r=C.n,i=C.n;for(;this.m_shape.isEqualXY(t,s)&&(r=t,i=s,s!==e);)t=this.m_shape.getPrevVertex(t),s=this.m_shape.getNextVertex(s);if(r===C.n)return!1;if(this.m_shape.peelALoop(r,i),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(r,!0),this.m_shape.setSegmentParentageBreakVertex(i,!0)),this.removeAngleSortInfo_(r),this.m_polylineDegeneracies===C.n)for(let e=this.m_shape.getNextVertex(i);;){let t=this.m_shape.getNextVertex(e);if(this.removeAngleSortInfo_(e),this.beforeRemoveVertex_(e,!0),this.m_shape.setSegmentToIndex(this.m_shape.getVertexIndex(e),null),this.m_shape.removeVertexInternal(e,!1),e===i)break;e=t}else{for(let e=i;;){let t=this.m_shape.getNextVertex(e);if(this.removeAngleSortInfo_(e),this.beforeRemoveVertex_(e,!1),(e=t)===i)break}this.m_shape.insertClosedPath(this.m_polylineDegeneracies,C.n,i,i,[!1])}return!0}fixOrphanVertices_(){let e=0;for(let e=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());-1!==e;e=this.m_sortedVertices.getNext(e)){let t=this.m_sortedVertices.getData(e);this.m_shape.setPathToVertex(t,C.n)}let t=0;for(let s=this.m_shape.getFirstPath(this.m_geometry);s!==C.n;){let r=this.m_shape.getFirstVertex(s);if(r===C.n||this.m_shape.getPathFromVertex(r)!==C.n){let e=s;s=this.m_shape.getNextPath(s),this.m_shape.removePathOnly(e);continue}this.m_shape.setPathToVertex(r,s);let i=1;for(let e=this.m_shape.getNextVertex(r);e!==r;e=this.m_shape.getNextVertex(e))this.m_shape.setPathToVertex(e,s),i++;this.m_shape.setRingAreaValid(s,!1),this.m_shape.setPathSize(s,i),this.m_shape.setLastVertex(s,this.m_shape.getPrevVertex(r)),t+=i,e++,s=this.m_shape.getNextPath(s)}for(let s=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());-1!==s;s=this.m_sortedVertices.getNext(s)){let r=this.m_sortedVertices.getData(s);if(this.m_shape.getPathFromVertex(r)!==C.n)continue;let i=[!1],n=this.m_shape.insertClosedPath(this.m_geometry,C.n,r,r,i);t+=this.m_shape.getPathSize(n),e++}this.m_shape.setGeometryPathCount(this.m_geometry,e),this.m_shape.setGeometryVertexCount(this.m_geometry,t);let s=0;for(let e=this.m_shape.getFirstGeometry();e!==C.n;e=this.m_shape.getNextGeometry(e))s+=this.m_shape.getPointCount(e);this.m_shape.setTotalPointCount(s)}getNextEdgeIndex_(e){if(-1===e)return -1;for(let t=0,s=this.m_bunchEdgeIndices.length-1;t<s;t++)if(e=(e+1)%this.m_bunchEdgeIndices.length,-1!==this.m_bunchEdgeIndices[e])return e;return -1}getPrevEdgeIndex_(e){if(-1===e)return -1;for(let t=0,s=this.m_bunchEdgeIndices.length-1;t<s;t++)if(e=(this.m_bunchEdgeIndices.length+e-1)%this.m_bunchEdgeIndices.length,-1!==this.m_bunchEdgeIndices[e])return e;return -1}transferVertexData_(e,t){let s=this.m_shape.getUserIndex(t,this.m_userIndexSortedIndexToVertex),r=this.m_shape.getUserIndex(t,this.m_userIndexSortedAngleIndexToVertex);this.m_shape.transferAllDataToTheVertex(e,t),this.m_shape.setUserIndex(t,this.m_userIndexSortedIndexToVertex,s),this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,r)}removeAngleSortInfo_(e){let t=this.m_shape.getUserIndex(e,this.m_userIndexSortedAngleIndexToVertex);-1!==t&&(this.m_bunchEdgeIndices[t]=-1,this.m_shape.setUserIndex(e,this.m_userIndexSortedAngleIndexToVertex,-1))}progress_(e=!1){}}function eZ(e,t,s,r,i,n=!0){switch(eK(r)){case 0:break;case 1:(0,S.t)("relation string length has to be 9 characters");break;default:(0,S.t)("relation string")}if(n){var a,o,h,l,m,g,u,_,d,p,c;let n=(a=r,o=e.getDimension(),h=t.getDimension(),"T*F**FFF*"===a?3:"FF*FF****"===a?4:(l=a,m=o,g=h,(0!==m||0!==g)&&(2===m&&2===g?"F***T****"===l:(2===m||1===m)&&0===g&&"F**T*****"===l))?8:(u=a,(_=o)>(d=h)?"T*****T**"===u:1===_&&1===d&&"0********"===u)?16:"T**FF*FF*"===a?64:"T*****FF*"===a?1:32*(p=a,(c=o)===h&&(1!==c?"T*T***T**"===p:"1*T***T**"===p)));if(0!==n)return tr(e,t,s,n,i)}let f=0;if("number"==typeof s)f=s;else{let r=E.J.constructEmpty();e.queryEnvelope(r);let i=E.J.constructEmpty();t.queryEnvelope(i);let n=E.J.constructEmpty();n.setCoords({env2D:r}),n.mergeEnvelope2D(i),f=(0,I.c)(s,n,!1)}let x=e9(e,f),P=e9(t,f);if(x.isEmpty()||P.isEmpty())return function(e,t,s){let r=(0,b.d)(9,-1);if(e.isEmpty()&&t.isEmpty())return e3(r,s);let i,n=!1;e.isEmpty()?(i=t,n=!0):i=e,r[0]=-1,r[1]=-1,r[3]=-1,r[4]=-1,r[6]=-1,r[7]=-1,r[8]=2;let a=i.getGeometryType();if((0,S.h)(a))if(a===S.G.enumPolygon)if(0!==i.calculateArea2D())r[2]=2,r[5]=1;else{r[5]=-1;let e=E.J.constructEmpty();i.queryEnvelope(e),r[2]=e.height()||e.width()?1:0}else{let e=0!==i.calculateLength2D();r[2]=+!!e,r[5]=(0,C.J)(i)?0:-1}else r[2]=0,r[5]=-1;return n&&e8(r),e3(r,s)}(x,P,r);let y=x.getGeometryType(),v=P.getGeometryType(),G=!1;switch(y){case S.G.enumPolygon:switch(v){case S.G.enumPolygon:G=function(e,t,s,r,i){let n=new e6;n.resetMatrix_(),n.setPredicates_(r),n.setAreaAreaPredicates_();let a=E.J.constructEmpty(),o=E.J.constructEmpty();e.queryEnvelope(a),t.queryEnvelope(o);let h=!1;if(tn(a,o,s)&&(n.areaAreaDisjointPredicates_(e,t),h=!0),h||ta(e,t),!h){let r=new C.E,a=r.addGeometry(e),o=r.addGeometry(t);n.setEditShapeCrackAndCluster_(r,new I.C(s,0),i),n.computeMatrixTopoGraphHalfEdges_(a,o),n.m_topoGraph.removeShape()}return e3(n.m_matrix,n.m_scl)}(x,P,f,r,i);break;case S.G.enumPolyline:G=eQ(x,P,f,r,i);break;case S.G.enumPoint:G=e1(x,P,f,r);break;case S.G.enumMultiPoint:G=e$(x,P,f,r,i)}break;case S.G.enumPolyline:switch(v){case S.G.enumPolygon:G=eQ(P,x,f,e5(r),i);break;case S.G.enumPolyline:G=function(e,t,s,r,i){let n=new e6;n.resetMatrix_(),n.setPredicates_(r),n.setLineLinePredicates_();let a=E.J.constructEmpty(),o=E.J.constructEmpty();e.queryEnvelope(a),t.queryEnvelope(o);let h=!1;if(tn(a,o,s)&&(n.lineLineDisjointPredicates_(e,t),h=!0),h||ta(e,t),!h){let r=new C.E,a=r.addGeometry(e),o=r.addGeometry(t);n.setEditShapeCrackAndCluster_(r,new I.C(s,0),i),n.m_clusterIndexA=n.m_topoGraph.createUserIndexForClusters(),n.m_clusterIndexB=n.m_topoGraph.createUserIndexForClusters(),e7(a,n.m_topoGraph,n.m_clusterIndexA),e7(o,n.m_topoGraph,n.m_clusterIndexB),n.computeMatrixTopoGraphHalfEdges_(a,o),n.m_topoGraph.deleteUserIndexForClusters(n.m_clusterIndexA),n.m_topoGraph.deleteUserIndexForClusters(n.m_clusterIndexB),n.m_topoGraph.removeShape()}return e3(n.m_matrix,n.m_scl)}(x,P,f,r,i);break;case S.G.enumPoint:G=e2(x,P,f,r,i);break;case S.G.enumMultiPoint:G=e0(x,P,f,r,i)}break;case S.G.enumPoint:switch(v){case S.G.enumPolygon:G=e1(P,x,f,e5(r));break;case S.G.enumPolyline:G=e2(P,x,f,e5(r),i);break;case S.G.enumPoint:G=function(e,t,s,r,i){let n=e.getXY(),a=t.getXY(),o=(0,b.d)(9,-1);return b.P.sqrDistance(n,a)<=s*s?o[0]=0:(o[2]=0,o[6]=0),o[8]=2,e3(o,r)}(x,P,f,r);break;case S.G.enumMultiPoint:G=e4(P,x,f,e5(r))}break;case S.G.enumMultiPoint:switch(v){case S.G.enumPolygon:G=e$(P,x,f,e5(r),i);break;case S.G.enumPolyline:G=e0(P,x,f,e5(r),i);break;case S.G.enumMultiPoint:G=function(e,t,s,r,i){let n=new e6;n.resetMatrix_(),n.setPredicates_(r),n.setPointPointPredicates_();let a=new E.J,o=new E.J;e.queryEnvelope(a),t.queryEnvelope(o);let h=!1;if(tn(a,o,s)&&(n.pointPointDisjointPredicates_(),h=!0),!h){let r=new C.E,a=r.addGeometry(e),o=r.addGeometry(t);n.setEditShapeCrackAndCluster_(r,new I.C(s,0),i),n.computeMatrixTopoGraphClusters_(a,o),n.m_topoGraph.removeShape()}return e3(n.m_matrix,n.m_scl)}(x,P,f,r,i);break;case S.G.enumPoint:G=e4(x,P,f,r)}break;default:G=!1}return G}function eK(e){if(9!==e.length)return 1;for(let t=0;t<9;t++){let s=e[t];if("*"!==s&&"T"!==s&&"F"!==s&&"0"!==s&&"1"!==s&&"2"!==s)return 2}return 0}function eQ(e,t,s,r,i){let n=new e6;n.resetMatrix_(),n.setPredicates_(r),n.setAreaLinePredicates_();let a=E.J.constructEmpty(),o=E.J.constructEmpty();e.queryEnvelope(a),t.queryEnvelope(o);let h=!1;if(tn(a,o,s)&&(n.areaLineDisjointPredicates_(e,t),h=!0),h||ta(e,t),!h){let r=new C.E,a=r.addGeometry(e),o=r.addGeometry(t);n.setEditShapeCrackAndCluster_(r,new I.C(s,0),i),n.m_clusterIndexB=n.m_topoGraph.createUserIndexForClusters(),e7(o,n.m_topoGraph,n.m_clusterIndexB),n.computeMatrixTopoGraphHalfEdges_(a,o),n.m_topoGraph.deleteUserIndexForClusters(n.m_clusterIndexB),n.m_topoGraph.removeShape()}return e3(n.m_matrix,n.m_scl)}function e$(e,t,s,r,i){let n=new e6;n.resetMatrix_(),n.setPredicates_(r),n.setAreaPointPredicates_();let a=E.J.constructEmpty(),o=E.J.constructEmpty();e.queryEnvelope(a),t.queryEnvelope(o);let h=!1;if(tn(a,o,s)&&(n.areaPointDisjointPredicates_(e),h=!0),h||ta(e,t),!h){let r=new C.E,a=r.addGeometry(e),o=r.addGeometry(t);n.setEditShapeCrackAndCluster_(r,new I.C(s,0),i),n.computeMatrixTopoGraphClusters_(a,o),n.m_topoGraph.removeShape()}return e3(n.m_matrix,n.m_scl)}function e0(e,t,s,r,i){let n=new e6;n.resetMatrix_(),n.setPredicates_(r),n.setLinePointPredicates_();let a=E.J.constructEmpty(),o=E.J.constructEmpty();e.queryEnvelope(a),t.queryEnvelope(o);let h=!1;if(tn(a,o,s)&&(n.linePointDisjointPredicates_(e),h=!0),h||ta(e,t),!h){let r=new C.E,a=r.addGeometry(e),o=r.addGeometry(t);n.setEditShapeCrackAndCluster_(r,new I.C(s,0),i),n.m_clusterIndexA=n.m_topoGraph.createUserIndexForClusters(),e7(a,n.m_topoGraph,n.m_clusterIndexA),n.computeMatrixTopoGraphClusters_(a,o),n.m_topoGraph.deleteUserIndexForClusters(n.m_clusterIndexA),n.m_topoGraph.removeShape()}return e3(n.m_matrix,n.m_scl)}function e1(e,t,s,r,i){let n=new e6;n.resetMatrix_(),n.setPredicates_(r),n.setAreaPointPredicates_();let a=E.J.constructEmpty();e.queryEnvelope(a);let o=t.getXY(),h=!1;if(to(o,a,s)&&(n.areaPointDisjointPredicates_(e),h=!0),!h){let t=t2(e,o,s);if(1===t)n.m_matrix[0]=0,n.m_matrix[2]=2,n.m_matrix[3]=-1,n.m_matrix[5]=1,n.m_matrix[6]=-1;else if(2===t)if(n.m_matrix[6]=-1,0!==e.calculateArea2D())n.m_matrix[0]=-1,n.m_matrix[3]=0,n.m_matrix[2]=2,n.m_matrix[5]=1;else{n.m_matrix[0]=0,n.m_matrix[3]=-1,n.m_matrix[5]=-1;let t=E.J.constructEmpty();e.queryEnvelope(t),n.m_matrix[2]=t.height()||t.width()?1:-1}else n.areaPointDisjointPredicates_(e)}return e3(n.m_matrix,r)}function e2(e,t,s,r,i){let n=new e6;n.resetMatrix_(),n.setPredicates_(r),n.setLinePointPredicates_();let a=E.J.constructEmpty();e.queryEnvelope(a);let o=!1;if(to(t.getXY(),a,s)&&(n.linePointDisjointPredicates_(e),o=!0),!o){let r=null,a=!1,o=!1;if((n.m_performPredicates[0]||n.m_performPredicates[6])&&(tr(e,t,s,4,i)?(n.m_matrix[0]=-1,n.m_matrix[6]=0):(n.m_performPredicates[0]&&(o=!tr(r=(0,C.c)(e),t,s,4,i),a=!0,n.m_matrix[0]=o?-1:0),n.m_matrix[6]=-1)),n.m_performPredicates[3]&&(null!==r&&r.isEmpty()?n.m_matrix[3]=-1:(a||(null==r&&(r=(0,C.c)(e)),o=!tr(r,t,s,4,i),a=!0),n.m_matrix[3]=o?0:-1)),n.m_performPredicates[5])if(null!==r&&r.isEmpty())n.m_matrix[5]=-1;else if(a&&!o)n.m_matrix[5]=0;else{null===r&&(r=(0,C.c)(e));let a=tr(r,t,s,3,i);n.m_matrix[5]=a?-1:0}if(n.m_performPredicates[2])if(0!==e.calculateLength2D())n.m_matrix[2]=1;else{let r=new C.M({vd:e.getDescription()});r.addPoints(e,0,e.getPointCount());let a=tr(r,t,s,3,i);n.m_matrix[2]=a?-1:0}}return e3(n.m_matrix,n.m_scl)}function e4(e,t,s,r,i){let n=new e6;n.resetMatrix_(),n.setPredicates_(r),n.setPointPointPredicates_();let a=E.J.constructEmpty();e.queryEnvelope(a);let o=t.getXY(),h=new b.P,l=!1;if(to(o,a,s)&&(n.pointPointDisjointPredicates_(),l=!0),!l){let t=!1,r=!0,i=s*s;for(let s=0;s<e.getPointCount()&&(e.queryXY(s,h),b.P.sqrDistance(h,o)<=i?t=!0:r=!1,!t||r);s++);t?(n.m_matrix[0]=0,n.m_matrix[2]=r?-1:0,n.m_matrix[6]=-1):(n.m_matrix[0]=-1,n.m_matrix[2]=0,n.m_matrix[6]=0)}return e3(n.m_matrix,r)}function e3(e,t){for(let s=0;s<9;s++)switch(t[s]){case"T":if(-1===e[s])return!1;break;case"F":if(-1!==e[s])return!1;break;case"0":if(0!==e[s])return!1;break;case"1":if(1!==e[s])return!1;break;case"2":if(2!==e[s])return!1}return!0}function e7(e,t,s){let r=t.getGeometryID(e);for(let e=t.getFirstCluster();e!==C.n;e=t.getNextCluster(e)){if(!(t.getClusterParentage(e)&r))continue;let i=t.getClusterHalfEdge(e);if(i===C.n){t.setClusterUserIndex(e,s,0);continue}let n=i,a=0;do{let e=n;t.getHalfEdgeParentage(e)&r&&a++,n=t.getHalfEdgeNext(t.getHalfEdgeTwin(e))}while(n!==i);t.setClusterUserIndex(e,s,a)}}class e6{nullFunc(){return(0,S.c)("should not be called"),!1}constructor(){this.m_clusterIndexA=-1,this.m_clusterIndexB=-1,this.m_visitedIndex=-1,this.m_topoGraph=new eg,this.m_matrix=(0,b.d)(9,0),this.m_maxDim=(0,b.d)(9,0),this.m_performPredicates=(0,b.d)(9,!1),this.m_scl="",this.m_predicateCount=0,this.m_predicatesHalfEdge=this.nullFunc,this.m_predicatesCluster=this.nullFunc}resetMatrix_(){this.m_matrix.fill(-2),this.m_maxDim.fill(-2)}setPredicates_(e){this.m_scl=e;for(let e=0;e<9;e++)"*"!==this.m_scl[e]?(this.m_performPredicates[e]=!0,this.m_predicateCount++):this.m_performPredicates[e]=!1}setRemainingPredicatesToFalse_(){for(let e=0;e<9;e++)this.m_performPredicates[e]&&-2===this.m_matrix[e]&&(this.m_matrix[e]=-1,this.m_performPredicates[e]=!1)}isPredicateKnown_(e){return -2!==this.m_matrix[e]&&(-1===this.m_matrix[e]?(this.m_performPredicates[e]=!1,this.m_predicateCount--,!0):"T"!==this.m_scl[e]&&"F"!==this.m_scl[e]?!(this.m_matrix[e]<this.m_maxDim[e])&&(this.m_performPredicates[e]=!1,this.m_predicateCount--,!0):(this.m_performPredicates[e]=!1,this.m_predicateCount--,!0))}setAreaAreaPredicates_(){this.m_predicatesHalfEdge=this.areaAreaPredicates_,this.m_maxDim[0]=2,this.m_maxDim[1]=1,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=1,this.m_maxDim[5]=1,this.m_maxDim[6]=2,this.m_maxDim[7]=1,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaLinePredicates_(){this.m_predicatesHalfEdge=this.areaLinePredicates_,this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=0,this.m_maxDim[5]=1,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLineLinePredicates_(){this.m_predicatesHalfEdge=this.lineLinePredicates_,this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=0,this.m_maxDim[5]=0,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaPointPredicates_(){this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=2,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLinePointPredicates_(){this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=0,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setPointPointPredicates_(){this.m_predicatesCluster=this.pointPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=0,this.m_maxDim[3]=-1,this.m_maxDim[4]=-1,this.m_maxDim[5]=-1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[3]&&(this.m_matrix[3]=-1,this.m_performPredicates[3]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[5]&&(this.m_matrix[5]=-1,this.m_performPredicates[5]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}areaAreaDisjointPredicates_(e,t){this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5]),this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[6]?6:-1,this.m_scl[6],this.m_performPredicates[7]?7:-1,this.m_scl[7])}areaGeomContainsOrDisjointPredicates_(e,t,s,r,i){let n=-1!==t,a=-1!==r;if(n||a)if(("T"!==s&&"F"!==s&&n||"T"!==i&&"F"!==i&&a)&&0===e.calculateArea2D()){if(a&&(this.m_matrix[r]=-1),n){let s=E.J.constructEmpty();e.queryEnvelope(s),this.m_matrix[t]=s.height()||s.width()?1:0}}else n&&(this.m_matrix[t]=2),a&&(this.m_matrix[r]=1)}areaAreaContainsPredicates_(e){this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[0]?0:-1,this.m_scl[0],this.m_performPredicates[1]?1:-1,this.m_scl[1])}areaAreaWithinPredicates_(e){this.areaAreaContainsPredicates_(e),e8(this.m_matrix)}areaLineDisjointPredicates_(e,t){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[6]){let e=this.m_scl[6],s="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[6]=+!!s}if(this.m_performPredicates[7]){let e=(0,C.J)(t);this.m_matrix[7]=e?0:-1}this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaLineContainsPredicates_(e,t){if(this.m_performPredicates[0]){let e=this.m_scl[0],s="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[0]=+!!s}if(this.m_performPredicates[1]){let e=(0,C.J)(t);this.m_matrix[1]=e?0:-1}this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1}areaPointDisjointPredicates_(e){this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_matrix[6]=0,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaPointContainsPredicates_(e){this.m_matrix[0]=0,this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1}lineLineDisjointPredicates_(e,t){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[2]){let t=this.m_scl[2],s="T"===t||"F"===t||0!==e.calculateLength2D();this.m_matrix[2]=+!!s}if(this.m_performPredicates[5]){let t=(0,C.J)(e);this.m_matrix[5]=t?0:-1}if(this.m_performPredicates[6]){let e=this.m_scl[6],s="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[6]=+!!s}if(this.m_performPredicates[7]){let e=(0,C.J)(t);this.m_matrix[7]=e?0:-1}}linePointDisjointPredicates_(e){if(this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_performPredicates[2]){let t=this.m_scl[2],s="T"===t||"F"===t||0!==e.calculateLength2D();this.m_matrix[2]=+!!s}if(this.m_performPredicates[5]){let t=(0,C.J)(e);this.m_matrix[5]=t?0:-1}this.m_matrix[6]=0}pointPointDisjointPredicates_(){this.m_matrix[0]=-1,this.m_matrix[2]=0,this.m_matrix[6]=0}areaAreaPredicates_(e,t,s){let r=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorArea_(e,t,s);let i=this.isPredicateKnown_(0);r&&=i}if(this.m_performPredicates[1]){this.interiorAreaBoundaryArea_(e,t,1);let s=this.isPredicateKnown_(1);r&&=s}if(this.m_performPredicates[2]){this.interiorAreaExteriorArea_(e,t,s,2);let i=this.isPredicateKnown_(2);r&&=i}if(this.m_performPredicates[3]){this.interiorAreaBoundaryArea_(e,s,3);let t=this.isPredicateKnown_(3);r&&=t}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryArea_(e,t,s);let i=this.isPredicateKnown_(4);r&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorArea_(e,t,s,5);let i=this.isPredicateKnown_(5);r&&=i}if(this.m_performPredicates[6]){this.interiorAreaExteriorArea_(e,s,t,6);let i=this.isPredicateKnown_(6);r&&=i}if(this.m_performPredicates[7]){this.boundaryAreaExteriorArea_(e,s,t,7);let i=this.isPredicateKnown_(7);r&&=i}return r}areaLinePredicates_(e,t,s){let r=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorLine_(e,t,s);let i=this.isPredicateKnown_(0);r&&=i}if(this.m_performPredicates[1]){this.interiorAreaBoundaryLine_(e,t,s,this.m_clusterIndexB);let i=this.isPredicateKnown_(1);r&&=i}if(this.m_performPredicates[2]){this.interiorAreaExteriorLine_(e,t,s);let i=this.isPredicateKnown_(2);r&&=i}if(this.m_performPredicates[3]){this.boundaryAreaInteriorLine_(e,t,s,this.m_clusterIndexB);let i=this.isPredicateKnown_(3);r&&=i}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryLine_(e,t,s,this.m_clusterIndexB);let i=this.isPredicateKnown_(4);r&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorLine_(e,t,s);let i=this.isPredicateKnown_(5);r&&=i}if(this.m_performPredicates[6]){this.exteriorAreaInteriorLine_(e,t);let s=this.isPredicateKnown_(6);r&&=s}if(this.m_performPredicates[7]){this.exteriorAreaBoundaryLine_(e,t,s,this.m_clusterIndexB);let i=this.isPredicateKnown_(7);r&&=i}return r}lineLinePredicates_(e,t,s){let r=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorLine_(e,t,s,this.m_clusterIndexA,this.m_clusterIndexB);let i=this.isPredicateKnown_(0);r&&=i}if(this.m_performPredicates[1]){this.interiorLineBoundaryLine_(e,t,s,this.m_clusterIndexA,this.m_clusterIndexB,1);let i=this.isPredicateKnown_(1);r&&=i}if(this.m_performPredicates[2]){this.interiorLineExteriorLine_(e,t,s,2);let i=this.isPredicateKnown_(2);r&&=i}if(this.m_performPredicates[3]){this.interiorLineBoundaryLine_(e,s,t,this.m_clusterIndexB,this.m_clusterIndexA,3);let i=this.isPredicateKnown_(3);r&&=i}if(this.m_performPredicates[4]){this.boundaryLineBoundaryLine_(e,t,s,this.m_clusterIndexA,this.m_clusterIndexB);let i=this.isPredicateKnown_(4);r&&=i}if(this.m_performPredicates[5]){this.boundaryLineExteriorLine_(e,t,s,this.m_clusterIndexA,5);let i=this.isPredicateKnown_(5);r&&=i}if(this.m_performPredicates[6]){this.interiorLineExteriorLine_(e,s,t,6);let i=this.isPredicateKnown_(6);r&&=i}if(this.m_performPredicates[7]){this.boundaryLineExteriorLine_(e,s,t,this.m_clusterIndexB,7);let i=this.isPredicateKnown_(7);r&&=i}return r}areaPointPredicates_(e,t,s){let r=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorPoint_(e,t);let s=this.isPredicateKnown_(0);r&&=s}if(this.m_performPredicates[2]){this.interiorAreaExteriorPoint_(e,t);let s=this.isPredicateKnown_(2);r&&=s}if(this.m_performPredicates[3]){this.boundaryAreaInteriorPoint_(e,t,s);let i=this.isPredicateKnown_(3);r&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorPoint_(e,t);let s=this.isPredicateKnown_(5);r&&=s}if(this.m_performPredicates[6]){this.exteriorAreaInteriorPoint_(e,t);let s=this.isPredicateKnown_(6);r&&=s}return r}linePointPredicates_(e,t,s){let r=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorPoint_(e,t,s,this.m_clusterIndexA);let i=this.isPredicateKnown_(0);r&&=i}if(this.m_performPredicates[2]){this.interiorLineExteriorPoint_(e,t,s,this.m_clusterIndexA);let i=this.isPredicateKnown_(2);r&&=i}if(this.m_performPredicates[3]){this.boundaryLineInteriorPoint_(e,t,s,this.m_clusterIndexA);let i=this.isPredicateKnown_(3);r&&=i}if(this.m_performPredicates[5]){this.boundaryLineExteriorPoint_(e,t,s,this.m_clusterIndexA);let i=this.isPredicateKnown_(5);r&&=i}if(this.m_performPredicates[6]){this.exteriorLineInteriorPoint_(e,t,s);let i=this.isPredicateKnown_(6);r&&=i}return r}pointPointPredicates_(e,t,s){let r=!0;if(this.m_performPredicates[0]){this.interiorPointInteriorPoint_(e,t,s);let i=this.isPredicateKnown_(0);r&&=i}if(this.m_performPredicates[2]){this.interiorPointExteriorPoint_(e,t,s,2);let i=this.isPredicateKnown_(2);r&&=i}if(this.m_performPredicates[6]){this.interiorPointExteriorPoint_(e,s,t,6);let i=this.isPredicateKnown_(6);r&&=i}return r}interiorAreaInteriorArea_(e,t,s){if(2===this.m_matrix[0])return;let r=this.m_topoGraph.getHalfEdgeFaceParentage(e);r&t&&r&s&&(this.m_matrix[0]=2)}interiorAreaBoundaryArea_(e,t,s){if(1===this.m_matrix[s])return;let r=this.m_topoGraph.getHalfEdgeFaceParentage(e),i=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));r&t&&i&t&&(this.m_matrix[s]=1)}interiorAreaExteriorArea_(e,t,s,r){if(2===this.m_matrix[r])return;let i=this.m_topoGraph.getHalfEdgeFaceParentage(e);i&t&&!(i&s)&&(this.m_matrix[r]=2)}boundaryAreaBoundaryArea_(e,t,s){if(1===this.m_matrix[4])return;let r=this.m_topoGraph.getHalfEdgeParentage(e);if(r&t&&r&s)this.m_matrix[4]=1;else if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){let r=this.m_topoGraph.getHalfEdgeTo(e),i=this.m_topoGraph.getClusterParentage(r);if(i&t&&i&s)return void(this.m_matrix[4]=0)}}boundaryAreaExteriorArea_(e,t,s,r){if(1===this.m_matrix[r])return;let i=this.m_topoGraph.getHalfEdgeFaceParentage(e),n=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));i&s||n&s||(this.m_matrix[r]=1)}interiorAreaInteriorLine_(e,t,s){if(1===this.m_matrix[0])return;let r=this.m_topoGraph.getHalfEdgeFaceParentage(e),i=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));r&t&&i&t&&(this.m_matrix[0]=1)}interiorAreaBoundaryLine_(e,t,s,r){if(0!==this.m_matrix[1]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){let i=this.m_topoGraph.getHalfEdgeTo(e),n=this.m_topoGraph.getClusterParentage(i);if(!(n&t)&&this.m_topoGraph.getHalfEdgeFaceParentage(e)&t){let e=this.m_topoGraph.getClusterUserIndex(i,r);if(n&s&&e%2!=0)return void(this.m_matrix[1]=0)}}}interiorAreaExteriorLine_(e,t,s){2!==this.m_matrix[2]&&this.m_topoGraph.getHalfEdgeParentage(e)&t&&(this.m_matrix[2]=2)}boundaryAreaInteriorLine_(e,t,s,r){if(1===this.m_matrix[3])return;let i=this.m_topoGraph.getHalfEdgeParentage(e);if(i&t&&i&s)this.m_matrix[3]=1;else if(0!==this.m_matrix[3]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){let i=this.m_topoGraph.getHalfEdgeTo(e),n=this.m_topoGraph.getClusterParentage(i);if(n&t){let e=this.m_topoGraph.getClusterUserIndex(i,r);if(n&s&&e%2==0)return void(this.m_matrix[3]=0)}}}boundaryAreaBoundaryLine_(e,t,s,r){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){let i=this.m_topoGraph.getHalfEdgeTo(e),n=this.m_topoGraph.getClusterParentage(i);if(n&t){let e=this.m_topoGraph.getClusterUserIndex(i,r);if(n&s&&e%2!=0)return void(this.m_matrix[4]=0)}}}boundaryAreaExteriorLine_(e,t,s){if(1===this.m_matrix[5])return;let r=this.m_topoGraph.getHalfEdgeParentage(e);r&t&&!(r&s)&&(this.m_matrix[5]=1)}exteriorAreaInteriorLine_(e,t){if(1===this.m_matrix[6])return;let s=this.m_topoGraph.getHalfEdgeFaceParentage(e),r=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));s&t||r&t||(this.m_matrix[6]=1)}exteriorAreaBoundaryLine_(e,t,s,r){if(0!==this.m_matrix[7]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){let i=this.m_topoGraph.getHalfEdgeTo(e),n=this.m_topoGraph.getClusterParentage(i);if(!(n&t)&&!(this.m_topoGraph.getHalfEdgeFaceParentage(e)&t)){let e=this.m_topoGraph.getClusterUserIndex(i,r);if(n&s&&e%2!=0)return void(this.m_matrix[7]=0)}}}interiorLineInteriorLine_(e,t,s,r,i){if(1===this.m_matrix[0])return;let n=this.m_topoGraph.getHalfEdgeParentage(e);if(n&t&&n&s)this.m_matrix[0]=1;else if(0!==this.m_matrix[0]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){let n=this.m_topoGraph.getHalfEdgeTo(e),a=this.m_topoGraph.getClusterParentage(n);if(a&t&&a&s){let e=this.m_topoGraph.getClusterUserIndex(n,r),t=this.m_topoGraph.getClusterUserIndex(n,i);if(e%2==0&&t%2==0)return void(this.m_matrix[0]=0)}}}interiorLineBoundaryLine_(e,t,s,r,i,n){if(0!==this.m_matrix[n]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){let a=this.m_topoGraph.getHalfEdgeTo(e),o=this.m_topoGraph.getClusterParentage(a);if(o&t&&o&s){let e=this.m_topoGraph.getClusterUserIndex(a,r),t=this.m_topoGraph.getClusterUserIndex(a,i);if(e%2==0&&t%2!=0)return void(this.m_matrix[n]=0)}}}interiorLineExteriorLine_(e,t,s,r){if(1===this.m_matrix[r])return;let i=this.m_topoGraph.getHalfEdgeParentage(e);i&t&&!(i&s)&&(this.m_matrix[r]=1)}boundaryLineBoundaryLine_(e,t,s,r,i){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){let n=this.m_topoGraph.getHalfEdgeTo(e),a=this.m_topoGraph.getClusterParentage(n);if(a&t&&a&s){let e=this.m_topoGraph.getClusterUserIndex(n,r),t=this.m_topoGraph.getClusterUserIndex(n,i);if(e%2!=0&&t%2!=0)return void(this.m_matrix[4]=0)}}}boundaryLineExteriorLine_(e,t,s,r,i){if(0!==this.m_matrix[i]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){let t=this.m_topoGraph.getHalfEdgeTo(e);if(!(this.m_topoGraph.getClusterParentage(t)&s)&&this.m_topoGraph.getClusterUserIndex(t,r)%2!=0)return void(this.m_matrix[i]=0)}}interiorAreaInteriorPoint_(e,t){if(0!==this.m_matrix[0]&&!(this.m_topoGraph.getClusterParentage(e)&t)){let s=this.m_topoGraph.getClusterChain(e);if(this.m_topoGraph.getChainParentage(s)&t)return void(this.m_matrix[0]=0)}}interiorAreaExteriorPoint_(e,t){2!==this.m_matrix[2]&&this.m_topoGraph.getClusterParentage(e)&t&&(this.m_matrix[2]=2)}boundaryAreaInteriorPoint_(e,t,s){if(0===this.m_matrix[3])return;let r=this.m_topoGraph.getClusterParentage(e);r&t&&r&s&&(this.m_matrix[3]=0)}boundaryAreaExteriorPoint_(e,t){1!==this.m_matrix[5]&&this.m_topoGraph.getClusterParentage(e)&t&&(this.m_matrix[5]=1)}exteriorAreaInteriorPoint_(e,t){if(0!==this.m_matrix[6]&&!(this.m_topoGraph.getClusterParentage(e)&t)){let s=this.m_topoGraph.getClusterChain(e);if(!(this.m_topoGraph.getChainParentage(s)&t))return void(this.m_matrix[6]=0)}}interiorLineInteriorPoint_(e,t,s,r){if(0===this.m_matrix[0])return;let i=this.m_topoGraph.getClusterParentage(e);if(i&t&&i&s&&this.m_topoGraph.getClusterUserIndex(e,r)%2==0)return void(this.m_matrix[0]=0)}interiorLineExteriorPoint_(e,t,s,r){if(1!==this.m_matrix[2])if(-1===this.m_topoGraph.getClusterHalfEdge(e)){if(0!==this.m_matrix[2]&&!(this.m_topoGraph.getClusterParentage(e)&s))return void(this.m_matrix[2]=0)}else this.m_matrix[2]=1}boundaryLineInteriorPoint_(e,t,s,r){if(0===this.m_matrix[3])return;let i=this.m_topoGraph.getClusterParentage(e);if(i&t&&i&s&&this.m_topoGraph.getClusterUserIndex(e,r)%2!=0)return void(this.m_matrix[3]=0)}boundaryLineExteriorPoint_(e,t,s,r){if(0===this.m_matrix[5])return;let i=this.m_topoGraph.getClusterParentage(e);if(i&t&&!(i&s)&&this.m_topoGraph.getClusterUserIndex(e,r)%2!=0)return void(this.m_matrix[5]=0)}exteriorLineInteriorPoint_(e,t,s){if(0===this.m_matrix[6])return;let r=this.m_topoGraph.getClusterParentage(e);r&t||!(r&s)||(this.m_matrix[6]=0)}interiorPointInteriorPoint_(e,t,s){if(0===this.m_matrix[0])return;let r=this.m_topoGraph.getClusterParentage(e);r&t&&r&s&&(this.m_matrix[0]=0)}interiorPointExteriorPoint_(e,t,s,r){if(0===this.m_matrix[r])return;let i=this.m_topoGraph.getClusterParentage(e);!(i&t)||i&s||(this.m_matrix[r]=0)}computeMatrixTopoGraphHalfEdges_(e,t){let s=!1,r=this.m_topoGraph.getGeometryID(e),i=this.m_topoGraph.getGeometryID(t);this.m_visitedIndex=this.m_topoGraph.createUserIndexForHalfEdges();for(let e=this.m_topoGraph.getFirstCluster();e!==C.n;e=this.m_topoGraph.getNextCluster(e)){let t=this.m_topoGraph.getClusterHalfEdge(e);if(t===C.n){if(null!==this.m_predicatesCluster&&(s=this.m_predicatesCluster(e,r,i)))break;continue}let n=t;do{let e=n;if(1!==this.m_topoGraph.getHalfEdgeUserIndex(e,this.m_visitedIndex))do{if(s=this.m_predicatesHalfEdge(e,r,i))break;this.m_topoGraph.setHalfEdgeUserIndex(e,this.m_visitedIndex,1),e=this.m_topoGraph.getHalfEdgeNext(e)}while(e!==n&&!s);if(s)break;n=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(e))}while(n!==t);if(s)break}s||this.setRemainingPredicatesToFalse_(),this.m_topoGraph.deleteUserIndexForHalfEdges(this.m_visitedIndex)}computeMatrixTopoGraphClusters_(e,t){let s=!1,r=this.m_topoGraph.getGeometryID(e),i=this.m_topoGraph.getGeometryID(t);for(let e=this.m_topoGraph.getFirstCluster();e!==C.n&&!(s=this.m_predicatesCluster(e,r,i));e=this.m_topoGraph.getNextCluster(e));s||this.setRemainingPredicatesToFalse_()}setEditShape_(e,t){this.m_topoGraph.setEditShape(e,t)}setEditShapeCrackAndCluster_(e,t,s){let r=0;if(e.hasCurves()){var i,n,a,o,h;let l=new so,m=e.getEnvelope2D(s),g=si(t.total(),m);r=sa(g,0),i=e,n=g,a=t.total(),o=0,h=null,ss(i,n,a,l,null,s),l.clearStitcher(e)}sl(e,t.add(r),s,!1,!1),e.filterClosePoints(0,!0,!0,!1,C.n);for(let t=e.getFirstGeometry();t!==C.n;t=e.getNextGeometry(t))e.getGeometryType(t)===S.G.enumPolygon&&eW(e,t,-1,!1,C.n,s);this.setEditShape_(e,s)}}function e8(e){let t=e[1],s=e[2],r=e[5];e[1]=e[3],e[2]=e[6],e[5]=e[7],e[3]=t,e[6]=s,e[7]=r}function e9(e,t,s){let r=e.getGeometryType();if((0,S.f)(r)){let t=new C.P({vd:e.getDescription()});return t.addSegment(e,!0),t}if(r===S.G.enumEnvelope){let s=E.J.constructEmpty();if(e.queryEnvelope(s),s.height()<=t&&s.width()<=t){let t=new I.P({vd:e.getDescription()});return e.getCenter(t),t}if(s.height()<=t||s.width()<=t){let t=new C.P({vd:e.getDescription()}),s=new I.P;return e.queryCornerByVal(0,s),t.startPathPoint(s),e.queryCornerByVal(2,s),t.lineToPoint(s),t}let r=new C.a({vd:e.getDescription()});return r.addEnvelope(e,!1),r}return e}function e5(e){return`${e[0]}${e[3]}${e[6]}${e[1]}${e[4]}${e[7]}${e[2]}${e[5]}${e[8]}`}class te{nullFunc(){return(0,S.c)("should not be called"),!1}constructor(e,t,s,r=!1){this.m_bDone=!1,this.m_tolerance=0,this.m_elementHandle=-1,this.m_query=E.J.constructEmpty(),this.m_envInter=E.J.constructEmpty(),this.m_quadTree=null,this.m_intersector=null,this.m_function=this.nullFunc;let i=e.getAccelerators(),n=null;null!=i&&(n=r?i.getQuadTreeForPaths():i.getQuadTree());let a=t.getAccelerators(),o=null;if(null!=a&&(o=r?a.getQuadTreeForPaths():a.getQuadTree()),null===n&&null===o&&!r){let r=e.getPointCount(),i=t.getPointCount();if(r>10&&i>10){let a=E.J.constructEmpty(),h=E.J.constructEmpty(),l=E.J.constructEmpty();e.queryLooseEnvelope(a),t.queryLooseEnvelope(h),a.inflateCoords(s,s),h.inflateCoords(s,s),l.setCoords({env2D:a}),l.intersect(h),r>=i?n=(0,S.h)(e.getGeometryType())?(0,I.G)(e,l):(0,I.Y)(e,l):o=(0,S.h)(t.getGeometryType())?(0,I.G)(t,l):(0,I.Y)(t,l)}}this.construct_(e,n,t,o,s,r)}next(){if(this.m_bQuadTree){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}return!!this.m_intersector&&this.m_intersector.next()}getRedElement(){return this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElement(this.m_elementHandle):(0,S.h)(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_bSwapElements?this.m_intersector.getBlueElement(this.m_intersector.getHandleB()):this.m_intersector.getRedElement(this.m_intersector.getHandleA())}getBlueElement(){return this.m_bQuadTree?this.m_bSwapElements?(0,S.h)(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_quadTree.getElement(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedElement(this.m_intersector.getHandleA()):this.m_intersector.getBlueElement(this.m_intersector.getHandleB())}getRedEnvelope(){return this.m_bPaths||(0,S.m)(""),this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_query:this.m_bSwapElements?this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB()):this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA())}getBlueEnvelope(){return this.m_bPaths||(0,S.m)(""),this.m_bQuadTree?this.m_bSwapElements?this.m_query:this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA()):this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB())}construct_(e,t,s,r,i,n){let a=E.J.constructEmpty(),o=E.J.constructEmpty();e.queryLooseEnvelope(a),s.queryLooseEnvelope(o),a.inflateCoords(i,i),o.inflateCoords(i,i),this.m_envInter.setCoords({env2D:a}),this.m_envInter.intersect(o),this.m_multiVertexImplA=e,this.m_multiVertexImplB=s;let h=e.getGeometryType(),l=s.getGeometryType();this.m_bPaths=n,this.m_pathIndex=-1,this.m_pointIndex=-1,this.m_bSwapElements=!1,this.m_queryType=S.G.enumUnknown,this.m_bQuadTree=!1,null!==t&&(this.m_bDone=!1,this.m_tolerance=i,this.m_quadTree=t,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!0,(0,S.h)(l)?(this.m_queryType=l,this.m_function=this.nextPath_,n?this.m_pathIndex=s.getPathCount():this.m_segIter=s.querySegmentIterator()):(this.m_queryType=l,this.m_function=this.nextPoint_,this.m_pointIndex=s.getPointCount())),this.m_bQuadTree||null!==r&&(this.m_bDone=!1,this.m_tolerance=i,this.m_quadTree=r,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!1,(0,S.h)(h)?(this.m_queryType=h,this.m_function=this.nextPath_,n?this.m_pathIndex=e.getPathCount():this.m_segIter=e.querySegmentIterator()):(this.m_queryType=h,this.m_function=this.nextPoint_,this.m_pointIndex=e.getPointCount())),this.m_bQuadTree||(n&&(0,S.h)(h)&&(0,S.h)(l)?this.m_intersector=(0,I.a0)(e,s,i):(0,S.h)(h)&&(0,S.h)(l)?(this.m_intersector=(0,I.Z)(e,s,i),this.m_bSwapElements=!1):(0,S.h)(h)&&!(0,S.h)(l)?(this.m_intersector=(0,I._)(e,s,i),this.m_bSwapElements=!1):!(0,S.h)(h)&&(0,S.h)(l)?(this.m_intersector=(0,I._)(s,e,i),this.m_bSwapElements=!0):(this.m_intersector=(0,I.$)(e,s,i),this.m_bSwapElements=!1))}nextPath_(){return this.m_bPaths?-1==--this.m_pathIndex?(this.m_bDone=!0,!1):(this.m_bSwapElements?this.m_multiVertexImplB.queryPathEnvelope(this.m_pathIndex,this.m_query):this.m_multiVertexImplA.queryPathEnvelope(this.m_pathIndex,this.m_query),this.m_qtIter.resetIterator(this.m_query,this.m_tolerance),this.m_function=this.iterate_,!0):this.m_segIter.nextPath()?(this.m_function=this.nextSegment_,!0):(this.m_bDone=!0,!1)}nextSegment_(){if(!this.m_segIter.hasNextSegment())return this.m_function=this.nextPath_,!0;let e=this.m_segIter.nextSegment(),t=new E.J;return e.queryLooseEnvelope(t),!t.isIntersecting(this.m_envInter)||(this.m_qtIter.resetIterator(e,this.m_tolerance),this.m_function=this.iterate_,!0)}nextPoint_(){if(-1==--this.m_pointIndex)return this.m_bDone=!0,!1;let e=new b.P;if(this.m_bSwapElements){let t=this.m_multiVertexImplB.getXY(this.m_pointIndex);e.setCoordsPoint2D(t)}else{let t=this.m_multiVertexImplA.getXY(this.m_pointIndex);e.setCoordsPoint2D(t)}return!this.m_envInter.contains(e)||(this.m_qtIter.resetIterator(E.J.construct(e.x,e.y,e.x,e.y),this.m_tolerance),this.m_function=this.iterate_,!0)}iterate_(){return this.m_elementHandle=this.m_qtIter.next(),-1===this.m_elementHandle&&((0,S.h)(this.m_queryType)?this.m_function=this.m_bPaths?this.nextPath_:this.nextSegment_:this.m_function=this.nextPoint_,!0)}}function tt(e){return 2===e?1:1===e?2:128===e?64:64===e?128:e}function ts(e,t,s){let r;if(e instanceof i$||null===e){let i=E.J.constructEmpty();i.setCoords({env2D:t}),i.mergeEnvelope2D(s),r=(0,I.c)(e,i,!1)}else r=e;return r}function tr(e,t,s,r,i){if(e.isEmpty()||t.isEmpty())return 4===r;(0,S.d)(e),(0,S.d)(t);let n=e.getGeometryType(),a=t.getGeometryType();if(n===S.G.enumEnvelope){if(a===S.G.enumEnvelope)return function(e,t,s,r,i){if(e.isEmpty()||t.isEmpty())return 4===r;let n=E.J.constructEmpty();e.queryEnvelope(n);let a=E.J.constructEmpty();t.queryEnvelope(a);let o=ts(s,n,a);switch(r){case 4:return tn(n,a,o);case 2:return tV(a,n,o,!1);case 128:return tV(a,n,o,!0);case 1:return tV(n,a,o,!1);case 64:return tV(n,a,o,!0);case 3:return tD(n,a,o);case 8:var h,l=n,m=a,g=o;if(l.height()<=g||l.width()<=g||m.height()<=g||m.width()<=g)break;let u=new E.J;return u.setCoords({env2D:l}),u.inflateCoords(-g,-g),u.intersect(m),!(!u.isEmpty()&&u.height()>g&&u.width()>g)&&(u.setCoords({env2D:l}),u.inflateCoords(g,g),u.intersect(m),!u.isEmpty());case 32:var _,d=n,p=a,c=o;if(d.height()<=c||d.width()<=c||p.height()<=c||p.width()<=c||tk(d,p,c)||tk(p,d,c))break;let f=new E.J;return f.setCoords({env2D:d}),f.inflateCoords(-c,-c),f.intersect(p),!f.isEmpty()&&(f.height()>c||f.width()>c)}return!1}(e,t,s,r);if(a===S.G.enumPoint)return ti(t,e,s,tt(r))}else if(n===S.G.enumPoint){if(a===S.G.enumEnvelope)return ti(e,t,s,r);if(a===S.G.enumPoint)return function(e,t,s,r,i){let n;if(e.isEmpty()||t.isEmpty())return 4===r;let a=e.getXY(),o=t.getXY();if(s instanceof i$||null===s){let e=E.J.constructEmpty();e.setCoords({pt:a}),e.merge(o),n=(0,I.c)(s,e,!1)}else n=s;switch(r){case 4:var h,l,m,g;return h=a,l=o,m=n,b.P.sqrDistance(h,l)>m*m;case 2:case 128:return function(e,t,s,r){return tT(e,t,s)}(o,a,n);case 1:case 64:return function(e,t,s,r){return tT(e,t,s)}(a,o,n);case 3:return tT(a,o,n)}return!1}(e,t,s,r)}let o=E.J.constructEmpty();e.queryEnvelope(o);let h=E.J.constructEmpty();t.queryEnvelope(h);let l=ts(s,o,h);if(tn(o,h,l))return 4===r;let m=!1,g=null,u=null,_=null,d=null;switch((0,S.f)(n)?((g=new C.P({vd:e.getDescription()})).addSegment(e,!0),_=g,n=S.G.enumPolyline):_=e,(0,S.f)(a)?((u=new C.P({vd:t.getDescription()})).addSegment(t,!0),d=u,a=S.G.enumPolyline):d=t,n!==S.G.enumEnvelope&&a!==S.G.enumEnvelope?(_.getDimension()<d.getDimension()||n===S.G.enumPoint&&a===S.G.enumMultiPoint)&&(r=tt(r)):n!==S.G.enumPolygon&&a!==S.G.enumEnvelope&&(r=tt(r)),n){case S.G.enumPolygon:switch(a){case S.G.enumPolygon:m=function(e,t,s,r,i){var n,a,o,h,l,m,g,u,_,d,p,c;switch(r){case 4:return ta(n=e,a=t,o=s,!0),1===tF(n,a,o,!0);case 2:return tx(t,e,s,i);case 128:return tP(t,e,s);case 1:return tx(e,t,s,i);case 64:return tP(e,t,s);case 3:return tf(e,t,s,i);case 8:return l=e,m=t,g=s,ta(l,m),tJ(l,m,g,null);case 32:return _=e,d=t,p=s,c=i,ta(_,d),tW(_,d,p,c)}return!1}(_,d,l,r,i);break;case S.G.enumPolyline:m=th(_,d,l,r,i);break;case S.G.enumPoint:m=tl(_,d,l,r);break;case S.G.enumMultiPoint:m=tm(_,d,l,r);break;case S.G.enumEnvelope:m=tg(_,d,l,r,i)}break;case S.G.enumPolyline:switch(a){case S.G.enumPolygon:m=th(d,_,l,r,i);break;case S.G.enumPolyline:m=function(e,t,s,r,i){switch(r){case 4:var n,a,o,h;return n=e,a=t,o=s,ta(n,a),!new te(n.getImpl(),a.getImpl(),o,!0).next()||!tR(n,a,o);case 2:return tC(t,e,s,i);case 128:return tI(t,e,s,i);case 1:return tC(e,t,s,i);case 64:return tI(e,t,s,i);case 3:var l=e,m=t,g=s,u=i;let _=E.J.constructEmpty(),d=E.J.constructEmpty();return l.queryEnvelope(_),m.queryEnvelope(d),!!tD(_,d,g)&&(ta(l,m),!!tU(l,m,g)||(l.hasNonLinearSegments()||m.hasNonLinearSegments()?eZ(l,m,g,"**F**FFF*",u,!1):tO(l,m,g,!1)));case 8:return function(e,t,s,r){ta(e,t);let i=[],n=tY(e,t,s,i);if(-2===n){let i,n,a=E.J.constructEmpty(),o=E.J.constructEmpty(),h=E.J.constructEmpty();if(e.queryEnvelope(a),t.queryEnvelope(o),a.inflateCoords(1e3*s,1e3*s),o.inflateCoords(1e3*s,1e3*s),h.setCoords({env2D:a}),h.intersect(o),e.getPointCount()>10){if((i=(0,w.c)(e,h,s,0,r)).isEmpty())return!1}else i=e;if(t.getPointCount()>10){if((n=(0,w.c)(t,h,s,0,r)).isEmpty())return!1}else n=t;return eZ(i,n,s,"F********",r,!1)}if(0!==n)return!1;let a=new C.M;for(let e=0;e<i.length;e+=2){let t=i[e],s=i[e+1];a.addXY(t,s)}let o=e.getBoundary(),h=t.getBoundary();return o.addPoints(h,0,h.getPointCount()),!o.isEmpty()&&tv(o,a,s)}(e,t,s,i);case 32:return function(e,t,s,r){let i,n;ta(e,t);let a=E.J.constructEmpty(),o=E.J.constructEmpty();e.queryEnvelope(a),t.queryEnvelope(o);let h=tM(a,o,s),l=tM(o,a,s),m=e.hasNonLinearSegments(),g=t.hasNonLinearSegments(),u=tY(e,t,s,null);if(-1===u)return!1;if(1===u){if(h&&l)return!0;if(!m&&!g)return h&&!l?!tB(t,e,s,!1):l&&!h?!tB(e,t,s,!1):!tB(e,t,s,!1)&&!tB(t,e,s,!1)}let _=E.J.constructEmpty(),d=E.J.constructEmpty(),p=E.J.constructEmpty();_.setCoords({env2D:a}),_.inflateCoords(1e3*s,1e3*s),d.setCoords({env2D:o}),d.inflateCoords(1e3*s,1e3*s),p.setCoords({env2D:_}),p.intersect(d);let c="";if(c+="1*",h){if(t.getPointCount()>10){if((n=(0,w.c)(t,p,s,0,r)).isEmpty())return!1}else n=t;c+="****"}else n=t,c+="T***";if(l){if(e.getPointCount()>10){if((i=(0,w.c)(e,p,s,0,r)).isEmpty())return!1}else i=e;c+="***"}else i=e,c+="T**";return eZ(i,n,s,c,r,!1)}(e,t,s,i);case 16:return function(e,t,s,r){ta(e,t);let i=[],n=tY(e,t,s,i);if(-2===n){let i,n,a=E.J.constructEmpty(),o=E.J.constructEmpty(),h=E.J.constructEmpty();if(e.queryEnvelope(a),t.queryEnvelope(o),a.inflateCoords(1e3*s,1e3*s),o.inflateCoords(1e3*s,1e3*s),h.setCoords({env2D:a}),h.intersect(o),e.getPointCount()>10){if((i=(0,w.c)(e,h,s,0,r)).isEmpty())return!1}else i=e;if(t.getPointCount()>10){if((n=(0,w.c)(t,h,s,0,r)).isEmpty())return!1}else n=t;return eZ(i,n,s,"0********",r,!1)}if(0!==n)return!1;let a=new C.M;for(let e=0;e<i.length;e+=2){let t=i[e],s=i[e+1];a.addXY(t,s)}let o=e.getBoundary(),h=t.getBoundary();return o.addPoints(h,0,h.getPointCount()),!!o.isEmpty()||!tv(o,a,s)}(e,t,s,i)}return!1}(_,d,l,r,i);break;case S.G.enumPoint:m=tu(_,d,l,r);break;case S.G.enumMultiPoint:m=t_(_,d,l,r);break;case S.G.enumEnvelope:m=td(_,d,l,r,i)}break;case S.G.enumPoint:switch(a){case S.G.enumPolygon:m=tl(d,_,l,r);break;case S.G.enumPolyline:m=tu(d,_,l,r);break;case S.G.enumMultiPoint:m=tp(d,_,l,r)}break;case S.G.enumMultiPoint:switch(a){case S.G.enumPolygon:m=tm(d,_,l,r);break;case S.G.enumPolyline:m=t_(d,_,l,r);break;case S.G.enumMultiPoint:m=function(e,t,s,r,i){switch(r){case 4:return function(e,t,s,r){let i=new te(e,t,s,!1),n=s*s,a=new b.P,o=new b.P;for(;i.next();){let s=i.getRedElement(),r=i.getBlueElement();if(e.queryXY(s,a),t.queryXY(r,o),b.P.sqrDistance(a,o)<=n)return!1}return!0}(e,t,s);case 2:case 128:return tv(t,e,s);case 1:case 64:return tv(e,t,s);case 3:var n,a,o=e,h=t,l=s;let m=E.J.constructEmpty(),g=E.J.constructEmpty();return o.queryEnvelope(m),h.queryEnvelope(g),!!tD(m,g,l)&&(!!function(e,t,s,r){if(e.getPointCount()!==t.getPointCount())return!1;let i=new b.P,n=new b.P,a=!0,o=s*s;for(let s=0;s<e.getPointCount();s++)if(e.queryXY(s,i),t.queryXY(s,n),b.P.sqrDistance(i,n)>o){a=!1;break}return!!a}(o,h,l)||tq(o,h,l,!1,!0,!1));case 32:return tq(e,t,s,!1,!1,!0)}return!1}(_,d,l,r);break;case S.G.enumPoint:m=tp(_,d,l,r);break;case S.G.enumEnvelope:m=tc(_,d,l,r)}break;case S.G.enumEnvelope:switch(a){case S.G.enumPolygon:m=tg(d,_,l,r,i);break;case S.G.enumPolyline:m=td(d,_,l,r,i);break;case S.G.enumMultiPoint:m=tc(d,_,l,r)}}return m}function ti(e,t,s,r,i){if(e.isEmpty()||t.isEmpty())return 4===r;let n=e.getXY(),a=E.J.constructEmpty();t.queryEnvelope(a);let o=function(e,t,s){let r;if(e instanceof i$||null===e){let i=E.J.constructEmpty();i.setCoords({pt:t}),i.mergeEnvelope2D(s),r=(0,I.c)(e,i,!1)}else r=e;return r}(s,n,a);switch(r){case 4:return to(n,a,o);case 2:case 128:var h,l=n,m=a,g=o;if(m.height()<=g||m.width()<=g)break;let u=E.J.constructEmpty();return u.setCoords({env2D:m}),u.inflateCoords(-g,-g),u.containsExclusive(l);case 1:case 64:break;case 3:var _,d=n,p=a,c=o;let f=new E.J;return f.setCoords({pt:d}),tD(f,p,c);case 8:var x,P=n,y=a,S=o;if(y.height()<=S||y.width()<=S)break;let C=new E.J,b=new E.J;return C.setCoords({env2D:y}),C.inflateCoords(S,S),!!C.contains(P)&&(b.setCoords({env2D:y}),b.inflateCoords(-S,-S),!b.containsExclusive(P))}return!1}function tn(e,t,s){let r=E.J.constructEmpty();return r.setCoords({env2D:t}),r.inflateCoords(s,s),!e.isIntersecting(r)}function ta(e,t,s,r=!1){let i=e.getGeometryType(),n=t.getGeometryType();if((0,S.i)(i)){let t=e.getImpl().getAccelerators();if(null!==t){let e=t.getRasterizedGeometry();(0,S.g)(null===e)}}if((0,S.i)(n)){let e=t.getImpl().getAccelerators();if(null!==e){let t=e.getRasterizedGeometry();(0,S.g)(null===t)}}return 0}function to(e,t,s,r){let i=E.J.constructEmpty();return i.setCoords({env2D:t}),i.inflateCoords(s,s),!i.contains(e)}function th(e,t,s,r,i){switch(r){case 4:return ta(P=e,y=t,S=s,!0),1===tF(P,y,S,!0);case 1:var n,a,o,h,l,m,g,u,_=e,d=t,p=s,c=i;let f=E.J.constructEmpty(),x=E.J.constructEmpty();return _.queryEnvelope(f),d.queryEnvelope(x),!!tk(f,x,p)&&(ta(_,d),function(e,t,s,r){let i,n=[!1],a=tH(e,t,s,n);if(n[0])return a;let o=E.J.constructEmpty();if(t.queryEnvelope(o),o.inflateCoords(1e3*s,1e3*s),e.getPointCount()>10){if((i=(0,w.c)(e,o,s,0,r)).isEmpty())return!1}else i=e;return function(e,t,s,r){let i=new e6;i.resetMatrix_(),i.setPredicates_("T*****F**"),i.setAreaLinePredicates_();let n=E.J.constructEmpty(),a=E.J.constructEmpty();e.queryEnvelope(n),t.queryEnvelope(a);let o=!1;if(tn(n,a,s)&&(i.areaLineDisjointPredicates_(e,t),o=!0),o||ta(e,t),o)return e3(i.m_matrix,i.m_scl);let h=new C.E,l=h.addGeometry(e),m=h.addGeometry(t);return i.setEditShapeCrackAndCluster_(h,new I.C(s,0),r),0!==h.getPointCount(l)&&(i.computeMatrixTopoGraphHalfEdges_(l,m),i.m_topoGraph.removeShape(),e3(i.m_matrix,i.m_scl))}(i,t,s,r)}(_,d,p,c));case 64:var P,y,S,v,G,T=e,N=t,D=s;let V=E.J.constructEmpty(),F=E.J.constructEmpty();return T.queryEnvelope(V),N.queryEnvelope(F),!!tk(V,F,D)&&(ta(T,N),2===tF(T,N,D,!1));case 8:return n=e,a=t,o=s,h=i,ta(n,a),tZ(n,a,o,h);case 16:return l=e,m=t,g=s,ta(l,m),function(e,t,s,r){let i=e.getImpl(),n=t.getImpl(),a=i.querySegmentIterator(),o=n.querySegmentIterator(),h=(0,b.d)(2,Number.NaN),l=(0,b.d)(2,Number.NaN),m=new te(i,n,s),g=!1;for(;m.next();){let e=m.getRedElement(),t=m.getBlueElement();a.resetToVertex(e,-1),o.resetToVertex(t,-1);let r=a.nextSegment(),i=o.nextSegment(),n=0;if(t$(r,i)?!g&&i.isIntersecting(r,s)&&(g=!0):n=i.intersect(r,null,l,h,s),2===n)g=!0;else if(n){let e=h[0],t=l[0];if(e>0&&e<1&&t>0&&t<1)return!0;g=!0}}if(!g)return!1;let u=E.J.constructEmpty(),_=E.J.constructEmpty(),d=E.J.constructEmpty(),p=E.J.constructEmpty(),c=E.J.constructEmpty();if(e.queryEnvelope(u),t.queryEnvelope(_),tM(_,u,s)){let i,n;if(d.setCoords({env2D:u}),d.inflateCoords(1e3*s,1e3*s),p.setCoords({env2D:_}),p.inflateCoords(1e3*s,1e3*s),c.setCoords({env2D:d}),c.intersect(p),e.getPointCount()>10){if((i=(0,w.c)(e,c,s,0,null)).isEmpty())return!1}else i=e;if(t.getPointCount()>10){if((n=(0,w.c)(t,c,s,0,r)).isEmpty())return!1}else n=t;return eZ(i,n,s,"T********",r,!1)}return eZ(e,t,s,"T*****T**",r,!1)}(l,m,g,null)}return!1}function tl(e,t,s,r,i){var n,a,o,h,l,m,g,u,_,d,p;switch(r){case 4:return 0===t1(e,t,s);case 1:case 64:return a=e,o=t,h=s,1===t2(a,o.getXY(),h);case 8:return g=e,u=t,_=s,2===t2(g,u.getXY(),_)}return!1}function tm(e,t,s,r,i){switch(r){case 4:var n,a,o,h,l;return n=e,a=t,o=s,ta(n,a),1===function(e,t,s,r,i){let n=E.J.constructEmpty();e.queryEnvelope(n),n.inflateCoords(s,s);let a=new b.P,o=e.getImpl(),h=new C.a,l=e,m=!1,g=!1,u=!1;for(let r=0;r<t.getPointCount();r++){if(t.queryXY(r,a),n.contains(a)){let e=t2(l,a,s);if(1===e)return g=!0,4;if(2===e)return 4;u=!0}else u=!0;m||(eR(e,t.getPointCount()-1)&&(null===o.getAccelerators()||null==o.getAccelerators().getQuadTree())?(e.copyTo(h),h.getImpl().buildQuadTreeAccelerator(1),l=h):l=e,m=!0)}return g?u?4:2:1}(n,a,o);case 1:return ty(e,t,s,!1);case 64:return ty(e,t,s,!0);case 8:return function(e,t,s,r){ta(e,t);let i=E.J.constructEmpty();e.queryEnvelope(i),i.inflateCoords(s,s);let n=new b.P,a=!1,o=e.getImpl(),h=new C.a,l=e,m=!1;for(let r=0;r<t.getPointCount();r++){if(t.queryXY(r,n),i.contains(n)){let e=t2(l,n,s);if(2===e)a=!0;else if(1===e)return!1}m||(eR(e,t.getPointCount()-1)&&(null===o.getAccelerators()||null===o.getAccelerators().getQuadTree())?(e.copyTo(h),h.getImpl().buildQuadTreeAccelerator(1),l=h):l=e,m=!0)}return!!a}(e,t,s);case 16:return function(e,t,s,r){ta(e,t);let i=new E.J,n=new E.J,a=new E.J;e.queryEnvelope(i),t.queryEnvelope(a),n.setCoords({env2D:i}),n.inflateCoords(s,s);let o=!1,h=!1,l=new b.P,m=e.getImpl(),g=new C.a,u=e,_=!1;for(let r=0;r<t.getPointCount();r++){if(t.queryXY(r,l),n.contains(l)){let e=t2(u,l,s);0===e?h=!0:1===e&&(o=!0)}else h=!0;if(o&&h)return!0;_||(eR(e,t.getPointCount()-1)&&(null===m.getAccelerators()||null===m.getAccelerators().getQuadTree())?(e.copyTo(g),g.getImpl().buildQuadTreeAccelerator(1),u=g):u=e,_=!0)}return!1}(e,t,s)}return!1}function tg(e,t,s,r,i){if(function(e,t,s,r){ta(e,t);let i=E.J.constructEmpty(),n=E.J.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(n),!tk(n,i,s)&&0===t2(e,n.getLowerLeft(),0)&&!n.contains(e.getXY(0))&&!tz(e,n,s)}(e,t,s))return 4===r;if(4===r)return!1;switch(r){case 2:return tE(e,t,s,!1);case 128:return tE(e,t,s,!0);case 1:return tS(e,t,s,!1,i);case 64:return tS(e,t,s,!0,i);case 3:var n=e,a=t,o=s,h=i;let l=new E.J,m=new E.J;if(n.queryEnvelope(l),a.queryEnvelope(m),!tD(l,m,o))break;let g=new C.a;return g.addEnvelope(a,!1),tf(n,g,o,h);case 8:var u=e,_=t,d=s,p=i;ta(u,_);let c=new E.J,f=new E.J;if(u.queryEnvelope(c),_.queryEnvelope(f),tk(f,c,d)||f.height()<=d||f.width()<=d)break;let x=new C.a;return x.addEnvelope(_,!1),tJ(u,x,d,p);case 32:var P=e,y=t,S=s,I=i;ta(P,y);let b=new E.J,v=new E.J;if(P.queryEnvelope(b),y.queryEnvelope(v),tk(v,b,S)||v.height()<=S||v.width()<=S)break;let G=new C.a;return G.addEnvelope(y,!1),tW(P,G,S,I)}return!1}function tu(e,t,s,r,i){var n,a,o,h,l,m,g,u,_,d,p,c,f,x,P;switch(r){case 4:return n=e,a=t,o=s,ta(n,a),!tL(n,a.getXY(),o);case 1:case 64:return l=e,m=t,g=s,ta(l,m),tL(_=l,d=m.getXY(),p=g)&&!tQ(_,d,p);case 8:return c=e,f=t,x=s,ta(c,f),tQ(c,f.getXY(),x)}return!1}function t_(e,t,s,r,i){switch(r){case 4:var n,a,o,h;return n=e,a=t,o=s,ta(n,a),!tX(n,a,o,!1);case 1:case 64:return function(e,t,s,r,i){let n=E.J.constructEmpty(),a=E.J.constructEmpty();if(e.queryEnvelope(n),t.queryEnvelope(a),!tk(n,a,s))return!1;ta(e,t);let o=tX(e,t,s,!0);if(!o)return o;let h=e.getBoundary();return h.isEmpty()?o:!tv(h,t,s)}(e,t,s);case 8:return function(e,t,s,r){ta(e,t);let i=e.getImpl(),n=t.getImpl(),a=new C.M,o=new te(i,n,s,!1),h=i.querySegmentIterator(),l=!1;for(;o.next();){let e=o.getRedElement(),t=o.getBlueElement();h.resetToVertex(e,-1);let r=h.nextSegment(),i=n.getXY(t);r.isIntersectingPoint(i,s)&&(l=!0,a.addPoint2D(i))}if(!l)return!1;let m=e.getBoundary();return!m.isEmpty()&&tv(m,a,s)}(e,t,s);case 16:return function(e,t,s,r){ta(e,t);let i=e.getImpl(),n=t.getImpl(),a=n.getPointCount(),o=(0,b.d)(a,!1),h=new te(i,n,s,!1),l=i.querySegmentIterator(),m=!1;for(;h.next();){let e=h.getRedElement(),t=h.getBlueElement();l.resetToVertex(e,-1);let r=l.nextSegment(),i=n.getXY(t);r.isIntersectingPoint(i,s)&&(m=!0,o[t]=!0)}if(!m)return!1;let g=!1;for(let e=0;e<a;e++)if(!o[e]){g=!0;break}if(!g)return!1;let u=e.getBoundary();if(u.isEmpty())return!0;let _=new C.M;for(let e=0;e<a;e++)o[e]&&_.addPoint2D(n.getXY(e));return!tv(u,_,s)}(e,t,s)}return!1}function td(e,t,s,r,i){if(function(e,t,s,r){let i=E.J.constructEmpty(),n=E.J.constructEmpty();e.queryEnvelope(i),t.queryEnvelope(n);let a=function(e,t,s){let r=E.J.constructEmpty();return r.setCoords({env2D:e}),r.inflateCoords(s,s),r.containsEnvelope(t)?0x40000000:r.isIntersecting(t)?e.isIntersecting(t)?e.xmin<t.xmin&&t.xmax<e.xmax?t.ymin<e.ymin&&t.ymax>e.ymax?0:0x40000000:e.ymin<t.ymin&&t.ymax<e.ymax?t.xmin<e.xmin&&t.xmax>e.xmax?0:0x40000000:0:0:4}(n,i,s);return 0===a?!tz(e,n,s):4===a}(e,t,s))return 4===r;if(4===r)return!1;switch(r){case 2:return tb(e,t,s,!1);case 128:return tb(e,t,s,!0);case 1:case 64:case 32:break;case 3:var n,a=e,o=t,h=s;let l=new E.J,m=new E.J;return a.queryEnvelope(l),o.queryEnvelope(m),!(m.height()>h&&m.width()>h)&&tD(l,m,h);case 8:return function(e,t,s,r){let i=new E.J,n=new E.J;if(e.queryEnvelope(i),t.queryEnvelope(n),n.height()<=s||n.width()<=s)return!1;let a=new E.J,o=new E.J;if(a.setCoords({env2D:n}),o.setCoords({env2D:n}),a.inflateCoords(s,s),o.inflateCoords(-s,-s),o.containsEnvelope(i)||!i.isIntersecting(a))return!1;let h=e.getImpl().querySegmentIterator();h.stripAttributes();let l=e.getImpl().getAccelerators(),m=null,g=null;null!==l&&null!==(m=l.getQuadTree())&&(g=m.getIterator(n,s)),g||h.nextPath()||(0,S.c)("relational_operations");let u=!1,_=null,d=new b.P,p=new b.P,c=e.hasNonLinearSegments(),f=!1;for(;;){if(null!==g){let e=g.next();if(-1===e)break;h.resetToVertex(m.getElement(e),-1),_=h.nextSegment()}else{for(;!h.hasNextSegment()&&h.nextPath(););if(!h.hasNextSegment())break;_=h.nextSegment()}if(c&&_.getGeometryType()!==S.G.enumLine){let e=new E.J;if(_.queryEnvelope(e),o.containsEnvelope(e))return!1;if(a.isIntersecting(e)){f=!0;break}}else{d.assign(_.getStartXY()),p.assign(_.getEndXY());let e=o.clipLine(d,p);if(0!==e)return!1;u||0!==(e=a.clipLine(d,p))&&(u=!0)}}if(!f)return u;let x=new C.a;return x.addEnvelope(n,!1),ta(x,e),tZ(x,e,s,r)}(e,t,s,i);case 16:return function(e,t,s,r){let i=new E.J,n=new E.J;if(e.queryEnvelope(i),t.queryEnvelope(n),n.height()<=s||n.width()<=s)return!1;let a=new E.J;if(a.setCoords({env2D:n}),a.inflateCoords(s,s),a.containsEnvelope(i))return!1;let o=new E.J;if(o.setCoords({env2D:n}),o.inflateCoords(-s,-s),!o.isIntersecting(i))return!1;let h=e.getImpl().querySegmentIterator();h.stripAttributes();let l=e.getImpl().getAccelerators(),m=null,g=null;if(null!==l&&null!==(m=l.getQuadTree())&&(g=m.getIterator(n,s)),!g){let e=h.nextPath();(0,S.g)(e)}let u=!1,_=null,d=new b.P,p=new b.P,c=null,f=null,x=null,P=null;for(e.hasNonLinearSegments()&&(c=new C.L,f=new C.L,x=new C.L,P=new C.L,o.querySide(0,c),o.querySide(1,f),o.querySide(2,x),o.querySide(3,P));;){if(null!==g){let e=g.next();if(-1===e)break;h.resetToVertex(m.getElement(e),-1),_=h.nextSegment()}else{for(;!h.hasNextSegment()&&h.nextPath(););if(!h.hasNextSegment())break;_=h.nextSegment()}if(_.getGeometryType()===S.G.enumLine){if(d.assign(_.getStartXY()),p.assign(_.getEndXY()),0!==o.clipLine(d,p)){u=!0;break}}else if(c.isIntersecting(_,s)||f.isIntersecting(_,s)||x.isIntersecting(_,s)||P.isIntersecting(_,s)){u=!0;break}}return u&&!0}(e,t,s)}return!1}function tp(e,t,s,r,i){var n,a,o,h,l;switch(r){case 4:return n=e,a=t,o=s,tK(n,a.getXY(),o);case 2:case 128:return tG(e,t,s);case 1:case 64:return function(e,t,s,r){return!tK(e,t.getXY(),s)}(e,t,s);case 3:return tG(e,t,s)}return!1}function tc(e,t,s,r,i){switch(r){case 4:return function(e,t,s,r){let i=E.J.constructEmpty(),n=E.J.constructEmpty();if(e.queryEnvelope(i),t.queryEnvelope(n),tk(n,i,s))return!1;let a=E.J.constructEmpty();a.setCoords({env2D:n}),a.inflateCoords(s,s);let o=new b.P;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,o),a.contains(o))return!1;return!0}(e,t,s);case 2:return tw(e,t,s,!1);case 128:return tw(e,t,s,!0);case 1:case 64:break;case 3:var n,a=e,o=t,h=s;let l=new E.J,m=new E.J;return a.queryEnvelope(l),o.queryEnvelope(m),!(m.height()>h||m.width()>h)&&tD(l,m,h);case 8:return function(e,t,s,r){let i=new E.J,n=new E.J,a=new E.J;if(t.queryEnvelope(i),i.height()<=s||i.width()<=s)return!1;n.setCoords({env2D:i}),a.setCoords({env2D:i}),n.inflateCoords(s,s),a.inflateCoords(-s,-s);let o=new b.P,h=!1;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,o),n.contains(o)){if(a.containsExclusive(o))return!1;h=!0}return h}(e,t,s);case 16:return function(e,t,s,r){let i=new E.J,n=new E.J;if(e.queryEnvelope(i),t.queryEnvelope(n),tk(n,i,s)||n.height()<=s||n.width()<=s)return!1;let a=new E.J,o=new E.J;a.setCoords({env2D:n}),a.inflateCoords(-s,-s),o.setCoords({env2D:n}),o.inflateCoords(s,s);let h=new b.P,l=!1,m=!1;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,h),!l&&a.containsExclusive(h)&&(l=!0),m||o.contains(h)||(m=!0),l&&m)return!0;return!1}(e,t,s)}return!1}function tf(e,t,s,r){let i=E.J.constructEmpty(),n=E.J.constructEmpty();if(e.queryEnvelope(i),t.queryEnvelope(n),!tD(i,n,s))return!1;if(ta(e,t),tU(e,t,s))return!0;let a=e.calculateLength2D();return!(Math.abs(a-t.calculateLength2D())>4*Math.max(e.getPointCount(),t.getPointCount())*s)&&(e.hasNonLinearSegments()||t.hasNonLinearSegments()?eZ(e,t,s,"**F**FFF*",r,!1):tO(e,t,s,!0))}function tx(e,t,s,r){let i=E.J.constructEmpty(),n=E.J.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(n),!!tk(i,n,s)&&(ta(e,t),tj(e,t,s,r))}function tP(e,t,s,r){let i=E.J.constructEmpty(),n=E.J.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(n),!!tk(i,n,s)&&(ta(e,t),2===tF(e,t,s,!1))}function ty(e,t,s,r,i){let n=E.J.constructEmpty(),a=E.J.constructEmpty();if(e.queryEnvelope(n),t.queryEnvelope(a),!tk(n,a,s))return!1;ta(e,t);let o=!1,h=new b.P,l=e.getImpl(),m=new C.a,g=e,u=!1;for(let i=0;i<t.getPointCount();i++){if(t.queryXY(i,h),!n.contains(h))return!1;let a=t2(g,h,s);if(1===a)o=!0;else if(0===a)return!1;if(r&&2===a)return!1;u||(eR(e,t.getPointCount()-1)&&(null===l.getAccelerators()||null===l.getAccelerators().getQuadTree())?(e.copyTo(m),m.getImpl().buildQuadTreeAccelerator(1),g=m):g=e,u=!0)}return o}function tE(e,t,s,r,i){let n=E.J.constructEmpty(),a=E.J.constructEmpty();return e.queryEnvelope(n),t.queryEnvelope(a),r?tA(a,n,s):tk(a,n,s)}function tS(e,t,s,r,i){let n=E.J.constructEmpty(),a=E.J.constructEmpty();if(e.queryEnvelope(n),t.queryEnvelope(a),!tk(n,a,s))return!1;ta(e,t);let o=new C.a;return o.addEnvelope(t,!1),r?2===tF(e,o,s,!1):tj(e,o,s,i)}function tC(e,t,s,r){let i=E.J.constructEmpty(),n=E.J.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(n),!!tk(i,n,s)&&((ta(e,t),e.hasNonLinearSegments()||t.hasNonLinearSegments())?eZ(e,t,s,"******FF*",r,!1):tB(t,e,s,!1))}function tI(e,t,s,r){let i=E.J.constructEmpty(),n=E.J.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(n),!!tk(i,n,s)&&(ta(e,t),eZ(e,t,s,"T**FF*FF*",r,!1))}function tb(e,t,s,r,i){let n=E.J.constructEmpty(),a=E.J.constructEmpty();if(e.queryEnvelope(n),t.queryEnvelope(a),a.height()<=s||a.width()<=s)return!1;if(r)return tA(a,n,s);if(!tk(a,n,s))return!1;let o=E.J.constructEmpty();o.setCoords({env2D:a}),o.inflateCoords(-s,-s);let h=E.J.constructEmpty();if(h.setCoords({env2D:a}),h.inflateCoords(s,s),o.containsEnvelope(n))return!0;let l=e.getImpl().querySegmentIterator();l.stripAttributes(),l.nextPath()||(0,S.c)("relational_operations");let m,g,u,_,d,p,c=!1,f=e.hasNonLinearSegments();for(f&&(u=new C.L,_=new C.L,d=new C.L,p=new C.L,o.querySide(0,u),o.querySide(1,_),o.querySide(2,d),o.querySide(3,p));;){for(;!l.hasNextSegment()&&l.nextPath(););if(!l.hasNextSegment())break;let e=l.nextSegment();if(f&&e.getGeometryType()!==S.G.enumLine){if(e.isIntersecting(u,s)||e.isIntersecting(_,s)||e.isIntersecting(d,s)||e.isIntersecting(p,s)){c=!0;break}}else if(m=e.getStartXY(),g=e.getEndXY(),0!==o.clipLine(m,g)){c=!0;break}}return c}function tv(e,t,s,r){let i=E.J.constructEmpty(),n=E.J.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(n),!!tk(i,n,s)&&tq(t,e,s,!0,!1,!1)}function tG(e,t,s,r){let i=E.J.constructEmpty(),n=E.J.constructEmpty();return e.queryEnvelope(i),t.queryEnvelope(n),tD(i,n,s)}function tw(e,t,s,r,i){let n=E.J.constructEmpty(),a=E.J.constructEmpty();if(e.queryEnvelope(n),t.queryEnvelope(a),a.height()<=s||a.width()<=s)return!1;if(r)return tA(a,n,s);if(!tk(a,n,s))return!1;let o=!1,h=E.J.constructEmpty(),l=E.J.constructEmpty();h.setCoords({env2D:a}),l.setCoords({env2D:a}),h.inflateCoords(-s,-s),l.inflateCoords(s,s);let m=new b.P;for(let t=0;t<e.getPointCount();t++){if(e.queryXY(t,m),!l.contains(m))return!1;h.containsExclusive(m)&&(o=!0)}return o}function tT(e,t,s,r){return b.P.sqrDistance(e,t)<=s*s}function tN(e,t,s,r){return tT(e,t,s)}function tD(e,t,s,r){return tk(e,t,s)&&tk(t,e,s)}function tV(e,t,s,r,i){if(e.height()<=s||e.width()<=s)return!1;if(r)return tA(e,t,s);if(!tk(e,t,s))return!1;let n=E.J.constructEmpty();return n.setCoords({env2D:e}),n.inflateCoords(-s,-s),n.intersect(t),!n.isEmpty()}function tF(e,t,s,r,i){let n=new b.P,a=new b.P,o=E.J.constructEmpty(),h=E.J.constructEmpty(),l=e.getImpl(),m=t.getImpl(),g=m.getGeometryType(),u=new te(l,m,s,!0);if(!u.next())return 1;if(tR(e,t,s))return 4*!!r;let _=new C.a,d=e,p=new C.a,c=null;g===S.G.enumPolygon&&(c=t);let f=g===S.G.enumPolygon?(0,b.d)(l.getPathCount(),!1):[],x=(0,b.d)(m.getPathCount(),!1),P=!1,y=!1,I=!1,v=!1,G=!1,w=!1;do{if(I&&G||v&&w||I&&v)break;let i=u.getRedElement(),E=u.getBlueElement();if(!x[E]&&(a.assign(t.getXY(t.getPathStart(E))),o.setCoords({env2D:u.getRedEnvelope()}),o.inflateCoords(s,s),o.contains(a))){if(0!==t2(d,a,0)){if(v=!0,r)return 4}else w=!0;x[E]=!0}if(g===S.G.enumPolygon&&!f[i]&&(n.assign(e.getXY(e.getPathStart(i))),h.setCoords({env2D:u.getBlueEnvelope()}),h.inflateCoords(s,s),h.contains(n))){if(0!==t2(c,n,0)){if(I=!0,r)return 4}else G=!0;f[i]=!0}P||(eR(e,t.getPathCount()-1)&&(null===l.getAccelerators()||null===l.getAccelerators().getQuadTree())?(e.copyTo(_),_.getImpl().buildQuadTreeAccelerator(1),d=_):d=e,P=!0),g!==S.G.enumPolygon||y||(eR(t,e.getPathCount()-1)&&(null===m.getAccelerators()||null===m.getAccelerators().getQuadTree())?(t.copyTo(p),p.getImpl().buildQuadTreeAccelerator(1),c=p):c=t,y=!0)}while(u.next());if(!I&&!v)return 1;if(!G||!w){if(g===S.G.enumPolygon){for(let e=0,t=l.getPathCount();e<t;e++)if(!f[e]){G=!0;break}}for(let e=0,t=m.getPathCount();e<t;e++)if(!x[e]){w=!0;break}}return I&&G||v&&w||I&&v?4:v?2:3}function tH(e,t,s,r,i){r[0]=!1;let n=e.getImpl(),a=t.getImpl(),o=n.querySegmentIterator(),h=a.querySegmentIterator(),l=[0,0],m=[0,0],g=new te(n,a,s),u=!1;for(;g.next();){let e=g.getRedElement(),t=g.getBlueElement();o.resetToVertex(e,-1),h.resetToVertex(t,-1);let i=o.nextSegment(),n=h.nextSegment(),a=0;if(t$(i,n)?!u&&n.isIntersecting(i,s)&&(u=!0):a=n.intersect(i,null,m,l,s),0!==a&&(u=!0,1===a)){let e=l[0],t=m[0];if(e>0&&e<1&&t>0&&t<1)return r[0]=!0,!1}}if(!u){r[0]=!0;let i=E.J.constructEmpty();e.queryEnvelope(i),i.inflateCoords(s,s);let o=new C.a,h=e,l=!1;for(let s=0,r=t.getPathCount();s<r;s++)if(t.getPathSize(s)>0){let r=E.J.constructEmpty();if(t.queryPathEnvelope(s,r),!i.isIntersecting(r))return!1;{let e=eB(h,t.getXY(t.getPathStart(s)),0);if((0,S.g)(-1!==e),0===e)return!1}l||(eR(e,t.getPathCount()-1)&&(null===n.getAccelerators()||null===n.getAccelerators().getQuadTree())?(e.copyTo(o),o.getImpl().buildQuadTreeAccelerator(1),h=o):h=e,l=!0)}if(1===e.getPathCount()||t.getGeometryType()===S.G.enumPolyline)return!0;let m=E.J.constructEmpty();t.queryEnvelope(m),m.inflateCoords(s,s);let g=new C.a,u=t,_=!1;for(let s=0,r=e.getPathCount();s<r;s++)if(e.getPathSize(s)>0){let r=E.J.constructEmpty();if(e.queryPathEnvelope(s,r),m.isIntersecting(r)){let t=eB(u,e.getXY(e.getPathStart(s)),0);if((0,S.g)(-1!==t),1===t)return!1}_||(eR(t,e.getPathCount()-1)&&(null===a.getAccelerators()||null===a.getAccelerators().getQuadTree())?(t.copyTo(g),g.getImpl().buildQuadTreeAccelerator(1),u=g):u=t,_=!0)}return!0}return!1}function tk(e,t,s){let r=E.J.constructEmpty();return r.setCoords({env2D:e}),r.inflateCoords(s,s),r.containsEnvelope(t)}function tA(e,t,s){let r=E.J.constructEmpty();return r.setCoords({env2D:t}),r.inflateCoords(s,s),e.containsExclusiveEnvelope(r)}function tM(e,t,s){let r=E.J.constructEmpty();return r.setCoords({env2D:t}),r.inflateCoords(s,s),!r.contains(e.getLowerLeft())||!r.contains(e.getLowerRight())||!r.contains(e.getUpperLeft())||!r.contains(e.getUpperRight())}function tU(e,t,s,r){if(e.getPathCount()!==t.getPathCount()||e.getPointCount()!==t.getPointCount())return!1;if(e.hasNonLinearSegments()||t.hasNonLinearSegments())return e.equals(t);let i=new b.P,n=new b.P,a=!0,o=s*s;for(let s=0;s<e.getPathCount();s++){if(e.getPathEnd(s)!==t.getPathEnd(s)){a=!1;break}for(let r=e.getPathStart(s);r<t.getPathEnd(s);r++)if(e.queryXY(r,i),t.queryXY(r,n),b.P.sqrDistance(i,n)>o){a=!1;break}if(!a)break}return!!a}function tq(e,t,s,r,i,n,a){let o=e.getImpl(),h=t.getImpl(),l=o.getPointCount(),m=h.getPointCount(),g=(0,b.d)(l,!1),u=i||n?(0,b.d)(m,!1):[],_=s*s,d=new te(o,h,s);for(;d.next();){let e=d.getRedElement(),t=d.getBlueElement(),s=o.getXY(e),r=h.getXY(t);b.P.sqrDistance(s,r)<=_&&(g[e]=!0,(i||n)&&(u[t]=!0))}let p=!1,c=!1;for(let e=0;e<l;e++){let t=g[e];if(p||=!t,c||=t,(i||r)&&p)return!1}if(r)return!0;let f=!1,x=!1;for(let e=0;e<m;e++){let t=u[e];if(f||=!t,x||=t,i&&f)return!1}return!!i||p&&c&&f&&x}function tO(e,t,s,r){return tB(e,t,s,r)&&tB(t,e,s,r)}function tB(e,t,s,r){let i;if((0,S.l)(e),(0,S.l)(t),t.isEmpty())return!1;let n=!0,a=(0,b.d)(2,Number.NaN),o=(0,b.d)(2,Number.NaN),h=[],l=new t0,m=E.J.constructEmpty(),g=E.J.constructEmpty(),u=E.J.constructEmpty();e.queryEnvelope(m),t.queryEnvelope(g),m.inflateCoords(s,s),g.inflateCoords(s,s),u.setCoords({env2D:m}),u.intersect(g);let _=e.getImpl().querySegmentIterator(),d=t.getImpl().querySegmentIterator(),p=t.getImpl().getAccelerators(),c=null,f=null,x=null,P=null;if(null!==p&&(c=p.getQuadTree(),null!==(f=p.getQuadTreeForPaths())&&(P=f.getIteratorForQT())),null===c){let s=e.getPointCount(),r=t.getPointCount();s>10&&r>10&&(c=(0,I.G)(t.getImpl(),u))}for(null!==c&&(x=c.getIteratorForQT());_.nextPath();)for(;_.hasNextSegment();){let e=_.nextSegment();if(e.queryEnvelope(m),!m.isIntersecting(u))return n=!1,!1;if(null!==P&&(P.resetIterator(m,s),-1===P.next()))continue;let t=0,p=null;if(null!=x)x.resetIterator(e,s);else if(d.resetToFirstPath(),!d.nextPath())return n=!1,!1;do if(t=0,null!==x){let r=x.next();if(-1===r)return n=!1,!1;d.resetToVertex(c.getElement(r),-1),p=d.nextSegment(),t=e.intersect(p,null,a,o,s)}else{for(;!d.hasNextSegment();)if(!d.nextPath())return n=!1,!1;(p=d.nextSegment()).queryEnvelope(g),g.inflateCoords(s,s),m.isIntersecting(g)&&(t=e.intersect(p,null,a,o,s))}while(2!==t||0!==a[0]||r&&!(o[0]<=o[1]));let f=Number.NaN,E=!1;do{let r=!1;if(1===a[1]){if(!_.hasNextSegment()){E=!0;break}e=_.nextSegment(),r=!0}if(1===o[1]&&o[0]<=o[1]){if(-1===f||(f=1,!d.hasNextSegment()))break;p=d.nextSegment(),r=!0}if(0===o[1]&&o[0]>o[1]){if(1===f)break;if(Number.isNaN(f)){if(!d.hasPreviousSegment())break;d.previousSegment(),f=-1}if(!d.hasPreviousSegment())break;p=d.previousSegment(),r=!0}if(!r)break;t=e.intersect(p,null,a,o,s)}while(2===t&&(!r||o[0]<=o[1]));if(E)continue;let b=e.calculateLength2D();e.queryEnvelope(m),h.length=0,l.m_overlapEvents.length=0;let w=!1,T=!1,N=0,D=(0,I.c)(null,m,!0);for(null!==x?x.resetIterator(e,s):(d.resetToFirstPath(),d.nextPath()||(0,S.c)("relational_operations"));;){if(t=0,null!==x){let r=x.next();if(-1===r)break;d.resetToVertex(c.getElement(r),-1),p=d.nextSegment(),t=e.intersect(p,null,a,o,s)}else{for(;!d.hasNextSegment()&&d.nextPath(););if(!d.hasNextSegment())break;(p=d.nextSegment()).queryEnvelope(g),g.inflateCoords(s,s),m.isIntersecting(g)&&(t=e.intersect(p,null,a,o,s))}if(2===t&&(!r||o[0]<=o[1])){var y,C,v,G;let e=_.getStartPointIndex(),t=_.getPathIndex(),r=d.getStartPointIndex(),n=d.getPathIndex();if(y=e,C=t,v=a[0],G=a[1],i={m_ivertexA:y,m_ipathA:C,m_scalarA0:v,m_scalarA1:G,m_ivertexB:r,m_ipathB:n,m_scalarB0:o[0],m_scalarB1:o[1]},l.m_overlapEvents.push(i),h.push(h.length),!(w||i.m_scalarA0<N&&i.m_scalarA1<N)){if(0===N&&b*(i.m_scalarA0-N)>s)w=!0;else if(0!==N&&b*(i.m_scalarA0-N)>D)w=!0;else if(b*(1-(N=i.m_scalarA1))<=s||1===N){T=!0;break}}}}if(!T){if(!w)return n=!1,!1;h.length>1&&h.sort((e,t)=>l.compareOverlapEvents(e,t)),N=0;for(let e=0;e<l.m_overlapEvents.length;e++)if(!((i=l.m_overlapEvents[h[e]]).m_scalarA0<N&&i.m_scalarA1<N)){if(0===N&&b*(i.m_scalarA0-N)>s||0!==N&&b*(i.m_scalarA0-N)>D)return n=!1,!1;if(b*(1-(N=i.m_scalarA1))<=s||1===N)break}if(b*(1-N)>s)return n=!1,!1;h.length=0,l.m_overlapEvents.length=0}}return n}function tR(e,t,s){let r=e.getImpl(),i=t.getImpl(),n=r.querySegmentIterator(),a=i.querySegmentIterator(),o=new te(r,i,s);for(;o.next();){let e=o.getRedElement(),t=o.getBlueElement();n.resetToVertex(e,-1),a.resetToVertex(t,-1);let r=n.nextSegment();if(a.nextSegment().isIntersecting(r,s))return!0}return!1}function tY(e,t,s,r){let i=e.getImpl(),n=t.getImpl(),a=i.querySegmentIterator(),o=n.querySegmentIterator(),h=(0,b.d)(2,Number.NaN),l=new te(i,n,s),m=!1,g=-1;for(;l.next();){let e=l.getRedElement(),t=l.getBlueElement();a.resetToVertex(e,-1),o.resetToVertex(t,-1);let i=a.nextSegment(),n=o.nextSegment(),u=0;if(t$(i,n)){if(n.isIntersecting(i,s))return -2}else u=i.intersect(n,null,h,null,s);if(u){if(2===u){let e=i.calculateLength2D(),t=h[0];if(e*(h[1]-t)>s)return 1;m=!0}else if(g=0,r){let e=h[0],t=new b.P;i.queryCoord2D(e,t),r.push(t.x),r.push(t.y)}}}return m?-2:g}function tX(e,t,s,r){let i=e.getImpl(),n=t.getPointCount(),a=r?(0,b.d)(n,!1):[],o=new te(i,t,s,!1),h=i.querySegmentIterator();for(;o.next();){let e=o.getRedElement(),i=o.getBlueElement();h.resetToVertex(e,-1);let n=h.nextSegment(),l=t.getXY(i);if(n.isIntersectingPoint(l,s)){if(!r)return!0;a[i]=!0}}if(!r)return!1;for(let e=0;e<n;e++)if(!a[e])return!1;return!0}function tL(e,t,s){let r=new b.P,i=s*s,n=e.querySegmentIterator(),a=e.getImpl().getAccelerators();if(null!==a){let e=a.getQuadTree();if(null!==e){let a=E.J.constructEmpty();a.setCoords({pt:t});let o=e.getIterator(a,s);for(let s=o.next();-1!==s;s=o.next())if(n.resetToVertex(e.getElement(s),-1),n.hasNextSegment()){let e=n.nextSegment(),s=e.getClosestCoordinate(t,!1);if(e.queryCoord2D(s,r),b.P.sqrDistance(t,r)<=i)return!0}return!1}}let o=E.J.constructEmpty();for(;n.nextPath();)for(;n.hasNextSegment();){let e=n.nextSegment();if(e.queryEnvelope(o),o.inflateCoords(s,s),!o.contains(t))continue;let a=e.getClosestCoordinate(t,!1);if(e.queryCoord2D(a,r),b.P.sqrDistance(t,r)<=i)return!0}return!1}function tz(e,t,s,r){let i=e.querySegmentIterator(),n=e.getImpl().getAccelerators(),a=e.hasNonLinearSegments(),o=null,h=null,l=null,m=null;if(null!==n){let e=n.getQuadTree();if(null!==e){let r=e.getIterator(t,s);a&&(o=new C.L,h=new C.L,l=new C.L,m=new C.L,t.querySide(0,o),t.querySide(1,h),t.querySide(2,l),t.querySide(3,m));let n=E.J.constructEmpty();n.setCoords({env2D:t}),n.inflateCoords(s,s);for(let a=r.next();-1!==a;a=r.next())if(i.resetToVertex(e.getElement(a),-1),i.hasNextSegment()){let e=i.nextSegment();if(e.getGeometryType()===S.G.enumLine){let t=e.getStartXY(),s=e.getEndXY();if(n.clipLine(t,s))return!0;continue}if(t.contains(e.getStartXY())||t.contains(e.getEndXY())||e.isIntersecting(o,s)||e.isIntersecting(h,s)||e.isIntersecting(l,s)||e.isIntersecting(m,s))return!0}return!1}}if(a){o=new C.L,h=new C.L,l=new C.L,m=new C.L,t.querySide(0,o),t.querySide(1,h),t.querySide(2,l),t.querySide(3,m);let r=e.querySegmentIterator();for(;r.nextPath();)for(;r.hasNextSegment();){let e=r.nextSegment();if(t.contains(e.getStartXY())||t.contains(e.getEndXY())||e.isIntersecting(o,s)||e.isIntersecting(h,s)||e.isIntersecting(l,s)||e.isIntersecting(m,s))return!0}}else{let r=E.J.constructEmpty();r.setCoords({env2D:t}),r.inflateCoords(s,s);let i=e.getImpl(),n=i.getAttributeStreamRef(0),a=new b.P;for(let e=0,t=i.getPathCount();e<t;e++){let t=!0,s=new b.P,o=new b.P,h=new b.P,l=i.getPathStart(e),m=new b.P;for(let g=l,u=i.getPathEnd(e);g<u;g++)if(t)n.queryPoint2D(2*g,s),m.assign(s),t=!1;else{if(n.queryPoint2D(2*g,a),o.setCoordsPoint2D(s),h.setCoordsPoint2D(a),r.clipLine(o,h))return!0;s.assign(a)}if(i.isClosedPath(e)&&!t&&(o.setCoordsPoint2D(s),h.setCoordsPoint2D(m),r.clipLine(o,h)))return!0}}return!1}function tJ(e,t,s,r){let i,n,a=e.getImpl(),o=t.getImpl(),h=[0],l=(0,I.M)(a.getIsSimple(0,h))&&(0,I.M)(o.getIsSimple(0,h)),m=a.querySegmentIterator(),g=o.querySegmentIterator(),u=(0,b.d)(2,0),_=(0,b.d)(2,0),d=new te(a,o,s),p=!1;for(;d.next();){let e=d.getRedElement(),t=d.getBlueElement();m.resetToVertex(e,-1),g.resetToVertex(t,-1);let r=m.nextSegment(),i=g.nextSegment(),n=0;if(t$(r,i)){if(i.isIntersecting(r,s)){p=!0;break}}else n=i.intersect(r,null,_,u,s);if(2===n){let e=u[0],t=u[1],i=r.calculateLength2D();if(l&&(t-e)*i>s)return!1;p=!0}else if(n){let e=u[0],t=_[0];if(e>0&&e<1&&t>0&&t<1)return!1;p=!0}}if(!p)return!1;let c=E.J.constructEmpty(),f=E.J.constructEmpty(),x=E.J.constructEmpty();if(e.queryEnvelope(c),t.queryEnvelope(f),c.inflateCoords(1e3*s,1e3*s),f.inflateCoords(1e3*s,1e3*s),x.setCoords({env2D:c}),x.intersect(f),e.getPointCount()>10){if((i=(0,w.c)(e,x,s,0,r)).isEmpty())return!1}else i=e;if(t.getPointCount()>10){if((n=(0,w.c)(t,x,s,0,r)).isEmpty())return!1}else n=t;return eZ(i,n,s,"F********",r,!1)}function tW(e,t,s,r){let i,n,a=e.getImpl(),o=t.getImpl(),h=[0],l=(0,I.M)(a.getIsSimple(0,h))&&(0,I.M)(o.getIsSimple(0,h)),m=E.J.constructEmpty(),g=E.J.constructEmpty(),u=E.J.constructEmpty();e.queryEnvelope(m),t.queryEnvelope(g);let _=!1,d=tM(m,g,s),p=tM(g,m,s),c=a.querySegmentIterator(),f=o.querySegmentIterator(),x=(0,b.d)(2,Number.NaN),P=(0,b.d)(2,Number.NaN),y=new te(a,o,s);for(;y.next();){let e=y.getRedElement(),t=y.getBlueElement();c.resetToVertex(e,-1),f.resetToVertex(t,-1);let r=c.nextSegment(),i=f.nextSegment(),n=0;if(t$(r,i)){if(i.isIntersecting(r,s))break}else n=i.intersect(r,null,P,x,s);if(2===n){let e=x[0],t=x[1],i=r.calculateLength2D();if(l&&(t-e)*i>s&&(_=!0,d&&p))return!0}else if(n){let e=x[0],t=P[0];if(e>0&&e<1&&t>0&&t<1)return!0}}let S=E.J.constructEmpty(),C=E.J.constructEmpty();S.setCoords({env2D:m}),S.inflateCoords(1e3*s,1e3*s),C.setCoords({env2D:g}),C.inflateCoords(1e3*s,1e3*s),u.setCoords({env2D:S}),u.intersect(C);let v="";if(v+=_?"**":"T*",d){if(t.getPointCount()>10){if((n=(0,w.c)(t,u,s,0,r)).isEmpty())return!1}else n=t;v+="****"}else n=t,v+="T***";if(p){if(e.getPointCount()>10){if((i=(0,w.c)(e,u,s,0,r)).isEmpty())return!1}else i=e;v+="***"}else i=e,v+="T**";return eZ(i,n,s,v,r,!1)}function tj(e,t,s,r){let i,n=[!1],a=tH(e,t,s,n);if(n[0])return a;let o=E.J.constructEmpty();if(t.queryEnvelope(o),o.inflateCoords(1e3*s,1e3*s),e.getPointCount()>10){if((i=(0,w.c)(e,o,s,0,r)).isEmpty())return!1}else i=e;return function(e,t,s,r){let i=new e6;i.resetMatrix_(),i.setPredicates_("T*****F**"),i.setAreaAreaPredicates_();let n=E.J.constructEmpty(),a=E.J.constructEmpty();e.queryEnvelope(n),t.queryEnvelope(a);let o=!1;if(tn(n,a,s)&&(i.areaAreaDisjointPredicates_(e,t),o=!0),o||ta(e,t),o)return e3(i.m_matrix,i.m_scl);let h=new C.E,l=h.addGeometry(e),m=h.addGeometry(t),g=null,u=0;if(e.hasNonLinearSegments()||t.hasNonLinearSegments()){var _,d;g=new so;let e=si(s,h.getEnvelope2D(r));u=sa(e,0),_=0,d=null,ss(h,e,s,g,null,r)}sl(h,new I.C(s,0).add(u),r,!1,!1);let p=h.getGeometry(m).getBoundary();if(h.filterClosePoints(0,!0,!0,!1,C.n),eW(h,l,-1,!1,C.n,r),0===h.getPointCount(l))return!1;eW(h,m,-1,!1,C.n,r),i.setEditShape_(h,r);let c=0===h.getPointCount(m);if(!c){i.computeMatrixTopoGraphHalfEdges_(l,m),i.m_topoGraph.removeShape();let e=e3(i.m_matrix,i.m_scl);if(!e)return e}let f=h.getGeometry(l);return l=(h=new C.E).addGeometry(f),m=h.addGeometry(p),i.setEditShape_(h,r),i.m_predicateCount=0,i.resetMatrix_(),i.setPredicates_(c?"T*****F**":"******F**"),i.setAreaLinePredicates_(),i.computeMatrixTopoGraphHalfEdges_(l,m),i.m_topoGraph.removeShape(),e3(i.m_matrix,i.m_scl)}(i,t,s,r)}function tZ(e,t,s,r){let i,n,a=e.getImpl(),o=t.getImpl(),h=a.querySegmentIterator(),l=o.querySegmentIterator(),m=(0,b.d)(2,Number.NaN),g=(0,b.d)(2,Number.NaN),u=new te(a,o,s),_=!1;for(;u.next();){let e=u.getRedElement(),t=u.getBlueElement();h.resetToVertex(e,-1),l.resetToVertex(t,-1);let r=h.nextSegment(),i=l.nextSegment(),n=0;if(t$(r,i)?!_&&i.isIntersecting(r,s)&&(_=!0):n=i.intersect(r,null,g,m,s),2===n)_=!0;else if(n){let e=m[0],t=g[0];if(e>0&&e<1&&t>0&&t<1)return!1;_=!0}}if(!_)return!1;let d=E.J.constructEmpty(),p=E.J.constructEmpty(),c=E.J.constructEmpty();if(e.queryEnvelope(d),t.queryEnvelope(p),d.inflateCoords(1e3*s,1e3*s),p.inflateCoords(1e3*s,1e3*s),c.setCoords({env2D:d}),c.intersect(p),e.getPointCount()>10){if((i=(0,w.c)(e,c,s,0,r)).isEmpty())return!1}else i=e;if(t.getPointCount()>10){if((n=(0,w.c)(t,c,s,0,r)).isEmpty())return!1}else n=t;return eZ(i,n,s,"F********",r,!1)}function tK(e,t,s,r){let i=new b.P,n=s*s;for(let s=0;s<e.getPointCount();s++)if(e.queryXY(s,i),b.P.sqrDistance(i,t)<=n)return!1;return!0}function tQ(e,t,s){let r=e.getBoundary();return!r.isEmpty()&&!tK(r,t,s)}function t$(e,t){return e.getGeometryType()!==S.G.enumLine||t.getGeometryType()!==S.G.enumLine}class t0{constructor(){this.m_overlapEvents=[]}compareOverlapEvents(e,t){let s=this.m_overlapEvents[e],r=this.m_overlapEvents[t];if(s.m_ipathA<r.m_ipathA)return -1;if(s.m_ipathA===r.m_ipathA){if(s.m_ivertexA<r.m_ivertexA)return -1;if(s.m_ivertexA===r.m_ivertexA&&(s.m_scalarA0<r.m_scalarA0||s.m_scalarA0===r.m_scalarA0&&(s.m_scalarA1<r.m_scalarA1||s.m_scalarA1===r.m_scalarA1&&s.m_ivertexB<r.m_ivertexB)))return -1}return 1}}function t1(e,t,s){let r=t.isEmpty()?0:eB(e,t.getXY(),s);return r?1===r?1:2:0}function t2(e,t,s){let r=eB(e,t,s);return r?1===r?1:2:0}function t4(e,t,s,r,i){if(e.getGeometryType()===S.G.enumPolygon)for(let n=0;n<s;n++)i[n]=t2(e,t[n],r);else if(e.getGeometryType()===S.G.enumEnvelope){let n=E.J.constructEmpty();e.queryEnvelope(n),function(e,t,s,r,i){if(e.isEmpty()){for(let e=0;e<s;e++)i[e]=0;return}let n=e.clone();n.inflateCoords(-(.5*r),-(.5*r));let a=e.clone();a.inflateCoords(.5*r,.5*r);for(let e=0;e<s;e++)n.contains(t[e])?i[e]=1:a.contains(t[e])?i[e]=2:i[e]=0}(n,t,s,r,i)}else(0,S.m)("")}function t3(e,t,s,r,i){var n,a,o,h,l;let m=e.getGeometryType();m===S.G.enumPolyline?function(e,t,s,r,i){let n=e.getImpl(),a=n.getAccelerators(),o=null;a&&(o=a.getRasterizedGeometry());let h=s;for(let e=0;e<s;e++)i[e]=1,o&&(0,S.g)(0);if(h){if(a){let e=null;null!==a&&null!==a.getQuadTree()&&(e=a.getQuadTree());let o=n.getPointCount();if(null===e&&o>20&&o*s>4*o+Math.log(o)*s&&(e=(0,I.G)(n)),e){let a=null,o=n.querySegmentIterator(),l=new E.J;for(let n=0;n<s&&h;n++)if(1===i[n]){l.setCoords(t[n]),null===a?a=e.getIterator(l,r):a.resetIterator(l,r);let s=-1;for(let l=a.next();-1!==l;l=a.next()){if(o.resetToVertex(e.getElement(l),s),s=o.getPathIndex(),o.nextSegment().isIntersectingPoint(t[n],r)){i[n]=2,h--;break}i[n]=0}}return}}let e=n.querySegmentIterator();for(;e.nextPath()&&h;)for(;e.hasNextSegment()&&h;){let n=e.nextSegment();for(let e=0;e<s&&h;e++)1===i[e]&&n.isIntersectingPoint(t[e],r)&&(i[e]=2,h--)}}for(let e=0;e<s;e++)1===i[e]&&(i[e]=0)}(e,t,s,r,i):(0,S.f)(m)?(0,S.g)(0):(0,S.m)("")}function t7(e){if(e.isEmpty())return 0;switch(e.getGeometryType()){case S.G.enumMultiPoint:return e.getImpl().getPointCount();case S.G.enumPolyline:return e.getImpl().getPathCount();case S.G.enumPolygon:return e.getImpl().getOGCPolygonCount();case S.G.enumGeometryCollection:return e.getGeometryCount()}return 1}function t6(){return Number.isNaN(this.radius.value())}let t8=1/8;function t9(e,t,s,r){return{pt:e.clone(),t,err:s,checkCount:r}}class t5{constructor(e,t,s,r,i){this.m_left=e,this.m_tracker=i,this.m_eps=s,this.m_trackerCounter=0,this.m_tolerance=r,this.m_circleCheckCounter=0,this.m_bReversedLeft=!1,this.m_leftArc={ptStart:new b.P,ptEnd:new b.P,center:new C.W,radius:new b.F,fcenter:new C.Y,fradius2:new b.M,maxError:Number.NaN,isLine:t6}}closeToCircularArc(e,t,s,r,i,n){if(this.m_circleCheckCounter++,n.maxError=0,!t5.checkSweepAngle(e,t))return!1;if(n.ptStart.setCoordsPoint2D(s),n.ptEnd.setCoordsPoint2D(i),e.isCircular())return n.fradius2=b.M.constructDouble(e.getSemiMajorAxis()).mulDouble(e.getSemiMajorAxis()),n.radius.set(e.getSemiMajorAxis()),n.fcenter.assignPoint2D(e.getCenter()),n.center.set(e.getCenter()),!0;let a=n.ptEnd.sub(n.ptStart).clone();if(a.leftPerpendicularThis(),a.normalize(),Math.abs(a.dotProduct(r.sub(n.ptStart)))<=this.m_eps)return!!this.confirmIsLine(n,a)&&(n.radius.set(Number.NaN),n.center.setCoords(0,0),!0);{let s=n.ptEnd.sub(n.ptStart),i=r.sub(n.ptStart),a=s.crossProduct(i);if(0===a)return!1;let o=.5*s.sqrLength(),h=.5*i.sqrLength(),l=o*i.y-h*s.y;l/=a;let m=s.x*h-i.x*o,g=Math.sqrt(l*l+(m/=a)*m);if(4*Number.EPSILON*g>this.m_eps)return!1;let u=l+n.ptStart.x,_=m+n.ptStart.y;n.radius.set(g),n.center.setCoords(u,_);let d=this.maxCircleApproximationError(e,t,n);if(d>this.m_eps)return n.maxError=d,!1}let o=(new C.Y).assignPoint2D(n.ptStart),h=(new C.Y).assignPoint2D(n.ptEnd).sub(o),l=(new C.Y).assignPoint2D(r).sub(o),m=h.crossProduct(l);if(m.isZero())return!1;let g=h.sqrLength().mulDouble(.5),u=l.sqrLength().mulDouble(.5),_=g.mul(l.y).sub(u.mul(h.y)),d=h.x.mul(u).sub(l.x.mul(g)),p=_.mul(_).add(d.mul(d)),c=m.clone();c.invertThis(),n.fradius2=p.mul(c).mul(c),n.fcenter.setCoords(_.mul(c).add(o.x),d.mul(c).add(o.y)),n.center.setWithEps(n.fcenter.asPoint2D()),n.radius.setWithEps(Math.sqrt(n.fradius2.toDouble()));let f=C.W.constructPoint2D(n.ptStart).subE(n.center),x=C.W.constructPoint2D(n.ptEnd).subE(n.center);if(!f.dotProduct(x).gt(b.H))return!1;let P=this.maxCircleApproximationError(e,t,n);return n.maxError=P,P<=this.m_eps}static checkSweepAngle(e,t){if(e.getGeometryType()===S.G.enumEllipticArc){let s=(0,C.Z)(e,t.vmin);return!(Math.abs((0,C.Z)(e,t.vmax)-s)>.5*b.l)}return!0}confirmIsLine(e,t){let s=e.ptEnd.sub(e.ptStart);return!(Math.abs(t.dotProduct(s.mul(.25)))>this.m_eps)&&!(Math.abs(t.dotProduct(s.mul(.75)))>this.m_eps)}maxCircleApproximationError(e,t,s){let r,i,n=[.25,.75],a=[.1,.25,.75,.9];e.getGeometryType()===S.G.enumEllipticArc?(r=n,i=n.length):(r=a,i=a.length);let o=0;for(let n=0;n<i;++n){let i=new b.P;e.queryCoord2D((0,b.q)(t.vmin,t.vmax,r[n]),i);let a=Math.abs(i.sub(s.center.value()).length()-s.radius.value());a>o&&(o=a)}return o}approximateWithCirclesImpl(e,t){let s,r=1;t&&t.push(0);let i=(0,b.d)(9,Number.NaN);e?s=this.m_left.getMonotonicPartParams(i.length,i):(i[0]=0,i[1]=1,s=2);let n=[],a=[],o=new b.P(0,0);for(let e=1;e<s;e++){let s=new b.E(i[e-1],i[e]);for(this.m_bReversedLeft=!t5.goodOrientation(this.m_left,s),this.m_bReversedLeft?(n.push(t9(o,s.vmin,0,0)),n.push(t9(o,s.vmax,0,0))):(n.push(t9(o,s.vmax,0,0)),n.push(t9(o,s.vmin,0,0))),n[0].pt=this.m_left.getCoord2D(n[0].t),n[1].pt=this.m_left.getCoord2D(n[1].t);n.length>1;){this.progress_();let e=n.at(-1),s=e.checkCount,i=e.err,o=e.pt.clone(),h=e.t,l=n[n.length-2].t,m=.5*(h+l),g=this.m_left.getCoord2D(m);if(i<=this.m_eps||s>=5){let e=new b.E;if(e.setCoords(h,l),this.closeToCircularArc(this.m_left,e,o,g,n[n.length-2].pt,this.m_leftArc)){t&&(this.m_bReversedLeft?a.push(h):t.push(l)),r++,n.pop();continue}s=0,i=this.m_leftArc.maxError}e.t=m,e.pt.setCoordsPoint2D(g),i*=t8,s++,e.err=i,e.checkCount=s,n.push(t9(o,h,i,s))}this.m_bReversedLeft&&t&&(t.length=t.length+a.length,(0,b.a)(t,a.reverse(),t.length-a.length,0,a.length),a.length=0),n.length=0}return r}approximateWithCirclesImplPolyline(e){let t=new C.P,s=[];if(!this.approximateWithCirclesImpl(!0,s))return t;let r=0,i=this.m_left.getStartXY();t.startPath(i);for(let n=1;n<s.length;++n)if(e)t.lineTo(this.m_left.getCoord2D(s[n]));else{let e=new b.P;this.m_left.queryCoord2D(s[n],e);let a=new b.P;this.m_left.queryCoord2D(.5*(s[n]+r),a);let o=new C.l;o.constructCircularArcThreePoint(i,e,a),t.addSegment(o,!1),i.assign(e),r=s[n]}return t}static goodOrientation(e,t){let s=e.getCoord2D(t.vmin),r=e.getCoord2D(t.vmax);return 0>s.compare(r)}progress_(e=!1){}}function se(e,t,s,r,i,n,a){ss(e,t,s,i,n,a)}function st(e,t,s,r){if(!(0,S.h)(e.getGeometryType()))return e;let i=e.getImpl();if(!i.hasNonLinearSegments())return e;let n=e.createInstance();n.getGeometryType()===S.G.enumPolygon&&n.setFillRule(e.getFillRule()),new C.E;let a=new I.P,o=new C.S,h=[],l=[],m=[],g=e.getDescription().getAttributeCount()>1,u=i.querySegmentIterator();for(;u.nextPath();){let e=!0;for(;u.hasNextSegment();){let r=u.isClosingSegment(),i=u.nextSegment();if(!i.isCurve()){n.addSegment(i,e,r),e=!1;continue}let _,d=!1;switch(i.getGeometryType()){case S.G.enumEllipticArc:case S.G.enumRationalBezier2:_=(0,C.N)(i,t,s,!0,!0,l,m,h),d=!0;break;default:_=(0,C.K)(i,t,s,!0,!0,l,h)}let p=d?2:3;l[1].isNAN()?(o.createLine(),o.get().construct(l[0],l[p])):d?(o.createQuadraticRationalBezier(),o.get().constructArrayWeights(l,m)):(o.createCubicBezier(),o.get().constructPoints(l)),g&&e&&(i.queryCoord(h[0],a),o.get().setStart(a)),g&&(i.queryCoord(h[1],a),o.get().setEnd(a)),n.addSegment(o.get(),e,r&&1===_),e=!1;for(let e=1,t=_,s=p;e<t;++e,s+=p)l[s+1].isNAN()?(o.createLine(),o.get().construct(l[s],l[s+p])):d?(o.createQuadraticRationalBezier(),o.get().constructArrayWeights(l.slice(s),m.slice(s))):(o.createCubicBezier(),o.get().constructPoints(l.slice(s))),g&&(i.queryCoord(h[e+1],a),o.get().setEnd(a)),n.addSegment(o.get(),!1,r&&e+1===t)}}return n}function ss(e,t,s,r,i,n){e.hasCurves()?(e.setCurveStitcherPointer(r),r.m_impl=new sh(n,!1,null),r.m_impl.buildMonotonicCurveParentage(e,t,s,i)):r.m_impl=null}function sr(e,t,s,r,i,n,a,o){var h,l,m;e.hasCurves()?(e.setCurveStitcherPointer(n),n.m_impl=new sh(o,!0,i),n.m_impl.buildMonotonicCurveParentage(e,t,s,a),h=e,l=s,m=o,sg.fixCurveTwoPointLoops(h,l,m)):n.m_impl=null}function si(e,t){var s;let r;return t||(t=E.J.constructEmpty()),(r=(s=t).isEmpty()?e:(0,I.a)(null,s,!0).total())>e&&(r=e),.125*r}function sn(e,t){return .125*e}function sa(e,t){return 3*e+3*t}class so{constructor(){this.m_impl=null}stitchCurves(e,t,s,r){this.m_impl&&(this.m_impl.stitchCurves(e,t,s),r&&this.clearStitcher(e))}clearStitcher(e){this.m_impl&&(this.m_impl.clearStitcher(e),this.m_impl=null)}getOriginalVertexIndex(e,t){return this.m_impl.getOriginalVertexIndex(e,t)}getOriginalSegmentTypeInfo(e){return this.m_impl.getOriginalSegmentTypeInfo(e)}}class sh{constructor(e,t,s){this.m_originalPlanarSegments=[],this.m_progressTracker=null,this.m_nsr=null,this.m_progressTracker=e,this.m_nsr=s,this.m_tolerance=0,this.m_originalVertexIndex=-1,this.m_type=0,this.m_progressCounter=0,this.m_bIsSimple=t}buildMonotonicCurveParentage(e,t,s,r){if(!e.hasCurves())return;(0,S.g)(!e.hasSegmentParentage()),this.m_type=1,this.m_originalPlanarSegments.length=0,this.m_bIsSimple&&(this.m_originalVertexIndex=e.createUserIndex()),this.m_tolerance=s;let i=new I.P,n=new C.S,a=[],o=[],h=[];for(let r=e.getFirstGeometry();r!==C.n;r=e.getNextGeometry(r))for(let l=e.getFirstPath(r);l!==C.n;l=e.getNextPath(l)){let r=e.getPathSize(l),m=e.getFirstVertex(l),g=0,u=-1;for(let _=0;_<r;_++){let d,p=e.getNextVertex(m);if(!e.querySegment(m,n,!0,!1)){m=p;continue}if(0===g){u=e.getVertexIndex(m);let t=sh.regularizeCurve(e,n.get(),m,s);if(t>=0){this.m_nsr&&0===this.m_nsr.m_reason&&this.m_nsr.assign(new F(13,u,-1)),g=t,r=e.getPathSize(l),p=e.getNextVertex(m);let s=e.querySegment(m,n,!0,!1);(0,S.g)(s)}}else g--;let c=e.getVertexIndex(m);-1!==this.m_originalVertexIndex&&e.setUserIndex(m,this.m_originalVertexIndex,u),e.setSegmentToIndex(c,null);let f=!1;switch(n.get().getGeometryType()){case S.G.enumEllipticArc:case S.G.enumRationalBezier2:d=(0,C.N)(n.get(),t,s,!1,!0,o,h,a),f=!0;break;default:{let e=!this.m_bIsSimple||!n.get().isMonotoneQuickAndDirty();d=(0,C.K)(n.get(),t,s,e,!1,o,a)}}let x=this.m_originalPlanarSegments.length;if(e.setSegmentParentageAndBreak(m,x,!0),!o[1].isNAN()){let t=null;(t=f?new C.Q({points:o,weights:h}):new C.y({cp:o})).snapControlPoints(s*s),e.setSegmentToIndex(c,t)}let P=f?2:3;for(let t=1,r=d,m=P;t<r;++t,m+=P){n.get().queryCoord(a[t],i);let r=e.insertVertex(l,p,i);if(-1!==this.m_originalVertexIndex&&e.setUserIndex(r,this.m_originalVertexIndex,u),!o[m+1].isNAN())if(f){let t=new C.Q({points:o.slice(m),weights:h.slice(m)});t.snapControlPoints(s*s),e.setSegmentToIndex(e.getVertexIndex(r),t)}else{let t=new C.y({cp:o.slice(m)});t.snapControlPoints(s*s),e.setSegmentToIndex(e.getVertexIndex(r),t)}e.setSegmentParentageAndBreak(r,x,!1)}d>1&&(_+=d-1,r=e.getPathSize(l)),this.m_originalPlanarSegments.push(n.releaseSegment()),m=p}}}stitchCurves(e,t,s){sh.st_stitchCurvesImpl(this,e,t,s,!1)}clearStitcher(e){this.m_originalPlanarSegments.length=0,-1!==this.m_originalVertexIndex&&(e.removeUserIndex(this.m_originalVertexIndex),this.m_originalVertexIndex=-1),e.deleteSegmentParentage()}static st_verifyParentage(e){sh.st_stitchCurvesImpl(null,e,C.n,0,!0)}getOriginalVertexIndex(e,t){return -1!==this.m_originalVertexIndex&&t!==C.n?e.getUserIndex(t,this.m_originalVertexIndex):-1}getOriginalSegmentTypeInfo(e){if(-1!==e){let t=this.m_originalPlanarSegments[e];switch(t.getGeometryType()){case S.G.enumEllipticArc:return+(0!==t.projectionBehavior());case S.G.enumBezier:return 2;case S.G.enumBezier2:return 3;case S.G.enumLine:break;case S.G.enumRationalBezier2:return 4;default:(0,S.b)("")}}return -1}progress_(e=!1){this.m_progressCounter++}processSpan_(e,t,s,r,i,n,a){if(t===s&&0===r)return(0,S.g)(e.getNextVertex(t)===C.n),e.setSegmentToIndex(e.getVertexIndex(t),null),void e.setSegmentParentageAndBreak(t,-1);let o=e.getNextVertex(t);{let t=2;for(let r=o;r!==s;r=e.getNextVertex(r))t++;(0,S.g)(t===r)}if(null===i){e.setSegmentToIndex(e.getVertexIndex(t),null);for(let t=o;t!==s;)t=e.removeVertex(t,!0);return}let h=e.getXY(t),l=e.getXY(s);if(i.isClosed()){if(h.isEqualPoint2D(l)&&h.isEqualPoint2D(i.getStartXY())){let o;if(o=this.verifySegmentFitness(e,t,s,r,i,n,a)){let r=i.clone();return r.dropAllAttributes(),o<0&&r.reverse(),this.removeSpan(e,t,s),void e.setSegmentToIndex(e.getVertexIndex(t),r)}}}else if(h.isEqualPoint2D(i.getStartXY())){if(l.isEqualPoint2D(i.getEndXY())){let o=i.clone();if(o.dropAllAttributes(),this.verifySegmentFitness(e,t,s,r,o,n,a))return this.removeSpan(e,t,s),void e.setSegmentToIndex(e.getVertexIndex(t),o)}}else if(l.isEqualPoint2D(i.getStartXY())&&h.isEqualPoint2D(i.getEndXY())){let o=i.getReversed();if(o.dropAllAttributes(),this.verifySegmentFitness(e,t,s,r,o,n,a))return this.removeSpan(e,t,s),void e.setSegmentToIndex(e.getVertexIndex(t),o)}this.processSpanSplitSegment(e,t,s,r,i,n,a)}processSpanSplitSegment(e,t,s,r,i,n,a){if(i.isLine()||this.fitSegmentToSpan(e,t,s,r,i,n,a))return;let o=a*a,h=r,l=t,m=e.getXY(t),g=i.getClosestCoordinate(m,!1),u=i.getCoord2D(g),_=!1,d=b.P.sqrDistance(m,u);if(d>o){let r=e.getNextVertex(t);if(this.approximateSpanSection(e,t,i,n,a),r===s)return;l=r,_=!0,h-=1}let p=s,c=e.getXY(s);g=i.getClosestCoordinate(c,!1);let f=i.getCoord2D(g),x=!1,P=b.P.sqrDistance(c,f);if(P>o){let t=e.getPrevVertex(s);if(this.approximateSpanSection(e,t,i,n,a),t===l)return;p=t,x=!0,h-=1}if((_||x)&&this.fitSegmentToSpan(e,l,p,h,i,n,a))return;let y=!1;if(!_&&d>0){let s=e.getNextVertex(t);if(this.approximateSpanSection(e,t,i,n,a),s===p)return;l=s,_=!0,y=!0,h-=1}if(!x&&P>0){let t=e.getPrevVertex(s);if(this.approximateSpanSection(e,t,i,n,a),t===l)return;p=t,x=!0,y=!0,h-=1}if(y&&this.fitSegmentToSpan(e,l,p,h,i,n,a))return;let E=l;for(;;){let t=e.getNextVertex(E);if(this.approximateSpanSection(e,E,i,n,a),(E=t)===p)return}}fitSegmentToSpan(e,t,s,r,i,n,a){let o=0===this.m_type,h=[];if(h.push(e.getXY(t)),o){let i=t;if(r>32){let t=BigInt(r-1),n=BigInt(31),a=n,o=0n;for(let s=1;s<r;s++,a+=n)if(i=e.getNextVertex(i),a>=o+t){o+=t;let s=e.getXY(i);h.push(s)}(0,S.g)(i===s)}else{for(let t=1;t<r;t++){i=e.getNextVertex(i);let t=e.getXY(i);h.push(t)}(0,S.g)(i===s)}}else{let i=t,n=new C.S;for(;;){e.querySegment(i,n,!1,!0);let t=0;for(let e of[.1,.25,.4,.5,.6,.75,.9,1])(2===r||1&t)&&h.push(n.get().getCoord2D(e)),t++;if((i=e.getNextVertex(i))===s)break}}let l=(()=>{let e=h[0].compare(h.at(-1));if(0===e){let t=new b.K(0);(function(e,t,s){if(s.reset(),t<3)return;let r=e[0].clone(),i=r.x,n=r.y,a=e[1].clone(),o=new b.P;for(let i=2;i<t;i++)o.assign(e[i]),s.pe((o.x-r.x)*(a.y-n)),r.assign(a),a.assign(o);s.pe((i-r.x)*(a.y-n))})(h,h.length,t),e=t.getResult()>=0?-1:1}return e>0})();l&&h.reverse();let m=i.clone();if(m.dropAllAttributes(),m.setSegmentFromCoords(h,h.length),l&&m.reverse(),m.snapControlPoints(this.m_tolerance*this.m_tolerance),this.verifySegmentFitness(e,t,s,r,m,n,a)){this.removeSpan(e,t,s);let r=e.getVertexIndex(t);return e.setSegmentToIndex(r,m),!0}return!1}approximateSpanSection(e,t,s,r,i){let n=new C.S;if(!e.querySegment(t,n,!0,!1))return;let a=s.getGeometryType();if(a!==n.get().getGeometryType()){if(a===S.G.enumEllipticArc){if(n.get().getGeometryType()!==S.G.enumRationalBezier2)return;if(0===s.projectionBehavior()){let s=[];!function(e,t,s,r,i){let n=Math.max(4*(0,C.X)(t),s);new t5(t,null,n,Number.NaN,i).approximateWithCirclesImpl(e,r)}(!1,n.get(),i,s,this.m_progressTracker);let r=e.getNextVertex(t),a=e.getPathFromVertex(t),o=new I.P,h=t;for(let t=1,i=s.length;t<i;t++){let i=s[t],l=n.get().getCoord2D(s[t-1]),m=n.get().getCoord2D((0,b.q)(s[t-1],i,.5));n.get().queryCoord(i,o);let g=o.getXY(),u=new C.l;u.constructCircularArcThreePoint(l,g,m);let _=C.n;i<1&&(_=e.insertVertex(a,r,o)),e.setSegmentToIndex(e.getVertexIndex(h),u),h=_}return}{let s=(0,b.m)(b.P,3);n.get().queryControlPoints(s);let r=[0,0,0];n.get().queryWeights(r);let i=(0,C.O)(r),a=new C.l;return(0,C.R)(s,i*i,null,!1,a),void e.setSegmentToIndex(e.getVertexIndex(t),a)}}(0,S.c)("approximate_span_section_")}}verifySegmentFitness(e,t,s,r,i,n,a){return 0===this.m_type?this.verifySegmentFitnessLines(e,t,s,r,i,n,a):this.verifySegmentFitnessCurves(e,t,s,r,i,n,a)}verifySegmentFitnessCurves(e,t,s,r,i,n,a){let o=e.getXY(t),h=e.getXY(s);if(!o.isEqualPoint2D(i.getStartXY())||!h.isEqualPoint2D(i.getEndXY()))return 0;let l=0;if(i.isClosed()){let e=i.getCoord2D(.1).sub(o);l=i.getCoord2D(.7).sub(o).crossProduct(e)>=0?1:-1}let m=(0,b.d)(C.T.s_maxMonotonicPartParams,Number.NaN),g=i.getMonotonicPartParams(m.length,m);g--;let u=new C.L,_=[1,.5,.75,.25],d=0,p=t,c=o.clone();for(;;){let t=e.getNextVertex(p),r=e.getSegment(p);null===r&&(e.queryLineConnector(p,u,!0),r=u);for(let e=+(t===s);e<_.length;e++){let t=r.getCoord2D(_[e]);if(!i.isCloserThanDistance(t,b.E.unit(),a))return 0}if(g>1)for(let e=1;e<g;){let t=i.getCoord2D(m[e]);r.isCloserThanDistance(t,b.E.unit(),a)?(m[g-1]=(0,b.b)(m[e],m[e]=m[g-1]),g--):e++}if(l){let e=r.getCoord2D(.25);d+=e.sub(o).crossProduct(c.sub(o)),c.assign(e),e.assign(r.getCoord2D(.75)),d+=e.sub(o).crossProduct(c.sub(o)),c.assign(e)}if((p=t)===s)return g>1?0:l?d<0?-l:l:1}}verifySegmentFitnessLines(e,t,s,r,i,n,a){return(0,S.g)(0),0}removeSpan(e,t,s){e.setSegmentToIndex(e.getVertexIndex(t),null);let r=e.getNextVertex(t);r!==s&&e.removeVertices(r,s)}static st_stitchCurvesImpl(e,t,s,r,i){if(t.hasSegmentParentage())return t.hasCurves()?sh.st_stitchCurvesFromCurvesImpl(e,t,s,r,i):sh.st_stitchCurvesFromLinesImpl(e,t,s,r,i)}static st_stitchCurvesFromLinesImpl(e,t,s,r,i){let n=s===C.n?t.getFirstGeometry():s;for(;n!==C.n;){for(let s=t.getFirstPath(n);s!==C.n;s=t.getNextPath(s)){let n=t.getPathSize(s);t.isClosedPath(s)&&(n+=1);let a=!0,o=!1,h=t.getFirstVertex(s),l=h;for(let s=0;s<n&&l!==C.n;){let m=t.getSegmentParentage(l);if(-1===m||a){a=!1,s++,l=t.getNextVertex(l),o=!0;continue}let g,u,_=0;if(o?(g=t.getPrevVertex(l),u=l,(0,S.g)(g!==C.n),(0,S.g)(u!==g),(0,S.g)(-1===t.getSegmentParentage(g)||h===g)):(g=l,u=t.getNextVertex(g),s++,(0,S.g)(u!==C.n),(0,S.g)(u!==g),m=t.getSegmentParentage(u)),_=2,o=!1,-1===m||t.getSegmentParentageBreakVertex(u)){l=u;continue}let d=t.getNextVertex(u);for(s++;s<n&&d!==C.n;){u=d,_++;let e=t.getSegmentParentage(d);if(-1===e||t.getSegmentParentageBreakVertex(d))break;(0,S.g)(e===m),s++,d=t.getNextVertex(d)}if(!i){let s=e.m_originalPlanarSegments[m];e.processSpan_(t,g,u,_,s,m,r)}l=u}}if(s!==C.n)break;n=t.getNextGeometry(n)}}static st_stitchCurvesFromCurvesImpl(e,t,s,r,i){let n=s===C.n?t.getFirstGeometry():s;for(;n!==C.n;)if((0,S.q)(t.getGeometryType(n))){for(let s=t.getFirstPath(n);s!==C.n;s=t.getNextPath(s)){let n=t.getPathSize(s),a=t.isClosedPath(s);a&&(n+=1);let o=t.getFirstVertex(s);if(a){if(-1!==t.getSegmentParentage(o)){let e=o;for(let r=0;!t.getSegmentParentageBreakVertex(e);r++){if(r===n){o=t.getFirstVertex(s),t.setSegmentParentageBreakVertex(e,!0);break}e=t.getPrevVertex(e)}}}else(0,S.g)(-1===t.getSegmentParentage(o)||t.getSegmentParentageBreakVertex(o));let h=o;for(let s=0;s<n&&h!==C.n;){let a=t.getSegmentParentage(h);if(-1===a){s++,h=t.getNextVertex(h);continue}let o=0,l=C.n,m=h;o=1;let g=t.getNextVertex(m);for(;s<n&&g!==C.n;){s++,l=g,o++;let e=t.getSegmentParentage(g);if(-1===e||t.getSegmentParentageBreakVertex(g))break;(0,S.g)(e===a),g=t.getNextVertex(g)}if(l===C.n)break;if(!i){let s=e.m_originalPlanarSegments[a];e.processSpan_(t,m,l,o,s,a,r)}h=l}}if(s!==C.n)break;n=t.getNextGeometry(n)}else n=s===C.n?t.getNextGeometry(n):C.n}static regularizeCurve(e,t,s,r){let i=t.snapControlPoints(r*r);if(i){let r=e.getVertexIndex(s),i=t.clone();e.setSegmentToIndex(r,i)}if(t.getGeometryType()===C.y.type){let n=[],a=t.calculateSpecialPointsForCracking(r,n);if(a>0){e.splitSegment(s,n,a),i=e.snapControlPoints(s,a+1,r*r)||i;for(let t=0;t<a;t++)s=e.getNextVertex(s),e.setSegmentParentageBreakVertex(s,!0);return a}}return i?0:-1}}function sl(e,t,s,r,i){return new sg(e,s,t,r,i).do_()}function sm(e,t,s){let r=(0,I.d)(t),i=(0,I.a1)(t);return!!function(e,t,s,r,i){let n=new eS(i);return n.m_shape=e,n.m_sqrTolerance=t*t,n.m_cellSize=2*t,n.m_invCellSize=1/n.m_cellSize,n.m_geometry=s,n.m_bTrackChanges=!1,n.needsClustering()}(e,r,C.n,0,s)||eU(!0,e,i,null,s)}class sg{constructor(e,t,s,r,i){this.m_shape=e,this.m_progressTracker=t,this.m_tolerance=s,this.m_bFilterDegenerateSegments=r,this.m_bTrackChanges=i,this.m_progressCounter=0}do_(){let e=new I.C(this.m_tolerance.tolerance,this.m_tolerance.resolution),t=(0,I.d)(e),s=(0,I.a1)(e),r=1.00001*s;s*=1.000001;let i=!1,n=this.m_shape.getTotalPointCount()+10>30?1e3:(this.m_shape.getTotalPointCount()+10)*(this.m_shape.getTotalPointCount()+10),a=this.m_shape.hasPointFeatures();for(let e=0;;e++){this.m_shape.dbgCheckSelection(),e>n&&(0,S.c)("crack_and_cluster_iteration_exceeded"),this.m_shape.dbgVerifyMonotone();let o=-1;0===e&&(o=this.firstCrack_(),i||=o>0);let h=this.cluster_(t);if(this.m_shape.dbgVerifyMonotone(),i||=h,this.m_bFilterDegenerateSegments){let e=0!==this.m_shape.filterClosePoints(t,!0,!1,this.m_bTrackChanges,C.n);i||=e,this.m_shape.dbgVerifyMonotone()}let l=this.m_shape.snapControlPointsOnSelection(r*r);i||=l,this.m_shape.dbgCheckSelection();let m=!1;if((0===e&&-1===o||a||eU(!0,this.m_shape,s,null,this.m_progressTracker))&&(m=this.crack_(r),i||=m,this.m_shape.dbgVerifyMonotone()),!m&&!sg.fixCurveTwoPointLoops(this.m_shape,t,this.m_progressTracker)){this.m_shape.dbgVerifyMonotone();break}}return i&&function(e){if(!e.hasSegmentParentage())return;let t=new I.A(0),s=e.queryVertexIteratorOnSelection();for(let e=s.next();e!==C.n;e=s.next())t.add(e);if(0===t.size())return;e.sortVerticesSimpleByY(t,0,t.size()),t.add(C.n);let r=b.P.getNAN();e.queryXY(t.read(0),r);let i=0,n=b.P.getNAN();for(let s=1,a=t.size();s<a;s++){{let r=t.read(s);r!==C.n?e.queryXY(r,n):n.setNAN()}if(!n.isEqualPoint2D(r)){let a=!1,o=-2;for(let r=i;r<s;++r){let s=t.read(r);if(e.getSegmentParentageBreakVertex(s)){a=!0;break}let i=e.getSegmentParentage(s),n=e.getPrevVertex(s);if(n!==C.n){let t=e.getSegmentParentage(n);if(-1===i&&(i=t),-1===t&&(t=i),i!==t){a=!0;break}}if(-2!==o&&i!==o){a=!0;break}o=i}if(a)for(let r=i;r<s;++r)e.setSegmentParentageBreakVertex(t.read(r),!0);r.setCoordsPoint2D(n),i=s}}}(this.m_shape),i}cluster_(e){return ef(this.m_shape,e,C.n,this.m_bTrackChanges,this.m_progressTracker)}crack_(e){return function(e,t,s,r){if(!eM(e))return!1;let i=new eq(r);i.m_shape=e,i.m_tolerance=t,i.m_bTrackChanges=s;let n=e.hasCurves()?5:15;return e.getTotalPointCount()<n?i.crackBruteForce_():i.crackerPlaneSweep_()}(this.m_shape,e,this.m_bTrackChanges,this.m_progressTracker)}static fixCurveTwoPointLoops(e,t,s){if(!e.hasCurves())return!1;e.dbgVerifyCurves();let r=e.createUserIndexUninitialized(),i=new I.A(0),n=e.queryVertexIteratorOnSelection();for(let t=n.next();t!==C.n;t=n.next())i.add(t),e.setUserIndex(t,r,-1);if(0===i.size())return!1;i.add(C.n),e.sortVerticesSimpleByY(i,0,i.size()-1);let a=0,o=e.getXY(i.read(a)),h=new b.P(Number.NaN,Number.NaN),l=[];for(let t=1,s=i.size();t<s;++t){let s=i.read(t),n=s!==C.n?e.getXY(s):h;if(n.equals(o))continue;let m=[];for(let s=a;s<t;s++){let t=i.read(s),n=e.getPrevVertex(t);if(n!==C.n&&-1===e.getUserIndex(n,r)){let t=su(e.getXY(n),e.getSegment(n));0!==b.P.sqrDistance(o,t.otherPt)&&(t.vert=n,t.dir=-1,m.push(t)),e.setUserIndex(n,r,1)}let a=e.getNextVertex(t);if(a!==C.n&&-1===e.getUserIndex(t,r)){let s=su(e.getXY(a),e.getSegment(t));0!==b.P.sqrDistance(o,s.otherPt)&&(s.vert=t,s.dir=1,m.push(s)),e.setUserIndex(t,r,1)}}if(m.length>1){m.sort((e,t)=>(function(e,t){let s=e.otherPt.compare(t.otherPt);return 0!==s?s:function(e,t){if(null===e.seg||null===t.seg)return null!==e.seg?-1:+(null!==t.seg);let s=e.seg.getGeometryType(),r=t.seg.getGeometryType();return s<r?-1:+(s>r)}(e,t)})(e,t));let e=su(h.clone(),null);m.push(e);let t=0;for(let e=1,s=m.length;e<s;e++)if(!m[e].otherPt.equals(m[e-1].otherPt)){if(e-t>1&&null!==m[t].seg){let s=!1,r=t;for(let i=t+1;i<e;i++)if(!function(e,t){if((0,S.g)(e.otherPt.equals(t.otherPt)),null===e.seg)return null===t.seg;if(null===t.seg)return!1;let s=e.seg.getGeometryType();if(s!==t.seg.getGeometryType())return!1;if(s===S.G.enumBezier){let s=e.seg,r=t.seg,i=s.getControlPoint1(),n=s.getControlPoint2();-1===e.dir&&(n=(0,b.b)(i,i=n));let a=r.getControlPoint1(),o=r.getControlPoint2();return -1===t.dir&&(o=(0,b.b)(a,a=o)),i.equals(a)&&n.equals(o)}if(s===S.G.enumRationalBezier2){let s=e.seg,r=t.seg,i=s.getControlPoint1(),n=r.getControlPoint1();if(!i.equals(n))return!1;let a=[0,0,0];s.queryWeights(a),-1===e.dir&&(a[2]=(0,b.b)(a[0],a[0]=a[2]));let o=[0,0,0];return r.queryWeights(o),-1===t.dir&&(o[2]=(0,b.b)(o[0],o[0]=o[2])),a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]}(0,S.c)("")}(m[r],m[i])){s=!0;break}if(s)for(let s=t;s<e&&null!==m[s].seg;s++)l.push(m[s].vert)}t=e}}a=t,o.setCoordsPoint2D(n)}for(let s of l){let r=e.getSegment(s);(0,S.g)(null!==r);let i=e.getXY(s),n=e.getXY(e.getNextVertex(s));if(b.P.distance(i,n)<3*t)e.setSegmentToIndex(e.getVertexIndex(s),null);else{let t=r.lengthToT(.5*r.calculateLength2D());e.splitSegment(s,[t],1)}}return e.removeUserIndex(r),l.length>0}firstCrack_(){let e=this.m_shape.getEnvelope2D(this.m_progressTracker),t=(0,I.a)(null,e,!0).total();if(4*t<this.m_tolerance.total()){let e=!1,s=this.cluster_(1.1*t);e||=s;let r=0;this.m_bFilterDegenerateSegments&&(r=this.m_shape.filterClosePoints(0,!0,!1,this.m_bTrackChanges,C.n));let i=this.crack_(t);return(e||=i)?1:2*!!r}return -1}progress_(e=!1){this.m_progressCounter++,!e&&4095&this.m_progressCounter||(this.m_progressCounter=0)}}function su(e,t){return{otherPt:e,seg:t,vert:-1,dir:0}}var s_=S.h,sd=S.f,sp=S.A;function sc(e){switch(e){case 1:return 1;case 2:return 2;case 3:break;case 4:return 4;case 0:return 0;default:(0,S.g)(0,"unrecognized cut side")}return 3}function sf(){return{unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1}}function sx(e,t,s,r){return new sC(r).autoCompleteImpl(e,t,s)}function sP(e,t,s,r,i,n,a){let o=new sC(i);o.m_bOGCOutput=!0;let h=e.getGeometryType()===S.G.enumPolygon&&1===e.getFillRule()&&!(0,I.M)(r);return o.planarSimplifyImpl_(e,t,h,s,r,i,n,a)}function sy(e,t,s,r,i,n,a,o){return new sC(n).planarSimplifyImpl_(e,t,s,r,i,n,a,o)}function sE(e,t,s,r){if(e.getDimension()>t.getDimension())return sv(sG(e),e,t,"^");if(e.getDimension()<t.getDimension()||e.isEmpty())return sv(sG(t),e,t,"^");if(t.isEmpty())return sv(sG(e),e,t,"^");let i=new E.J;e.queryEnvelope(i);let n=new E.J;t.queryEnvelope(n);let a=new E.J;a.setCoords({env2D:i}),a.mergeEnvelope2D(n);let o=(0,I.a)(s,a,!0),h=new sC(r),l=new C.E,m=l.addGeometry(sG(e)),g=l.addGeometry(sG(t)),u=0,_=null;if(l.hasCurves()){var d,p;_=new so;let e=l.getEnvelope2D(r);u=sn(o.total()),d=si(o.total(),e),p=o.total(),ss(l,d,p,_,null,r)}h.setEditShapeCrackAndCluster(l,o);let c=h.symmetricDifference(m,g);null!==_&&_.stitchCurves(l,c,u,!0);let f=sv(l.getGeometry(c),e,t,"^");return s_(f.getGeometryType())&&(f.getImpl().setIsSimple(4,o.total()),f.getGeometryType()===S.G.enumPolygon&&f.getImpl().updateOGCFlagsProtected()),f}function sS(e,t,s,r,i,n=!1){0===t&&(0,S.t)("not enough geometries to dissolve");let a=0;for(let s=0;s<t;s++)a=Math.max(e[s].getDimension(),a);if(2===a||1===a)return new sC(r).dissolveMultiPaths_(a,!1,e,t,s,i,n);let o=0,h=-1;for(let s=0;s<t;s++)e[s].getDimension()===a&&(-1===h&&(h=s),e[s].isEmpty()||(h=s,o++));if(o<2)return sG(e[h]);let l=I.n.constructEmpty(),m=new C.E,g=C.n;for(let s=0;s<t;s++)if(e[s].getDimension()===a&&!e[s].isEmpty()){g===C.n?g=m.addGeometry(sG(e[s])):m.appendGeometry(g,sG(e[s]));let t=I.n.constructEmpty();e[s].queryLooseEnvelope(t),l.mergeEnv3D(t)}let u=(0,I.a)(s,l.getEnvelope2D(),!0),_=new sC(r);if(n){let e=(0,I.N)(s,l.getEnvelopeZs(),!0);return _.planarSimplify3DImpl_(m,u,e,0,!0)}return _.m_bOGCOutput=!0,_.planarSimplifyMultiPoints(m,u,!1,-1)}class sC{constructor(e){this.m_topoGraph=null,this.m_maskLookup=[],this.m_dummyPt1=b.P.getNAN(),this.m_dummyPt2=b.P.getNAN(),this.m_fromEdgeForPolylines=C.n,this.m_progressCounter=0,this.m_bOGCOutput=!1,this.m_progressTracker=e}linesToPolygonsImpl(e,t){let s=0,r=0,i=null;if(e.hasCurves()){var n;i=new so;let a=e.getEnvelope2D(this.m_progressTracker);r=sn(t.total());let o=si(t.total(),a);s=sa(o,r),n=t.total(),ss(e,o,n,i,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(e,t.add(s));let a=this.m_topoGraph.createUserIndexForChains(),o=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(o,a,1);for(let e=this.m_topoGraph.getChainFirstIsland(o);e!==C.n;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,a,1);let h=[];for(let t=this.m_topoGraph.getFirstChain();t!==C.n;t=this.m_topoGraph.getChainNext(t)){if(1===this.m_topoGraph.getChainUserIndex(t,a))continue;this.m_topoGraph.setChainUserIndex(t,a,1);for(let e=this.m_topoGraph.getChainFirstIsland(t);e!==C.n;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,a,1);if(0===this.m_topoGraph.getChainArea(t))continue;let s=this.m_topoGraph.extractPolygonFromChainAndIslands(e,C.n,t,C.n);null!=i&&i.stitchCurves(e,s,r,!1);let n=e.getGeometry(s);h.push(n)}return new N.S(h)}autoCompleteImpl(e,t,s){let r=0,i=0,n=null;if(e.hasCurves()){var a;n=new so;let t=e.getEnvelope2D(this.m_progressTracker);i=sn(s.total());let o=si(s.total(),t);r=sa(o,i),a=s.total(),ss(e,o,a,n,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(e,s.add(r));let o=this.m_topoGraph.getGeometryID(t),h=this.m_topoGraph.createUserIndexForChains(),l=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(l,h,1);for(let e=this.m_topoGraph.getChainFirstIsland(l);e!==C.n;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,h,1);let m=[];for(let t=this.m_topoGraph.getFirstChain();t!==C.n;t=this.m_topoGraph.getChainNext(t)){if(1===this.m_topoGraph.getChainUserIndex(t,h))continue;this.m_topoGraph.setChainUserIndex(t,h,1);for(let e=this.m_topoGraph.getChainFirstIsland(t);e!==C.n;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,h,1);if(0!==this.m_topoGraph.getChainParentage(t))continue;let s=this.m_topoGraph.getChainHalfEdge(t),r=s,a=!1;do{let e=this.m_topoGraph.getHalfEdgeTwin(r);if(this.m_topoGraph.getHalfEdgeChain(e)!==t&&this.m_topoGraph.getHalfEdgeParentage(r)&o){a=!0;break}r=this.m_topoGraph.getHalfEdgeNext(r)}while(r!==s);if(!a||0===this.m_topoGraph.getChainArea(t))continue;let l=this.m_topoGraph.extractPolygonFromChainAndIslands(e,C.n,t,C.n);null!==n&&n.stitchCurves(e,l,i,!1);let g=e.getGeometry(l);m.push(g)}return new N.S(m)}setEditShape(e,t=!1){null===this.m_topoGraph&&(this.m_topoGraph=new eg),this.m_topoGraph.setEditShape(e,this.m_progressTracker,!0,t)}setEditShapeCrackAndCluster(e,t){sl(e,t,this.m_progressTracker,!0,!1);for(let t=e.getFirstGeometry();t!==C.n;t=e.getNextGeometry(t))e.getGeometryType(t)===S.G.enumPolygon&&eW(e,t,-1,this.m_bOGCOutput,C.n,this.m_progressTracker);this.setEditShape(e)}setHalfEdgeOrientations_(e,t){let s=this.m_topoGraph.getShape();for(let r=s.getFirstGeometry();r!==C.n;r=s.getNextGeometry(r))if(r===t)for(let t=s.getFirstPath(r);t!==C.n;t=s.getNextPath(t)){let r=s.getFirstVertex(t);if(r===C.n)continue;let i=s.getNextVertex(r);for(;i!==C.n;){let t=this.m_topoGraph.getClusterFromVertex(r),n=this.m_topoGraph.getClusterFromVertex(i),a=this.m_topoGraph.getHalfEdgeConnector(t,n);if(a!==C.n){let t=this.m_topoGraph.getHalfEdgeTwin(a);this.m_topoGraph.setHalfEdgeUserIndex(a,e,1),this.m_topoGraph.setHalfEdgeUserIndex(t,e,2)}r=i,i=s.getNextVertex(r)}}}flushVertices_(e,t){let s=this.m_topoGraph.getShape(),r=s.hasSegmentParentage(),i=new C.S,n=s.insertPath(e,C.n);t.push(t[0]);let a=t.length,o=C.n;for(let e=0;e<a;e++){let h=t[e];if(o=s.addVertex(n,h),!r)continue;let l=this.m_topoGraph.getClusterFromVertex(h);if(e>0&&this.m_topoGraph.isBreakNode(l)&&s.setSegmentParentageBreakVertex(o,!0),e<a-1){let r=this.m_topoGraph.getHalfEdgeConnector(l,this.m_topoGraph.getClusterFromVertex(t[e+1])),n=this.m_topoGraph.getSegmentParentage(r);s.setSegmentParentageAndBreak(o,n,e>0||this.m_topoGraph.isBreakNode(l)),this.m_topoGraph.isHalfEdgeCurve(r)&&(this.m_topoGraph.querySegmentXY(r,i),s.setSegmentToIndex(s.getVertexIndex(o),i.get().clone()))}}if(r){let e=this.m_topoGraph.getClusterFromVertex(t[a-1]);this.m_topoGraph.isBreakNode(e)&&s.setSegmentParentageBreakVertex(o,!0)}s.setClosedPath(n,!0)}processPolygonCuts_(e,t,s,r){let i=this.m_topoGraph.getGeometryID(s),n=this.m_topoGraph.getGeometryID(r),a=[],o=this.m_topoGraph.getShape(),h=this.m_topoGraph.createUserIndexForHalfEdges();for(let s=this.m_topoGraph.getFirstCluster();s!==C.n;s=this.m_topoGraph.getNextCluster(s)){let r=this.m_topoGraph.getClusterHalfEdge(s);if(r===C.n)continue;let l=r;do{if(1!==this.m_topoGraph.getHalfEdgeUserIndex(l,h)){let s=l,r=l,m=!1,g=0;do{if(this.m_topoGraph.setHalfEdgeUserIndex(s,h,1),!m&&this.m_topoGraph.getHalfEdgeParentage(s)&n&&this.m_topoGraph.getHalfEdgeFaceParentage(s)&i&&(r=s,m=!0),m){let t=this.m_topoGraph.getHalfEdgeOrigin(s),r=this.m_topoGraph.getClusterVertexIterator(t),i=this.m_topoGraph.getVertexFromVertexIterator(r);a.push(i),-1!==e&&this.m_topoGraph.getHalfEdgeParentage(s)&n&&(g|=this.m_topoGraph.getHalfEdgeUserIndex(s,e))}s=this.m_topoGraph.getHalfEdgeNext(s)}while(s!==r);if(m&&this.m_topoGraph.getChainArea(this.m_topoGraph.getHalfEdgeChain(r))>0){let e=o.createGeometry(S.G.enumPolygon);this.flushVertices_(e,a),-1!==t&&o.setGeometryUserIndex(e,t,g)}a.length=0}l=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(l))}while(l!==r)}this.m_topoGraph.deleteUserIndexForHalfEdges(h)}cutPolygonPolyline_(e,t,s,r){this.m_topoGraph.removeSpikes_();let i=-1;-1!==e&&(i=this.m_topoGraph.createUserIndexForHalfEdges(),this.setHalfEdgeOrientations_(i,s)),this.processPolygonCuts_(i,e,t,s),-1!==i&&(this.m_topoGraph.deleteUserIndexForHalfEdges(i),i=-1);let n=this.m_topoGraph.getShape();for(let e=n.getFirstGeometry();e!==C.n;e=n.getNextGeometry(e))e!==t&&e!==s&&r.push(e);r.sort((e,t)=>{let s=n.getFirstPath(e),r=n.getRingArea(s),i=n.getFirstPath(t),a=n.getRingArea(i);return r<a?-1:+(r>a)})}cut(e,t,s,r,i){let n=this.m_topoGraph.getShape().getGeometryType(s),a=this.m_topoGraph.getShape().getGeometryType(r),o=(0,S.A)(n),h=(0,S.A)(a);2!==o||1!==h?1!==o||1!==h?(0,S.c)(""):new sT(this,e,t,s,r,i).Do():this.cutPolygonPolyline_(t,s,r,i)}progress_(e=!1){}isGoodParentage(e){return e>=0&&e<this.m_maskLookup.length&&this.m_maskLookup[e]}normalizeInputGeometry(e){let t=e.getGeometryType();if(t===S.G.enumEnvelope){let t=new C.a({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(t===S.G.enumPoint){let t=new C.M({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if((0,S.f)(t)){let t=new C.P({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}return t!==S.G.enumMultiPoint&&t!==S.G.enumPolyline&&t!==S.G.enumPolygon&&(0,S.t)("Unexpected geometry type"),e}dissolveNonSimplePolygons(e,t,s,r){(0,S.g)(t>0);let i=new C.E,n=0,a=-1;for(let s=0;s<t;s++)2===e[s].getDimension()&&(-1===a&&(a=s),e[s].isEmpty()||(n++,i.addGeometry(e[s])));return 0===n?((0,S.g)(a>=0),this.normalizeInputGeometry(e[a])):this.planarSimplifyPolygons(i,s,!0,!1,-1,!0)}dissolveMultiPaths_(e,t,s,r,i,n,a){var o,h,l,m,g;let u;(0,S.g)(e>=1&&e<=2),(0,S.g)(r>0);let _=8&n?1:2,d=I.n.constructEmpty(),p=0,c=-1,f=!0;for(let t=0;t<r;t++)if(s[t].getDimension()===e&&(-1===c&&(c=t),!s[t].isEmpty())){c=t,p++;let r=I.n.constructEmpty();if(s[t].queryLooseEnvelope(r),d.mergeEnv3D(r),2===e&&f&&s[t].getGeometryType()===S.G.enumPolygon)if(16&n){let e=[0],r=s[t].getImpl().getIsSimple(0,e),i=this.m_bOGCOutput?5===r:(0,I.i)(r);f&&=i}else{let e=(0,I.f)(s[t],0);f&&=e}}if(p<2&&((0,S.g)(c>=0),0===p||!(16&n)))return this.normalizeInputGeometry(s[c]);if(!f){let e=(0,I.a)(t?null:i,d.getEnvelope2D(),!0);return this.dissolveNonSimplePolygons(s,r,e,n)}let x=s.slice(0,r),P=(0,I.a)(i,d.getEnvelope2D(),!0),y=10*(0,I.d)(P),v=new I.C(0,0);if(a&&(v=(0,I.N)(i,d.getEnvelopeZs(),!0)),1===p&&1===e&&2===_&&!t)return a?((0,S.g)(0),{}):this.m_bOGCOutput?sP(x[c],P,!1,-1,this.m_progressTracker,_,!1):sy(x[c],P,!1,!1,-1,this.m_progressTracker,_,!1);let G=new I.Q;G.startConstruction();let w=2===e?3:4,T=0;for(let s=0;s<r;s++){if(x[s].getDimension()!==e||x[s].isEmpty())continue;let r=x[s].getGeometryType();if(r!==S.G.enumEnvelope){if((0,S.f)(r)?(x[s]=this.normalizeInputGeometry(x[s]),r=S.G.enumPolyline):(0,S.g)((0,S.h)(r)),1===e){(0,S.g)(r===S.G.enumPolyline);let e=-1;if(a)(0,S.g)(0,"3d not implemented yet");else{let t=[0];e=x[s].getImpl().getIsSimple(P.total(),t)}if(this.m_bOGCOutput?5!==e:!(0,I.i)(e))if(t)w=-1;else{a?(0,S.g)(0,"3d not implemented yet"):this.m_bOGCOutput?x[s]=sP(x[s],P,!1,-1,this.m_progressTracker,_,!1):x[s]=sy(x[s],P,!1,!1,-1,this.m_progressTracker,_,!1);let e=[0];(0,S.g)((0,I.i)(x[s].getImpl().getIsSimple(P.total(),e)))}}else{(0,S.g)(r===S.G.enumPolygon);let e=[0],t=x[s].getImpl().getIsSimple(0,e);(0,S.g)((0,I.M)(t))}let i=x[s].getImpl();for(let e=0,t=i.getPathCount();e<t;e++){let t=E.J.constructEmpty();i.queryLoosePathEnvelope(e,t),t.inflateCoords(y,y),G.addEnvelope(T,t),T++}}else{(0,S.g)(r===S.G.enumEnvelope);let e=E.J.constructEmpty();x[s].queryLooseEnvelope(e),e.inflateCoords(y,y),G.addEnvelope(T,e),T++,w=-1}}G.endConstruction();let N=T,D=(0,b.d)(N,-0x7fffffff),V=(0,b.d)(N,-1),F=0;c=-1,T=0;for(let t=0;t<r;t++){if(x[t].getDimension()!==e||(-1===c&&(c=t),x[t].isEmpty()))continue;c=t,F++;let s=x[t].getGeometryType();if((0,S.h)(s))for(let e=0,s=x[t].getPathCount();e<s;e++)V[T]=t,D[T]=-e-1,T++;else(0,S.g)(s===S.G.enumEnvelope),V[T]=t,D[T]=-1,T++}if(F<2&&2===e)return(0,S.g)(c>=0),this.normalizeInputGeometry(x[c]);let H=N;for(;G.next()&&H>0;){this.progress_();let e=G.getHandleA(),t=G.getHandleB(),s=G.getElement(e),r=G.getElement(t);V[s]!==V[r]&&(D[s]<0&&(H--,D[s]=-(D[s]+1)),D[r]<0&&(H--,D[r]=-(D[r]+1)))}let k=new C.E,A=!1,M=0;for(let t=0;t<r;t++){if(x[t].getDimension()!==e||x[t].isEmpty())continue;let s=x[t].getGeometryType(),r=M,i=0,n=0,a=(0,S.h)(s)?x[t]:null;for(let e=r,s=D.length;e<s&&V[e]===t;e++)D[e]>=0&&(i++,n+=a?a.getPathSize(D[e]):(0,S.v)(x[t])),M++;if(n>.95*(0,S.v)(x[t])){k.addGeometry(this.normalizeInputGeometry(x[t]));for(let e=r;e<M;e++)D[e]<0&&(D[e]=-(D[e]+1))}else{if(0===i){A=!0;continue}{A=!0,(0,S.g)((0,S.h)(s)),(0,S.g)(null!=a);let e=new C.a({vd:x[t].getDescription()}),i=new C.P({vd:x[t].getDescription()}),n=s===S.G.enumPolygon?e:i;for(let e=r;e<M;e++)D[e]>=0&&n.addPath(a,D[e],!0);k.addGeometry(n)}}}if(k.getFirstGeometry()!==C.n){let s=t?(0,I.a)(null,d.getEnvelope2D(),!0):P,r=new I.C(0,0);if(a&&(r=t?(0,I.N)(null,d.getEnvelopeZs(),!0):v),2===e&&!(2&n)){k.collapseAllGeometriesToFirst();let e=0,t=null;if(k.hasCurves()&&!k.hasSegmentParentage()){t=new so;let r=k.getEnvelope2D(this.m_progressTracker);e=sn(s.total()),o=si(s.total(),r),h=s.total(),ss(k,o,h,t,null,this.m_progressTracker)}l=k.getFirstGeometry(),m=s.total(),g=this.m_progressTracker,m>0&&ef(k,m,l,!1,g),new eA(g).executeImpl_(k,l),null!==t&&t.stitchCurves(k,C.n,e,!0)}if(a)u=this.planarSimplify3DImpl_(k,s,r,_,!0);else if(2===e)u=this.planarSimplifyPolygons(k,s,2===e,t,-1,!1);else{let e=sf();e.ogcRule=this.m_bOGCOutput,e.allCrossRoadsImpassable=!0,e.unsplitBehavior=_,u=this.planarSimplifyPolylines(k,s,t,e,-1)}A||(w=u.getImpl().getIsSimple(s.total(),[0]))}else(0,S.g)(A),(0,S.g)(c>=0),u=2===e?new C.a({vd:x[c].getDescription()}):new C.P({vd:x[c].getDescription()});if(A){let e=0;for(let t=0,s=D.length;t<s;t++){let s=V[t];if(!(s<0)&&D[t]<0){let r=x[s].getGeometryType(),i=(0,S.h)(r)?x[s]:null;if(i){let s=-(D[t]+1);e+=i.getPathSize(s)}else e+=4}}u.reserve(u.getPointCount()+e);for(let e=0,t=D.length;e<t;e++){let t=V[e];if(!(t<0)&&D[e]<0){let s=x[t].getGeometryType(),r=(0,S.h)(s)?x[t]:null;if(r){let t=-(D[e]+1);u.addPath(r,t,!0)}else s===S.G.enumEnvelope?u.addEnvelope(x[t],!1):((0,S.g)((0,S.f)(s)),u.addSegment(x[t],!0))}}}let U=0;if(2===e?-1!==w&&(w=3,U=t?0:P.total()):((0,S.g)(1===e),t||-1===w||(U=P.total())),a||u.getImpl().setIsSimple(w,U),!t&&A)if(2===e){if(!a)return(new sM).execute(u,i,!1,this.m_progressTracker);(0,S.g)(0,"3d not yet implemented")}else 1===e&&1!==_&&(u=a?((0,S.g)(0),{}):function(e,t,s,r){let i=new sC(r),n=new C.E,a=n.addGeometry(t),o=i.planarSimplifyNoCrackingAndCluster(e,n,a,s);return(0,S.g)(o,"planar_simplify_no_cracking_and_cluster"),n.getGeometry(a)}(this.m_bOGCOutput,u,_,this.m_progressTracker)).getImpl().setIsSimple(w,U);return u}dissolveTopoGraphCommonEdges_(){let e=this.m_topoGraph.createUserIndexForHalfEdges(),t=[];for(let s=this.m_topoGraph.getFirstCluster();s!==C.n;s=this.m_topoGraph.getNextCluster(s)){let r=this.m_topoGraph.getClusterHalfEdge(s),i=r;if(r!==C.n)do{if(this.progress_(),1!==this.m_topoGraph.getHalfEdgeUserIndex(i,e)){let s=this.m_topoGraph.getHalfEdgeTwin(i);this.m_topoGraph.setHalfEdgeUserIndex(s,e,1),this.m_topoGraph.setHalfEdgeUserIndex(i,e,1);let r=this.m_topoGraph.getHalfEdgeFaceParentage(i);if(this.isGoodParentage(r)){let e=this.m_topoGraph.getHalfEdgeFaceParentage(s);this.isGoodParentage(e)&&t.push(i)}}i=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(i))}while(i!==r)}this.m_topoGraph.deleteUserIndexForHalfEdges(e),this.m_topoGraph.deleteEdgesBreakFaces_(t)}chooseVertexByOrder(e,t,s,r){let i=(0,b.j)(),n=C.n;for(let r=this.m_topoGraph.getClusterVertexIterator(e);r!==C.n;r=this.m_topoGraph.incrementVertexIterator(r)){let e=this.m_topoGraph.getVertexFromVertexIterator(r),a=t.getUserIndex(e,s);a>=0&&a<i&&(i=a,n=e)}(0,S.g)(n!==C.n);let a=t.getUserIndex(n,r);return a>0&&(t.setUserIndex(n,r,--a),0===a&&t.setUserIndex(n,s,-1)),n}chooseVertexFromCluster_(e,t){return this.m_topoGraph.getVertexDominantFromCluster(e,t)}chooseVertexFromVertexCluster_(e,t){return this.m_topoGraph.getVertexDominant(e,t)}collectPolygonPathsPreservingFrom_(e,t,s,r,i){let n=this.m_topoGraph.getShape();if(n.getGeometryType(e)!==S.G.enumPolygon)return;let a=n.hasSegmentParentage(),o=new C.S;for(let h=n.getFirstPath(e);h!==C.n;h=n.getNextPath(h)){let e=n.getFirstVertex(h);this.m_topoGraph.getClusterFromVertex(e);let l=this.m_topoGraph.getHalfEdgeFromVertex(e);if(l===C.n)continue;let m=this.m_topoGraph.getHalfEdgeUserIndex(l,s);if(1===m||2===m)continue;let g=this.m_topoGraph.getHalfEdgeFaceParentage(l);if(!this.isGoodParentage(g)){this.m_topoGraph.setHalfEdgeUserIndex(l,s,2);continue}this.m_topoGraph.setHalfEdgeUserIndex(l,s,1);let u=n.insertPath(t,C.n);n.setClosedPath(u,!0);let _=l,d=e,p=this.m_topoGraph.getClusterFromVertex(d),c=1;do{let e,t;this.progress_();let h=this.chooseVertexFromVertexCluster_(d,i),l=n.addVertex(u,h);if(this.m_topoGraph.isHalfEdgeCurve(_)&&(this.m_topoGraph.querySegmentXY(_,o),n.setSegmentToIndex(n.getVertexIndex(l),o.get().clone())),a){let e=this.m_topoGraph.getSegmentParentage(_);n.setSegmentParentageAndBreak(l,e,this.m_topoGraph.isBreakNode(p))}-1!==r&&this.m_topoGraph.setClusterUserIndex(p,r,1),this.m_topoGraph.setHalfEdgeUserIndex(_,s,1),_=this.m_topoGraph.getHalfEdgeNext(_);do t=(e=1===c?n.getNextVertex(d):n.getPrevVertex(d))!==C.n?this.m_topoGraph.getClusterFromVertex(e):C.n;while(t===p);let m=this.m_topoGraph.getHalfEdgeOrigin(_);if(m!==t){do t=(e=1===c?n.getPrevVertex(d):n.getNextVertex(d))!==C.n?this.m_topoGraph.getClusterFromVertex(e):C.n;while(t===p);if(m!==t){t=m;let s=this.m_topoGraph.getClusterVertexIterator(t);e=this.m_topoGraph.getVertexFromVertexIterator(s)}else c=-c}p=t,d=e}while(_!==l)}}topoOperationPolygonPolygonHelper_(e,t,s,r,i,n){this.progress_(!0),e!==C.n&&this.collectPolygonPathsPreservingFrom_(e,s,i,n,r),t!==C.n&&this.collectPolygonPathsPreservingFrom_(t,s,i,n,r);let a=new C.S,o=this.m_topoGraph.getShape();o.dbgVerifyCurves();let h=o.hasSegmentParentage();for(let e=this.m_topoGraph.getFirstCluster();e!==C.n;e=this.m_topoGraph.getNextCluster(e)){let t=this.m_topoGraph.getClusterHalfEdge(e);if(t===C.n)continue;let l=t;do{this.progress_();let e=this.m_topoGraph.getHalfEdgeUserIndex(l,i);if(1!==e&&2!==e){let e=this.m_topoGraph.getHalfEdgeFaceParentage(l);if(this.isGoodParentage(e)){let e=o.insertPath(s,C.n);o.setClosedPath(e,!0);let t=l;do{let s=this.m_topoGraph.getHalfEdgeVertexIterator(t),l=C.n;if(s!==C.n)l=this.m_topoGraph.getVertexFromVertexIterator(s);else{let e=this.m_topoGraph.getHalfEdgeVertexIterator(this.m_topoGraph.getHalfEdgeTwin(t));l=this.m_topoGraph.getVertexFromVertexIterator(e),l=o.getNextVertex(l)}let m=this.chooseVertexFromVertexCluster_(l,r),g=o.addVertex(e,m);if(h){let e=this.m_topoGraph.getSegmentParentage(t),s=this.m_topoGraph.getHalfEdgeOrigin(t);o.setSegmentParentageAndBreak(g,e,this.m_topoGraph.isBreakNode(s))}if(this.m_topoGraph.isHalfEdgeCurve(t)&&(this.m_topoGraph.querySegmentXY(t,a),o.setSegmentToIndex(o.getVertexIndex(g),a.get().clone())),this.m_topoGraph.setHalfEdgeUserIndex(t,i,1),-1!==n){let e=this.m_topoGraph.getClusterFromVertex(m);this.m_topoGraph.setClusterUserIndex(e,n,1)}t=this.m_topoGraph.getHalfEdgeNext(t)}while(t!==l)}else this.m_topoGraph.setHalfEdgeUserIndex(l,i,2)}l=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(l))}while(l!==t)}}topoOperationPolygonPolygon_(e,t,s,r=!1){this.dissolveTopoGraphCommonEdges_();let i=this.m_topoGraph.getShape(),n=i.createGeometry(S.G.enumPolygon),a=this.m_topoGraph.createUserIndexForHalfEdges();return this.topoOperationPolygonPolygonHelper_(e,t,n,s,a,-1),this.m_topoGraph.deleteUserIndexForHalfEdges(a),r||eW(i,n,3,this.m_bOGCOutput,C.n,this.m_progressTracker),n}topoOperationPolyline_(e,t){let s=sf();return s.allCrossRoadsImpassable=!1,s.ogcRule=t,s.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(C.n,e,!1,s).first}topoOperationMultiPoint_(){let e=this.m_topoGraph.getShape(),t=e.createGeometry(S.G.enumMultiPoint),s=e.insertPath(t,C.n);for(let t=this.m_topoGraph.getFirstCluster();t!==C.n;t=this.m_topoGraph.getNextCluster(t)){let r=this.m_topoGraph.getClusterParentage(t);if(this.isGoodParentage(r)){let r=C.n;for(let s=this.m_topoGraph.getClusterVertexIterator(t);s!==C.n;s=this.m_topoGraph.incrementVertexIterator(s)){let t=this.m_topoGraph.getVertexFromVertexIterator(s);r===C.n&&(r=t);let i=e.getGeometryFromPath(e.getPathFromVertex(t)),n=this.m_topoGraph.getGeometryID(i);if(this.isGoodParentage(n)){r=t;break}}e.addVertex(s,r)}}return t}intersection(e,t){let s=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),i=(0,S.A)(s),n=(0,S.A)(r),a=this.m_topoGraph.getGeometryID(e),o=this.m_topoGraph.getGeometryID(t);(0,S.g)(a>=0),(0,S.g)(o>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(a|o),this.m_maskLookup[a|o]=!0;let h=C.n;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(h=e),2===i&&2===n?this.topoOperationPolygonPolygon_(e,t,h):1===i&&n>0||1===n&&i>0?this.topoOperationPolyline_(h,this.m_bOGCOutput):0===i||0===n?this.topoOperationMultiPoint_():void(0,S.c)("")}topoOperationPolygonPolygonEx(e,t,s){let r=this.m_topoGraph.getShape(),i=r.createGeometry(S.G.enumPolygon),n=r.createGeometry(S.G.enumPolyline),a=r.createGeometry(S.G.enumMultiPoint);this.dissolveTopoGraphCommonEdges_();let o=C.n,h=this.m_topoGraph.createUserIndexForHalfEdges(),l=this.m_topoGraph.createUserIndexForClusters();r.dbgVerifyCurves(),this.topoOperationPolygonPolygonHelper_(e,t,i,s,h,l),r.dbgVerifyCurves();let m=r.hasSegmentParentage(),g=new C.S;for(let e=this.m_topoGraph.getFirstCluster();e!==C.n;e=this.m_topoGraph.getNextCluster(e)){let t=this.m_topoGraph.getClusterHalfEdge(e);if(t===C.n)continue;let i=t;do{let t=this.m_topoGraph.getHalfEdgeUserIndex(i,h),a=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(i),h),o=t|a;if(2===o){let u=this.m_topoGraph.getHalfEdgeParentage(i);if(this.isGoodParentage(u)){let _=r.insertPath(n,C.n),d=i,p=this.chooseVertexFromCluster_(e,s),c=r.addVertex(_,p);if(m){let e=this.m_topoGraph.getSegmentParentage(i),t=this.m_topoGraph.getHalfEdgeOrigin(i);r.setSegmentParentageAndBreak(c,e,this.m_topoGraph.isBreakNode(t))}this.m_topoGraph.isHalfEdgeCurve(i)&&(this.m_topoGraph.querySegmentXY(i,g),r.setSegmentToIndex(r.getVertexIndex(c),g.get().clone())),this.m_topoGraph.setClusterUserIndex(e,l,1);do{this.progress_();let e=this.m_topoGraph.getHalfEdgeTo(d),n=this.chooseVertexFromCluster_(e,s);if(c=r.addVertex(_,n),m){let e=this.m_topoGraph.getSegmentParentage(i),t=this.m_topoGraph.getHalfEdgeOrigin(i);r.setSegmentParentageAndBreak(c,e,this.m_topoGraph.isBreakNode(t))}if(this.m_topoGraph.setHalfEdgeUserIndex(d,h,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(d),h,1),this.m_topoGraph.setClusterUserIndex(e,l,1),d=this.m_topoGraph.getHalfEdgeNext(d),2!=(o=(t=this.m_topoGraph.getHalfEdgeUserIndex(d,h))|(a=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(d),h))))break;if(u=this.m_topoGraph.getHalfEdgeParentage(d),!this.isGoodParentage(u)){this.m_topoGraph.setHalfEdgeUserIndex(d,h,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(d),h,1);break}this.m_topoGraph.isHalfEdgeCurve(i)&&d!==i&&(this.m_topoGraph.querySegmentXY(i,g),r.setSegmentToIndex(r.getVertexIndex(c),g.get().clone()))}while(d!==i)}else this.m_topoGraph.setHalfEdgeUserIndex(i,h,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(i),h,1)}i=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(i))}while(i!==t)}for(let e=this.m_topoGraph.getFirstCluster();e!==C.n;e=this.m_topoGraph.getNextCluster(e)){if(this.progress_(),1===this.m_topoGraph.getClusterUserIndex(e,l))continue;let t=this.m_topoGraph.getClusterParentage(e);if(this.isGoodParentage(t)){o===C.n&&(o=r.insertPath(a,C.n));let t=this.m_topoGraph.getClusterVertexIterator(e),i=C.n;if(t!==C.n){i=this.m_topoGraph.getVertexFromVertexIterator(t);let e=this.chooseVertexFromVertexCluster_(i,s);r.addVertex(o,e)}}}this.m_topoGraph.deleteUserIndexForClusters(l),this.m_topoGraph.deleteUserIndexForHalfEdges(h),r.dbgVerifyCurves(),eW(r,i,3,this.m_bOGCOutput,C.n,this.m_progressTracker);let u=[C.n,C.n,C.n];return u[0]=a,u[1]=n,u[2]=i,u}topoOperationPolylinePolylineOrPolygonEx(e,t){let s=sf();return s.allCrossRoadsImpassable=!1,s.ogcRule=t,s.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(C.n,e,!0,s)}topoOperationMultiPoint(){let e=this.m_topoGraph.getShape(),t=e.createGeometry(S.G.enumMultiPoint),s=e.insertPath(t,C.n);for(let t=this.m_topoGraph.getFirstCluster();t!==C.n;t=this.m_topoGraph.getNextCluster(t)){let r=this.m_topoGraph.getClusterParentage(t);if(this.isGoodParentage(r)){let r=C.n;for(let s=this.m_topoGraph.getClusterVertexIterator(t);s!==C.n;s=this.m_topoGraph.incrementVertexIterator(s)){let t=this.m_topoGraph.getVertexFromVertexIterator(s);r===C.n&&(r=t);let i=e.getGeometryFromPath(e.getPathFromVertex(t)),n=this.m_topoGraph.getGeometryID(i);if(this.isGoodParentage(n)){r=t;break}}e.addVertex(s,r)}}return t}intersectionEx(e,t){let s=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),i=sp(s),n=sp(r),a=this.m_topoGraph.getGeometryID(e),o=this.m_topoGraph.getGeometryID(t);(0,S.g)(a>=0),(0,S.g)(o>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(a|o),this.m_maskLookup[a|o]=!0;let h=C.n;if(this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(h=e),2===i&&2===n)return this.topoOperationPolygonPolygonEx(e,t,h);if(1===i&&n>0||1===n&&i>0){let{first:e,second:t}=this.topoOperationPolylinePolylineOrPolygonEx(h,this.m_bOGCOutput);return[t,e]}if(0===i||0===n){let e=[];return e.push(this.topoOperationMultiPoint()),e}(0,S.c)("")}getCombinedHalfEdgeParentage(e){return this.m_topoGraph.getHalfEdgeParentage(e)|this.m_topoGraph.getHalfEdgeFaceParentage(e)|this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e))}prevailingDirection(e,t){let s=this.getCombinedHalfEdgeParentage(t),r=this.m_topoGraph.getHalfEdgeOrigin(t),i=this.m_topoGraph.getHalfEdgeTo(t),n=0,a=0;for(let o=this.m_topoGraph.getClusterVertexIterator(r);o!==C.n;o=this.m_topoGraph.incrementVertexIterator(o)){let r=this.m_topoGraph.getVertexFromVertexIterator(o),h=e.getPathFromVertex(r),l=e.getGeometryFromPath(h),m=this.m_topoGraph.getGeometryID(l),g=e.getFirstVertex(h),u=!!(m&s);u&&g===r&&(this.m_fromEdgeForPolylines=t);let _=e.getNextVertex(r);if(_!==C.n&&this.m_topoGraph.getClusterFromVertex(_)===i){if(n++,u){if(this.m_fromEdgeForPolylines===C.n&&g===_){let e=this.m_topoGraph.getHalfEdgeNext(t);this.isGoodParentage(this.getCombinedHalfEdgeParentage(e))&&(this.m_fromEdgeForPolylines=e)}a++}}else{let s=e.getPrevVertex(r);if(s!==C.n&&this.m_topoGraph.getClusterFromVertex(s)===i&&(n--,u)){if(this.m_fromEdgeForPolylines===C.n&&g===s){let e=this.m_topoGraph.getHalfEdgeNext(t);this.isGoodParentage(this.getCombinedHalfEdgeParentage(e))&&(this.m_fromEdgeForPolylines=e)}a--}}}return this.m_topoGraph.queryXY(r,this.m_dummyPt1),this.m_topoGraph.queryXY(i,this.m_dummyPt2),(0!==a?a:n)*b.P.distance(this.m_dummyPt1,this.m_dummyPt2)}tryMoveThroughCrossroadBackwards(e,t){let s=this.m_topoGraph.getHalfEdgePrev(e),r=this.m_topoGraph.getHalfEdgeTwin(s);if(!t){if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(e)))return C.n;let t=this.m_topoGraph.getHalfEdgeTwin(e);if(r===this.m_topoGraph.getHalfEdgeNext(t))return s}let i=r,n=C.n;for(;i!==e;){let e=this.getCombinedHalfEdgeParentage(i);if(this.isGoodParentage(e)){if(n!==C.n)return C.n;n=this.m_topoGraph.getHalfEdgeTwin(i)}i=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgePrev(i))}return n}tryMoveThroughCrossroadForward(e,t){let s=this.m_topoGraph.getHalfEdgeNext(e),r=this.m_topoGraph.getHalfEdgeTwin(s);if(!t){let t=this.m_topoGraph.getHalfEdgeTwin(e);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(t)))return C.n;if(r===this.m_topoGraph.getHalfEdgePrev(t))return s}let i=r,n=C.n;for(;i!==e;){let e=this.getCombinedHalfEdgeParentage(i);if(this.isGoodParentage(e)){if(n!==C.n)return C.n;n=this.m_topoGraph.getHalfEdgeTwin(i)}i=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgeNext(i))}return n}isOnALoop(e,t){let s=e,r=2*this.m_topoGraph.getShape().getTotalPointCount()+10;for(let i=0;i<r;i++){if(1===this.m_topoGraph.getHalfEdgeUserIndex(s,t))return!1;let r=this.m_topoGraph.getHalfEdgeNext(s);if(r===this.m_topoGraph.getHalfEdgeTwin(s))return!1;if((s=r)===e)return!0}(0,S.c)("is_on_a_loop_")}restorePolylineParts(e,t,s,r,i,n,a,o,h,l){let m;(0,S.g)(i===C.n&&n>=0&&a>=0||-1===n&&-1===a),(0,S.g)(-1===o&&1!==l.unsplitBehavior||-1!==o&&1===l.unsplitBehavior);let g=l.ogcRule,u=l.allCrossRoadsImpassable,_=1===l.unsplitBehavior,d=0===l.unsplitBehavior,p=this.m_topoGraph.getShape(),c=p.hasSegmentParentage(),f=e,x=this.m_topoGraph.getHalfEdgeTwin(f),P=new C.S;this.m_fromEdgeForPolylines=C.n;let y=this.prevailingDirection(p,f),E=f,I=C.n,v=!1,G=!1,w=!1;if(!_)for(;;){let t=this.m_topoGraph.getHalfEdgePrev(f);if(t===x){w=!0;break}let r=this.m_topoGraph.getHalfEdgeNext(x);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(r))){v=!0;break}if(this.m_topoGraph.getHalfEdgeTwin(t)!==r){if(u||(f=this.tryMoveThroughCrossroadBackwards(f,!0))===C.n){v=!0;break}x=this.m_topoGraph.getHalfEdgeTwin(f)}else f=t,x=r;if(1===this.m_topoGraph.getHalfEdgeUserIndex(f,s)){w=!0;break}if(f===e){I=e,G=!0;break}let i=this.getCombinedHalfEdgeParentage(f);if(!this.isGoodParentage(i))break;E=f,y+=this.prevailingDirection(p,f)}if(I===C.n){for(f=e,x=this.m_topoGraph.getHalfEdgeTwin(f),I=f;;){let e=this.m_topoGraph.getHalfEdgeNext(f),t=this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(e));if(t){v=!0;break}if(e===x){w=!0;break}if(-1!==o){let e=this.m_topoGraph.getHalfEdgeOrigin(x);if(1===this.m_topoGraph.getClusterUserIndex(e,o)){v=!0;break}}let r=this.m_topoGraph.getHalfEdgePrev(x);if(this.m_topoGraph.getHalfEdgeTwin(e)!==r){if(t||u||(f=this.tryMoveThroughCrossroadForward(f,!0))===C.n){v=!0;break}x=this.m_topoGraph.getHalfEdgeTwin(f)}else f=e,x=r;if(1===this.m_topoGraph.getHalfEdgeUserIndex(f,s)){w=!0;break}let i=this.getCombinedHalfEdgeParentage(f);if(!this.isGoodParentage(i))break;I=f,y+=this.prevailingDirection(p,f)}let t=this.m_topoGraph.getHalfEdgeOrigin(E);G=this.m_topoGraph.getHalfEdgeTo(I)===t}else if(this.m_fromEdgeForPolylines!==C.n){E=e,I=this.tryMoveThroughCrossroadBackwards(E,!1),(0,S.g)(I!==C.n);let t=this.m_topoGraph.getHalfEdgeTwin(E);this.m_topoGraph.getHalfEdgeNext(t)}let T=G;G||w||h&&((T=this.isOnALoop(e,s))||(T=this.isOnALoop(x,s)));let N=y>=0,D=!1;T&&v&&(G?(D=g,N&&(D||_||d)&&E!==e&&((0,S.g)(!_),E=e,D=!1)):(_||N&&d)&&(E=e));let V=0;for(f=E;x=this.m_topoGraph.getHalfEdgeTwin(f),this.m_topoGraph.setHalfEdgeUserIndex(f,s,1),this.m_topoGraph.setHalfEdgeUserIndex(x,s,1),V++,f!==I;)f=u?this.m_topoGraph.getHalfEdgeNext(f):this.tryMoveThroughCrossroadForward(f,!1);N||(I=(0,b.b)(E,E=I),I=this.m_topoGraph.getHalfEdgeTwin(I),E=this.m_topoGraph.getHalfEdgeTwin(E));let F=p.insertPath(t,C.n);f=E;let H=this.m_topoGraph.getHalfEdgeOrigin(E);m=-1!==n?this.chooseVertexByOrder(H,p,n,a):this.chooseVertexFromCluster_(H,i),this.m_topoGraph.isStrongPathNode(H)&&p.setStrongPathStart(F,!0);let k=p.addVertex(F,m),A=k;-1!==r&&this.m_topoGraph.setClusterUserIndex(H,r,1);let M=0,U=D?Math.trunc((V+1)/2):-1,q=C.n,O=!0,B=C.n;for(;;){let e;if(c){let e=this.m_topoGraph.getSegmentParentage(f),t=this.m_topoGraph.getHalfEdgeOrigin(f);p.setSegmentParentageAndBreak(A,e,O||this.m_topoGraph.isBreakNode(t))}O=!1,this.m_topoGraph.isHalfEdgeCurve(f)&&(this.m_topoGraph.querySegmentXY(f,P),p.setSegmentToIndex(p.getVertexIndex(A),P.get().clone())),q!==C.n&&-1!==a&&p.addToUserIndex(q,a,-1);let s=u?this.m_topoGraph.getHalfEdgeNext(f):this.tryMoveThroughCrossroadForward(f,!1),o=this.m_topoGraph.getHalfEdgeTo(f);if(e=-1!==n?this.chooseVertexByOrder(o,p,n,a):this.chooseVertexFromCluster_(o,i),k=p.addVertex(F,e),B=o,-1!==r&&this.m_topoGraph.setClusterUserIndex(o,r,1),c&&this.m_topoGraph.isBreakNode(o)&&p.setSegmentParentageBreakVertex(k,!0),q=e,M++,D&&M===U&&(F=p.insertPath(t,C.n),k=p.addVertex(F,e),O=!0,-1!==a&&p.addToUserIndex(e,a,-1),q=C.n),f===I)break;f=s,A=k}B!==C.n&&this.m_topoGraph.isStrongPathNode(B)&&p.setStrongPathEnd(F,!0)}topoOperationPolylineSimplify_(e,t){return this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,C.n,!1,t).first}topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,t,s,r){(0,S.g)(t===C.n||e===C.n);let i=this.m_topoGraph.getShape(),n=t=>t=e===C.n?t===C.n?i.getFirstGeometry():i.getNextGeometry(t):t===C.n?e:C.n,a=i.createGeometry(S.G.enumPolyline),o=-1;s&&(o=this.m_topoGraph.createUserIndexForClusters());let h=this.m_topoGraph.createUserIndexForHalfEdges(),l=t===C.n?i.createUserIndex():-1,m=t===C.n?i.createUserIndex():-1,g=-1;if(1===r.unsplitBehavior){g=this.m_topoGraph.createUserIndexForClusters();for(let e=n(C.n);e!==C.n;e=n(e))for(let t=i.getFirstPath(e);t!==C.n;t=i.getNextPath(t)){{let e=i.getFirstVertex(t),s=this.m_topoGraph.getClusterFromVertex(e);this.m_topoGraph.setClusterUserIndex(s,g,1)}if(!i.isClosedPath(t)){let e=i.getLastVertex(t),s=this.m_topoGraph.getClusterFromVertex(e);this.m_topoGraph.setClusterUserIndex(s,g,1)}}}if(t===C.n){let e=0;for(let t=n(C.n);t!==C.n;t=n(t))for(let s=i.getFirstPath(t);s!==C.n;s=i.getNextPath(s))if(i.isClosedPath(s)){let t=i.getFirstVertex(s);for(let r=0,n=i.getPathSize(s);r<n;r++,t=i.getNextVertex(t))i.setUserIndex(t,l,e++),i.setUserIndex(t,m,2)}else{let t=i.getFirstVertex(s);i.setUserIndex(t,l,e++),i.setUserIndex(t,m,1);let r=i.getNextVertex(t);for(let t=1,n=i.getPathSize(s)-1;t<n;++t)i.setUserIndex(r,l,e++),i.setUserIndex(r,m,2),r=i.getNextVertex(r);i.setUserIndex(r,l,e++),i.setUserIndex(r,m,1)}}for(let e=n(C.n);e!==C.n;e=n(e))for(let s=i.getFirstPath(e);s!==C.n;s=i.getNextPath(s)){let e=i.getFirstVertex(s);for(let n=0,u=i.getPathSize(s);n<u;n++,e=i.getNextVertex(e)){let s=this.m_topoGraph.getHalfEdgeFromVertex(e);if(s===C.n||1===this.m_topoGraph.getHalfEdgeUserIndex(s,h))continue;let i=this.getCombinedHalfEdgeParentage(s);if(this.isGoodParentage(i)){let e=0===n;this.restorePolylineParts(s,a,h,o,t,l,m,g,e,r)}}}let u=C.n;if(s){u=i.createGeometry(S.G.enumMultiPoint);let e=C.n;for(let s=this.m_topoGraph.getFirstCluster();s!==C.n;s=this.m_topoGraph.getNextCluster(s))if(this.progress_(),1!==this.m_topoGraph.getClusterUserIndex(s,o)){let r=this.m_topoGraph.getClusterParentage(s);if(this.isGoodParentage(r)){e===C.n&&(e=i.insertPath(u,C.n));let r=this.m_topoGraph.getClusterVertexIterator(s);if(r!==C.n){let n;this.m_topoGraph.getVertexFromVertexIterator(r),n=-1!==l?this.chooseVertexByOrder(s,i,l,m):this.chooseVertexFromCluster_(s,t),i.addVertex(e,n)}}}}return -1!==m&&i.removeUserIndex(m),-1!==l&&i.removeUserIndex(l),-1!==o&&i.removeUserIndex(o),this.m_topoGraph.deleteUserIndexForHalfEdges(h),(0,b.n)(a,u)}difference(e,t){let s=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),i=(0,S.A)(s),n=(0,S.A)(r);if(i>n)return e;let a=this.m_topoGraph.getGeometryID(e),o=this.m_topoGraph.getGeometryID(t);if(this.m_maskLookup.length=0,this.m_maskLookup.length=1+(a|o),this.m_maskLookup[a]=!0,2===i&&2===n){let s=C.n;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(s=e),this.topoOperationPolygonPolygon_(e,t,s)}if(1===i&&2===n){let t=sf();return t.allCrossRoadsImpassable=!1,t.ogcRule=this.m_bOGCOutput,t.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,C.n,!1,t).first}if(1===i&&1===n){let t=sf();return t.allCrossRoadsImpassable=!0,t.ogcRule=this.m_bOGCOutput,t.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,C.n,!1,t).first}if(0===i)return this.topoOperationMultiPoint_();(0,S.c)("")}symmetricDifference(e,t){let s=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),i=sp(s),n=sp(r),a=this.m_topoGraph.getGeometryID(e),o=this.m_topoGraph.getGeometryID(t);return(0,S.g)(a>=0),(0,S.g)(o>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(a|o),this.m_maskLookup[a]=!0,this.m_maskLookup[a]=!0,this.m_maskLookup[o]=!0,2===i&&2===n?this.topoOperationPolygonPolygon_(e,t,C.n):1===i&&1===n?this.topoOperationPolyline_(C.n,this.m_bOGCOutput):0===i&&0===n?this.topoOperationMultiPoint():void(0,S.c)("")}planarSimplifyNoCrackingAndCluster(e,t,s,r){this.m_bOGCOutput=e,this.m_topoGraph=new eg;let i=t.getFillRule(s),n=t.getGeometryType(s);if(1!==i||n===S.G.enumMultiPoint?this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,s,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeWinding(t,s,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return!1;this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);let a=this.m_topoGraph.getGeometryID(s);if((0,S.g)(a>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=a+1,this.m_maskLookup[a]=!0,t.getGeometryType(s)===S.G.enumPolygon||1===i&&t.getGeometryType(s)!==S.G.enumMultiPoint){t.setFillRule(s,0);let n=this.topoOperationPolygonPolygon_(s,C.n,C.n);if(t.swapGeometry(n,s),t.removeGeometry(n),1===i&&this.m_bOGCOutput)return this.planarSimplifyNoCrackingAndCluster(e,t,s,r)}else if(t.getGeometryType(s)===S.G.enumPolyline){let e=sf();e.ogcRule=this.m_bOGCOutput,e.allCrossRoadsImpassable=!0,e.unsplitBehavior=r;let i=this.topoOperationPolylineSimplify_(t.getFirstGeometry(),e);t.swapGeometry(i,s),t.removeGeometry(i)}else if(t.getGeometryType(s)===S.G.enumMultiPoint){let e=this.topoOperationMultiPoint_();t.swapGeometry(e,s),t.removeGeometry(e)}else(0,S.c)("");return!0}unsplitPolylineExact(e){return(0,S.g)(0),new C.P}planarSimplifyPolylines(e,t,s,r,i){var n,a;for(let t=e.getFirstGeometry();t!==C.n;t=e.getNextGeometry(t)){let s=e.getGeometryType(t);(0,S.g)(s===S.G.enumPolyline)}let o=0,h=0,l=null;if(e.hasCurves()&&!e.hasSegmentParentage()){l=new so;let s=e.getEnvelope2D(this.m_progressTracker);h=sn(t.total());let r=si(t.total(),s);o=sa(r,h),n=t.total(),ss(e,r,n,l,null,this.m_progressTracker)}{let s=(a=t.add(o),(0,I.d)(a));e.filterClosePoints(s,!1,!1,!1,C.n)}if(this.m_topoGraph=new eg,4!==i&&5!==i)if(null===l&&s){let r=new eH(this.m_progressTracker,!1);r.sweepVertical(e,t.total()),r.hadComplications()?(sl(e,t,this.m_progressTracker,!0,!1),s=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(t.total())}else sl(e,t.add(o),this.m_progressTracker,!0,!1),s=!1;else s=!1;e.removeSelection(),e.collapseAllGeometriesToFirst();let m=e.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,m,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return(0,S.g)(s&&null===l),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolylines(e,t,!1,r,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);let g=this.m_topoGraph.getGeometryID(m);(0,S.g)(g>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=g+1,this.m_maskLookup[g]=!0;let u=this.topoOperationPolylineSimplify_(e.getFirstGeometry(),r);null!==l&&l.stitchCurves(e,u,h,!0);let _=e.getGeometry(u);return s||_.getImpl().setIsSimple(4,t.total()),_}planarSimplifyMultiPoints(e,t,s,r){for(let t=e.getFirstGeometry();t!==C.n;t=e.getNextGeometry(t)){let s=e.getGeometryType(t);(0,S.g)(s===S.G.enumMultiPoint)}this.m_topoGraph=new eg,4!==r&&5!==r&&sl(e,t,this.m_progressTracker,!0,!1),s=!1,e.removeSelection(),e.collapseAllGeometriesToFirst();let i=e.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,i,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return(0,S.g)(s),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyMultiPoints(e,t,!1,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);let n=this.m_topoGraph.getGeometryID(i);(0,S.g)(n>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=n+1,this.m_maskLookup[n]=!0;let a=this.topoOperationMultiPoint(),o=e.getGeometry(a);return s||o.getImpl().setIsSimple(4,t.total()),o}planarSimplifyPolygons(e,t,s,r,i,n){for(let t=e.getFirstGeometry();t!==C.n;t=e.getNextGeometry(t)){let r=e.getGeometryType(t);(0,S.g)(r===S.G.enumPolygon||r===S.G.enumPolyline&&s)}let a=0,o=0,h=null;if(e.hasCurves()&&!e.hasSegmentParentage()){var l;h=new so;let s=e.getEnvelope2D(this.m_progressTracker);o=sn(t.total());let r=si(t.total(),s);a=sa(r,o),l=t.total(),ss(e,r,l,h,null,this.m_progressTracker)}if(n){sl(e,t.add(a),this.m_progressTracker,!0,!1);for(let t=e.getFirstGeometry();t!==C.n;t=e.getNextGeometry(t))e.getGeometryType(t)===S.G.enumPolygon&&eW(e,t,-1,!1,C.n,this.m_progressTracker)}if(this.m_topoGraph=new eg,n||4===i||5===i)r=!1;else if(null===h&&r){let s=new eH(this.m_progressTracker,!1);s.sweepVertical(e,t.total()),s.hadComplications()?(sl(e,t,this.m_progressTracker,!0,!1),r=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(t.total())}else sl(e,t.add(a),this.m_progressTracker,!0,!1),r=!1;e.removeSelection(),e.collapseAllGeometriesToFirst();let m=e.getFirstGeometry();if(s?this.m_topoGraph.setAndSimplifyEditShapeWinding(e,m,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,m,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return(0,S.g)(r&&null===h),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolygons(e,t,s,!1,-1,!1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);let g=this.m_topoGraph.getGeometryID(m);(0,S.g)(g>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=g+1,this.m_maskLookup[g]=!0,e.setFillRule(m,0);let u=this.m_bOGCOutput&&s,_=this.topoOperationPolygonPolygon_(m,C.n,C.n,u);u&&(this.m_topoGraph.removeShape(),this.m_topoGraph=null,e.removeGeometry(m),this.m_topoGraph=new eg,this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,_,this.m_progressTracker),_=this.topoOperationPolygonPolygon_(_,C.n,C.n,!1)),null!==h&&h.stitchCurves(e,_,o,!0);let d=e.getGeometry(_);return d.setFillRule(0),r?d.getImpl().setIsSimple(3,0):(d.getImpl().setIsSimple(4,t.total()),d.getImpl().updateOGCFlagsProtected()),d}planarSimplify3DImpl_(e,t,s,r,i){return(0,S.g)(0),{}}planarSimplifyImpl_(e,t,s,r,i,n,a,o){if(e.isEmpty())return e.clone();let h=e.getGeometryType(),l=new C.E,m=l.addGeometry(e);if((0,I.M)(i)&&h===S.G.enumPolygon&&(s=!1,l.setFillRule(m,0)),o&&(e.hasAttribute(1)&&l.replaceNaNs(1,0),l.removeNaNVertices()),h===S.G.enumPolygon||h===S.G.enumPolyline&&s)return this.planarSimplifyPolygons(l,t,s,r,i,!1);if(h===C.P.type){let e=sf();return e.allCrossRoadsImpassable=!0,e.ogcRule=this.m_bOGCOutput,e.unsplitBehavior=a,this.planarSimplifyPolylines(l,t,r,e,i)}if(h===S.G.enumMultiPoint)return this.planarSimplifyMultiPoints(l,t,r,i);(0,S.c)("what else?")}}function sI(e,t,s,r){if(e.isEmpty())return e.createInstance();if(t.isEmpty())return r?e.createInstance():new I.P({copy:e});let i=[new b.P],n=[0],a=2===t.getDimension();1!==t.getDimension()&&2!==t.getDimension()&&(0,S.c)(""),i[0]=e.getXY(),a?t4(t,i,1,s.total(),n):t3(t,i,1,s.total(),n);let o=0===n[0];return r||(o=!o),o?e.createInstance():e}function sb(e,t,s,r){let i=e.createInstance(),n=(0,b.m)(b.P,100),a=Array(100),o=e.getPointCount(),h=!0,l=2===t.getDimension();1!==t.getDimension()&&2!==t.getDimension()&&(0,S.c)("");for(let r=0;r<o;){let o=e.queryCoordinates(n,n.length,r,-1)-r;l?t4(t,n,o,s.total(),a):t3(t,n,o,s.total(),a);let m=0;for(let t=0;t<o;t++)0===a[t]&&(h&&(h=!1,i.addPoints(e,0,r)),m!==t&&i.addPoints(e,r+m,r+t),m=t+1);h||m===o||i.addPoints(e,r+m,r+o),r+=o}return h?e:i}function sv(e,t,s,r){let i=e.getGeometryType();if(i===S.G.enumEnvelope){let t=new C.a({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(i===S.G.enumPoint&&("|"===r||"^"===r)){let t=new C.M({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(i===S.G.enumLine){let t=new C.P({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}if(i===S.G.enumMultiPoint&&"-"===r&&t.getGeometryType()===S.G.enumPoint||i===S.G.enumMultiPoint&&"&"===r&&t.getGeometryType()===S.G.enumPoint){let t=new I.P({vd:e.getDescription()});return e.isEmpty()||e.getPointByVal(0,t),t}return e}function sG(e){let t=e.getGeometryType();if(t===S.G.enumEnvelope){let t=new C.a({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(t===S.G.enumPoint){let t=new C.M({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(sd(t)){let t=new C.P({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}return t!==S.G.enumMultiPoint&&t!==S.G.enumPolyline&&t!==S.G.enumPolygon&&(0,S.t)("Unexpected geometry type"),e}function sw(e,t,s,r){let i=s===C.n?e.getClusterHalfEdge(t):s,n=i;(0,S.g)(e.getHalfEdgeOrigin(i)===t);do r(n),n=e.getHalfEdgeNext(e.getHalfEdgeTwin(n));while(n!==i)}class sT{constructor(e,t,s,r,i,n){this.m_rParent=e,this.m_rTopoGraph=e.m_topoGraph,this.m_rShape=this.m_rTopoGraph.getShape(),this.m_IDCuttee=this.m_rTopoGraph.getGeometryID(r),this.m_IDCutter=this.m_rTopoGraph.getGeometryID(i),this.m_IDBoth=this.m_IDCuttee|this.m_IDCutter,this.m_bConsiderTouch=t,this.m_sideIndex=s,this.m_cuttee=r,this.m_cutter=i,this.m_rCutHandles=n,this.m_cutteeBreadcrumbsIndex=this.m_rShape.createUserIndexUninitialized(),this.m_clusterParentageIndex=this.m_rShape.createUserIndexUninitialized();for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==C.n;e=this.m_rShape.getNextPath(e)){let t=0,s=this.m_rShape.getPathSize(e);for(let r=this.m_rShape.getFirstVertex(e);t<s;t++,r=this.m_rShape.getNextVertex(r))this.m_rShape.setUserIndex(r,this.m_clusterParentageIndex,this.m_rTopoGraph.getClusterParentage(this.m_rTopoGraph.getClusterFromVertex(r)))}}Do(){this.cutPolylinePolyline_(),this.m_rShape.removeUserIndex(this.m_cutteeBreadcrumbsIndex),this.m_rShape.removeUserIndex(this.m_clusterParentageIndex)}setTbd(e){return 8|e}classifyStandardCut(e,t,s,r){let i=this.m_rShape.getPrevVertex(e),n=this.m_rShape.getNextVertex(e),a=i===C.n?C.n:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(i)),o=n===C.n?C.n:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(n)),h=this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(s)),l=this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(r)),m=1,g=32,u=32;if(sw(this.m_rTopoGraph,t,l,e=>{e===h&&(m=2),e===a&&(g=m),e===o&&(u=m)}),this.m_bConsiderTouch)32!==g&&this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|g),32!==u&&this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|u);else{if(32===g||32===u||g===u&&a!==h&&a!==l&&o!==h&&o!==l)return 1;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|g),this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|u)}return 0}classifyTouchCut(e,t,s,r){let i=this.m_rShape.getPrevVertex(e),n=this.m_rShape.getNextVertex(e),a=i===C.n?C.n:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(i)),o=n===C.n?C.n:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(n)),h=s===C.n?C.n:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(s)),l=r===C.n?C.n:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(r));if(!this.m_bConsiderTouch){let t;return(t=h===a||l===a)?this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))):(t=h===o||l===o)&&this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),+!t}if(a===C.n)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(o===C.n)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;if(a===o)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(l!==C.n){if(a===l)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(o===l)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;let s=1;sw(this.m_rTopoGraph,t,l,t=>{if(t===a){let e=this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,e),s=2}else if(t===o){let t=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,t),s=2}})}else{if(a===h)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(o===h)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;let s=2;sw(this.m_rTopoGraph,t,h,t=>{if(t===a){let e=this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,e),s=1}else if(t===o){let t=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,t),s=1}})}return 0}classifyCutVertex(e,t){let s=0,r=0;for(let i=this.m_rTopoGraph.getClusterVertexIterator(t);i!==C.n;i=this.m_rTopoGraph.incrementVertexIterator(i)){let n=this.m_rTopoGraph.getVertexFromVertexIterator(i);if(this.m_rShape.getGeometryFromVertex(n)===this.m_cutter){r++;let i=this.m_rShape.getPrevVertex(n),a=this.m_rShape.getNextVertex(n);s+=i===C.n||a===C.n?this.classifyTouchCut(e,t,i,a):this.classifyStandardCut(e,t,i,a)}}r&&s===r&&!this.m_bConsiderTouch&&this.m_rShape.setUserIndex(e,this.m_clusterParentageIndex,this.m_IDCuttee)}cutPolylinePolyline_(){this.m_rShape.getGeometryType(this.m_cuttee),this.m_rShape.getGeometryType(this.m_cutter),this.m_rParent.m_maskLookup.length=0,this.m_rParent.m_maskLookup.length=this.m_IDBoth+1,this.m_rParent.m_maskLookup[this.m_IDBoth]=!0;for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==C.n;e=this.m_rShape.getNextPath(e)){let t=this.m_rShape.getPathSize(e),s=this.m_rShape.getFirstVertex(e);for(let e=0;e<t;++e,s=this.m_rShape.getNextVertex(s))this.m_rShape.setUserIndex(s,this.m_cutteeBreadcrumbsIndex,0);s=this.m_rShape.getFirstVertex(e);for(let e=0;e<t;++e,s=this.m_rShape.getNextVertex(s)){let e=this.m_rTopoGraph.getClusterFromVertex(s);this.m_rTopoGraph.getClusterParentage(e)===this.m_IDBoth&&this.classifyCutVertex(s,e)}}let e=(e,t)=>{let s=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex),r=this.m_rTopoGraph.getHalfEdgeConnector(this.m_rTopoGraph.getClusterFromVertex(e),this.m_rTopoGraph.getClusterFromVertex(t));return(this.m_rTopoGraph.getHalfEdgeParentage(r)&this.m_IDBoth)===this.m_IDBoth&&(s|=4),s};for(let t=this.m_rShape.getFirstPath(this.m_cuttee);t!==C.n;t=this.m_rShape.getNextPath(t)){let s=this.m_rShape.getFirstVertex(t),r=this.m_rShape.isClosedPath(t),i=this.m_rShape.getPathSize(t)+ +!!r,n=1,a=32;for(let t=this.m_rShape.getNextVertex(s);n<i;++n,s=t,t=this.m_rShape.getNextVertex(t)){let r=e(s,t);this.m_rShape.getUserIndex(s,this.m_clusterParentageIndex)===this.m_IDBoth&&(a=r),32!==a&&this.m_rShape.setUserIndex(s,this.m_cutteeBreadcrumbsIndex,a|r)}s=this.m_rShape.getLastVertex(t);let o=32;n=1;for(let t=this.m_rShape.getPrevVertex(s);n<i;++n,s=t,t=this.m_rShape.getPrevVertex(t)){let r=e(t,s);this.m_rShape.getUserIndex(s,this.m_clusterParentageIndex)===this.m_IDBoth&&(o=r),32!==o&&this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,o|r)}}let t=C.n,s=C.n,r=32,i=this.m_rShape.hasSegmentParentage(),n=new C.S;for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==C.n;e=this.m_rShape.getNextPath(e)){let a=this.m_rShape.isClosedPath(e),o=this.m_rShape.getPathSize(e)+ +!!a,h=1,l=this.m_rShape.getFirstVertex(e),m=C.n,g=!0;for(let e=this.m_rShape.getNextVertex(l);h<o;++h,e=this.m_rShape.getNextVertex(e)){let a=this.m_rShape.getUserIndex(l,this.m_cutteeBreadcrumbsIndex);8===a?a=3:4&(a&=-9)?a=4:3&~a||(a=3),a!==r?(t!==C.n&&(m=this.m_rShape.addVertex(s,l),i&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(l))&&this.m_rShape.setSegmentParentageBreakVertex(m,!0),this.m_rCutHandles.push(t),this.m_rShape.setGeometryUserIndex(t,this.m_sideIndex,r)),t=this.m_rShape.createGeometry(S.G.enumPolyline),s=this.m_rShape.insertPath(t,C.n),r=a,g=!0):this.m_rShape.getUserIndex(l,this.m_clusterParentageIndex)===this.m_IDBoth&&4!==a&&(m=this.m_rShape.addVertex(s,l),i&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(l))&&this.m_rShape.setSegmentParentageBreakVertex(m,!0),s=this.m_rShape.insertPath(t,C.n),g=!0),m=this.m_rShape.addVertex(s,l);let o=this.m_rTopoGraph.getClusterFromVertex(l);!g&&i&&this.m_rTopoGraph.isBreakNode(o)&&this.m_rShape.setSegmentParentageBreakVertex(m,!0);let h=this.m_rTopoGraph.getHalfEdgeFromVertex(l);if(i){let e=this.m_rTopoGraph.getSegmentParentage(h);this.m_rShape.setSegmentParentageAndBreak(m,e,g||this.m_rTopoGraph.isBreakNode(o))}this.m_rTopoGraph.isHalfEdgeCurve(h)&&(this.m_rTopoGraph.querySegmentXY(h,n),this.m_rShape.setSegmentToIndex(this.m_rShape.getVertexIndex(m),n.get().clone())),l=e,g=!1}m=this.m_rShape.addVertex(s,l),i&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(l))&&this.m_rShape.setSegmentParentageBreakVertex(m,!0),this.m_rCutHandles.push(t),this.m_rShape.setGeometryUserIndex(t,this.m_sideIndex,r),t=C.n,s=C.n,r=32}}}function sN(e,t,s){return new sC(s).linesToPolygonsImpl(e,t)}function sD(e,t,s,r,i){if(r&&(r.m_reason=0,r.m_vertexIndex1=-1,r.m_vertexIndex2=-1),e.isEmpty())return 5;let n=e.getGeometryType();if(n===S.G.enumPoint)return sV(e,r);let a=(0,I.b)(t,e,!1).total();if(n===S.G.enumEnvelope){let t=E.J.constructEmpty();return e.queryEnvelope(t),t.isDegenerate(a)?(r&&(r.m_reason=4,r.m_vertexIndex1=-1,r.m_vertexIndex2=-1),0):5}if((0,S.f)(n)){let n=new C.P({vd:e.getDescription()});return n.addSegment(e,!0),sD(n,t,s,r,i)}let o=e.getImpl().getIsSimple(a,[0]),h=s?-1:o;if(-1!==h)return h;let l=new sA(e,t,h,i,!1);return n===S.G.enumMultiPoint?h=l.multipointIsSimpleAsFeature():n===S.G.enumPolyline?h=l.polylineIsSimpleAsFeature():n===S.G.enumPolygon?h=l.polygonIsSimpleAsFeature():(0,S.c)(""),e.getImpl().setIsSimple(h,a),r&&r.assign(l.m_nonSimpleResult),h}function sV(e,t){let s=e.getX(),r=e.getY();if(!Number.isFinite(s)||!Number.isFinite(r))return t&&(t.m_reason=2,t.m_vertexIndex1=-1,t.m_vertexIndex2=-1),0;if(e.hasAttribute(1)){let s=e.getZ();if(!Number.isFinite(s))return t&&(t.m_reason=Number.isNaN(s)?3:2,t.m_vertexIndex1=-1,t.m_vertexIndex2=-1),0}return 5}class sF{constructor(){this.m_segment=null,this.m_vertexIndex=-1,this.m_pathIndex=-1,this.m_flags=0}setReversed(e){this.m_flags&=-2,this.m_flags=!!e|this.m_flags}getReversed(){return!!(1&this.m_flags)}getRightSide(){return+!this.getReversed()}}class sH extends I.a6{constructor(e){super(),this.m_helper=e}compare(e,t,s){let r=e.getElement(s),i=this.m_helper.m_xy.read(2*t)-this.m_helper.m_xy.read(2*r);return i<0?-1:+(i>0)}}class sk extends I.a6{constructor(e){super(),this.m_helper=e}compare(e,t,s){let r=e.getElement(s),i=this.m_helper.m_edges[t],n=this.m_helper.m_edges[r],a=i.getReversed(),o=n.getReversed(),h=i.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0),l=n.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0);if(h===l){let e=Math.min(a?i.m_segment.getStartY():i.m_segment.getEndY(),o?n.m_segment.getStartY():n.m_segment.getEndY()),t=.5*(e-this.m_helper.m_yScanline)+this.m_helper.m_yScanline;t===this.m_helper.m_yScanline&&(t=e),h=i.m_segment.intersectionOfYMonotonicWithAxisX(t,0),l=n.m_segment.intersectionOfYMonotonicWithAxisX(t,0)}return h<l?-1:+(h>l)}}class sA{constructor(e,t,s,r,i){this.m_multiVertexGeom=null,this.m_edges=[],this.m_freeEdges=[],this.m_lineEdgesRecycle=[],this.m_newEdges=[],this.m_recycledSegIter=null,this.m_crossOverHelperList=new I.a2,this.m_progressTracker=null,this.m_progressCounter=0,this.m_AET=new I.T,this.m_xyToNode1=null,this.m_xyToNode2=null,this.m_pathOrientations=null,this.m_pathParentage=null,this.m_xy=null,this.m_pairs=[],this.m_pairIndices=null,this.m_pathsForOGCTests=[],this.m_curveStitcher=null,this.m_editShape=null,this.m_multiPathStitcher=null,this.m_nonSimpleResult=new F,this.m_progressCounter=0,this.m_progressTracker=r,this.m_geometry=e,this.m_knownSimpleResult=s,this.m_sr=t;let n=(0,I.b)(t,e,!1);this.m_toleranceIsSimple=n,this.m_toleranceIsSimpleClustering=(0,I.d)(n),this.m_toleranceIsSimpleCracking=(0,I.a1)(n),this.m_toleranceSimplify=(0,I.b)(t,e,!0),this.m_description=this.m_geometry.getDescription(),this.m_attributeCount=this.m_description.getAttributeCount(),this.m_bOGCRestrictions=i,this.m_bPlanarSimplify=this.m_bOGCRestrictions,this.m_unknownOrientationPathCount=-1,this.m_yScanline=0,this.m_progressCounter=0}isSimplePlanarImpl(){if(this.m_bPlanarSimplify=!0,!this.checkStructure())return 0;let e=this.m_geometry.getGeometryType();return(0,S.h)(e)&&!this.checkDegenerateSegments(!1)?0:this._CheckClustering()?(0,S.h)(e)?this._CheckCracking()?this.m_geometry.getGeometryType()===S.G.enumPolyline?4*!!this.checkSelfIntersectionsPolylinePlanar():this._CheckSelfIntersections()?this._CheckValidRingOrientation():0:0:5:0}isSimplePlanarImpl3D(){return(0,S.g)(0),7}generateSortedPairs(e){let t=null;(0,S.h)(e.getGeometryType())&&(t=e);let s=(this.m_bPlanarSimplify||this.m_bOGCRestrictions)&&null!==t,r=e.getPointCount();this.m_xy=e.getAttributeStreamRef(0),this.m_pairs.length=0,this.m_pairIndices=new I.A(0),s&&(this.m_pathsForOGCTests.length=0);let i=0;for(let e=0;e<r;e++)if(this.m_pairs.push(2*e),this.m_pairs.push(2*e+1),this.m_pairIndices.add(2*e),this.m_pairIndices.add(2*e+1),s){for(;e>=t.getPathEnd(i);)i++;this.m_pathsForOGCTests.push(i)}let n=new I.B,a={parent:this,workPt:new b.P,userSort(e,t,r){r.sort(e,t,(e,t)=>this.parent.compareVerticesForPlanarClustering(e,t,s))},getValue(e){let t=this.parent.m_pairs[e];return this.parent.m_xy.queryPoint2D(2*(t>>1),this.workPt),this.workPt.y+(1&t?this.parent.m_toleranceIsSimpleClustering:-this.parent.m_toleranceIsSimpleClustering)}};n.sort(this.m_pairIndices,0,2*r,a)}_TestToleranceDistancePlanar(e,t){let s=this.m_xy.read(2*e),r=this.m_xy.read(2*e+1),i=this.m_xy.read(2*t),n=this.m_xy.read(2*t+1);return!ex(s,r,i,n,this.m_toleranceIsSimpleClustering*this.m_toleranceIsSimpleClustering)||0!==this.m_geometry.getDimension()&&s===i&&r===n}checkStructure(){let e=this.m_geometry.getGeometryType();if((0,S.h)(e)){let e=this.m_geometry.getImpl(),t=this.m_geometry.getGeometryType()===S.G.enumPolygon?3:2;for(let s=0,r=e.getPathCount();s<r;s++)if(e.getPathSize(s)<t){if(e.hasNonLinearSegments()&&e.hasNonLinearSegmentsPath(s)&&e.getPathSize(s)>0)continue;return this.m_nonSimpleResult=new F(1,s,0),!1}}if((0,S.i)(e)){let e=this.m_geometry.getImpl(),t=e.getAttributeStreamRef(0);for(let s=0,r=e.getPointCount();s<r;s++)if(!t.readPoint2D(2*s).isFinite())return this.m_nonSimpleResult=new F(2,s,0),!1;if(this.m_geometry.hasAttribute(1)){let t=e.getAttributeStreamRef(1);for(let s=0,r=e.getPointCount();s<r;s++){let e=t.read(s);if(!Number.isFinite(e))return Number.isNaN(e)?this.m_nonSimpleResult=new F(3,s,0):this.m_nonSimpleResult=new F(2,s,0),!1}}}return!0}checkDegenerateSegments(e){let t=this.m_geometry.getImpl(),s=t.querySegmentIterator(),r=t.hasAttribute(1),i=r?(0,I.a3)(this.m_sr,t,!1).total():0,n=t.hasNonLinearSegments(),a=this.m_toleranceIsSimple.total();for(;s.nextPath();)for(;s.hasNextSegment();){let t=s.nextSegment(),o=t.calculateLowerLength2D();if(!(o>a)&&!(n&&t.isCurve()&&(o=t.calculateLength2D())>a)){if(e&&r){let e=t.getStartAttributeAsDbl(1,0);if(Math.abs(t.getEndAttributeAsDbl(1,0)-e)>i)continue}return this.m_nonSimpleResult=new F(4,s.getStartPointIndex(),-1),!1}}return!0}checkDegenerateSegments3D(){return(0,S.g)(0),!1}_CheckClustering(){let e=this.m_geometry.getImpl();this.generateSortedPairs(e);let t=e.getPointCount();this.m_AET.clear(),this.m_AET.setComparator(new sH(this)),this.m_AET.setCapacity(t);for(let e=0,s=2*t;e<s;e++){this.progress_();let t=this.m_pairIndices.read(e),s=this.m_pairs[t],r=s>>1;if(1&s){let e=this.m_AET.search(r),t=this.m_AET.getPrev(e),s=this.m_AET.getNext(e);if(this.m_AET.deleteNode(e),t!==I.T.st_nullNode()&&s!==I.T.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(t),this.m_AET.getElement(s)))return this.m_nonSimpleResult=new F(5,this.m_AET.getElement(t),this.m_AET.getElement(s)),!1}else{let e=this.m_AET.addElement(r),t=this.m_AET.getPrev(e);if(t!==I.T.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(t),r))return this.m_nonSimpleResult=new F(5,r,this.m_AET.getElement(t)),!1;let s=this.m_AET.getNext(e);if(s!==I.T.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(s),r))return this.m_nonSimpleResult=new F(5,r,this.m_AET.getElement(s)),!1}}return!0}_CheckCracking(){let e=this.m_geometry.getImpl(),t=e.getPointCount();return!e.hasNonLinearSegments()&&t<10?this._CheckCrackingBrute():this._CheckCrackingPlanesweep()}_CheckCrackingPlanesweep(){if(this.m_editShape=new C.E,this.m_editShape.addGeometry(this.m_geometry),this.m_editShape.hasCurves()){this.m_curveStitcher=new so;let e=E.J.constructEmpty();this.m_geometry.queryEnvelope(e);let t=si(this.m_toleranceSimplify.total(),e),s=new F;if(sr(this.m_editShape,t,this.m_toleranceSimplify.total(),12e3,s,this.m_curveStitcher,null,this.m_progressTracker),0!==s.m_reason)return this.m_editShape=null,this.m_nonSimpleResult.assign(s),!1}let e=new F;return eU(!1,this.m_editShape,this.m_toleranceIsSimpleCracking,e,this.m_progressTracker)?(null!=this.m_curveStitcher?(e.m_vertexIndex1=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,e.m_vertexIndex1),e.m_vertexIndex2=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,e.m_vertexIndex2),this.m_curveStitcher=null):(e.m_vertexIndex1=this.m_editShape.getVertexIndex(e.m_vertexIndex1),e.m_vertexIndex2=this.m_editShape.getVertexIndex(e.m_vertexIndex2)),this.m_editShape=null,this.m_nonSimpleResult.assign(e),!1):(null==this.m_curveStitcher&&(this.m_editShape=null),!0)}_CheckCrackingBrute(){let e=this.m_geometry.getImpl(),t=e.querySegmentIterator(),s=e.querySegmentIterator();for(;t.nextPath();)for(;t.hasNextSegment();){let e=t.nextSegment();if(!t.isLastSegmentInPath()||!t.isLastPath()){s.resetTo(t);do for(;s.hasNextSegment();){let r=s.nextSegment(),i=(0,C._)(!0,e,r,this.m_toleranceIsSimpleCracking,!0);if(i){let e=2===i?7:6;return this.m_nonSimpleResult=new F(e,t.getStartPointIndex(),s.getStartPointIndex()),!1}}while(s.nextPath())}}return!0}_CheckSelfIntersections(){let e=this.m_geometry.getImpl();null!==this.m_curveStitcher&&(this.m_multiPathStitcher=this.m_editShape.getGeometry(this.m_editShape.getFirstGeometry()),e=this.m_multiPathStitcher.getImpl(),this.generateSortedPairs(e)),this.m_edges.length=0,this.m_lineEdgesRecycle.length=0,this.m_recycledSegIter=e.querySegmentIterator(),this.m_recycledSegIter.setCirculator(!0);let t=[],s=e.getPointCount(),r=Number.NaN,i=0;for(let e=0,n=2*s;e<n;e++){this.progress_();let s=this.m_pairIndices.read(e),n=this.m_pairs[s];if(1&n)continue;let a=n>>1,o=this.m_xy.read(2*a),h=this.m_xy.read(2*a+1);if(t.length&&(o!==r||h!==i)){if(!this.processBunchForSelfIntersectionTest(t))return!1;t.length=0}t.push(a),r=o,i=h}return!!this.processBunchForSelfIntersectionTest(t)}checkSelfIntersectionsPolylinePlanar(){let e,t,s,r=this.m_geometry.getImpl(),i=[];for(let e=0,t=r.getPathCount();e<t;e++)i.push(r.isClosedPathInXYPlane(e));let n={x:-1,y:-1,ipath:-1,ivertex:-1,bBoundary:!1,bEndPoint:!1};{let a=this.m_pairIndices.read(0),o=this.m_pairs[a]>>1,h=this.m_xy.readPoint2D(2*o),l=this.m_pathsForOGCTests[o];e=i[l],t=r.getPathStart(l),s=r.getPathEnd(l)-1,n.bEndPoint=o===t||o===s,this.m_bOGCRestrictions?n.bBoundary=!e&&n.bEndPoint:n.bBoundary=n.bEndPoint,n.ipath=l,n.x=h.x,n.y=h.y,n.ivertex=o}for(let o=1,h=this.m_pairIndices.size();o<h;o++){var a;let h,l=this.m_pairIndices.read(o),m=this.m_pairs[l];if(1&m)continue;let g=m>>1,u=this.m_xy.readPoint2D(2*g),_=this.m_pathsForOGCTests[g];_!==n.ipath&&(e=i[_],t=r.getPathStart(_),s=r.getPathEnd(_)-1);let d=g===t||g===s;h=this.m_bOGCRestrictions?!e&&d:d;let p=(a=u.x,{x:a,y:u.y,ipath:_,ivertex:g,bBoundary:h,bEndPoint:d});if(p.x===n.x&&p.y===n.y){if(this.m_bOGCRestrictions){if(!(p.bBoundary&&n.bBoundary||p.ipath===n.ipath&&p.bEndPoint&&n.bEndPoint))return this.m_nonSimpleResult=new F(10,p.ivertex,n.ivertex),!1}else if(!p.bEndPoint||!n.bEndPoint)return this.m_nonSimpleResult=new F(7,p.ivertex,n.ivertex),!1}n.x=p.x,n.y=p.y,n.ipath=p.ipath,n.ivertex=p.ivertex,n.bBoundary=p.bBoundary,n.bEndPoint=p.bEndPoint}return!0}checkSelfIntersectionsPolylinePlanar3D(e){return(0,S.g)(0),!1}checkSelfIntersectionsPolygonsOGC(){let e=this.m_geometry.getImpl(),t=[],s=-1,r=!1;for(let i=0,n=e.getPathCount();i<n;i++)e.isExteriorRingOGC(i)&&(r=!1,s++,i<n-1&&(e.isExteriorRingOGC(i+1)||(r=!0))),t.push(r?s:-1);let i={x:-1,y:-1,ipath:-1,ivertex:-1,ipolygon:-1};{let e=this.m_pairIndices.read(0),s=this.m_pairs[e]>>1,r=this.m_xy.readPoint2D(2*s),n=this.m_pathsForOGCTests[s];i.ipath=n,i.x=r.x,i.y=r.y,i.ivertex=s,i.ipolygon=t[n]}let n=[];for(let e=1,s=this.m_pairIndices.size();e<s;e++){var a,o;let s=this.m_pairIndices.read(e),r=this.m_pairs[s];if(1&r)continue;let h=r>>1,l=this.m_xy.readPoint2D(2*h),m=this.m_pathsForOGCTests[h],g=(a=l.x,{x:a,y:l.y,ipath:m,ivertex:h,ipolygon:t[m]});if(g.x===i.x&&g.y===i.y){if(g.ipath===i.ipath)return this.m_nonSimpleResult=new F(11,g.ivertex,i.ivertex),!1;t[g.ipath]>=0&&t[g.ipath]===t[i.ipath]&&(0!==n.length&&(o=n.at(-1),o.x===i.x&&o.y===i.y&&o.ipath===i.ipath&&o.ivertex===i.ivertex&&o.ipolygon===i.ipolygon)||n.push({...i}),n.push(g))}i.x=g.x,i.y=g.y,i.ipath=g.ipath,i.ivertex=g.ivertex,i.ipolygon=g.ipolygon}if(0===n.length)return!0;let h=new I.a2(!0);t.fill(-1);let l=-1,m=new b.P;for(let e=0,s=n.length;e<s;e++){let s=n[e];s.x===m.x&&s.y===m.y||(l=h.createList(0),m.x=s.x,m.y=s.y);let r=t[s.ipath];-1===r&&(r=h.createList(2),t[s.ipath]=r),h.addElement(r,l),h.addElement(l,r)}let g=[];for(let e=h.getFirstList();-1!==e;e=h.getNextList(e)){let s=h.getListData(e);if(1&s||!(2&s))continue;let r=-1;for(g.push(e),g.push(-1);g.length;){let e=g.at(-1);g.pop();let t=g.at(-1);g.pop();let s=h.getListData(t);if(1&s){r=2&s?t:e;break}h.setListData(t,1|s);for(let s=h.getFirst(t);-1!==s;s=h.getNext(s)){let r=h.getData(s);r!==e&&(g.push(r),g.push(t))}}if(-1!==r){let e=t.indexOf(r);return this.m_nonSimpleResult=new F(12,e,-1),!1}}return!0}_CheckValidRingOrientation(){let e=null!==this.m_multiPathStitcher?this.m_multiPathStitcher.getImpl():this.m_geometry.getImpl();if(0>=e.calculateArea2D())return this.m_nonSimpleResult=new F(8,1===e.getPathCount()?1:-1,-1),0;if(1===e.getPathCount())return this.m_bOGCRestrictions&&!this.checkSelfIntersectionsPolygonsOGC()?0:4;this.m_pathOrientations=new I.a4(e.getPathCount(),0),this.m_pathParentage=new I.A(e.getPathCount(),-1);let t=-1,s=0;for(let r=0,i=e.getPathCount();r<i;r++){let i=e.calculateRingArea2D(r);if(this.m_pathOrientations.write(r,i<0?0:8),i>0)t=r,s=i;else{if(0===i)return this.m_nonSimpleResult=new F(8,r,-1),0;if((t<0||s<Math.abs(i))&&(this.m_nonSimpleResult=new F(9,r,-1),this.m_bOGCRestrictions))return 0;this.m_pathParentage.write(r,t)}}this.m_unknownOrientationPathCount=e.getPathCount(),this.m_newEdges.length=0;let r=e.getPointCount();this.m_yScanline=Number.NaN;let i=[];this.m_xyToNode1=new I.A(r,I.T.st_nullNode()),this.m_xyToNode2=new I.A(r,I.T.st_nullNode()),this.m_freeEdges.length=0,this.m_AET.clear(),this.m_AET.setComparator(new sk(this));for(let e=0,t=2*r;this.m_unknownOrientationPathCount>0&&e<t;e++){let t=this.m_pairIndices.read(e),s=this.m_pairs[t];if(1&s)continue;let r=s>>1,n=this.m_xy.read(2*r+1);if(n!==this.m_yScanline&&i.length){if(!this.processBunchForRingOrientationTest(i))return 0;i.length=0}i.push(r),this.m_yScanline=n}return this.m_unknownOrientationPathCount>0&&!this.processBunchForRingOrientationTest(i)?0:this.m_bOGCRestrictions?0!==this.m_nonSimpleResult.m_reason?0:5*!!this.checkSelfIntersectionsPolygonsOGC():0===this.m_nonSimpleResult.m_reason?4:3}processBunchForSelfIntersectionTest(e){if(1===e.length)return!0;for(let t=0,s=e.length;t<s;t++){let s=e[t];this.m_recycledSegIter.resetToVertex(s,-1);let r=this.m_recycledSegIter.previousSegment();this.m_edges.push(this.createEdge(r,s,this.m_recycledSegIter.getPathIndex(),!0)),this.m_recycledSegIter.nextSegment();let i=this.m_recycledSegIter.nextSegment();this.m_edges.push(this.createEdge(i,s,this.m_recycledSegIter.getPathIndex(),!1))}this.m_edges.sort((e,t)=>this.edgeAngleCompare(e,t));let t=this.m_crossOverHelperList.getFirstList();-1===t&&(t=this.m_crossOverHelperList.createList(0)),this.m_crossOverHelperList.reserveNodes(this.m_edges.length);for(let e=0,s=this.m_edges.length;e<s;e++)this.m_crossOverHelperList.addElement(t,e);let s=!0,r=-1,i=-1;for(;s;){s=!1;let e=this.m_crossOverHelperList.getFirst(t);if(-1===e)break;let n=this.m_crossOverHelperList.getNext(e);for(;-1!==n;){let a=this.m_crossOverHelperList.getData(e),o=this.m_crossOverHelperList.getData(n);if((r=this.m_edges[a].m_vertexIndex)!==(i=this.m_edges[o].m_vertexIndex))e=n,n=this.m_crossOverHelperList.getNext(e);else if(s=!0,this.m_crossOverHelperList.deleteElement(t,e),e=this.m_crossOverHelperList.getPrev(n),-1===(n=this.m_crossOverHelperList.deleteElement(t,n))||-1===e)break}}let n=this.m_crossOverHelperList.getListSize(t);if(this.m_crossOverHelperList.clear(t),n>0)return this.m_nonSimpleResult=new F(7,r,i),!1;for(let t=0,s=e.length;t<s;t++)this.recycleEdge(this.m_edges[t]);return this.m_edges.length=0,!0}processBunchForRingOrientationTest(e){for(let t=0,s=e.length;t<s;t++){let s=e[t],r=this.m_xyToNode1.read(s);if(r!==I.T.st_nullNode()){let e=this.m_AET.getElement(r);this.m_freeEdges.push(e),this.m_AET.deleteNode(r),this.recycleEdge(this.m_edges[e]),this.m_edges[e]=null,this.m_xyToNode1.write(s,I.T.st_nullNode())}if((r=this.m_xyToNode2.read(s))!==I.T.st_nullNode()){let e=this.m_AET.getElement(r);this.m_freeEdges.push(e),this.m_AET.deleteNode(r),this.recycleEdge(this.m_edges[e]),this.m_edges[e]=null,this.m_xyToNode2.write(s,I.T.st_nullNode())}}for(let t=0,s=e.length;t<s;t++){let s=e[t];this.m_recycledSegIter.resetToVertex(s,-1);let r=this.m_recycledSegIter.previousSegment();if(r.getStartY()>r.getEndY()){let e,t=this.m_recycledSegIter.getStartPointIndex(),i=this.createEdge(r,s,this.m_recycledSegIter.getPathIndex(),!0);this.m_freeEdges.length>0?(e=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[e]=i):(e=this.m_edges.length,this.m_edges.push(i));let n=this.m_AET.addElement(e);this.m_xyToNode1.read(t)===I.T.st_nullNode()?this.m_xyToNode1.write(t,n):this.m_xyToNode2.write(t,n),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(n)}this.m_recycledSegIter.nextSegment();let i=this.m_recycledSegIter.nextSegment();if(i.getStartY()<i.getEndY()){let e,t=this.m_recycledSegIter.getEndPointIndex(),r=this.createEdge(i,s,this.m_recycledSegIter.getPathIndex(),!1);this.m_freeEdges.length>0?(e=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[e]=r):(e=this.m_edges.length,this.m_edges.push(r));let n=this.m_AET.addElement(e);this.m_xyToNode1.read(t)===I.T.st_nullNode()?this.m_xyToNode1.write(t,n):this.m_xyToNode2.write(t,n),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(n)}}for(let e=0,t=this.m_newEdges.length;e<t&&this.m_unknownOrientationPathCount>0;e++){let t=this.m_newEdges[e],s=this.m_AET.getElement(t),r=this.m_edges[s].m_pathIndex;if(!(3&this.m_pathOrientations.read(r))){let e=-1,s=this.m_AET.getPrev(t),r=t,i=0;{let t=-1,n=null,a=-1,o=0;for(;s!==I.T.st_nullNode()&&(t=this.m_AET.getElement(s),a=(n=this.m_edges[t]).m_pathIndex,!(3&(o=this.m_pathOrientations.read(a))));)r=s,s=this.m_AET.getPrev(s);s===I.T.st_nullNode()?(i=1,s=r):(e=1==(3&o)?a:this.m_pathParentage.read(a),i=+!n.getRightSide(),s=this.m_AET.getNext(s))}do{let t=this.m_AET.getElement(s),n=this.m_edges[t],a=n.m_pathIndex,o=this.m_pathOrientations.read(a);if(!(3&o)){if(i!==n.getRightSide())return this.m_nonSimpleResult=new F(8,a,-1),!1;let t=i&&!n.getReversed()?1:2;if(o=-4&o|t,this.m_pathOrientations.write(a,o),2===t&&0===this.m_nonSimpleResult.m_reason){let t=this.m_pathParentage.read(a);if(t!==e&&(this.m_nonSimpleResult=new F(9,a,t),this.m_bOGCRestrictions))return!1}if(this.m_unknownOrientationPathCount--,!this.m_unknownOrientationPathCount)return!0}e=1==(3&o)?a:this.m_pathParentage.read(a),r=s,s=this.m_AET.getNext(s),i=+!i}while(r!==t)}}return this.m_newEdges.length=0,!0}createEdge(e,t,s,r){let i;return e.getGeometryType()===S.G.enumLine?i=this.createEdgeLine(e):(i=new sF).m_segment=e.clone(),i.m_vertexIndex=t,i.m_pathIndex=s,i.m_flags=0,i.setReversed(r),i}createEdgeLine(e){let t;return this.m_lineEdgesRecycle.length>0?(t=this.m_lineEdgesRecycle.at(-1),this.m_lineEdgesRecycle.pop(),e.copyTo(t.m_segment)):(t=new sF).m_segment=e.clone(),t}recycleEdge(e){e.m_segment.getGeometryType()===S.G.enumLine&&this.m_lineEdgesRecycle.push(e)}static isShortSegment(e,t,s,r){let i=e.calculateLowerLength2D();if(i<=s){let n=!0;if(e.isCurve()&&(n=(i=e.calculateLength2D())<=s),n){if(t){let t=e.getEndAttributeAsDbl(1,0);Number.isNaN(t)&&(t=0);let s=e.getStartAttributeAsDbl(1,0);return Number.isNaN(s)&&(s=0),Math.abs(s-t)<=r}return!0}}return!1}static isShortSegmentPoints(e,t,s,r,i){if(s){let s=e.getXYZ(),n=t.getXYZ();return(0,I.a5)(s,n,r,i)}{let s=e.getXY(),i=t.getXY();return b.P.sqrDistance(s,i)<=r*r}}removeDegenerateSegmentsFromCurvedPath(e,t,s,r){let i=e.hasAttribute(1),n=e.querySegmentIterator();n.resetToPath(t),(0,S.g)(n.nextPath());let a=this.m_toleranceSimplify.total(),o=!1,h=!0,l=new I.P,m=new I.P,g=new b.P;for(;n.hasNextSegment();){this.progress_();let e=n.nextSegment();if(sA.isShortSegment(e,i,a,s))if(o){if(e.queryEnd(m),sA.isShortSegmentPoints(l,m,i,a,s))continue;h&&(r.startPathPoint(l),h=!1),e.queryEnd(l),r.lineToPoint(l),o=!1}else g.assign(e.getStartXY()),e.queryStart(l),o=!0;else if(o)if(e.isCurve()){let t=e.clone();if(t.setCoordsForIntersector(g,e.getEndXY(),!1),t.setStart(l),sA.isShortSegment(t,i,a,s))continue;r.addSegment(t,h),h=!1,o=!1}else{if(e.queryEnd(m),sA.isShortSegmentPoints(l,m,i,a,s))continue;h&&(r.startPathPoint(l),h=!1),r.lineToPoint(m),o=!1}else r.addSegment(e,h),h=!1}if(h||!o)return;e.isClosedPath(t)?e.getPointByVal(e.getPathStart(t),l):e.getPointByVal(e.getPathEnd(t)-1,l);let u=r.querySegmentIterator();u.resetToLastPath(),u.resetToLastSegment();let _=r.getDescription().getAttributeCount()>1;for((0,S.g)(u.previousPath());u.hasPreviousSegment();){let e=u.previousSegment();if(e.isCurve()){let t=e.clone();if(t.setCoordsForIntersector(e.getStartXY(),l.getXY(),!1),!sA.isShortSegment(t,i,a,s)){_&&t.setEnd(l);let e=u.getEndPointIndex();for(let t=r.getPointCount()-1;t>=e;t--)r.removePoint(t);return void r.addSegment(t,!1)}}else if(e.queryStart(m),!sA.isShortSegmentPoints(m,l,i,a,s)){let e=u.getEndPointIndex();for(let t=r.getPointCount()-1;t>=e;t--)r.removePoint(t);return void r.lineToPoint(l)}}r.removePath(r.getPathCount()-1)}multipointIsSimpleAsFeature(){if(!this.checkStructure())return 0;let e=this.m_geometry.getImpl();this.m_multiVertexGeom=e;let t=e.getPointCount(),s=(0,b.d)(t,0);for(let e=0;e<t;e++)s[e]=e;s.sort((e,t)=>this.compareVerticesMultiPoint(e,t));for(let e=1;e<t;e++)if(0===this.compareVerticesMultiPoint(s[e-1],s[e]))return this.m_nonSimpleResult=new F(5,s[e-1],s[e]),0;return 1}polylineIsSimpleAsFeature(){return this.checkStructure()&&this.checkDegenerateSegments(!0)?1:0}polygonIsSimpleAsFeature(){return this.isSimplePlanarImpl()}multipointSimplifyAsFeature(){let e=this.m_geometry.getImpl(),t=sA.hasNanZs(e),s,r=this.m_geometry;t&&(e=(s=this.m_geometry.clone()).getImpl(),s.replaceNaNs(1,I.V.getDefaultValue(1)),r=s),this.m_multiVertexGeom=e;let i=e.getPointCount(),n=(0,b.d)(i,0);for(let e=0;e<i;e++)n[e]=e;n.sort((e,t)=>this.compareVerticesMultiPoint(e,t));let a=Array(i);a.fill(!1);let o=-1;for(let t=0;t<i;t++){let s=n[t];e.getXY(s).isFinite()&&((o<0||0!==this.compareVerticesMultiPoint(o,s))&&(a[s]=!0),o=s)}let h=this.m_geometry.createInstance(),l=0,m=0;for(let e=0;e<i;e++)a[e]?m=e+1:(l<m&&h.addPoints(r,l,m),l=e+1);return l<m&&h.addPoints(r,l,m),h.getImpl().setIsSimple(1,this.m_toleranceSimplify.total()),h}polylineSimplifyAsFeature(){let e=this.m_geometry.getImpl(),t=e.querySegmentIterator(),s=e.querySegmentIterator(),r=this.m_geometry.createInstance(),i=this.m_geometry,n=e.hasAttribute(1),a=n?(0,I.a3)(this.m_sr,e,!0).total():0,o=[],h=[],l=null;n&&(l=e.getAttributeStreamRef(1));let m=new I.P,g=e.hasNonLinearSegments(),u=this.m_toleranceSimplify.total();for(;t.nextPath();){if(s.nextPath(),2>e.getPathSize(t.getPathIndex()))continue;if(g&&e.hasNonLinearSegmentsPath(t.getPathIndex())){this.removeDegenerateSegmentsFromCurvedPath(e,t.getPathIndex(),a,r);continue}s.resetToLastSegment();let _=0,d=0,p=!0,c=!0;for(;t.hasNextSegment();){this.progress_();let r=t.nextSegment(),i=s.previousSegment();if(t.getStartPointIndex()>s.getStartPointIndex())break;if(p){let s=t.getStartPointIndex();e.getXY(s).isNAN()||(p=!1,o.push(s))}if(c){let t=s.getEndPointIndex();e.getXY(t).isNAN()||(h.push(t),c=!1)}if(!p){let s=o.at(-1),i=t.getEndPointIndex();if(i-s>1){let t=new b.P;t.setSub(e.getXY(s),e.getXY(i)),_=t.length()}else _=r.calculateLength2D();if(_>u)o.push(i),_=0;else if(n){let e=l.read(s);Number.isNaN(e)&&(e=0);let t=l.read(i);Number.isNaN(t)&&(t=0),Math.abs(t-e)>a&&(o.push(i),_=0)}}if(!c){let t=h.at(-1),r=s.getStartPointIndex();if(r-t>1){let s=new b.P;s.setSub(e.getXY(t),e.getXY(r)),d=s.length()}else d=i.calculateLength2D();if(d>u)h.push(r),d=0;else if(n){let e=l.read(t);Number.isNaN(e)&&(e=0);let s=l.read(r);Number.isNaN(s)&&(s=0),Math.abs(s-e)>a&&(h.push(r),d=0)}}}if(o.length>0&&h.length>0&&(o.at(-1)<h.at(-1)?o.length>h.length?o.pop():h.pop():(o.at(-1)===h.at(-1)||h.pop(),h.pop())),h.length+o.length>=2){let e=!1;for(let t=0,s=o.length;t<s;t++)i.getPointByVal(o[t],m),e?r.lineToPoint(m):(r.startPathPoint(m),e=!0);for(let t=h.length-1;t>0;t--)i.getPointByVal(h[t],m),e?r.lineToPoint(m):(r.startPathPoint(m),e=!0);i.isClosedPath(t.getPathIndex())?r.closePathWithLine():h.length>0&&(i.getPointByVal(h[0],m),r.lineToPoint(m))}o.length=0,h.length=0}return n&&r.replaceNaNs(1,0),r.getImpl().setIsSimple(1,u),r}polygonSimplifyAsFeature(){return this.simplifyPlanar()}simplifyPlanar(){if(1===this.m_geometry.getFillRule()&&!(0,I.M)(this.m_knownSimpleResult))return sy(this.m_geometry,this.m_toleranceSimplify,!0,!1,this.m_knownSimpleResult,this.m_progressTracker,0,!0);let e=new C.E;if(e.addGeometry(this.m_geometry),this.m_geometry.hasAttribute(1)&&e.replaceNaNs(1,0),e.removeNaNVertices(),0!==e.getTotalPointCount()){let s=null,r=0,i=0;if(e.hasCurves()){var t;s=new so;let n=E.J.constructEmpty();this.m_geometry.queryEnvelope(n);let a=si(this.m_toleranceSimplify.total(),n);i=sa(a,r=sn(this.m_toleranceSimplify.total())),t=this.m_toleranceSimplify.total(),ss(e,a,t,s,null,this.m_progressTracker)}(0,I.M)(this.m_knownSimpleResult)||sl(e,this.m_toleranceSimplify.add(i),this.m_progressTracker,!0,!1),this.m_geometry.getGeometryType()===S.G.enumPolygon&&eW(e,e.getFirstGeometry(),this.m_knownSimpleResult,!1,-1,this.m_progressTracker),null!==s&&s.stitchCurves(e,e.getFirstGeometry(),r,!0)}let s=e.getGeometry(e.getFirstGeometry());return s.getGeometryType()===S.G.enumPolygon&&(s.getImpl().updateOGCFlagsProtected(),s.setFillRule(0)),s.getImpl().setIsSimple(4,this.m_toleranceSimplify.total()),s}progress_(){}static hasNanZs(e){if(e.hasAttribute(1)){let t=e.getAttributeStreamRef(1);for(let s=0,r=e.getPointCount();s<r;s++)if(Number.isNaN(t.read(s)))return!0}return!1}compareVerticesForPlanarClustering(e,t,s){if(e===t)return 0;let r=this.m_pairs[e],i=this.m_pairs[t],n=r>>1,a=i>>1,o=this.m_xy.readPoint2D(2*n);o.y+=1&r?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;let h=this.m_xy.readPoint2D(2*a);h.y+=1&i?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;let l=o.compare(h);if(0===l&&s){let e=this.m_pathsForOGCTests[n]-this.m_pathsForOGCTests[a];return(0,b.e)(e)}return l}compareVerticesMultiPoint(e,t){if(e===t)return 0;let s=this.m_multiVertexGeom.getXY(e),r=this.m_multiVertexGeom.getXY(t),i=!s.isFinite(),n=!r.isFinite();if(i||n)return i<n?-1:+(i>n);if(s.y<r.y)return -1;if(s.y>r.y)return 1;if(s.x<r.x)return -1;if(s.x>r.x)return 1;for(let s=1;s<this.m_attributeCount;s++){let r=this.m_description.getSemantics(s),i=I.V.getComponentCount(r);for(let s=0;s<i;s++){let i=this.m_multiVertexGeom.getAttributeAsDbl(r,e,s),n=this.m_multiVertexGeom.getAttributeAsDbl(r,t,s),a=(0,b.r)(i,n);if(0!==a)return a}}return 0}edgeAngleCompare(e,t){if(e===t)return 0;let s=e.m_segment.getTangent(+!!e.getReversed());e.getReversed()&&s.negateThis();let r=t.m_segment.getTangent(+!!t.getReversed());t.getReversed()&&r.negateThis();let i=s.getQuarter(),n=r.getQuarter();if(n===i){let e=s.crossProduct(r);return e<0?1:e>0?-1:0}return i<n?-1:1}}class sM{getOperatorType(){return 10103}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}isSimpleAsFeature(e,t,s,r,i){let n=sD(e,t,s,r,i);return(0,I.R)(e.getGeometryType(),n)}isSimplePlanarDONOTUSE(e,t,s,r,i){let n=function(e,t,s,r,i){if(r&&(r.m_reason=0,r.m_vertexIndex1=-1,r.m_vertexIndex2=-1),e.isEmpty())return 5;let n=e.getGeometryType();if(n===S.G.enumPoint)return sV(e,r);let a=(0,I.b)(t,e,!1).total();if(n===S.G.enumEnvelope){let t=new E.J;return e.queryEnvelope(t),t.isDegenerate(a)?(r&&(r.m_reason=4,r.m_vertexIndex1=-1,r.m_vertexIndex2=-1),0):5}if((0,S.f)(n)){let n=new C.P({vd:e.getDescription()});return n.addSegment(e,!0),sD(n,t,s,r,i)}let o=e.getImpl().getIsSimple(a,[0]),h=s?-1:o;if((0,I.i)(h)||0===h)return h;let l=new sA(e,t,h,i,!1);return n===S.G.enumMultiPoint||n===S.G.enumPolyline||n===S.G.enumPolygon?h=l.isSimplePlanarImpl():(0,S.c)(""),e.getImpl().setIsSimple(h,a),r&&r.assign(l.m_nonSimpleResult),h}(e,t,s,r,i);return(0,I.i)(n)}executeMany(e,t,s,r){return new sU(e,t,s,r)}execute(e,t,s,r){let i=new N.S([e]),n=this.executeMany(i,t,s,r).next();return n||(0,S.c)("null geometry"),n}}class sU extends N.G{constructor(e,t,s,r){super(),this.m_progressTracker=r,this.m_bForceSimplify=s,this.m_index=-1,this.m_inputGeometryCursor=e,this.m_spatialReference=t}next(){let e=this.m_inputGeometryCursor.next();return e?(this.m_index=this.m_inputGeometryCursor.getGeometryID(),this.simplify(e)):null}getGeometryID(){return this.m_index}tock(){return!1}getRank(){return 1}simplify(e){if(e||(0,S.t)(""),e.getGeometryType()===S.G.enumGeometryCollection){let t=(0,C.g)(e,-1),s=(new sM).executeMany(t,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker),r=e.createInstance();for(let e=s.next();null!=e;e=s.next())r.addGeometry(e);return r}return function e(t,s,r,i){let n;if(t.isEmpty())return t;let a=t.getGeometryType();if(a===S.G.enumPoint){let e=new F;if(sV(t,e),3===e.m_reason){let e=t.clone();return e.replaceNaNs(1,0),e}return 2===e.m_reason?t.createInstance():t}if(a===S.G.enumEnvelope){let e=(0,I.b)(s,t,!0).total(),r=E.J.constructEmpty();return t.queryEnvelope(r),r.isDegenerate(e)?t.createInstance():t}if((0,S.f)(a)){let n=new C.P({vd:t.getDescription()});return n.addSegment(t,!0),e(n,s,r,i)}(0,S.C)(a);let o=(0,I.b)(s,t,!1).total(),h=t.getImpl().getIsSimple(o,[0]),l=r?-1:h;if((0,I.i)(l)){if(a===S.G.enumPolygon&&0!==t.getFillRule()){let e=t.clone();return e.setFillRule(0),e}return t}if((a===S.G.enumMultiPoint||a===S.G.enumPolyline)&&l>=1)return t;let m=new sA(t,s,l,i,!1);return a===S.G.enumMultiPoint?n=m.multipointSimplifyAsFeature():a===S.G.enumPolyline?n=m.polylineSimplifyAsFeature():a===S.G.enumPolygon?n=m.polygonSimplifyAsFeature():(0,S.c)(""),n}(e,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker)}}class sq{constructor(e,t,s,r){this.m_intersectorGeom=null,this.m_sr=null,this.m_dimensionMask=-1,this.m_progressTracker=null,this.m_intersectorGeomType=S.G.enumUnknown,this.m_geomIntersectorEmptyGeom=null,this.m_intersectorGeom=e,this.m_sr=t,this.m_dimensionMask=s,this.m_progressTracker=r,this.m_intersectorGeomType=e.getGeometryType()}intersect(e){let t=this.tryFastImplementation(e);if(null!==t)return t;let s=(0,I.g)(this.m_intersectorGeom,e),r=(0,I.a)(this.m_sr,s,!0).total(),i=E.J.constructEmpty();this.m_intersectorGeom.queryEnvelope(i);let n=E.J.constructEmpty();e.queryEnvelope(n),i.inflateCoords(2*r,2*r),i.intersect(n),i.inflateCoords(100*r,100*r);let a=(0,w.c)(this.m_intersectorGeom,i,0,0,this.m_progressTracker),o=(0,w.c)(e,i,0,0,this.m_progressTracker);return e.getDimension()>this.m_intersectorGeom.getDimension()&&(a=(0,b.b)(o,o=a)),function(e,t,s,r){let i=E.J.constructEmpty();e.queryEnvelope(i);let n=E.J.constructEmpty();t.queryEnvelope(n);let a=E.J.constructEmpty();a.setCoords({env2D:i}),a.mergeEnvelope2D(n);let o=(0,I.a)(s,a,!0),h=new E.J(n),l=(0,I.d)(o);if(h.inflateCoords(l,l),!i.isIntersecting(h)){if(e.getDimension()<=t.getDimension())return sv(sG(e.createInstance()),e,t,"&");if(e.getDimension()>t.getDimension())return sv(sG(t.createInstance()),e,t,"&")}let m=new sC(r),g=new C.E,u=g.addGeometry(sG(e)),_=g.addGeometry(sG(t)),d=0,p=0,c=null;if(g.hasCurves()){var f;c=new so;let e=g.getEnvelope2D(r);p=sn(o.total());let t=si(o.total(),e);d=sa(t,p),f=o.total(),ss(g,t,f,c,null,r)}m.setEditShapeCrackAndCluster(g,o.add(d));let x=m.intersection(u,_);null!==c&&c.stitchCurves(g,x,p,!0);let P=sv(g.getGeometry(x),e,t,"&");return s_(P.getGeometryType())&&(P.getImpl().setIsSimple(4,o.total()),P.getGeometryType()===S.G.enumPolygon&&P.getImpl().updateOGCFlagsProtected()),P}(o,a,this.m_sr,this.m_progressTracker)}intersectEx(e){let t=this.tryFastImplementation(e);if(null!==t){let s=[];return s.length=3,s[t.getDimension()]=t,this.prepareVector(e.getDescription(),this.m_dimensionMask,s)}let s=(0,I.g)(this.m_intersectorGeom,e),r=(0,I.a)(this.m_sr,s,!0).total(),i=E.J.constructEmpty();this.m_intersectorGeom.queryEnvelope(i);let n=E.J.constructEmpty();e.queryEnvelope(n),i.inflateCoords(2*r,2*r),i.intersect(n),i.inflateCoords(100*r,100*r);let a=(0,w.c)(this.m_intersectorGeom,i,0,0,this.m_progressTracker),o=(0,w.c)(e,i,0,0,this.m_progressTracker);e.getDimension()>this.m_intersectorGeom.getDimension()&&(a=(0,b.b)(o,o=a));let h=function(e,t,s,r){let i=[,,,],n=E.J.constructEmpty();e.queryEnvelope(n);let a=E.J.constructEmpty();t.queryEnvelope(a);let o=E.J.constructEmpty();o.setCoords({env2D:n}),o.mergeEnvelope2D(a);let h=(0,I.a)(s,o,!0),l=new E.J(a),m=(0,I.d)(h);if(l.inflateCoords(m,m),!n.isIntersecting(l)){if(e.getDimension()<=t.getDimension()){let s=sv(sG(e.createInstance()),e,t,"&");return i[s.getDimension()]=s,i}if(e.getDimension()>t.getDimension()){let s=sv(sG(t.createInstance()),e,t,"&");return i[s.getDimension()]=s,i}}let g=new sC(r),u=new C.E,_=u.addGeometry(sG(e)),d=u.addGeometry(sG(t)),p=0,c=0,f=null;if(u.hasCurves()){var x;f=new so;let e=u.getEnvelope2D(r);c=sn(h.total());let t=si(h.total(),e);p=sa(t,c),x=h.total(),ss(u,t,x,f,null,r)}for(let s of(g.setEditShapeCrackAndCluster(u,h.add(p)),u.dbgVerifyCurves(),g.intersectionEx(_,d))){null!==f&&f.stitchCurves(u,s,c,!1);let r=sv(u.getGeometry(s),e,t,"&");s_(r.getGeometryType())&&(r.getImpl().setIsSimple(4,h.total()),r.getGeometryType()===S.G.enumPolygon&&r.getImpl().updateOGCFlagsProtected()),i[r.getDimension()]=r}return null!==f&&f.clearStitcher(u),i}(o,a,this.m_sr,this.m_progressTracker);return this.prepareVector(e.getDescription(),this.m_dimensionMask,h)}init(e,t,s,r=null){(0,S.g)(0)}static intersectPoints(e,t,s){var r;let i=(0,I.g)(e,t);return r=(0,I.a)(s,i,!0),e.isEmpty()||t.isEmpty()||!function(e,t,s){let r=(0,I.d)(e);return ex(t.getX(),t.getY(),s.getX(),s.getY(),(0,b.s)(r))}(r,e,t)?e.createInstance():new I.P({copy:function(e,t,s=1,r=1,i=1,n=1){if(r>n)return e;if(n>r)return t;let a=new I.P;return function(e,t,s,r,i,n,a,o,h){if(e.equals(t),r>n)return a.assignCopy(e),h[0]=r,o[0]=s;if(n>r)return a=t,h[0]=n,o[0]=i;a.assignCopy(e);let l=eP(e.getXY(),t.getXY(),s,r,i,n);a.setXY(l.pt),o[0]=l.weight,h[0]=l.rank}(e,t,s,r,i,n,a,[0],[0]),a}(e,t)})}tryFastImplementation(e){let t=e.getGeometryType();if(this.m_intersectorGeomType===S.G.enumPoint&&t===S.G.enumPoint){let t=sq.intersectPoints(e,this.m_intersectorGeom,this.m_sr);if(-1!==this.m_dimensionMask){let e=new C.M({vd:t.getDescription()});return t.isEmpty()||e.add(t),e}return t}if(t===S.G.enumEnvelope&&this.m_intersectorGeomType===S.G.enumEnvelope&&(-1===this.m_dimensionMask||4===this.m_dimensionMask)){let t=this.m_intersectorGeom,s=new I.E({copy:e});return s.intersect(t),s}let s=(0,I.g)(e,this.m_intersectorGeom),r=(0,I.a)(this.m_sr,s,!0),i=e.isEmpty(),n=this.m_intersectorGeom.isEmpty(),a=i||n;if(!a){let t=function(e,t,s){let r=new E.J;e.queryEnvelope(r);let i=new E.J;t.queryEnvelope(i);let n=new E.J(i);if(n.inflate(2*s),!n.isIntersecting(r))return 4;let a=e.getGeometryType(),o=t.getGeometryType();if(a===S.G.enumEnvelope&&r.containsEnvelope(n))return 1;if(o===S.G.enumEnvelope){let e=new E.J(r);if(e.inflate(2*s),i.containsEnvelope(e))return 2}return 0}(this.m_intersectorGeom,e,r.total());if(4===t)a=!0;else{if(2&t)return this.m_intersectorGeom;if(1&t)return e}}if(a){let s=(0,S.A)(t),r=(0,S.A)(this.m_intersectorGeomType);return s<r?sq.ReturnEmpty(e,i):s>r||0===s&&t===S.G.enumMultiPoint&&this.m_intersectorGeomType===S.G.enumPoint?this.ReturnEmptyIntersector():sq.ReturnEmpty(e,i)}if(t===S.G.enumEnvelope&&0===(0,S.A)(this.m_intersectorGeomType)||this.m_intersectorGeomType===S.G.enumEnvelope&&0===(0,S.A)(t)){let s=t===S.G.enumEnvelope?e:this.m_intersectorGeom,i=t===S.G.enumEnvelope?this.m_intersectorGeom:e,n=E.J.constructEmpty();return s.queryEnvelope(n),(0,w.c)(i,n,r.total(),0,this.m_progressTracker)}if(0===(0,S.A)(t)&&(0,S.A)(this.m_intersectorGeomType)>0||(0,S.A)(t)>0&&0===(0,S.A)(this.m_intersectorGeomType)){if(t===S.G.enumMultiPoint)return sb(e,this.m_intersectorGeom,r);if(t===S.G.enumPoint)return sI(e,this.m_intersectorGeom,r,!0);if(this.m_intersectorGeomType===S.G.enumMultiPoint)return sb(this.m_intersectorGeom,e,r);if(this.m_intersectorGeomType===S.G.enumPoint)return sI(this.m_intersectorGeom,e,r,!0);(0,S.c)("")}return null}ReturnEmptyIntersector(){return null===this.m_geomIntersectorEmptyGeom&&(this.m_geomIntersectorEmptyGeom=this.m_intersectorGeom.createInstance()),this.m_geomIntersectorEmptyGeom}static ReturnEmpty(e,t){return t?e:e.createInstance()}prepareVector(e,t,s){let r=0;return 1&t?(s[0]||(s[0]=new C.M({vd:e})),r++):s.shift(),2&t?(s[r]||(s[r]=new C.P({vd:e})),r++):s.splice(r,1),4&t?s[r]||(s[r]=new C.a({vd:e})):s.splice(r,1),new N.S(s)}}class sO extends N.G{constructor(e,t,s,r,i){super(),this.m_smallCursor=null,this.m_progressTracker=r,this.m_geomIntersector=t.next(),this.m_intersector=new sq(this.m_geomIntersector,s,i,r),this.m_index=-1,this.m_inputGeoms=e,this.m_dimensionMask=i,-1!==this.m_dimensionMask&&(this.m_dimensionMask<=0||this.m_dimensionMask>7)&&(0,S.t)("bad dimension mask")}next(){let e;if(!this.m_geomIntersector)return null;if(null!==this.m_smallCursor){if(e=this.m_smallCursor.next())return e;this.m_smallCursor=null}for(;e=this.m_inputGeoms.next();){if((0,S.d)(e),this.m_index=this.m_inputGeoms.getGeometryID(),-1===this.m_dimensionMask)return this.m_intersector.intersect(e);return this.m_smallCursor=this.m_intersector.intersectEx(e),this.m_smallCursor.next()}return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class sB{getOperatorType(){return 1e4}accelerateGeometry(e,t,s){if(!this.canAccelerateGeometry(e))return!1;(0,I.b)(t,e,!0);let r=0;return(e.getGeometryType()===S.G.enumPolygon||e.getGeometryType()===S.G.enumPolyline)&&(0,C.U)(e)&&0!==s&&(r|=!!e.getImpl().buildQuadTreeAccelerator(s)),!!r}canAccelerateGeometry(e){return(0,C.U)(e)}supportsCurves(){return!0}executeMany(e,t,s,r,i=-1){return new sO(e,t,s,r,i)}execute(e,t,s,r){if(e.getGeometryType()===S.G.enumPoint&&t.getGeometryType()===S.G.enumPoint)return sq.intersectPoints(e,t,s);let i=new N.S([e]),n=new N.S([t]),a=this.executeMany(i,n,s,r,-1).next();return a||(0,S.c)("null output"),a}}function sR(e,t,s){return t.m_projector.project(e,s)}function sY(e,t,s,r,i){return e.m_projector.transformInPlaceZ(t,null,s,r,null,i)}function sX(e,t,s){let r;if(e&&t&&t.isPannable()||(0,S.t)(""),e.isEmpty())return e;let i=e.getGeometryType();if(i===S.G.enumEnvelope){let t=new C.a({vd:e.getDescription()});t.addEnvelope(e,!1),r=t}else if((0,S.f)(i)){let t=new C.P({vd:e.getDescription()});t.addSegment(e,!0),r=t}else r=e;let n=rB(r,t);return n.isEmpty()?n:rH(n,t,0,n!==e,0,s)}function sL(e,t,s,r){let i=t.getXYGridRange(),n=e.hasAttribute(1),a=e.hasAttribute(2),o=new b.E,h=new b.E;n&&(o=t.getZGridRange()),a&&(h=t.getMGridRange());let l=(new w.O).execute(e,i,s,r);if(n){let t=l.queryInterval(1,0);o.contains(t)||(e===l&&(l=l.clone()),(0,I.U)(l,o,1,0))}if(a){let t=l.queryInterval(2,0);h.contains(t)||(e===l&&(l=l.clone()),(0,I.U)(l,h,2,0))}return l}class sz{constructor(e){this.m_inputPCSHorizonClipOption=0,this.m_outputPCSHorizonClipOption=0,this.m_bDontGeonormalizePolygon=!1,this.m_bClipOutCurvedPoles=!1,this.m_bNormalizeOutputGeometry=!1,this.m_bDontHackPolesInGeogToGeog=!1,this.m_centralMeridianOfOutputGCS=0,this.m_densificationStepInput=0,e||(0,S.t)(""),this.m_projTransform=e,this.m_bClipOutCurvedPoles=!1;let t=this.m_projTransform.getExtendedParamsImpl();this.m_bNormalizeOutputGeometry=t.normalizeResultGeometry,this.m_bNormalizeOutputGeometry&&(t.legacyHorizonClipping?this.m_bNormalizeOutputGeometry=!1:this.m_projTransform.getOutputSR().isPannable()||(this.m_bNormalizeOutputGeometry=!1)),t.clipWithInputHorizon?(this.m_inputPCSHorizonClipOption=0,!t.legacyHorizonClipping&&this.m_projTransform.getInputSR().isPannable()&&(this.m_inputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_inputPCSHorizonClipOption=1,t.clipWithOutputHorizon?(this.m_outputPCSHorizonClipOption=0,!t.legacyHorizonClipping&&this.m_projTransform.getOutputSR().isPannable()&&(this.m_outputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_outputPCSHorizonClipOption=1,this.m_centralMeridianOfOutputGCS=t.centralMeridianOfOutputGCS,this.m_densificationStepInput=t.densificationStep;let s=this.m_projTransform.getExtendedParamsInternal();this.m_bDontGeonormalizePolygon=s.hasFlag(0x80000000),this.m_bDontHackPolesInGeogToGeog=s.hasFlag(0x40000000),this.m_bClipOutCurvedPoles=s.hasFlag(0x20000000)}project(e,t){if(this.m_projTransform.isIdentity()||e.isEmpty())return e;let s=e.getGeometryType();if(s===S.G.enumPoint)return this.projectPoint(e,t);let r=this.m_projTransform.getInputSR().getCoordinateSystemType(),i=this.m_projTransform.getOutputSR().getCoordinateSystemType(),n=this.m_projTransform.getInputSR(),a=this.m_projTransform.getOutputSR();if(0===r&&r===i){let t=sW(n,a),s=e.clone();return s.applyTransformation(t),s}switch(s){case S.G.enumPolyline:case S.G.enumPolygon:return this.projectMultiPath(e,t);case S.G.enumMultiPoint:return this.projectMultiPoint(e,t);case S.G.enumEnvelope:return this.projectEnvelope(e,t);case S.G.enumGeometryCollection:return this.projectGeometryCollection(e,t);default:(0,S.c)("")}}projectPoint(e,t){let s=[e.getXY()],r,i=null;(r=e.hasAttribute(1))&&(i=[e.getZ()]),this.transformInPlaceZ(s,i,1,s,i,null);let n=e.clone();return n.setXY(s[0]),r&&n.setZ(i[0]),n}projectMultiPoint(e,t){let s=new C.M({copy:e}),r=this.m_projTransform.getInputSR(),i=this.m_projTransform.getOutputSR(),n=r.getCoordinateSystemType(),a=i.getCoordinateSystemType();if(3===n&&(0,S.g)(0),(s=rz(s,r,this.m_inputPCSHorizonClipOption,t)).isEmpty())return s;2===n&&r$(r,0,s),r4(this.m_projTransform,s,!1);let o=0;3===a&&(0,S.g)(0);let h=2===a;return h?o=i.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(o=this.m_centralMeridianOfOutputGCS),h&&0!==this.m_outputPCSHorizonClipOption||(s=rH(s,iY(i),o,!1,0,t)),h&&(s=rD(s,i,this.m_outputPCSHorizonClipOption,t),rK(i,s,this.m_bNormalizeOutputGeometry),s.isEmpty()),s}projectMultiPath(e,t){let s=e.getGeometryType();return s===S.G.enumPolygon?this.projectPolygon(e,t):s===S.G.enumPolyline?this.projectPolyline(e,t):void(0,S.c)("project_multi_path_")}projectEnvelope(e,t){this.m_projTransform.getInputSR(),this.m_projTransform.getOutputSR();let s=this.m_projTransform.isVertical()&&e.hasAttribute(1),r=b.E.constructEmpty();if(s&&(r=e.queryInterval(1,0)),r.width()>0){let s=e.clone();s.setInterval(1,0,r.vmin,r.vmin);let i=this.projectEnvelopeHelper(s,t);s.setInterval(1,0,r.vmax,r.vmax);let n=this.projectEnvelopeHelper(s,t);return i.merge(n),i}return this.projectEnvelopeHelper(e,t)}projectPolygon(e,t){let s;(0,S.g)(e.getGeometryType()===S.G.enumPolygon),(0,S.g)(!this.m_projTransform.isIdentity()),(0,S.g)(!e.isEmpty());let r=this.m_projTransform.getInputSR(),i=this.m_projTransform.getOutputSR(),n=r.getCoordinateSystemType(),a=i.getCoordinateSystemType(),o=new C.a({copy:e});3===n&&(0,S.g)(0),3===a&&(0,S.g)(0);let h=2===n,l=2===a,m=h?r.getGCS():r,g=l?i.getGCS():i,_=!l&&!this.m_bDontHackPolesInGeogToGeog,d=!1,p=rz(o,r,this.m_inputPCSHorizonClipOption,t);if(p.isEmpty())return p;let c=this.m_densificationStepInput,f=!Number.isNaN(c);f&&(p=(new T.O).execute(p,c,0,0,t));let x=l?i.getPCSInfo():null,P=Number.NaN;h&&(P=r.getCentralMeridian());let y=null!==i.getGCSSplitLines();if(this.m_bDontGeonormalizePolygon){let e=p;if(h&&(r1(r,P,e),f)){let e=r.getUnitsPerMillimeter();c*=r.getGCS().getUnitsPerMillimeter()/e}if(r3(this.m_projTransform,e,_),f){let e=r.getGCS().getUnitsPerMillimeter();c*=i.getGCS().getUnitsPerMillimeter()/e}s=e}else{var I,b,v,G,N,D,V,F,H;let e=new C.P({vd:p.getDescription()});if(e.addAndExplicitlyOpenAllPaths(p,!1),h){if(r1(r,P,e),f){let e=r.getUnitsPerMillimeter();c*=r.getGCS().getUnitsPerMillimeter()/e}if(this.m_bClipOutCurvedPoles){let s=r.getPCSInfo(),i=s.getSouthPoleGeometry()===u.PE_POLE_LINE_CURVED,n=s.getNorthPoleGeometry()===u.PE_POLE_LINE_CURVED;if(i||n){let s=E.J.constructEmpty();e.queryLooseEnvelope(s),s.inflateCoords(1,1);let r=89.9999*m.getOneDegreeGCSUnit();i&&(s.ymin=-r),n&&(s.ymax=r),e=(0,w.a)(e,s,m,0,0,t)}}}if(r3(this.m_projTransform,e,_),f){let e=iY(r).getUnitsPerMillimeter();c*=iY(i).getUnitsPerMillimeter()/e}let n=Number.NaN;l?(x=i.getPCSInfo(),n=i.getCentralMeridian()):Number.isNaN(this.m_centralMeridianOfOutputGCS)||(n=this.m_centralMeridianOfOutputGCS);let a=sJ(r)|sJ(i),o=10*g.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(a=3,o=10*g.getTolerance(0)),I=p,b=r,v=e,G=g,N=n,D=t,V=a,F=o,H=this.m_bNormalizeOutputGeometry,s=new rm(I,null,v,b,G,N,V,F,D).geoNormalizePolygonGeometry(H),a=0}if(y&&((0,S.g)(!i.isPannable()),s=rw(s,i,t)),l){if(!d){let e=g.getPannableExtent().width();if(s.queryInterval(0,0).width()>=e-10*g.getTolerance(0)){let e=x.getNorthPoleLocation(),t=x.getSouthPoleLocation(),s=x.getNorthPoleGeometry(),r=x.getSouthPoleGeometry(),i=0;s===u.PE_POLE_POINT&&e!==u.PE_POLE_OUTSIDE_BOUNDARY&&(i=1),r===u.PE_POLE_POINT&&t!==u.PE_POLE_OUTSIDE_BOUNDARY&&(i|=2),d||=0!==i}}s=rD(s,i,this.m_outputPCSHorizonClipOption,t),f&&(s=(new T.O).execute(s,c,0,0,t)),rQ(i,s,this.m_bNormalizeOutputGeometry)}return s.isEmpty()||d&&(s=(new sM).execute(s,i,!1,t)),s}projectPolyline(e,t){let s;(0,S.g)(e.getGeometryType()===S.G.enumPolyline),(0,S.g)(!this.m_projTransform.isIdentity()),(0,S.g)(!e.isEmpty());let r=this.m_projTransform.getInputSR(),i=this.m_projTransform.getOutputSR(),n=r.getCoordinateSystemType(),a=i.getCoordinateSystemType(),o=new C.P({copy:e});3===n&&(0,S.g)(0),3===a&&(0,S.g)(0);let h=2===n,l=2===a;h&&r.getGCS();let m=l?i.getGCS():i,g=!l&&!this.m_bDontHackPolesInGeogToGeog,u=rz(o,r,this.m_inputPCSHorizonClipOption,t);if(u.isEmpty())return u;let _=Number.NaN;h&&(_=r.getCentralMeridian());let d=null!==i.getGCSSplitLines(),p=this.m_densificationStepInput,c=!Number.isNaN(p);if(c&&(u=(new T.O).execute(u,p,0,0,t)),this.m_bDontGeonormalizePolygon){if(h&&(r1(r,_,u),c)){let e=r.getUnitsPerMillimeter();p*=r.getGCS().getUnitsPerMillimeter()/e}if(r3(this.m_projTransform,u,g),c){let e=r.getGCS().getUnitsPerMillimeter();p*=i.getGCS().getUnitsPerMillimeter()/e}s=u}else{var f,x,P,y,E,I,b,v,G;let e=new C.P({vd:u.getDescription()});if(e.addAndExplicitlyOpenAllPaths(u,!1),h&&(r1(r,_,e),c)){let e=r.getUnitsPerMillimeter();p*=r.getGCS().getUnitsPerMillimeter()/e}if(r3(this.m_projTransform,e,g),c){let e=r.getGCS().getUnitsPerMillimeter();p*=i.getGCS().getUnitsPerMillimeter()/e}let n=Number.NaN;l?n=i.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(n=this.m_centralMeridianOfOutputGCS);let a=sJ(r)|sJ(i),o=10*m.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(a=3,o=0),f=u,x=r,P=e,y=m,E=n,I=t,b=a,v=o,G=this.m_bNormalizeOutputGeometry,s=new rm(f,null,P,x,y,E,b,v,I).geoNormalizePolylineGeometry(G),a=0}return d&&((0,S.g)(!i.isPannable()),s=rw(s,i,t)),l&&(s=rD(s,i,this.m_outputPCSHorizonClipOption,t),c&&(s=(new T.O).execute(s,p,0,0,t)),rQ(i,s,this.m_bNormalizeOutputGeometry)),s.isEmpty(),s}projectGeometryCollection(e,t){return(0,S.g)(0),{}}projectEnvelopeHelper(e,t){let s=(e.height()+e.width())/400;if(0!==s){let r=(new T.O).execute(e,s,0,0,t),i=this.projectMultiPath(r,t),n=new I.E({vd:e.getDescription()});if(i.isEmpty()){let s=Math.min(e.height(),e.width()),i=(0,I.b)(this.m_projTransform.getInputSR(),e,!0).total();if(s>100*i){let e=E.J.constructEmpty();if(s>100*Math.max(i,(0,I.a)(this.m_projTransform.getOutputSR(),e,!0).total()*(this.m_projTransform.getInputSR().getOneMeter()/this.m_projTransform.getOutputSR().getOneMeter())))return n}let a=new C.P;a.addAndExplicitlyOpenAllPaths(r,!1),this.projectMultiPath(a,t).queryEnvelope(n);let o=new C.M({vd:e.getDescription()});o.reserve(4);let h=new I.P;for(let t=0;t<4;t++)e.queryCornerByVal(t,h),o.add(h);let l=this.projectMultiPoint(o,t),m=new I.E;return l.queryEnvelope(m),n.merge(m),n}return i.queryEnvelope(n),n}{let s=e.getCenterXY(),r=new I.P(s),i=this.projectPoint(r,t),n=new I.E({vd:e.getDescription()});if(i.isEmpty())n.setEmpty();else{e.copyTo(n);let t=i.getXY();n.setCoords(t.x,t.y,t.x,t.y)}return n}}transformInPlace(e,t,s,r){return(0,S.g)(0),0}transformInPlaceZ(e,t,s,r,i,n){if(this.m_projTransform.isIdentity())return e!==r&&(0,b.au)(r,e,s),t!==i&&(0,b.a)(i,t,0,0,s),s;let a=this.m_projTransform,o=a.getInputSR(),h=a.getOutputSR(),l=o.getCoordinateSystemType(),m=h.getCoordinateSystemType();if(0===l&&l===m)return sW(o,h).transformPoints2D(e,s,r),a.isVertical()&&(0,S.g)(0),s;3===l&&(0,S.b)("image: transform_in_place_"),3===m&&(0,S.b)("image: transform_in_place_"),function(e,t,s,r,i,n){let a=r.getCoordinateSystemType();if(2===a){if(0===i)s!==e&&(0,b.au)(s,e,t),function(e,t,s){let r=e.getPCSHorizon();if(r.getGeometryType()!==S.G.enumPolygon)if(r.getGeometryType()!==S.G.enumEnvelope)(0,S.t)("");else for(let e=0;e<s;e++)r.contains(t[e])||t[e].setNAN();else{let i=e.getDefaultPrecisionSR().getTolerance(0);for(let e=0;e<s;e++)1!==t2(r,t[e],i)&&t[e].setNAN()}}(r,s,t);else if(s!==e&&(0,b.au)(s,e,t),r.isPannable()){let e=r.getTolerance(0);(function(e,t,s,r){for(let i=0;i<t;i++){if(e[i].y<s.ymin||e[i].y>s.ymax){e[i].setNAN();continue}let t=e[i].x;e[i].x=rM(t,s,r)}})(s,t,r.getPannableExtent(),e),rk(s,t,r,0)}}else{(0,S.g)(1===a);let i=r.getTolerance(0),n=r.getPannableExtent();for(let r=0;r<t;r++)s[r].assign(function(e,t,s){let r=new b.P;return r.x=rM(e.x,t,s),r.y=e.y,r}(e[r],n,i))}}(e,s,r,o,this.m_inputPCSHorizonClipOption),i!==t&&(0,b.a)(i,t,0,0,s),2===l&&r2(o,0,r,s),r8(this.m_projTransform,r,i,s,!1);let g=0,u=2===m;if(u?g=h.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(g=this.m_centralMeridianOfOutputGCS),u&&0!==this.m_outputPCSHorizonClipOption||rk(r,s,h.getGCS(),g),u){if(!rF(r,s,h,this.m_outputPCSHorizonClipOption))for(let e=0;e<s;++e)r[e].setNAN();rW(h,r,s,!1)}let _=s;for(let e=0;e<s;++e)r[e].isNAN()&&(i&&(i[e]=Number.NaN),_--);return _}}function sJ(e){if(2!==e.getCoordinateSystemType())return 0;let t=0,s=e.getPCSInfo(),r=s.getNorthPoleLocation(),i=s.getSouthPoleLocation(),n=s.getNorthPoleGeometry(),a=s.getSouthPoleGeometry();return n===u.PE_POLE_POINT&&r!==u.PE_POLE_OUTSIDE_BOUNDARY&&(t=1),a===u.PE_POLE_POINT&&i!==u.PE_POLE_OUTSIDE_BOUNDARY&&(t|=2),t}function sW(e,t){let s=e.getHorzUnitFactor(),r=t.getHorzUnitFactor(),i=1,n=1,a=0x13167e5/180;1===e.getUnit().getUnitType()&&(i=a),1===t.getUnit().getUnitType()&&(n=a);let o=s/r*(i!==n?i/n:1),h=new G.T;return h.setScaleCoords(o,o),h}let sj=class{getOperatorType(){return 10300}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s){return!t||t.isIdentity()?e:new sZ(e,t,s)}execute(e,t,s){return t.isIdentity()?e:sR(e,t,s)}transform(e,t,s,r,i=!0){return i?function(e,t,s,r,i){e.m_projector.transformInPlaceZ(t,null,s,r,null,null);let n=r.slice(0,s).filter(e=>!e.isNAN());for(let e=0,t=n.length;e<t;++e)r[e].assign(n[e]);return n.length}(e,t,s,r,0):sY(e,t,s,r,null)}transform3D(e,t,s,r,i=!0){return(0,S.g)(0),0}foldInto360Range(e,t){return sX(e,t,null)}foldInto360RangeGeodetic(e,t,s){return function e(t,s,r,i){if(t&&s&&s.isPannable()||(0,S.t)("fold_into_360_range_geodetic"),t.isEmpty())return t;if(4===r)return sX(t,s,i);let n=t,a=n.getGeometryType();if((0,S.h)(a)){n=rB(t,s);let e=new E.J;n.queryEnvelope(e);let i=(0,I.a)(s,e,!1).total(),a=s.getPannableExtent(),o=Math.floor((e.xmin-a.xmin)/a.width())*a.width()+a.xmin,h=n;for(;o<e.xmax;)o>e.xmin+i&&o<e.xmax-i&&(h=rq(h,s,r,!0,o)),o+=a.width();n=h}else{if(a===S.G.enumEnvelope){let t=new C.a({vd:n.getDescription()});return t.addEnvelope(n,!1),e(t,s,r,i)}if((0,S.f)(a)){let t=new C.P({vd:n.getDescription()});return t.addSegment(n,!0),e(t,s,r,i)}}return sX(n,s,i)}(e,t,s,null)}normalizeGeometryEx(e,t,s,r,i=0){return function(e,t,s,r,i){if(!t.isPannable()||e.isEmpty())return e;let n=e.getGeometryType();n===S.G.enumGeometryCollection&&(0,S.b)("not yet impl for geometry collection");let a=t.getPannableExtent();Number.isNaN(s)&&(s=a.getCenterX());let o=a.width(),h=.5*o,l=i>0,m=e.queryInterval(0,0);if(!l&&m.width()<h||!(0,S.i)(e.getGeometryType())){let t=m.getCenter();if(Math.abs(t-s)<=h)return e;{let r=new G.T,i=(0,b.av)((s-t)/o)*o;r.setShiftCoords(i,0);let n=e.clone();return n.applyTransformation(r),n}}if(n===S.G.enumPolygon){let n=new C.P({vd:e.getDescription()});n.addAndExplicitlyOpenAllPaths(e,!1),l&&(n=sK(n,t,2,i,Number.NaN,null,!0));let a=[];if(!r){{let s=e;l&&(s=new C.a).add(n,!1);let r=function(e,t,s){let r=iD();t.querySpheroidData(r);let i=t.getGCS()!==t?t.getSRToGCSTransform():null,n=(0,b.m)(b.P,100),a=new I.h(0,0,0),o=e.getPointCount(),h=t.getGCS().getUnit().getUnitToBaseFactor();for(let t=0;t<o;){let s=Math.min(100,o-t);e.queryCoordinates(n,s,t,t+s),i&&(new sj).transform(i,n,s,n,!1);for(let e=0;e<s;e++){if(n[e].isNAN())continue;n[e].scale(h);let t=R(r.majorSemiAxis,r.e2,n[e]);a.addThis(t)}t+=s}let l=L(r.majorSemiAxis,r.e2,a);if(l.scale(1/h),!new ro(t.getGCS(),l).project(e))return 0;s.length=e.getPathCount();let m=0>e.calculateArea2D();for(let t=0,r=e.getPathCount();t<r;t++){let r=e.calculateRingArea2D(t),i=m?r<0:r>0;s[t]=i}return m?-1:1}(e,t,a);if(r)r<0&&n.reverseAllPaths();else{let e=s.getPathCount();for(let t=0;t<e;t++)a.push(s.calculateRingArea2D(t)>0)}}r=a}return new rm(null,r,n,null,t,s,3,0,null).geoNormalizePolygonGeometry(!0)}if(n===S.G.enumPolyline){let r=new C.P({vd:e.getDescription()});return r.addAndExplicitlyOpenAllPaths(e,!1),l&&(r=sK(r,t,2,i,Number.NaN,null,!0)),new rm(null,null,r,null,t,s,3,0,null).geoNormalizePolylineGeometry(!0)}if(n===S.G.enumMultiPoint){let t=e.getAttributeStreamRef(0),r,i=null,n=s,a=0,l=.1*o;for(let s=0,m=e.getPointCount();s<m;s++){let m=t.read(2*s),g=m-n;if(Math.abs(g)>h&&Math.abs(a-=g=(0,b.av)(g/o)*o)<l&&(a=0),0!==a){i||(i=(r=e.clone()).getAttributeStreamRef(0));let t=m+a;i.write(2*s,t)}n=m}return i?(r.notifyModified(),r):e}(0,S.c)("")}(e,t,s,r,i)}normalizeGeometry(e,t,s){return function(e,t,s){if(!t.isPannable()||e.isEmpty())return e;let r=t.getPannableExtent().width(),i=.5*r,n=e.queryInterval(0,0);if(n.width()<i||!(0,S.i)(e.getGeometryType())){if(Number.isNaN(s))return e;let t=n.getCenter();if(Math.abs(t-s)<=i)return e;{let i=new G.T,n=(0,b.av)((s-t)/r)*r;i.setShiftCoords(n,0);let a=e.clone();return a.applyTransformation(i),a}}let a=e.getGeometryType(),o=e.getAttributeStreamRef(0),h=e.clone(),l=h.getAttributeStreamRef(0),m=0,g=0,u=0,_=(0,S.h)(a)?0:-1,d=b.E.constructEmpty(),p=!1;for(let t=0,n=e.getPointCount();t<n;t++){let n=o.read(2*t);t===g&&((0,S.h)(a)?(0===_&&Number.isNaN(s)&&(p=!0),_>0&&Number.isNaN(s)&&(s=d.getCenter(),p=!1),g=e.getPathEnd(_),_++):g=e.getPointCount(),Number.isNaN(s)?u=n:(u=s,m=0));let h=n-u;Math.abs(h)>i&&Math.abs(m-=h=(0,b.av)(h/r)*r)<.1*r&&(m=0);let c=n+m;l.write(2*t,c),p&&d.mergeCoordinate(c),u=n}return h.notifyModified(),h}(e,t,s)}clipToSpatialReference(e,t,s,r=0){return function(e,t,s,r){let i=t.getCoordinateSystemType();if(0===i){let r=new i0;return t.queryPrecisionDescriptor(r),sL(e,r,t,s)}let n=e;(2===r||3===r)&&t.isPannable()&&(n=sX(n,t,s));let a=new i0;if(t.queryPrecisionDescriptor(a),n=sL(n,a,t,s),0===r||n.isEmpty())return n;if(1===i){if(1===r){let e=new E.J;n.queryLooseEnvelope(e);let r=t.getPannableExtent(),i=.01*r.width();return r.xmin=e.xmin-i,r.xmax=e.xmax+i,(new w.O).execute(n,r,t,s)}return n}if(2===i){let e=t.getPCSHorizon();if(1===r||2===r){let r=(new sB).execute(n,e,t,s);return r===e?r.clone():r}return n}if(3===i)return n;(0,S.c)("missing implementation")}(e,t,s,r)}};class sZ extends N.G{constructor(e,t,s){super(),this.m_projTrans=t,this.m_progressTracker=s,this.m_index=-1,e||(0,S.t)(""),this.m_inputGeoms=e}next(){let e=this.m_inputGeoms.next();return null!=e?((0,S.l)(e),(0,S.d)(e),this.m_index=this.m_inputGeoms.getGeometryID(),sR(e,this.m_projTrans,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}function sK(e,t,s,r,i,n,a=!1){let o,h,l;e||(0,S.t)("Geometry.Geodetic_densify.densify");let m=e.getGeometryType();if((0,S.d)(e),e.isEmpty()||(0,S.e)(m))return e;let g=new s4;g.m_sr=t,g.m_gcs=t.getGCS(),g.m_transform=g.m_gcs!==t?t.getSRToGCSTransform():null,g.m_progressTracker=n;let u=iD();if(g.m_gcs.querySpheroidData(u),g.m_a=u.majorSemiAxis,g.m_eSquared=u.e2,g.m_rpu=g.m_gcs.getUnit().getUnitToBaseFactor(),g.m_gcsTolerance=g.m_gcs.getTolerance(0),g.m_radTolerance=g.m_gcsTolerance*g.m_rpu,g.m_maxLength=r,g.m_maxDeviation=i,g.m_curveType=s,m===S.G.enumEnvelope){let t=new C.a({vd:e.getDescription()});t.addEnvelope(e,!1),o=t,m=S.G.enumPolygon}else if((0,S.f)(m)){let t=new C.P({vd:e.getDescription()});t.addSegment(e,!0),o=t,m=S.G.enumPolyline}else o=e;if(4!==g.m_curveType){if((0,S.g)((0,S.h)(m)),(h=g.replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(o)).isEmpty())return h;h=sQ(g.m_rpu,h);let e=g.geodeticDensify(h);a||(e=(new sj).foldInto360RangeGeodetic(e,g.m_gcs,g.m_curveType)),l=g.m_transform&&!g.m_transform.isIdentity()?(new sj).execute(e,g.m_transform.getInverse(),n):e}else{let e;if((0,S.g)((0,S.h)(m)),t.isPannable())e=rB(o,t);else{let s=t.getPCSHorizon();(e=(new sB).execute(o,s,t,n))===s&&(e=s.clone())}if((h=e).isEmpty())return h;l=g.shapePreservingDensify(h)}return l}function sQ(e,t){let s=new E.J;if(t.queryLooseEnvelope(s),s.width()*e<Math.PI)return t;let r=!1,i=t.querySegmentIterator(),n=new b.P,a=new b.P;for(;i.nextPath();)for(;i.hasNextSegment();){let t=i.nextSegment();if(n.setCoordsPoint2D(t.getStartXY()),a.setCoordsPoint2D(t.getEndXY()),n.scale(e),a.scale(e),Math.abs(n.x-a.x)>Math.PI&&(!s0(n,a)||Math.abs(n.x-a.x)>2*Math.PI)){r=!0;break}}if(!r)return t;let o=t.createInstance();o.reserve(t.getPointCount());let h=t.getDescription().getAttributeCount()>1,l=new b.P,m=new b.P,g=new b.P(0,0),u=new b.P(0,0),_=new I.P;for(i.resetToFirstPath();i.nextPath();){let t=Number.NaN,s=0;for(;i.hasNextSegment();){let r=i.nextSegment();if(n.setCoordsPoint2D(r.getStartXY()),a.setCoordsPoint2D(r.getEndXY()),n.scale(e),a.scale(e),Number.isNaN(t)?(s=re(n.x,Number.NaN,s),g.setCoordsPoint2D(n)):g.setCoordsPoint2D(u),t=g.x,s0(n,a)){if(a.x-n.x>2*Math.PI)for(;a.x-n.x>2*Math.PI;)a.x-=2*Math.PI;else if(a.x-n.x<-(2*Math.PI))for(;a.x-n.x<-(2*Math.PI);)a.x+=2*Math.PI;s=re(a.x,Number.NaN,s),u.setCoordsPoint2D(a)}else l.setCoordsPoint2D(a),function(e){if(e.x<-Math.PI)for(;e.x<-Math.PI;)e.x+=2*Math.PI;else if(e.x>Math.PI)for(;e.x>Math.PI;)e.x-=2*Math.PI}(l),s=re(l.x,t,s),u.setCoords(s+l.x,l.y);if(.5>Math.abs(u.x-a.x)&&u.setCoordsPoint2D(a),h)r.queryCoord(0,_),m.setCoordsPoint2D(g),m.scale(1/e),_.setXY(m),i.isFirstSegmentInPath()?o.startPathPoint(_):o.lineToPoint(_),i.isLastSegmentInPath()&&!i.isPathClosed()&&(r.queryCoord(1,_),m.setCoordsPoint2D(u),m.scale(1/e),_.setXY(m),o.lineToPoint(_));else{i.isFirstSegmentInPath()&&o.insertPath2D(-1,null,0,0,!0);let t=o.getPathCount()-1;m.setCoordsPoint2D(g),m.scale(1/e),o.insertPoint2D(t,-1,m),i.isLastSegmentInPath()&&!i.isPathClosed()&&(m.setCoordsPoint2D(u),m.scale(1/e),o.insertPoint2D(t,-1,m))}}}return o}function s$(e,t,s,r,i,n,a,o,h,l,m,g){let u=new b.P,_=new b.P,d=r.compare(i)>0;s9(d,r,i,u,_);let p=s6(e,t,s,u,_,n,a,o,h,l,null,m,g);return d&&s8(h,l,null,m),p}function s0(e,t){return!(!nt(e.y,b.l)||!nt(t.y,b.l))||!(!nt(e.y,-b.l)||!nt(t.y,-b.l))}function s1(e,t){return!(!nt(e.y,b.l)||nt(t.y,b.l))||!(!nt(e.y,-b.l)||nt(t.y,-b.l))}function s2(e,t){return!(!nt(t.y,b.l)||nt(e.y,b.l))||!(!nt(t.y,-b.l)||nt(e.y,-b.l))}class s4{constructor(){this.m_sr=null,this.m_gcs=null,this.m_transform=null,this.m_progressTracker=null,this.m_a=0,this.m_eSquared=0,this.m_rpu=0,this.m_gcsTolerance=0,this.m_radTolerance=0,this.m_maxLength=0,this.m_maxDeviation=0,this.m_curveType=0}geodeticDensify(e){let t=e.createInstance(),s=e.querySegmentIterator(),r=[],i=[],n=new C.S,a=e.getDescription().getAttributeCount()>1;for(;s.nextPath();){let e=[0];for(;s.hasNextSegment();){let f=s.nextSegment(),x=f.getStartXY(),P=f.getEndXY();x.scale(this.m_rpu),P.scale(this.m_rpu);let y=new b.P,E=new b.P,C=x.compare(P)>0;var o=void 0,h=void 0,l=void 0,m=void 0,g=void 0,u=void 0,_=void 0,d=void 0,p=void 0,c=void 0;s9(C,x,P,y,E),r.length=0,i.length=0,this.m_maxLength>0?s6(this.m_a,this.m_eSquared,this.m_curveType,y,E,this.m_maxLength,this.m_maxDeviation,this.m_radTolerance,null,null,a?i:null,r,e):(0,S.g)(0),C&&s8(null,null,a?i:null,r),r[0].setCoordsPoint2D(f.getStartXY()),r.at(-1).setCoordsPoint2D(f.getEndXY());let I=1/this.m_rpu;for(let e=1,t=r.length-1;e<t;e++)r[e].scale(I);if(a){let e=s5(C,f,n);s7(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),f,e,i,r,t)}else s3(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),r,t)}}return t}shapePreservingDensify(e){let t=e.createInstance(),s=e.querySegmentIterator(),r=[],i=[],n=new C.S,a=e.getDescription().getAttributeCount()>1;for(;s.nextPath();)for(;s.hasNextSegment();){let e=s.nextSegment(),o=e.getStartXY(),h=e.getEndXY(),l=o.compare(h)>0,g=s5(l,e,n);r.length=0,i.length=0,function(e,t,s,r,i,n,a,o,h){let l=r.isCurve(),g=e*Math.sqrt(1-t)*Math.PI*179/180,u=n;n>0&&!(n>g)||(u=g);let _=a>0,d=Number.NaN;_&&(d=function(e,t,s){let r=s/((1-t)*e*2),i=r*r;return s*(1-i*(.16666666666666666-.008333333333333333*i))}(e,t,a));let p=1===i.getCoordinateSystemType(),c=null;p||(c=i.getPECoordSys());let f=i.getTolerance(0),x=r.getStartXY(),P=r.getEndXY(),y=new b.P,E=new b.P;if(p)y.setCoordsPoint2D(x),y.scale(s),E.setCoordsPoint2D(P),E.scale(s);else{let e=[x.x,x.y,P.x,P.y];m.projToGeog(c,2,e),y.setCoords(e[0],e[1]),y.scale(s),E.setCoords(e[2],e[3]),E.scale(s)}let C=0,v=0,G=[],w=[],T=[];G.push(P.clone()),w.push(E.clone()),T.push(1),h.push(x.clone()),null!==o&&o.push(v);let N=i.isPannable(),D=x.clone(),V=[.5,.33333333333333337,.6666666666666666,.16666666666666669,.8333333333333333],F=5;l||(_?(V[0]=.5,V[1]=.25,V[2]=.75,F=3):F=1),(0,S.g)(u>0);let H=e=>{if(e=e.clone(),null!==c){let t=[e.x,e.y];m.projToGeog(c,1,t),e.setCoords(t[0],t[1])}return e.scale(s),e};for(;w.length>0;){let n=G.at(-1).clone();E.assign(w.at(-1));let a=T.at(-1),g=!1,x=Number.NaN,P=function(e,t,s,r,i,n,a,o){let h=[],l=(0,b.m)(Array,8),g=2,u=i.getCoord2D(n);l[0][0]=u.x,l[0][1]=u.y,u=i.getCoord2D(a),l[1][0]=u.x,l[1][1]=u.y;let _=e=>{if(null!==s){let t=m.projToGeog(s,e,l);(0,S.g)(t===e)}for(let e of l)e[0]*=r,e[1]*=r};_(2),h.push(R(e,t,new b.P(l[0][0],l[0][1]))),h.push(R(e,t,new b.P(l[1][0],l[1][1])));let d=I.h.distance(h[0],h[1]);if(d>o)return d;let p=0;for(g=3;g<=17;){let s=1/(g-1),r=0;for(let e=1;e<g;++e)if(1&e){let t=(0,b.q)(n,a,e*s);i.queryCoord2D(t,u),l[r][0]=u.x,l[r][1]=u.y,r++}_(r);let m=1;for(let s=0;s<r;++s)h.splice(m,0,R(e,t,new b.P(l[s][0],l[s][1]))),m++;let c=h[m=0];m++;let f=0;for(;m!==h.length;++m){let e=h[m];f+=I.h.distance(c,e),c=e}if(f>o)return f;if(p=f-d,(0,S.g)(p>=0||Math.abs(p)<1e-14*f),p<0&&(p=0),d=f,f+p<=o)return f+p;g=2*g-1}return d+p}(e,t,c,s,r,v,a,u),k=u>=P&&Math.abs(y.y-E.y)<.9*Math.PI;p&&k&&(k=Math.abs(y.x-E.x)<.9*Math.PI);let A=new b.P,M=new b.P,U=!1;if(!_&&k&&k&&(U=!0),r.calculateSubLength(v,a)<=f&&(U=!0),!U)for(let o=0;o<F;o++){let h=(0,b.q)(v,a,V[o]),m=new b.P;r.queryCoord2D(h,m);let u=H(m);if(0===o&&(x=h,A.setCoordsPoint2D(m),M.setCoordsPoint2D(u),!k)||((0,S.g)(_),p&&Math.abs(y.x-u.x)>=Math.PI)){g=!0;break}let c=new b.P,f=new b.P;l?f=H(b.P.lerp(D,n,V[o])):(m.clone(),f=u.clone());let P=function(e,t,s,r,i){let n=R(e,t,s),a=R(e,t,r);return L(e,t,I.h.lerp(n,a,i))}(e,t,y,E,V[o]),C=P.clone();if(p?(C.x/=s,C.y/=s):(C.x/=s,C.y/=s,sY(i.getGCSToSRTransform(),[C],1,[C],null)),C.isNAN()){let s=R(e,t,u),r=R(e,t,y),i=R(e,t,E),{first:n,second:a}=j(e,t,s,r,i,2,null);if(a>d){g=!0;break}}else{if(N){let e=i.getPannableExtent().width(),t=(0,b.q)(r.getStartX(),r.getEndX(),.5);for(;C.x<t-.5*e;)C.x+=e;for(;C.x>=t+.5*e;)C.x-=e}let s=r.getClosestCoordinateOnInterval(C,new b.E(v,a),-1),n=r.getCoord2D(s),o=function(e,t,s,r){let i=R(e,t,s),n=R(e,t,r);return I.h.distance(i,n)}(e,t,n=H(n),P);if(o>d){if(o<4*d){let s=R(e,t,n),r=R(e,t,y),i=R(e,t,E),{first:a,second:h}=j(e,t,s,r,i,2,null);o=h}if(o>d){g=!0;break}}else if(l){let s=R(e,t,u),r=R(e,t,y),i=R(e,t,E),{second:n}=j(e,t,s,r,i,3,null);if(n<=d){s=R(e,t,f);let{first:a,second:o}=j(e,t,s,r,i,3,null);n=o}if(n>d){g=!0;break}}}}g?(G.push(A.clone()),w.push(M.clone()),T.push(x)):(G.pop(),w.pop(),T.pop(),h.push(n.clone()),C+=P,null!==o&&o.push(C),D.setCoordsPoint2D(n),y.setCoordsPoint2D(E),v=a)}if(null!==o){let e=1/C;for(let t=0;t<o.length;t++)o[t]*=e}}(this.m_a,this.m_eSquared,this.m_rpu,g,this.m_sr,this.m_maxLength,this.m_maxDeviation,a?i:null,r),l&&s8(null,null,a?i:null,r),a?s7(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),e,g,i,r,t):s3(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),r,t)}return t}replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(e){let t=e.hasNonLinearSegments();if((!this.m_transform||this.m_transform.isIdentity())&&(e=rB(e,this.m_gcs),!t))return e;let s=e.createInstance();s.reserveParts(e.getPointCount(),e.getPathCount());for(let t=0,r=e.getPathCount();t<r;++t){let r=new C.M,i=e.getPathStart(t),n=e.getPathEnd(t);r.addPoints(e,i,n);let a=e.isClosedPath(t),o=!1;if(a&&n-i==1&&e.hasNonLinearSegmentsPath(t)){let t=new I.P;e.getPointByVal(i,t),r.add(t),o=!0}if(this.m_transform&&!this.m_transform.isIdentity()){if(a&&!o){let t=new I.P;e.getPointByVal(i,t),r.add(t)}if(r=(new sj).execute(r,this.m_transform,this.m_progressTracker),a&&r.getPointCount()>1){let e=r.getXY(0),t=r.getXY(r.getPointCount()-1);e.equals(t)&&r.removePoint(r.getPointCount()-1)}}r.getPointCount()>1&&(s.addPathMultiPoint(r,0,-1,!0),a&&s.closePathWithLine())}return s}}function s3(e,t,s,r){e&&r.insertPath2D(-1,null,0,0,!0);let i=r.getPathCount()-1;r.insertPointsFromPoints(i,-1,s,0,s.length-1,!0),t&&r.insertPoint2D(i,-1,s.at(-1))}function s7(e,t,s,r,i,n,a){a.reserve(a.getPointCount()+n.length-1);let o=new I.P;if(s.queryStart(o),e?a.startPathPoint(o):a.lineToPoint(o),n.length>2){let e=r.calculateLength2D();for(let t=1;t<n.length-1;t++){let s=r.lengthToT(i[t]*e);r.queryCoord(s,o),o.setXY(n[t]),a.lineToPoint(o)}}t&&(s.queryEnd(o),a.lineToPoint(o))}function s6(e,t,s,r,i,n,a,h,l,m,g,u,_){let d={stack:[],error:void 0,hasError:!1};try{let $=(0,v.b)(d,new o,!1),ee=(0,v.b)(d,new o,!1),et=(0,v.b)(d,new o,!1);p.geodeticDistance(e,t,r.x,r.y,i.x,i.y,et,$,ee,s);let es=et.val,er=$.val,ei=ee.val,en=er,ea=ei;en<0&&(en+=2*Math.PI),ea<0&&(ea+=2*Math.PI),l&&(l[0]=en),m&&(m[0]=ea);let eo=Number.NaN,eh=Number.NaN;if(null!==g){let s=c.q90(e,t),i=c.q(e,t,r.y);eo=(s-i)/es,eh=(s+i)/es}let el=s1(r,i),em=s2(r,i),eg=el||em,eu=(f=r,x=i,P=h,!(!ri(f,x,P)||nt(f.y,b.l)||nt(f.y,-b.l)||nt(x.y,b.l)||nt(x.y,-b.l))),e_=(0,v.b)(d,new b.S(new o,new o),!1),ed=new b.P,ep=new b.P,ec=new b.P;_[0]=re(r.x,Number.NaN,_[0]);let ef=_[0];if(es<=n){return u.push(r.clone()),_[0]=re(i.x,Number.NaN,_[0]),null!=g&&g.push(0),eg?(el&&rt(r,i,g,u),em&&rs(r,i,g,u)):eu?rr(r,i,er,eo,eh,g,u):a>0&&(ep.setCoords(r.x-ef,r.y),ed.setCoords(i.x-_[0],i.y),(0,S.g)(0),ef=0),u.push(i.clone()),es}let ex=1+Math.ceil(es/n),eP=es/(ex-1),ey=new b.P;u.push(r.clone()),ey.setCoordsPoint2D(r),ep.setCoords(r.x-_[0],r.y),null!==g&&g.push(0);for(let n=1;n<ex;n++){let o;if(n<ex-1){let i=n*eP;p.geodeticCoordinate(e,t,r.x,r.y,i,er,e_.at(0),e_.at(1),s),ed.setCoords(e_.at(0).val,e_.at(1).val),_[0]=re(ed.x,ey.x,_[0]),ec.setCoords(_[0]+ed.x,ed.y),o=n/(ex-1)}else _[0]=re(i.x,Number.NaN,_[0]),ed.setCoords(i.x-_[0],i.y),ec.setCoordsPoint2D(i),o=1;var f,x,P,y,E,C,I,G,w,T,N,D,V,F,H,k,A,M,U=void 0,q=void 0,O=void 0,B=void 0,R=void 0,Y=void 0,X=void 0,L=void 0,z=void 0,J=void 0,W=void 0,j=void 0,Z=void 0,K=void 0,Q=void 0;eg?(1===n&&el&&rt(r,ec,g,u),n===ex-1&&em&&rs(ey,i,g,u)):eu?ri(ey,ec,h)&&(r.x<i.x?ey.x>ec.x&&(_[0]+=2*Math.PI,ec.setCoords(_[0]+ed.x,ed.y)):ey.x<ec.x&&(_[0]-=2*Math.PI,ec.setCoords(_[0]+ed.x,ed.y)),rr(ey,ec,er,eo,eh,g,u)):a>0&&(0,S.g)(0),u.push(ec.clone()),null!=g&&g.push(o),ey.setCoordsPoint2D(ec),ep.setCoordsPoint2D(ed),ef=_[0]}return es}catch(e){d.error=e,d.hasError=!0}finally{(0,v.c)(d)}}function s8(e,t,s,r){if(r.reverse(),null!==s&&s.reverse(),e){let s=e[0],r=t[0];e[0]=r,t[0]=s}}function s9(e,t,s,r,i){e?(r.setCoordsPoint2D(s),i.setCoordsPoint2D(t)):(r.setCoordsPoint2D(t),i.setCoordsPoint2D(s))}function s5(e,t,s){return e?(s.create(t.getGeometryType()),t.copyTo(s.get()),s.get().reverse(),s.get()):t}function re(e,t,s){if(Number.isNaN(t)){for(;s-e>Math.PI;)s-=2*Math.PI;for(;e-s>Math.PI;)s+=2*Math.PI;return s}return s+e-t>Math.PI?s-=2*Math.PI:t-(s+e)>Math.PI&&(s+=2*Math.PI),s}function rt(e,t,s,r){if(e.y>0){let i=new b.P;i.setCoords(t.x,b.l),nt(e.x,i.x)||nt(t.y,i.y)||(r.push(i),null!==s&&s.push(0))}else{let i=new b.P;i.setCoords(t.x,-b.l),nt(e.x,i.x)||nt(t.y,i.y)||(r.push(i),null!==s&&s.push(0))}}function rs(e,t,s,r){if(t.y>0){let i=new b.P;i.setCoords(e.x,b.l),nt(t.x,i.x)||nt(e.y,i.y)||(r.push(i),null!==s&&s.push(1))}else{let i=new b.P;i.setCoords(e.x,-b.l),nt(t.x,i.x)||nt(e.y,i.y)||(r.push(i),null!==s&&s.push(1))}}function rr(e,t,s,r,i,n,a){if(function(e){return 0===e||3552713678800501e-30>=Math.abs(e)}(s)){if(b.l-e.y>0){let t=new b.P;t.setCoords(e.x,b.l),a.push(t),null!==n&&n.push(r)}if(b.l-t.y>0){let e=new b.P;e.setCoords(t.x,b.l),a.push(e),null!==n&&n.push(r)}}else{if(b.l+e.y>0){let t=new b.P;t.setCoords(e.x,-b.l),a.push(t),null!==n&&n.push(i)}if(b.l+t.y>0){let e=new b.P;e.setCoords(t.x,-b.l),a.push(e),null!==n&&n.push(i)}}}function ri(e,t,s){return Math.abs(Math.abs(e.x-t.x)-Math.PI)<=s}function rn(e,t,s,r){let i={stack:[],error:void 0,hasError:!1};try{let n=[s.x],a=[s.y-r],h=[s.x],l=[s.y+r];K(n,a),K(h,l);let m=(0,v.b)(i,new o,!1),g=(0,v.b)(i,new o,!1);return p.greatEllipticDistance(e,t,s.x,s.y,n[0],a[0],m,null,null),p.greatEllipticDistance(e,t,s.x,s.y,h[0],l[0],g,null,null),Math.min(m.val,g.val)}catch(e){i.error=e,i.hasError=!0}finally{(0,v.c)(i)}}function ra(e,t,s,r,i){let n=new E.J;s.queryEnvelope(n);let a=(0,I.b)(null,s,!0).total();if(t.xmin-n.xmin<=a&&n.xmax-t.xmax<=a)return s;let o=t.width(),h=0;for(;t.xmin+h*o<n.xmin;)h++;for(;t.xmin+h*o>n.xmin;)h--;let l=h*o,m=new G.T;m.setShiftCoords(-l,0),s.applyTransformation(m);let g=new E.J;s.queryEnvelope(g);let u=null;if(g.xmax>t.xmax){let r=0,n=new E.J;n.setCoords({env2D:t}),n.ymin-=1,n.ymax+=1;let a=s;for(;n.xmin<g.xmax;){g.xmax>n.xmax&&(a=rq(a,e,2,!0,n.xmax));let s=(0,I.e)(a,n),h=(0,I.a)(null,s,!0).total(),l=(0,w.c)(a,n,h,Number.NaN,i);null===u?u=l===a?l.clone():l:(m.setShiftCoords(-r*o,0),l.applyTransformation(m),u.add(l,!1)),r++,n.xmin=n.xmax,n.xmax=t.xmax+r*o}}else u=s;return u}class ro{constructor(e,t){var s;this.m_basisX=new I.h,this.m_basisY=new I.h,this.m_normal=new I.h,(0,S.g)(1===e.getCoordinateSystemType()),this.m_gcs=e;let r=iD();e.querySpheroidData(r),this.m_a=r.majorSemiAxis,this.m_e2=r.e2,this.m_rpu=e.getUnit().getUnitToBaseFactor(),this.m_curvCenterRad=t.mul(this.m_rpu);let i=this.m_curvCenterRad.x,n=this.m_curvCenterRad.y,a=Math.cos(i),o=Math.sin(i),h=Math.cos(n),l=Math.sin(n);this.m_cartCenter3D=(s=this.m_a,Y(s,this.m_e2,a,o,h,l,0)),this.m_normal.setCoordsPoint3D(this.m_cartCenter3D),this.m_d=this.m_cartCenter3D.length(),this.m_normal.divThis(this.m_d),I.h.selectRightHandedBasisFromNormal(this.m_normal,this.m_basisX,this.m_basisY),this.m_northPolePcs=this.projectPoint(b.P.construct(0,.5*Math.PI/this.m_rpu)),this.m_southPolePcs=this.projectPoint(b.P.construct(0,-(.5*Math.PI)/this.m_rpu))}project(e){let t=e.getGeometryType();if((0,S.i)(t))return(0,S.l)(e),this.projectMultiVertex(e);(0,S.t)("Gnomonic.project")}unproject(e,t,s){let r=e.getGeometryType();if((0,S.i)(r)){(0,S.l)(e);let i=e,n=[];if(r===S.G.enumPolygon){let e=i.getPathCount();for(let t=0;t<e;t++){let e=i.calculateRingArea2D(t);n.push(e)}}return this.unprojectMultiVertex(t,i),(0,S.h)(r)?(function(e,t,s){let r=e.getPannableExtent(),i=b.P.construct(0,0);r.centerAt(i);let n=r.width(),a=.5*n,o=new b.P;o.setNAN();let h=Number.NaN;for(let e=0;e<s.getPathCount();e++)for(let t=s.getPathStart(e);t<s.getPathEnd(e);t++){var l,m,g,u,_;let i=s.getXY(t),d=nt(i.y,r.ymax)||nt(r.ymin,i.y);t===s.getPathStart(e)?(o.setNAN(),h=0):o.isNAN()||d||(l=i.x,m=o.x,g=a,u=n,(_=h)+l-m>g?_-=u:m-(_+l)>g&&(_+=u),h=_),i.x+=h,s.setXY(t,i),d||o.setCoordsPoint2D(i)}s.getImpl().notifyModifiedFlags(2001)}(this.m_gcs,0,i),function(e,t,s,r,i){let n=r.getGeometryType(),a=t.getPannableExtent(),o=r,h=!1,l=!1;if(n===S.G.enumPolygon){let s=new E.J,r=b.P.construct(0,0);s.setCoords({env2D:a}),s.centerAt(r),h=function(e,t,s,r,i){let n=function(e,t){let s=new E.J;t.queryEnvelope(s);let r=nt(e.ymax,s.ymax),i=nt(e.ymin,s.ymin),n=r||i;return!!n&&(function(e,t){let s=new C.a,r=new E.J;for(let i=0;i<t.getPathCount();i++){t.queryPathEnvelope(i,r);let n=nt(e.ymax,r.ymax),a=nt(e.ymin,r.ymin);if(!(n||a)){s.addPath(t,i,!0);continue}s.insertPath2D(-1,null,0,0,!0);let o=t.getPathStart(i),h=t.getPathEnd(i),l=h-o,m=-1;for(m=o;m<h;m++){let s=t.getXY(m);if(n=nt(e.ymax,s.y),a=nt(e.ymin,s.y),!n&&!a)break}let g=m,u=!1,_=Number.NaN;do{let r=t.getXY(g);n=nt(e.ymax,r.y),a=nt(e.ymin,r.y);let h=o+(g+1-o)%l;if(n||a){let n=b.P.construct(_,r.y);s.insertPoint2D(i,-1,n);let a=t.getXY(h),o=nt(e.ymax,a.y),l=nt(e.ymin,a.y);o||l||(n=b.P.construct(a.x,r.y),u?s.setXY(s.getPointCount()-1,n):s.insertPoint2D(i,-1,n)),u=!0}else s.insertPoint2D(i,-1,r),_=r.x,u=!1;g=h}while(g!==m)}t.setEmpty(),t.add(s,!1)}(e,t),n)}(s,r),a=function(e,t,s,r,i){let n=[],a=[],o=.5*s.width();for(let h=0;h<r.getPathCount();h++){let l=r.getXY(r.getPathStart(h)),m=r.getXY(r.getPathEnd(h)-1),g=e[h]<0;if(Math.abs(l.x-m.x)>o){let e=function(e,t,s,r,i,n){let a,o,h=new C.a,l=new C.a,m=new G.T,g=i.getXY(i.getPathStart(r)),u=i.getXY(i.getPathEnd(r)-1),_=s.width(),d=.5*_,p=new E.J;i.queryEnvelope(p);let c=Math.ceil(p.width()/_)+1;g.x>u.x?(a=-_,o=e?s.ymin:s.ymax):(a=_,o=e?s.ymax:s.ymin),m.setShiftCoords(a,0),h.addPath(i,r,!0),l.add(h,!1);let f=new I.P;for(let e=0;e<c;e++)l.applyTransformation(m),l.getPointByVal(0,f),h.lineToPoint(f),h.addSegmentsFromPath(l,0,0,l.getSegmentCount()-1,!1);let x=h.getXY(0),P=h.getXY(h.getPointCount()-1);x.y=o,P.y=o,h.lineTo(P);let y=new b.P;for(y.setCoordsPoint2D(P),y.x-=.5*a;Math.abs(y.x-x.x)>d;)h.lineTo(y),y.x-=.5*a;h.lineTo(x);let S=s.getCenter().x,v=new E.J;h.queryEnvelope(v);let T=0,N=v.getCenter().x;N-S>d?T=-Math.ceil((N-S-d)/_):S-N>d&&(T=Math.ceil((S-N-d)/_)),0!==T&&(m.setShiftCoords(T*_,0),h.applyTransformation(m));let D=new C.E,V=D.addGeometry(h);rO(D,V,t,0,2,!0,s.xmin),rO(D,V,t,0,2,!0,s.xmax);let F=D.getGeometry(V),H=(0,I.e)(F,s);H.inflateCoords(0,1);let k=(0,I.a)(null,H,!0);return(0,w.c)(F,s,k.total(),Number.NaN,n)}(g,t,s,h,r,i);n.push(e),a.push(h)}else if(!g&&0>r.calculateRingArea2D(h)){let e=function(e,t,s,r,i){let n=t.width(),a=.5*n,o=t.getCenter().x,h=new E.J;r.queryPathEnvelope(s,h);let l,m=0,g=h.getCenter().x;if(g-o>a?m=-Math.ceil((g-o-a)/n):o-g>a&&(m=Math.ceil((o-g-a)/n)),0!==m){let e=new G.T;e.setShiftCoords(m*n,0),r.getImpl().applyTransformationToPath(e,s),r.queryPathEnvelope(s,h),g=h.getCenter().x}let u=new E.J;t.containsExclusiveEnvelope(h)?(l=!1,u.setCoords({env2D:t})):(l=!0,u.setCoords({env2D:t}),u.xmin-=n,u.xmax+=n);let _=r.createInstance();_.addPathPoint2D(null,0,!0);let d=new b.P;if(d.setCoords(u.xmin,u.ymin),_.insertPoint2D(0,-1,d),d.setCoords(u.xmin,u.ymax),_.insertPoint2D(0,-1,d),d.setCoords(.5*(u.xmin+u.xmax),u.ymax),_.insertPoint2D(0,-1,d),d.setCoords(u.xmax,u.ymax),_.insertPoint2D(0,-1,d),d.setCoords(u.xmax,u.ymin),_.insertPoint2D(0,-1,d),d.setCoords(.5*(u.xmin+u.xmax),u.ymin),_.insertPoint2D(0,-1,d),l){_.addPath(r,s,!0);let a=new G.T;g<o?a.setShiftCoords(n,0):a.setShiftCoords(-n,0),r.getImpl().applyTransformationToPath(a,s),_.addPath(r,s,!0);let h=new C.E,l=h.addGeometry(_);rO(h,l,e,0,2,!0,t.xmin),rO(h,l,e,0,2,!0,t.xmax),_=h.getGeometry(l);let m=(0,I.e)(_,t);m.inflateCoords(0,1);let u=(0,I.a)(null,m,!0).total();_=(0,w.c)(_,t,u,Number.NaN,i)}else _.addPath(r,s,!0);return _}(t,s,h,r,i);n.push(e),a.push(h)}}if(0===n.length)return!1;let h=new C.a({vd:r.getDescription()}),l=0,m=a[0];for(let e=0;e<r.getPathCount();e++)e===m?(h.add(n[l],!1),++l<a.length&&(m=a[l])):h.addPath(r,e,!0);return r.setEmpty(),r.add(h,!1),!0}(e,t,s,r,i);return n||a}(e,t,s,o,i);let n=function(e,t,s,r){let i=new E.J;s.queryEnvelope(i);let n=(0,I.b)(null,s,!0).total();if(t.xmin-i.xmin<=n&&i.xmax-t.xmax<=n)return s;let a=s.createInstance(),o=s.createInstance(),h=new E.J,l=s.getPathCount();for(let i=0;i<l;i++)s.queryPathEnvelope(i,h),t.xmin-h.xmin<=n&&h.xmax-t.xmax<=n?a.addPath(s,i,!0):(o.setEmpty(),o.addPath(s,i,!0),o=ra(e,t,o,!0,r),a.add(o,!0));return a}(t,s,o,i);n!==o&&(l=!0),o=n}else o=(new sj).foldInto360RangeGeodetic(o,t,2);n===S.G.enumPolygon&&(h||l)&&(o=(new sM).execute(o,t,!1,i)),o!==r&&(r.setEmpty(),r.add(o,!1))}(n,this.m_gcs,0,i,s)):i=rH(i,this.m_gcs,0,!0,0,s),i}(0,S.t)("Gnomonic.unproject")}projectPoint(e){let t=e.mul(this.m_rpu),s=R(this.m_a,this.m_e2,t),r=this.m_normal.dotProduct(s);if(r<=0)return b.P.construct(Number.NaN,Number.NaN);let i=this.m_d/r,n=s.mul(i).sub(this.m_cartCenter3D),a=new b.P;return a.x=this.m_basisX.dotProduct(n),a.y=this.m_basisY.dotProduct(n),a}unprojectPoint(e){let t=this.m_cartCenter3D.add(this.m_basisX.mul(e.x).add(this.m_basisY.mul(e.y)));return L(this.m_a,this.m_e2,t).divide(this.m_rpu)}projectMultiVertex(e){let t=e.getImpl(),s=!0,r=new b.P,i=new b.P;for(let e=0,n=t.getPointCount();e<n;e++)t.queryXY(e,r),r.y*this.m_rpu>.5*Math.PI?i.assign(this.m_northPolePcs):r.y*this.m_rpu<-(.5*Math.PI)?i.assign(this.m_southPolePcs):i.assign(this.projectPoint(r)),t.setXY(e,i),i.isNAN()&&(s=!1);return t.notifyModifiedFlags(2001),s}unprojectMultiVertex(e,t){let s=t.getImpl(),r=e*e,i=!this.m_northPolePcs.isNAN(),n=!this.m_southPolePcs.isNAN();for(let e=0,t=s.getPointCount();e<t;e++){let t=s.getXY(e),a=new b.P;i&&b.P.sqrDistance(t,this.m_northPolePcs)<=r?(a.setCoords(this.m_curvCenterRad.x,.5*Math.PI),a.scale(1/this.m_rpu)):n&&b.P.sqrDistance(t,this.m_southPolePcs)<=r?(a.setCoords(this.m_curvCenterRad.x,-(.5*Math.PI)),a.scale(1/this.m_rpu)):a=this.unprojectPoint(t),s.setXY(e,a)}s.notifyModifiedFlags(2001)}}function rh(e,t,s,r,i,n){let a=t.getAttributeStreamRef(0),o=t.getPointCount(),h=!1,l=new b.P;for(let e=0;e<o;++e)if(a.queryPoint2D(2*e,l),1&n&&l.y>=s||2&n&&l.y<=-s){h=!0;break}if(!h)return!1;let m=!1;e&&(m=t.getImpl().isClosedPathInXYPlane(0));let g=new C.E,u=g.addGeometry(t),_=g.getFirstPath(u),d=-1,p=!0,c=new b.P,f=new I.P,x=C.n,P=rl*i/360;for(let e=g.getFirstVertex(_);e!==C.n;e=g.getNextVertex(e)){g.queryXY(e,l);let t=1&n&&l.y>=s?1:0;if(t|=2&n&&l.y<=-s?2:0,d>0&&d!==t){if(c.x!==l.x){let t=g.getPrevVertex(e);g.queryPoint(t,f);let s=g.insertVertex(_,e,f);c.x=l.x,g.setXY(s,c)}if(m){let t=x!==C.n?g.getNextVertex(x):g.getFirstVertex(_),s=g.getPrevVertex(e);for(;t!==s;)t=g.removeVertex(t,!1);if(x!==C.n){let e=g.getXY(x),t=g.getXY(s);if(Math.abs(e.x-t.x)>P){g.queryPoint(x,f);let r=g.insertVertex(_,s,f);e.x=(0,b.q)(e.x,t.x,.5),g.setXY(r,e)}}}x=C.n}if(t&&(l.y=(0,b.f)(r,l.y),g.setXY(e,l),!p&&d!==t))if(l.x!==c.x){g.queryPoint(e,f);let t=g.insertVertex(_,e,f);g.setXYCoords(t,c.x,l.y),x=t}else x=e;d=t,c.assign(l),p=!1}if(m){if(x!==C.n){let e=g.getNextVertex(x);for(;e!==C.n;)e=g.removeVertex(e,!1)}let e=g.getFirstVertex(_),t=g.getLastVertex(_),s=g.getXY(e),r=g.getXY(t);if(!s.equals(r)&&(g.queryPoint(e,f),t=g.insertVertex(_,C.n,f),Math.abs(s.x-r.x)>P)){let e=g.insertVertex(_,t,f);s.x=(0,b.q)(s.x,r.x,.5),g.setXY(e,s)}}return t.assignCopy(g.getGeometry(u)),!0}let rl=210;class rm{constructor(e,t,s,r,i,n,a,o,h){this.m_bAdjustedAtPoles=0,this.m_inputPoly=s,this.m_progressTracker=h,this.m_originalGeometry=e,this.m_originalSR=r,this.m_polygonRingFlags=t,this.m_pannableSR=i,this.m_poleSnappingTolerance=o,this.m_poleFlags=a,this.m_bAdjustedAtPoles=0,this.m_pannableExtent=function(e,t){let s=e.getPannableExtent();return Number.isNaN(t)||s.centerAtCoords(t,0),s}(this.m_pannableSR,n),this.m_centralLongitude=Number.isNaN(n)?this.m_pannableExtent.getCenterX():n,this.m_width360=this.m_pannableExtent.width(),this.m_degree=this.m_width360/360,this.m_GCSLargeDelta=rl*this.m_degree,(0,S.g)(null===this.m_originalGeometry&&null===this.m_originalSR||null!==this.m_originalGeometry&&null!==this.m_originalSR)}geonormalizeRing(e,t,s,r,i,n,a){let o=s,h=new C.P({vd:this.m_inputPoly.getDescription()});h.addPath(this.m_inputPoly,e,!0),0!==this.m_poleFlags&&(this.m_bAdjustedAtPoles|=!!rh(!0,h,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,this.m_pannableExtent.width(),this.m_poleFlags),this.m_bAdjustedAtPoles&&(o=!1));let l=-1;o&&(l=this.m_originalGeometry.getPathStart(e));let m=h.getAttributeStreamRef(0),g=h.getPointCount(),u=0,_=m.read(0),d=0,p=3*this.m_pannableSR.getTolerance(0),c=!1,f=new b.P,x=new b.P,P=!1,y=h.hasNonLinearSegments(),E=new b.P;for(let e=1;e<g;++e){m.queryPoint2D(2*e,E);let t=E.x,s=t+u,i=s-_;if(E.x=s,Math.abs(i)>this.m_GCSLargeDelta){if(o){let t=l+e-1,s=l+(e+1<g?e:0),a=n.read(2*t);Math.abs(i-(n.read(2*s)-a)*r)>+this.m_degree&&(o=!1)}o||(u-=(0,b.f)(this.m_width360,s-_),s=t+u,++d,P=0!==u,E.x=s)}else c||(0,I.L)(f,x,E,p)&&(c=!0);P&&(y&&(0,S.c)("error in geonormalize_ring_ for curves"),m.write(2*e,s)),_=s,f.setCoordsPoint2D(x),x.setCoordsPoint2D(E)}d&&h.notifyModified();let v=h.getXY(0),G=h.getXY(g-1);if(b.P.distance(v,G)<p){let e=this.finalizeGeoNormalizeClosedRing(h,c,i);a.add(e,!1)}else{t<0&&(null!==this.m_originalGeometry?((0,S.g)(null!==this.m_originalGeometry),t=+(this.m_originalGeometry.calculateRingArea2D(e)>0)):t=1);let s=this.finalizeGeoNormalizeOpenedRing(t>0,h);a.add(s,!1)}}geoNormalizePolygonGeometry(e){(0,S.g)(this.m_originalSR&&this.m_originalGeometry||!this.m_originalGeometry&&!this.m_originalSR),(0,S.g)(this.m_pannableSR.isPannable());let t=null,s=Number.NaN,r=!!this.m_originalSR&&this.m_originalSR.isPannable();r&&(t=this.m_originalGeometry.getAttributeStreamRef(0),s=this.m_width360/this.m_originalSR.getPannableExtent().width()),this.m_bAdjustedAtPoles=0;let i=new C.a({vd:this.m_inputPoly.getDescription()});for(let n=0,a=this.m_inputPoly.getPathCount();n<a;++n){let a=this.m_polygonRingFlags?+!!this.m_polygonRingFlags[n]:-1;this.geonormalizeRing(n,a,r,s,e,t,i)}let n=this.m_pannableSR.getTolerance(0),a=this.m_pannableExtent.width()/180;rL(i,this.m_pannableExtent,.1*n,!1);let o=E.J.constructEmpty();if(o.setCoords({env2D:this.m_pannableExtent}),e){let e=!0;for(let t=0;t<2;t++){e=!0;let t=E.J.constructEmpty();for(let s=0,r=i.getPathCount();s<r;s++)if(i.queryPathEnvelope(s,t),!(o.xmin<=t.xmin&&o.xmax>=t.xmax||t.xmin>=o.xmax||t.xmax<=o.xmin)){e=!1;break}if(e)break;o.move(.5*this.m_width360,0)}e||o.setCoords({env2D:this.m_pannableExtent})}let h=(0,w.c)(i,o,n,a,this.m_progressTracker),l=i!==h,m=this.m_originalGeometry?this.m_originalGeometry.calculateArea2D():1,g=h.calculateArea2D(),u=0;if(g>0&&m<0)u=1;else if(g<=0&&m>0)if(0===g){if(this.m_originalSR){let e=Number.NaN;2===this.m_originalSR.getCoordinateSystemType()?e=this.m_originalSR.getPCSHorizon().calculateArea2D():1===this.m_originalSR.getCoordinateSystemType()&&(e=this.m_originalSR.getPannableExtent().getArea()),m>.99*e&&(u=-1)}}else u=-1;if(0!==u){let e=function(e,t){let s=new C.a({vd:e});s.addEnvelope(t,!1);let r=t.width()/180;return(new T.O).execute(s,r,0,0,null)}(h.getDescription(),o);e.add(h,!1),l=!0,h=e}return l&&(h=(new sM).execute(h,this.m_pannableSR,!1,this.m_progressTracker)),h}geoNormalizePolylineGeometry(e){(0,S.g)(this.m_pannableSR.isPannable());let t=null,s=this.m_originalSR&&this.m_originalSR.isPannable(),r=1;s&&((0,S.g)(this.m_originalGeometry),r=this.m_width360/this.m_originalSR.getPannableExtent().width(),t=this.m_originalGeometry.getAttributeStreamRef(0));let i=this.m_pannableExtent.width(),n=i*(0,b.N)()*4,a=e,o=Number.NaN,h=b.E.constructEmpty();this.m_bAdjustedAtPoles=0;let l=new C.P({vd:this.m_inputPoly.getDescription()});for(let e=0,m=this.m_inputPoly.getPathCount();e<m;++e){let m=s,g=new C.P({vd:this.m_inputPoly.getDescription()});g.addPath(this.m_inputPoly,e,!0);let u=this.m_inputPoly.isClosedPath(e);0!==this.m_poleFlags&&(this.m_bAdjustedAtPoles|=!!rh(u,g,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,i,this.m_poleFlags),this.m_bAdjustedAtPoles&&(m=!1));let _=-1,d=g.getPointCount(),p=!1;m&&(_=this.m_originalGeometry.getPathStart(e),p=this.m_originalGeometry.isClosedPath(e));let c=g.getAttributeStreamRef(0),f=0,x=c.read(0),P=0,y=new b.P,I=new b.P,v=!1,w=g.hasNonLinearSegments(),T=new b.P;for(let e=1;e<d;++e){c.queryPoint2D(2*e,T);let s=T.x,i=s+f,n=i-x;if(T.x=i,Math.abs(n)>this.m_GCSLargeDelta){if(m){let s=_+e-1,i=_;(!p||e+1<d)&&(i+=e);let a=t.read(2*s);Math.abs(n-(t.read(2*i)-a)*r)>+this.m_degree&&(m=!1)}m||(f-=(0,b.f)(this.m_width360,i-x),i=s+f,++P,v=0!==f,T.x=i)}v&&(w&&(0,S.c)("error in geonormalize_ring_ for curves"),c.write(2*e,i)),x=i,y.setCoordsPoint2D(I),I.setCoordsPoint2D(T)}if(P&&g.notifyModified(),a){let e=!1;if(!g.isEmpty()){let t=E.J.constructEmpty();if(g.queryEnvelope(t),t.width()>=i||t.ymin<=this.m_pannableExtent.ymin||t.ymax>=this.m_pannableExtent.ymax)e=!0;else{if(Number.isNaN(o)){let e=this.m_centralLongitude-.5*i;(o=t.xmin+Math.round((e-t.xmin)/i)*i)>e&&(o-=i),(0,S.g)(o<=e),o<e&&(o+=i),(0,S.g)(o>=e)}let s=Math.round((o-t.xmin)/i)*i;if(t.xmin+s>o+n&&(s-=i),t.xmin+s<o-n&&(s+=i),h.mergeCoordinate(t.xmin+s),h.mergeCoordinate(t.xmax+s),!(e=h.width()>=i)){let e=new G.T;e.setShiftCoords(s,0),g.applyTransformation(e)}}}l.add(g,!1),e&&(l=(()=>{let e=new C.P({vd:l.getDescription()});for(let t=0,s=l.getPathCount();t<s;++t){let s=new C.P({vd:l.getDescription()});s.addPath(l,t,!0);let r=rH(s,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);e.add(r,!1)}return e})(),a=!1)}else{let e=rH(g,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);l.add(e,!1)}}if(a)return l;let m=this.m_pannableSR.getTolerance(0),g=this.m_pannableExtent.width()/180;return rL(l,this.m_pannableExtent,.1*m,!1),(0,w.c)(l,this.m_pannableExtent,m,g,this.m_progressTracker)}finalizeGeoNormalizeOpenedRing(e,t){let s=t.getPointCount(),r=t.getXY(0),i=t.getXY(s-1);{let e=Math.abs(i.x-r.x),t=Math.round(e/this.m_width360)*this.m_width360;(0,S.g)(Math.abs(e-t)<this.m_pannableSR.getTolerance(0))}let n=(0,b.e)(i.x-r.x),a=E.J.constructEmpty();t.queryLooseEnvelope(a);let o=this.m_pannableExtent.getCenterX(),h=0,l=o-this.m_width360,m=o+this.m_width360;if(n>=0){let e=Math.ceil((l-a.xmin)/this.m_width360);for(e*=this.m_width360;l>a.xmin+e;)e+=this.m_width360;for(;l<a.xmax+e;)e-=this.m_width360;for(h=e,a.width()>720&&(m=l+360*Math.ceil(a.width()/360));m<a.xmax;)m+=this.m_width360}else{let e=Math.ceil((m-a.xmax)/this.m_width360);for(e*=this.m_width360;m<a.xmax+e;)e-=this.m_width360;for(;m>a.xmin+e;)e+=this.m_width360;for(h=e,a.width()>720&&(l=m-360*Math.ceil(a.width()/360));l>a.xmin;)l-=this.m_width360}let g=Math.round(Math.abs(i.x-r.x)/this.m_width360)*this.m_width360,u=n*g,_=a.clone();_.move(h,0);let d=new b.P(0,0),p=new G.T;p.setShiftCoords(h,0),t.applyTransformation(p);let c=new C.P({vd:t.getDescription()});c.add(t,!1),d.assign(t.getXY(s-1));let f=0,x=c.getXY(0).x;for(;n>0?_.xmax<m:_.xmin>l;)_.move(u,0),p.xd=u,t.applyTransformation(p),x+=u,this.m_pannableExtent.xmin<=x&&this.m_pannableExtent.xmax>=x&&(f=c.getPointCount()-1),t.setXY(0,d),d.assign(t.getXY(s-1)),c.addSegmentsFromPath(t,0,0,s-1,!1);let P=new C.a({vd:c.getDescription()});P.add(c,!1);let y=c.getXY(0),I=c.getXY(c.getPointCount()-1),v=P.getPointCount()-1;if(n<0?e:!e){let e=new b.P(I.x,this.m_pannableExtent.ymax);P.lineTo(e);let t=new b.P(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymax);P.lineTo(t);let s=new b.P(y.x,this.m_pannableExtent.ymax);P.lineTo(s)}else{let e=new b.P(I.x,this.m_pannableExtent.ymin);P.lineTo(e);let t=new b.P(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymin);P.lineTo(t);let s=new b.P(y.x,this.m_pannableExtent.ymin);P.lineTo(s)}if(P.interpolateAttributesPath(0,v,0),P.getImpl().changeRingStartPoint(f),g>this.m_width360){let e=new C.a({copy:P});p.setShiftCoords(this.m_width360,0),e.applyTransformation(p),P.add(e,!1)}return P}finalizeGeoNormalizeClosedRing(e,t,s){let r=new C.a({vd:e.getDescription()});if(r.add(e,!1),r.hasNonLinearSegments()&&(()=>{let e=r.getPointCount()-2;return r.getSegmentType(e)!==S.G.enumLine})()){let e=new C.S,t=r.getPointCount()-2;r.getSegmentBuffer(t,e,!1),r.removePointFromPath(0,t+1),r.closeLastPathWithSegment(e.get())}else r.removePointFromPath(0,r.getPointCount()-1);let i=E.J.constructEmpty();r.queryLooseEnvelope(i);let n=Math.ceil((this.m_pannableExtent.xmin-i.xmin)/this.m_width360);for(n*=this.m_width360;this.m_pannableExtent.xmin>i.xmin+n;)n+=this.m_width360;for(;this.m_pannableExtent.xmin<i.xmax+n;)n-=this.m_width360;if(0!==(n+=this.m_width360)){i.move(n,0);let e=new G.T;e.setShiftCoords(n,0),r.applyTransformation(e)}if(this.m_pannableExtent.xmin<=i.xmin&&this.m_pannableExtent.xmax>=i.xmax){let e;if(t){let e=r.calculateArea2D(),t=(new sM).execute(r,this.m_pannableSR,!0,this.m_progressTracker);if(t!==r){let s=t.calculateArea2D();(0,b.e)(e)!==(0,b.e)(s)&&t.reverseAllPaths(),r.assignMove(t)}}if(e=new C.a(s?{copy:r}:{move:r}),s)for(;i.xmin<this.m_pannableExtent.xmax;){i.move(this.m_width360,0);let t=new G.T;t.setShiftCoords(this.m_width360,0),r.applyTransformation(t),e.add(r,!1)}return e}let a=new C.a({vd:e.getDescription()});a.add(r,!1);let o=t||i.width()>this.m_width360-10*this.m_pannableSR.getTolerance(0);for(;i.xmin<this.m_pannableExtent.xmax;){i.move(this.m_width360,0);let e=new G.T;e.setShiftCoords(this.m_width360,0),r.applyTransformation(e),a.add(r,!1)}if(o){let e=a.calculateArea2D();a.setFillRule(1);let t=(a=(new sM).execute(a,this.m_pannableSR,!0,this.m_progressTracker)).calculateArea2D();(0,b.e)(e)!==(0,b.e)(t)&&a.reverseAllPaths()}return a}geonormalize_ring_(e,t,s,r,i,n,a){(0,S.g)(0)}}function rg(e){(0,S.g)(0);let t=function(e){let t=new ii({},!0);return t.m_WKID=e,t}(e),s=new r_;return s.setVertProj_(t),s}function ru(e){var t;return!1}class r_{constructor(){this.m_hashCode=0,this.m_peVertSysVal=null,this.m_verticalUnit=new iv,this.m_verticalShift=0,this.m_userVerticalWKID=0,this.m_bIsDepth=!1}getType(){return(0,S.g)(0),0}getID(){return(0,S.g)(0),0}getLatestID(){return this.m_peVertSysVal?this.m_peVertSysVal.getLatestID():0}getOldID(){return this.m_peVertSysVal?this.m_peVertSysVal.getOldID():0}getText(){return(0,S.g)(0),""}getTextExtended(e){return(0,S.g)(0),""}getText2(e){return(0,S.g)(0),""}getUnit(){return(0,S.g)(0),{}}equals(e){return(0,S.g)(0),!1}equalForProjection(e){return(0,S.g)(0),!1}getPeVertcsCopy(){return(0,S.g)(0),{}}getOneMeter(){return 1/this.m_verticalUnit.getUnitToBaseFactor()}getUnitToBaseFactor(){return(0,S.g)(0),0}isDepth(){return(0,S.g)(0),!1}getVerticalShift(){return(0,S.g)(0),0}isCustomWkid(){return!!this.m_peVertSysVal&&this.m_peVertSysVal.isCustomWkid()}getHashCode(){return this.m_hashCode}setVertProj_(e){this.m_peVertSysVal=e}getPEVerticalCoordSys(){return this.m_peVertSysVal?this.m_peVertSysVal.m_peVertcs:null}}function rd(e,t,s,r,i){if(e.equals(t))return!1;if(r){let s=1,n=0,a=1,o=1,h=0,l=1;Number.isNaN(e.m_heightMetersPerUnit)||(s=e.m_heightMetersPerUnit,n=e.m_heightZ0,a=e.m_heightSign,o=t.m_heightMetersPerUnit,h=t.m_heightZ0,l=t.m_heightSign);let m=a*l*s/o;for(let e=0;e<i;e++)r[e]=(r[e]-n)*m+h}let n=1,a=0;if(Number.isNaN(e.m_XYToRadians)||(n=e.m_XYToRadians/t.m_XYToRadians,0!=(a=e.m_PrimeMeridianDegrees-t.m_PrimeMeridianDegrees)&&(a=(0,C.b)(a)/t.m_XYToRadians)),Array.isArray(s))for(let e=0;e<i;e++)s[e][0]=s[e][0]*n+a,s[e][1]=s[e][1]*n;else for(let e=0;e<i;e++){let t=e<<1;s[t]=s[t]*n+a,s[t+1]=s[t+1]*n}return!0}function rp(){return{m_heightMetersPerUnit:0,m_heightSign:0,m_heightZ0:0,m_XYToRadians:0,m_PrimeMeridianDegrees:0,assign(e){this.m_heightMetersPerUnit=e.m_heightMetersPerUnit,this.m_heightSign=e.m_heightSign,this.m_heightZ0=e.m_heightZ0,this.m_XYToRadians=e.m_XYToRadians,this.m_PrimeMeridianDegrees=e.m_PrimeMeridianDegrees},equals(e){return(0,b.a3)(this.m_heightSign,e.m_heightSign)&&(0,b.a3)(this.m_heightMetersPerUnit,e.m_heightMetersPerUnit)&&(0,b.a3)(this.m_heightZ0,e.m_heightZ0)&&(0,b.a3)(this.m_XYToRadians,e.m_XYToRadians)&&(0,b.a3)(this.m_PrimeMeridianDegrees,e.m_PrimeMeridianDegrees)},initFromGcsAndVcsPe(e,t){this.m_heightSign=1,this.m_heightMetersPerUnit=Number.NaN,this.m_heightZ0=0,this.m_XYToRadians=Number.NaN,this.m_PrimeMeridianDegrees=Number.NaN,t&&(0,S.g)(0),e&&(this.m_XYToRadians=e.getUnit().getUnitFactor(),this.m_PrimeMeridianDegrees=e.getPrimem().getLongitude())},initFromGcsAndVcs(e,t){let s=e?e.getPECoordSys():null,r=t?t.getPEVerticalCoordSys():null;this.initFromGcsAndVcsPe(s,r)},processUnitParams(e){Number.isNaN(this.m_heightMetersPerUnit)&&(this.m_heightMetersPerUnit=e.m_heightMetersPerUnit,this.m_heightSign=e.m_heightSign,this.m_heightZ0=e.m_heightZ0),Number.isNaN(this.m_XYToRadians)&&(this.m_XYToRadians=e.m_XYToRadians,this.m_PrimeMeridianDegrees=e.m_PrimeMeridianDegrees)}}}class rc{constructor(e){this.m_constantsLoaded=-1,this.m_isUsable=-1,this.m_inputSR=null,this.m_outputSR=null,this.m_inputSRHorz=null,this.m_outputSRHorz=null,this.m_inputVCS=null,this.m_outputVCS=null,this.m_hashCode=0,this.m_areaOfUse=new I.E,this.m_inputUnitParams=rp(),this.m_outputUnitParams=rp(),(0,S.g)(e),this.m_geogTran=e,this.m_vertTran=null,this.m_latestID=h.getCode(this.m_geogTran),this.m_latestID<0&&(this.m_latestID=0);let t=this.m_geogTran.getGeogcs1();h.getCode(t);let s=this.m_geogTran.getGeogcs2();h.getCode(s),this.initUnitParams()}getLatestId(){return this.m_latestID}getText(){return this.m_geogTran?this.m_geogTran.toString():((0,S.g)(0),"")}getGeogtran(){return this.m_geogTran}getVerttran(){return null}loadConstants(e){let t=this.m_constantsLoaded;if(-1===t){if(!e){this.m_geogTran||(0,S.c)("vcs not impl");let t=this.m_geogTran.getParameters();null!==t[l.PE_PARM_ND]&&(e=0===t[l.PE_PARM_ND].getValue())}t=+!!this.m_geogTran.loadConstants(),this.m_constantsLoaded=t}return 0!==t}isUsable(){let e=this.m_isUsable;return -1===e&&(this.m_geogTran?this.m_isUsable=e=+!!this.m_geogTran:this.m_isUsable=e=+!!this.m_vertTran),1===e}getInputSr(e){return this.updateSrs(),e?this.m_inputSR:this.m_inputSRHorz}getOutputSr(e){return this.updateSrs(),e?this.m_outputSR:this.m_outputSRHorz}getHashCode(){let e=this.m_hashCode;return 0===e&&(0===(e=this.m_latestID>0?(0,b.ar)(this.m_latestID):(0,b.aw)(this.getText()))&&(e=345),this.m_hashCode=e),e}isGeogtran(){return null!==this.m_geogTran}prepareOrThrow(){}getName(){return this.isGeogtran()?this.getGeogtran().getName():((0,S.b)("vcs not impl"),"")}updateSrs(){let e,t,s,r,i,n;if(!this.m_inputSR&&!this.m_inputVCS){if(this.m_geogTran){let a=this.m_geogTran.getGeogcs1(),o=iP(a),h=this.m_geogTran.getGeogcs2(),l=iP(h),m=-1,g=-1;m=o.getVcsCode(),g=l.getVcsCode(),s=iU(a,null,null,1),r=iU(h,null,null,1),m>0&&g>0?(i=rg(m),n=rg(g),e=iO(),t=iO()):(e=s,t=r)}else(0,S.g)(0);this.m_inputSR||this.m_inputVCS||(this.m_inputSR=e,this.m_outputSR=t,this.m_inputSRHorz=s,this.m_outputSRHorz=r,this.m_inputVCS=i,this.m_outputVCS=n)}}initUnitParams(){if(this.m_inputUnitParams.m_heightSign=1,this.m_inputUnitParams.m_heightMetersPerUnit=Number.NaN,this.m_inputUnitParams.m_heightZ0=0,this.m_outputUnitParams.m_heightSign=1,this.m_outputUnitParams.m_heightMetersPerUnit=Number.NaN,this.m_outputUnitParams.m_heightZ0=0,this.m_inputUnitParams.m_XYToRadians=Number.NaN,this.m_inputUnitParams.m_PrimeMeridianDegrees=Number.NaN,this.m_outputUnitParams.m_XYToRadians=Number.NaN,this.m_outputUnitParams.m_PrimeMeridianDegrees=Number.NaN,this.m_vertTran)(0,S.g)(0);else if(this.m_geogTran){let e=this.m_geogTran,t=e.getGeogcs1();this.m_inputUnitParams.m_XYToRadians=t.getUnit().getUnitFactor(),this.m_inputUnitParams.m_PrimeMeridianDegrees=t.getPrimem().getLongitude(),t=e.getGeogcs2(),this.m_outputUnitParams.m_XYToRadians=t.getUnit().getUnitFactor(),this.m_outputUnitParams.m_PrimeMeridianDegrees=t.getPrimem().getLongitude()}}}function rf(e,t,s,r,i,n,a){let o=null;t&&(o=t.getPEVerticalCoordSys());let h=null;e&&(h=e.getPECoordSys());let l=null;r&&(l=r.getPEVerticalCoordSys());let m=null;if(s&&(m=s.getPECoordSys()),!(h||o||m||l))return!1;let g=rp();g.initFromGcsAndVcsPe(h,o);let u=rp();return u.initFromGcsAndVcsPe(m,l),rd(g,u,i,n,a)}class rx{supportsCurves(){return!0}accelerateGeometry(e,t,s){return rP(e,t,s)}canAccelerateGeometry(e){return ry(e)}}function rP(e,t,s){if(!ry(e))return!1;(0,I.W)(t,e,!1);let r=0,i=e.getGeometryType();return(0,S.h)(i)&&(0,C.U)(e)&&0!==s&&(r|=!!e.getImpl().buildQuadTreeAccelerator(s)),(0,S.h)(i)&&(0,C.V)(e)&&0!==s&&(r|=!!e.getImpl().buildQuadTreeForPathsAccelerator(s)),r>0}function ry(e){return(0,C.U)(e)||(0,C.V)(e)}class rE extends rx{getOperatorType(){return 8}execute(e,t,s,r){return tr(e,t,s,1,r)}}class rS{getOperatorType(){return 10002}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s,r){return new rC(e,t,s,r)}execute(e,t,s,r){return this.executeMany(new N.S([e]),new N.S([t]),s,r).next()}}class rC extends N.G{constructor(e,t,s,r){super(),this.m_progressTracker=r,this.m_index=-1,this.m_inputGeoms=e,this.m_spatialReference=s;let i=t.next();this.m_geomSubtractor=i||new C.a}next(){let e=this.m_inputGeoms.next();return e?((0,S.d)(e),(0,S.B)(e),this.m_index=this.m_inputGeoms.getGeometryID(),function(e,t,s,r){if(e.isEmpty()||t.isEmpty())return e;let i=e.getDimension(),n=t.getDimension();if(i>n)return e;let a=e.getGeometryType(),o=t.getGeometryType(),h=new E.J,l=new E.J,m=new E.J;e.queryEnvelope(h),t.queryEnvelope(l),m.setCoords({env2D:h}),m.mergeEnvelope2D(l);let g=(0,I.a)(s,m,!0),u=(0,I.d)(g),_=new E.J;if(_.setCoords({env2D:h}),_.inflateCoords(u,u),!_.isIntersecting(l))return e;if(1===i&&2===n){let i=function(e,t,s,r,i){let n=new I.E;e.queryEnvelope(n);let a=new E.J;t.queryEnvelope(a),n.merge(a);let o=.1*n.width(),h=.1*n.height();n.inflateCoords(o,h);let l=new C.a;l.addEnvelope(n,!1);let m=l.getImpl();if(s===S.G.enumPolygon){let e=t.getImpl();m.add(e,!0)}else m.addEnvelope(t,!0);return new sq(l,r,-1,i).tryFastImplementation(e)}(e,t,o,s,r);if(i)return i}if(a===S.G.enumPoint){let s;switch((0,S.f)(o)?(s=new C.P({vd:t.getDescription()})).addSegment(t,!0):s=t,o){case S.G.enumPolygon:var d,p;return 0===t1(s,d=e,g.total())?d:d.createInstance();case S.G.enumPolyline:return function(e,t,s,r){let i=e.getXY(),n=t.querySegmentIterator(),a=(0,I.d)(s),o=a*a;for(;n.nextPath();)for(;n.hasNextSegment();){let t=n.nextSegment(),r=new E.J;if(t.queryEnvelope(r),r.inflateCoords(a,a),!r.contains(i))continue;if(t.isIntersectingPoint(i,s.total()))return e.createInstance();let h=t.getStartXY();if(b.P.sqrDistance(i,h)<=o||(h=t.getEndXY(),b.P.sqrDistance(i,h)<=o))return e.createInstance()}return e}(e,s,g);case S.G.enumMultiPoint:return function(e,t,s,r){let i=t.getImpl().getAttributeStreamRef(0),n=t.getPointCount(),a=e.getXY(),o=(0,I.d)(s),h=o*o,l=new b.P;for(let t=0;t<n;t++)if(i.queryPoint2D(2*t,l),b.P.sqrDistance(l,a)<=h)return e.createInstance();return e}(e,s,g);case S.G.enumEnvelope:var c,f=e,x=s,P=g;let r=new E.J;x.queryEnvelope(r),r.inflate(P.total());let i=f.getXY();return r.contains(i)?f.createInstance():f;case S.G.enumPoint:return function(e,t,s,r){let i=(0,I.d)(s),n=e.getXY(),a=t.getXY();return b.P.sqrDistance(n,a)<=i*i?e.createInstance():e}(e,s,g);default:(0,S.t)("invalid shape type")}}else if(a===S.G.enumMultiPoint)switch(o){case S.G.enumPolygon:return function(e,t,s,r){let i=new E.J;t.queryEnvelope(i),i.inflate(s.total());let n=e.getPointCount(),a=!1,o=(0,b.d)(n,!1),h=new b.P;for(let r=0;r<n;r++)e.queryXY(r,h),i.contains(h)&&0!==t2(t,h,s.total())&&(a=!0,o[r]=!0);if(!a)return e;let l=e.createInstance();for(let t=0;t<n;t++)o[t]||l.addPoints(e,t,t+1);return l}(e,t,g);case S.G.enumEnvelope:return function(e,t,s,r){let i=new E.J;t.queryEnvelope(i),i.inflate(s.total());let n=e.getPointCount(),a=!1,o=(0,b.d)(n,!1),h=new b.P;for(let t=0;t<n;t++)e.queryXY(t,h),i.contains(h)&&(a=!0,o[t]=!0);if(!a)return e;let l=e.createInstance();for(let t=0;t<n;t++)o[t]||l.addPoints(e,t,t+1);return l}(e,t,g);case S.G.enumPoint:return function(e,t,s,r){let i=e.getImpl().getAttributeStreamRef(0),n=e.getPointCount(),a=t.getXY(),o=!1,h=(0,b.d)(n,!1),l=(0,I.d)(s),m=l*l,g=new b.P;for(let e=0;e<n;e++)i.queryPoint2D(2*e,g),b.P.sqrDistance(g,a)<=m&&(o=!0,h[e]=!0);if(!o)return e;let u=e.createInstance();for(let t=0;t<n;t++)h[t]||u.addPoints(e,t,t+1);return u}(e,t,g)}let y=new E.J(h);return y.inflate(100*g.total()),function(e,t,s,r){if(e.isEmpty()||t.isEmpty()||e.getDimension()>t.getDimension())return sv(sG(e),e,t,"-");let i=new E.J;e.queryEnvelope(i);let n=new E.J;t.queryEnvelope(n);let a=new E.J;a.setCoords({env2D:i}),a.mergeEnvelope2D(n);let o=(0,I.a)(s,a,!0),h=n.clone(),l=(0,I.d)(o);if(h.inflateCoords(l,l),!i.isIntersecting(h))return sv(sG(e),e,t,"-");let m=new sC(r),g=new C.E,u=g.addGeometry(sG(e)),_=g.addGeometry(sG(t)),d=0,p=0,c=null;if(g.hasCurves()){var f;c=new so;let e=g.getEnvelope2D(r);p=sn(o.total());let t=si(o.total(),e);d=sa(t,p),f=o.total(),ss(g,t,f,c,null,r)}m.setEditShapeCrackAndCluster(g,o.add(d));let x=m.difference(u,_);null!==c&&c.stitchCurves(g,x,p,!0);let P=sv(g.getGeometry(x),e,t,"-");return s_(P.getGeometryType())&&(P.getImpl().setIsSimple(4,o.total()),P.getGeometryType()===S.G.enumPolygon&&P.getImpl().updateOGCFlagsProtected()),P}(e,(0,w.c)(t,y,0,0,r),s,r)}(e,this.m_geomSubtractor,this.m_spatialReference,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class rI{getOperatorType(){return 10001}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s,r=0){return new rv(e,t,s,r)}execute(e,t,s,r){let i=new rv(new N.S([e,t]),s,r,0).next();return i||(0,S.c)("null output"),i}}class rb{constructor(){this.binVertexCount=0,this.geometries=[]}addPair(e){this.binVertexCount+=e.vertexCount,this.geometries.push(e)}sort(){this.geometries.sort((e,t)=>b.P.compareZorder(e.location,t.location)?-1:+!e.location.equals(t.location))}geomCount(){return this.geometries.length}geomPairs(){return this.geometries}clear(){this.binVertexCount=0,this.geometries.length=0}getBinVertexCount(){return this.binVertexCount}}class rv extends N.G{constructor(e,t,s,r,i=!1){super(),this.m_index=-1,this.m_currentDim=-1,this.m_bDone=!1,this.m_unionBins=[],this.m_readyGeoms=(0,b.as)(4),this.m_dimGeomCounts=(0,b.d)(4,0),this.m_addedGeoms=0,this.m_maxDimension=-1,this.m_bHadGeometry=(0,b.d)(4,!1),this.m_complexUnionGeoms=(0,b.as)(4),this.m_totalNonEmptyGeomCounters=(0,b.d)(4,0),this.m_progressTracker=s,this.m_bUnionAllDimensions=!!(4&r),this.m_bPreserveAllPathEnds=!!(8&r),this.m_inputGeoms=e,this.m_spatialReference=t,this.m_options=r,this.m_bIs3D=i}next(){if(this.m_bDone&&this.m_currentDim===this.m_maxDimension)return null;for(;!this.step_(););if(-1===this.m_maxDimension)return null;if(this.m_bUnionAllDimensions){if(-1===this.m_currentDim){for(let e=0;e<=this.m_maxDimension;e++)if(this.m_bHadGeometry[e]){this.m_complexUnionGeoms[e]=this.getResultGeometry(e);for(let t=e+1;t<=this.m_maxDimension;t++)this.m_complexUnionGeoms[t]=this.getResultGeometry(t),this.m_bHadGeometry[t]&&!this.m_complexUnionGeoms[t].isEmpty()&&(this.m_bIs3D?(0,S.g)(0):this.m_complexUnionGeoms[e]=(new rS).execute(this.m_complexUnionGeoms[e],this.m_complexUnionGeoms[t],this.m_spatialReference,this.m_progressTracker))}}for(;this.m_currentDim++,(this.m_currentDim>this.m_maxDimension||this.m_currentDim<0)&&(0,S.c)(""),!this.m_bHadGeometry[this.m_currentDim];);if(this.m_index++,0===this.m_currentDim&&this.m_complexUnionGeoms[this.m_currentDim].getGeometryType()===S.G.enumPoint){let e=new C.M({vd:this.m_complexUnionGeoms[this.m_currentDim].getDescription()});return this.m_complexUnionGeoms[this.m_currentDim].isEmpty()||e.add(this.m_complexUnionGeoms[this.m_currentDim]),e}return this.m_complexUnionGeoms[this.m_currentDim]}return this.m_index=0,this.m_currentDim=this.m_maxDimension,this.getResultGeometry(this.m_maxDimension)}getGeometryID(){return this.m_index}getRank(){return 1}tock(){return this.step_()}getResultGeometry(e){return this.m_readyGeoms[e]}finishDim(e,t,s){let r=t;if(!s)return 16&this.m_options?r=sS([r],1,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D):r;if(1&this.m_options)return r;if(1===e)if(!(8&this.m_options)&&(16&this.m_options||this.m_totalNonEmptyGeomCounters[e]>1)){let e=(r=sS([r],1,this.m_spatialReference,this.m_progressTracker,16|this.m_options,this.m_bIs3D)).getImpl().getIsSimple(0,[0]);(0,S.g)(this.m_bIs3D||(0,I.i)(e))}else 1===this.m_totalNonEmptyGeomCounters[e]&&(this.m_bIs3D?(0,S.g)(0):r=(new sM).execute(r,this.m_spatialReference,!1,this.m_progressTracker));else this.m_bIs3D?(0,S.g)(0):r=(new sM).execute(r,this.m_spatialReference,!1,this.m_progressTracker);if(0===e&&r.getGeometryType()===S.G.enumPoint){let e=new C.M({vd:r.getDescription()});r.isEmpty()||e.add(r),r=e}return r}static getLevel(e){let t=(0,S.v)(e),s=t>0?(Math.log(t)-Math.log(32))/Math.log(4):0;return s<0&&(s=0),Math.floor(s)}step_(){let e;if(this.m_bDone)return!0;if(this.m_inputGeoms?null===(e=this.m_inputGeoms.next())?(this.m_bDone=!0,this.m_inputGeoms=null):(this.checkAndThrow(e),e.isEmpty()||this.m_totalNonEmptyGeomCounters[e.getDimension()]++):e=null,null!==e){let t=e.getDimension();this.m_bHadGeometry[t]=!0,(t>=this.m_maxDimension||this.m_bUnionAllDimensions)&&(this.addGeom(t,!1,e),t>this.m_maxDimension&&!this.m_bUnionAllDimensions&&this.removeAllBinsWithLowerDimension(t))}if(this.m_addedGeoms>0)for(let e=0;e<=this.m_maxDimension;e++){for(;this.m_dimGeomCounts[e]>1;){let t=this.collectGeometriesToUnion(e);if(null===t)break;{let s;s=1&this.m_options?sS(t,t.length,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D):function(e,t,s,r,i,n=!1){t<2&&(0,S.t)("not enough geometries to dissolve");let a=0;for(let s=0;s<t;s++)a=Math.max(e[s].getDimension(),a);if(2===a||1===a)return new sC(r).dissolveMultiPaths_(a,!0,e,t,s,i,n);let o=I.n.constructEmpty(),h=new C.E,l=C.n,m=0,g=-1;for(let s=0;s<t;s++)if(e[s].getDimension()===a&&(-1===g&&(g=s),!e[s].isEmpty())){g=s,l===C.n?l=h.addGeometry(sG(e[s])):h.appendGeometry(l,sG(e[s]));let t=I.n.constructEmpty();e[s].queryLooseEnvelope(t),o.mergeEnv3D(t),m++}if(m<2)return sG(e[g]);let u=0===a?s:null,_=(0,I.a)(u,o.getEnvelope2D(),!0),d=new sC(r);if(n){let e=(0,I.N)(u,o.getEnvelopeZs(),!0);return d.m_bOGCOutput=!0,d.planarSimplify3DImpl_(h,_,e,0,!0)}return d.planarSimplifyMultiPoints(h,_,!0,-1)}(t,t.length,this.m_spatialReference,this.m_progressTracker,8|this.m_options,this.m_bIs3D),this.addGeom(e,!0,s)}}if(this.m_bDone&&((0,S.g)(this.m_dimGeomCounts[e]<=1),0!==this.m_dimGeomCounts[e])){let t=this.m_unionBins[e].entries().next().value,s=t[1].geomPairs()[0].geom,r=t[1].geomPairs()[0].bUnioned;this.m_unionBins[e].clear(),this.m_readyGeoms[e]=this.finishDim(e,s,r)}}return this.m_bDone}addGeom(e,t,s){let r={geom:null,vertexCount:-1,bUnioned:!1,location:new b.P};r.geom=s;let i=(0,S.v)(s);r.vertexCount=i;let n=E.J.constructEmpty();s.queryEnvelope(n),r.location=i>0?n.getCenter():new b.P(0,0);let a=rv.getLevel(s);if(e+1>this.m_unionBins.length)for(;this.m_unionBins.length<Math.max(2,e+1);)this.m_unionBins.push(new Map);let o=null,h=this.m_unionBins[e].get(a);h&&(o=h),null===o&&(o=new rb,this.m_unionBins[e].set(a,o)),r.bUnioned=t,o.addPair(r),this.m_dimGeomCounts[e]++,this.m_addedGeoms++,this.m_maxDimension=Math.max(this.m_maxDimension,e)}removeAllBinsWithLowerDimension(e){for(let t=0;t<e;t++)this.m_unionBins[t].clear(),this.m_addedGeoms-=this.m_dimGeomCounts[t],this.m_dimGeomCounts[t]=0}collectGeometriesToUnion(e){if(1&this.m_options&&!this.m_bDone)return null;let t=null,s=[];for(let t of this.m_unionBins[e].keys())s.push(t);(0,b.v)(s);for(let r=0;r<s.length;r++){if(-1===s[r])continue;let i=this.m_unionBins[e].get(s[r]);{let n=i.getBinVertexCount()>5e3&&i.geomCount()>=4;if(this.m_bDone||n){for(let i=0;i<r;i++){if(-1===s[i])continue;let r=this.m_unionBins[e].get(s[i]);for(let s of(r.sort(),this.m_dimGeomCounts[e]-=r.geomCount(),this.m_addedGeoms-=r.geomCount(),r.geomPairs()))t||(t=[]),t.push(s.geom);r.clear(),this.m_unionBins[e].delete(s[i]),s[i]=-1}for(let s of(i.sort(),this.m_dimGeomCounts[e]-=i.geomCount(),this.m_addedGeoms-=i.geomCount(),i.geomPairs()))t||(t=[]),t.push(s.geom);if(i.clear(),this.m_unionBins[e].delete(s[r]),s[r]=-1,!this.m_bDone)break}}}return t}checkAndThrow(e){this.m_bIs3D&&(e.getDimension()>1&&(0,S.x)(),e.hasAttribute(1)||(0,S.t)("Geometry must have Zs")),(0,S.d)(e)}}class rG extends rx{getOperatorType(){return 3}execute(e,t,s,r=null){return tr(e,t,s,4,r)}}function rw(e,t,s){let r=t.getGCSSplitLines();if(null===r)return e;let i=t.getGCS(),n=i.getPannableExtent().width(),a=E.J.constructEmpty();e.queryLooseEnvelope(a);let o=b.E.constructEmpty();a.queryIntervalX(o);let h=r.querySegmentIterator(),l=null,m=new G.T;for(;h.nextPath();)for(;h.hasNextSegment();){let e=h.nextSegment(),t=e.queryInterval(0,0),s=b.E.constructEmpty();s.setCoordsFromEnvelope(t);let r=0;for(;s.vmax>o.vmin;)s.move(-n),r--;for(;s.vmin<=o.vmax;){if(s.isIntersecting(o)){null===l&&(l=new C.P);let t=new C.L({start:e.getStartXY(),end:e.getEndXY()});0!==r&&(m.setShiftCoords(r*n,0),t.applyTransformation(m)),l.addSegment(t,!0)}s.move(n),++r}}if(null!==l){let t=(0,I.b)(i,l,!0);var g=l,u=(0,I.d)(t);let r=g.getGeometryType();return(0,S.h)(r)?new eq(s).crackAWithBMultiPath_(e,g,u):void(0,S.b)("crack_A_with_B")}return e}function rT(e,t,s){let r=e.getName();return ij(r)||(r=s||t>0?(r=e.toString(l.PE_STR_NAME_CANON|l.PE_STR_AUTH_NONE)).toLocaleUpperCase("en-US"):e.toString(l.PE_STR_AUTH_TOP)),r}function rN(e,t=-1){if((t>1||t<-1)&&(0,S.t)("verbosity"),-1===t)return e.toString();{let s=0===t?l.PE_STR_AUTH_TOP:l.PE_STR_AUTH_ALL;return e.toString(s)}}function rD(e,t,s,r){var i,n,a,o,h;if(e.isEmpty()||1===s)return e;let l=e.getGeometryType();if(l===S.G.enumPoint){let r=e.getXY();return 0===rF([r],1,t,s)||r.isNAN()?e.setEmpty():e.setXY(r),e}if(l===S.G.enumMultiPoint){let r=e.createInstance(),i=e.getPointCount();r.reserve(i);let n=e.getAttributeStreamRef(0),a=e.getDescription().getAttributeCount()>1,o=new I.P,h=Float64Array.from(n.getArray());if(rF(h,i,t,s)>0)for(let t=0,s=2*i;t<s;t+=2)Number.isNaN(h[t])||(a?(e.getPointByVal(t>>1,o),o.setXYCoords(h[t],h[t+1]),r.add(o)):r.addXY(h[t],h[t+1]));return r}let m=e,g=t.getOneDegreeGCSUnit(),u=90*g,_=180*g,d=360*g,p=t.getCentralMeridian(),c=.5*g,f=E.J.constructEmpty();m.queryEnvelope(f);let x=t.getGCSHorizon(),P=t.getGCSHorisonIsInclusive(),y=x.getGeometryType()===S.G.enumEnvelope,C=E.J.constructEmpty();x.queryEnvelope(C);let b=t.getGCS();if(2!==s&&4!==s||(C.xmin=p-_,C.xmax=C.xmin+d),4===s){if(!(f.width()>d-g)){let e=E.J.constructEmpty();e.setCoords({xmin:f.xmin-g,ymin:C.ymin,xmax:f.xmax+g,ymax:C.ymax}),m=(new w.O).execute(m,e,b,r);let t=Math.floor((p-f.getCenterX())/d);for(f.move(t*d,0);f.xmin>C.xmax;)t-=1,f.move(-d,0);for(;f.xmin<C.xmin;)t+=1,f.move(d,0);if(0!==t){let e=new G.T;e.setShiftCoords(t*d,0),m.applyTransformation(e)}return m}s=2}if(2===s&&(C.xmin=p-_,C.xmax=C.xmin+d),f.ymin<-u||f.ymax>u){let e=E.J.constructEmpty();if(e.setCoords({xmin:f.xmin-g,ymin:-u,xmax:f.xmax+g,ymax:u}),(m=(new w.O).execute(m,e,b,r)).isEmpty())return m;m.queryEnvelope(f)}if(P&&(C.ymax<f.ymin||C.ymin>f.ymax))return m.createInstance();f.width()>d&&(m=rY(m,p-_,d,b,!0,0,!0,r)).queryEnvelope(f);let v=(i=f.xmin,n=f.xmax,a=C.xmin,o=C.xmax,h=d,i>=a&&n<=o?0:rR(.5*(n+i),a,o,h));if(0!==v&&f.move(v,0),f.xmax>C.xmax||f.xmin<C.xmin){if(f.xmax>C.xmax)for(;f.xmin>=C.xmax;)f.move(-d,0),v-=d;for(;f.xmin<C.xmax-d;)f.move(d,0),v+=d}let T=(0,I.W)(b,x,!1);if(0!==v){let e=new G.T;e.setShiftCoords(v,0),m.applyTransformation(e),v=0}if(P){if(y&&C.containsEnvelope(f))return m;let e=[,,];for(let t=0;t<2;t++){let s;if(y?s=(0,S.h)(l)?(0,w.c)(m,C,T,c,r):(0,w.c)(m,C,T,0,r):(s=(new sB).execute(m,x,b,r))===x&&(s=s.clone()),C.xmin<=f.xmin&&C.xmax>=f.xmax||C.xmin>=f.xmin&&C.xmax<=f.xmax)return s;if(e[t]=s,0===t){f.move(-d,0);let e=new G.T;e.setShiftCoords(-d,0),m.applyTransformation(e)}}return(0,S.h)(l)?e[0].add(e[1],!1):(0,S.c)("intersect_with_GCS_horizon: unexpected geometry type"),e[0]}{if(C.ymax<f.ymin||C.ymin>f.ymax)return m;let e=0;for(;!m.isEmpty()&&f.xmax>C.xmin;){if(0!==e){let t=new G.T;t.setShiftCoords(e,0),m.applyTransformation(t)}if((new rG).execute(m,x,b,r)||(m=(new rS).execute(m,x,b,r),x===m&&(m=m.clone())),0!==e){let t=new G.T;t.setShiftCoords(-e,0),m.applyTransformation(t)}e-=d,f.move(-d,0)}return m}}function rV(e,t,s,r){for(let i=0,n=0;i<r;i++,n+=2)t[s+i].x=e[n],t[s+i].y=e[n+1]}function rF(e,t,s,r){if(0===t||1===r)return t;let i=function(e,t){let s;if(Array.isArray(e)){s=new Float64Array(2*t);for(let r=0,i=0;r<t;r++,i+=2)s[i]=e[r].x,s[i+1]=e[r].y}else s=e;return s}(e,t);if(2===r){let r=s.getPannableExtentInGCS(),n=t;for(let e=0,s=2*t;e<s;e+=2)(i[e+1]>r.ymax||i[e+1]<r.ymin)&&(i[e]=Number.NaN,n--);return n?(rX(i,t,r.xmin,r.width(),!0),e!==i&&rV(i,e,0,t),n):0}let n=s.getOneDegreeGCSUnit(),a=90*n,o=180*n,h=360*n,l=t;for(let e=0,s=2*t;e<s;e+=2)(i[e+1]>a||i[e+1]<-a)&&(i[e]=Number.NaN,l--);if(!l)return 0;let m=E.J.constructEmpty();m.setFromPoints(i,t);let g=s.getGCSHorizon(),u=s.getGCSHorisonIsInclusive(),_=g.getGeometryType()===S.G.enumEnvelope,d=E.J.constructEmpty();if(g.queryEnvelope(d),u&&(d.ymax<m.ymin||d.ymin>m.ymax))return 0;if(u)if(rX(i,t,d.getCenterX()-o,h,!0),l=t,_)for(let e=0,s=2*t;e<s;e+=2)d.containsCoords(i[e],i[e+1])||(i[e]=Number.NaN,l--);else{let e=(0,I.W)(s.getGCS(),g,!1),r=new b.P;for(let s=0,n=2*t;s<n;s+=2)r.setCoords(i[s],i[s+1]),0!==t2(g,r,e)||(i[s]=Number.NaN,l--)}else{rX(i,t,-o,h,!0),l=t;let e=(0,I.W)(s.getGCS(),g,!1),r=new b.P;for(let s=0,n=2*t;s<n;s+=2){r.setCoords(i[s],i[s+1]),r.isNAN()&&l--;let t=rR(r.x,d.xmin,d.xmax,h);r.x+=t,0!==t2(g,r,e)&&(i[s]=Number.NaN,l--)}}return l>0&&Array.isArray(e)&&rV(i,e,0,t),l}function rH(e,t,s,r,i,n){let a,o;if(t.isPannable()||(0,S.t)("fold_into_360_degree_range"),e.isEmpty())return e;if(2===t.getCoordinateSystemType()){let e=t.getPannableExtent();o=e.xmin,a=e.width()}else{let e=t.getOneDegreeGCSUnit();a=360*e,o=s-180*e}return rY(e,o,a,t,r,i,!0,n)}function rk(e,t,s,r){let i,n;if(2===s.getCoordinateSystemType()){let e=s.getPannableExtent();i=e.xmin,n=e.width()}else{let e=s.getOneDegreeGCSUnit();n=360*e,i=r-180*e}rX(e,t,i,n)}function rA(e,t){let s=t.width(),r=(0,b.o)(e-t.vmin,s);return r<0&&(r+=s),t.snapClip(r+t.vmin)}function rM(e,t,s){return e>t.xmax&&e-t.xmax<s?t.xmax:e<t.xmin&&t.xmin-e<s?t.xmin:e}function rU(e,t,s){if(e[0]<t.vmin||e[0]>t.vmax||s&&e[0]===t.vmax){let s=t.width();return e[0]+=Math.ceil((t.vmin-e[0])/s)*s,e[0]=t.snapClip(e[0]),!0}return!1}function rq(e,t,s,r,i){let n=new C.E,a=n.addGeometry(e);return rO(n,a,t,(0,I.W)(t,e,!1),s,r,i),n.getGeometry(a)}function rO(e,t,s,r,i,n,a){let h={stack:[],error:void 0,hasError:!1};try{(0,S.g)(iF()),s.isPannable()||(0,S.m)("insert_geodetic_points");let l=s.getPannableExtent(),g=s.getGCS(),u=iD();g.querySpheroidData(u);let _=g.getUnit().getUnitToBaseFactor(),d=u.majorSemiAxis,c=u.e2,f=0,x=new b.E;l.queryIntervalX(x);let P=null,y=(0,b.d)(4,Number.NaN);2===s.getCoordinateSystemType()?(P=s.getPECoordSys(),n?(y[0]=rA(a,x),y[1]=l.getCenterY(),m.projToGeog(P,1,y),f=y[0]*_):(y[0]=l.getCenterX(),y[1]=a,m.projToGeog(P,1,y),f=y[1]*_)):f=a*_,n||0===f||2===i||(0,S.m)("insert_geodetic_points: 1");let E=(0,v.b)(h,new o,!1),G=new b.P,w=new b.P,T=new b.P,N=new b.P,D=new b.P,V=new b.P;for(let h=e.getFirstPath(t);h!==C.n;h=e.getNextPath(h)){let t=e.getFirstVertex(h);e.queryXY(t,T);let l=!1,g=e.getNextVertex(t);for(let t=g;t!==C.n;t=e.getNextVertex(t)){if(t===g){if(l)break;l=!0}if(e.queryXY(t,N),n&&(r<a-T.x&&N.x-a>r||r<a-N.x&&T.x-a>r)||!n&&(0!==a||r<-T.y&&N.y>r||r<-N.y&&T.y>r))do{if(Math.abs(T.x-N.x)>=.5*x.width())break;2===s.getCoordinateSystemType()?(y[0]=rA(T.x,x),y[1]=T.y,y[2]=rA(N.x,x),y[3]=N.y,r0(P,2,y,0),D.x=y[0]*_,D.y=y[1]*_,V.y=y[3]*_):(D.x=T.x*_,D.y=T.y*_,V.y=N.y*_),V.x=(N.x-T.x)*Math.PI*2/x.width()+D.x;let r=0,h=(0,b.m)(b.P,2);if(n){if(w.x=f,w.y=function(e,t,s,r,i,n){let a={stack:[],error:void 0,hasError:!1};try{if(2===n)return function(e,t,s,r,i){if(Math.abs(s.x-r.x)>Math.PI||Math.abs(s.y)>b.l||Math.abs(r.y)>b.l||(Math.abs(s.y)===b.l||Math.abs(r.y)===b.l)&&s.x!==r.x)return Number.NaN;let{first:n,second:a}=(0,b.aC)(s.x,r.x),o=i;if(o=B(o,n,a),!b.E.construct(s.x,r.x).containsCoordinate(o))return Number.NaN;let h=C.W.constructPoint2D(s),l=C.W.constructPoint2D(r),m=X(1,t,h),g=X(1,t,l),u=m.crossProductVector(g);if(u.z.isZero())return s.y;let _=u.x.divE(u.z.negate()),d=u.y.divE(u.z.negate()),p=_.mulE(_).addE(d.mulE(d)).sqrt();if(p.isZero()||_.isZero()&&d.isZero())return s.y;let c=Math.atan2(d.value(),_.value()),f=Math.atan2(p.value()*Math.cos(c-o),1-t),x=R(1,t,b.P.construct(o,f)),P=I.h.construct(x.x,x.y,-x.z),y=u.value().dotProduct(x);return Math.abs(u.value().dotProduct(P))<Math.abs(y)&&(f=-f),f}(0,t,s,r,i);if(Math.abs(s.x-r.x)>=Math.PI||!ie(s.x,r.x,i))return Number.NaN;s.x>r.x&&(r=(0,b.b)(s,s=r));let h=(0,v.b)(a,new o,!1),l=(0,v.b)(a,new o,!1),m=(0,v.b)(a,new o,!1),g=s.clone();p.geodeticDistance(e,t,s.x,s.y,r.x,r.y,l,h,null,n);let u=l.val,_=0,d=1;for(;u*(d-_)>1e-12*e;){let a=.5*(_+d);if(p.geodeticCoordinate(e,t,s.x,s.y,u*a,h.val,l,m,n),g.x=l.val,g.y=m.val,g.x===i)break;if(ie(s.x,g.x,i))d=a;else{if(!ie(r.x,g.x,i))return Number.NaN;_=a}}return g.y}catch(e){a.error=e,a.hasError=!0}finally{(0,v.c)(a)}}(d,c,D,V,f,i),Number.isNaN(w.y))break;h[0]=w,r=1}else if(2===i){let e=[0,0];if(!(r=Z(d,c,D,V,f,e)))break;h[0].x=e[0],h[0].y=f,2===r&&(h[1].x=e[1],h[1].y=f)}else{if(w.x=function(e,t,s,r,i){let n={stack:[],error:void 0,hasError:!1};try{let a=s.clone(),h=r.clone();if(2===i){let s=[0,0];return Z(e,t,a,h,0,s),s[0]}if(a.y>h.y){let e=new b.P;e.assign(a),a.assign(h),h.assign(e)}let l=(0,v.b)(n,new o,!1),m=(0,v.b)(n,new o,!1),g=(0,v.b)(n,new o,!1),u=new b.E;if(u.setCoords(a.y,h.y),!u.containsCoordinate(0)||Math.abs(a.x-h.x)>=Math.PI)return Number.NaN;if(a.x===h.x)return a.x;p.geodeticDistance(e,t,a.x,a.y,h.x,h.y,m,l,null,i);let _=m.val,d=0,c=1,f=a.clone();for(;_*(c-d)>1e-12*e;){let s=.5*(d+c);if(p.geodeticCoordinate(e,t,a.x,a.y,_*s,l.val,m,g,i),f.x=m.val,f.y=g.val,u.setCoords(a.y,f.y),0===f.y)break;if(u.containsCoordinate(0))c=s;else{if(u.setCoords(h.y,f.y),!u.containsCoordinate(0))return(0,S.g)(!1),Number.NaN;d=s}}return f.x}catch(e){n.error=e,n.hasError=!0}finally{(0,v.c)(n)}}(d,c,D,V,i),Number.isNaN(w.x))break;w.y=0,h[0]=w,r=1}let l=-1;for(let o=0;o<r;o++){p.geodeticDistance(d,c,D.x,D.y,V.x,V.y,E,null,null,i);let r=E.val;p.geodeticDistance(d,c,D.x,D.y,h[o].x,h[o].y,E,null,null,i);let g=E.val;2===s.getCoordinateSystemType()?(y[0]=h[o].x/_,y[1]=h[o].y/_,m.geogToProj(P,1,y),n?(G.y=y[1],G.x=a):(G.x=it(y[0],T.x,N.x,x),G.y=a)):n?(G.x=a,G.y=h[o].y/_):(G.x=it(h[o].x/_,T.x,N.x,x),G.y=a);let u=r>0?(0,b.c)(g/r,0,1):.5;if(0===u||1===u||l>u)continue;let f=e.getPrevVertex(t);e.splitSegment(f,[u],1);let S=e.getNextVertex(f);e.setXYCoords(S,G.x,G.y),l=u}}while(0);T.setCoordsPoint2D(N)}}}catch(e){h.error=e,h.hasError=!0}finally{(0,v.c)(h)}}function rB(e,t){(0,S.g)(t.isPannable());let s=t.getPannableExtent();if(e.getGeometryType()===S.G.enumPoint){let t=e.getY();return s.ymin<=t&&t<=s.ymax?e:e.createInstance()}let r=E.J.constructEmpty();e.queryEnvelope(r);let i=E.J.constructEmpty();i.setCoords({env2D:s}),i.xmin=r.xmin,i.xmax=r.xmax,i.inflateCoords(.01*i.height(),0);let n=(0,I.c)(t,r,!1);return i.containsEnvelope(r)?e:(0,w.c)(e,i,n,0,null)}function rR(e,t,s,r){return(0,b.av)((.5*(s+t)-e)/r)*r}function rY(e,t,s,r,i,n,a,o){let h,l=e.getGeometryType(),m=b.E.constructEmpty();m.setCoords(t,t+s);let g=[0];if(l===S.G.enumPoint){if(g[0]=e.getX(),rU(g,m,a)){let t=i?e:e.clone();return t.setX(g[0]),t}return e}let u=E.J.constructEmpty();if(e.queryEnvelope(u),u.isEmpty())return e;if(l===S.G.enumMultiPoint){let t=i?e:e.clone(),s=t.getImpl(),r=s.getAttributeStreamRef(0),n=2*s.getPointCount(),o=!1;for(let e=0;e<n;e+=2)g[0]=r.read(e),rU(g,m,a)&&(r.write(e,g[0]),o=!0);return o&&s.notifyModifiedFlags(2001),t}let _=b.E.constructEmpty();if(u.queryIntervalX(_),m.contains(_))return m.vmax,_.vmax,e;let d=E.J.constructEmpty();if(d.setCoords({env2D:u}),0===_.width()){let t=_.vmin;t+=Math.ceil((m.vmin-t)/s)*s,t=m.snapClip(t);let r=i?e:e.clone();return r.setAttributeBasic(0,0,t),r}if(l===S.G.enumEnvelope){let t=i?e:e.clone();return u.intersect(d),t.setEnvelope(u),t}let p=.1*Math.max(u.height(),u.width())*1;d.inflateCoords(0,p);let c=e,f=r.getTolerance(0),x=new G.T;for(;;){let e=Math.floor((_.vmin-t)/s),i=Math.ceil((_.vmax-t)/s);if(!(i-e>3))break;{let a=Math.floor(.5*(i+e));d.xmin=u.xmin-p,d.xmax=t+s*a;let h=(0,w.c)(c,d,f,n,o);d.xmin=d.xmax,d.xmax=u.xmax+p;let m=(0,w.c)(c,d,f,n,o);x.setShiftCoords((a-i)*s,0),m.applyTransformation(x),l===S.G.enumPolygon?c=(new rI).execute(h,m,r,o):(c=h).add(m,!1),c.queryEnvelope(u),u.queryIntervalX(_)}}d.xmin=t,d.xmax=t+s;let P=E.J.constructEmpty();P.setCoords({env2D:d}),P.inflateCoords(f,0);let y=Math.floor((u.xmin-d.xmin)/s)*s;y?(d.move(y,0),x.setShiftCoords(-y,0)):x.setIdentity(),h=l===S.G.enumPolyline?new C.P({vd:c.getDescription()}):new C.a({vd:c.getDescription()});let I=E.J.constructEmpty(),v=E.J.constructEmpty();for(;u.xmax>d.xmin;){let e=(0,w.c)(c,d,f,0,o);e.queryEnvelope(v);let t=!1;(l===S.G.enumPolyline?!e.isEmpty()&&(v.width()>f||v.height()>f):!e.isEmpty()&&(l!==S.G.enumPolygon||v.width()>f))&&(e.applyTransformation(x),e.queryEnvelope(v),h.queryEnvelope(I),I.inflateCoords(f,f),I.isIntersecting(v)&&l===S.G.enumPolygon?h=(new rI).execute(h,e,r,o):h.add(e,!1)),d.move(s,0),x.shiftCoords(-s,0)}return h}function rX(e,t,s,r,i=!0){let n=new b.E;n.setCoords(s,s+r);let a=[0];if(Array.isArray(e))for(let s=0;s<t;s++)n.containsRightExclusive(e[s].x)||(a[0]=e[s].x,rU(a,n,i),e[s].x=a[0]);else for(let s=0;s<t;s++){let t=s<<1;n.containsRightExclusive(e[t])||(a[0]=e[t],rU(a,n,i),e[t]=a[0])}}function rL(e,t,s,r=!0){if(e.isEmpty())return;let i=e.getGeometryType();if(!r||i!==S.G.enumPolygon)if((0,S.i)(i)){let r=!1;if((0,S.h)(i)&&e.hasNonLinearSegments()){let i=e.getImpl(),n=i.getAttributeStreamRef(0),a=i.getSegmentFlagsStreamRef();(0,S.g)(null!==a);for(let e=0,o=i.getPathCount();e<o;e++){let o=!0,h=i.isClosedPath(e),l=i.getPathEnd(e);h&&i.getPathSize(e)>0&&(o=1==(31&a.read(l-1)));for(let h=i.getPathStart(e);h<l;h++)if(1==(31&a.read(h))){if(o){let e=n.read(2*h),i=rM(e,t,s);i!==e&&(r=!0,n.write(2*h,i))}o=!0}else o=!1}}else{let i=e.getImpl(),n=i.getAttributeStreamRef(0);for(let e=0,a=i.getPointCount();e<a;e++){let i=n.read(2*e),a=rM(i,t,s);a!==i&&(r=!0,n.write(2*e,a))}}r&&e.getImpl().notifyModifiedFlags(2001)}else if(i===S.G.enumEnvelope){let r=E.J.constructEmpty();e.queryEnvelope(r),r.xmin=rM(r.xmin,t,s),r.xmax=rM(r.xmax,t,s),e.setEnvelope(r)}else i===S.G.enumPoint?e.setX(rM(e.getX(),t,s)):(0,S.c)("")}function rz(e,t,s,r){let i=e.getGeometryType();(0,S.g)(i===S.G.enumPolygon||i===S.G.enumPolyline||i===S.G.enumMultiPoint);let n=t.getCoordinateSystemType();if(2===n){let n=e;if(0===s){let s=function(e,t){if(t.isEmpty())return 0;let s=e.getPECoordSys();if(s.getProjection().getCode()===l.PE_PRJ_AZIMUTHAL_EQUIDISTANT){let r=iD();e.querySpheroidData(r);let i=s.getParameters();if(null===i[l.PE_PARM_LAM0]||null===i[l.PE_PARM_PHI0])return 0;let n=[i[l.PE_PARM_LAM0].getValue(),i[l.PE_PARM_PHI0].getValue()];m.geogToProj(s,1,n);let a=new b.P(n[0],n[1]),o=E.J.constructEmpty();t.queryEnvelope(o);let h=(0,b.m)(b.P,4);o.queryCorners(h);let g=0,u=e.getOneMeter(),_=Math.max(r.majorSemiAxis,r.minorSemiAxis)*Math.PI,d=Math.min(r.majorSemiAxis,r.minorSemiAxis)*Math.PI;d-=_/180,_*=u,d*=u;for(let e=0;e<4;e++){let t=b.P.distance(h[e],a);if(t>_)g++;else if(t>d)return -1}if(0===g)return 1;if(4===g){let e=E.J.constructEmpty();return e.setCoords({center:a,width:_,height:_}),o.isIntersectingNe(e)?-1:0}}return -1}(t,e);if(0===s)return e.createInstance();if(1===s)return e;let i=t.getPCSHorizon(),a=i.getGeometryType(),o=t.getDefaultPrecisionSR();if(a===S.G.enumEnvelope){let s=E.J.constructEmpty();i.queryEnvelope(s);let a=(0,I.c)(o,s,!1);n=(0,w.c)(e,s,a,5e4*t.getOneMeterPCSUnit(),r)}else(new rE).execute(i,e,o,r)||(n=(new sB).execute(n,i,o,r))===i&&(n=n.clone())}else if(t.isPannable()){let e=E.J.constructEmpty();n.queryEnvelope(e);let a=t.getPannableExtent();a.containsEnvelope(e)||(rL(n,a,t.getTolerance(0)),2!==s&&4!==s||(n=rB(n,t)),4!==s?n=rH(n,t,0,!0,1e5*t.getOneMeterPCSUnit(),r):i===S.G.enumPolygon&&e.width()>2*a.width()&&(n=rY(n,-2*a.width(),2*a.width(),t,!0,0,!0,r)))}return n}if((0,S.g)(1===n),i===S.G.enumMultiPoint)return rL(e,t.getPannableExtent(),t.getTolerance(0)),e;{let s=E.J.constructEmpty();e.queryEnvelope(s);let n=e,a=t.getPannableExtent();if(s.ymin<a.ymin||s.ymax>a.ymax){let e=Math.max(1,s.calculateToleranceFromEnvelope()),i=new E.J(s.xmin-e,a.ymin,s.xmax+e,a.ymax);if((n=(new w.O).execute(n,i,t,r)).isEmpty())return n}return i===S.G.enumPolygon&&s.width()>2*a.width()&&(n=rY(n,-2*a.width(),2*a.width(),t,!0,0,!0,r)),n}}function rJ(e,t){let s=t.getPointCount();if(!s)return;let r=t.getImpl(),i=r.getAttributeStreamRef(0);m.geogToProj(e,s,i.getArray()),r.notifyModifiedFlags(2001)}function rW(e,t,s,r){if(!s)return;let i=e.getPECoordSys();if(1===s){let s=[t[0].x,t[0].y];if(m.geogToProj(i,1,s),r){let{first:r,second:i}=e.m_peCoordSysVal.getGeogToProjFactors();s[0]=r*(t[0].x-e.getCentralMeridian())+i}return void t[0].setCoords(s[0],s[1])}let n=e.isPannable(),a=n?e.getPannableExtent().width():0,o=179*a/360,h=0;n&&(h=e.getCentralMeridian());let l=new Float64Array(512);for(let g=0;g<s;){for(let e=g;e<s&&t[e].isNAN();++e)g++;let u=Math.min(256,s-g);if(u>0){for(let e=1,s=g+1;e<u;++e,++s)if(t[s].isNAN()){u=e;break}for(let e=0;e<u;++e){let s=e<<1;l[s]=t[g+e].x,l[s+1]=t[g+e].y}if(m.geogToProj(i,u,l),r){let{first:s,second:r}=e.m_peCoordSysVal.getGeogToProjFactors();for(let e=0;e<u;++e)l[e<<1]=s*(t[g+e].x-h)+r}if(n)for(let e=0,s=g;e<u;e++,s++){let r=e<<1,i=l[r],n=(0,b.e)(i),m=t[s].x-h;n*(0,b.e)(m)<0&&Math.abs(i)>o&&(l[r]-=n*a)}rV(l,t,g,u),g+=u}}}function rj(e,t,s,r){let i=e.getSRToGCSTransform();return(new sj).transform(i,t,s,r,!1)}function rZ(e,t,s,r){let i,n=new C.M({vd:t.getDescription()});n.addPoints(t,0,-1),i=(new sj).execute(n,e,r);let a=t.getPointCount();if(s.setEmpty(),e.getInputSR().isPannable()){if(a!==i.getPointCount())return!1;let r=new E.J;t.queryEnvelope(r);let n=new E.J;i.queryEnvelope(n);let o=r.width(),h=n.width();if(0!==o&&0!==h){if(Math.abs(h/o/(e.getOutputSR().getPannableExtent().width()/e.getInputSR().getPannableExtent().width())-1)>1e-10)return!1}else if(0!==o||0!==h)return!1;s.add(t,!1);for(let e=0;e<a;e++){let t=i.getXY(e);s.setXY(e,t)}return!0}return!1}function rK(e,t,s){(0,S.g)(!s||e.isPannable());let r=t.getPointCount();if(!r)return;let i=t.getImpl(),n=i.getAttributeStreamRef(0),a=e.getPECoordSys(),o=0,h=n.readRange(0,2*r),l=()=>{m.geogToProj(a,r,h)},g=e.isPannable()&&!s,u=g?e.getPannableExtent().width():0,_=179*u/360;if(e.isPannable()&&(o=e.getCentralMeridian(),s)){let t=e.m_peCoordSysVal.getGeogToProjFactors(),s=t.first,i=t.second;l=()=>{m.geogToProj(a,r,h);for(let e=0;e<r;e++){let t=e<<1,r=s*(n.read(t)-o)+i;h[t]=r}}}if(l(),g)for(let e=0;e<r;e++){let t=e<<1,s=h[t],r=(0,b.e)(s),i=n.read(t)-o;r*(0,b.e)(i)<0&&Math.abs(s)>_&&(h[t]+=-r*u)}n.writeRangeFromArray(0,2*r,h,!0,1),i.notifyModifiedFlags(2001)}function rQ(e,t,s){if(!t.hasNonLinearSegments())return void rK(e,t,s);if((0,S.g)(!s||e.isPannable()),t.isEmpty())return;let r=e.getPECoordSys(),i=e.isPannable(),n=i?e.getPannableExtent().width():0,a=179*n/360,o=0;i&&(o=e.getCentralMeridian());let h=t.createInstance();h.reserveParts(t.getPointCount(),t.getPathCount());let l=t.getImpl(),g=new C.S;for(let u=0,_=t.getPathCount();u<_;++u)if(l.hasNonLinearSegmentsPath(u)){let t=!0,r=-1,i=l.getPathStart(u),n=i+l.getSegmentCountPath(u);l.isClosedPath(u)&&(r=n-1);let a=new b.P;for(let o=i;o<n;++o){if(l.getSegmentBuffer(o,g,!1),function(e,t,s){switch(t.getGeometryType()){case S.G.enumLine:var r=e,i=t,n=s;let a=[i.getStartXY(),i.getEndXY()];rW(r,a,2,n),i.setStartXY(a[0]),i.setEndXY(a[1]),i.normalizeAfterEndpointChange();return;case S.G.enumBezier:return function(e,t,s){let r=(0,b.m)(b.P,4);t.queryControlPoints(r),rW(e,r,4,s),t.setControlPoints(r)}(e,t,s);case S.G.enumEllipticArc:return function(e,t,s){if(0===t.projectionBehavior())r5(!0,e,0,t,s);else{let r=t.isClosed()&&t.isMajor(),i=[t.getStartXY(),r?t.getCenter():t.getEndXY()],n=[i[0].clone(),i[1].clone()];rW(e,n,2,s);let a=new G.T;a.initializeFromTwoPointsArray(i,n),t.applyTransformation(a),t.setCoordsForIntersector(n[0],n[+!r],!1)}}(e,t,s);case S.G.enumBezier2:var o=void 0,h=void 0,l=void 0;return(0,S.g)(0);case S.G.enumRationalBezier2:var m=void 0,g=void 0,u=void 0;return(0,S.g)(0);default:(0,S.c)("")}}(e,g.get(),s),!t&&(g.get().getStartXY().equals(a)||g.get().moveTo(a)),o!==r)h.addSegment(g.get(),t);else{if(t){let e=new I.P;g.get().queryStart(e),h.startPathPoint(e)}h.closeLastPathWithSegment(g.get())}a.assign(g.get().getEndXY()),t=!1}}else{let e,s=l.getPathSize(u),g=Math.min(s,1024);h.insertPath(-1,t,u,!0);let _=l.getAttributeStreamRef(0),d=h.getAttributeStreamRef(0);for(let t=l.getPathStart(u),h=l.getPathEnd(u);t<h;){if(e=_.readRange(t,g),m.geogToProj(r,g,e),i)for(let t=0;t<g;t++){let s=t<<1,r=e[s],i=(0,b.e)(r),h=_.read(2*(0+t))-o;i*(0,b.e)(h)<0&&Math.abs(r)>a&&(e[s]+=-i*n)}d.writeRangeFromArray(t,g,e,!0,1),t+=g,s-=g,g=Math.min(s,1024)}}t.assignMove(h)}function r$(e,t,s){let r,i=s.getPointCount();if(!i)return;let n=s.getImpl(),a=n.getAttributeStreamRef(0),o=Math.min(i,1e3),h=0,l=e.getPECoordSys();Number.isNaN(t)&&(t=0);let m=e.isPannable(),g=e.getOneDegreeGCSUnit(),u=360*g,_=179*g;for(;i;){if(r=a.readRange(2*h,2*o),r0(l,o,r,t),m)for(let e=0;e<o;e++){let s=e<<1,i=r[s]-t,n=(0,b.e)(i),o=a.read(2*(h+e));n*(0,b.e)(o)<0&&Math.abs(i)>_&&(r[s]+=-n*u)}a.writeRangeFromArray(2*h,2*o,r,!0,1),h+=o,i-=o,o=Math.min(i,1e3)}n.notifyModifiedFlags(2001)}function r0(e,t,s,r){let i=m.projToGeogCenter(e,t,s,r);for(let e=0;e<t;++e){let t=e<<1;(0,S.g)(Number.isFinite(s[t]+s[t+1]))}return i}function r1(e,t,s){if(!s.hasNonLinearSegments())return void r$(e,t,s);if(s.isEmpty())return;let r=e.getPECoordSys();Number.isNaN(t)&&(t=0);let i=e.isPannable(),n=e.getOneDegreeGCSUnit(),a=360*n,o=179*n,h=s.createInstance();h.reserveParts(s.getPointCount(),s.getPathCount());let l=s.getImpl(),m=new C.S;for(let n=0,g=s.getPathCount();n<g;++n)if(l.hasNonLinearSegmentsPath(n)){let s=!0,r=-1,i=l.getPathStart(n),a=i+l.getSegmentCountPath(n);l.isClosedPath(n)&&(r=a-1);let o=new b.P;for(let n=i;n<a;++n){if(l.getSegmentBuffer(n,m,!1),function(e,t,s){switch(s.getGeometryType()){case S.G.enumLine:var r=e,i=t,n=s;let a=[n.getStartXY(),n.getEndXY()];r2(r,i,a,2),n.setStartXY(a[0]),n.setEndXY(a[1]),n.normalizeAfterEndpointChange();return;case S.G.enumBezier:var o=e,h=t,l=s;let m=(0,b.m)(b.P,4);l.queryControlPoints(m),r9(o,h,m,4),l.setControlPoints(m);return;case S.G.enumEllipticArc:return function(e,t,s){if(0===s.projectionBehavior())r5(!1,e,t,s,!1);else{let r=s.isClosed()&&s.isMajor(),i=[s.getStartXY(),r?s.getCenter():s.getEndXY()],n=[i[0].clone(),i[1].clone()];r9(e,t,n,2);let a=new G.T;a.initializeFromTwoPointsArray(i,n),s.applyTransformation(a),s.setCoordsForIntersector(n[0],n[+!r],!1)}}(e,t,s);case S.G.enumBezier2:var g=void 0,u=void 0,_=void 0;return(0,S.g)(0);case S.G.enumRationalBezier2:var d=void 0,p=void 0,c=void 0;return(0,S.g)(0);default:(0,S.c)("")}}(e,t,m.get()),!s&&(m.get().getStartXY().equals(o)||m.get().moveTo(o)),n!==r)h.addSegment(m.get(),s);else{if(s){let e=new I.P;m.get().queryStart(e),h.startPathPoint(e)}h.closeLastPathWithSegment(m.get())}o.assign(m.get().getEndXY()),s=!1}}else{let e,m=l.getPathSize(n),g=Math.min(m,1e3);h.insertPath(-1,s,n,!0);let u=l.getAttributeStreamRef(0),_=h.getAttributeStreamRef(0);for(let s=l.getPathStart(n),h=l.getPathEnd(n);s<h;){if(e=u.readRange(2*s,2*g),r0(r,g,e,t),i)for(let r=0;r<g;r++){let i=r<<1,n=e[i]-t,h=(0,b.e)(n),l=u.read(2*s);h*(0,b.e)(l)<0&&Math.abs(n)>o&&(e[i]+=-h*a)}_.writeRangeFromArray(2*s,2*g,e,!0,1),s+=g,m-=g,g=Math.min(m,1e3)}}s.assignMove(h)}function r2(e,t,s,r){let i=e.getPECoordSys();Number.isNaN(t)&&(t=0);let n=e.isPannable(),a=e.getOneDegreeGCSUnit(),o=360*a,h=179*a,l=new Float64Array(512);for(let e=0;e<r;){for(let t=e;t<r&&s[t].isNAN();++t)e++;let a=Math.min(256,r-e);if(a>0){for(let t=1,r=e+1;t<a;++t,++r)if(s[r].isNAN()){a=t;break}for(let t=0;t<a;t++){let r=t<<1;l[r]=s[e+t].x,l[r+1]=s[e+t].y}if(r0(i,a,l,t),n)for(let r=0,i=e;r<a;++r,++i){let e=r<<1,n=s[i].x,a=l[e]-t,m=(0,b.e)(a);m*(0,b.e)(n)<0&&Math.abs(a)>h&&(l[e]-=m*o)}for(let t=0;t<a;t++){let r=t<<1;s[e+t].x=l[r],s[e+t].y=l[r+1]}e+=a}}}function r4(e,t,s){var r;let i=t.getPointCount();if(!i)return!1;let n=t.getImpl(),a=n.getAttributeStreamRef(0),o=null,h=e.getInputSR(),l=e.getOutputSR();h.getVCS(),l.getVCS();let m=h.getOneDegreeGCSUnit(),g=l.getOneDegreeGCSUnit(),u=e.isVertical();u&&t.hasAttribute(1)&&(o=n.getAttributeStreamRef(1));let _=e.getDatumTransformation(),d=!!_&&1===_.getType();if(d||null===o||(o.getArray(),(0,S.g)(0),o=null),!_||0===_.count()){let e=h.getGcsUnitFactor()/l.getGcsUnitFactor(),t=(h.getPrimeMeridian()-l.getPrimeMeridian())*g,s=-90*m,r=90*m,o=0,u=a.getArray(),_=[0];for(let e=1,t=2*i;e<t;)_[0]=u[e],o|=!!(0,b.ax)(_,s,r),u[e]=_[0],e+=2;if(0!==t||1!==e){o=1;let s=a.getArray();for(let r=0,n=2*i;r<n;){let i=s[r];i*=e,i+=t,s[r]=i,s[r+1]*=e,r+=2}}return 0!==o&&n.notifyModifiedFlags(2001),!!o}let p=Math.min(i,1e3),c=(0,b.d)(p,Number.NaN),f=(0,b.d)(p,Number.NaN),x=null;null!==o&&(x=new Float64Array(p));let P=0,y=Number.NaN,E=Number.NaN,C=360*g,I=g/m;s&&(E=90*g,y=89.9*m,f.fill(0));let v=!0,G=0;for(;i;){let e=!1,t=a.readRange(2*P,2*p);for(let e=0;e<p;e++)c[e]=t[e<<1];if(s)for(let s=0;s<p;s++){let r=1+(s<<1),i=Math.abs(t[r])-y;if(i>0){let n=t[r];t[r]=(0,b.f)(y,n),f[s]=(0,b.f)(i,n),e=!0}}let r=t[0];d?(x&&o.queryRange(P,p,x,!0,1),_.transform(!1,t,x,p),x&&o.writeRangeFromArray(P,p,x,!0,1)):_.transform(!1,t,p),v&&(G=t[0]-I*r,v=!1);for(let e=0;e<p;e++){let s=e<<1,r=t[s]-c[e]*I-G;Math.abs(r)>200&&(t[s]+=r>0?-C:C)}if(e){for(let e=0;e<p;e++)if(f[e]){let s=1+(e<<1);t[s]+=I*f[e],t[s]>E?t[s]=E:t[s]<-E&&(t[s]=-E)}f.fill(0)}a.writeRangeFromArray(2*P,2*p,t,!0,1),u&&o&&o.writeRangeFromArray(P,p,x,!0,1),P+=p,i-=p,p=Math.min(i,1e3)}return n.notifyModifiedFlags(2001),!0}function r3(e,t,s){if(!t.hasNonLinearSegments())return r4(e,t,s);if(t.isEmpty())return!1;let r=t.createInstance();r.reserveParts(t.getPointCount(),t.getPathCount());let i=t.getImpl(),n=new C.S;for(let a=0,o=t.getPathCount();a<o;++a){let t=!0,o=-1,h=i.getPathStart(a),l=h+i.getSegmentCountPath(a);i.isClosedPath(a)&&(o=l-1);let m=new b.P;for(let a=h;a<l;++a){if(i.getSegmentBuffer(a,n,!1),function(e,t,s){switch(t.getGeometryType()){case S.G.enumLine:return function(e,t,s){let r=[t.getStartXY(),t.getEndXY()],i=null;t.hasAttribute(1)&&((i=[0,0])[0]=t.getAttributeAsDbl(0,1,0),i[1]=t.getAttributeAsDbl(1,1,0)),r8(e,r,i,2,s),t.setStartXY(r[0]),t.setEndXY(r[1]),i&&(t.setStartAttribute(1,0,i[0]),t.setEndAttribute(1,0,i[1])),t.normalizeAfterEndpointChange()}(e,t,s);case S.G.enumBezier:return function(e,t,s){let r=(0,b.m)(b.P,4);t.queryControlPoints(r);let i=null;t.hasAttribute(1)&&((i=[0,0,0,0])[0]=t.getAttributeAsDbl(0,1,0),i[3]=t.getAttributeAsDbl(1,1,0),i[1]=(0,b.q)(i[0],i[3],.5),i[2]=i[1]),r8(e,r,i||null,r.length,s),t.setControlPoints(r),i&&(t.setStartAttribute(1,0,i[0]),t.setEndAttribute(1,0,i[3])),t.normalizeAfterEndpointChange()}(e,t,s);case S.G.enumEllipticArc:return function(e,t,s){if(0===t.projectionBehavior())return function(e,t,s){let r=[t.getStartXY(),t.getEndXY(),t.getInteriorPoint(),t.getCenter()],i=4;t.isDegenerateToLine()&&(i=2);let n=null;if(t.hasAttribute(1)){(n=[0,0,0,0])[0]=t.getAttributeAsDbl(0,1,0),n[1]=t.getAttributeAsDbl(1,1,0);let e=(0,b.q)(n[0],n[1],.5);n[2]=e,n[3]=e}let a=t.getStartXY().equals(t.getEndXY())&&!t.isDegenerateToLine();r8(e,r,n,i,s),a?t.constructCircleCenterAndPoint(r[3],r[0],!t.isClockwise()):t.isDegenerateToLine()?t.constructLineCircularArc(r[0],r[1]):t.constructCircularArcThreePoint(r[0],r[1],r[2]),n&&(t.setStartAttribute(1,0,n[0]),t.setEndAttribute(1,0,n[1]))}(e,t,s);let r=t.getStartXY().equals(t.getEndXY()),i=(0,b.m)(b.P,3),n=(0,b.m)(b.P,3),a=null;i[0].assign(t.getStartXY()),i[1].assign(r?t.getCenter():t.getEndXY());let o=!1;t.hasAttribute(1)&&((a=[0,0,0])[0]=t.getAttributeAsDbl(0,1,0),a[1]=t.getAttributeAsDbl(1,1,0),a[2]=(0,b.q)(a[0],a[1],.5),r&&(a[1]=a[2])),n[0].setCoordsPoint2D(i[0]),n[1].setCoordsPoint2D(i[1]);let h=new G.T;if(r||t.isDegenerateToLine())r8(e,n,a,2,s),h.initializeFromTwoPoints(i[0],i[1],n[0],n[1]);else{let r=new b.P;t.queryCoord2D(.5,r),i[2].setCoordsPoint2D(r),n[2].setCoordsPoint2D(r),r8(e,n,a,3,s),h.setFromTwoTriangles(i,n)}h.isIdentity()||(t.applyTransformation(h),t.setStartXY(n[0]),t.setEndXY(r?n[0]:n[1]),t.normalizeAfterEndpointChange()),a&&(t.setStartAttribute(1,0,a[0]),t.setEndAttribute(1,0,r?a[0]:a[1]))}(e,t,s);case S.G.enumBezier2:var r=void 0,i=void 0,n=void 0;return(0,S.g)(0);case S.G.enumRationalBezier2:var a=void 0,o=void 0,h=void 0;return(0,S.g)(0);default:(0,S.c)("")}}(e,n.get(),s),!t&&(n.get().getStartXY().equals(m)||n.get().moveTo(m)),a!==o)r.addSegment(n.get(),t);else{if(t){let e=new I.P;n.get().queryStart(e),r.startPathPoint(e)}r.closeLastPathWithSegment(n.get())}m.assign(n.get().getEndXY()),t=!1}}return t.assignMove(r),!0}function r7(e,t,s,r,i,n){if(e.isIdentityGeogToGeog()){let s=90*e.getInputSR().getOneDegreeGCSUnit(),i=0,n=[0];for(let e=0;e<r;e++)n[0]=t[e].y,i|=!!(0,b.ax)(n,-s,s),t[e].y=n[0];return i}let a=e.getInputSR(),o=e.getOutputSR(),h=a.getVCS(),l=o.getVCS(),m=a.getOneDegreeGCSUnit(),g=90*m,u=o.getOneDegreeGCSUnit(),_=e.isVertical(),d=e.getDatumTransformation(),p=!!d&&1===d.getType();if(_||(s=null),!d||0===d.count()){let e=0,i=[0];for(let s=0;s<r;s++)i[0]=t[s].y,e|=!!(0,b.ax)(i,-g,g),t[s].y=i[0];return!!rf(a.getGCS(),h,o.getGCS(),l,t,s,r)|e}p||null===s||(0,S.g)(0);let c=Math.min(r,1024),f=(0,b.d)(c,Number.NaN),x=(0,b.d)(c,Number.NaN),P=0,y=Number.NaN,E=Number.NaN,C=360*u,I=u/m;i&&(E=90*u,y=89.9*m);let v=!0,G=0,w=r;for(;w;){let e=!1;for(let e=0;e<c;e++)f[e]=t[e+P].x;if(i)for(let s=0;s<c;s++){let r=Math.abs(t[s+P].y)-y;if(r>0){let i=t[s+P].y;t[s+P].y=(0,b.f)(y,i),x[s]=(0,b.f)(r,i),e=!0}}let r=t[0].x;p?d.transform(!1,t,s,c):d.transform(!1,t,c),v&&(G=t[0].x-I*r,v=!1);for(let e=0;e<c;e++){let s=t[P+e].x-f[e]*I-G;Math.abs(s)>200&&(s>0?t[P+e].x-=C:t[P+e].x+=C)}if(e){for(let e=0;e<c;e++)x[e]&&(t[P+e].y+=I*x[e],t[P+e].y>E?t[P+e].y=E:t[P+e].y<-E&&(t[P+e].y=-E));x.fill(0,0,c)}P+=c,w-=c,c=Math.min(w,1024)}return 1}function r6(e,t,s,r,i){let n;(0,S.g)(null===r),(0,S.g)(t<0x7fffffff);let a=Array.isArray(s);n=a?(0,b.ay)(s):s;let o=g.geogToGeog(e,t,n,null,i);return a&&(0,b.az)(n,s),o}function r8(e,t,s,r,i,n){let a=0,o=!0,h=0;for(let n=0;n<r;++n)t[n].isNAN()?o||(a|=r7(e,t.slice(h,n-h),s?s.slice(h,n-h):null,n-h,i),h=n,o=!0):o&&(h=n,o=!1);return o||(a|=r7(e,0===h?t:t.slice(h),s?0===h?s:s.slice(h):null,r-h,i)),0!==a}function r9(e,t,s,r){r2(e,t,s,r);let i=new E.J;i.setFromPoints(s,r);let n=e.getOneDegreeGCSUnit(),a=360*n,o=180*n;if(i.width()>o){for(let e=0;e<r;e++)for(;s[e].x<t;)s[e].x+=a;if(i.setFromPoints(s,r),i.xmax>o+t)for(let e=0;e<r;e++)s[e].x-=a}}function r5(e,t,s,r,i){let n=(0,b.m)(b.P,3),a=0,o=!1,h=!1,l=r.isDegenerateToLine();l?(n[0].assign(r.getStartXY()),n[1].assign(r.getEndXY()),n[2].setCoords(0,0),a=2):r.isClosed()&&r.isMajor()?(o=!0,h=!r.isClockwise(),n[0].assign(r.getStartXY()),n[1].assign(r.getCenter()),n[2].setCoords(0,0),a=2):(n[0].assign(r.getStartXY()),n[1].assign(r.getEndXY()),n[2].assign(r.getInteriorPoint()),a=3),e?rW(t,n,a,i):r9(t,s,n,a),l?r.constructLineCircularArc(n[0],n[1]):o?r.constructCircleCenterAndPoint(n[1],n[0],h):r.constructCircularArcThreePoint(n[0],n[1],n[2])}function ie(e,t,s){let r=(0,C.a3)(e),i=(0,C.a3)(t),n=(0,C.$)(r,i),a=(0,C.$)(r,(0,C.a3)(s));return 0===a||n>0&&a>0&&a<=n||n<0&&a<0&&a>=n}function it(e,t,s,r){let i=new b.E;i.setCoords(t,s);let n=r.width(),a=Math.floor((e-t)/n)*n+e,o=i.getCenter();for(;Math.abs(a-o)>Math.abs(a+n-o);)a+=n;return a}class is extends N.G{constructor(){super(),this.m_geometryDeque=[],this.m_index=-1}next(){if(this.m_geometryDeque.length>0){this.m_index++;let e=this.m_geometryDeque[0];return this.m_geometryDeque.shift(),e}return null}getGeometryID(){return this.m_index}tick(e){this.m_geometryDeque.push(e)}tock(){return!0}getRank(){return 1}}class ir{constructor(e,t=!0){this.m_PCSHorizon=null,this.m_GCSHorizon=null,this.m_GCSSplitLines=null,this.m_bGCSHorisonIsInclusive=!1,this.m_oneMeterPCS=0,this.m_oneDegreeGCS=0,this.m_gcsUnitFactor=0,this.m_northPole=b.P.getNAN(),this.m_southPole=b.P.getNAN(),this.m_polesUpdated=0,this.m_domain=E.J.constructEmpty(),this.m_primeMeridian=Number.NaN,this.m_geogToProjFactor=1,this.m_geogToProjOffset=0,this.m_geogToProjFactorsUpdated=0,this.m_oneMillimeter=0,this.m_centralMeridian=0,this.m_pPCSInfoNoDomain=null,this.m_oldWKID=-1973,this.m_vcsWKID=-1,this.m_bIsPannable=!1,this.m_bCached=!1,this.m_pannableExtent=E.J.constructEmpty(),this.m_pannableExtentGCS=E.J.constructEmpty(),this.m_areaOfUse=null,this.m_canonicalWkt="",this.m_peCoordSys=e,this.m_WKID=h.getCode(e),this.m_WKID<=0?(this.m_WKID=0,this.m_canonicalWkt=rT(e,0,!0),this.m_hashCode=(0,b.aw)(this.m_canonicalWkt)):this.m_hashCode=(0,b.A)(this.m_WKID);let s=this.m_peCoordSys.getType();this.m_csType=s===l.PE_TYPE_PROJCS?2:1,(0,S.g)(s===l.PE_TYPE_PROJCS||s===l.PE_TYPE_GEOGCS),s===l.PE_TYPE_PROJCS&&(e.loadConstants()||(0,S.t)("PeProjcs.loadConstants failed"));let r=s===l.PE_TYPE_GEOGCS?this.m_peCoordSys:this.m_peCoordSys.getGeogcs();s!==l.PE_TYPE_GEOGCS&&h.getCode(r),this.m_unit=function(e){var t;let s=ns(null);return e.getType()===l.PE_TYPE_PROJCS||e.getType()===l.PE_TYPE_GEOGCS?s.reset(e.getUnit()):(0,S.t)("PE_coord_sys"),s.get()||(0,S.c)("cannot create units from coord sys"),(t=s.get()).getType()===l.PE_TYPE_LINUNIT?new iv(t):t.getType()===l.PE_TYPE_ANGUNIT?new k(t):void(0,S.t)("peUnit")}(e),this.m_primeMeridian=r.getPrimem().getLongitude();{let e=r.getUnit().getUnitFactor();this.m_gcsUnitFactor=e;let t=Math.PI/(180*e);1e-10>Math.abs(t-1)&&(t=1),this.m_oneDegreeGCS=t}if(s===l.PE_TYPE_PROJCS){let e=this.m_peCoordSys,t=e.getUnit().getUnitFactor();this.m_oneMeterPCS=1/t,this.m_oneMillimeter=.001/t,this.m_pPCSInfoNoDomain=u.generate(e,u.PE_PCSINFO_OPTION_NONE),this.m_pPCSInfoNoDomain||(0,S.c)("cannot create pcs info"),this.m_bIsPannable=this.m_pPCSInfoNoDomain.isPannableRectangle(),this.m_centralMeridian=this.m_pPCSInfoNoDomain.getCentralMeridian()}else{this.m_bIsPannable=!0,this.m_polesUpdated=1,this.m_oneMeterPCS=0;let e=1/r.getUnit().getUnitFactor(),t=r.getDatum().getSpheroid().getAxis();this.m_oneMillimeter=.001/t*e,this.m_centralMeridian=0}this.m_bIsPannable&&(this.updateGCSHorizon(),this.updatePCSHorizon(),this.updatePoles(),this.updateDomain(),this.updatePannableExtent(),this.updatePannableExtentGCS())}[Symbol.dispose](){}getHashCode(){return this.m_hashCode}getPCSHorizonPannable(){return this.m_PCSHorizon}getGCSHorizonPannable(){return this.m_GCSHorizon}getPCSInfo(){return(0,S.g)(this.m_pPCSInfoNoDomain),this.m_pPCSInfoNoDomain}getCentralMeridian(){return this.m_centralMeridian}updateGCSHorizon(){let e,t;if(this.m_peCoordSys.getType()!==l.PE_TYPE_PROJCS)return;let s=!0,r=this.m_peCoordSys,i=r.getGeogcs(),n=r.horizonGcsGenerate();if(!n)return;(0,S.g)(n.length>0);let a=n[0].getNump(),o=n[0].getKind();s=n[0].getInclusive()>0;let h=this.getOneDegreeGCSUnit(),m=90*h,g=360*h,u=180*h*l.PE_HORIZON_DELTA/Math.PI,_=E.J.constructEmpty(),d=null;if(a>1){for(let e=1;e<a;e++)if(n[e].getKind()===l.PE_HORIZON_LINE){d||(d=new C.P);let t=n[e].getCoord();d.startPathCoords(t[0][0],t[0][1]),d.lineToCoords(t[1][0],t[1][1])}}if(o===l.PE_HORIZON_RECT){let e=n[0].getCoord();if(_.setFromPoints([new b.P(e[0][0],e[0][1]),new b.P(e[1][0],e[1][1])],2),Math.abs(_.ymax-m)<1e-7*u&&(_.ymax=m),Math.abs(_.ymin+m)<1e-7*u&&(_.ymin=-m),_.width()>370*h){let e=-400*h;_.setCoords({xmin:e,ymin:_.ymin,xmax:e+5*g,ymax:_.ymax})}let t=new I.E({env2D:_});this.m_GCSHorizon||(this.m_GCSHorizon=t,this.m_bGCSHorisonIsInclusive=s)}else{let r=this.getPCSInfo().isGcsHorizonMultiOverlap(),o=iU(i,null,null,1),u=[],_=new b.E;for(let t=0;t<a;t++){if(n[t].getKind()!==l.PE_HORIZON_POLY)continue;e=n[t].getSize();let s=n[t].getCoord(),r=E.J.constructEmpty();r.setFromPoints((0,b.aB)(s),e),u.push(new b.E(r.xmin,r.xmax)),r.width(),_.merge(u.at(-1))}let p=!1,c=new b.E;_.width()>g&&u.length>1?(c.vmin=this.getCentralMeridian()-g,c.vmax=c.vmin+2*g,p=!0,r=!0):(c.vmin=_.vmin,c.vmax=c.vmin+g);let f=e=>{let t=0;for(;u[e].vmin+t<c.vmin;)t+=g;for(;u[e].vmax+t-g>c.vmin;)t-=g;return t},x=new C.a;if(r){let s=new is,r=(new rI).executeMany(s,o,null);for(let i=0;i<a;i++){if(n[i].getKind()!==l.PE_HORIZON_POLY)continue;e=n[i].getSize();let a=n[i].getCoord();t=n[i].getInclusive()>0;let o=new C.a;if(o.addPathPoint2D((0,b.aB)(a),e-1,!0),p){let e=f(i),t=u[i].clone();t.move(e);let r=e,n=new G.T;do{n.setShiftCoords(r,0);let e=o.clone();e.applyTransformation(n),s.tick(e),s.tock(),r+=g,t.move(g)}while(t.vmin<c.vmax)}else s.tick(o),r.tock()}x=r.next()}else{x=new C.a;for(let r=0;r<a;r++){if(n[r].getKind()!==l.PE_HORIZON_POLY)continue;e=n[r].getSize();let i=n[r].getCoord();if(t=n[r].getInclusive()>0,(0,S.g)(t===s),p){let t=new C.a;t.addPathPoint2D((0,b.aB)(i),e-1,!0);let s=f(r),n=u[r].clone();n.move(s);let a=s,o=new G.T;do{if(0!==a){o.setShiftCoords(a,0);let e=new C.a({copy:t});e.applyTransformation(o),x.addPath(e,0,!0)}else x.addPath(t,0,!0);a+=g,n.move(g)}while(n.vmin<c.vmax)}else x.addPathPoint2D((0,b.aB)(i),e-1,!0)}}p&&(x=(new w.O).execute(x,new E.J(c.vmin,-m-h,c.vmax,m+h),o,null)),s?(new sB).accelerateGeometry(x,o,1):(new rS).accelerateGeometry(x,o,1),(new rG).accelerateGeometry(x,o,1),null===this.m_GCSHorizon&&(this.m_GCSHorizon=x,this.m_bGCSHorisonIsInclusive=s,this.m_GCSSplitLines=d)}}updateAreaOfUse(){return null}updatePCSHorizon(){let e;if(this.m_peCoordSys.getType()!==l.PE_TYPE_PROJCS)return;let t=this.m_peCoordSys.horizonPcsGenerate();if(!t)return;this.getPCSInfo();let s=t[0].getKind();t[0].getInclusive();let r=E.J.constructEmpty(),i=t[0].getNump(),n=!1;if(s===l.PE_HORIZON_RECT){let s=t[0].getCoord();r.setFromPoints((0,b.aB)(s),2),e=new I.E({env2D:r})}else{let s=-1;for(let e=0;e<i;e++)t[e].getKind()===l.PE_HORIZON_POLY&&(s=e);(0,S.g)(s>=0);let r=t[s].getSize()-1,a=t[s].getCoord(),o=new C.a;e=o,o.addPathPoint2D((0,b.aB)(a),r,!0),n=!0}if(this.getPCSInfo().isDensificationNeeded()){(0,S.g)(s!==l.PE_HORIZON_RECT);let t=1e5*this.getOneMeterPCSUnit();e=(new T.O).execute(e,t,0,0,null)}if(n){{let t=new I.E;e.queryEnvelope(t),e.calculateArea2D(),e.calculateLength2D(),e.getExteriorRingCount()}(new sB).accelerateGeometry(e,null,1)}null===this.m_PCSHorizon&&(this.m_PCSHorizon=e)}updatePannableExtent(){let e=this.m_peCoordSys.getType();if(e===l.PE_TYPE_PROJCS){let e=this.m_peCoordSys,t=this.getPCSInfo().getCentralMeridian(),s=e.getGeogcs();s||(0,S.c)("");let r=[t+1/s.getUnit().getUnitFactor()*Math.PI,0];m.geogToProj(e,1,r);let i=r[0],n=e.getParameters()[l.PE_PARM_X0].getValue(),a=this.getPCSHorizon(),o=E.J.constructEmpty();a.queryEnvelope(o);let h=Math.abs(i-n),g=o.ymax,u=o.ymin;this.m_pannableExtent.setCoords({xmin:-1*h+n,ymin:u,xmax:h+n,ymax:g})}else if(e===l.PE_TYPE_GEOGCS){let e=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtent.setCoords({xmin:-e,ymin:-e/2,xmax:e,ymax:e/2})}else(0,S.c)("")}updatePannableExtentGCS(){let e=this.m_peCoordSys.getType();if(e===l.PE_TYPE_PROJCS){let e=this.m_peCoordSys,t=this.m_centralMeridian,s=e.getGeogcs();s||(0,S.c)("");let r=1/s.getUnit().getUnitFactor()*Math.PI,i=this.getGCSHorizon(),n=E.J.constructEmpty();i.queryEnvelope(n),this.m_pannableExtentGCS.setCoords({xmin:t-r,ymin:n.ymin,xmax:t+r,ymax:n.ymax})}else if(e===l.PE_TYPE_GEOGCS){let e=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtentGCS.setCoords({xmin:-e,ymin:-e/2,xmax:e,ymax:e/2})}else(0,S.c)("")}updateDomain(){if(1===this.m_csType){let e=400*this.getOneDegreeGCSUnit();this.m_domain=E.J.construct(-e,-e,e,e)}else{(0,S.g)(2===this.m_csType);let e=u.generate(this.m_peCoordSys,u.PE_PCSINFO_OPTION_DOMAIN);e||(0,S.c)("generate pcs info failed");let t=new E.J(e.getDomainMinx(),e.getDomainMiny(),e.getDomainMaxx(),e.getDomainMaxy());this.m_domain.isEmpty()&&this.m_domain.setCoords({env2D:t})}}updatePoles(){if(this.m_peCoordSys.getType()===l.PE_TYPE_PROJCS){let e=90*this.getOneDegreeGCSUnit(),t=[[0,e],[0,-e]];m.geogToProj(this.m_peCoordSys,2,t);let s=this.getPCSInfo().getNorthPoleLocation()!==u.PE_POLE_OUTSIDE_BOUNDARY,r=this.getPCSInfo().getSouthPoleLocation()!==u.PE_POLE_OUTSIDE_BOUNDARY;this.m_polesUpdated||(s&&this.m_northPole.setCoords(t[0][0],t[0][1]),r&&this.m_southPole.setCoords(t[1][0],t[1][1]),this.m_polesUpdated=1)}else this.m_polesUpdated=1}updateGeogToProjFactors(){if(this.m_peCoordSys.getType()===l.PE_TYPE_PROJCS){let e=this.getOneDegreeGCSUnit(),t=this.m_pPCSInfoNoDomain.getCentralMeridian(),s=[0,0,0,0];s[0]=t,s[1]=0,s[2]=t+e,s[3]=0;let r=m.geogToProj(this.m_peCoordSys,2,s);(0,S.g)(2===r);let i=(s[2]-s[0])/e,n=s[0];0===this.m_geogToProjFactorsUpdated&&(this.m_geogToProjFactor=i,this.m_geogToProjOffset=n,this.m_geogToProjFactorsUpdated=1)}else this.m_geogToProjFactorsUpdated=1}getOneMeterPCSUnit(){return this.m_oneMeterPCS}getOneDegreeGCSUnit(){return this.m_oneDegreeGCS}getGcsUnitFactor(){return this.m_gcsUnitFactor}getUnitsPerMillimeter(){return this.m_oneMillimeter}getGCSSplitLines(){return this.m_bIsPannable?null:(this.m_GCSHorizon||this.updateGCSHorizon(),this.m_GCSSplitLines)}getGCSHorizon(){return this.m_bIsPannable?this.getGCSHorizonPannable():(null!==this.m_GCSHorizon||this.updateGCSHorizon(),this.m_GCSHorizon)}getGCSHorisonIsInclusive(){return this.m_bIsPannable||this.getGCSHorizon(),this.m_bGCSHorisonIsInclusive}getPCSHorizon(){return this.m_bIsPannable?this.getPCSHorizonPannable():(null!==this.m_PCSHorizon||this.updatePCSHorizon(),this.m_PCSHorizon)}getPole(e){return this.m_bIsPannable||0!==this.m_polesUpdated||this.updatePoles(),e?this.m_southPole:this.m_northPole}getGeogToProjFactors(){return 0===this.m_geogToProjFactorsUpdated&&this.updateGeogToProjFactors(),(0,b.n)(this.m_geogToProjFactor,this.m_geogToProjOffset)}getDomainXY(){if(this.m_bIsPannable)return this.m_domain.clone();let e=!1;return this.m_domain.isEmpty()&&this.updateDomain(),this.m_domain.clone()}getPrimeMeridian(){return this.m_primeMeridian}getLatestID(){return this.m_WKID}getOldID(){let e=this.m_oldWKID;if(e<0){if(e=0,this.m_WKID>0){var t,s,r,i;let n=[0];t=this.m_peCoordSys.getType(),s=this.m_WKID,r=n,i=[0],(s<=0?(r[0]=0,i[0]=0,1):(r[0]=s,i[0]=s,0))&&(0,S.c)("query_code_change"),e=n[0]}this.m_oldWKID=e}return e}isCustomWkid(){return!1}isPannable(){return this.m_bIsPannable}getPannableExtent(){return this.m_pannableExtent.clone()}getPannableExtentGCS(){return this.m_pannableExtentGCS.clone()}getAreaOfUse(){return null!==this.m_areaOfUse?this.m_areaOfUse:this.updateAreaOfUse()}getVcsCode(){return 0}saveMemory(){}getCSType(){return this.m_csType}getUnit(){return this.m_unit}setCached(){this.m_bCached=!0}getCached(){return this.m_bCached}static equal(e,t){return!1}static equal_for_projection(e,t){return!1}}class ii{constructor(e,t=!0){this.m_oneMeter=0,this.m_WKID=-1,this.m_oldWKID=-1,this.m_canonicalWkt="not yet implemented",this.m_model=0,this.m_unit=new iv,this.m_cached=!1}setCached(e=!0){this.m_cached=e}getCached(){return this.m_cached}getOneMeterUnit(){return 0}getLatestID(){return this.m_WKID}getOldID(){let e=this.m_oldWKID;return e<0&&(e=0,this.m_WKID>0&&(e=this.m_WKID),this.m_oldWKID=e),e}getModel(){return 0}isCustomWkid(){return!1}getVerticalUnit(){return this.m_unit}static equal(e,t){return!1}static equal_for_projection(e,t){return!1}}function ia(e,t,s,r){var n,a,o,h,l,m,g,u,_;return n=0,a=e,o=t,h=s,l=r,iF()||(0,S.r)("cannot create projection transformation"),a.hasVCS()&&o.hasVCS()?((0,S.g)(0),{}):function(e,t,s,r){var n,a;e&&t||(0,S.t)("!inputSR || !outputSR");let o=e.getLatestID(),h=t.getLatestID();if(3857===o&&4326===h){if(e.m_bDefaultDescriptor&&t.m_bDefaultDescriptor)return iS()}else if(4326===o&&3857===h&&e.m_bDefaultDescriptor&&t.m_bDefaultDescriptor)return i||(i=iS().getInverse()),i;let l=E.J.constructEmpty();l.setCoords({env2D:s});let m=e.getCoordinateSystemType(),g=t.getCoordinateSystemType();if(0===m||0===g)return ig(e,t);if(r){let s=r.find(0,e.getGCS(),t.getGCS());if(s)return ig(e,t,s)}let u=e.getGCS().getLatestID(),_=t.getGCS().getLatestID();if(u>0&&u===_)return ig(e,t);let d=new iy(e,t,s);{let e=function(e){if(iE.has(e.getHashCode()))return iE.get(e.getHashCode())}(d);if(e)return e}let p=il(0,e,t,l,1,!0);return n=d,a=ig(e,t,p.length?p[0]:void 0),iE.set(n.getHashCode(),a),a}(a,o,h,l)}function io(e,t,s,r){return ih(!0,e,t,s,r)}function ih(e,t,s,r,i,n){return iF()||(0,S.r)("cannot create projection transformation"),new id(e?2:1,t,s,r,i,n)}function il(e,t,s,r,i,n=!1){if(t&&s||(0,S.t)(""),iF()||(0,S.r)("cannot obtain geotransformation list"),1===e&&t.hasVCS()&&s.hasVCS())return(0,S.b)("hv xform not impl"),[];{let e=ng(t,s,r,i,n),a=[];for(let t of e)a.push(t);return a}}function im(){return{centralMeridianOfOutputGCS:Number.NaN,densificationStep:Number.NaN,clipWithInputHorizon:!0,clipWithOutputHorizon:!0,legacyHorizonClipping:!1,normalizeResultGeometry:!1,equals(e){return(0,b.a3)(this.centralMeridianOfOutputGCS,e.centralMeridianOfOutputGCS)&&(0,b.a3)(this.densificationStep,e.densificationStep)&&this.clipWithInputHorizon===e.clipWithInputHorizon&&this.clipWithOutputHorizon===e.clipWithOutputHorizon&&this.legacyHorizonClipping===e.legacyHorizonClipping&&this.normalizeResultGeometry===e.normalizeResultGeometry}}}function ig(e,t,s,r,i){return new id(1,e,t,s,r,i)}function iu(){return{flagsMask:0,setFlag(e,t){t?this.flagsMask|=e:this.flagsMask&=~e},hasFlag(e){return!!(this.flagsMask&e)}}}function i_(){return{m_extendedParams:im(),m_extendedParamsInternal:iu()}}let id=class e{constructor(e,t,s,r,i,n){let a,o;this.m_datumTran=null,this.m_bIdentity=!0,this.m_bIdentityGeogToGeog=!0,this.m_bVertical=!1,this.m_bNormalize=!1,t&&s||(0,S.t)("!inputSR || !outputSR"),r&&0===r.getType()&&(r.m_bReadOnly=!0),this.m_bNormalize=!1,1!==e&&(a=t.getVCS(),o=s.getVCS(),this.m_bVertical=null!=a&&null!=o),this.m_inputSR=t,this.m_outputSR=s,this.m_bIdentity=!1,this.m_bIdentityGeogToGeog=!1,(0,S.g)(!this.m_params),i&&(this.m_params=i_(),this.m_params.m_extendedParams=i),n&&(this.m_params||(this.m_params=i_()),this.m_params.m_extendedParamsInternal=n);let h=!1,l=null!=r,m=t.getCoordinateSystemType(),g=s.getCoordinateSystemType();if(s.isPannable()&&0!==m&&i){let e=i.centralMeridianOfOutputGCS;if(!Number.isNaN(e)&&s.isPannable()){let t=s.getPannableExtent(),r=t.getCenterX();if(r!==e){let s=Math.ceil(t.width());e+s!==r+s&&(h=!0)}}}let u=i&&i.normalizeResultGeometry;if(t.equals(s))return this.m_bIdentity=!h,this.m_bIdentityGeogToGeog=!0,void this.updateProjector();let _=!l&&t.equalForProjection(s,this.m_bVertical);this.m_bIdentity=_&&!h,this.m_bIdentity?this.m_bIdentityGeogToGeog=!0:0!==m&&0!==g&&(u&&this.m_outputSR.isPannable()&&(this.m_bNormalize=u),this.m_datumTran=r||null,this.m_bIdentityGeogToGeog=(!this.m_datumTran||0===this.m_datumTran.count())&&this.m_inputSR.getGCS().equalForProjection(this.m_outputSR.getGCS(),this.m_bVertical)),this.updateProjector()}getInputSR(){return this.m_inputSR}getOutputSR(){return this.m_outputSR}getDatumTransformation(){return this.m_datumTran}getInverse(){let t=new e(1,this.m_outputSR,this.m_inputSR,this.m_datumTran?.createInverse());return t.m_bIdentity=this.m_bIdentity,t.m_bVertical=this.m_bVertical,t.m_bIdentityGeogToGeog=this.m_bIdentityGeogToGeog,t.updateProjector(),t}isIdentity(){return this.m_bIdentity}getExtendedParams(){return this.m_params?this.m_params.m_extendedParams:i_().m_extendedParams}equals(e){return(0,S.g)(0),!1}isVertical(){return this.m_bVertical}isMatchingTransformation(e,t){return(0,S.g)(0),!1}getGeographicTransformations(){return this.m_datumTran}getExtendedParamsImpl(){return this.m_params?this.m_params.m_extendedParams:i_().m_extendedParams}getExtendedParamsInternal(){return this.m_params?this.m_params.m_extendedParamsInternal:i_().m_extendedParamsInternal}isIdentityGeogToGeog(){return this.m_bIdentityGeogToGeog}normalizeOutput(){return this.m_bNormalize}updateProjector(){this.m_projector=new sz(this)}},ip=new Map,ic=new Map,ix=new Map;function iP(e){let t=e.getCode();if(t>0)return ib(t)||iI(h.coordsys(t));let s=e.getName();if(ic.has(s)){let t=ic.get(s);if(t&&t.deref()){let s=t.deref();if(s.m_peCoordSys.isEqual(e))return s}}return iI((t=h.getCode(e))>0?h.coordsys(t):e)}class iy{constructor(e,t,s){this.m_hashCode=-1,e&&(this.m_inputSR=e,this.m_outputSR=t,this.m_env=s.clone(),this.m_hashCode=this.m_inputSR.getHashCode(),this.m_hashCode=(0,b.aq)(this.m_hashCode,this.m_outputSR.getHashCode()),this.m_env.isEmpty()||(this.m_hashCode=(0,b.aq)(this.m_hashCode,(0,b.at)(this.m_env.xmin)),this.m_hashCode=(0,b.aq)(this.m_hashCode,(0,b.at)(this.m_env.xmax)),this.m_hashCode=(0,b.aq)(this.m_hashCode,(0,b.at)(this.m_env.ymin)),this.m_hashCode=(0,b.aq)(this.m_hashCode,(0,b.at)(this.m_env.ymax))))}getHashCode(){return this.m_hashCode}equals(e){return!(this.m_inputSR&&!e.m_inputSR||!this.m_inputSR&&e.m_inputSR)&&this.m_env.equals(e.m_env)&&this.m_inputSR.equals(e.m_inputSR)&&this.m_outputSR.equals(e.m_outputSR)}clear(){this.m_inputSR=void 0,this.m_outputSR=void 0,this.m_hashCode=-1,this.m_env=void 0}}let iE=new Map;function iS(){return r||(r=io(i1(),i4())),r}let iC=new Map;function iI(e){let t=ns(e),s=e.getCode();if(s>0){let e=ib(s);if(e)return e}let r=e.getName(),i=ic.get(r);if(i){let t=i.deref();if(t&&t.m_peCoordSys.isEqual(e))return t}let n=new ir(t.release());if(s>0)return n.setCached(),ip.set(s,new WeakRef(n)),ic.set(r,new WeakRef(n)),n;let a=rT(e,0,!1);if(i=ix.get(a)){let e=i.deref();if(e)return e}return n.setCached(),ix.set(a,new WeakRef(n)),n}function ib(e){let t=ip.get(e);if(t)return t.deref()}class iv extends V{constructor(e){return void 0===e?(super(),this.m_wkid=9001,void(this.m_peUnit=null)):"number"==typeof e?(super(),this.m_factor=e,void(this.m_wkid=0)):(super(e),void(e||(this.m_factor=1,this.m_wkid=9001,this.m_peUnit=(n||(n=h.unit(9001)),n))))}getUnitType(){return 0}convertFromMeters(e){return e/this.getUnitToBaseFactor()}convertToMeters(e){return e*this.getUnitToBaseFactor()}}let iG=["0","1","2","3","4","5","6","7","8","9","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","w","x","y","z"];function iw(e,t,s,r,i){(0,S.g)(r>>5<i.length);let n=t,a=s;for(let t=r;t>=0;t-=2){let s=31&t,r=.5*(a+n);e>=r?(i[t>>5]|=1<<s,n=r):a=r}}let iT=new Set,iN="operation is not supported for unknown coordinate systems";function iD(){return{majorSemiAxis:0,e2:0,minorSemiAxis:0,flattening:0,isSphere(){return 0===this.e2}}}function iV(e){nr=e,(0,S.g)(nr)}function iF(){return!!h}function iH(){return!!nr}function ik(){return!!h||!!nr}function iA(e,t,s){return(0,S.g)(ik()),i9(e,void 0===t?0:t,null,!1)}function iM(e,t){let s;(0,S.g)(ik());let r=new i$;return iF()?(s=function(e){let t=ns(h.fromString(l.PE_TYPE_COORDSYS,e));return t.get()||(0,S.z)(e),iP(t.release())}(e),r.setHorzProj_(s),r.m_vertcs=null,r.m_userWKID=s.getLatestID()):r.m_unit=(s=ni(e)).isPCS?new iv(s.metersOrRadiansPerUnit):new k(s.metersOrRadiansPerUnit),i7(r.m_precisionDescriptor,s,null,1),r.m_bDefaultDescriptor=!0,r.m_userWKT=e,r.calculateHashCode(),r.initDbgName(),r}function iU(e,t,s,r,i=!0){let n=null;return t&&(n=function(e,t=!0){return(0,S.g)(0),{}}(0,i)),function(e,t,s,r,i){let n;e||(0,S.t)("!PE_coord_sys");let a=new i$;return n=i?iP(e):new ir(e,!1),i7(a.m_precisionDescriptor,n,t,r),a.m_bDefaultDescriptor=!0,a.setHorzProj_(n),a.m_vertcs=t,a.m_userWKID=n.getLatestID(),a.calculateHashCode(),a.initDbgName(),a}(e,n,0,r,i)}function iq(e,t,s=!1){3===e.getCoordinateSystemType()&&(0,S.t)("image spatial reference cannot be altered");let r=new i$;return r.m_peCoordSysVal=e.m_peCoordSysVal,r.m_vertcs=e.m_vertcs,r.m_unit=e.m_unit,r.m_precisionDescriptor.assign(t),r.m_localZToXYFactor=e.m_localZToXYFactor,(Number.isNaN(r.m_precisionDescriptor.m_falseX)||Number.isNaN(r.m_precisionDescriptor.m_falseY))&&(r.m_precisionDescriptor.m_falseX=e.m_precisionDescriptor.m_falseX,r.m_precisionDescriptor.m_falseY=e.m_precisionDescriptor.m_falseY),r.m_precisionDescriptor.snapPrecision(),r.m_precisionDescriptor.fixTolerance(),r.m_userWKID=e.m_userWKID,r.m_precisionDescriptor.equals(e.m_precisionDescriptor)?r.m_bDefaultDescriptor=e.m_bDefaultDescriptor:r.m_bDefaultDescriptor=!1,s&&(r.m_bDefaultDescriptor=!0),r.calculateHashCode(),r.initDbgName(),r}function iO(e,t,s){return{}}function iB(e,t,s){void 0===t&&(t=1),(t<=0||!Number.isFinite(t))&&(0,S.t)(""),e||1===t||(0,S.t)("null Unit has to have z_to_xy_factor equal to 1");let r=new i$;r.m_unit=e;let i=e||new iv(9001);return i8(r.m_precisionDescriptor,i,null,1),r.m_bDefaultDescriptor=!0,Number.isNaN(r.m_precisionDescriptor.m_falseX)&&(0,S.t)("NAN false X/Y are not allowed here"),r.m_localZToXYFactor=t,r.calculateHashCode(),r.initDbgName(),r}function iR(e,t){return e.snapGeometry(t)}function iY(e){let t=e.getCoordinateSystemType();return 1===t?e:(3===t&&(0,S.g)(0),e.getGCS())}function iX(e){var t,s;return(0,S.g)(ik()),iH()?(t=e,(0,S.g)(iH()),!!nr(t).isPCS||(s=t,h&&(0,S.m)("pe has been loaded. no-pe methods should not be used at this point."),ne||na(),ne.has(s))):function(e){if(iC.has(e))return iC.get(e);{let t=null!==ns(h.coordsys(e)).get();return iC.set(e,t),t}}(e)}function iL(e){if(iF())return null!==ns(h.fromString(l.PE_TYPE_COORDSYS,e)).get();try{return ni(e),!0}catch(e){}return!1}function iz(){return a||(a=(()=>{let e=Math.trunc(Math.random()*(0,b.i)()),t=Date.now();return`|abba_000|${e.toString(16)}|${t.toString(16)}|`})()),a}!function(e){e[e.utmDefault=0]="utmDefault",e[e.utmNorthSouth=1]="utmNorthSouth"}(y||(y={}));let iJ=0;function iW(e=""){let t=`${iz()}${iJ++}`;return""!==e&&(t+=`|${e}`),t}function ij(e){return e.startsWith(iz())}let iZ,iK,iQ,i$=class e{destroy(){var e;e=this.m_peCoordSysVal,ic.delete(e.m_peCoordSys.getName()),ix.delete(rT(e.m_peCoordSys,0,!1)),1===this.getCoordinateSystemType()||2===this.getCoordinateSystemType()?this.getPECoordSys().destroy():(0,S.c)("SpatialReference.destroy")}constructor(){this.m_vertcs=null,this.m_peCoordSysVal=null,this.m_userWKID=0,this.m_userWKT=null,this.m_geogSpatialReference=null,this.m_srToGcs=null,this.m_gcsToSr=null,this.m_defaultPrecisionSR=null,this.m_localZToXYFactor=-1,this.m_precisionDescriptor=new i0,this.m_hashCode=0,this.m_bDefaultDescriptor=!1,i3(this.m_precisionDescriptor),iT&&iT.add(new WeakRef(this))}attachToPe(){(this.m_userWKID>0?iA(this.m_userWKID):iM(this.m_userWKT)).copyTo(this,!1)}copyTo(e,t=!0){(t||e.m_bDefaultDescriptor)&&(e.m_bDefaultDescriptor=this.m_bDefaultDescriptor,e.m_precisionDescriptor.assign(this.m_precisionDescriptor)),e.m_defaultPrecisionSR=null,e.m_gcsToSr=this.m_gcsToSr,e.m_geogSpatialReference=this.m_geogSpatialReference,e.m_hashCode=this.m_hashCode,e.m_localZToXYFactor=this.m_localZToXYFactor,e.m_peCoordSysVal=this.m_peCoordSysVal,e.m_srToGcs=this.m_srToGcs,e.m_userWKID=this.m_userWKID,e.m_userWKT=this.m_userWKT,e.m_vertcs=this.m_vertcs,e.m_unit=this.m_unit}getHashCode(){return this.m_hashCode}getHashCodeHorizontal(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getHashCode():this.m_unit?this.m_unit.getHashCode():0x12345673}updateTransform(e){if(1===this.getCoordinateSystemType())return io(this,this,null);let t=e?this.m_srToGcs:this.m_gcsToSr;if(t)return t;let s=this.getGCS(),r=t=e?io(this,s,null):io(s,this,null);return(e?this.m_srToGcs:this.m_gcsToSr)||(e?this.m_srToGcs=r:this.m_gcsToSr=r,t)}getHashCodeVertical(){return this.m_vertcs?this.m_vertcs.getHashCode():0}calculateHashCode(){let e=this.getHashCodeHorizontal(),t=this.getHashCodeVertical(),s=this.m_precisionDescriptor.getHashCode();e=(0,b.aq)(e,t),this.m_hashCode=(0,b.aq)(e,s)}initDbgName(){}setHorzProj_(e){this.m_peCoordSysVal=e,this.m_unit=this.m_peCoordSysVal.getUnit()}getTolerance(e=0){return this.m_precisionDescriptor.getTolerance(e)}getResolution(e=0){return this.m_precisionDescriptor.getResolution(e)}getPECoordSys(){return this.m_peCoordSysVal?this.m_peCoordSysVal.m_peCoordSys:null}getPCSInfo(){return this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSInfo()}getCentralMeridian(){return(this.throwIfNotGCSOrPCS(),1===this.getCoordinateSystemType())?0:this.getPCSInfo().getCentralMeridian()}getCoordinateSystemType(){let e=this.getPECoordSys();if(e)switch(e.getType()){case l.PE_TYPE_GEOGCS:return 1;case l.PE_TYPE_PROJCS:return 2}else{if((this.m_userWKID>0||this.m_userWKT)&&this.m_unit instanceof iv)return 2;if(this.m_unit instanceof k)return 1}return 0}getID(){return this.m_userWKID}getLatestID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getLatestID():this.m_userWKID}getOldID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getOldID():this.m_userWKID}getVerticalID(){return(0,S.b)("vcs not implemented"),0}getLatestVerticalID(){return this.m_vertcs?this.m_vertcs.getLatestID():0}getOldVerticalID(){return(0,S.b)("vcs not implemented"),0}getPEVerticalCoordSys(){return null}getPole(e){return this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPole(e)}getText(){let e=this.getPECoordSys();return e?rN(e):this.m_userWKT??""}getTextExtended(e){var t;let s=this.getPECoordSys();return s?this.getPEVerticalCoordSys()?(this.getPEVerticalCoordSys(),(0,S.g)(0),""):rN(s,e):this.m_userWKT??""}getText2(e=-1){let t,s=this.getPECoordSys();return s?((e>1||e<-1)&&(0,S.t)("verbosity"),t=l.PE_STR_FMT_WKT2,-1!==e&&(t|=0===e?l.PE_STR_AUTH_TOP:l.PE_STR_AUTH_ALL),s.toString(t)):this.m_userWKT??""}getUnit(){return this.m_unit}getUnitsPerMillimeter(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getUnitsPerMillimeter():this.m_unit instanceof iv?.001/this.m_unit.getUnitToBaseFactor():this.m_unit instanceof k?.001/(ni(this.m_userWKT??this.m_userWKID).semiMajor*this.m_unit.getUnitToBaseFactor()):((0,S.m)("sr object not in valid state"),0)}getAuthorityName(){return this.getPECoordSys()&&(0,S.g)(0),""}getVerticalUnit(){return(0,S.b)("vcs not implemented"),{}}getVCS(){return this.m_vertcs}hasVCS(){return!1}getGCSHorisonIsInclusive(){return this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorisonIsInclusive()}getGCSHorizon(){return this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorizon()}getGCS(){let e,t=this.getCoordinateSystemType();if(0===t)(0,S.m)(iN);else{if(1===t)return this;3===t&&(0,S.m)("image cs not supported")}if(this.m_geogSpatialReference)return this.m_geogSpatialReference;if(this===i1()||this===i2())e=i4();else{(0,S.g)(this.m_peCoordSysVal);let t=this.m_peCoordSysVal.m_peCoordSys.getGeogcs();t||(0,S.c)(""),e=iU(t,this.m_vertcs,null,this.m_precisionDescriptor.getPrecision(),this.m_peCoordSysVal.getCached())}return this.m_geogSpatialReference?e=this.m_geogSpatialReference:this.m_geogSpatialReference=e,e}getGCSSplitLines(){return this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSSplitLines()}toGCS(e,t){if(0===e.length)return 0;e.length>t.length&&(0,S.t)("coordsSrc.size() > coordsDst.size()");let s=this.getCoordinateSystemType();if(0===s&&(0,S.m)(iN),1===s)return(0,b.au)(t,e,e.length),e.length;(0,S.g)(this.m_peCoordSysVal);let r=this.getSRToGCSTransform();return(new sj).transform(r,e,e.length,t)}toGeohash(e,t=8){let s=e.clone();s.scale(9102===this.getGCS().getUnit().getID()?1:this.getGCS().getUnit().getUnitToBaseFactor()/Math.PI*180),s.x<-180?(s.x=(0,b.o)(s.x,360),s.x<-180&&(s.x+=360)):s.x>180&&(s.x=(0,b.o)(s.x,360),s.x>180&&(s.x-=360)),s.y>90&&(s.y=90),s.y<-90&&(s.y=-90);let r=5*t,i=new Uint32Array(4);return iw(s.x,-180,180,r-1,i),iw(s.y,-90,90,r-2,i),function(e,t,s){let r=(0,b.d)(t,"R"),i=0,n=0;for(let s=0;s<t;s++){let a=e[i]>>n&31;if((n+=5)>31){let t=37-n;a&=(1<<t)-1,n-=32,a|=(e[++i]&(1<<n)-1)<<t}let o=iG[a];r[t-1-s]=o}return s>t?r.push(..."0".repeat(s-t)):s<t&&(r.length=s),r.join("")}(i,t,t)}isPannable(){let e=this.getCoordinateSystemType();return 0!==e&&3!==e&&((0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.isPannable())}getPannableExtent(){return this.isPannable()||(0,S.t)("!is_pannable"),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtent()}getPannableExtentInGCS(){return this.isPannable()||(0,S.t)("!is_pannable"),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtentGCS()}throwIfNotGCSOrPCS(){let e=this.getCoordinateSystemType();1!==e&&2!==e&&(0,S.t)("Not a GCS or PCS")}getDomainXY(){return this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getDomainXY()}getFullWorldExtent(){return this.throwIfNotGCSOrPCS(),this.isPannable()?this.getPannableExtent():this.getDomainXY()}queryPrecisionDescriptor(e){if(e.assign(this.m_precisionDescriptor),Number.isNaN(e.m_falseX))if(iF()||(0,S.r)("cannot query precision descriptor"),(0,S.g)(null!==this.m_peCoordSysVal),2!==this.m_precisionDescriptor.m_precision){let t=this.m_peCoordSysVal.getDomainXY();e.m_falseX=t.xmin,e.m_falseY=t.ymin}else e.m_falseX=-Number.MAX_VALUE,e.m_falseY=-Number.MAX_VALUE}queryPrecisionDescriptorWithoutFalseXY(e){e.assign(this.m_precisionDescriptor),e.m_falseX=Number.NaN,e.m_falseY=Number.NaN}queryDefaultPrecisionDescriptorWithoutFalseXY(e){if(this.m_bDefaultDescriptor)e.assign(this.m_precisionDescriptor);else{let t=this.getCoordinateSystemType();0===t?i8(e,this.m_unit,this.m_vertcs,this.m_precisionDescriptor.getPrecision()):3===t?(0,S.b)("image cs"):i7(e,this.m_peCoordSysVal,this.m_vertcs,this.m_precisionDescriptor.getPrecision())}e.m_falseX=Number.NaN,e.m_falseY=Number.NaN}horizontalEqual(e){var t,s;return(t=this.m_peCoordSysVal)===(s=e.m_peCoordSysVal)||null!==t&&null!==s&&t.m_csType===s.m_csType&&(0===t.m_WKID&&0===s.m_WKID?t.m_hashCode===s.m_hashCode&&t.m_canonicalWkt===s.m_canonicalWkt:t.m_WKID===s.m_WKID)}verticalEqual(e){return null!==this.m_vertcs==(null!==e.m_vertcs)&&(!this.m_vertcs||this.m_vertcs.equals(e.m_vertcs))}equals(e){if(this===e)return!0;if(!this.horizontalEqual(e)||!this.verticalEqual(e)||!e.m_peCoordSysVal&&((0,S.g)(!this.m_peCoordSysVal),null!==this.m_unit!=(null!==e.m_unit)||this.m_unit&&!this.m_unit.equals(e.m_unit)||this.m_localZToXYFactor!==e.m_localZToXYFactor))return!1;if(!this.m_bDefaultDescriptor||!e.m_bDefaultDescriptor){if(this.m_peCoordSysVal){if(!this.m_precisionDescriptor.equalsWithoutFalseXY(e.m_precisionDescriptor))return!1;(0,S.g)(e.m_peCoordSysVal);let t=this.m_precisionDescriptor.m_falseX,s=this.m_precisionDescriptor.m_falseY;if(Number.isNaN(t)){let e=this.m_peCoordSysVal.getDomainXY();t=e.xmin,s=e.ymin}let r=e.m_precisionDescriptor.m_falseX,i=e.m_precisionDescriptor.m_falseY;if(Number.isNaN(r)){let t=e.m_peCoordSysVal.getDomainXY();r=t.xmin,i=t.ymin}return t===r&&s===i}return this.m_precisionDescriptor.equals(e.m_precisionDescriptor)}return!0}equalForProjection(e,t){var s,r;if(this===e)return!0;let i=this.getCoordinateSystemType(),n=e.getCoordinateSystemType();if(0===i||0===n)return 0===i&&0===n?(!t||this.getZToXYFactor()===e.getZToXYFactor())&&(!this.getUnit()||!e.getUnit()||this.getUnit().equals(e.getUnit())):3!==i&&3!==n&&(null===this.getUnit()||null===e.getUnit()||(!t||this.getZToXYFactor()===e.getZToXYFactor())&&this.getUnit().equals(e.getUnit()));if(i!==n)return!1;if(3===i)return this.equals(e);if((s=this.m_peCoordSysVal)===(r=e.m_peCoordSysVal)||null!==s&&null!==r&&s.m_csType===r.m_csType&&(0===s.m_WKID&&0===r.m_WKID?1===s.m_csType?s.m_peCoordSys.isEqual(r.m_peCoordSys):s.m_peCoordSys===r.m_peCoordSys:s.m_WKID===r.m_WKID)){if(!t)return!0;if(null!==this.m_vertcs==(null!==e.m_vertcs))return!this.m_vertcs||this.m_vertcs.equalForProjection(e.m_vertcs)}return!1}equalHorizontal(e){return this.horizontalEqual(e)}equalVertical(e){return(0,S.g)(0),!1}equalVerticalVCS(e){return(0,S.g)(0),!1}convergenceAngle(e){return(0,S.g)(0),0}getPeCoordsysCopy(){if(this.m_peCoordSysVal){let e=this.m_peCoordSysVal.m_peCoordSys;return e||(0,S.c)("cannot clone coord sys"),e}return null}getPeVertcsCopy(){return(0,S.g)(0),0}throwIfLocal(){0===this.getCoordinateSystemType()&&(0,S.t)(iN)}getPrimeMeridian(){return this.throwIfLocal(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPrimeMeridian()}getSRToGCSTransform(){return this.updateTransform(!0)}getGCSToSRTransform(){return this.updateTransform(!1)}getOneMeter(){return 1e3*this.getUnitsPerMillimeter()}getOneMeterPCSUnit(){return this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneMeterPCSUnit()}getDefaultPrecisionSR(){if(this.m_bDefaultDescriptor)return this;if(null===this.m_defaultPrecisionSR){let e=new i0;this.queryDefaultPrecisionDescriptorWithoutFalseXY(e),this.m_defaultPrecisionSR=iq(this,e,!0)}return this.m_defaultPrecisionSR}getPCSHorizon(){return this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSHorizon()}getHorzUnitFactor(){return this.m_unit?this.m_unit.getUnitToBaseFactor():1}querySpheroidData(e){var t;this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal);let s=this.getGCS().getPECoordSys().getDatum().getSpheroid(),r=s.getFlattening();t=s.getAxis(),e.majorSemiAxis=t,e.minorSemiAxis=t*(1-r),e.e2=r*(2-r),e.flattening=r}getAreaOfUse(){0===this.getCoordinateSystemType()&&(0,S.m)(""),(0,S.g)(this.m_peCoordSysVal);let e=this.m_peCoordSysVal.getAreaOfUse();return null===e?new D:new D({geom:e.clone(),sr:iA(4326)})}getZToXYFactor(){return 1}isCustomWkid(){return!1}getOneDegreeGCSUnit(){return this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneDegreeGCSUnit()}getGcsUnitFactor(){return this.throwIfNotGCSOrPCS(),(0,S.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getGcsUnitFactor()}snapGeometry(e){if(e.isEmpty()||2===this.m_precisionDescriptor.getPrecision())return!1;let t=e.getGeometryType();if((0,S.i)(t))return this.snapMultiVertex_(e);if(t===S.G.enumPoint)return this.snapPoint_(e);if(t===S.G.enumEnvelope)return this.snapEnvelope_(e);if((0,S.f)(t))return this.snapSegment_(e);if(t===S.G.enumGeometryCollection){let t=!1;for(let s=0,r=e.getGeometryCount();s<r;++s)t=this.snapGeometry(e.getGeometry(s))||t;return t}(0,S.c)("what else?")}snapMultiVertex_(e){if((0,S.g)(!e.isEmpty()),(0,S.g)(2!==this.m_precisionDescriptor.getPrecision()),(0,S.h)(e.getGeometryType())&&e.hasNonLinearSegments())return this.snapGeometryWithCurves_(e);let t=e.getImpl(),s=t.getDescription(),r=!1;for(let e=0,i=s.getAttributeCount();e<i;e++){let i=s.getSemantics(e),n=t.getAttributeStreamRef(i);r=this.snapAttributes(i,n,0,t.getPointCount())||r}return r&&t.notifyModifiedFlags(2001),r}snapPoint_(e){return!1}snapEnvelope_(e){return!1}snapSegment_(e){(0,S.g)(!e.isEmpty()),(0,S.g)(2!==this.m_precisionDescriptor.getPrecision());let t=new i0;this.queryPrecisionDescriptor(t);let s=e.getStartXY(),r=new b.P;r.x=i5(s.x,t.getFalseX(),t.getGridUnitsXY()),r.y=i5(s.y,t.getFalseY(),t.getGridUnitsXY());let i=!r.equals(s),n=e.getEndXY(),a=new b.P;a.x=i5(n.x,t.getFalseX(),t.getGridUnitsXY()),a.y=i5(n.y,t.getFalseY(),t.getGridUnitsXY()),(i||=!a.equals(n))&&e.changeEndPoints2D(r,a);let o=(t,s,r)=>{let i=!1;{let n=e.getStartAttributeAsDbl(t,0),a=i5(n,s,r),o=!(0,b.a3)(a,n);i||=o,o&&e.setStartAttribute(t,0,a)}{let n=e.getEndAttributeAsDbl(t,0),a=i5(n,s,r),o=!(0,b.a3)(a,n);i||=o,o&&e.setEndAttribute(t,0,a)}return i},h=+!!i;return e.hasAttribute(1)&&(h|=!!o(1,t.getFalseZ(),t.getGridUnitsZ())),e.hasAttribute(2)&&(h|=!!o(2,t.getFalseM(),t.getGridUnitsM())),!!h}snapGeometryWithCurves_(e){(0,S.g)(!e.isEmpty()),(0,S.g)(2!==this.m_precisionDescriptor.getPrecision());let t=e.createInstance(),s=new C.S,r=0;for(let i=0,n=e.getPathCount();i<n;++i){let n=e.getSegmentCountPath(i);if(0===n){if(t.addPath(e,i,!0),1===t.getPathSize(i)){let e=new I.P;t.getPointByVal(t.getPointCount()-1,e),r|=!!this.snapGeometry(e),t.setPointByVal(t.getPointCount()-1,e)}continue}let a=e.isClosedPath(i);for(let o=0,h=a?n-1:n;o<h;++o)e.getSegmentFromPath(i,o,s,!1),r|=!!this.snapGeometry(s.get()),t.addSegment(s.get(),0===o);a&&(e.getSegmentFromPath(i,n-1,s,!1),r|=!!this.snapGeometry(s.get()),1===n?t.addPathFromClosedSegment(s.get(),!1):t.closeLastPathWithSegment(s.get()))}return r&&t.copyTo(e),!!r}snapAttributes(t,s,r,i){let n=!1,a=new i0;if(this.queryPrecisionDescriptor(a),0===t)for(let t=r;t<i;t++){let r=s.read(2*t),i=e.s_SnapValue(r,a.getFalseX(),a.getGridUnitsXY()),o=s.read(2*t+1),h=e.s_SnapValue(o,a.getFalseY(),a.getGridUnitsXY());(n=n||i!==r||h!==o)&&(s.write(2*t,i),s.write(2*t+1,h))}else if(1===t)for(let t=r;t<i;t++){let r=s.read(t),i=e.s_SnapValue(r,a.getFalseZ(),a.getGridUnitsZ());(n=n||!(0,b.a3)(i,r))&&s.write(t,i)}else if(2===t)for(let t=r;t<i;t++){let r=s.read(t),i=e.s_SnapValue(r,a.getFalseM(),a.getGridUnitsM());(n=n||!(0,b.a3)(i,r))&&s.write(t,i)}return n}static s_SnapValue(e,t,s){return(0,b.av)((e-t)*s)/s+t}};class i0{constructor(){let e=1e-4*Number(9007199254740990n)*.5;this.m_precision=1,this.m_falseX=-e,this.m_falseY=-e,this.m_unitsXY=Number(9007199254740990n)/(2*e),this.m_falseM=-1e5,this.m_unitsM=1e4,this.m_falseZ=-1e5,this.m_unitsZ=1e4,this.m_toleranceXY=.001,this.m_toleranceM=.001,this.m_toleranceZ=.001}getHashCode(){let e=7777,t=7777;return t=(0,b.aq)(t,this.m_falseM),t=(0,b.aq)(t,this.m_unitsM),e=(0,b.aq)(e,this.m_unitsXY),t=(0,b.aq)(t,this.m_toleranceXY),e=(0,b.aq)(e,this.m_falseZ),t=(0,b.aq)(t,this.m_toleranceZ),e=(0,b.aq)(e,this.m_unitsZ),t=(0,b.aq)(t,this.m_toleranceM),e=(0,b.aq)(e,this.m_precision),(0,b.aq)(e,t)}clone(){let e=new i0;return e.m_falseX=this.m_falseX,e.m_falseY=this.m_falseY,e.m_unitsXY=this.m_unitsXY,e.m_falseZ=this.m_falseZ,e.m_unitsZ=this.m_unitsZ,e.m_falseM=this.m_falseM,e.m_unitsM=this.m_unitsM,e.m_toleranceXY=this.m_toleranceXY,e.m_toleranceZ=this.m_toleranceZ,e.m_toleranceM=this.m_toleranceM,e.m_precision=this.m_precision,e}assign(e){return this.m_falseX=e.m_falseX,this.m_falseY=e.m_falseY,this.m_unitsXY=e.m_unitsXY,this.m_falseZ=e.m_falseZ,this.m_unitsZ=e.m_unitsZ,this.m_falseM=e.m_falseM,this.m_unitsM=e.m_unitsM,this.m_toleranceXY=e.m_toleranceXY,this.m_toleranceZ=e.m_toleranceZ,this.m_toleranceM=e.m_toleranceM,this.m_precision=e.m_precision,this}initialize2D(e,t){}getTolerance(e){switch(e){case 0:return this.m_toleranceXY;case 1:return this.m_toleranceZ;case 2:return this.m_toleranceM;default:return 0}}getResolution(e){if(2===this.m_precision)return 0;switch(e){case 0:return 1/this.m_unitsXY;case 1:return 1/this.m_unitsZ;case 2:return 1/this.m_unitsM;default:return 0}}getFalseX(){return this.m_falseX}getFalseY(){return this.m_falseY}getFalseZ(){return this.m_falseZ}getFalseM(){return this.m_falseM}getGridUnitsXY(){return this.m_unitsXY}getGridUnitsZ(){return this.m_unitsZ}getGridUnitsM(){return this.m_unitsM}getPrecision(){return this.m_precision}static getLimit32(){return 0x7ffffffd}static getLimit64(){return 9007199254740990n}static getLimitFloat(){return 0}getXYGridRange(){let e=new E.J;switch(this.m_precision){case 0:{let t=i0.getLimit32()/this.getGridUnitsXY();e.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+t,ymax:this.getFalseY()+t})}break;case 1:{let t=Number(i0.getLimit64())/this.getGridUnitsXY();e.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+t,ymax:this.getFalseY()+t})}break;case 2:e.setCoords({xmin:-Number.MAX_VALUE,ymin:-Number.MAX_VALUE,xmax:Number.MAX_VALUE,ymax:Number.MAX_VALUE});break;default:e.setEmpty(),(0,S.c)("")}return e}getZGridRange(){let e=new b.E;switch(this.m_precision){case 0:{let t=i0.getLimit32()/this.getGridUnitsZ();e.setCoords(this.getFalseZ(),this.getFalseZ()+t)}break;case 1:{let t=Number(i0.getLimit64())/this.getGridUnitsZ();e.setCoords(this.getFalseZ(),this.getFalseZ()+t)}break;case 2:e.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:e.setEmpty(),(0,S.c)("")}return e}getMGridRange(){let e=new b.E;switch(this.m_precision){case 0:{let t=i0.getLimit32()/this.getGridUnitsM();e.setCoords(this.getFalseM(),this.getFalseM()+t)}break;case 1:{let t=Number(i0.getLimit64())/this.getGridUnitsM();e.setCoords(this.getFalseM(),this.getFalseM()+t)}break;case 2:e.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:e.setEmpty(),(0,S.c)("")}return e}setTolerance(e,t){switch(t<0&&(0,S.t)("tol < 0"),Number.isFinite(t)||(0,S.t)("tol is not finite"),e){case 0:this.m_toleranceXY=t;break;case 1:this.m_toleranceZ=t;break;case 2:this.m_toleranceM=t;break;default:(0,S.t)("cannot set tolerance for this attribute")}}setGridParams(e,t,s){Number.isFinite(e)&&Number.isFinite(t)&&Number.isFinite(s)||(0,S.t)("grid params are not finite"),s<1&&(0,S.t)("grid units cannot be smaller than 1.0"),this.m_falseX=e,this.m_falseY=t,this.m_unitsXY=s}setZParams(e,t){Number.isFinite(e)&&Number.isFinite(t)||(0,S.t)("grid params are not finite"),t<1&&(0,S.t)("grid units cannot be smaller than 1.0"),this.m_falseZ=e,this.m_unitsZ=t}setMParams(e,t){Number.isFinite(e)&&Number.isFinite(t)||(0,S.t)("grid params are not finite"),t<1&&(0,S.t)("grid units cannot be smaller than 1.0"),this.m_falseM=e,this.m_unitsM=t}setPrecision(e){}equals(e){return this===e||(0,b.a3)(this.m_falseX,e.m_falseX)&&(0,b.a3)(this.m_falseY,e.m_falseY)&&this.equalsWithoutFalseXY(e)}snapPrecision(){if(2===this.m_precision)return;let e=(e,t,s,r)=>{if(!Number.isFinite(t)||!Number.isFinite(s))return s;if(s<1)return 1;if(!r)return s;let i=Number(e)/s;return Math.trunc((t+i-t)*s)>e&&(s=e/(t+i-t)),Math.max(1,s)},t=Number(0===this.m_precision?2147483645n:9007199254740990n);this.m_unitsXY=e(t,this.m_falseX,this.m_unitsXY,!0),this.m_unitsXY=e(t,this.m_falseY,this.m_unitsXY,!0),this.m_unitsZ=e(t,this.m_falseZ,this.m_unitsZ,!1),this.m_unitsM=e(t,this.m_falseM,this.m_unitsM,!1)}verifyPrecision(){if(2===this.m_precision)return!0;let e=(e,t,s,r)=>!(s<1)&&!!Number.isFinite(t)&&!!Number.isFinite(s)&&(!r||!(BigInt((t+Number(e)/s-t)*s)>e)),t=0===this.m_precision?2147483645n:9007199254740990n;return!!e(t,this.m_falseX,this.m_unitsXY,!0)&&!!e(t,this.m_falseY,this.m_unitsXY,!0)&&!!e(t,this.m_falseZ,this.m_unitsZ,!1)&&!!e(t,this.m_falseM,this.m_unitsM,!1)}fixTolerance(){2!==this.m_precision&&(this.m_toleranceXY=Math.max(2/this.m_unitsXY,this.m_toleranceXY),this.m_toleranceZ=Math.max(2/this.m_unitsZ,this.m_toleranceZ),this.m_toleranceM=Math.max(2/this.m_unitsM,this.m_toleranceM),(Number.isNaN(this.m_falseX)||Number.isNaN(this.m_falseY))&&(this.m_falseX=this.m_falseY=Number.NaN))}equalsWithoutFalseXY(e){return this===e||this.m_unitsXY===e.m_unitsXY&&this.m_falseZ===e.m_falseZ&&this.m_unitsZ===e.m_unitsZ&&this.m_falseM===e.m_falseM&&this.m_unitsM===e.m_unitsM&&this.m_toleranceXY===e.m_toleranceXY&&this.m_toleranceZ===e.m_toleranceZ&&this.m_toleranceM===e.m_toleranceM&&this.m_precision===e.m_precision}setBestXyDomainFromEnvelope(e,t){}setBestZDomainFromZRange(e,t,s){}setBestMDomainFromMRange(e,t,s){}}function i1(){return(!iZ||iF()&&null===iZ.getPECoordSys())&&(iZ=i9(3857,0,null,!0)),iZ}function i2(){return(!iK||iF()&&null===iK.getPECoordSys())&&(iK=i9(102100,0,null,!0)),iK}function i4(){return(!iQ||iF()&&null===iQ.getPECoordSys())&&(iQ=i9(4326,0,null,!0)),iQ}function i3(e){e.m_falseX=0,e.m_falseY=0,e.m_unitsXY=1,e.m_falseZ=0,e.m_unitsZ=1,e.m_falseM=0,e.m_unitsM=1,e.m_toleranceXY=100*(0,b.N)(),e.m_toleranceZ=100*(0,b.N)(),e.m_toleranceM=100*(0,b.N)(),e.m_precision=2}function i7(e,t,s,r){let i=t instanceof ir;i3(e),e.m_precision=r,e.m_falseX=Number.NaN,e.m_falseY=Number.NaN;let n=i?t.m_csType:t.isPCS?2:1;1===n?e.m_unitsXY=1/((0===r?1/18e5:1e-9)*(i?t.getOneDegreeGCSUnit():Math.PI/t.metersOrRadiansPerUnit/180)):2===n?e.m_unitsXY=1/((0===r?.001:1e-4)*(i?t.getOneMeterPCSUnit():1/t.metersOrRadiansPerUnit)):(0,S.t)("unrecognized cs type"),e.m_falseM=-1e5,e.m_unitsM=1/(0===r?.001:1e-4),e.m_unitsM=Math.max(1,e.m_unitsM),e.m_unitsXY=Math.max(1,e.m_unitsXY);let a=0,o=0;0!==r&&1!==r||(a=2/e.m_unitsXY,o=2/e.m_unitsM),e.m_toleranceXY=Math.max(a,i?t.getUnitsPerMillimeter():2===n?.001/t.metersOrRadiansPerUnit:.001/(t.semiMajor*t.metersOrRadiansPerUnit)),e.m_toleranceM=Math.max(.001,o),i6(e,s)}function i6(e,t){if(e.m_falseZ=-1e5,t){let s=(0===e.m_precision?.001:1e-4)*t.getOneMeter();e.m_unitsZ=1/s}else e.m_unitsZ=1/(0===e.m_precision?.001:1e-4);e.m_unitsZ=Math.max(1,e.m_unitsZ);let s=0;0!==e.m_precision&&1!==e.m_precision||(s=2/e.m_unitsZ),e.m_toleranceZ=Math.max(t?.001*t.getOneMeter():.001,s)}function i8(e,t,s,r){i3(e),e.m_precision=r;let i=0===r?2147483645n:9007199254740990n,n=1,a=1,o=.001;t&&(a=t.getUnitToBaseFactor()),t&&1===t.getUnitType()?(n=400*Math.PI/180,o=8983152841195215e-24*Math.PI/180/a):(n=(0===r?.001:1e-4)*Number(i)*.5,o=.001/a),e.m_falseX=-(n/=a),e.m_falseY=-n,e.m_unitsXY=Number(i)/(2*n),e.m_falseM=-1e5,e.m_unitsM=1/(0===r?.001:1e-4),e.m_unitsM=Math.max(1,e.m_unitsM),e.snapPrecision();let h=0,l=0;0!==e.m_precision&&1!==e.m_precision||(l=2/e.m_unitsM,h=2/e.m_unitsXY),e.m_toleranceXY=Math.max(h,o),e.m_toleranceM=Math.max(.001,l),i6(e,s)}function i9(e,t,s,r){if(!r&&t<=0){if(3857===e)return i1();if(102100===e)return i2();if(4326===e)return i4()}let i=new i$,n,a=null;return iF()?(n=function(e){e<=0&&(0,S.y)(e);{let t=ib(e);if(t)return t}let t=ns(h.coordsys(e));t.get()||(0,S.y)(e);let s=iI(t.release());return s.getLatestID()!==e&&ip.set(e,new WeakRef(s)),s}(e),t>0?a=null:t=0,i.setHorzProj_(n),i.m_vertcs=a):i.m_unit=(n=ni(e)).isPCS?new iv(n.metersOrRadiansPerUnit):new k(n.metersOrRadiansPerUnit),i7(i.m_precisionDescriptor,n,a,1),i.m_bDefaultDescriptor=!0,i.m_userWKID=e,i.calculateHashCode(),i.initDbgName(),i}function i5(e,t,s){return(0,b.av)((e-t)*s)/s+t}let ne=null;function nt(e,t){return e===t||Math.abs(e-t)<=3552713678800501e-30*(1+(Math.abs(e)+Math.abs(t))/2)}function ns(e){return{_this:e,get(){return this._this},reset(e){this._this=e},release(){let e=this._this;return this._this=null,e}}}let nr=null;function ni(e){(0,S.g)(nr);let t=nr(e);return t.semiMajor=t.isPCS?Number.NaN:function(e){if(h&&(0,S.m)("pe has been loaded. no-pe methods should not be used at this point."),"string"==typeof e){let t=e.match(nn);t&&2===t.length||(0,S.t)("bad gcs wkt");let s=Number.parseFloat(t[1]);return Number.isFinite(s)||(0,S.t)("bad gcs wkt"),s}return ne||na(),ne.has(e)||(0,S.m)("gcs wkid not found"),ne.get(e)}(e),t}let nn=/(?:ELLIPSOID|SPHEROID)\["(?:\w|[-()])+",(\d+\.\d+)/;function na(){for(let e in ne=new Map,H){let t=Number.parseFloat(e),s=H[e];if(Array.isArray(s))for(let e of s)ne.set(e,t);else ne.set(s,t)}for(let e in H)delete H[e]}function no(e,t){return new nm(e,t)}let nh=(0,b.ar)(0),nl=(0,b.ar)(1),nm=class e{constructor(t,s){if(t instanceof e)return this.m_geogTranWrapper=t.m_geogTranWrapper,this.m_bInverted=s?!t.m_bInverted:t.m_bInverted,void(this.m_hashCode=(0,b.aq)(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?nl:nh));this.m_geogTranWrapper=new rc(t),this.m_bInverted=s,this.m_hashCode=(0,b.aq)(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?nl:nh)}getID(){return this.m_geogTranWrapper.getLatestId()}getLatestID(){return this.m_geogTranWrapper.getLatestId()}getText(){return this.m_geogTranWrapper.getText()}getTextExtended(e){if(!this.m_geogTranWrapper.getGeogtran())return"";if(-1===e)return this.m_geogTranWrapper.getGeogtran().toString();{let t=0===e?l.PE_STR_AUTH_TOP:l.PE_STR_AUTH_ALL;return this.m_geogTranWrapper.getGeogtran().toString(t)}}getText2(e=-1){let t=l.PE_STR_FMT_WKT2;return -1!==e&&(t|=0===e?l.PE_STR_AUTH_TOP:l.PE_STR_AUTH_ALL),this.m_geogTranWrapper.getGeogtran().toString(t)}getName(){return this.m_geogTranWrapper&&this.m_geogTranWrapper.getGeogtran()?this.m_geogTranWrapper.getGeogtran().getName():""}getInputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getOutputSr(!1):this.m_geogTranWrapper.getInputSr(!1)}getOutputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getInputSr(!1):this.m_geogTranWrapper.getOutputSr(!1)}getInverse(){return new e(this,!0)}isInverted(){return this.m_bInverted}getHashCode(){return this.m_hashCode}GetPeGeogtran(){return this.m_geogTranWrapper.getGeogtran()}equals(e){return e===this||this.m_bInverted===e.m_bInverted&&(this.GetPeGeogtran()===e.GetPeGeogtran()||this.getID()===e.getID()&&!(0===this.getID()&&!this.GetPeGeogtran().isEqual(e.GetPeGeogtran())))}referencesMissingData(){return!!this.m_geogTranWrapper&&!this.m_geogTranWrapper.isUsable()}getWrapper(){return this.m_geogTranWrapper}};function ng(e,t,s,r,i){let n=e.getGCS(),a=t.getGCS(),o=n.getPECoordSys(),h=a.getPECoordSys(),l=null;if(!s.isEmpty()){let t=s.clone();if(!t.isEmpty()&&2===e.getCoordinateSystemType()){let s=new I.E({env2D:t}),r=io(e,n,null);(s=(new sj).execute(s,r,null)).queryEnvelope(t)}if(!t.isEmpty()){let e=o.getPrimem().getLongitude(),s=o.getUnit().getUnitFactor();l=new f(t.xmin,t.ymin,t.xmax,t.ymax,e,s)}}let m=r;m>=(0,b.i)()&&(m=0);let g=[],u=_.PE_GTLIST_OPTS_COMMON;i||(u&=~_.PE_GTLIST_OPTS_USABLE);for(let e=0;e<2;e++){g.length=0;let e=m,t=_.getGTlist(o,h,2,u,l,e),s=!1;if(t&&t.length>0)for(let e=0,n=t.length;e<n;e++){let n=nu([t[e]]);if((0,S.g)(n),i&&n.referencesMissingData())s=!0;else if(g.push(n),r>0&&g.length===r)break}if(!s)break;0===m||(m=0)}return l&&l.destroy(),g}function nu(e){(0,S.g)(null!==e);let t=new nd,s=e[0].getSteps();if(s){let r=e[0].getEntries();for(let e=0;e<s;e++){let s=0!==r[e].getDirection(),i=no(r[e].getGeogtran(),s);t.add(i)}return t.create()}return null}let n_=class{constructor(e,t,s,r){this.m_bReadOnly=!0,this.m_name="",this.m_fastTrack=-1,this.m_bNameIsSet=!1,this.m_transforms=e,t&&(this.m_name=t,this.m_bNameIsSet=!0),this.m_inputSr=s,this.m_outputSr=r}getType(){return 0}getName(){if(this.m_bNameIsSet)return this.m_name;if(0===this.m_transforms.length)return"";let e="";for(let t of this.m_transforms)e.length>0&&(e+=" + "),t.isInverted()&&(e+="~"),e+=t.getName();return e}count(){return this.m_transforms.length}createInverse(){return this.getInverse()}getHashCode(){let e=1973;for(let t=0;t<this.m_transforms.length;t++)e=(0,b.aq)(e,this.m_transforms[t].getHashCode());return e}equals(e){return(0,S.g)(0),!1}referencesMissingData(){if(0===this.m_transforms.length)return!1;for(let e of this.m_transforms)if(e.referencesMissingData())return!0;return!1}isMatchingTransformation(e,t){return(0,S.g)(0),!1}validateTransformation(e,t){return(0,S.g)(0),!1}nameIsSet(){return(0,S.g)(0),!1}getInputSpatialReference(){return this.m_inputSr}getOutputSpatialReference(){return this.m_outputSr}getStep(e){return(e<0||e>this.count())&&(0,S.n)(""),this.m_transforms[e]}getInverse(){let e=new nd;return e.addSteps(this,!0),e.setInputSpatialReference(this.m_outputSr),e.setOutputSpatialReference(this.m_inputSr),e.create()}transform(e,t,s){if(0===this.count())return;let r=this.m_inputSr,i=this.m_outputSr;if(e&&(i=(0,b.b)(r,r=i)),0===this.m_transforms.length)return void rf(r,null,i,null,t,null,s);let n=this.m_fastTrack;if(1===n)return void(0,C.I)(e,this.m_transforms,r=>{!function(e,t,s,r,i){let n=e.getVerttran(),a=e.getGeogtran();if(i>0){var o,h,m,g,u;e.prepareOrThrow();let r=t?l.PE_TRANSFORM_2_TO_1:l.PE_TRANSFORM_1_TO_2;n?(0,S.g)(0):r6(a,i,s,null,r)}}(r.getWrapper(),e!==r.isInverted(),t,0,s)});let a=rp();-1===n&&a.initFromGcsAndVcs(r,null);let o=rp(),h=e?this.m_transforms.length-1:0,m=e?-1:1;for(let i=0,g=this.m_transforms.length;i<g;i++,h+=m){if(0===i){let i=this.m_transforms[h];(function(e,t,s,r,i,n,a,o){let h=rp();h.initFromGcsAndVcsPe(e,null),o.assign(r?s.m_outputUnitParams:s.m_inputUnitParams),o.processUnitParams(h),h.processUnitParams(o),a>0&&rd(h,o,i,null,a)})(r.getPECoordSys(),0,i.getWrapper(),e!==i.isInverted(),t,0,s,o),-1===n&&(a.equals(o)||(n=0)),a.assign(o)}else{let r=this.m_transforms[h-m],i=this.m_transforms[h];(function(e,t,s,r,i,n,a,o,h){let l=rp(),m=rp();l.assign(s?t.m_inputUnitParams:t.m_outputUnitParams),m.assign(i?r.m_outputUnitParams:r.m_inputUnitParams),l.processUnitParams(e),m.processUnitParams(l),l.processUnitParams(m),o>0&&rd(l,m,n,null,o),h.assign(m)})(a,r.getWrapper(),e!==r.isInverted(),i.getWrapper(),e!==i.isInverted(),t,0,s,o),-1===n&&(a.equals(o)||(n=0)),a.assign(o)}let g=this.m_transforms[h];(function(e,t,s,r,i,n,a){let o=t.getVerttran(),h=t.getGeogtran();if(a.assign(s?t.m_inputUnitParams:t.m_outputUnitParams),a.processUnitParams(e),n>0){t.prepareOrThrow();let e=s?l.PE_TRANSFORM_2_TO_1:l.PE_TRANSFORM_1_TO_2;var m=void 0,g=void 0,u=void 0,_=void 0,d=void 0;o?(0,S.g)(0):r6(h,n,r,null,e)}})(a,g.getWrapper(),e!==g.isInverted(),t,0,s,o),a.assign(o)}let g=this.m_transforms[h-m];(function(e,t,s,r,i,n,a,o){let h=rp();h.assign(s?t.m_inputUnitParams:t.m_outputUnitParams),h.processUnitParams(e);let l=null;r&&(l=r.getPECoordSys());let m=rp();m.initFromGcsAndVcsPe(l,null),m.processUnitParams(h),h.processUnitParams(m),o>0&&rd(h,m,n,null,o)})(a,g.getWrapper(),e!==g.isInverted(),i,0,t,0,s),-1===n&&(o.initFromGcsAndVcs(i,null),a.equals(o)||(n=0)),this.m_fastTrack=+(0!==n)}};class nd{constructor(){this.m_transforms=[],this.m_inputGCS=null,this.m_outputGCS=null,this.m_name="",this.m_bNameIsSet=!1}getInputSpatialReference(){return null!==this.m_inputGCS?this.m_inputGCS:this.count()>0?this.m_transforms[0].getInputSpatialReference():null}setInputSpatialReference(e){this.m_inputGCS=e?e.getGCS():null}getOutputSpatialReference(){return null!==this.m_outputGCS?this.m_outputGCS:this.count()>0?this.m_transforms.at(-1).getOutputSpatialReference():null}setOutputSpatialReference(e){this.m_outputGCS=e?e.getGCS():null}getName(){if(this.m_bNameIsSet)return this.m_name;if(0===this.m_transforms.length)return"";let e="";for(let t of this.m_transforms)e.length>0&&(e+=" + "),t.isInverted()&&(e+="~"),e+=t.getName();return e}count(){return this.m_transforms.length}getStep(e){return(e<0||e>this.count())&&(0,S.n)(""),this.m_transforms[e]}setStep(e,t){(0,S.g)(0)}add(e){this.m_transforms.push(e)}addSteps(e,t){if(t)for(let t=e.count()-1;t>=0;--t)this.add(e.getStep(t).getInverse());else for(let t=0;t<e.count();++t)this.add(e.getStep(t))}clear(){this.m_transforms=[],this.m_name="",this.m_bNameIsSet=!1,this.m_inputGCS=null,this.m_outputGCS=null}remove(e){(0,S.g)(0)}create(){let e=this.getInputSpatialReference(),t=this.getOutputSpatialReference(),s=new n_(this.m_transforms,this.m_bNameIsSet?this.m_name:null,e,t);return s.m_bReadOnly=!0,this.clear(),s}}let np=Object.freeze(Object.defineProperty({__proto__:null,SpatialReference:i$,SpatialReferencePrecisionDescriptor:i0,create:iA,createFromWKT:iM,createImplFromPe:iU,createLocal:iB,createWithNewPrecision:iq,createWithNewVCS:iO,getGCS:iY,getTempName:iW,hasNoPe:iH,hasPe:iF,injectNoPe:iV,injectPe:function(e){var t;if(h)return;h=(t=e).PeFactory,(0,S.g)(h),f=t.PeGCSExtent,(0,S.g)(f),p=t.PeLineType,(0,S.g)(p),c=t.PeMath,(0,S.g)(c),o=t.PeDouble,(0,S.g)(o),l=t.PeDefs,(0,S.g)(l),m=t.PeCSTransformations,(0,S.g)(m),g=t.PeGTTransformations,(0,S.g)(g),u=t.PePCSInfo,(0,S.g)(u),_=t.PeGTlistExtended,(0,S.g)(_),h.initialize(),d=t.PeGTlistExtendedEntry,(0,S.g)(d),l.PE_TYPE_ANGUNIT=512,l.PE_STR_AUTH_ALL=2,u.PE_POLE_LINE_STRAIGHT=2,u.PE_POLE_LINE_CURVED=3,l.PE_PARM_LAM0=2,l.PE_PARM_PHI0=6,l.PE_PRJ_AZIMUTHAL_EQUIDISTANT=43032,l.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA=43033,l.PE_PRJ_ALBERS=43007,l.PE_PRJ_CYLINDRICAL_EQAREA=43034,l.PE_TYPE_VERTCS=8,l.PE_LINETYPE_GEODESIC=0,l.PE_LINETYPE_LOXODROME=1,l.PE_LINETYPE_GREAT_ELLIPTIC=2,l.PE_LINETYPE_NORMAL_SECTION=3,_.PE_GTLIST_OPTS_USABLE=1,nr=null;let s=iT;iT=null,s.forEach(e=>{let t=e.deref();t&&t.attachToPe()})},isInitialized:ik,isTempName:ij,isValidWkid:iX,isValidWkt:iL,makeSpheroidData:iD,snapGeometry:iR,webMercator:i1,webMercator102100:i2,wgs84:i4},Symbol.toStringTag,{value:"Module"})),nc=Object.freeze(Object.defineProperty({__proto__:null,OperatorProject:sj},Symbol.toStringTag,{value:"Module"})),nf=Object.freeze(Object.defineProperty({__proto__:null,CompositeGeographicTransformation:n_,CompositeGeographicTransformationEditor:nd,createImpl:nu,queryGtListImpl:ng},Symbol.toStringTag,{value:"Module"})),nx=Object.freeze(Object.defineProperty({__proto__:null,GeographicTransformation:nm,create:function(e,t){let s=h.geogtran(e);return s||(0,S.y)(e),new nm(s,t)},createFromPe:no,createFromWKT:function(e,t){let s=h.fromString(l.PE_TYPE_GEOGTRAN,e);return s||(0,S.z)(e),new nm(s,t)}},Symbol.toStringTag,{value:"Module"})),nP=Object.freeze(Object.defineProperty({__proto__:null,ProjectionTransformation:id,create:function(e,t,s){return ia(e,t,E.J.constructEmpty(),s)},createEx:io,createFromAoi:ia,createImplEx:ih,makeExtendedParams:im,makeExtendedParamsInternal:iu,queryTransformationList:il},Symbol.toStringTag,{value:"Module"}))}}]);