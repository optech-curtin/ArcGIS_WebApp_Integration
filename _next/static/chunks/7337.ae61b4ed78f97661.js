"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7337],{7299:(e,t,r)=>{r.d(t,{e:()=>s,q:()=>n});var i=r(90040);class n{constructor(e,t,r=t){this.internalFormat=e,this.width=t,this.height=r,this.multisampled=!1,this.samples=1}}function s(e){return e.width<=0||e.height<=0||null==e.internalFormat?0:e.width*e.height*(0,i.IB)(e.internalFormat)}},52566:(e,t,r)=>{r.d(t,{l:()=>h});var i=r(93446),n=r(87816),s=r(7299);class h{constructor(e,t){this._context=e,this._descriptor=t,this.type=n.p.RenderBuffer,this._context.instanceCounter.increment(i.vt.Renderbuffer,this);let r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);let{width:s,height:h,internalFormat:l,multisampled:o}=t;o?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,l,s,h):r.renderbufferStorage(r.RENDERBUFFER,l,s,h),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){let e=this._descriptor.samples,t=this._context.parameters.maxSamples;return e?Math.min(e,t):t}get usedMemory(){return(0,s.e)(this._descriptor)}resize(e,t){let r=this._descriptor;if(r.width===e&&r.height===t)return;r.width=e,r.height=t;let i=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):i.renderbufferStorage(i.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(i.vt.Renderbuffer,this),this._context=null)}}},59413:(e,t,r)=>{r.d(t,{I:()=>i});function i(e){let t="";for(let r in e){let i=e[r];if("boolean"==typeof i)i&&(t+=`#define ${r}
`);else if("number"==typeof i)t+=`#define ${r} ${i.toFixed()}
`;else if("object"==typeof i)if(function(e){let{options:t,value:r}=e;return"number"==typeof t[r]}(i)){let{value:e,options:n,namespace:s}=i,h=s?`${s}_`:"";for(let e in n)t+=`#define ${h}${e} ${n[e].toFixed()}
`;t+=`#define ${r} ${h}${e}
`}else{let e=i.options,n=0;for(let r in e)t+=`#define ${e[r]} ${(n++).toFixed()}
`;t+=`#define ${r} ${e[i.value]}
`}}return t}},61910:(e,t,r)=>{r.d(t,{O:()=>i});class i{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}getInner(e){return this._outer.get(e)}set(e,t,r){let i=this._outer.get(e);i?i.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){let r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}forEach(e){this._outer.forEach((t,r)=>e(t,r))}forAll(e){for(let t of this._outer.values())for(let r of t.values())e(r)}}},79142:(e,t,r)=>{r.d(t,{J:()=>s}),r(57845);var i=r(61910),n=r(50285);class s{constructor(e){this._rctx=e,this._store=new i.O}dispose(){this._store.forAll(e=>e.dispose()),this._store.clear()}acquire(e,t,r,i){let s=this._store.get(e,t);if(null!=s)return s.ref(),s;let h=new n.B(this._rctx,e,t,r,i);return h.ref(),this._store.set(e,t,h),h}get test(){}}},81732:(e,t,r)=>{r.r(t),r.d(t,{BufferObject:()=>i.g,FramebufferObject:()=>n.H,Program:()=>s.B,ProgramCache:()=>h.J,Renderbuffer:()=>l.l,ShaderCompiler:()=>o.Z,Texture:()=>a.g,VertexArrayObject:()=>u.Z,createProgram:()=>f.r,glslifyDefineMap:()=>c.I});var i=r(62233),n=r(98232),s=r(50285),h=r(79142),l=r(52566),o=r(81312),a=r(87155),u=r(84172),c=r(59413),f=r(95570)},94264:(e,t,r)=>{r.d(t,{Qf:()=>o,Qh:()=>h,RS:()=>n,ez:()=>u,i5:()=>c,lM:()=>s,qK:()=>a});var i=r(48678);let n=16;function s(e){if(!e)return 0;let t=a;for(let r in e)e.hasOwnProperty(r)&&(t+=l(e[r],!1));return t}function h(e){if(!e)return 0;if("number"==typeof e[0])return o(e);if(Array.isArray(e)){var t=e;let r=t.length;if(0===r||"number"==typeof t[0])return function(e,t){return u+e.length*t}(t,8);let i=u;for(let e=0;e<r;e++)i+=l(t[e]);return i}let r=a;for(let t in e)e.hasOwnProperty(t)&&(r+=l(e[t]));return r}function l(e,t=!0){switch(typeof e){case"object":return t?h(e):a;case"string":return 32+e.length;case"number":return n;case"boolean":return 4;default:return 8}}function o(...e){return e.reduce((e,t)=>{var r,s;return e+(t?(0,i.iu)(t)?t.byteLength+c:Array.isArray(t)?(r=t,s=n,u+r.length*s):0:0)},0)}let a=32,u=16,c=145},98232:(e,t,r)=>{r.d(t,{H:()=>f}),r(57845);var i=r(61939),n=r(40941),s=r(62233),h=r(53701),l=r(93446),o=r(87816),a=r(52566),u=r(87155);let c=()=>i.A.getLogger("esri.views.webgl.FramebufferObject");class f{constructor(e,t,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(l.vt.FramebufferObject,this);let i=_(t)?t:new u.g(this._context,t);if(this._colorAttachments.set(l.Nm.COLOR_ATTACHMENT0,i),this._validateTextureDescriptor(i.descriptor),this._validateColorAttachmentPoint(l.Nm.COLOR_ATTACHMENT0),null!=r)if(function(e){return _(e)||null!=e&&"pixelFormat"in e}(r))this._depthStencilTexture=_(r)?r:new u.g(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{let e=!function(e){return null!=e&&"type"in e&&e.type===o.p.RenderBuffer}(r)?new a.l(this._context,r):r;this._depthStencilBuffer=e,this._validateRenderBufferDescriptor(e.descriptor)}}dispose(){if(0===this._colorAttachments.size&&!this._glName)return;let e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((e,t)=>this.detachColorTexture(t)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(l.vt.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(l.Nm.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){let e=this._colorAttachments.get(l.Nm.COLOR_ATTACHMENT0);return e?.descriptor?.width??0}get height(){let e=this._colorAttachments.get(l.Nm.COLOR_ATTACHMENT0);return e?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((e,[t,r])=>e+r.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(e){let t=this._colorAttachments.get(e);return t&&_(t)?t:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,t=l.Nm.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(t);let r=e.descriptor;this._validateTextureDescriptor(r),this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,t)),this._colorAttachments.set(t,e)}detachColorTexture(e=l.Nm.COLOR_ATTACHMENT0){let t=this._colorAttachments.get(e);if(t){if(this._initialized){let t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(t)}return this._colorAttachments.delete(e),t}}setColorTextureTarget(e,t=l.Nm.COLOR_ATTACHMENT0){let r=this._colorAttachments.get(t);r&&this._framebufferTexture2D(r.glName,t,e)}attachDepthStencil(e){if(e)switch(e.type){case o.p.Texture:return this._attachDepthStencilTexture(e);case o.p.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(null==e)return;let t=e.descriptor;t.pixelFormat!==l.Ab.DEPTH_STENCIL&&t.pixelFormat!==l.Ab.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),t.dataType!==l.ld.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,l.nI)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){let e=this._depthStencilTexture;if(e&&this._initialized){let e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,l.nI),this._context.bindFramebuffer(e)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(null==e)return;let t=e.descriptor;if(this._validateRenderBufferDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);let r=this._context.gl,i=this._getGLAttachmentPoint(t);r.framebufferRenderbuffer(l.R.FRAMEBUFFER,i,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){let e=this._depthStencilBuffer;if(e&&this._initialized){let t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);let r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(l.R.FRAMEBUFFER,i,r.RENDERBUFFER,null),this._context.bindFramebuffer(t)}return this._depthStencilBuffer=null,e}copyToTexture(e,t,r,i,n,s,h){(e<0||t<0||n<0||s<0)&&console.error("Offsets cannot be negative!"),(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!");let o=h.descriptor;h.descriptor.target!==l.Ap.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==o?.width||null==o?.height||e+r>this.width||t+i>this.height||n+r>o.width||s+i>o.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");let a=this._context,c=a.bindTexture(h,u.g.TEXTURE_UNIT_FOR_UPDATES);a.setActiveTexture(u.g.TEXTURE_UNIT_FOR_UPDATES),a.bindFramebuffer(this),a.gl.copyTexSubImage2D(l.Ap.TEXTURE_2D,0,n,s,e,t,r,i),a.bindTexture(c,u.g.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,t,r,i,n,s,h){(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!"),h||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,i,n,s,h)}async readPixelsAsync(e,t,r,i,n,h,o){let{gl:a}=this._context,u=s.g.createPixelPack(this._context,l._U.STREAM_READ,o.byteLength);this._context.bindBuffer(u);let c=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),a.readPixels(e,t,r,i,n,h,0),this._context.unbindBuffer(l.NZ.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(c),await u.getSubDataAsync(o),u.dispose()}resize(e,t){if(this.width===e&&this.height===t)return;let r={width:e,height:t};d(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(e=>e.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(d(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=l.R.FRAMEBUFFER){let t=this._context.gl;if(this._initialized)return void t.bindFramebuffer(e,this.glName);this._glName&&t.deleteFramebuffer(this._glName);let r=t.createFramebuffer();if(t.bindFramebuffer(e,r),this._colorAttachments.forEach((t,r)=>this._framebufferTexture2D(t.glName,r,m(t),e)),this._depthStencilBuffer){let r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(e,r,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,t.DEPTH_STENCIL_ATTACHMENT,m(this._depthStencilTexture),e);(0,h.en)()&&t.checkFramebufferStatus(e)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,t=l.Nm.COLOR_ATTACHMENT0,r=l.Ap.TEXTURE_2D,i=l.R.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(i,t,r,e,n)}_disposeDepthStencilAttachments(){let e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);let t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(l.R.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthStencilBuffer=(0,n.WD)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=(0,n.WD)(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==l.Ap.TEXTURE_2D&&e.target!==l.Ap.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),d(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){d(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case l.yQ.DEPTH_COMPONENT16:case l.yQ.DEPTH_COMPONENT24:case l.yQ.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case l.yQ.DEPTH24_STENCIL8:case l.yQ.DEPTH32F_STENCIL8:case l.yQ.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case l.yQ.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(-1===f._MAX_COLOR_ATTACHMENTS){let{gl:e}=this._context;f._MAX_COLOR_ATTACHMENTS=e.getParameter(e.MAX_COLOR_ATTACHMENTS)}let t=e-l.Nm.COLOR_ATTACHMENT0;t+1>f._MAX_COLOR_ATTACHMENTS&&i.A.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${f._MAX_COLOR_ATTACHMENTS} color attachments`)}}function _(e){return null!=e&&"type"in e&&e.type===o.p.Texture}function d(e,t){let r=Math.max(e.width,e.height);if(r>t){c().warn(`Resizing FBO attachment size ${e.width}x${e.height} to device limit ${t}`);let i=t/r;return e.width=Math.round(e.width*i),e.height=Math.round(e.height*i),!1}return!0}function m(e){return e.descriptor.target===l.Ap.TEXTURE_CUBE_MAP?l.Ap.TEXTURE_CUBE_MAP_POSITIVE_X:l.Ap.TEXTURE_2D}f._MAX_COLOR_ATTACHMENTS=-1}}]);