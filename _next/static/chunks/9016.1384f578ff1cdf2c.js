"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9016],{19696:(e,t,n)=>{n.d(t,{H:()=>l}),n(57845);var i=n(33715),r=n(16082),a=n(92753),s=n(45714);function l(e=!1,t){return e?new u(t):new o}class o{async fetch(){return[]}notifySymbologyChange(){}}class u{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new r.q(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];let n=[],r=[],s=this._candidatesCache;for(let t of e){let e=c(t),a=s.get(e);if(a)for(let e of a)r.push((0,i.o8)(e));else n.push(t),s.put(e,[],1)}if(0===n.length)return r;let l=this._cacheVersion,{candidates:o,sourceCandidateIndices:u}=await this._getSymbologyCandidates(n,t);if((0,a.Te)(t),l!==this._cacheVersion)return this.fetch(e,t);let p=[],{length:h}=o;for(let e=0;e<h;++e){let t=o[e],r=c(n[u[e]]),a=s.get(r);a.push(t),s.put(r,a,a.length),p.push((0,i.o8)(t))}return r.concat(p)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function c(e){switch(e.type){case"vertex":{let{objectId:t,target:n}=e,i=`${t}-vertex-${n.x}-${n.y}-${n.z??0}`;return(0,s.Wm)(i).toString()}case"edge":{let{objectId:t,start:n,end:i}=e,r=`${t}-edge-${n.x}-${n.y}-${n.z??0}-to-${i.x}-${i.y}-${i.z??0}`;return(0,s.Wm)(r).toString()}default:return""}}},24862:(e,t,n)=>{n.d(t,{$:()=>o,p:()=>u});var i=n(73541),r=n(10433),a=n(87255),s=n(50082);function l({x:e,y:t,z:n}){return(0,i.fA)(e,t,n??0)}function o(e,t){switch(e.type){case"edge":return e.draped?new r.X({edgeStart:l(e.start),edgeEnd:l(e.end),targetPoint:(0,i.de)(l(e.target)),objectId:e.objectId,getGroundElevation:t}):new a.z({edgeStart:l(e.start),edgeEnd:l(e.end),targetPoint:(0,i.de)(l(e.target)),objectId:e.objectId,isDraped:!1});case"vertex":return new s.C({targetPoint:(0,i.de)(l(e.target)),objectId:e.objectId,isDraped:!1})}}function u(e,t){return null!=e&&"3d"===e.type?(n,i)=>e.elevationProvider.getElevation(n,i,0,t,"ground"):()=>null}},49016:(e,t,n)=>{n.r(t),n.d(t,{FeatureCollectionSnappingSource:()=>_});var i=n(81856),r=n(28690),a=n(49861),s=n(92753),l=n(45257),o=n(97409),u=n(91838);n(57845),n(61939),n(33638);var c=n(12709),p=n(26585),h=n(3489),d=n(24862),y=n(66974),g=n(69659),f=n(19696);let _=class extends r.A{get availability(){return 1}get _snappingElevationAligner(){let{view:e}=this,{layer:t}=this.layerSource,n=null!=e&&"3d"===e.type;if(!n||"subtype-group"===t.type)return(0,y.n)();let i=async(n,i)=>(await (0,s.qr)(e.whenLayerView(t),i)).elevationAlignPointsInFeatures(n,i);return(0,y.n)(n,{elevationInfo:t.elevationInfo,alignPointsInFeatures:i})}get _snappingElevationFilter(){let{view:e}=this,t=null!=e&&"3d"===e.type&&"subtype-group"!==this.layerSource.layer.type;return(0,g.z)(t)}get _symbologySnappingFetcher(){let{view:e}=this,{layer:t}=this.layerSource;return null!=e&&"3d"===e.type&&"subtype-group"!==t.type?(0,f.H)(this._symbologySnappingSupported,async(n,i)=>{let r=await e.whenLayerView(t);return(0,s.Te)(i),r.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},i)}):(0,f.H)()}get _layerView(){let{view:e}=this;if(null==e)return null;let{layer:t}=this.layerSource;return e.allLayerViews.find(e=>e.layer===t)}get _layerView3D(){let{view:e}=this;return null==e||"2d"===e.type?null:this._layerView}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){let{view:e}=this,{layer:t}=this.layerSource;null!=e&&"3d"===e.type&&"subtype-group"!==t.type&&this.addHandles([e.elevationProvider.on("elevation-change",({context:e})=>{let{elevationInfo:n}=t;(0,p.Up)(e,n)&&this._snappingElevationAligner.notifyElevationSourceChange()}),(0,l.wB)(()=>t.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),l.Vh),(0,l.wB)(()=>null!=this._layerView3D?this._layerView3D.layer?.renderer:null,()=>this._symbologySnappingFetcher.notifySymbologyChange(),l.Vh),(0,l.on)(()=>this._layerView3D?.layer,["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=(0,a.B)(d.p)}refresh(){}async fetchCandidates(e,t){let{layer:n}=this.layerSource,i=n.source;if(!i?.querySnapping)return[];let r=n.createQuery();this._layerView&&"effectiveDisplayFilter"in this._layerView&&(r.where=(0,o.mA)(r.where,this._layerView.effectiveDisplayFilter?.where));let a=(0,h.nf)(e,this.view?.type??"2d",r),l=await i.querySnapping(a,{signal:t});(0,s.Te)(t);let u=e.coordinateHelper.spatialReference,c=await this._snappingElevationAligner.alignCandidates(l.candidates,u,t);(0,s.Te)(t);let p=await this._symbologySnappingFetcher.fetch(c,t);(0,s.Te)(t);let y=0===p.length?c:[...c,...p],g=this._snappingElevationFilter.filter(a,y),f=this._memoizedMakeGetGroundElevation(this.view,u);return g.map(e=>(0,d.$)(e,f))}};(0,i._)([(0,u.MZ)({constructOnly:!0})],_.prototype,"layerSource",void 0),(0,i._)([(0,u.MZ)({constructOnly:!0})],_.prototype,"view",void 0),(0,i._)([(0,u.MZ)()],_.prototype,"_snappingElevationAligner",null),(0,i._)([(0,u.MZ)()],_.prototype,"_snappingElevationFilter",null),(0,i._)([(0,u.MZ)()],_.prototype,"_symbologySnappingFetcher",null),(0,i._)([(0,u.MZ)()],_.prototype,"_layerView",null),(0,i._)([(0,u.MZ)()],_.prototype,"_layerView3D",null),(0,i._)([(0,u.MZ)()],_.prototype,"_symbologySnappingSupported",null),_=(0,i._)([(0,c.$)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],_)},49861:(e,t,n)=>{function i(e){let t,n,i=[],r=!1;return function(...a){return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(a,i)||(n=e.apply(this,a),t=this,i=a,r=!0),n}}n.d(t,{B:()=>i})},50082:(e,t,n)=>{n.d(t,{C:()=>s});var i=n(64088),r=n(99392),a=n(55186);class s extends r.w{constructor(e){super({...e,constraint:new i.i7(e.targetPoint)})}get hints(){return[new a._(this.targetPoint,this.isDraped,this.domain)]}}},55186:(e,t,n)=>{n.d(t,{_:()=>a});var i=n(63599),r=n(62358);class a extends r.m{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof a&&(0,i.p)(this.point,e.point)}}},66974:(e,t,n)=>{n.d(t,{n:()=>o}),n(57845);var i=n(16082),r=n(90304),a=n(92753),s=n(8922),l=n(23106);function o(e=!1,t){if(e){let{elevationInfo:e,alignPointsInFeatures:n}=t;return new c(e,n)}return new u}class u{async alignCandidates(e,t,n){return e}notifyElevationSourceChange(){}}class c{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new i.q(1024),this._cacheVersion=0}async alignCandidates(e,t,n){let i=this._elevationInfo;return null==i||"absolute-height"!==i.mode||i.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,n):(function(e,t,n){let{offset:i,unit:r}=n;if(null==i)return;let a=(0,s.G9)(t),o=i*((0,l.Ao)(r??"meters")/a);for(let t of e)switch(t.type){case"edge":t.start.z+=o,t.end.z+=o;continue;case"vertex":t.target.z+=o;continue}}(e,t,i),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,t,n){let i=new Map;for(let t of e)(0,r.tE)(i,t.objectId,d).push(t);let[s,l,o]=this._prepareQuery(i,t),u=await this._alignPointsInFeatures(s,n);if((0,a.Te)(n),o!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,n);this._applyCacheAndResponse(s,u,l);let{drapedObjectIds:c,failedObjectIds:p}=u,h=[];for(let t of e){let{objectId:e}=t;c.has(e)&&"edge"===t.type&&(t.draped=!0),p.has(e)||h.push(t)}return h}_prepareQuery(e,t){let n=[],i=[];for(let[t,r]of e){let e=[];for(let n of r)this._addToQueriesOrCachedResult(t,n.target,e,i),"edge"===n.type&&(this._addToQueriesOrCachedResult(t,n.start,e,i),this._addToQueriesOrCachedResult(t,n.end,e,i));0!==e.length&&n.push({objectId:t,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:n},i,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,n,i){let r=h(e,t),a=this._alignmentsCache.get(r);null==a?n.push(t):i.push(new p(t,a))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:n,failedObjectIds:i},r){for(let e of r)e.apply();let a=0,s=this._alignmentsCache;for(let{objectId:r,points:l}of e.pointsInFeatures){if(i.has(r)){a+=l.length;continue}let e=!n.has(r);for(let n of l){let i=h(r,n),l=t[a++];n.z=l,e&&s.put(i,l,1)}}}}class p{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function h(e,{x:t,y:n,z:i,spatialReference:r}){return`${e}-${t}-${n}-${i??0}}-wkid:${r?.wkid}`}function d(){return[]}},69659:(e,t,n)=>{n.d(t,{z:()=>s}),n(57845);class i{filter(e,t){return t}notifyElevationSourceChange(){}}class r{filter(e,t){var n;let{point:i,distance:r}=e,{z:s}=i;if(null==s||0===t.length)return t;let o="number"==typeof(n=r)?{x:n,y:n,z:n}:n,u=this._updateCandidatesTo3D(t,i,o).filter(a);return u.sort(l),u}_updateCandidatesTo3D(e,t,n){for(let i of e)switch(i.type){case"edge":!function(e,t,{x:n,y:i,z:r}){let{start:a,end:s,target:l}=e;e.draped||function(e,t,n,i){let r=i.x-n.x,a=i.y-n.y,s=i.z-n.z,l=Math.min(1,Math.max(0,((t.x-n.x)*r+(t.y-n.y)*a+s*(t.z-n.z))/(r*r+a*a+s*s))),o=n.x+r*l,u=n.y+a*l,c=n.z+s*l;e.x=o,e.y=u,e.z=c}(l,t,a,s);let o=(t.x-l.x)/n,u=(t.y-l.y)/i,c=(t.z-l.z)/r;e.distance=Math.sqrt(o*o+u*u+c*c)}(i,t,n);continue;case"vertex":!function(e,t,{x:n,y:i,z:r}){let{target:a}=e,s=(t.x-a.x)/n,l=(t.y-a.y)/i,o=(t.z-a.z)/r;e.distance=Math.sqrt(s*s+l*l+o*o)}(i,t,n);continue}return e}}function a(e){return e.distance<=1}function s(e=!1){return e?new r:new i}function l(e,t){return e.distance-t.distance}}}]);