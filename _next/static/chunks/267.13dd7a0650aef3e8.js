"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[267],{6585:(e,t,i)=>{i.d(t,{G:()=>s});var r=i(78504);class s extends r.L{constructor(e){super(),this._value=e}resize(e){}read(e,t){return this._value}readWithDefault(e,t,i){return this._value}hasArcadeDependency(e){return!1}}},9788:(e,t,i)=>{i.d(t,{A:()=>a,J:()=>s});var r=i(45714);function s(e,t){let i;if("string"==typeof e)i=(0,r.Wm)(e+`-seed(${t})`);else{let r=12;i=e^t;do i=107*(i>>8^i)+r|0;while(0!=--r)}return(1+-(i/0x80000000))/2}function a(e){return Math.floor(s(e,n)*o)}let n=0x32d2550,o=10},20267:(e,t,i)=>{i.d(t,{o:()=>eb});var r=i(77804),s=i(55048),a=i(94360),n=i(10431),o=i(35161),l=i(54598);class c extends l.r{}function h(e){let{sprite:t,isMapAligned:i,colorLocked:r,scaleSymbolsProportionally:s,isStroke:a}=e,l=0;return i&&(l|=(0,n.mR)(o.c.bitset.isMapAligned)),r&&(l|=(0,n.mR)(o.c.bitset.colorLocked)),t.sdf&&(l|=(0,n.mR)(o.c.bitset.isSDF)),s&&(l|=(0,n.mR)(o.c.bitset.scaleSymbolsProportionally)),a&&(l|=(0,n.mR)(o.c.bitset.isStroke)),l}var u=i(37390),d=i(93446);class f extends c{get vertexSpec(){return{createComputedParams:e=>{let{pixelDimensions:t,texelDimensions:i,baseSize:r,referenceSize:a,strokeWidth:n,sizeRatio:o}=e;t||(t=e.sprite.sdf?[0,0]:[e.sprite.width,e.sprite.height]),i||(i=e.sprite.sdf?[0,0]:t),r=(0,s.Lz)(r),a=(0,s.Lz)(a),n=(0,s.Lz)(n);let l=(e.sprite.sdfDecodeCoeff??1)*o;return{...e,pixelDimensions:t,texelDimensions:i,baseSize:r,referenceSize:a,strokeWidth:n,sdfDecodeCoeff:l}},optionalAttributes:{zoomRange:{type:d.pe.SHORT,count:2,packPrecisionFactor:a.fq,pack:({scaleInfo:e},{tileInfo:t})=>(0,n.My)(e,t)}},attributes:{id:{type:d.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:d.pe.UNSIGNED_BYTE,count:1,pack:h},pos:{type:d.pe.SHORT,count:2,pack:"position",packPrecisionFactor:1},offset:{type:d.pe.FLOAT,count:2,packAlternating:{count:4,pack:e=>{let t=e.texelDimensions;return[[-.5*t[0],-.5*t[1]],[.5*t[0],-.5*t[1]],[-.5*t[0],.5*t[1]],[.5*t[0],.5*t[1]]]}}},uv:{type:d.pe.SHORT,count:2,packPrecisionFactor:1,packAlternating:{count:4,packTessellation:({texXmax:e,texXmin:t,texYmax:i,texYmin:r})=>[[t,r],[e,r],[t,i],[e,i]]}},animationPointerAndBaseSizeAndReferenceSize:{type:d.pe.UNSIGNED_SHORT,count:4,packPrecisionFactor:1,pack:({animations:e,baseSize:t,referenceSize:i})=>[e.dataColumn,e.dataRow,t,i]},sizing:{type:d.pe.UNSIGNED_SHORT,count:4,packPrecisionFactor:8,pack:({strokeWidth:e,pixelDimensions:t,baseSize:i,sprite:r,sizeRatio:s})=>{let a=Math.max(i*r.width/r.height,i),n=r.sdfDecodeCoeff*a*s;return[t[0],t[1],e,n]}},angle:{type:d.pe.BYTE,count:1,packTessellation:({angle:e})=>e}}}}_write(e,t){let{textureBinding:i}=this.evaluatedMeshParams.sprite;e.recordStart(this.instanceId,this.attributeLayout,i);let r=t.getDisplayId();if("esriGeometryPolygon"===t.geometryType){let i=t.readCentroidForDisplay();if(!i)return;let[s,a]=i.coords;this._writeQuad(e,r,s,a)}else if("esriGeometryPoint"===t.geometryType){let i=t.readXForDisplay(),s=t.readYForDisplay();this._writeQuad(e,r,i,s)}else{let i=t.readGeometryForDisplay();if(i){let{angleToLine:t}=this.evaluatedMeshParams;if(t){let t=!0,s=null,a=null;i.forEachVertex((i,n)=>{if(null!=s&&null!=a){let o=Math.atan2(n-a,i-s)/u.rp;t&&(this._writeQuad(e,r,s,a,o),t=!1),this._writeQuad(e,r,i,n,o)}s=i,a=n})}else i.forEachVertex((t,i)=>{this._writeQuad(e,r,t,i)})}}e.recordEnd()}_writeQuad(e,t,i,r,s=0){let{rect:n}=this.evaluatedMeshParams.sprite,o=n.x+a.hM,l=n.y+a.hM,c=n.x+n.width-a.hM,h=n.y+n.height-a.hM,u=e.vertexCount();e.recordBounds(i,r,64,64);let d={texXmin:o,texYmin:l,texXmax:c,texYmax:h,angle:s};for(let s=0;s<4;s++)this._writeVertex(e,t,i,r,d);e.indexEnsureSize(6),e.indexWrite(u),e.indexWrite(u+1),e.indexWrite(u+2),e.indexWrite(u+1),e.indexWrite(u+3),e.indexWrite(u+2)}}var p=i(21163),m=i(37787),_=i(62037),y=i(65659),g=i(57129),x=i(83637),v=i(34281),M=i(63391),P=i(33291),b=i(90304),w=i(44460),A=i(47389),k=i(54036),S=i(25561),I=i(35430),z=i(60729),L=i(56599),D=i(50240),E=i(17569),R=i(94993),T=i(59138),B=i(77700);function G(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function F(e,t){return Math.sqrt(e*e+t*t)}function N(e){let t=F(e[0],e[1]);e[0]/=t,e[1]/=t}class C{constructor(e,t,i,r,s){this._segments=e,this._index=t,this._distance=i,this._xStart=r,this._yStart=s,this._done=!1}static create(e){return new C(e,0,0,e[0][0],e[0][1])}clone(){return new C(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}leq(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}geq(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}get _segment(){return this._segments[this._index+1]}get angle(){let e=this.dy,t=Math.acos((0*e+-(-1*this.dx))/this.length);return e>0&&(t=2*Math.PI-t),t}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){let{dx:e,dy:t}=this;return Math.sqrt(e*e+t*t)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<this._segments.length-1}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(e,t){let i=this.backwardLength;if(e<=i)return this._distance=(i-e)/this.length,this;let r=this.backwardLength;for(;this.prev();){if(r+this.length>e)return this._seekBackwards(e-r);r+=this.length}return this._distance=0,t?this:null}seek(e,t=!1){if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;let i=this.remainingLength;for(;this.next();){if(i+this.length>e)return this.seek(e-i,t);i+=this.length}return this._distance=1,t?this:null}}function O(e,t,i,r=!0){let s=function(e){let t=0;for(let i=0;i<e.length-1;i++)t+=function(e,t,i=1){let[r,s]=e[t+1];return[r,s]=[Math.round(r),Math.round(s)],Math.sqrt(r*r+s*s)*i}(e,i);return t}(e),a=C.create(e),n=s/2;if(!r)return a.seek(n),void(Math.abs(a.x)<B.$u&&Math.abs(a.y)<B.$u&&i(a.clone(),0,n+0*t,s));let o=Math.floor(Math.max((s-t)/2,0)/t);a.seek(n-o*t);for(let e=-o;e<=o;e++)Math.abs(a.x)<B.$u&&Math.abs(a.y)<B.$u&&i(a.clone(),e,n+e*t,s),a.seek(t)}function W(e,t){for(let i=0;i<e.length;i++){let r=e[i];!function(e,t){if(t<=0)return;let i=e.length;if(i<3)return;let r=[],s=0;r.push(0);for(let t=1;t<i;t++){var a,n;s+=(a=e[t],n=e[t-1],F(a[0]-n[0],a[1]-n[1])),r.push(s)}t=Math.min(t,.2*s);let o=[];o.push(e[0][0]),o.push(e[0][1]);let l=e[i-1][0],c=e[i-1][1],h=G([0,0],e[0],e[1]);N(h),e[0][0]+=t*h[0],e[0][1]+=t*h[1],G(h,e[i-1],e[i-2]),N(h),e[i-1][0]+=t*h[0],e[i-1][1]+=t*h[1];for(let e=1;e<i;e++)r[e]+=t;r[i-1]+=t;let u=.5*t;for(let s=1;s<i-1;s++){let a=0,n=0,l=0;for(let i=s-1;i>=0&&!(r[i+1]<r[s]-u);i--){let o=u+r[i+1]-r[s],c=r[i+1]-r[i],h=r[s]-r[i]<u?1:o/c;if(1e-6>Math.abs(h))break;let d=h*h,f=h*o-.5*d*c,p=h*c/t,m=e[i+1],_=e[i][0]-m[0],y=e[i][1]-m[1];a+=p/f*(m[0]*h*o+.5*d*(o*_-c*m[0])-d*h*c*_/3),n+=p/f*(m[1]*h*o+.5*d*(o*y-c*m[1])-d*h*c*y/3),l+=p}for(let o=s+1;o<i&&!(r[o-1]>r[s]+u);o++){let i=u-r[o-1]+r[s],c=r[o]-r[o-1],h=r[o]-r[s]<u?1:i/c;if(1e-6>Math.abs(h))break;let d=h*h,f=h*i-.5*d*c,p=h*c/t,m=e[o-1],_=e[o][0]-m[0],y=e[o][1]-m[1];a+=p/f*(m[0]*h*i+.5*d*(i*_-c*m[0])-d*h*c*_/3),n+=p/f*(m[1]*h*i+.5*d*(i*y-c*m[1])-d*h*c*y/3),l+=p}o.push(a/l),o.push(n/l)}o.push(l),o.push(c);for(let t=0,r=0;t<i;t++)e[t][0]=o[r++],e[t][1]=o[r++]}(r,t);let s=[];s.push(r[0]);for(let e=1;e<r.length;e++){let[t,i]=r[e-1],[a,n]=r[e],o=a-t,l=n-i;s.push([o,l])}e[i]=s,r=s}return e}var Z=i(91438);let j=(0,b.Bj)(e=>{let t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t});class V extends Z.G8{constructor(){super(...arguments),this._zoomLevel=0}_write(e,t,i,r){if(this._zoomLevel=r||0,null!=i)throw Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(t.geometryType){case"esriGeometryPoint":{let i=t.readXForDisplay(),r=t.readYForDisplay();this._writePoint(e,i,r,t);break}case"esriGeometryEnvelope":case"esriGeometryPolygon":case"esriGeometryMultipoint":{let i=t.readCentroidForDisplay();if(!i)return;let[r,s]=i.coords;this._writePoint(e,r,s,t);break}case"esriGeometryPolyline":this._writeLines(e,t)}}_getMetricDir(){let{horizontalAlignment:e,verticalAlignment:t}=this.evaluatedMeshParams;return["center"===e?0:"right"===e?-1:1,"middle"===t?0:"bottom"===t?-1:1]}_createLineLabelMetric(e,t,i,r){let s=(0,E.Q4)(e),[a,n]=this._getMetricDir(),o=this.evaluatedMeshParams.scaleInfo?.maxScale??0,l=this.evaluatedMeshParams.scaleInfo?.minScale??0;return new T.f(s,t,i,a,n,o,l,r??null)}_writePoint(e,t,i,r){let s=this._getShaping();if(!s)return;let a=r.getDisplayId(),n=(0,D.xy)(this.evaluatedMeshParams.horizontalAlignment),o=(0,D.UD)(this.evaluatedMeshParams.verticalAlignment),l=this.evaluatedMeshParams.scaleInfo?.maxScale??0,c=this.evaluatedMeshParams.scaleInfo?.minScale??0,h=(0,E.Q4)(r.getDisplayId()),u=this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0};e.metricStart(new T.f(h,t,i,n,o,l,c,u)),this._writeGlyphs(e,a,t,i,s,0,u),e.metricBoxWrite(s.boundsT),e.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(let e of this._references){let t=e.getBoundsInfo();if(t)return t}return null}_writeLines(e,t){let{scaleInfo:i,verticalAlignment:r}=this.evaluatedMeshParams,s=this.evaluatedMeshParams.repeatLabelDistance||128,a=this._getShaping("middle");if(!a)return;let o=(e,t,i,r)=>this._placeSubdivGlyphs(e,t,i,r),l=(a.bounds.width+s)/2;this._current={out:e,id:t.getDisplayId(),shaping:a,zoomRange:(0,n.My)(i,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null},this._verticalPlacement="bottom"===r?"above":"top"===r?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(t,o,l):this._writeCenterAlong(t,o,l)}_writeAboveAndBelowAlong(e,t,i){let{repeatLabel:r}=this.evaluatedMeshParams,{shaping:s}=this._current,a=s.bounds.halfHeight,n=e.readGeometryForDisplay();if(!n)return;let o=new L.A;(0,z.kz)(o,n,!1,!1,"esriGeometryPolyline",1);let l=q(new L.A,o,a),c=q(new L.A,o,-a),h=(0,z.zv)(c,"esriGeometryPolyline",!1,!1),u=W((0,z.zv)(l,"esriGeometryPolyline",!1,!1).paths,s.bounds.width),d=W(h.paths,s.bounds.width);for(let e of(this._current.offsetDirection="above",u))O(e,i,t,!!r);for(let e of(this._current.offsetDirection="below",d))O(e,i,t,!!r)}_writeCenterAlong(e,t,i){let{repeatLabel:r}=this.evaluatedMeshParams,{shaping:s}=this._current;for(let a of W(e.readLegacyGeometryForDisplay().paths,s.bounds.width))O(a,i,t,!!r)}_placeSubdivGlyphs(e,t,i,r){let{allowOverrun:s,labelPosition:a,repeatLabelDistance:n}=this.evaluatedMeshParams,o=this._current.zoomRange[0],l=j(t),c=this._current.shaping.bounds.width/2,h=Math.sqrt(n||128)/2,u=Math.min(i,r-i),d=this._current.shaping.isMultiline?Z.GJ:Math.log2(u/(h+c/2)),f=0===t?d:Math.min(l,d),p=Math.max(o,this._zoomLevel+1-f),m=this._zoomLevel-p,_=this._current.shaping.bounds.width/2*2**m;this._current.shaping.isMultiline?0===t&&this._placeStraight(e,p):s&&m<0?this._placeStraightAlong(e,o):"parallel"===a?this._placeStraightAlong(e,p):"curved"===a&&this._placeCurved(e,p,_)}_placeStraight(e,t){let{out:i,id:r,shaping:s,referenceBounds:a}=this._current,{x:n,y:o}=e;i.metricStart(this._createLineLabelMetric(r,n,o)),i.metricBoxWrite(s.boundsT);let l=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360;this._writeGlyphs(i,r,n,o,s,0,a,{clipAngle:l,mapAligned:!0,isLineLabel:!0,minZoom:t}),this._writeGlyphs(i,r,n,o,s,0,a,{clipAngle:c,mapAligned:!0,isLineLabel:!0,minZoom:t}),i.metricEnd()}_placeCurved(e,t,i){let{out:r,id:s}=this._current;r.metricStart(this._createLineLabelMetric(s,e.x,e.y));let a=e.clone(),n=e.angle*(180/Math.PI)%360,o=(e.angle*(180/Math.PI)+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(a,t,1,n),this._placeBack(e,a,t,i,1,n),this._placeForward(e,a,t,i,1,n)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(a,t,0,o),this._placeBack(e,a,t,i,0,o),this._placeForward(e,a,t,i,0,o)),r.metricEnd()}_placeStraightAlong(e,t){let{out:i,id:r,shaping:a,zoomRange:n,referenceBounds:o}=this._current,{boxBorderLineColor:l,boxBackgroundColor:c}=this.evaluatedMeshParams,h=e.clone(),u=e.angle*(180/Math.PI)%360,d=(e.angle*(180/Math.PI)+180)%360,f=a.glyphs.length>0&&!(!l&&!c);if(i.metricStart(this._createLineLabelMetric(r,e.x,e.y)),f){let l=Math.max(t,n[0],0),c=Math.min(Z.GJ,n[1]),h=(0,w.$0)((0,A.vt)(),-e.angle),f={minZoom:l,maxZoom:c,clipAngle:u,mapAligned:!0,isLineLabel:!0},p=(0,s.Lz)(this.evaluatedMeshParams.offsetX),m=(0,s.Lz)(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){let t=(0,S.fA)(p,-1*m),[s,n]=a.shapeBackground((0,w.Tl)((0,A.vt)(),h,t));i.recordStart(this.instanceId,this.attributeLayout,a.glyphs[0].textureBinding);let l=2*Math.max(s.width,s.height);i.recordBounds(e.x+s.x,e.y+s.y,l,l),this._writeTextBox(i,r,e.x,e.y,n,o,f),i.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){let t=(0,S.fA)(p,m),[s,n]=a.shapeBackground((0,w.Tl)((0,A.vt)(),h,t));f.clipAngle=d,i.recordStart(this.instanceId,this.attributeLayout,a.glyphs[0].textureBinding);let l=2*Math.max(s.width,s.height);i.recordBounds(e.x+s.x,e.y+s.y,l,l),this._writeTextBox(i,r,e.x,e.y,n,o,f),i.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(h,t,1,u,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(h,t,0,d,!0),i.metricEnd()}_placeBack(e,t,i,r,s,a){let n=e.clone(),o=e.backwardLength+0;for(;n.prev()&&!(o>=r);)this._placeOnSegment(n,t,o,i,-1,s,a),o+=n.length+0}_placeForward(e,t,i,r,s,a){let n=e.clone(),o=e.remainingLength+0;for(;n.next()&&!(o>=r);)this._placeOnSegment(n,t,o,i,1,s,a),o+=n.length+0}_placeFirst(e,t,i,r,a=!1){let{out:n,id:o,shaping:l,zoomRange:c,referenceBounds:h}=this._current,u=l.glyphs,d=(0,s.Lz)(this.evaluatedMeshParams.offsetX),f=(0,s.Lz)(this.evaluatedMeshParams.offsetY),p=(0,S.fA)(d,f),m=(0,w.$0)((0,A.vt)(),-e.angle);for(let s of((0,k.l0)(p,p,m),u)){let u=s.x>l.bounds.x?i:1-i,d=u*e.remainingLength+(1-u)*e.backwardLength,f=Math.abs(s.x+s.width/2-l.bounds.x),m=Math.max(0,this._zoomLevel+Math.log2(f/(d+0))),_=Math.max(t,a?0:m);if(s.maxZoom=Math.min(c[1],Z.GJ),s.angle=e.angle+(1-i)*Math.PI,s.minZoom=Math.max(c[0],_),this._writeLineGlyph(n,o,e.x,e.y,l.bounds,s,r,h,!0),(i||this._current.offsetDirection)&&this._isVisible(s.minZoom,s.maxZoom)){let e=new R.A(s.bounds.x+p[0],s.bounds.y+p[1],s.bounds.width,s.bounds.height);n.metricBoxWrite(e)}}}_placeOnSegment(e,t,i,r,a,n,o){let{out:l,id:c,shaping:h,referenceBounds:u}=this._current,d=h.glyphs,f=e.dx/e.length,p=e.dy/e.length,m={x:e.x+-(i*a)*f,y:e.y+-(i*a)*p},_=(0,s.Lz)(this.evaluatedMeshParams.offsetX),y=(0,s.Lz)(this.evaluatedMeshParams.offsetY),g=(0,S.fA)(_,y),x=(0,w.$0)((0,A.vt)(),-e.angle);for(let t of((0,k.l0)(g,g,x),d)){let s=t.x>h.bounds.x?n:1-n;if(!(s&&1===a||!s&&-1===a))continue;let d=Math.abs(t.x+t.width/2-h.bounds.x),f=Math.max(0,this._zoomLevel+Math.log2(d/i)-.1),p=Math.max(r,this._zoomLevel+Math.log2(d/(i+e.length+0)));if(0!==f&&(t.angle=e.angle+(1-n)*Math.PI,t.minZoom=p,t.maxZoom=f,this._writeLineGlyph(l,c,m.x,m.y,h.bounds,t,o,u,!0),(n||this._current.offsetDirection)&&this._isVisible(t.minZoom,t.maxZoom))){let e=new R.A(t.bounds.x+g[0],t.bounds.y+g[1],t.bounds.width,t.bounds.height);l.metricBoxWrite(e)}}}_writeLineGlyph(e,t,i,r,s,a,o,l,c){let h=i+s.x,u=r+s.y,d=2*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1),f=Math.max(s.width,s.height)*d;e.recordStart(this.instanceId,this.attributeLayout,a.textureBinding),e.recordBounds(h,u,f,f);let{texcoords:p,offsets:m}=a,{fontSize:_,haloSize:y,outlineSize:g}=this._textMeshTransformProps;this._writeQuad(e,t,i,r,{texcoords:p,offsets:m,fontSize:_,haloSize:y,outlineSize:g,color:(0,n.Jb)(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:l,minZoom:Math.max(this._current.zoomRange[0],a.minZoom),maxZoom:Math.min(this._current.zoomRange[1],a.maxZoom),clipAngle:o,mapAligned:c,isLineLabel:!0}),e.recordEnd()}_isVisible(e,t){let i=Math.floor(this._zoomLevel*a.fq)/a.fq;return e<=i&&i<=t}}function q(e,t,i){let{coords:r,lengths:s}=t,a=(0,I.vt)(),n=(0,I.vt)(),o=(0,I.vt)(),l=(0,I.vt)(),c=(0,I.vt)(),h=(0,I.vt)(),u=0;for(let t=0;t<s.length;t++){let d=s[t];for(let t=0;t<d;t++){let s=2*(t+u-1),f=2*(t+u),p=2*(t+u+1);t>0?(0,k.hZ)(a,r[s],r[s+1]):(0,k.hZ)(a,0,0),(0,k.hZ)(n,r[f],r[f+1]),t<d-1?(0,k.hZ)(o,r[p],r[p+1]):(0,k.hZ)(o,0,0),0===t?(0,k.hZ)(l,0,0):((0,k.jb)(l,n,a),(0,k.S8)(l,l),(0,k.hZ)(l,l[1],-l[0])),t===d-1?(0,k.hZ)(c,0,0):((0,k.jb)(c,o,n),(0,k.S8)(c,c),(0,k.hZ)(c,c[1],-c[0])),(0,k.WQ)(h,l,c),(0,k.S8)(h,h);let m=h[0]*c[0]+h[1]*c[1];0!==m&&(0,k.hs)(h,h,m),(0,k.hs)(h,h,i),e.coords.push(n[0]+h[0],n[1]+h[1])}e.lengths.push(d),u+=d}return e}var Y=i(73143),Q=i(13453),$=i(38756),X=i(21689),H=i(31461),J=i(32391),U=i(33715),K=i(61939),ee=i(20703),et=i(9788),ei=i(10435);function er(e){return e instanceof es?e:"object"==typeof e&&"type"in e?el[e.type].hydrate(e):new ea(e)}class es{constructor(e){this.inputs=e}encode(){let e=[];for(let t of this.inputs)e.push(...t.encode());return e.push(...this.instructions),e}}class ea extends es{constructor(e){super([]),this.value=e}simplify(){return this}get instructions(){if(Array.isArray(this.value)){let[e,t,i,r]=this.value;return null!=r?ei.GA.vector4.encode([e,t||0,i||0,r]):ei.GA.vector3.encode([e,t||0,i||0])}return ei.GA.scalar.encode(this.value)}}class en extends es{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new en(e,er(e.parent))}simplify(){if(this._config.relativeTranslation||this._config.absoluteScale)return this;let e=this._parent.simplify();if(!(e instanceof ea))return this;let[t,i,r,s]=e.value,a=this._config.translation.from[0],n=this._config.translation.from[1],o=this._config.rotation.from,l=this._config.scale.from;if(a===this._config.translation.to[0]&&n===this._config.translation.to[1]&&o===this._config.rotation.to&&l===this._config.scale.to){let e=Math.sin(r),c=Math.cos(r);return new ea([c*s*a-e*s*n+t,e*s*a+c*s*n+i,r+o,s*l])}return new en(this._config,e)}get instructions(){return ei.GA.animatedTransform.encode(this._config)}}class eo extends es{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new eo(e,er(e.parent))}simplify(){let e=this._parent.simplify();if(!(e instanceof ea))return this;let[t,i,r,s]=e.value,a=this._config.color.from[0],n=this._config.color.from[1],o=this._config.color.from[2],l=this._config.color.from[3],c=this._config.opacity.from;return a===this._config.color.to[0]&&n===this._config.color.to[1]&&o===this._config.color.to[2]&&l===this._config.color.to[3]&&c===this._config.opacity.to?new ea([t*a,i*n,r*o,s*(l*=c)]):new eo(this._config,e)}get instructions(){return ei.GA.animatedColor.encode(this._config)}}let el={AnimatedTransform:en,AnimatedColor:eo};var ec=i(70152);function eh(e){let t=[],i=[],r=0;for(let s of e){let a=[...s.encode(),...ei.GA.ret.encode()];t.push([r+e.length,0,0,0]),i.push(...a),r+=a.length}return[...t,...i]}async function eu(e,t){let i;if("number"==typeof e||"string"==typeof e||"boolean"==typeof e)i=e;else if(Array.isArray(e))i=await Promise.all(e.map(e=>eu(e,t)));else if("object"==typeof e)if("valueExpressionInfo"in e){let{valueExpressionInfo:r}=e,{expression:s}=r;i={...e,computed:await t.createComputedField({expression:s})}}else for(let r in i={},e)i[r]=await eu(e[r],t);return i}function ed(e,t,i){let r;if("number"==typeof e||"string"==typeof e||"boolean"==typeof e)r=e;else if(Array.isArray(e))r=e.map(e=>ed(e,t,i));else if("object"==typeof e)if("type"in e&&null!=e.type&&"Process"===e.type)switch(e.op){case"ArcadeColor":{let s=ed(e.value,t,i);ef(Array.isArray(s)&&4===s.length),r=[s[0]/255,s[1]/255,s[2]/255,s[3]]}break;case"Transparency":{let s=ed(e.value,t,i);ef("number"==typeof s),r=1-s/100}break;case"Divide":case"Add":{let s=ed(e.left,t,i);ef("number"==typeof s);let a=ed(e.right,t,i);switch(ef("number"==typeof a),e.op){case"Divide":r=s/a;break;case"Add":r=s+a}}break;case"Random":{let s=ed(e.seed,t,i),a=ed(e.min,t,i),n=ed(e.max,t,i),o=t.getObjectId(),l=(0,et.A)(o||0);r=a+(0,et.J)(l,s)*(n-a)}break;case"Cond":{let s=ed(e.condition,t,i),a=ed(e.ifTrue,t,i),n=ed(e.ifFalse,t,i);r=s?a:n}break;case"MatchWinding":{let s=ed(e.sign,t,i),a=ed(e.angle,t,i);if(s>0)for(;a<0;)a+=2*Math.PI;else for(;a>0;)a-=2*Math.PI;r=a}}else if("computed"in e)r=function(e){if(!("computed"in e))return e;let r=e.computed.readWithDefault(t,i,[255*e.defaultValue[0],255*e.defaultValue[1],255*e.defaultValue[2],e.defaultValue[3]]);if("string"==typeof r){let e=ec.A.fromString(r);e&&(r=[e.r,e.g,e.b,e.a])}return r}(e);else for(let s in r={},e)r[s]=ed(e[s],t,i);return r}function ef(e){if(!e)throw Error("Assertion failed.")}var ep=i(21722),em=i(6585);let e_=()=>K.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator");async function ey(e,t,i=!1){let{defaultValue:r,valueExpressionInfo:s,value:a}=t;if(s){let{expression:a}=s,n=await e.createComputedField({expression:a},i);return n?{...t,computed:n,defaultValue:r}:null}return{...t,computed:new em.G(a),defaultValue:r}}async function eg(e,t){let{valueExpressionInfo:i}=t,{expression:r}=i,s=await e.createComputedField({expression:r});return s?{...t,computed:s}:null}function ex(e){return"object"==typeof e&&null!=e&&(!(!("valueExpressionInfo"in e)||!e.valueExpressionInfo)||"type"in e&&"Process"===e.type&&"op"in e&&"Random"===e.op)}function ev(e){if(Array.isArray(e)){for(let t of e)if(ev(t))return!0}if("object"==typeof e){if(ex(e))return!0;for(let t in e)if(ev(e[t]))return!0}return!1}class eM{static async create(e,t,i){let r={},s=new Map,a=new Map,n=new Map,o=new Map,l=new Map,c=new Map;for(let h in i){let u=i[h];if(null!=u&&"object"==typeof u)if(Array.isArray(u)){if("object"==typeof u[0])throw Error(`InternalError: Cannot handle ${h}. Nested array params are not supported`);r[h]=u}else if("valueExpressionInfo"in u){if(u.value){r[h]=u.value;continue}let t=await eg(e,u);if(!t){r[h]=u.defaultValue;continue}s.set(h,t),r[h]=null}else switch(u.type){case"cim-effect-infos":if(u.effectInfos.some(e=>e.overrides.length)){a.set(h,{effects:await Promise.all(u.effectInfos.map(async t=>{let i=t.overrides.map(t=>ey(e,t));return{effect:t.effect,compiledOverrides:(await Promise.all(i)).filter(H.Ru)}}))});break}r[h]=u.effectInfos.map(e=>e.effect);break;case"cim-marker-placement-param":u.overrides.length&&n.set(h,{placementInfo:u,compiledOverrides:(await Promise.all(u.overrides.map(t=>ey(e,t)))).filter(H.Ru)}),r[h]=u.placement;break;case"text-rasterization-param":{if(u.overrides.length){let t=u.overrides.map(t=>ey(e,t,u.useLegacyLabelEvaluationRules));o.set(h,{compiledOverrides:(await Promise.all(t)).filter(H.Ru),rasterizationParam:u,objectIdToResourceId:new Map});continue}let i={type:"cim-rasterization-info",resource:u.resource};r[h]=await t.fetchResourceImmediate(i)??null;break}case"sprite-rasterization-param":{if(u.overrides.length){let t=u.overrides.map(t=>ey(e,t));o.set(h,{compiledOverrides:(await Promise.all(t)).filter(H.Ru),rasterizationParam:u,objectIdToResourceId:new Map});continue}if("animated"===u.resource.type){o.set(h,{compiledOverrides:[],rasterizationParam:u,objectIdToResourceId:new Map});continue}let i={type:"cim-rasterization-info",resource:u.resource};r[h]=await t.fetchResourceImmediate(i)??null;break}case"cim-marker-transform-param":{let{params:t}=u;if(ev(t)){let i={compiledMarkerInfos:[]};await Promise.all(t.map(async t=>{let r={props:{}};for(let i in t)if(ex(t[i])){let s=await eg(e,t[i]);r.compiledExpressionMap||(r.compiledExpressionMap=new Map);let a=r.compiledExpressionMap;s&&a.set(i,s)}else r.props[i]=t[i];i.compiledMarkerInfos.push(r)})),l.set(h,i)}else r[h]={type:"cim-marker-transform-info",infos:t};break}case"animation-params":{let{params:i}=u,s=function(e){let t=[];return t.push(e.transform),t.push(e.fromColor),t.push(e.toColor),t.push(e.colorMix),t.push(e.toOpacity),t.push(e.opacityMix),t}(i);if(ev(s)){let t=await Promise.all(s.map(t=>eu(t,e)));c.set(h,{params:t,propertyIdToResourceId:new Map,key:h})}else{let e=eh(s.map(e=>ed(e)).map(e=>er(e).simplify())),i=await t.fetchResourceImmediate({type:"animation-info",resource:e});null!=i&&"sprite"===i.type&&(r[h]={dataRow:i.rect.y,dataColumn:i.rect.x})}break}default:r[h]=u}else r[h]=u}return new eM(i,r,s,a,n,o,l,c)}constructor(e,t,i,r,s,a,n,o){for(let l of(this.inputMeshParams=e,this._resolvedMeshParams=t,this._dynamicProperties=i,this._dynamicEffectProperties=r,this._dynamicPlacementProperties=s,this._dynamicAsyncProperties=a,this._dynamicTransformProperties=n,this._dynamicAsyncAnimations=o,this.evaluator=e=>e,this._arcadeDependencies=new Set,this._expressions()))(0,ee.QY)(this._arcadeDependencies,l)}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(e,t,i){for(let r of this._dynamicAsyncProperties.values()){let s=(0,U.o8)(r.rasterizationParam.resource);for(let{primitiveName:e,propertyName:a,computed:n,defaultValue:o,valueExpressionInfo:l}of("animated"===r.rasterizationParam.resource.type&&r.rasterizationParam.resource.randomizeStartTime&&(s.primitiveName="__RESERVED__PRIMITIVE__NAME__",s.startGroup=(0,et.A)(t.getObjectId()||0)),r.compiledOverrides))try{let l="animated"===r.rasterizationParam.resource.type?s.primitiveName:e;(0,ep.Ph)(s,l,a,n,t,i,o)}catch(t){e_().errorOnce(new J.A("invalid-arcade-expression",`Encountered an error when evaluating the arcade expression '${l?.expression}' (primitive: '${e}', property: '${a}')`,t))}let a=e.enqueueRequest({type:"cim-rasterization-info",resource:s});r.objectIdToResourceId.set(t.getObjectId(),a)}for(let r of this._dynamicAsyncAnimations.values()){let s=eh(r.params.map(e=>ed(e,t,i)).map(er).map(e=>e.simplify())),a=e.enqueueRequest({type:"animation-info",resource:s});r.propertyIdToResourceId.set(t.getObjectId()+"."+r.key,a)}}evaluateMeshParams(e,t,i){for(let[e,r]of this._dynamicProperties.entries())this._resolvedMeshParams[e]=r.computed.readWithDefault(t,i,r.defaultValue);for(let[e,r]of this._dynamicPlacementProperties.entries())for(let{computed:s,defaultValue:a,propertyName:n}of r.compiledOverrides){let o=s.readWithDefault(t,i,a);r.placementInfo.placement[n]=o,this._resolvedMeshParams[e]=r.placementInfo.placement}for(let[e,r]of this._dynamicEffectProperties.entries())for(let s of r.effects){for(let{computed:e,defaultValue:r,propertyName:a}of s.compiledOverrides){let n=e.readWithDefault(t,i,r);s.effect[a]=n}this._resolvedMeshParams[e]=r.effects.map(e=>e.effect)}for(let[e,r]of this._dynamicTransformProperties.entries()){let s={type:"cim-marker-transform-info",infos:[]};for(let e of r.compiledMarkerInfos){let r={...e.props};if(e.compiledExpressionMap)for(let[s,a]of e.compiledExpressionMap){let e=a.computed.readWithDefault(t,i,a.defaultValue);r[s]="number"==typeof e||"boolean"==typeof e?e:a.defaultValue}s.infos.push(r)}this._resolvedMeshParams[e]=s}for(let[i,r]of this._dynamicAsyncProperties.entries()){let s=r.objectIdToResourceId.get(t.getObjectId());if(null==s)continue;let a=e.getResource(s);this._resolvedMeshParams[i]=a}for(let[i,r]of this._dynamicAsyncAnimations.entries()){let s=r.propertyIdToResourceId.get(t.getObjectId()+"."+i);if(null==s)continue;let a=e.getResource(s);this._resolvedMeshParams[i]={dataRow:a.rect.y,dataColumn:a.rect.x}}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}hasArcadeDependency(e){return this._arcadeDependencies.has(e)}*_expressions(){for(let e of this._dynamicProperties.values())yield e.computed;for(let e of this._dynamicEffectProperties.values())for(let t of e.effects)for(let e of t.compiledOverrides)yield e.computed;for(let e of this._dynamicPlacementProperties.values())for(let t of e.compiledOverrides)yield t.computed;for(let e of this._dynamicAsyncProperties.values())for(let t of e.compiledOverrides)yield t.computed;for(let e of this._dynamicTransformProperties.values())for(let t of e.compiledMarkerInfos)if(null!=t.compiledExpressionMap)for(let e of t.compiledExpressionMap.values())yield e.computed;for(let e of this._dynamicAsyncAnimations.values())for(let t of e.params)yield*function* e(t){if(Array.isArray(t))for(let i of t)yield*e(i);else if("object"==typeof t)if("type"in t&&null!=t.type&&"Process"===t.type)switch(t.op){case"ArcadeColor":case"Transparency":yield*e(t.value);break;case"Divide":case"Add":yield*e(t.left),yield*e(t.right);break;case"Random":yield*e(t.seed),yield*e(t.min),yield*e(t.max);break;case"Cond":yield*e(t.condition),yield*e(t.ifTrue),yield*e(t.ifFalse);break;case"MatchWinding":yield*e(t.sign),yield*e(t.angle)}else if("computed"in t)yield t.computed;else for(let i in t)yield*e(t[i])}(t)}}var eP=i(85017);class eb{async createMeshWriter(e,t,i,r){let s=this._getMeshWriter(r.techniqueType),a=await eM.create(e,t,r.inputParams),n=new s(r.id,a,r.optionalAttributes,i);return await n.loadDependencies(),n}_getMeshWriter(e){switch(e){case r.N.Fill:return y.Y;case r.N.DotDensity:return p.k;case r.N.ComplexFill:return m.KE;case r.N.PatternFill:return v.m;case r.N.GradientFill:return g.S;case r.N.OutlineFill:return x.w0;case r.N.PatternOutlineFill:return M.Q;case r.N.ComplexOutlineFill:return _.O;case r.N.Marker:return X.H;case r.N.PieChart:return eP.v;case r.N.Text:return Z.G8;case r.N.Line:return Q.Bw;case r.N.TexturedLine:return $.K;case r.N.GradientStroke:return Y.F;case r.N.Heatmap:return P.h;case r.N.Label:return V;case r.N.AnimatedMarker:return f;default:throw Error("Internal Error: Mesh writer not in the registry")}}}}}]);