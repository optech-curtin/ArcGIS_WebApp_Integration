"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[13],{13:(e,t,r)=>{r.d(t,{default:()=>e8});var a,i=r(32391),n=r(29368),s=r(32274),l=r(81856),o=r(91838),u=r(57845),m=r(61939);r(33638);var d=r(12709),c=r(76001),f=r(6675);class p{constructor(){this.connection=null}async open(e){this.connection=await (0,f.ho)("statsWorker",{strategy:"distributed",signal:e})}destroy(){this.connection?.close()}static getInstance(){return p.instance||(p.instance=new p),p.instance}async summaryStatistics(e,t){if(!this.connection)throw new i.A("worker-client:summary-statistics","connection is required");return this.connection.invoke("summaryStatistics",{attribute:e,features:t})}async uniqueValues(e,t){if(!this.connection)throw new i.A("worker-client:unique-values","connection is required");return this.connection.invoke("uniqueValues",{attribute:e,features:t})}async classBreaks(e,t){if(!this.connection)throw new i.A("worker-client:class-breaks","connection is required");return this.connection.invoke("classBreaks",{attribute:e,features:t})}async histogram(e,t){if(!this.connection)throw new i.A("worker-client:histogram","connection is required");return this.connection.invoke("histogram",{attribute:e,features:t})}async heatmapStatistics(e,t){if(!this.connection)throw new i.A("worker-client:heatmap-statistics","connection is required");return this.connection.invoke("heatmapStatistics",{attribute:e,features:t})}}var h=r(97135),y=r(31461),g=r(92753),w=r(21371),F=r(39265),v=r(39166),S=r(73723),x=r(86277),_=r(92528),V=r(32523),T=r(21170),z=r(23345),L=r(49570),b=r(86099);async function q(e,t,r,a){return E(t,await A(e,t,r,a),r,a)}async function A(e,t,r,a){let n,s={...a},l=function(e,t){let r=b.A.from(e);r.sourceSpatialReference=r.sourceSpatialReference??t?.sourceSpatialReference??null,(t?.gdbVersion||t?.dynamicDataSource)&&((r=r===e?r.clone():r).gdbVersion=e.gdbVersion||t.gdbVersion,r.dynamicDataSource=e.dynamicDataSource?V.L.from(e.dynamicDataSource):t.dynamicDataSource);let a=t?.infoFor3D;if(null!=a&&M(e,a)){(r=r===e?r.clone():r).formatOf3DObjects=null;let t=(0,_.U9)(a),n=(0,_.CW)(a);for(let e of a.queryFormats){if(e===t){r.formatOf3DObjects=e;break}e!==n||r.formatOf3DObjects||(r.formatOf3DObjects=e)}if(!r.formatOf3DObjects)throw new i.A("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==r.outFields||!r.outFields.includes("*")){null==(r=r===e?r.clone():r).outFields&&(r.outFields=[]);let{originX:t,originY:i,originZ:n,translationX:s,translationY:l,translationZ:o,scaleX:u,scaleY:m,scaleZ:d,rotationX:c,rotationY:f,rotationZ:p,rotationDeg:h}=a.transformFieldRoles;r.outFields.push(t,i,n,s,l,o,u,m,d,c,f,p,h)}}return r}(t,r),o=null!=t.outStatistics?.[0],m=(0,u.A)("featurelayer-pbf-statistics"),d=!o||m;if("pbf"===r?.format&&d)try{n=await (0,z.S)(e,l,s)}catch(e){if("query:parsing-pbf"!==e.name)throw e;r.format="json"}return"json"!==r?.format&&d||(n=await (0,T.e)(e,l,s)),function(e,t){if(null!=e&&null!=t)for(let r of t){let t=e.get(r.name);t&&Object.assign(r,t.toJSON())}}(r?.fieldsIndex,n.fields),n}async function E(e,t,a,i){let n=a?.infoFor3D;if(!M(e,n)||null==n||!t.assetMaps||!t.features?.length)return L.A.fromJSON(t);let{meshFeatureSetFromJSON:s}=await (0,g.qr)(Promise.all([r.e(9878),r.e(6414),r.e(5533)]).then(r.bind(r,39703)),i);return s(e,n,t)}function M(e,t){return null!=t&&!0===e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}var C=r(25999);async function N(e,t,r,a){let i=(0,x.Dl)(e),{source:n,checkValueRange:s}=t,{classificationDefinition:l}=r,o={...r.toJSON(),f:"json"},u=null;u="class-breaks-definition"===l?.type?l.classificationField:l?.attributeField,n&&(o.layer=JSON.stringify({source:n?.toJSON()})),o.classificationDef&&(o.classificationDef=JSON.stringify(o.classificationDef));let m={query:o};a&&(m={...a,...m});let d={url:i.path,field:u,checkValueRange:s},c=i.path+"/generateRenderer";return(0,v.A)(c,m).then(e=>(function(e,t){let{field:r,checkValueRange:a,url:i}=e,n=t?.data;if(!n)return;if(!a)return Promise.resolve(I(n));let s=new C.A({statisticType:"min",onStatisticField:r}),l=new C.A({statisticType:"max",onStatisticField:r});return q(i,new b.A({outStatistics:[s,l]})).then(e=>{let t=e.features[0].attributes,r=null,a=null;for(let e in t)0===e.toLowerCase().indexOf("min")?r=t[e]:a=t[e];return I(n,r,a)})})(d,e))}function I(e,t,r){if("classBreaks"===e.type){let a=(0,S.r)(e);return{classBreaks:a.classBreakInfos.map((e,i)=>(0===i&&null!=t&&(e.minValue=t),i===a.classBreakInfos.length-1&&null!=r&&(e.maxValue=r),{minValue:e.minValue,maxValue:e.maxValue,label:e.label})),normalizationTotal:a.normalizationTotal}}let{uniqueValueInfos:a}=e;return{uniqueValues:a?.map((e,i)=>(0===i&&null!=t&&(e.value=t),i===a.length-1&&null!=r&&(e.value=r),{count:e.count,value:e.value,label:e.label}))??[]}}var P=r(92713);let O=class extends P.A{constructor(e){super(e),this.classificationDefinition=null,this.where=null}};(0,l._)([(0,o.MZ)({json:{name:"classificationDef",write:!0}})],O.prototype,"classificationDefinition",void 0),(0,l._)([(0,o.MZ)({type:String,json:{write:!0}})],O.prototype,"where",void 0);let k=O=(0,l._)([(0,d.$)("esri.rest.support.GenerateRendererParameters")],O);var G=r(33498);let Z=class extends P.A{constructor(e){super(e),this.type="unique-value-definition",this.attributeField=null,this.attributeField2=null,this.attributeField3=null,this.fieldDelimiter=null}get uniqueValueFields(){let e=[];return this.attributeField&&e.push(this.attributeField),this.attributeField2&&e.push(this.attributeField2),this.attributeField3&&e.push(this.attributeField3),e}};(0,l._)([(0,G.e)({uniqueValueDef:"unique-value-definition"})],Z.prototype,"type",void 0),(0,l._)([(0,o.MZ)()],Z.prototype,"attributeField",void 0),(0,l._)([(0,o.MZ)()],Z.prototype,"attributeField2",void 0),(0,l._)([(0,o.MZ)()],Z.prototype,"attributeField3",void 0),(0,l._)([(0,o.MZ)({json:{write:!0}})],Z.prototype,"fieldDelimiter",void 0),(0,l._)([(0,o.MZ)({json:{write:!0}})],Z.prototype,"uniqueValueFields",null);let B=Z=(0,l._)([(0,d.$)("esri.rest.support.UniqueValueDefinition")],Z),$="no_dominant_category";function R(e){var t;let r=function(e,t=!1){let r=e.map(e=>`"${e}"`);return`
  var fieldNames = [ ${r.join(", ")} ];
  var numFields = ${r.length};
  var maxValueField = null;
  var maxValue = -Infinity;
  var value, i, totalValue = null;

  for(i = 0; i < numFields; i++) {
    value = $feature[fieldNames[i]];

    if(value > 0) {
      if(value > maxValue) {
        maxValue = value;
        maxValueField = fieldNames[i];
      }
      else if (value == maxValue) {
        maxValueField = null;
      }
    }
    ${t?"\n  if(value != null && value >= 0) {\n    if (totalValue == null) { totalValue = 0; }\n    totalValue = totalValue + value;\n  }\n  ":""}
  }
  `}(e);return`
  ${(t=e)&&t.map(e=>`$feature["${e}"];`).join("\n")+"\n"||""}
  ${r}
  return maxValueField;
  `}var D=r(40941),Q=r(45257),J=r(99572),j=r(73368),U=r(34361),H=r(72980),W=r(31551);let X=class extends W.A{constructor(e){super(e),this.adapterName="layer-adapter"}};(0,l._)([(0,o.MZ)({readOnly:!0})],X.prototype,"adapterName",void 0),(0,l._)([(0,o.MZ)({constructOnly:!0})],X.prototype,"layer",void 0),(0,l._)([(0,o.MZ)()],X.prototype,"geometryType",void 0),(0,l._)([(0,o.MZ)()],X.prototype,"objectIdField",void 0),(0,l._)([(0,o.MZ)()],X.prototype,"supportsSQLExpression",void 0),(0,l._)([(0,o.MZ)()],X.prototype,"hasQueryEngine",void 0),(0,l._)([(0,o.MZ)()],X.prototype,"minScale",void 0),(0,l._)([(0,o.MZ)()],X.prototype,"maxScale",void 0),(0,l._)([(0,o.MZ)()],X.prototype,"fullExtent",void 0);let Y=X=(0,l._)([(0,d.$)("esri.smartMapping.support.adapters.LayerAdapter")],X);var K=r(59983),ee=r(6005),et=r(81647),er=r(63843),ea=r(7381),ei=r(45104),en=r(87488),es=r(79516);r(95048),r(26474),r(58081);var el=r(80824),eo=r(73140);let eu=/_value$/i,em=Math.LOG10E,ed={SECOND:1e3,MINUTE:6e4,HOUR:36e5};function ec(e){return e.map(e=>e.toJSON())}function ef(e,t){let r=[],a=e.layer,i="featureReduction"in a?a.featureReduction:null,n="binning"===i?.type,s=null!=i&&"fields"in i?i.fields?.map(e=>e.name?.toLowerCase()).filter(Boolean):[];if(!n||!t)return r;for(let e of t)s.includes(e.toLowerCase())||r.push(e);return r}function ep(e,t,r){let a=[];if(t)for(let i of t){let t=e.getField(i);t&&r&&"availableFields"in r&&!r.availableFields?.includes(t.name)&&a.push(t.name)}return a}function eh(e,t){let r=e&&e.features;if(0===r?.length)return{avg:null,count:0,max:null,median:null,min:null,nullcount:0,stddev:null,sum:null,variance:null};let a=r?.[0]?.attributes,i={};for(let e in a)i[e.replace(eu,"").toLowerCase()]=a[e];return null!=i.totalcount&&i.totalcount>=i.count&&(i.nullcount=i.totalcount-i.count),delete i.totalcount,i.min===i.max&&null!=i.min&&null==i.stddev&&(i.stddev=i.variance=0),t&&(["min","max","avg","stddev","sum","variance"].forEach(e=>{null!=i[e]&&(i[e]=Math.ceil(i[e]))}),i.min===i.max&&null!=i.min&&(i.avg=i.min,i.stddev=i.variance=0)),i}function ey(e){let{field:t,normalizationType:r,normalizationField:a,normalizationTotal:i,layer:n}=e,l=(0,s.R3)(n,t),o=t;return"percent-of-total"===r?o=`((${l?(0,s.Ll)(t):t} / ${i}) * 100)`:"log"===r?o=`(log(${t}) * ${em})`:"field"===r?o=`(${l?(0,s.Ll)(t):t} / ${a})`:"natural-log"===r?o=`(log(${l?(0,s.Ll)(t):t}))`:"square-root"===r&&(o=`(power(${l?(0,s.Ll)(t):t}, 0.5))`),o}function eg(e,t){let r;if(t=t.toLowerCase(),e){for(let a in e)if(a.toLowerCase()!==t){r=e[a];break}}return r}function ew(e,t){let r;if(t=t.toLowerCase(),e){for(let a in e)if(a.toLowerCase()===t){r=e[a];break}}return r}function eF(e,t,r,a,i){let n={},s="countOFExpr";e&&e.features&&e.features.forEach(e=>{let t=e.attributes,r=eg(t,s),a=ew(t,s);null!=r&&null!=a&&0!==r&&(n[r]=a)});let l=[];return(0,eo.OR)(t,r,a).forEach((e,t)=>{let r=(t+1).toString();l.push({minValue:e[0],maxValue:e[1],count:n.hasOwnProperty(r)?n[r]:0})}),{bins:l,minValue:t,maxValue:r,normalizationTotal:i}}async function ev(e,t){let r=e&&e.features,{field:a,field2:i,field3:n,fieldDelimiter:s,layer:l,view:o,signal:u,labels:m}=t,d=`countOF${!(!a||!i)?"Expr":a||"Expr"}`,c={},f=!1;for(let e of r){let t=e.attributes,r=ew(t,d),l=a?ew(t,a):eg(t,d),o=i?ew(t,i):null,u=n?ew(t,n):null;null===l&&0===r&&(f=!0),(null==l||"string"==typeof l&&""===l.trim())&&(l=null),i&&(null==o||"string"==typeof o&&""===o.trim())&&(o=null),n&&(null==u||"string"==typeof u&&""===u.trim())&&(u=null);let m=l;i&&(m=`${(0,eo.gJ)(m)}${s}${(0,eo.gJ)(o)}`,n&&(m=`${m}${s}${(0,eo.gJ)(u)}`)),null==c[m]?c[m]={count:r,data:m}:c[m].count=c[m].count+r}if(a&&f)try{let e=await l.queryFeatureCount({whereClause:a+" is NULL",view:o,signal:u});return c.null.count=c.null.count+e,eS(c,m)}catch{return(0,g.Te)(u),eS(c,m)}return eS(c,m)}function eS(e,t){if(t)for(let r in e)e[r].label=t[r];return{count:e}}async function ex(e,t,r){let a=e?r.getField(e):null,i=a?r.getFieldDomain(a.name):null;if(i)return i;let{uniqueValueInfos:n}=await r.uniqueValues({field:e,sqlWhere:t.sqlWhere,features:t.features,useFeaturesInView:t.useFeaturesInView,view:t.view,signal:t.signal}),s=n.map(e=>new en.H({code:e.value}));return new es.A({codedValues:s})}async function e_(e,t){if(!e.returnAllCodedValues)return[];let{field:r,field2:a,field3:i}=e;if(r&&!a){let e=r?t.getField(r):null,a=e?t.getFieldDomain(e.name):null;return a?[a]:[]}let n=[];return r&&(n.push(ex(r,e,t)),a&&(n.push(ex(a,e,t)),i&&n.push(ex(i,e,t)))),Promise.all(n)}function eV(e){return{viewingMode:"2d"===e.type?"map":e.viewingMode,scale:e.scale,spatialReference:e.spatialReference?.toJSON()}}function eT(e,t){let r=new Set(e.map(e=>e.value));for(let a of t.filter(e=>!r.has(e)))e.push({value:a,count:0});for(let r of(e.sort((e,r)=>t.indexOf(e.value)-t.indexOf(r.value)),e))r.value===$&&(r.value=null);return{predominantCategoryInfos:e}}function ez(e){let t="featureReduction"in e?e.featureReduction:null;return((null!=t&&"fields"in t?t.fields:null)??[]).map(t=>{let r=function(e,t){switch(e.statisticType){case"avg":case"avg_angle":return"double";case"count":return"integer";case"min":case"max":case"sum":return e.onStatisticField?t.get(e.onStatisticField)?.type??null:e.onStatisticExpression?"string"===e.onStatisticExpression.returnType?null:"double":null;case"mode":return e.onStatisticField?t.get(e.onStatisticField)?.type??null:e.onStatisticExpression?"string"===e.onStatisticExpression.returnType?"string":"double":null;default:return null}}(t,e.fieldsIndex);return r?new el.A({type:r,name:t.name,alias:t.alias}):null}).filter(y.Ru)}function eL(e,t){var r,a;return(0,s.fs)(t)?(r=t?.name,(0,s.aM)(e,new Date(0),r,"milliseconds").sqlExpression):(0,F.OH)(t)&&(a=t?.name)?(0,s.Ll)(["HOUR","MINUTE","SECOND"].map(e=>`(EXTRACT(${e} FROM ${a}) * ${ed[e]})`).join(" + ")):null}function eb(e,t,r){let{field:a,normalizationType:i,normalizationField:s,normalizationTotal:l,minValue:o,maxValue:u,filter:m}=t,d=e.supportsSQLExpression?eL(e,r)||t.sqlExpression:null,c=ey({field:a,normalizationType:i,normalizationField:s,normalizationTotal:l,layer:e}),f=d||c,p=f?(0,n.lX)(f,o,u):null,h=(0,n.Lc)({field:a,normalizationField:s,normalizationType:i}),y=(0,n.sf)(t.sqlWhere,h),g=(0,n.sf)(y,p),w=(0,eo.Vb)({normalizationField:s,normalizationType:i,sqlExpression:d,supportsSQLExpression:e.supportsSQLExpression,minValue:o,maxValue:u}),v=(0,F.yM)(e.getField(a??void 0)),{include:S,exclude:x}=t.outStatisticTypes||{},_=eo.wy.filter(e=>(!S||S.includes(e))&&(!x||!x.includes(e))&&("nullcount"===e?w:!v||"count"===e)),V=e.createQuery();return V.where=(0,n.sf)(V.where,g),V.sqlFormat=d?"standard":null,V.outStatistics=_.map(t=>{let r=new C.A,a=null,i=null,n=`${t}_value`;if("variance"===t)a="var",i=f;else if("nullcount"===t){let t=e.objectIdField;a="count",i=t&&e.getField(t)?t:"1",n="totalcount_value"}else"median"===t?(a="percentile-continuous",i=f,r.statisticParameters={value:.5}):(a=t,i=f);return r.statisticType=a,r.onStatisticField=i,r.outStatisticFieldName=n,r}),eq(V,m),V}function eq(e,t){t&&(e.geometry=t.geometry,e.spatialRelationship=t.spatialRelationship)}function eA(e,t){let{field:r,field2:a,field3:i,sqlExpression:s}=t,l=!(!r||!a),o=e.createQuery();return o.where=(0,n.sf)(o.where,t.sqlWhere),o.sqlFormat=s?"standard":null,o.outStatistics=[function(e,t){let r="countOF"+(e||"Expr"),a=new C.A;return a.statisticType="count",a.onStatisticField=t?"1":e,a.outStatisticFieldName=r,a}(l?null:r,l?"1":s)].filter(Boolean),o.groupByFieldsForStatistics=[r||s,a,i].filter(Boolean),eq(o,t.filter),o}function eE(e,t,r,a=10,i,s,l){let{min:o,max:u,normTotal:m,excludeZerosExpr:d}=t,c=t.intervals||(0,eo.OR)(o,u,a);return(function(e,t,r,a,i,s,l){let o=[],u=t.length;for(let e=0;e<u;e++){let i=(0,n.sf)(a,(0,n.sf)(r+" >= "+t[e][0],null!==t[e][1]?r+(e===u-1?" <= ":" < ")+t[e][1]:""));o.push(i)}return Promise.allSettled(o.map(t=>e.queryFeatureCount({whereClause:t,view:i,filter:s,signal:l})))})(e,c,t.sqlExpr||r,d,i,s,l).then(e=>({bins:e.map((e,t)=>({minValue:c[t][0],maxValue:c[t][1],count:"fulfilled"===e.status?e.value:0})),minValue:o,maxValue:u,normalizationTotal:m}))}let eM="countOFExpr";function eC(e,t,r){let a=e.valueExpression||e.sqlExpression,i=e.signal;if(!a){let{field:a,normalizationType:l,normalizationField:o}=e,u=a?t.getField(a):null,m=(0,s.fs)(u)||(0,F.OH)(u);return{sqlExpression:m?eL(t,u):ey({field:a,normalizationType:l,normalizationField:o,normalizationTotal:r,layer:t}),sqlWhere:m?null:e.sqlWhere||(0,n.Lc)({field:a,normalizationType:l,normalizationField:o}),filter:e.filter,signal:i}}return{valueExpression:e.valueExpression,sqlExpression:e.sqlExpression,sqlWhere:e.sqlWhere,filter:e.filter,signal:i}}async function eN(e,t,r){let{field:a,normalizationType:i,normalizationField:s,signal:l}=e,o=(0,n.Lc)({field:a,normalizationType:i,normalizationField:s}),u=new k({classificationDefinition:(0,eo.al)({field:a,normalizationType:i,normalizationField:s,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,definedInterval:e.definedInterval,breakCount:e.numBins||10}),where:(0,n.sf)(o,r)});return t.generateRenderer(u,l).then(e=>{let{normalizationTotal:r,classBreaks:n}=e;return function(e){let t=[],r=e.classBreaks,a=r[0].minValue,i=r[r.length-1].maxValue;return r.forEach(e=>{t.push([e.minValue,e.maxValue])}),{min:a,max:i,intervals:t,sqlExpr:ey({field:e.field,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,layer:e.layer}),excludeZerosExpr:e.where,normTotal:e.normalizationTotal}}({field:a,normalizationType:i,normalizationField:s,normalizationTotal:r,classBreaks:n,where:o,layer:t})})}async function eI(e,t,r,a,s){let{field:l,sqlExpression:o,normalizationField:u,classificationMethod:m,normalizationType:d}=e,c=l?t.getField(l):null,f=(0,F.OH)(c),p=(0,F.zD)(c)||f,h=e.numBins||10;if(p){if(d||m)throw new i.A(`${t.adapterName}:not-supported`,"NormalizationType and classificationMethod are not supported for date-only and time-only fields");let e=(a-r)/h/1e3;return new er.A({field:l,expression:o,interval:{unit:f?"seconds":"days",value:Math.ceil(f?e:e/86400)},start:r,end:a})}if("defined-interval"===m)return new ei.A({field:l,expression:o,normalizationField:u,normalizationTotal:s,normalizationType:d,interval:e.definedInterval??Math.ceil((a-r)/h),start:d?null:r,end:d?null:a,normalizationMinValue:d?r:null,normalizationMaxValue:d?a:null});if("manual"===m)throw new i.A(`${t.adapterName}:not-supported`,"Layer does not support manual classificationMethod");if("natural-breaks"===m||"quantile"===m||"standard-deviation"===m){let a=ey({field:l,normalizationField:u,normalizationTotal:s,normalizationType:d,layer:t}),m=null!==e.minValue&&null!==e.maxValue?(0,n.lX)(a,e.minValue,e.maxValue):void 0,c=await eN(e,t,m);if(!c.intervals)throw new i.A(`${t.adapterName}:invalid`,"Invalid intervals returned from generate renderer");let f=[r,...c.intervals.map(e=>e[1])];return new ea.A({field:d?null:l,expression:d?a:o,boundaries:f})}return new et.A({field:l,normalizationField:u,normalizationTotal:s,normalizationType:d,expression:o,numBins:h,start:d?null:r,end:d?null:a,normalizationMinValue:d?r:null,normalizationMaxValue:d?a:null})}function eP(e,t,r,a){return null!=r&&null!=a?Promise.resolve({min:r,max:a}):t.summaryStatistics({...e,outStatisticTypes:{include:["min","max"]}}).then(e=>({min:e.min,max:e.max}))}async function eO(e,t,r,a){let{field:i,minValue:s,maxValue:l,filter:o,view:u}=e,m=i?t.getField(i):null,d=(0,F.vE)(m)||(0,F.Ah)(m),c=eC(e,t,r),{min:f,max:p}=await eP(c,t,s,l);if(null==f||null==p)return{query:null,min:f,max:p};let h=new C.A({statisticType:"count",outStatisticFieldName:eM,onStatisticField:"1"}),y=(0,n.sf)(a,c.sqlWhere),g=new ee.default({binParameters:await eI(e,t,f,p,r),outStatistics:[h],binOrder:e.sortOrder,where:y,lowerBoundaryAlias:"lowerBoundary",upperBoundaryAlias:"upperBoundary",outTimeZone:u?.timeZone&&d?(0,K.wj)(u.timeZone):null});return eq(g,o),{query:g,min:f,max:p}}function ek(e,t=!1){return"string"!=typeof e?e:new Date(t?`1970-01-01T${e}Z`:e).getTime()}function eG(e,t,r){let a=(0,F.OH)(t);return{...r,bins:e.features.map(e=>({minValue:ek(e.attributes.lowerBoundary,a),maxValue:ek(e.attributes.upperBoundary,a),count:e.attributes[eM]}))}}function eZ(e,t,r){let{valueExpression:a,view:i}=e,{featuresJSON:n,graphics:s,fieldInfos:l}=t,o={field:e.field,valueExpression:a,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:r,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numBins:e.numBins};return a&&i&&(n||s)&&(o.viewInfoParams=eV(i),o.timeZone=i.timeZone,o.fieldInfos=l),o}var eB=r(20703);let e$=null,eR=class extends Y{constructor(){super(...arguments),this._hasLocalSource=!1,this.adapterName="in-memory-layer-adapter"}destroy(){this.workerClient?.destroy()}async _waitForLayerViewUpdate(e){if(!e)throw new i.A(`${this.adapterName}:insufficient-data", "layerView is required to fetch the features`);let t=new AbortController,r=(0,Q.C_)(()=>!e.updating,t.signal);await (0,g.wR)(r,5e3,t).catch(e=>{throw m.A.getLogger(this).warn("LayerView is taking too long to update. Aborting fetch from layerView."),e})}async _fetchFeatureSetFromMemory(e,t,r){let a=this.layer;if(this._hasLocalSource&&"queryFeatures"in a)return a.queryFeatures(e);if(!t)throw new i.A(`${this.adapterName}:insufficient-data`,"view is required to fetch the features from layerView");let n=await t.whenLayerView(this.layer);return await this._waitForLayerViewUpdate(n),n.queryFeatures(e,{signal:r})}async _fetchFeaturesFromMemory(e,t,r,a){let n=this.layer,s="json"===a;if(this._hasLocalSource&&"queryFeatures"in n){let e=await n.queryFeatures(t);return s?ec(e.features):e.features}if(await this._waitForLayerViewUpdate(e),s&&"queryFeaturesJSON"in e&&e.queryFeaturesJSON){let{features:a}=await e.queryFeaturesJSON(t,{signal:r});return a}if(!("queryFeatures"in e))throw new i.A(`${this.adapterName}:not-supported`,"'queryFeatures' is not supported on the layerView");let l=await e.queryFeatures(t,{signal:r});return s?ec(l.features):l.features}_fetchFeaturesForStats(e,t){return(0,s.EG)({field:e.field,field2:e.field2,field3:e.field3,normalizationField:e.normalizationField,valueExpression:e.valueExpression}).then(r=>this.getSampleFeatures({sampleSize:-1,view:e.view,returnGeometry:e.returnGeometry,filter:e.filter,requiredFields:r,signal:e.signal},t))}async _summaryStatsFromClientQuery(e,t){let{view:r,signal:a}=e,i=eb(this,e,t),n=eh(await this._fetchFeatureSetFromMemory(i,r,a),(0,s.fs)(t)||(0,F.OH)(t));return(0,eo.oZ)(n,e.outStatisticTypes)}async _getNormalizationTotalFromMemory(e,t,r){let{featuresJSON:a,graphics:n,layerView:s,query:l}=t,o={include:["sum"]},u=(!a&&!n&&s&&"querySummaryStatistics"in s?await s.querySummaryStatistics(l,{field:e},{signal:r}):a?await this.workerClient.summaryStatistics({field:e,outStatisticTypes:o},a):await (0,H.summaryStatistics)({attribute:{field:e,outStatisticTypes:o},features:n??[]})).sum;if(null==u)throw new i.A(`${this.adapterName}:invalid`,"invalid normalizationTotal");return u}async _summaryStatsFromMemory(e,t){let{view:r,field:a,valueExpression:i,normalizationType:n,signal:s}=e,l={field:a,valueExpression:i,normalizationType:n,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,outStatisticTypes:e.outStatisticTypes},{featuresJSON:o,graphics:u,layerView:m,query:d,fieldInfos:c}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"querySummaryStatistics"});return i&&r&&(o||u)&&(l.fieldType=t?.type?j.m.toJSON(t.type):null,l.viewInfoParams=eV(r),l.timeZone=r.timeZone,l.fieldInfos=c),"percent-of-total"===n&&null==e.normalizationTotal&&(l.normalizationTotal=await this._getNormalizationTotalFromMemory(a,{featuresJSON:o,graphics:u,layerView:m,query:d},s)),!o&&!u&&m&&"querySummaryStatistics"in m?m.querySummaryStatistics(d,l,{signal:s}):o?this.workerClient.summaryStatistics(l,o):(0,H.summaryStatistics)({attribute:l,features:u})}async _getFilteredFeatures(e,t){let a=[];if("intersects"===t?.spatialRelationship){let{intersect:i}=await r.e(4344).then(r.bind(r,34344)),n=null!=t.geometry?t.geometry:null;for(let t of e){let e=null!=t.geometry?t.geometry:null;e&&n&&await i(e,n)&&a.push(t)}}else a=e;return e.length&&"declaredClass"in e[0]&&"esri.Graphic"===e[0].declaredClass?{graphics:a}:{featuresJSON:a}}async _processStatsFromMemoryParams(e){let{features:t,filter:r}=e;if(t?.length)return this._getFilteredFeatures(t,r);let{view:a,field:i,field2:n,field3:l,normalizationField:o,valueExpression:u,layerViewFunc:m,signal:d}=e,c=e.returnGeometry;if(null==c&&u){if(!e$){let{arcadeUtils:e}=await (0,eB.lw)();e$=e}let e=e$.hasGeometryOperations(u);e&&await e$.enableGeometryOperations(),c=e}let f=null,p=null,h=null,y=null,g=null;if(a)try{let e="subtype-sublayer"===this.layer.type?this.layer.parent:this.layer;f=await a.whenLayerView(e),p=null!=m&&m in f&&"function"==typeof f[m]}catch{p=!1}if(p)try{await this._waitForLayerViewUpdate(f);let e=await (0,s.EG)({field:i,field2:n,field3:l,normalizationField:o,valueExpression:u});ep(this,e,f).length?p=!1:((h=this.layer.createQuery()).outFields=e,h.returnGeometry=!1,eq(h,r)),f.suspended&&(p=!1)}catch{p=!1}return p||(y=await this._fetchFeaturesForStats({field:i,field2:n,field3:l,valueExpression:u,normalizationField:o,returnGeometry:c,filter:r,view:a,signal:d},"json"),g=(await (0,s.EG)({valueExpression:u})).map(e=>this.getField(e)?.toJSON()).filter(Boolean)),{layerView:f,query:h,featuresJSON:y,fieldInfos:g}}async _uvFromClientQuery(e,t){let{view:r,signal:a}=e,i=eA(this,e),n=await this._fetchFeatureSetFromMemory(i,r,a),l=await ev(n,{layer:this,field:e.field,field2:e.field2,field3:e.field3,fieldDelimiter:s.UH,view:e.view,signal:e.signal});return(0,eo.lv)(l,t,e.returnAllCodedValues,s.UH)}async _uvFromMemory(e,t){let{view:r,field:a,valueExpression:i,returnAllCodedValues:n,signal:l}=e,{featuresJSON:o,graphics:u,layerView:m,query:d,fieldInfos:c}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryUniqueValues"}),f={field:a,field2:e.field2,field3:e.field3,fieldDelimiter:s.UH,valueExpression:i,domains:t,returnAllCodedValues:n};return i&&r&&(o||u)&&(f.viewInfoParams=eV(r),f.timeZone=r.timeZone,f.fieldInfos=c),!o&&!u&&m&&"queryUniqueValues"in m?m.queryUniqueValues(d,f,{signal:l}):o?this.workerClient.uniqueValues(f,o):(0,H.uniqueValues)({attribute:f,features:u})}_histogramForField(e){let t=null;return(null!=e.minValue&&null!=e.maxValue?Promise.resolve({min:e.minValue,max:e.maxValue}):this.summaryStatistics({...e,outStatisticTypes:{include:["min","max","count"]}}).then(e=>{if(!e.count)throw new i.A(`${this.adapterName}:insufficient-data`,"Either the layer has no features or none of the features have data for the field");return{min:e.min,max:e.max}})).then(t=>eE(this,{min:t.min,max:t.max},e.field,e.numBins??void 0,e.view,e.filter,e.signal))}async _histogramFromQueryAttributeBinsFromMemory(e){let{field:t,normalizationType:r,signal:a}=e,i=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryAttributeBins"}),{featuresJSON:n,graphics:s,layerView:l,query:o}=i,u="percent-of-total"===r?e.normalizationTotal??await this._getNormalizationTotalFromMemory(t,i,a):void 0;if(!l||!("queryAttributeBins"in l)||n||s){let t=eZ(e,i,u);return n?this.workerClient.histogram(t,n):(0,H.histogram)({attribute:t,features:s})}let{query:m,min:d,max:c}=await eO(e,this,u,o?.where);return m?eG(await l.queryAttributeBins(m,{signal:a}),t?this.getField(t):null,{minValue:d,maxValue:c,normalizationTotal:u}):{bins:[],minValue:d,maxValue:c,normalizationTotal:u}}async _histogramFromMemory(e){let{field:t,signal:r}=e,a=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryHistogram"}),{featuresJSON:i,graphics:n,layerView:s,query:l}=a,o="percent-of-total"===e.normalizationType?e.normalizationTotal??await this._getNormalizationTotalFromMemory(t,a,r):void 0,u=eZ(e,a,o);return!i&&!n&&s&&"queryHistogram"in s?s.queryHistogram(l,u,{signal:r}):i?this.workerClient.histogram(u,i):(0,H.histogram)({attribute:u,features:n})}_classBreaksFromInterpolation(e){let{minValue:t,maxValue:r}=e,a=e.numClasses||5,i=[],n=(r-t)/a;for(let e=0;e<a;e++){let r=t+e*n;i.push({minValue:r,maxValue:r+n})}i[a-1].maxValue=r;let s={classBreaks:i,normalizationTotal:e.normalizationTotal};return Promise.resolve((0,eo.jM)(s,e.classificationMethod))}async _classBreaksFromMemory(e){let{view:t,field:r,valueExpression:a,signal:i}=e,{featuresJSON:n,graphics:s,layerView:l,query:o,fieldInfos:u}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryClassBreaks"}),m={field:r,valueExpression:a,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return a&&t&&(n||s)&&(m.viewInfoParams=eV(t),m.timeZone=t.timeZone,m.fieldInfos=u),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(m.normalizationTotal=await this._getNormalizationTotalFromMemory(r,{featuresJSON:n,graphics:s,layerView:l,query:o},i)),!n&&!s&&l&&"queryClassBreaks"in l?l.queryClassBreaks(o,m,{signal:i}):n?this.workerClient.classBreaks(m,n):(0,H.classBreaks)({attribute:m,features:s})}async _heatmapStatsFromMemory(e){let{view:t,field:r,radius:a,signal:i}=e;(0,D.Lw)(t,"InMemoryLayerAdapter: must have a view");try{let r=await t.whenLayerView(this.layer);if("queryHeatmapStatistics"in r&&!r.updating&&!e.filter)return await r.queryHeatmapStatistics({field:e.field,radius:e.radius})}catch{(0,g.Te)(i)}let{featuresJSON:n,graphics:s}=await this._processStatsFromMemoryParams({...e,returnGeometry:!0}),l=new U.A({extent:t.extent,tolerance:"2d"===t.type?t.state.resolution:t.pixelSizeAt?.(t.center)}),o={field:r,radius:a,transform:(0,J.VV)(l),spatialReference:t.spatialReference?.toJSON(),size:t.size};return n?.length||s?.length?n?this.workerClient.heatmapStatistics(o,n):(0,H.heatmapStatistics)({attribute:o,features:s}):{min:null,max:null}}getField(e=""){return this.layer.getField(e)}getFieldUsageInfo(e){return this.getField(e)?{supportsLabelingInfo:!0,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:!0,supportsStatistics:!0}:null}getFieldDomain(e,t){return this.layer.getFieldDomain(e,t)}createQuery(){return this.layer.createQuery()}async summaryStatistics(e){let{field:t,valueExpression:r,sqlExpression:a,features:n,view:s}=e,l=t?this.getField(t):null,o="3d"===s?.type;if(!r&&a&&!this.supportsSQLExpression)throw new i.A(`${this.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return r||n||o?this._summaryStatsFromMemory(e,l):this._summaryStatsFromClientQuery(e,l)}async uniqueValues(e){let{valueExpression:t,sqlExpression:r,features:a,view:n}=e,s=await e_(e,this),l="3d"===n?.type;if(!t&&r&&!this.supportsSQLExpression)throw new i.A(`${this.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return t||a||l?this._uvFromMemory(e,s):this._uvFromClientQuery(e,s)}async histogram(e){let{features:t,valueExpression:r,normalizationType:a,sqlExpression:n}=e;if(!r&&n&&!this.supportsSQLExpression)throw new i.A(`${this.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return t||r||a?this._histogramFromMemory(e):this._histogramForField(e)}async classBreaks(e){return!1!==e.analyzeData?this._classBreaksFromMemory(e):this._classBreaksFromInterpolation(e)}async queryFeatureCount(e){let{whereClause:t,view:r,signal:a}=e;if(!r)throw new i.A(`${this.adapterName}:insufficient-data`,"view is required to fetch the features from layerView");let s=this.layer.createQuery();s.where=(0,n.sf)(s.where,t);let l=await r.whenLayerView(this.layer);return await (0,Q.C_)(()=>!l.updating,a),l.queryFeatureCount(s,{signal:a})}async generateRenderer(e,t){throw new i.A(`${this.adapterName}:not-supported`,"Layer does not support generateRenderer operation")}async predominantCategories(e){let{fields:t,view:r,signal:a,filter:i}=e,n=R(t);return eT((await this._uvFromMemory({valueExpression:n,view:r,signal:a,filter:i})).uniqueValueInfos,t)}async heatmapStatistics(e){return this._heatmapStatsFromMemory(e)}async getSampleFeatures(e,t){let{view:r,sampleSize:a,requiredFields:n,returnGeometry:s,filter:l,signal:o}=e,u=this.layer.createQuery();if(u.outSpatialReference=r?.spatialReference,u.returnGeometry=!!s,u.outFields=n,eq(u,l),!r)throw new i.A(`${this.adapterName}:not-supported`,"view is required to get sample features for Layer");let m=await r.whenLayerView(this.layer);if(ep(this,n,m).length)throw new i.A(`${this.adapterName}:not-supported`,"Required fields need to be passed in the outFields for Layer");let d=await this._fetchFeaturesFromMemory(m,u,o,t),c=null!=a&&a>0&&a<=d.length?a:d.length;return(0,y.BB)(d,c,1)}load(e){let t=this.layer.load(e).then(async t=>{this.geometryType=t.geometryType,this.objectIdField=t.objectIdField,this.supportsSQLExpression="stream"===t.type||!!t.capabilities?.query?.supportsSqlExpression,this.minScale=t.minScale,this.maxScale=t.maxScale,this.fullExtent="fullExtent"in t?t.fullExtent:t.parent?.fullExtent,this._hasLocalSource=!1,this.hasQueryEngine=!0,this.workerClient=p.getInstance(),await this.workerClient.open(e.signal)});return this.addResolvingPromise(t),Promise.resolve(this)}};(0,l._)([(0,o.MZ)({readOnly:!0})],eR.prototype,"adapterName",void 0),(0,l._)([(0,o.MZ)({constructOnly:!0})],eR.prototype,"layer",void 0);let eD=eR=(0,l._)([(0,d.$)("esri.smartMapping.support.adapters.InMemoryLayerAdapter")],eR);var eQ=r(13907);let eJ=class extends eD{constructor(){super(...arguments),this.adapterName="feature-layer-adapter"}_isStatsSupportedOnService(){let e=this.layer;if(!e.capabilities?.query?.supportsStatistics||"multipatch"===this.geometryType&&!(0,w.Wo)(e.url)&&e.version<10.5)throw new i.A(`${this.adapterName}:not-supported`,"Layer does not support statistics query");return Promise.resolve()}_fetchFeaturesFromService(e,t){return this.layer.queryFeatures(e,{signal:t}).then(e=>e.features)}_fetchFeaturesJSONFromService(e,t){return this._fetchFeaturesFromService(e,t).then(ec)}_summaryStatsFromGenRend(e){let t=e.normalizationType,r=e.normalizationField;return this.classBreaks({field:e.field,numClasses:5,classificationMethod:"standard-deviation",standardDeviationInterval:.25,normalizationType:t,normalizationField:"field"===t?r:void 0,minValue:e.minValue,maxValue:e.maxValue,filter:e.filter,signal:e.signal}).then(t=>{let r,a,i;if(t.classBreakInfos?.some(e=>(e.hasAvg&&(r=e),!!r)),r){let e=r.maxValue-r.minValue;a=r.minValue+e/2,i=4*e}let n={min:t.minValue,max:t.maxValue,avg:a,stddev:i};return(0,eo.oZ)(n,e.outStatisticTypes)})}async _summaryStatsFromServiceQuery(e,t){await this._isStatsSupportedOnService(),"percent-of-total"===e.normalizationType&&(e.normalizationTotal=await this._getNormalizationTotal(e.field,e.normalizationType,e.filter));let r=(0,s.fs)(t)||(0,F.OH)(t),a=eb(this,e,t),i=eh(await this.layer.queryFeatures(a,{signal:e.signal}),r);return(0,eo.oZ)(i,e.outStatisticTypes)}_uvFromGenRenderer(e,t){let r=e.field??void 0,a=new k({classificationDefinition:new B({attributeField:r})});return this.generateRenderer(a,e.signal).then(e=>{let t={},a=this.getField(r);return e.uniqueValues.forEach(e=>{let r=e.value;null!=r&&""!==r&&("string"!=typeof r||""!==r.trim()&&"<null>"!==r.toLowerCase())||(r=null),null==t[r]?t[r]={count:e.count,data:(0,F.WA)(a)&&r?Number(r):r}:t[r].count=t[r].count+e.count}),{count:t}}).then(r=>(0,eo.lv)(r,[t],e.returnAllCodedValues))}async _uvFromServiceQuery(e,t){return this._isStatsSupportedOnService().then(()=>this.layer.queryFeatures(eA(this,e),{signal:e.signal})).then(t=>ev(t,{layer:this,field:e.field,field2:e.field2,field3:e.field3,fieldDelimiter:s.UH,view:e.view,signal:e.signal})).then(r=>(0,eo.lv)(r,t,e.returnAllCodedValues,s.UH))}_getNormalizationTotal(e,t,r,a){return e&&"percent-of-total"===t?this.summaryStatistics({field:e,outStatisticTypes:{include:["sum"]},filter:r,signal:a}).then(e=>e.sum):Promise.resolve(null)}_histogramForExpr(e){return this._getNormalizationTotal(e.field,e.normalizationType,e.filter,e.signal).then(t=>{let r=eC(e,this,t);return eP(r,this,e.minValue,e.maxValue).then(a=>{let i=a.min,s=a.max;if(null==i||null==s)return{bins:[],minValue:i,maxValue:s,normalizationTotal:t};let l=e.numBins||10,o=(0,eo.OR)(i,s,l),u=function(e,t,r){let a=[],i=t.length;return t.forEach((t,s)=>{let[l,o]=t,u=null;u=0!==s||r?s!==i-1||r?(0,n.sf)(`${e} >= ${l}`,`${e} ${s===i-1?" <= ":" < "} ${o}`):`${e} >= ${l}`:`${e} < ${o}`,a.push("WHEN ("+u+") THEN "+(s+1))}),["CASE",a.join(" "),"ELSE 0","END"].join(" ")}(r.sqlExpression,o,null!=e.minValue&&null!=e.maxValue),m=new C.A({statisticType:"count",outStatisticFieldName:"countOFExpr",onStatisticField:"1"}),d=this.layer.createQuery();return d.where=(0,n.sf)(d.where,r.sqlWhere),d.sqlFormat="standard",d.outStatistics=[m],d.groupByFieldsForStatistics=[u],d.orderByFields=[u],eq(d,e.filter),this._isStatsSupportedOnService().then(()=>this.layer.queryFeatures(d,{signal:r.signal})).then(e=>eF(e,i,s,l,t))})})}async _histogramFromQueryAttributeBins(e){let{field:t,normalizationType:r,filter:a,signal:i}=e,n=await this._getNormalizationTotal(t,r,a,i),s=this.layer.createQuery(),{query:l,min:o,max:u}=await eO(e,this,n,s?.where);return l?eG(await this.layer.queryAttributeBins(l,{signal:i}),t?this.getField(t):null,{minValue:o,maxValue:u,normalizationTotal:n}):{bins:[],minValue:o,maxValue:u,normalizationTotal:n}}_classBreaksFromGenRend(e){let{field:t,normalizationType:r,normalizationField:a,normalizationTotal:i,signal:s}=e,l=(0,n.Lc)({field:t,normalizationType:r,normalizationField:a}),o=ey({field:t,normalizationType:r,normalizationField:a,normalizationTotal:i,layer:this}),u=(0,n.lX)(o,e.minValue,e.maxValue),m=new k({classificationDefinition:(0,eo.al)({field:t,normalizationType:r,normalizationField:a,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,breakCount:e.numClasses||5})});return m.where=(0,n.sf)(l,u),this.generateRenderer(m,s).then(t=>(0,eo.jM)(t,e.classificationMethod))}async summaryStatistics(e){let{field:t,normalizationType:r,valueExpression:a,sqlExpression:n,view:l,features:o,useFeaturesInView:u}=e,m=t?this.getField(t):null,d=(0,s.fs)(m)||(0,F.OH)(m),c=a&&!(n&&this.supportsSQLExpression),f=this._hasLocalSource||o||u,p=l&&"3d"===l.type;if(f||c)return c||o||u||p?this._summaryStatsFromMemory(e,m):this._summaryStatsFromClientQuery(e,m);if(!this.supportsSQLExpression&&(d||n||"natural-log"===r||"square-root"===r))throw new i.A(`${this.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return(r&&!this.supportsSQLExpression?this._summaryStatsFromGenRend(e):this._summaryStatsFromServiceQuery(e,m)).catch(()=>((0,g.Te)(e.signal),this._summaryStatsFromMemory(e,m)))}async uniqueValues(e){let{valueExpression:t,sqlExpression:r,features:a,useFeaturesInView:i,signal:n}=e,s=t&&!(r&&this.supportsSQLExpression),l=this._hasLocalSource||a||i||s,o=e.view,u=o&&"3d"===o.type,m=await e_(e,this);return l?s||a||i||u?this._uvFromMemory(e,m):this._uvFromClientQuery(e,m):this._uvFromServiceQuery(e,m).catch(t=>((0,g.Te)(n),!e.field||e.field2||e.field3||e.filter?t:this._uvFromGenRenderer(e,m[0]))).catch(()=>((0,g.Te)(n),u?this._uvFromMemory(e,m):this._uvFromClientQuery(e,m)))}async histogram(e){let{field:t,normalizationType:r,normalizationField:a,classificationMethod:l,view:o,filter:u,signal:m}=e,d=t?this.getField(t):null,c=(0,s.fs)(d)||(0,F.OH)(d),f=e.valueExpression||e.sqlExpression,p=e.valueExpression&&!(e.sqlExpression&&this.supportsSQLExpression),h=this._hasLocalSource||e.features||e.useFeaturesInView||p,y=this.supportsSQLExpression,w=!l||"equal-interval"===l,v=e.minValue,S=e.maxValue,x=null!=v&&null!=S,_=e.numBins||10;if(h)return this._histogramFromMemory(e);if(this.layer.capabilities?.operations?.supportsQueryBins&&e.useQueryAttributeBins)try{return await this._histogramFromQueryAttributeBins(e)}catch{return(0,g.Te)(m),this._histogramFromQueryAttributeBinsFromMemory(e)}if((f||y)&&w){if(!y&&(f||"natural-log"===r||"square-root"===r))throw new i.A(`${this.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return this._histogramForExpr(e)}if(c&&w)throw new i.A(`${this.adapterName}:not-supported`,"Normalization and date field are not allowed when layer does not support standardized SQL expression for queries");return r||!w?eN(e,this).then(s=>{if(!x)return eE(this,s,t,_,o,u,m);if(v>s.max||S<s.min)throw new i.A(`${this.adapterName}:insufficient-data`,"Range defined by 'minValue' and 'maxValue' does not intersect available data range of the field");if(w)return eE(this,{min:v,max:S,sqlExpr:s.sqlExpr,excludeZerosExpr:s.excludeZerosExpr},t,_,o,u,m);{let i=ey({field:t,normalizationType:r,normalizationField:a,normalizationTotal:s.normTotal,layer:this});return eN(e,this,(0,n.lX)(i,v,S)).then(e=>eE(this,e,t,_,o,u,m))}}):this._histogramForField(e)}async classBreaks(e){let t=!1!==e.analyzeData,r=this._hasLocalSource||e.features||e.useFeaturesInView||e.valueExpression||e.filter;return t&&r?this._classBreaksFromMemory(e):(t?this._classBreaksFromGenRend(e):this._classBreaksFromInterpolation(e)).catch(()=>((0,g.Te)(e.signal),this._classBreaksFromMemory(e)))}async queryFeatureCount(e){if(this._hasLocalSource)throw new i.A(`${this.adapterName}:not-supported`,"Layer does not support count query");let t=this.layer,r=t.createQuery();return r.where=(0,n.sf)(r.where,e.whereClause),eq(r,e.filter),t.queryFeatureCount(r,{signal:e.signal})}async generateRenderer(e,t){let r=this.layer;if(this._hasLocalSource||r.version<10.1)throw new i.A(`${this.adapterName}:not-supported`,"Layer does not support generateRenderer operation (requires ArcGIS Server version 10.1+)");let a=r.createQuery();return e.where=(0,n.sf)(e.where,a.where),N(r.parsedUrl?.path??"",{source:r.dynamicDataSource??void 0,gdbVersion:r.gdbVersion??void 0},e,{signal:t})}async predominantCategories(e){if(!this._hasLocalSource&&!this.supportsSQLExpression)throw new i.A(`${this.adapterName}:not-supported`,"Layer does not support advanced SQL expressions and standardized queries");let{fields:t,view:r,signal:a,filter:n}=e,l=R(t),o={expression:function(e,t){let{returnFieldName:r,defaultValue:a,layer:i}=t,n=[];if(r&&a){let t=e.map(e=>`${e} <= 0`).join(" AND ");n.push(`WHEN ${t} THEN ${a}`)}for(let t of e){let a=e.reduce((e,r)=>(t!==r&&e.push(`${t} > ${r}`),e),[]).join(" AND "),l=i&&(0,s.R3)(i,t),o=r&&`'${t}'`?`'${t}'`:l?(0,s.Ll)(t):t;n.push(`WHEN ${a} THEN ${o}`)}return`CASE ${n.join(" ")} ELSE ${a||"0"} END`}(t,{returnFieldName:!0,defaultValue:`'${$}'`})};return eT((r&&this._hasLocalSource?await this._uvFromMemory({valueExpression:l,view:r,signal:a,filter:n}):await this._uvFromServiceQuery({sqlExpression:o.expression,valueExpression:l,signal:a,filter:n})).uniqueValueInfos,t)}async getSampleFeatures(e,t){let{view:r,requiredFields:a,returnGeometry:i,filter:n,signal:s}=e,l=e.sampleSize;if(null==l||0===l)return[];let o=this.layer.createQuery(),u="json"===t;o.outSpatialReference=r?.spatialReference,o.returnGeometry=!!i,o.outFields=a,eq(o,n);let m=[],d=!1;if(r)try{let i=await r.whenLayerView(this.layer);if(d=!ep(this,a,i).length){if(l>=1&&!e.filter&&"getSampleFeatures"in i){await this._waitForLayerViewUpdate(i);let e=await i.getSampleFeatures({minFeatureCount:l,sampleSize:l});if(null!=e)return u?e:e.map(e=>h.A.fromJSON(e))}if((m=await this._fetchFeaturesFromMemory(i,o,s,t)).length>=l&&l>0)return(0,y.BB)(m,l,1)}}catch(e){(0,g.Te)(s)}try{if(this._hasLocalSource)return d?m:u?await this._fetchFeaturesJSONFromService(o,s):await this._fetchFeaturesFromService(o,s);let t=await this.queryFeatureCount({view:r,filter:n,signal:s}),a=this.layer.capabilities.query.maxRecordCount,i=-1===l?t:l;if(i=a&&i>a?a:i,t<=m.length||m.length>=a)return m;if(o.maxAllowableOffset=e.resolution||(r?r.extent.width/r.width/r.scale:(0,eQ.ri)(this.layer.spatialReference))*4e5,t<=i)return u?await this._fetchFeaturesJSONFromService(o,s):await this._fetchFeaturesFromService(o,s);if(t<=2e4){let e=this.layer.createQuery();eq(e,n);let t=await this.layer.queryObjectIds();return o.objectIds=(0,y.BB)(t,i,1),u?await this._fetchFeaturesJSONFromService(o,s):await this._fetchFeaturesFromService(o,s)}return this.layer.capabilities?.query?.supportsPagination&&(o.num=Math.min(i,2e4)),u?await this._fetchFeaturesJSONFromService(o,s):await this._fetchFeaturesFromService(o,s)}catch(e){return(0,g.Te)(s),m}}load(e){let t=this.layer.load(e).then(async t=>{this.geometryType=t.geometryType,this.objectIdField=t.objectIdField,this.supportsSQLExpression=t.capabilities?.query?.supportsSqlExpression,this._hasLocalSource=!t.url&&!!t.source,this.hasQueryEngine=this._hasLocalSource,this.minScale=t.minScale,this.maxScale=t.maxScale,this.fullExtent=t.fullExtent,this.workerClient=p.getInstance(),await this.workerClient.open(e.signal)});return this.addResolvingPromise(t),Promise.resolve(this)}};(0,l._)([(0,o.MZ)({readOnly:!0})],eJ.prototype,"adapterName",void 0),(0,l._)([(0,o.MZ)({constructOnly:!0})],eJ.prototype,"layer",void 0);let ej=eJ=(0,l._)([(0,d.$)("esri.smartMapping.support.adapters.FeatureLayerAdapter")],eJ),eU=class extends ej{constructor(){super(...arguments),this.adapterName="csv-layer-adapter"}async _createGenerateRendererResult(e,t,r,a,s){let l=e?.features;if(!l?.length)throw new i.A("csv-layer-adapter:insufficient-data","No features are available to calculate statistics");let o=ec(l),u=null;if("percent-of-total"===a&&null==(u=(await this.workerClient.summaryStatistics({field:t},o)).sum))throw new i.A("csv-layer-adapter:invalid","invalid normalizationTotal");if("class-breaks-definition"===s?.type){let e=(await (0,n.Jc)({field:t,normalizationType:a,normalizationField:r,normalizationTotal:u},o)).filter(e=>Number.isFinite(e));return(0,c.t)({definition:s,values:e,normalizationTotal:u})}let m=(await (0,n.Jc)({field:t},o)).filter(e=>null!=e&&"string"==typeof e&&""!==e.trim());return(0,c._)(m)}generateRenderer(e,t){let r=e.classificationDefinition,a=null,i=null,l=null;"class-breaks-definition"===r?.type?(a=r.classificationField,i=r.normalizationField,l=r.normalizationType):a=r?.attributeField;let o=this.layer;return(0,s.EG)({field:a,normalizationField:i}).then(s=>{let u=o.createQuery();return u.returnGeometry=!1,u.outFields=s,u.where=(0,n.sf)(u.where,e.where),o.queryFeatures(u,{signal:t}).then(e=>this._createGenerateRendererResult(e,a,i,l,r))})}load(e){let t=this.layer.load(e).then(async t=>{this.geometryType=t.geometryType,this.objectIdField=t.objectIdField,this.supportsSQLExpression=!0,this._hasLocalSource=!1,this.hasQueryEngine=!0,this.workerClient=p.getInstance(),await this.workerClient.open(e.signal)});return this.addResolvingPromise(t),Promise.resolve(this)}};(0,l._)([(0,o.MZ)({readOnly:!0})],eU.prototype,"adapterName",void 0);let eH=eU=(0,l._)([(0,d.$)("esri.smartMapping.support.adapters.CSVLayerAdapter")],eU),eW=class extends ej{constructor(){super(...arguments),this.adapterName="feature-layer-binning-adapter"}async _getNormalizationTotalFromMemory(e,t,r){let{featuresJSON:a,graphics:n,layerView:s,query:l}=t,o={include:["sum"]},u=(!a&&!n&&s&&"queryAggregateSummaryStatistics"in s?await s.queryAggregateSummaryStatistics(l,{field:e,outStatisticTypes:o},{signal:r}):a?await this.workerClient.summaryStatistics({field:e},a):await (0,H.summaryStatistics)({attribute:{field:e,outStatisticTypes:o},features:n})).sum;if(null==u)throw new i.A(`${this.adapterName}:invalid`,"invalid normalizationTotal");return u}async _processStatsFromMemoryParams(e){let{features:t,filter:r}=e;if(t?.length)return this._getFilteredFeatures(t,r);let{view:a,field:n,field2:l,field3:o,normalizationField:u,valueExpression:m,returnGeometry:d,layerViewFunc:c,signal:f}=e,p=null,h=null,y=null,g=null,w=null;if(a)try{if(p=await a.whenLayerView(this.layer),h=null!=c&&c in p&&"function"==typeof p[c]){await this._waitForLayerViewUpdate(p);let e=await (0,s.EG)({field:n,field2:l,field3:o,normalizationField:u,valueExpression:m});ef(this,e).length?h=!1:(y="createAggregateQuery"in p?p.createAggregateQuery():null)?(y.outFields=e,y.returnGeometry=!1,eq(y,r)):h=!1,p.suspended&&(h=!1)}}catch{h=!1}if(!h&&(w=ez(this.layer).map(e=>e.toJSON()),g=await this._fetchFeaturesForStats({field:n,field2:l,field3:o,valueExpression:m,normalizationField:u,returnGeometry:d,filter:r,view:a,signal:f},"json"),!g?.length))throw new i.A(`${this.adapterName}:insufficient-data`,"No features are available to calculate statistics");return{layerView:p,query:y,featuresJSON:g,fieldInfos:w}}async _summaryStatsFromMemory(e,t){let{view:r,field:a,valueExpression:i,normalizationType:n,signal:s}=e,l={field:a,valueExpression:i,normalizationType:n,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,outStatisticTypes:e.outStatisticTypes},{featuresJSON:o,graphics:u,layerView:m,query:d,fieldInfos:c}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateSummaryStatistics"});return i&&r&&(o||u)&&(l.fieldType=t?.type?j.m.toJSON(t.type):null,l.viewInfoParams=eV(r),l.timeZone=r.timeZone,l.fieldInfos=c),"percent-of-total"===n&&null==e.normalizationTotal&&(l.normalizationTotal=await this._getNormalizationTotalFromMemory(a,{featuresJSON:o,graphics:u,layerView:m,query:d},s)),!o&&!u&&m&&"queryAggregateSummaryStatistics"in m?m.queryAggregateSummaryStatistics(d,l,{signal:s}):o?this.workerClient.summaryStatistics(l,o):(0,H.summaryStatistics)({attribute:l,features:u})}async _uvFromMemory(e,t){let{view:r,field:a,valueExpression:i,returnAllCodedValues:n,signal:l}=e,{featuresJSON:o,graphics:u,layerView:m,query:d,fieldInfos:c}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateUniqueValues"}),f={field:a,field2:e.field2,field3:e.field3,fieldDelimiter:s.UH,valueExpression:i,domains:t,returnAllCodedValues:n};return i&&r&&(o||u)&&(f.viewInfoParams=eV(r),f.timeZone=r.timeZone,f.fieldInfos=c),!o&&!u&&m&&"queryAggregateUniqueValues"in m?m.queryAggregateUniqueValues(d,f,{signal:l}):o?this.workerClient.uniqueValues(f,o):(0,H.uniqueValues)({attribute:f,features:u})}async _histogramFromMemory(e){let{view:t,field:r,valueExpression:a,signal:i}=e,{featuresJSON:n,graphics:s,layerView:l,query:o,fieldInfos:u}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateHistogram"}),m={field:r,valueExpression:a,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numBins:e.numBins};return a&&t&&(n||s)&&(m.viewInfoParams=eV(t),m.timeZone=t.timeZone,m.fieldInfos=u),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(m.normalizationTotal=await this._getNormalizationTotalFromMemory(r,{featuresJSON:n,graphics:s,layerView:l,query:o},i)),!n&&!s&&l&&"queryAggregateHistogram"in l?l.queryAggregateHistogram(o,m,{signal:i}):n?this.workerClient.histogram(m,n):(0,H.histogram)({attribute:m,features:s})}async _classBreaksFromMemory(e){let{view:t,field:r,valueExpression:a,signal:i}=e,{featuresJSON:n,graphics:s,layerView:l,query:o,fieldInfos:u}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateClassBreaks"}),m={field:r,valueExpression:a,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return a&&t&&(n||s)&&(m.viewInfoParams=eV(t),m.timeZone=t.timeZone,m.fieldInfos=u),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(m.normalizationTotal=await this._getNormalizationTotalFromMemory(r,{featuresJSON:n,graphics:s,layerView:l,query:o},i)),!n&&!s&&l&&"queryAggregateClassBreaks"in l?l.queryAggregateClassBreaks(o,m,{signal:i}):n?this.workerClient.classBreaks(m,n):(0,H.classBreaks)({attribute:m,features:s})}getField(e=""){let t=ez(this.layer);return t?.find(t=>t.name.toLowerCase()===e?.toLowerCase())}getFieldUsageInfo(e){return this.getField(e)?{supportsLabelingInfo:!0,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:!1,supportsStatistics:!0}:null}getFieldDomain(e,t){return null}async summaryStatistics(e){let{field:t}=e,r=t?this.getField(t):null,a=(0,s.fs)(r)||(0,F.OH)(r),n=e.sqlExpression&&!e.valueExpression&&!t;if(a||n)throw new i.A(`${this.adapterName}:not-supported`,"Date field and sqlExpression are not supported");return this._summaryStatsFromMemory(e,r)}async uniqueValues(e){let t=await e_(e,this);return this._uvFromMemory(e,t)}async histogram(e){let{field:t}=e,r=t?this.getField(t):null,a=(0,s.fs)(r)||(0,F.OH)(r),n=e.sqlExpression&&!e.valueExpression&&!t;if(a||n)throw new i.A(`${this.adapterName}:not-supported`,"Date field and sqlExpression are not supported");return this._histogramFromMemory(e)}async classBreaks(e){return(!1!==e.analyzeData?this._classBreaksFromMemory(e):this._classBreaksFromInterpolation(e)).catch(()=>((0,g.Te)(e.signal),this._classBreaksFromMemory(e)))}async queryFeatureCount(e){let t=await e.view?.whenLayerView(this.layer);if(!t||!("queryAggregateCount"in t)||!t.queryAggregateCount)throw new i.A(`${this.adapterName}:not-supported`,"LayerView is not supported.");await this._waitForLayerViewUpdate(t);let r=t.createAggregateQuery();return r.where=(0,n.sf)(r.where,e.whereClause),eq(r,e.filter),t.queryAggregateCount(r,{signal:e.signal})}generateRenderer(e,t){throw new i.A(`${this.adapterName}:not-supported`,"'generateRenderer' is not supported.")}heatmapStatistics(e){throw new i.A(`${this.adapterName}:not-supported`,"'heatmapStatistics' is not supported.")}async predominantCategories(e){let{fields:t,view:r,signal:a}=e,i=R(t);return eT((await this._uvFromMemory({valueExpression:i,view:r,signal:a})).uniqueValueInfos,t)}async getSampleFeatures(e,t){let{view:r,sampleSize:a,requiredFields:n,returnGeometry:s,filter:l,signal:o}=e;if(!r)throw new i.A(`${this.adapterName}:not-supported`,"'view' is required to get sample features for binning.");if("3d"===r.type)throw new i.A(`${this.adapterName}:not-supported`,"3d 'view' is not supported to get sample features for binning.");let u=await r.whenLayerView(this.layer);if(!("queryAggregateJSON"in u&&u.queryAggregateJSON&&"queryAggregates"in u&&u.queryAggregates))throw new i.A(`${this.adapterName}:not-supported`,"LayerView is not supported.");if(await this._waitForLayerViewUpdate(u),ef(this,n).length)throw new i.A(`${this.adapterName}:insufficient-data`,"Layer does not have required fields");let m=u.createAggregateQuery();m.outSpatialReference=r?.spatialReference,m.returnGeometry=!!s,m.outFields=n,eq(m,l);let{features:d}="json"===t?await u.queryAggregateJSON(m,{signal:o}):await u.queryAggregates(m,{signal:o});return d.length&&null!=a&&a>0&&a<=d.length?(0,y.BB)(d,a,1):d}load(e){let t=this.layer.load(e).then(async t=>{this.geometryType="polygon",this.objectIdField=null,this.supportsSQLExpression=!1,this._hasLocalSource=!1,this.hasQueryEngine=!0,this.minScale=t.minScale,this.maxScale=t.maxScale,this.fullExtent=t.fullExtent;let r="featureReduction"in t?t.featureReduction:null;if("binning"!==r?.type&&"cluster"!==r?.type)throw new i.A(`${this.adapterName}:invalid-parameters`,`Feature reduction type ${r?.type} is not supported`);this.workerClient=p.getInstance(),await this.workerClient.open(e.signal)});return this.addResolvingPromise(t),Promise.resolve(this)}};(0,l._)([(0,o.MZ)({readOnly:!0})],eW.prototype,"adapterName",void 0);let eX=eW=(0,l._)([(0,d.$)("esri.smartMapping.support.adapters.FeatureLayerBinningAdapter")],eW),eY=class extends Y{constructor(e){super(e),this._featureLayerAdapter=null,this.workerClient=null,this.adapterName="scene-layer-adapter"}destroy(){this.workerClient?.destroy()}_hasCachedStatistics(e){return this.layer.hasCachedStatistics(e)}_updateQuery(e,t=[],r=[]){if(!e||!r.length)return e;let a=this.layer.objectIdField,i=e.clone(),n=t.filter(e=>{let t=this.layer.getField(e);return!r.includes(t.name)});return i.outFields=n.some(e=>this.layer.getField(e).name===a)?n:[...n,a],i}async _fetchFeaturesFromMemory(e,t,r){if(!e)throw new i.A("scene-layer-adapter:insufficient-data","view is required to fetch the features from layerView");let a=await e.whenLayerView(this.layer),n=new AbortController,s=n.signal,l=(0,Q.C_)(()=>!a.updating,s);await (0,g.wR)(l,5e3,n);let o=ep(this,r,a);(0,g.Te)(s);let u=this._updateQuery(t,r??[],o),m=await a.queryFeatures(u,{signal:s});(0,g.Te)(s);let d=m.features;return o.length?a.whenGraphicAttributes(d,o):d}async _fetchFeaturesJSONFromMemory(e,t,r){return this._fetchFeaturesFromMemory(e,t,r).then(ec)}_fetchFeaturesForStats(e,t){return(0,s.EG)({field:e.field,normalizationField:e.normalizationField,valueExpression:e.valueExpression}).then(r=>this.getSampleFeatures({sampleSize:-1,view:e.view,returnGeometry:e.returnGeometry,requiredFields:r,signal:e.signal},t))}async _processStatsFromMemoryParams(e){let t=e.features;if(t?.length)return t.length&&"declaredClass"in t[0]&&"esri.Graphic"===t[0].declaredClass?{graphics:t}:{featuresJSON:t};let{view:r,field:a,normalizationField:n,valueExpression:s,signal:l}=e,o=await this._fetchFeaturesForStats({field:a,valueExpression:s,normalizationField:n,view:r,signal:l},null);if(!o?.length)throw new i.A("scene-layer-adapter:insufficient-data","No features are available to calculate statistics");return{graphics:o}}_getCachedStatistics(e,t){let r=this.layer;return e.valueExpression||e.sqlExpression||e.sqlWhere||e.minValue||e.maxValue?Promise.reject(new i.A("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression', 'sqlExpression', 'sqlWhere', 'minValue' or 'maxValue' is specified")):r.queryCachedStatistics(t?.name,{signal:e.signal}).then(e=>{let t=e.stats,{min:r,max:a,totalValuesCount:i}=t,{avg:n,stddev:s,sum:l,variance:o,count:u}=t;return 0===r&&0===a||(n=0===n?null:n,l=0===l?null:l,s=0===s?null:s,o=0===o?null:o,u=0===u?null:u),null==u&&(null!=l&&null!=n?u=Math.round(l/n):null!=i&&(u=i)),{avg:n,count:u,max:a,min:r,stddev:s,sum:l,variance:o}})}async _getNormalizationTotal(e,t,r){let a={include:["sum"]},n=(t?await this.workerClient.summaryStatistics({field:e,outStatisticTypes:a},t):await (0,H.summaryStatistics)({attribute:{field:e,outStatisticTypes:a},features:r})).sum;if(null==n)throw new i.A("scene-layer-adapter:invalid","invalid normalizationTotal");return n}async _getSummaryStatisticsFromMemory(e,t){let{view:r,field:a,normalizationField:i,valueExpression:n}=e,{featuresJSON:s,graphics:l}=await this._processStatsFromMemoryParams(e),o={field:a,valueExpression:n,normalizationType:e.normalizationType,normalizationField:i,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,outStatisticTypes:e.outStatisticTypes};return e.valueExpression&&r&&s&&(o.fieldType=t?.type?j.m.toJSON(t.type):null,o.viewInfoParams=eV(r),o.timeZone=r.timeZone),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(o.normalizationTotal=await this._getNormalizationTotal(a,s,l)),s?this.workerClient.summaryStatistics(o,s):(0,H.summaryStatistics)({attribute:o,features:l})}_getCachedStatisticsForUniqueValues(e,t){let r=this.layer,a=t?.name,n=t&&e.field?this.getFieldDomain(e.field):null;return e.valueExpression||e.sqlExpression||e.sqlWhere?Promise.reject(new i.A("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression', 'sqlExpression' or 'sqlWhere' is specified")):r.queryCachedStatistics(a,{signal:e.signal}).then(i=>{let n=i.stats;if(!n.mostFrequentValues)throw Error();let l=i.labels?.labels,o={},u=[],m="countOF"+a;return n.mostFrequentValues.forEach(e=>{let i=new h.A({attributes:{}});i.attributes[a]=t&&t.name!==r.objectIdField&&((0,F.WA)(t)||(0,s.fs)(t))?Number(e.value):e.value,i.attributes[m]=e.count,u.push(i)}),l&&l.forEach(e=>{o[e.value]=e.label}),ev(new L.A({features:u}),{layer:this,field:e.field,labels:o,view:e.view,signal:e.signal})}).then(t=>(0,eo.lv)(t,[n],e.returnAllCodedValues))}async _getUniqueValuesFromMemory(e,t){let{view:r,field:a,field2:i,field3:n,valueExpression:l,returnAllCodedValues:o}=e,u={field:a,field2:i,field3:n,fieldDelimiter:s.UH,valueExpression:l,domains:t,returnAllCodedValues:o},{featuresJSON:m,graphics:d}=await this._processStatsFromMemoryParams(e);return e.valueExpression&&r&&m&&(u.viewInfoParams=eV(r),u.timeZone=r.timeZone),m?this.workerClient.uniqueValues(u,m):(0,H.uniqueValues)({attribute:u,features:d})}_getCachedStatisticsForHistogram(e,t){let r=this.layer;return e.valueExpression||e.sqlExpression||e.sqlWhere||e.normalizationType?Promise.reject(new i.A("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression' or 'sqlExpression' or 'sqlWhere' or 'normalizationType' is specified")):r.queryCachedStatistics(t&&t.name,{signal:e.signal}).then(t=>{let r=t.stats,{minValue:a,maxValue:i}=e,n=null!=a?a:r.min,s=null!=i?i:r.max,l=e.numBins||10;return eF(function(e,t=e.minimum,r=e.maximum,a){let i=[];for(let e=0;e<a;e++)i[e]=0;let n=e.counts.length,s=e.minimum,l=e.maximum;for(let o=0;o<n;o++){let u=(o+.5)/n,m=((1-u)*s+u*l-t)/(r-t)*a;m>=0&&m<=a&&(i[m===a?a-1:Math.floor(m)]+=e.counts[o])}let o=[];return i.forEach((e,t)=>{let r=new h.A({attributes:{}});r.attributes.EXPR_1=t+1,r.attributes.countOFExpr=e,o.push(r)}),new L.A({features:o})}(r.histogram,n,s,l),n,s,l)})}async _getClassBreaksFromMemory(e){let{view:t,field:r,normalizationField:a,valueExpression:i}=e,{featuresJSON:n,graphics:s}=await this._processStatsFromMemoryParams(e),l={field:r,valueExpression:i,normalizationType:e.normalizationType,normalizationField:a,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return e.valueExpression&&t&&n&&(l.viewInfoParams=eV(t),l.timeZone=t.timeZone),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(l.normalizationTotal=await this._getNormalizationTotal(r,n,s)),n?this.workerClient.classBreaks(l,n):(0,H.classBreaks)({attribute:l,features:s})}async _getHistogramFromMemory(e){let{view:t,field:r}=e,{featuresJSON:a,graphics:i}=await this._processStatsFromMemoryParams(e),n={field:r,valueExpression:e.valueExpression,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numBins:e.numBins};return e.valueExpression&&t&&a&&(n.viewInfoParams=eV(t),n.timeZone=t.timeZone),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(n.normalizationTotal=await this._getNormalizationTotal(r,a,i)),a?this.workerClient.histogram(n,a):(0,H.histogram)({attribute:n,features:i})}getField(e){return this.layer.getField(e??"")}getFieldUsageInfo(e){let t=this.getField(e);if(!t)return null;let r=this.layer.getFieldUsageInfo(t.name);return{supportsLabelingInfo:r.supportsLabelingInfo,supportsPopupTemplate:r.supportsPopupTemplate,supportsRenderer:r.supportsRenderer,supportsLayerQuery:r.supportsLayerQuery,supportsStatistics:!0}}getFieldDomain(e,t){return this._featureLayerAdapter?this._featureLayerAdapter.getFieldDomain(e,t):null}createQuery(){return this.layer.createQuery()}summaryStatistics(e){let t=this.getField(e.field);if(this._featureLayerAdapter)return this._featureLayerAdapter.summaryStatistics(e);if(e.filter)throw new i.A("scene-layer-adapter:not-supported","filter is not supported");return this._hasCachedStatistics(t?.name)?this._getCachedStatistics(e,t).catch(()=>((0,g.Te)(e.signal),this._getSummaryStatisticsFromMemory(e,t))):this._getSummaryStatisticsFromMemory(e,t)}async uniqueValues(e){if(this._featureLayerAdapter)return this._featureLayerAdapter.uniqueValues(e);if(e.filter)throw new i.A("scene-layer-adapter:not-supported","filter is not supported");let t=await e_(e,this),{field:r,field2:a}=e,n=r&&a,s=this.getField(r);return!n&&s&&this._hasCachedStatistics(s.name)?this._getCachedStatisticsForUniqueValues(e,s).catch(()=>((0,g.Te)(e.signal),this._getUniqueValuesFromMemory(e,t))):this._getUniqueValuesFromMemory(e,t)}histogram(e){let t=this.getField(e.field);if(this._featureLayerAdapter)return this._featureLayerAdapter.histogram(e);if(e.filter)throw new i.A("scene-layer-adapter:not-supported","filter is not supported");return t&&this._hasCachedStatistics(t.name)?this._getCachedStatisticsForHistogram(e,t).catch(()=>((0,g.Te)(e.signal),this._getHistogramFromMemory(e))):this._getHistogramFromMemory(e)}classBreaks(e){let t=this.getField(e.field);if(this._featureLayerAdapter)return this._featureLayerAdapter.classBreaks(e);if(e.filter)throw new i.A("scene-layer-adapter:not-supported","filter is not supported");return this._hasCachedStatistics(t?.name)?Promise.reject(new i.A("scene-layer-adapter:not-supported","Cached stats not supported")):this._getClassBreaksFromMemory(e)}queryFeatureCount(e){return this._featureLayerAdapter?this._featureLayerAdapter.queryFeatureCount(e):Promise.reject(new i.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support count query"))}generateRenderer(e,t){return this._featureLayerAdapter?this._featureLayerAdapter.generateRenderer(e,t):Promise.reject(new i.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support generateRenderer operation"))}heatmapStatistics(e){return this._featureLayerAdapter?this._featureLayerAdapter.heatmapStatistics(e):Promise.reject(new i.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support heatmapStatistics operation"))}async predominantCategories(e){if(this._featureLayerAdapter)return this._featureLayerAdapter.predominantCategories(e);throw new i.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support predominantCategories")}async getSampleFeatures(e,t){if(e.filter)throw new i.A("scene-layer-adapter:not-supported","filter is not supported");let{view:r,sampleSize:a,requiredFields:n,returnGeometry:s,signal:l}=e,o="json"===t,u=this.createQuery();u.outFields=n,u.returnGeometry=!!s,u.where=null,u.num=a;let m=[];try{if((m=o?await this._fetchFeaturesJSONFromMemory(r,u,n):await this._fetchFeaturesFromMemory(r,u,n)).length&&null!=a&&a>0&&a<=m.length)return(0,y.BB)(m,a,1)}catch(e){(0,g.Te)(l)}let d=null;if(this._featureLayerAdapter){let r={...e};delete r.view,d=await this._featureLayerAdapter.getSampleFeatures(r,t)}return d?.length?d:(0,y.BB)(m,m.length,1)}load(e){let t=this.layer.load(e).then(async t=>{this.workerClient=p.getInstance(),await this.workerClient.open(e.signal);let r=t.associatedLayer;if(this.geometryType=t.geometryType,null!=r)return this._featureLayerAdapter=new ej({layer:r}),this._featureLayerAdapter.load(e).then(()=>{this.objectIdField=this._featureLayerAdapter.objectIdField,this.supportsSQLExpression=this._featureLayerAdapter.supportsSQLExpression,this.minScale=this._featureLayerAdapter.minScale,this.maxScale=this._featureLayerAdapter.maxScale,this.fullExtent=this._featureLayerAdapter.fullExtent});this.objectIdField=t.objectIdField,this.supportsSQLExpression=!1,this.hasQueryEngine=!1,this.fullExtent=t.fullExtent});return this.addResolvingPromise(t),Promise.resolve(this)}};(0,l._)([(0,o.MZ)({readOnly:!0})],eY.prototype,"adapterName",void 0),(0,l._)([(0,o.MZ)({constructOnly:!0})],eY.prototype,"layer",void 0);let eK=eY=(0,l._)([(0,d.$)("esri.smartMapping.support.adapters.SceneLayerAdapter")],eY),e0=class extends eK{constructor(e){super(e),this.adapterName="point-cloud-layer-adapter"}getField(e){return this.layer.fieldsIndex.get(e??"")}getFieldUsageInfo(e){let t=this.getField(e);if(!t)return null;let r=this._hasCachedStatistics(t.name);return{supportsLabelingInfo:r,supportsPopupTemplate:r,supportsRenderer:r,supportsLayerQuery:!1,supportsStatistics:r}}getFieldDomain(){return null}load(e){let t=this.layer.load(e).then(()=>{this.geometryType="point",this.objectIdField=null,this.supportsSQLExpression=!1,this.hasQueryEngine=!1});return this.addResolvingPromise(t),Promise.resolve(this)}};(0,l._)([(0,o.MZ)({readOnly:!0})],e0.prototype,"adapterName",void 0);let e1=e0=(0,l._)([(0,d.$)("esri.smartMapping.support.adapters.PointCloudLayerAdapter")],e0),e3=class extends eD{constructor(){super(...arguments),this.adapterName="stream-layer-adapter"}async _summaryStatsFromClientQuery(e,t){let{signal:r,view:a}=e,i=eb(this,e,t);i.outStatistics=i.outStatistics?.filter(e=>"totalcount_value"!==e.outStatisticFieldName);let n=eh(await this._fetchFeatureSetFromMemory(i,a,r),(0,s.fs)(t)||(0,F.OH)(t));return(0,eo.oZ)(n,e.outStatisticTypes)}};(0,l._)([(0,o.MZ)({readOnly:!0})],e3.prototype,"adapterName",void 0);let e2=e3=(0,l._)([(0,d.$)("esri.smartMapping.support.adapters.StreamLayerAdapter")],e3);!function(e){e[e.CatalogLayer=0]="CatalogLayer",e[e.CatalogFootprintLayer=1]="CatalogFootprintLayer",e[e.CSVLayer=2]="CSVLayer",e[e.FeatureLayer=3]="FeatureLayer",e[e.GeoJSONLayer=4]="GeoJSONLayer",e[e.KnowledgeGraphSublayer=5]="KnowledgeGraphSublayer",e[e.OGCFeatureLayer=6]="OGCFeatureLayer",e[e.OrientedImageryLayer=7]="OrientedImageryLayer",e[e.ParquetLayer=8]="ParquetLayer",e[e.PointCloudLayer=9]="PointCloudLayer",e[e.SceneLayer=10]="SceneLayer",e[e.StreamLayer=11]="StreamLayer",e[e.SubtypeGroupLayer=12]="SubtypeGroupLayer",e[e.SubtypeSublayer=13]="SubtypeSublayer",e[e.WFSLayer=14]="WFSLayer"}(a||(a={}));let e9={[a.CatalogLayer]:{adapter:ej,type:"catalog",label:"CatalogLayer"},[a.CatalogFootprintLayer]:{adapter:ej,type:"catalog-footprint",label:"CatalogFootprintLayer"},[a.CSVLayer]:{adapter:eH,type:"csv",label:"CSVLayer"},[a.FeatureLayer]:{adapter:ej,type:"feature",label:"FeatureLayer"},[a.GeoJSONLayer]:{adapter:ej,type:"geojson",label:"GeoJSONLayer"},[a.KnowledgeGraphSublayer]:{adapter:ej,type:"knowledge-graph-sublayer",label:"KnowledgeGraphSublayer"},[a.OGCFeatureLayer]:{adapter:eD,type:"ogc-feature",label:"OGCFeatureLayer"},[a.OrientedImageryLayer]:{adapter:ej,type:"oriented-imagery",label:"OrientedImageryLayer"},[a.ParquetLayer]:{adapter:ej,type:"parquet",label:"ParquetLayer"},[a.PointCloudLayer]:{adapter:e1,type:"point-cloud",label:"PointCloudLayer"},[a.SceneLayer]:{adapter:eK,type:"scene",label:"SceneLayer"},[a.StreamLayer]:{adapter:e2,type:"stream",label:"StreamLayer"},[a.SubtypeGroupLayer]:{adapter:ej,type:"subtype-group",label:"SubtypeGroupLayer"},[a.SubtypeSublayer]:{adapter:ej,type:"subtype-sublayer",label:"SubtypeSublayer"},[a.WFSLayer]:{adapter:ej,type:"wfs",label:"WFSLayer"}},e5=[a.CatalogLayer,a.CatalogFootprintLayer,a.CSVLayer,a.FeatureLayer,a.GeoJSONLayer,a.KnowledgeGraphSublayer,a.OGCFeatureLayer,a.OrientedImageryLayer,a.ParquetLayer,a.PointCloudLayer,a.SceneLayer,a.StreamLayer,a.SubtypeGroupLayer,a.SubtypeSublayer,a.WFSLayer],e4=(a.CatalogFootprintLayer,a.CSVLayer,a.FeatureLayer,a.GeoJSONLayer,a.KnowledgeGraphSublayer,a.OGCFeatureLayer,a.OrientedImageryLayer,a.ParquetLayer,a.SceneLayer,a.StreamLayer,a.SubtypeGroupLayer,a.SubtypeSublayer,a.WFSLayer,[a.CSVLayer,a.FeatureLayer,a.GeoJSONLayer,a.OGCFeatureLayer,a.KnowledgeGraphSublayer,a.OrientedImageryLayer,a.ParquetLayer,a.StreamLayer,a.WFSLayer]);async function e7(e){if(!e?.layer||!e.field&&!e.valueExpression)throw new i.A("unique-values:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");let t=e.valueExpression||e.sqlExpression,r=t&&!e.sqlExpression;if(t){if(r){if(!e.view)throw new i.A("unique-values:missing-parameters","View is required when 'valueExpression' is specified")}else if(!e.valueExpression)throw new i.A("unique-values:missing-parameters","'valueExpression' parameters are required")}e.forBinning&&function(e,t){if(!e.view)throw new i.A(`${t}:missing-parameters`,"'view' parameter is required for binning");if(e.sqlExpression)throw new i.A(`${t}:invalid-parameters`,"'sqlExpression' parameter is not supported for binning");if("3d"===e.view.type)throw new i.A(`${t}:invalid-parameters`,"3d view is not supported for binning")}(e,"unique-values");let{layer:a,...l}=e,o=e.forBinning?e4:e5,u=function(e,t=e5,r){if(e instanceof Y)return e;let a=function(e,t=e5){let r=null;return t.some(t=>{let a=e.type===e9[t].type;return a&&(r=e9[t].adapter),a}),r}(e,t);return a?r?new eX({layer:e}):new a({layer:e}):null}(a,o,e.forBinning);if(!u)throw new i.A("unique-values:invalid-parameters","'layer' must be one of these types: "+o.map(e=>e9[e].label).join(", "));let m={layerAdapter:u,...l},d=null!=m.signal?{signal:m.signal}:null;await u.load(d);let c=await (0,s.EG)({field:m.field,field2:m.field2,field3:m.field3,valueExpression:m.valueExpression}),f=(0,n.MH)(u,c,"unique-values:invalid-parameters");if(f)throw f;m.filter&&!m.filter.spatialRelationship&&(m.filter.spatialRelationship="intersects");let p=(0,n.Wk)(m.filter,"summary-statistics:invalid-parameters");if(p)throw p;return m}async function e8(e){let{layerAdapter:t,...r}=await e7(e);return t.uniqueValues(r)}},23345:(e,t,r)=>{r.d(t,{S:()=>y});var a=r(86277),i=r(40941),n=r(58546),s=r(60729);function l(e,t){return t}function o(e,t,r,a){switch(r){case 0:return c(e,t+a,0);case 1:return"lowerLeft"===e.originPosition?c(e,t+a,1):function({translate:e,scale:t},r,a){return e[1]-r*t[a]}(e,t+a,1)}}function u(e,t,r,a){return 2===r?c(e,t,2):o(e,t,r,a)}function m(e,t,r,a){return 2===r?0===t?0:c(e,t,3):o(e,t,r,a)}function d(e,t,r,a){return 3===r?0===t?0:c(e,t,3):u(e,t,r,a)}function c({translate:e,scale:t},r,a){return e[a]+r*t[a]}class f{constructor(e){this._options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=l,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this._options.applyTransform&&(e.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!e.hasZ)return;let t=(0,n.N)(e.geometryType,this._options.sourceSpatialReference,e.spatialReference);if(null!=t)for(let r of e.features)t(r.geometry)}createSpatialReference(){return{}}addField(e,t){let r=e.fields;(0,i.Lw)(r),r.push(t);let a=r.map(e=>e.name);this._attributesConstructor=function(){for(let e of a)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this._transform=e.transform,this._options.applyTransform&&e.transform&&(this._applyTransform=this._deriveApplyTransform(e)),this._mValueOffset=null,this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),e.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,t,r)=>this.addCoordinatePoint(e,t,r),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,t,r)=>this._addCoordinatePolygon(e,t,r),this.createGeometry=e=>this._createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,t,r)=>this._addCoordinatePolyline(e,t,r),this.createGeometry=e=>this._createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,t,r)=>this._addCoordinateMultipoint(e,t,r),this.createGeometry=e=>this._createMultipointGeometry(e)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,t,r){0===this._lengths.length&&(this._toAddInCurrentPath=t),this._lengths.push(t)}addQueryGeometry(e,t){let{queryGeometry:r,queryGeometryType:a}=t,i=this._transform?(0,s.Ch)(r.clone(),r,!1,!1,this._transform):r.clone(),n=(0,s.zv)(i,a,!1,!1);e.queryGeometryType=a,e.queryGeometry={...n}}createPointGeometry(e){let t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,r){let a=this._transform;switch(t=this._applyTransform(a,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}_transformPathLikeValue(e,t){let r=0;t<=1&&(r=this._previousCoordinate[t],this._previousCoordinate[t]+=e);let a=this._transform;return null!==this._mValueOffset&&0===e&&t>0&&!(t%this._mValueOffset)?0:this._applyTransform(a,e,t,r)}_addCoordinatePolyline(e,t,r){this._dehydratedAddPointsCoordinate(e.paths,t,r)}_addCoordinatePolygon(e,t,r){this._dehydratedAddPointsCoordinate(e.rings,t,r)}_addCoordinateMultipoint(e,t,r){0===r&&e.points.push([]);let a=this._transformPathLikeValue(t,r);e.points[e.points.length-1].push(a)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,t,r){0===r&&0==this._toAddInCurrentPath--&&(e.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);let a=this._transformPathLikeValue(t,r),i=e[e.length-1];0===r&&(this._coordinateBufferPtr=0,this._coordinateBuffer=Array(this._vertexDimension),i.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=a}_deriveApplyTransform(e){let{hasZ:t,hasM:r}=e;return t&&r?d:t?u:r?m:o}}var p=r(79136);r(49570);var h=r(86099);async function y(e,t,r){let i=(0,a.Dl)(e),n={...r},s=h.A.from(t),l=!s.quantizationParameters,{data:o}=await (0,p.IJ)(i,s,new f({sourceSpatialReference:s.sourceSpatialReference,applyTransform:l}),n);return o}},60729:(e,t,r)=>{r.d(t,{B2:()=>S,BW:()=>k,Ch:()=>ei,DF:()=>T,Di:()=>J,E2:()=>Q,IE:()=>v,Nl:()=>et,Q4:()=>en,Rk:()=>es,Ux:()=>U,Ye:()=>B,ZF:()=>X,eU:()=>$,eY:()=>K,hK:()=>el,jH:()=>ee,jQ:()=>ea,kz:()=>er,oN:()=>j,q3:()=>Y,qK:()=>P,qN:()=>I,z5:()=>Z,zv:()=>H});var a=r(32391),i=r(61939),n=r(40941),s=r(42845),l=r(84766),o=r(31789),u=r(82795),m=r(54805),d=r(56599);function c(e,t){return e?t?4:3:t?3:2}let f=()=>i.A.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},h=(e,t,r,a,i,n)=>{e[r]=i,e[r+1]=n},y=(e,t,r,a,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[a+2]},g=(e,t,r,a,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[a+3]},w=(e,t,r,a,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[a+2],e[r+3]=t[a+3]};function F(e,t,r,a){if(e){if(r)return t&&a?w:y;if(t&&a)return g}else if(t&&a)return y;return h}function v({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function S({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function x({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function _({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function V({scale:e,translate:t},r,a){return r*e[a]+t[a]}function T(e,t,r){return e?t?r?M(e):b(e):r?A(e):z(e):null}function z(e){let t=e.coords;return{x:t[0],y:t[1]}}function L(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function b(e){let t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function q(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function A(e){let t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function E(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function M(e){let t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function C(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function N(e,t){return e&&t?C:e?q:t?E:L}function I(e,t,r=N(null!=t.z,null!=t.m)){return r(e,t)}function P(e,t,r){if(null==e)return null;let a=c(t,r),i=[];for(let t=0;t<e.coords.length;t+=a){let r=[];for(let i=0;i<a;i++)r.push(e.coords[t+i]);i.push(r)}return t?r?{points:i,hasZ:t,hasM:r}:{points:i,hasZ:t}:r?{points:i,hasM:r}:{points:i}}function O(e,t,r=c(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;let a=e.coords,i=0;for(let e of t.points)for(let t=0;t<r;t++)a[i++]=e[t];return e}function k(e,t,r){if(!e)return null;let a=c(t,r),{coords:i,lengths:n}=e,s=[],l=0;for(let e of n){let t=[];for(let r=0;r<e;r++){let e=[];for(let t=0;t<a;t++)e.push(i[l++]);t.push(e)}s.push(t)}return t?r?{paths:s,hasZ:t,hasM:r}:{paths:s,hasZ:t}:r?{paths:s,hasM:r}:{paths:s}}function G(e,t,r=c(t.hasZ,t.hasM)){let{lengths:a,coords:i}=e,n=0;for(let e of t.paths){for(let t of e)for(let e=0;e<r;e++)i[n++]=t[e];a.push(e.length)}return e}function Z(e,t,r){if(!e)return null;let a=c(t,r),{coords:i,lengths:n}=e,s=[],l=0;for(let e of n){let t=[];for(let r=0;r<e;r++){let e=[];for(let t=0;t<a;t++)e.push(i[l++]);t.push(e)}s.push(t)}return t?r?{rings:s,hasZ:t,hasM:r}:{rings:s,hasZ:t}:r?{rings:s,hasM:r}:{rings:s}}function B(e,t,r=t.hasZ,a=t.hasM){return $(e,t.rings,r,a)}function $(e,t,r,a){let i=c(r,a),{lengths:n,coords:s}=e,l=0;for(let r of(eo(e),t)){for(let e of r)for(let t=0;t<i;t++)s[l++]=e[t];n.push(r.length)}return e}let R=[],D=[];function Q(e,t,r,a,i){R[0]=e;let[n]=J(D,R,t,r,a,i);return eu(R),eu(D),n}function J(e,t,r,i,n,s){if(eu(e),!r){for(let r of t){let t=s?r.attributes[s]:void 0;e.push(new u.Om(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":let l=N(i,n);for(let{geometry:r,attributes:a}of t){let t=null!=r?l(new d.A,r):null;e.push(new u.Om(t,a,null,s?a[s]:void 0))}break;case"esriGeometryMultipoint":let o=c(i,n);for(let{geometry:r,attributes:a}of t){let t=null!=r?O(new d.A,r,o):null;e.push(new u.Om(t,a,null,s?a[s]:void 0))}break;case"esriGeometryPolyline":let m=c(i,n);for(let{geometry:r,attributes:a,centroid:i}of t){let t=null!=r?G(new d.A,r,m):null,n=null!=i?I(new d.A,i):null;e.push(new u.Om(t,a,n,s?a[s]:void 0))}break;case"esriGeometryPolygon":case"esriGeometryMultiPatch":for(let{geometry:r,centroid:a,attributes:l}of t){let t=null!=r?B(new d.A,r,i,n):null,o=s?l[s]:void 0;null!=a?e.push(new u.Om(t,l,L(new d.A,a),o)):e.push(new u.Om(t,l,null,o))}break;default:f().error("convertToFeatureSet:unknown-geometry",new a.A(`Unable to parse unknown geometry type '${r}'`)),eu(e)}return e}function j(e,t,r,a){D[0]=e,W(R,D,t,r,a);let i=R[0];return eu(R),eu(D),i}function U(e,t,r){if(null==e)return null;let i=new d.A;return("hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,o.fT)(e))?N(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(i,e):(0,o.Bi)(e)?B(i,e,t,r):(0,o.Rg)(e)?G(i,e,c(t,r)):(0,o.U9)(e)?O(i,e,c(t,r)):void f().error("convertFromGeometry:unknown-geometry",new a.A(`Unable to parse unknown geometry type '${e}'`))}function H(e,t,r,i){let n=e&&("coords"in e?e:e.geometry);if(null==n)return null;switch(t){case"esriGeometryPoint":{let e=z;return r&&i?e=M:r?e=b:i&&(e=A),e(n)}case"esriGeometryMultipoint":return P(n,r,i);case"esriGeometryPolyline":return k(n,r,i);case"esriGeometryPolygon":return Z(n,r,i);default:return f().error("convertToGeometry:unknown-geometry",new a.A(`Unable to parse unknown geometry type '${t}'`)),null}}function W(e,t,r,i,n){if(eu(e),null==r){for(let r of t)e.push({attributes:r.attributes});return e}switch(r){case"esriGeometryPoint":let s=z;for(let r of(i&&n?s=M:i?s=b:n&&(s=A),t)){let{geometry:t,attributes:a}=r,i=null!=t?s(t):null;e.push({attributes:a,geometry:i})}break;case"esriGeometryMultipoint":for(let{geometry:r,attributes:a}of t)e.push({attributes:a,geometry:null!=r?P(r,i,n):null});break;case"esriGeometryPolyline":for(let{geometry:r,attributes:a}of t)e.push({attributes:a,geometry:null!=r?k(r,i,n):null});break;case"esriGeometryPolygon":for(let{geometry:r,attributes:a,centroid:s}of t){let t=null!=r?Z(r,i,n):null;if(null!=s){let r=z(s);e.push({attributes:a,centroid:r,geometry:t})}else e.push({attributes:a,geometry:t})}break;default:f().error("convertToFeatureSet:unknown-geometry",new a.A(`Unable to parse unknown geometry type '${r}'`))}return e}function X(e){let{objectIdFieldName:t,spatialReference:r,transform:a,fields:i,hasM:n,hasZ:s,features:l,geometryType:o,exceededTransferLimit:u,uniqueIdField:m,queryGeometry:d,queryGeometryType:c}=e,f={features:W([],l,o,s,n),fields:i,geometryType:o,objectIdFieldName:t,spatialReference:r,uniqueIdField:m,queryGeometry:H(d,c,!1,!1)};return a&&(f.transform=a),u&&(f.exceededTransferLimit=u),n&&(f.hasM=n),s&&(f.hasZ=s),f}function Y(e,t){let r=new m.A,{hasM:i,hasZ:n,features:s,objectIdFieldName:l,spatialReference:o,geometryType:u,exceededTransferLimit:d,transform:c,fields:p}=e;return p&&(r.fields=p),r.geometryType=u??null,r.objectIdFieldName=l??t??null,r.spatialReference=o??null,r.objectIdFieldName?(s&&J(r.features,s,u,n,i,r.objectIdFieldName),d&&(r.exceededTransferLimit=d),i&&(r.hasM=i),n&&(r.hasZ=n),c&&(r.transform=c)):f().error(new a.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r}function K(e){let{transform:t,features:r,hasM:a,hasZ:i}=e;if(!t)return e;for(let e of r)null!=e.geometry&&ei(e.geometry,e.geometry,a,i,t),null!=e.centroid&&ei(e.centroid,e.centroid,a,i,t);return e.transform=null,e}function ee(e,t){let{geometryType:r,features:a,hasM:i,hasZ:n}=t;if(!e)return t;for(let t=0;t<a.length;t++){let s=a[t],l=s.weakClone();l.geometry=new d.A,et(l.geometry,s.geometry,i,n,r,e),s.centroid&&(l.centroid=new d.A,et(l.centroid,s.centroid,i,n,"esriGeometryPoint",e)),a[t]=l}return t.transform=e,t}function et(e,t,r,a,i,n,s=r,l=a){if(eo(e),!t?.coords.length)return null;let o=p[i],{coords:u,lengths:m}=t,d=c(r,a),f=c(r&&s,a&&l),h=F(r,a,s,l);if(!m.length)return h(e.coords,u,0,0,v(n,u[0]),S(n,u[1])),eo(e,d,0),e;let y,g,w,x,_=0,V=0,T=0;for(let t of m){if(t<o)continue;let r=0;V=T,w=y=v(n,u[_]),x=g=S(n,u[_+1]),h(e.coords,u,V,_,w,x),r++,_+=d,V+=f;for(let a=1;a<t;a++,_+=d)w=v(n,u[_]),x=S(n,u[_+1]),w===y&&x===g||(h(e.coords,u,V,_,w-y,x-g),V+=f,r++,y=w,g=x);r>=o&&(e.lengths.push(r),T=V)}return eu(e.coords,T),e.coords.length?e:null}function er(e,t,r,a,i,n,s=r,l=a){if(eo(e),!t?.coords.length)return null;let o=p[i],{coords:u,lengths:m}=t,d=c(r,a),f=c(r&&s,a&&l),h=F(r,a,s,l);if(!m.length)return h(e.coords,u,0,0,u[0],u[1]),eo(e,d,0),e;let y=0,g=n*n;for(let t of m){if(t<o){y+=t*d;continue}let r=e.coords.length/f,a=y,i=y+(t-1)*d;h(e.coords,u,e.coords.length,a,u[a],u[a+1]),function e(t,r,a,i,n,s,l){let o,u=i,m=0;for(let e=s+a;e<l;e+=a)(o=function(e,t,r,a){let i=e[t],n=e[t+1],s=e[r],l=e[r+1],o=e[a],u=e[a+1],m=s,d=l,c=o-m,f=u-d;if(0!==c||0!==f){let e=((i-m)*c+(n-d)*f)/(c*c+f*f);e>1?(m=o,d=u):e>0&&(m+=c*e,d+=f*e)}return(c=i-m)*c+(f=n-d)*f}(r,e,s,l))>u&&(m=e,u=o);u>i&&(m-s>a&&e(t,r,a,i,n,s,m),n(t,r,t.length,m,r[m],r[m+1]),l-m>a&&e(t,r,a,i,n,m,l))}(e.coords,u,d,g,h,a,i),h(e.coords,u,e.coords.length,i,u[i],u[i+1]);let n=e.coords.length/f-r;n>=o?e.lengths.push(n):eu(e.coords,r*f),y+=t*d}return e.coords.length?e:null}function ea(e,t,r,a){if(!t?.coords?.length)return null;let i=c(r,a),n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,m=Number.NEGATIVE_INFINITY;if(t&&t.coords){let e=t.coords;for(let t=0;t<e.length;t+=i){let r=e[t],a=e[t+1];n=Math.min(n,r),u=Math.max(u,r),o=Math.min(o,a),m=Math.max(m,a)}}return(0,s.is)(e)?(0,s.BI)(e,n,o,u,m):(0,l.fA)(n,o,u,m,e),e}function ei(e,t,r,a,i){let{coords:s,lengths:l}=t,o=c(r,a);if(!s.length)return e!==t&&eo(e),e;(0,n.Lw)(i);let{originPosition:u,scale:m,translate:d}=i;em.originPosition=u;let f=em.scale;f[0]=m[0]??1,f[1]=-(m[1]??1),f[2]=m[2]??1,f[3]=m[3]??1;let p=em.translate;if(p[0]=d[0]??0,p[1]=d[1]??0,p[2]=d[2]??0,p[3]=d[3]??0,!l.length){for(let t=0;t<o;++t)e.coords[t]=function({scale:e,translate:t},r,a){return r*e[a]+t[a]}(em,s[t],t);return e!==t&&eo(e,o,0),e}let h=0;for(let t=0;t<l.length;t++){let r=l[t];e.lengths[t]=r;for(let t=0;t<o;++t)e.coords[h+t]=function({scale:e,translate:t},r,a){return r*e[a]+t[a]}(em,s[h+t],t);let a=e.coords[h],i=e.coords[h+1];h+=o;for(let t=1;t<r;t++,h+=o){a+=s[h]*f[0],i+=s[h+1]*f[1],e.coords[h]=a,e.coords[h+1]=i;for(let t=2;t<o;++t)e.coords[h+t]=function({scale:e,translate:t},r,a){return r*e[a]+t[a]}(em,s[h+t],t)}}return e!==t&&eo(e,s.length,l.length),e}function en(e,t,r,a,i,n){if(eo(e),e.lengths.push(...t.lengths),r===i&&a===n)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{let s=c(r,a),l=F(r,a,i,n),o=t.coords;for(let t=0;t<o.length;t+=s)l(e.coords,o,e.coords.length,t,o[t],o[t+1])}return e}function es(e,t){let{coords:r,lengths:a}=e,i=0,n=0;for(let e=0;e<a.length;e++){let s=a[e];n+=function(e,t,r,a){let i=0,n=e[a*t],s=e[a*(t+1)];for(let l=1;l<r;l++){let r=n+e[a*(t+l)],o=s+e[a*(t+l)+1],u=(r-n)*(o+s);n=r,s=o,i+=u}return .5*i}(r,i,s,t),i+=s}return Math.abs(n)}function el(e,t,r,a,i){let n=c(a,i);if(!e.lengths.length){if(e.coords.length<2)return null;let[r,a]=e.coords,i=x(t,r),n=_(t,a);return new d.A([],[i,n])}let s=new d.A([],[0,0]),l=p[r],o="esriGeometryPolygon"===r||"esriGeometryPolyline"===r,u=0,m=0;for(let r=0;r<e.lengths.length;r++){let a=e.lengths[r],i=m,d=x(t,e.coords[n*u]),c=_(t,e.coords[n*u+1]);s.coords[m++]=d,s.coords[m++]=c;let p=0,y=0,g=1;for(let r=1;r<a;r++){let a=x(t,e.coords[n*(r+u)]),i=_(t,e.coords[n*(r+u)+1]);if(a!==d||i!==c){var f,h;let e=a-d,t=i-c;o&&0==(f=p)*t-e*(h=y)&&f*e+h*t>0?(s.coords[m-2]+=e,s.coords[m-1]+=t,d+=e,c+=t):(s.coords[m++]=a,s.coords[m++]=i,d=a,c=i,p=e,y=t,g+=1)}}g<l?m=i:s.lengths.push(g),u+=a}return 0===s.lengths.length?null:s}function eo(e,t=0,r=0){eu(e.lengths,r),eu(e.coords,t)}function eu(e,t=0){e.length!==t&&(e.length=t)}let em={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},72980:(e,t,r)=>{r.r(t),r.d(t,{classBreaks:()=>l,heatmapStatistics:()=>u,histogram:()=>o,summaryStatistics:()=>n,uniqueValues:()=>s});var a=r(29368),i=r(73140);async function n(e){let{attribute:t,features:r}=e,{normalizationType:n,normalizationField:s,minValue:l,maxValue:o,fieldType:u,outStatisticTypes:m}=t,d=await (0,a.Jc)({field:t.field,valueExpression:t.valueExpression,normalizationType:n,normalizationField:s,normalizationTotal:t.normalizationTotal,viewInfoParams:t.viewInfoParams,timeZone:t.timeZone,fieldInfos:t.fieldInfos},r),c=(0,i.Vb)({normalizationType:n,normalizationField:s,minValue:l,maxValue:o}),f={value:.5,fieldType:u},p="esriFieldTypeString"===u?(0,i.z9)({values:d,supportsNullCount:c,percentileParams:f,outStatisticTypes:m}):(0,i.G_)({values:d,minValue:l,maxValue:o,useSampleStdDev:!n,supportsNullCount:c,percentileParams:f,outStatisticTypes:m});return(0,i.oZ)(p,m,"esriFieldTypeDate"===u)}async function s(e){let{attribute:t,features:r}=e,n=await (0,a.Jc)({field:t.field,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,valueExpression:t.valueExpression,viewInfoParams:t.viewInfoParams,timeZone:t.timeZone,fieldInfos:t.fieldInfos},r,!1),s=(0,i.b3)(n);return(0,i.lv)(s,t.domains,t.returnAllCodedValues,t.fieldDelimiter)}async function l(e){let{attribute:t,features:r}=e,{field:n,normalizationType:s,normalizationField:l,normalizationTotal:o,classificationMethod:u}=t,m=await (0,a.Jc)({field:n,valueExpression:t.valueExpression,normalizationType:s,normalizationField:l,normalizationTotal:o,viewInfoParams:t.viewInfoParams,timeZone:t.timeZone,fieldInfos:t.fieldInfos},r),d=(0,i.Rw)(m,{field:n,normalizationType:s,normalizationField:l,normalizationTotal:o,classificationMethod:u,standardDeviationInterval:t.standardDeviationInterval,numClasses:t.numClasses,minValue:t.minValue,maxValue:t.maxValue});return(0,i.jM)(d,u)}async function o(e){let{attribute:t,features:r}=e,{field:n,normalizationType:s,normalizationField:l,normalizationTotal:o,classificationMethod:u}=t,m=await (0,a.Jc)({field:n,valueExpression:t.valueExpression,normalizationType:s,normalizationField:l,normalizationTotal:o,viewInfoParams:t.viewInfoParams,timeZone:t.timeZone,fieldInfos:t.fieldInfos},r);return(0,i.$y)(m,{field:n,normalizationType:s,normalizationField:l,normalizationTotal:o,classificationMethod:u,standardDeviationInterval:t.standardDeviationInterval,numBins:t.numBins,minValue:t.minValue,maxValue:t.maxValue})}async function u(e){let{attribute:t,features:r}=e,{field:i,radius:n,transform:s,spatialReference:l}=t,o=t.size??[0,0],u=(0,a.$r)(r??[],s,l,o);return(0,a.gV)(u,n??void 0,i,o[0],o[1])}},99572:(e,t,r)=>{function a(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function i(e){if("lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length)return e;let{originPosition:t,scale:r,translate:a}=e,i=r[0]??1,n=r[1]??1;return{originPosition:"lowerLeft",scale:[i,"lowerLeft"===t?n:-n,r[2]??1,r[3]??1],translate:[a[0]??0,a[1]??0,a[2]??0,a[3]??0]}}function n({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function s({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function l({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}function o({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}function u(e,t){return e&&t?f:e&&!t?d:!e&&t?c:m}r.d(t,{$X:()=>q,B2:()=>s,Gy:()=>V,IE:()=>n,P5:()=>A,Q1:()=>i,QE:()=>z,SW:()=>L,Tr:()=>b,VV:()=>a,wp:()=>T}),r(31789);let m=(e,t)=>{let r=[];if(!t.length)return null;let a=t[0],i=n(e,a[0]),l=s(e,a[1]);r.push([i,l]);for(let a=1;a<t.length;a++){let[o,u]=t[a],m=n(e,o),d=s(e,u);m===i&&d===l||r.push([m-i,d-l]),i=m,l=d}return r},d=(e,t)=>{let r=[];if(!t.length)return null;let a=t[0],i=n(e,a[0]),o=s(e,a[1]),u=l(e,a[2]);r.push([i,o,u]);for(let a=1;a<t.length;a++){let[m,d,c]=t[a],f=n(e,m),p=s(e,d),h=l(e,c);f===i&&p===o&&h===u||r.push([f-i,p-o,h]),i=f,o=p,u=h}return r},c=(e,t)=>{let r=[];if(!t.length)return null;let a=t[0],i=n(e,a[0]),l=s(e,a[1]),u=o(e,a[2]);r.push([i,l,u]);for(let a=1;a<t.length;a++){let[m,d,c]=t[a],f=n(e,m),p=s(e,d),h=o(e,c);f===i&&p===l&&h===u||r.push([f-i,p-l,h]),i=f,l=p,u=h}return r},f=(e,t)=>{let r=[];if(!t.length)return null;let a=t[0],i=n(e,a[0]),u=s(e,a[1]),m=l(e,a[2]),d=o(e,a[3]);r.push([i,u,m,d]);for(let a=1;a<t.length;a++){let[c,f,p,h]=t[a],y=n(e,c),g=s(e,f),w=l(e,p),F=o(e,h);y===i&&g===u&&w===m&&F===d||r.push([y-i,g-u,w,F]),i=y,u=g,m=w,d=F}return r};function p({scale:e,translate:t},r){return r*e[0]+t[0]}function h({scale:e,translate:t},r){return r*e[1]+t[1]}function y({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function g({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function w(e,t){return e&&t?x:e&&!t?v:!e&&t?S:F}let F=(e,t)=>{let r=Array(t.length);if(!t.length)return r;let a=t[0],i=p(e,a[0]),n=h(e,a[1]);r[0]=[i,n];let{scale:s,originPosition:l}=e,o=s[0],u="lowerLeft"===l?s[1]:-s[1];for(let e=1;e<t.length;e++){let[a,s]=t[e];i+=o*a,n+=u*s,r[e]=[i,n]}return r},v=(e,t)=>{let r=Array(t.length);if(!t.length)return r;let a=t[0],i=p(e,a[0]),n=h(e,a[1]);r[0]=[i,n,y(e,a[2])];let{scale:s,originPosition:l}=e,o=s[0],u="lowerLeft"===l?s[1]:-s[1];for(let a=1;a<t.length;a++){let[s,l,m]=t[a];i+=o*s,n+=u*l,r[a]=[i,n,y(e,m)]}return r},S=(e,t)=>{let r=Array(t.length);if(!t.length)return r;let a=t[0],i=p(e,a[0]),n=h(e,a[1]);r[0]=[i,n,g(e,a[2])];let{scale:s,originPosition:l}=e,o=s[0],u="lowerLeft"===l?s[1]:-s[1];for(let a=1;a<t.length;a++){let[s,l,m]=t[a];i+=o*s,n+=u*l,r[a]=[i,n,g(e,m)]}return r},x=(e,t)=>{let r=Array(t.length);if(!t.length)return r;let a=t[0],i=p(e,a[0]),n=h(e,a[1]);r[0]=[i,n,y(e,a[2]),g(e,a[3])];let{scale:s,originPosition:l}=e,o=s[0],u="lowerLeft"===l?s[1]:-s[1];for(let a=1;a<t.length;a++){let[s,l,m,d]=t[a];i+=o*s,n+=u*l,r[a]=[i,n,y(e,m),g(e,d)]}return r};function _(e,t,r){let a=Array(r.length);for(let i=0;i<r.length;i++)a[i]=t(e,r[i]);return a}function V(e,t,r){let a=i(e);return t.x=n(a,r.x),t.y=s(a,r.y),null!=r.z&&(t.z=l(a,r.z)),null!=r.m&&(t.m=o(a,r.m)),t}function T(e,t,r){let a=function(e,t,r,a){let i=[],n=u(r,a);for(let r=0;r<t.length;r++){let a=n(e,t[r]);a&&a.length>=3&&i.push(a)}return i.length?i:null}(i(e),r.rings,r.hasZ,r.hasM);return a?(t.rings=a,t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t):null}function z(e,t,r){let a=function(e,t,r,a){let i=[],n=u(r,a);for(let r=0;r<t.length;r++){let a=n(e,t[r]);a&&a.length>=2&&i.push(a)}return i.length?i:null}(i(e),r.paths,r.hasZ,r.hasM);return a?(t.paths=a,t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t):null}function L(e,t,r,a=r?.hasZ??!1,n=r?.hasM??!1){if(null!=r){let s=i(e);t.points=w(a,n)(s,r.points),t.hasZ=a,t.hasM=n}return t}function b(e,t,r,a=null!=r?.z,n=null!=r?.m){if(null==r)return t;let s=i(e);return t.x=p(s,r.x),t.y=h(s,r.y),a&&(t.z=y(s,r.z)),n&&(t.m=g(s,r.m)),t}function q(e,t,r,a=r?.hasZ??!1,n=r?.hasM??!1){return null!=r&&(t.rings=_(i(e),w(a,n),r.rings),t.hasZ=a,t.hasM=n),t}function A(e,t,r,a=r?.hasZ??!1,n=r?.hasM??!1){return null!=r&&(t.paths=_(i(e),w(a,n),r.paths),t.hasZ=a,t.hasM=n),t}}}]);