"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5545],{35063:(e,t,r)=>{r.d(t,{K:()=>p,Q:()=>n});var a=r(81194);let l=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function n(e,t){let{loadContext:r,...l}=t||{},n=r?await r.fetchServiceMetadata(e,l):await (0,a.V)(e,l);y(n),s(n);let i={serviceJSON:n};if((n.currentVersion??0)<10.5)return i;let u=`${e}/layers`,o=r?await r.fetchServiceMetadata(u,l):await (0,a.V)(u,l);return y(o),s(o),i.layersJSON={layers:o.layers,tables:o.tables},i}function i(e){let{type:t}=e;return!!t&&l.has(t)}function u(e){return"Table"===e.type}function s(e){e.layers=e.layers?.filter(i),e.tables=e.tables?.filter(u)}function o(e){e.type||="Feature Layer"}function c(e){e.type||="Table"}function y(e){e.layers?.forEach(o),e.tables?.forEach(c)}function p(e){switch(e){case"Feature Layer":case"Table":break;case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},42956:(e,t,r)=>{r.d(t,{L:()=>c});var a=r(57664),l=r(39166),n=r(32391),i=r(92753),u=r(21371),s=r(14307),o=r(28015);async function c(e,t){let r=(0,u.qg)(e);if(!r)throw new n.A("invalid-url","Invalid scene service url");let a={...t,sceneServerUrl:r.url.path,layerId:r.sublayer??void 0};if(a.sceneLayerItem??=await y(a),null==a.sceneLayerItem)return d(a.sceneServerUrl.replace("/SceneServer","/FeatureServer"),a);let l=await m(a);if(!l?.url)throw new n.A("related-service-not-found","Could not find feature service through portal item relationship");a.featureServiceItem=l;let i=await d(l.url,a);return i.portalItem=l,i}async function y(e){let t=(await p(e)).serviceItemId;if(!t)return null;let r=new o.default({id:t,apiKey:e.apiKey}),a=await f(e);null!=a&&(r.portal=new s.A({url:a}));try{return await r.load({signal:e.signal})}catch(e){return(0,i.QP)(e),null}}async function p(e){if(e.rootDocument)return e.rootDocument;let t={query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:e.signal};try{let r=await (0,l.A)(e.sceneServerUrl,t);e.rootDocument=r.data}catch{e.rootDocument={}}return e.rootDocument}async function f(e){let t=a.id?.findServerInfo(e.sceneServerUrl);if(t?.owningSystemUrl)return t.owningSystemUrl;let r=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{let t=(await (0,l.A)(r,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(t)return t}catch(e){(0,i.QP)(e)}return null}async function d(e,t){let r=(0,u.qg)(e);if(!r)throw new n.A("invalid-feature-service-url","Invalid feature service url");let a=r.url.path,i=t.layerId;if(null==i)return{serverUrl:a};let s=p(t),o=t.featureServiceItem?await t.featureServiceItem.fetchData("json"):null,c=(o?.layers?.[0]||o?.tables?.[0])?.customParameters,y=e=>{let r={query:{f:"json",...c},responseType:"json",authMode:e,signal:t.signal};return(0,l.A)(a,r)},f=y("anonymous").catch(()=>y("no-prompt")),[d,m]=await Promise.all([f,s]),h=m?.layers,w=d.data&&d.data.layers;if(!Array.isArray(w))throw Error("expected layers array");if(Array.isArray(h)){for(let e=0;e<Math.min(h.length,w.length);e++)if(h[e].id===i)return{serverUrl:a,layerId:w[e].id}}else if(null!=i&&i<w.length)return{serverUrl:a,layerId:w[i].id};throw Error("could not find matching associated sublayer")}async function m({sceneLayerItem:e,signal:t}){if(!e)return null;try{let r=(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:t})).find(e=>"Feature Service"===e.type)||null;if(!r)return null;let a=new o.default({portal:r.portal,id:r.id});return await a.load(),a}catch(e){return(0,i.QP)(e),null}}},47161:(e,t,r)=>{r.d(t,{Ju:()=>o,K8:()=>p,XH:()=>c,_r:()=>n,bO:()=>i,l:()=>y,nu:()=>f,pJ:()=>u,rc:()=>s});var a=r(42956),l=r(35063);function n(e){let t={id:e.id,name:e.name},r=(0,l.K)(e.type);return"FeatureLayer"!==r&&(t.layerType=r),t}async function i(e,t,r){if(null==e?.layers||null==e?.tables){let a=await r.fetchServiceMetadata(t,{customParameters:u(e)?.customParameters});(e=e||{}).layers=e.layers||a?.layers?.map(n),e.tables=e.tables||a?.tables?.map(n)}return e}function u(e){if(!e)return null;let{layers:t,tables:r}=e;return t?.length?t[0]:r?.length?r[0]:null}function s(e,t){return null==t?null:[...e.layers||[],...e.tables||[]].find(e=>e.id===t)}function o(e,t){return[...e.layers||[],...e.tables||[]].filter(({layerType:e})=>e?t.includes(e):t.includes("ArcGISFeatureLayer"))}function c(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function y(e){switch(e){case"catalog":return["CatalogLayer"];case"feature":return["ArcGISFeatureLayer"];case"oriented-imagery":return["OrientedImageryLayer"];case"subtype-group":return["SubtypeGroupLayer","SubtypeGroupTable"]}return null}function p(e){switch(e){case"CatalogLayer":return"CatalogLayer";case"OrientedImageryLayer":return"OrientedImageryLayer";case"SubtypeGroupLayer":case"SubtypeGroupTable":return"SubtypeGroupLayer"}return"FeatureLayer"}async function f(e,t,r){if(!e?.url)return t??{};if(!(t??={}).layers){let a=await r.fetchServiceMetadata(e.url);t.layers=a.layers?.map(n)}let{serverUrl:l,portalItem:i}=await (0,a.L)(e.url,{sceneLayerItem:e,customParameters:u(t)?.customParameters}).catch(()=>({serverUrl:null,portalItem:null}));if(null==l)return t.tables=[],t;if(!t.tables&&i){let e=await i.fetchData().catch(()=>null);if(e?.tables)t.tables=e.tables.map(n);else{let a=await r.fetchServiceMetadata(l,{customParameters:u(e)?.customParameters}).catch(()=>null);t.tables=a?.tables?.map(n)}}if(t.tables)for(let e of t.tables)e.url=`${l}/${e.id}`;return t}},55545:(e,t,r)=>{r.d(t,{load:()=>f});var a=r(32391),l=r(21371),n=r(35063),i=r(59488),u=r(14307),s=r(39577),o=r(47161),c=r(23226),y=r(4534),p=r(81194);async function f(e,t){let r=e.instance.portalItem;if(r?.id)return await r.load(t),function(e){let t=e.instance.portalItem;if(!t?.type||!e.supportedTypes.includes(t.type))throw new a.A("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t?.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),d(e,t)}async function d(e,t){let r=e.instance,a=r.portalItem;if(!a)return;let{url:l,title:n}=a,u=(0,s.v)(a,"portal-item");if("group"===r.type)return m(r,u,e);l&&"media"!==r.type&&r.read({url:l},u);let o=new i.v,c=await I(e,o,t);return c&&r.read(c,u),r.resourceReferences={portalItem:a,paths:u.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:n},u),(0,y.L)(r,u)}async function m(e,t,r){let l=e.portalItem;if(!e.sourceIsPortalItem)return;let{title:n,type:i}=l;if("Group Layer"===i){if(!(0,c.Y)(l,"Map"))throw new a.A("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return h(e,r)}return e.read({title:n},t),w(e,r)}async function h(e,t){let r=e.portalItem,l=await r.fetchData("json");if(!l)return;if(!t.populateGroupLayer)throw new a.A("portal:missing-populate-group-layer","Missing populate group layer");let n=(0,s.v)(r,"web-map");e.read(l,n),await t.populateGroupLayer(e,l,{context:n}),e.resourceReferences={portalItem:r,paths:n.readResourcePaths??[]}}async function w(e,t){let r,{portalItem:l}=e;if(!l)return;let n=l.type,u=t.layerModuleTypeMap;if(!u)throw new a.A("portal:missing-layer-module-type-map","Layer module type map is required to construct sub layers");switch(n){case"Feature Service":case"Feature Collection":r=u.FeatureLayer;break;case"Stream Service":r=u.StreamLayer;break;case"Scene Service":r=u.SceneLayer;break;default:throw new a.A("portal:unsupported-item-type-as-group",`The item type '${n}' is not supported as a 'IGroupLayer'`)}let s=new i.v,[c,y]=await Promise.all([r(),I(t,s)]),p=()=>c;if("Feature Service"===n){let t=(0,o.pJ)(y)?.customParameters;y=l.url?await (0,o.bO)(y,l.url,s):{},p=await T(y,u)||p;let r=await L(l.url,{customParameters:t,loadContext:s});return await v(e,p,p,y,u,r)}return"Scene Service"===n&&l.url&&(y=await (0,o.nu)(l,y,s)),(0,o.XH)(y)>0?await v(e,p,null,y,u):await g(e,p,u)}async function g(e,t,r){let{portalItem:a}=e;if(!a?.url)return;let l=await (0,p.V)(a.url);l&&v(e,t,null,{layers:l.layers?.map(o._r),tables:l.tables?.map(o._r)},r)}async function v(e,t,r,a,l,n){let i=a.layers||[],u=a.tables||[];if("Feature Collection"===e.portalItem?.type?(i.forEach((e,t)=>{e.id=t,"Table"===e?.layerDefinition?.type&&u.push(e)}),i=i.filter(e=>"Table"!==e?.layerDefinition?.type)):(i.reverse(),u.reverse()),i.forEach(r=>{let l=n?.(r);if(l||!n){let n=b(e,t(r),a,r,l);e.add(n)}}),u.length){let t=r?null:await l.FeatureLayer();u.forEach(l=>{let i=n?.(l);if(i||!n){let n=b(e,r?r(l):t,a,l,i);e.tables.add(n)}})}}function b(e,t,r,a,l){let n=e.portalItem,i={portalItem:n.clone(),layerId:a.id};null!=a.url&&(i.url=a.url);let s=new t(i);if("sourceJSON"in s&&(s.sourceJSON=l),"subtype-group"!==s.type&&"catalog"!==s.type&&(s.sublayerTitleMode="service-name"),"Feature Collection"===n.type){let e={origin:"portal-item",portal:n.portal||u.A.getDefault()};s.read(a,e);let t=r.showLegend;null!=t&&s.read({showLegend:t},e)}return s}async function I(e,t,r){var a;if(!1===e.supportsData)return;let l=e.instance,n=l.portalItem;if(!n)return;let i=null;try{i=await n.fetchData("json",r)}catch(e){}if("stream"!==(a=l).type&&"layerId"in a){let e=null,r=await S(n,i,t);if((i?.layers||i?.tables)&&r>0){if(null==l.layerId){let e=(0,o.l)(l.type),t=e?.length?(0,o.Ju)(i,e)[0]:(0,o.pJ)(i);t&&(l.layerId=t.id)}e=function(e,t){let{layerId:r}=t,a=e.layers?.find(e=>e.id===r)||e.tables?.find(e=>e.id===r);return a&&function(e,t){let r="layerType"in e&&e.layerType,{type:a}=t;return!("feature"===a&&r&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===a&&!r||"oriented-imagery"===a&&!r||"subtype-group"===a&&!r)}(a,t)?a:null}(i,l),"OrientedImageryLayer"===e?.layerType&&"oriented-imagery"===l.type&&l.supportedSourceTypes.add("Feature Layer"),e&&null!=i.showLegend&&(e.showLegend=i.showLegend)}return r>1&&"sublayerTitleMode"in l&&"service-name"!==l.sublayerTitleMode&&(l.sublayerTitleMode="item-title-and-service-name"),e}return i}async function S(e,t,r){if(t?.layers&&t?.tables)return(0,o.XH)(t);let a=(0,l.qg)(e.url);if(!a)return 1;let n=await r.fetchServiceMetadata(a.url.path,{customParameters:(0,o.pJ)(t)?.customParameters}).catch(()=>null);return(t?.layers?.length??n?.layers?.length??0)+(t?.tables?.length??n?.tables?.length??0)}async function L(e,t){let{layersJSON:r}=await (0,n.Q)(e,t);if(!r)return null;let a=[...r.layers,...r.tables];return e=>a.find(t=>t.id===e.id)}async function T(e,t){let{layers:r,tables:a}=e,l=[...r??[],...a??[]];if(!l.length)return;let n=new Set,i=[];for(let{layerType:e}of l){let r=e??"ArcGISFeatureLayer";if(n.has(r))continue;n.add(r);let a=t[(0,o.K8)(r)];i.push(a())}let u=await Promise.all(i),s=new Map;return Array.from(n).forEach((e,t)=>{s.set(e,u[t])}),({layerType:e})=>s.get(e??"ArcGISFeatureLayer")}},59488:(e,t,r)=>{r.d(t,{v:()=>l});var a=r(81194);class l{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}async fetchServiceMetadata(e,t){let r=this._serviceMetadatas.get(e);if(r)return r;let l=await (0,a.V)(e,t);return this._serviceMetadatas.set(e,l),l}async fetchItemData(e){let{id:t}=e;if(!t)return null;let{_itemDatas:r}=this;if(r.has(t))return r.get(t);let a=await e.fetchData();return r.set(t,a),a}async fetchCustomParameters(e,t){let r=await this.fetchItemData(e);return r&&"object"==typeof r&&(t?t(r):r.customParameters)||null}}},81194:(e,t,r)=>{r.d(t,{V:()=>l});var a=r(39166);async function l(e,t){let{data:r}=await (0,a.A)(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return r}}}]);