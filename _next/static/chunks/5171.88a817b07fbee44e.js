"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5171],{6591:(e,t,i)=>{i.d(t,{I:()=>a});var r=i(63943),o=i(88795),s=i(86416);function a(e,t){let{vertex:i,fragment:a}=e;e.include(o.Z,t),i.include(r.K),i.main.add((0,s.H)`vec4 posProjCenter;
if (dot(position, position) > 0.0) {
ProjectHUDAux projectAux;
vec4 posProj = projectPositionHUD(projectAux);
posProjCenter = alignToPixelCenter(posProj, viewport.zw);
forwardViewPosDepth(projectAux.posView);
vec3 vpos = projectAux.posModel;
if (rejectBySlice(vpos)) {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
} else {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
gl_Position = posProjCenter;
gl_PointSize = 1.0;`),a.main.add((0,s.H)`fragColor = vec4(1);
if(discardByTerrainDepth()) {
fragColor.g = 0.5;
}`)}},14062:(e,t,i)=>{i.d(t,{H:()=>H,b:()=>I,c:()=>z});var r=i(54036),o=i(35430),s=i(44120),a=i(54015),n=i(4538),l=i(80194),h=i(85267),c=i(63943),p=i(53297),u=i(6591),d=i(36885),f=i(17323),v=i(72936),_=i(25576),g=i(58710),m=i(54126),w=i(82784),y=i(61627),x=i(85263),T=i(61004),M=i(62809),C=i(90475),O=i(76085),S=i(86416),P=i(70762),b=i(5012),D=i(69214),A=i(53041),E=i(90564),R=i(92961);function I(e){let t=new E.N5,i=e.signedDistanceFieldEnabled;t.include(p.Q,e),t.vertex.include(l.rA,e);let{occlusionPass:o,output:I,oitPass:H}=e;if(o)return t.include(u.I,e),t;let{vertex:V,fragment:L}=t;t.include(m.Y6),t.include(v.A,e),t.include(h.g,e),t.include(d.y),L.include(g.W),L.include(_.a),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2");let N=I===n.V.Highlight,B=N&&e.occlusionTestEnabled;B&&t.varyings.add("voccluded","float"),V.uniforms.add(new x.I("viewport",e=>e.camera.fullViewport),new y.G("screenOffset",(e,t)=>(0,r.hZ)(j,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio)),new y.G("anchorPosition",e=>z(e)),new M.E("materialColor",e=>e.color),new O.m("materialRotation",e=>e.rotation)),(0,w.Nz)(V),i&&(V.uniforms.add(new M.E("outlineColor",e=>e.outlineColor)),L.uniforms.add(new M.E("outlineColor",e=>F(e)?e.outlineColor:s.uY),new O.m("outlineSize",e=>F(e)?e.outlineSize:0))),e.horizonCullingEnabled&&V.uniforms.add(new T.V("pointDistanceSphere",(e,t)=>{let i=t.camera.eye,r=e.origin;return(0,s.fA)(r[0]-i[0],r[1]-i[1],r[2]-i[2],a.$O.radius)})),e.pixelSnappingEnabled&&V.include(c.K),e.hasScreenSizePerspective&&((0,m.pM)(V),(0,m.OH)(V)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(A.r.UV0,"vec2"),t.attributes.add(A.r.COLOR,"vec4"),t.attributes.add(A.r.SIZE,"vec2"),t.attributes.add(A.r.ROTATION,"float"),t.attributes.add(A.r.FEATUREATTRIBUTE,"vec4"),V.code.add(e.horizonCullingEnabled?(0,S.H)`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:(0,S.H)`bool behindHorizon(vec3 posModel) { return false; }`),V.main.add((0,S.H)`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${(0,S.If)(e.hasScreenSizePerspective,(0,S.H)`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,(0,S.H)`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${(0,S.If)(e.vvSize,(0,S.H)`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${(0,S.If)(e.occlusionTestEnabled,(0,S.H)`
      bool visible = testHUDVisibility(posProj);
      if (!visible) {
        vtc = vec2(0.0);
        ${(0,S.If)(e.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
      ${(0,S.If)(B,(0,S.H)`voccluded = visible ? 0.0 : 1.0;`)}
    `);let Z=(0,S.H)`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${(0,S.If)(e.hasRotation,(0,S.H)`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,U=e.pixelSnappingEnabled?i?(0,S.H)`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:(0,S.H)`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:(0,S.H)`posProj += quadOffset;`;V.main.add((0,S.H)`
    ${Z}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${(0,S.If)(I===n.V.ObjectAndLayerIdColor,(0,S.H)`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${S.H.float(R.Q)};
    ${(0,S.If)(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${S.H.float(R.Q)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${U}
      gl_Position = posProj;
    }

    vtc = uv;

    ${(0,S.If)(e.debugDrawLabelBorder,(0,S.H)`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),L.uniforms.add(new b.N("tex",e=>e.texture)),e.occludedFragmentFade&&(L.uniforms.add(new P.x("depthMap",e=>e.mainDepth)),L.uniforms.add(new C.U("occludedOpacity",e=>e.hudOccludedFragmentOpacity)));let W=e.debugDrawLabelBorder?(0,S.H)`(isBorder > 0.0 ? 0.0 : ${S.H.float(R.Q)})`:S.H.float(R.Q),$=(0,S.H)`
    ${(0,S.If)(e.debugDrawLabelBorder,(0,S.H)`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${(0,S.If)(e.sampleSignedDistanceFieldTexelCenter,(0,S.H)`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,(0,S.H)`vec2 samplePos = vtc;`)}

    ${i?(0,S.H)`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgbaTofloat(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${W} ||
          fillPixelColor.a + outlinePixelColor.a < ${S.H.float(R.Q)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${(0,S.If)(!N,(0,S.H)`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${W}) {
          discard;
        }

        ${(0,S.If)(!N,(0,S.H)`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:(0,S.H)`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${W}) {
            discard;
          }
          ${(0,S.If)(!N,(0,S.H)`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${(0,S.If)(e.occludedFragmentFade&&!N,(0,S.H)`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= occludedOpacity;
        }
        `)}

    ${(0,S.If)(!N&&e.debugDrawLabelBorder,(0,S.H)`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(I){case n.V.Color:case n.V.ColorEmission:t.outputs.add("fragColor","vec4",0),I===n.V.ColorEmission&&t.outputs.add("fragEmission","vec4",1),H===D.Y.ColorAlpha&&t.outputs.add("fragAlpha","float",I===n.V.ColorEmission?2:1),L.main.add((0,S.H)`
        ${$}
        ${(0,S.If)(H===D.Y.FrontFace,(0,S.H)`fragColor.rgb /= fragColor.a;`)}
        ${(0,S.If)(I===n.V.ColorEmission,(0,S.H)`fragEmission = vec4(0.0);`)}
        ${(0,S.If)(H===D.Y.ColorAlpha,(0,S.H)`fragAlpha = fragColor.a;`)}`);break;case n.V.ObjectAndLayerIdColor:L.main.add((0,S.H)`
        ${$}
        outputObjectAndLayerIdColor();`);break;case n.V.Highlight:t.include(f.Q,e),L.main.add((0,S.H)`
        ${$}
        outputHighlight(${(0,S.If)(B,(0,S.H)`voccluded == 1.0`,(0,S.H)`false`)});`)}return t}function F(e){return e.outlineColor[3]>0&&e.outlineSize>0}function z(e){var t,i,o;return e.textureIsSignedDistanceField?(t=e.anchorPosition,i=e.distanceFieldBoundingBox,o=j,(0,r.hZ)(o,t[0]*(i[2]-i[0])+i[0],t[1]*(i[3]-i[1])+i[1])):(0,r.C)(j,e.anchorPosition),j}let j=(0,o.vt)(),H=Object.freeze(Object.defineProperty({__proto__:null,build:I,calculateAnchorPosition:z},Symbol.toStringTag,{value:"Module"}))},15529:(e,t,i)=>{i.d(t,{Cc:()=>l,RW:()=>n});var r=i(28690),o=i(4538);let s={required:[]};o.V.Depth;class a extends r.A{precompile(e){return!!this.acquireTechniques(e)}consumes(){return s}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}}class n extends a{}class l extends a{}},25627:(e,t,i)=>{i.d(t,{Z:()=>o});var r=i(84172);class o extends r.Z{}},26434:(e,t,i)=>{i.d(t,{U:()=>s});var r=i(93446),o=i(99419);function s(e,t=0){let i=e.stride;return Array.from(e.fields.keys()).map(r=>{let s=e.fields.get(r),n=s.constructor.ElementCount,l=function(e){let t=a[e];if(t)return t;throw Error("BufferType not supported in WebGL")}(s.constructor.ElementType),h=s.offset,c=s.optional?.glNormalized??!1;return new o._(r,n,l,h,i,c,t)})}let a={u8:r.pe.UNSIGNED_BYTE,u16:r.pe.UNSIGNED_SHORT,u32:r.pe.UNSIGNED_INT,i8:r.pe.BYTE,i16:r.pe.SHORT,i32:r.pe.INT,f32:r.pe.FLOAT}},29262:(e,t,i)=>{i.d(t,{A:()=>S});var r,o,s,a=i(81856),n=i(28690),l=i(61939),h=i(20538),c=i(55048),p=i(91838);i(57845),i(33638);var u=i(12709),d=i(40998),f=i(38715),v=i(54036),_=i(35430),g=i(63599),m=i(56911),w=i(13784),y=i(44120),x=i(5408),T=i(23146),M=i(47325),C=i(10954);i(87196);!function(e){e[e.Default=0]="Default",e[e.Screenshot=1]="Screenshot",e[e.ObjectAndLayerID=2]="ObjectAndLayerID"}(r||(r={})),function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(o||(o={}));let O=s=class extends n.A{constructor(e){super(e),this._ray=(0,T.vt)(),this._viewport=(0,y.fA)(0,0,1,1),this._padding=(0,y.fA)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,_.fA)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,f.vt)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,f.vt)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,f.vt)(),this._frustumDirty=!0,this._frustum=(0,x.vt)(),this._fullViewport=(0,y.vt)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,m.vt)(),this._up=(0,m.vt)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,g.d)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,d.C)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,g.i)((0,m.vt)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,g.i)((0,m.vt)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,g.i)((0,m.vt)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;let e=(0,w.b)((0,y.vt)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,w.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;let e=(0,w.b)((0,y.vt)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,w.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[o.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[o.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[o.RIGHT]+this._padding[o.LEFT]}set fullWidth(e){this.width=e-(this._padding[o.RIGHT]+this._padding[o.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[o.TOP]+this._padding[o.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[o.TOP]+this._padding[o.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[o.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[o.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,w.a)(this._padding,e)||(this._viewport[0]+=e[o.LEFT]-this._padding[o.LEFT],this._viewport[1]+=e[o.BOTTOM]-this._padding[o.BOTTOM],this._viewport[2]-=e[o.RIGHT]+e[o.LEFT]-(this._padding[o.RIGHT]+this._padding[o.LEFT]),this._viewport[3]-=e[o.TOP]+e[o.BOTTOM]-(this._padding[o.TOP]+this._padding[o.BOTTOM]),(0,w.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,d.lw)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,d.B8)((0,f.vt)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,f.vt)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){var e,t,i;return e=this._fov,2*Math.atan((t=this.width)*Math.tan(.5*e)/Math.sqrt(t*t+(i=this.height)*i))}set fovX(e){var t,i;this._fov=2*Math.atan(Math.sqrt((t=this.width)*t+(i=this.height)*i)*Math.tan(.5*e)/t),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){var e,t,i;return e=this._fov,t=this.width,2*Math.atan((i=this.height)*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}set fovY(e){var t,i;this._fov=2*Math.atan(Math.sqrt((t=this.width)*t+(i=this.height)*i)*Math.tan(.5*e)/i),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,g.j)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,d.B8)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,d.mg)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){let{near:t,far:i}=this;return 2*t*i/(i+t-e*(i-t))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){let e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,a=r/this.columns,n=-r/2+this.column*a,l=-i/2+this.row*s,h=(0,d.$h)((0,f.vt)(),n*(1+2*this._padding[o.LEFT]/e),(n+a)*(1+2*this._padding[o.RIGHT]/e),l*(1+2*this._padding[o.BOTTOM]/t),(l+s)*(1+2*this._padding[o.TOP]/t),this.near,this.far),c=this._get("projectionMatrix");return c&&(0,d.aI)(c,h)?c:h}copyFrom(e){return(0,g.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,w.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,w.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,v.C)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation,this._viewDirty=e._viewDirty,this._viewDirty||((0,d.C)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||((0,x.C)(this._frustum,e.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,d.C)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,w.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up,this.fov=e.fov}clone(){return(new s).copyFrom(this)}equals(e){return(0,g.p)(this.eye,e.eye)&&(0,g.p)(this.center,e.center)&&(0,g.p)(this.up,e.up)&&(0,w.a)(this._viewport,e.viewport)&&(0,w.a)(this._padding,e.padding)&&(0,v.t2)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){let t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,w.d)(e.screenPadding,this.screenPadding)>=t||(0,w.d)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,g.a)(D,e.eye,e.center),(0,g.a)(A,this.eye,this.center);let i=(0,g.f)(D,A),r=(0,g.z)(D),o=(0,g.z)(A);return i*i>=(1-1e-10)*r*o&&(0,g.y)(e.eye,this.eye)<5e-4*Math.max(r,o)*5e-4}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,M.gr)(this.viewForward,(0,g.d)(D,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,c.gs)()){return e[0]=(this.padding[o.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[o.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e[0]=this.padding[o.LEFT]+this.width*t,e[1]=this.padding[o.BOTTOM]+this.height*i,e[2]=.5,e}setGLViewport(e){let t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t){e!==P&&(0,g.c)(P,e),P[3]=1,(0,w.t)(P,P,this.projectionMatrix);let i=Math.abs(P[3]);(0,g.h)(P,P,1/i);let r=this.fullViewport;t[0]=(0,h.Cc)(0,r[0]+r[2],.5+.5*P[0]),t[1]=(0,h.Cc)(0,r[1]+r[3],.5+.5*P[1]),t[2]=.5*(P[2]+1),t[3]=i}unapplyProjection(e,t){let i=this.fullViewport;P[0]=(e[0]/(i[0]+i[2])*2-1)*e[3],P[1]=(e[1]/(i[1]+i[3])*2-1)*e[3],P[2]=(2*e[2]-1)*e[3],P[3]=e[3],null!=this.inverseProjectionMatrix&&((0,w.t)(P,P,this.inverseProjectionMatrix),t[0]=P[0],t[1]=P[1],t[2]=P[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,E),this.renderToScreen(E,t),t}projectToRenderScreen(e,t){if(P[0]=e[0],P[1]=e[1],P[2]=e[2],P[3]=1,(0,w.t)(P,P,this.viewProjectionMatrix),0===P[3])return null;(0,g.h)(P,P,1/Math.abs(P[3]));let i=this.fullViewport,r=(0,h.Cc)(0,i[0]+i[2],.5+.5*P[0]),o=(0,h.Cc)(0,i[1]+i[3],.5+.5*P[1]);return"x"in t?(t.x=r,t.y=o):(t[0]=r,t[1]=o,t.length>2&&(t[2]=.5*(P[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,E),t)}unprojectFromRenderScreen(e,t){if((0,d.lw)(b,this.projectionMatrix,this.viewMatrix),!(0,d.B8)(b,b))return null;let i=this.fullViewport;return P[0]=2*(e[0]-i[0])/i[2]-1,P[1]=2*(e[1]-i[1])/i[3]-1,P[2]=2*e[2]-1,P[3]=1,(0,w.t)(P,P,b),0===P[3]?null:(t[0]=P[0]/P[3],t[1]=P[1]/P[3],t[2]=P[2]/P[3],t)}constrainWindowSize(e,t,i,r){let o=e*this.pixelRatio,s=t*this.pixelRatio,a=Math.max(o-i/2,0),n=Math.max(this.fullHeight-s-r/2,0),l=-Math.min(o-i/2,0),h=-Math.min(this.fullHeight-s-r/2,0);return[Math.round(a),Math.round(n),Math.round(i-l- -Math.min(this.fullWidth-o-i/2,0)),Math.round(r-h- -Math.min(s-r/2,0))]}computeUp(e){e===C.RT.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){let i=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){let i=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=i,t[1]=r}_computeUpGlobal(){(0,g.d)(D,this.center,this.eye);let e=(0,g.l)(this.center);e<1?((0,g.i)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,g.f)(D,this.center))>.9999*(0,g.l)(D)*e||((0,g.e)(this._up,D,this.center),(0,g.e)(this._up,this._up,D),(0,g.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,g.o)(D,this.eye,this.center),.9999>=Math.abs(D[2])&&((0,g.h)(D,D,D[2]),(0,g.i)(this._up,-D[0],-D[1],1-D[2]),(0,g.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,i=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,g.p)(e,t)||((0,g.c)(t,e),this._markViewDirty(),i.length&&this.notifyChange(i)):l.A.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,x.ui)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,d.t5)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,a._)([(0,p.MZ)()],O.prototype,"_viewport",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"_padding",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"_fov",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"_nearFar",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"_viewDirty",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"_viewMatrix",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"_pixelRatio",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"pixelRatio",null),(0,a._)([(0,p.MZ)()],O.prototype,"row",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"column",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"_rows",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"rows",null),(0,a._)([(0,p.MZ)()],O.prototype,"_columns",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"columns",null),(0,a._)([(0,p.MZ)()],O.prototype,"eye",null),(0,a._)([(0,p.MZ)()],O.prototype,"center",null),(0,a._)([(0,p.MZ)()],O.prototype,"_center",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"up",null),(0,a._)([(0,p.MZ)()],O.prototype,"_up",void 0),(0,a._)([(0,p.MZ)()],O.prototype,"viewMatrix",null),(0,a._)([(0,p.MZ)({readOnly:!0})],O.prototype,"viewForward",null),(0,a._)([(0,p.MZ)({readOnly:!0})],O.prototype,"viewUp",null),(0,a._)([(0,p.MZ)({readOnly:!0})],O.prototype,"viewRight",null),(0,a._)([(0,p.MZ)({readOnly:!0})],O.prototype,"nearFar",null),(0,a._)([(0,p.MZ)()],O.prototype,"near",null),(0,a._)([(0,p.MZ)()],O.prototype,"far",null),(0,a._)([(0,p.MZ)()],O.prototype,"viewport",null),(0,a._)([(0,p.MZ)({readOnly:!0})],O.prototype,"screenViewport",null),(0,a._)([(0,p.MZ)({readOnly:!0})],O.prototype,"screenPadding",null),(0,a._)([(0,p.MZ)()],O.prototype,"x",null),(0,a._)([(0,p.MZ)()],O.prototype,"y",null),(0,a._)([(0,p.MZ)()],O.prototype,"width",null),(0,a._)([(0,p.MZ)()],O.prototype,"height",null),(0,a._)([(0,p.MZ)()],O.prototype,"fullWidth",null),(0,a._)([(0,p.MZ)()],O.prototype,"fullHeight",null),(0,a._)([(0,p.MZ)({readOnly:!0})],O.prototype,"_aspect",null),(0,a._)([(0,p.MZ)()],O.prototype,"padding",null),(0,a._)([(0,p.MZ)({readOnly:!0})],O.prototype,"projectionMatrix",null),(0,a._)([(0,p.MZ)({readOnly:!0})],O.prototype,"inverseProjectionMatrix",null),(0,a._)([(0,p.MZ)()],O.prototype,"fov",null),(0,a._)([(0,p.MZ)()],O.prototype,"fovX",null),(0,a._)([(0,p.MZ)()],O.prototype,"fovY",null),(0,a._)([(0,p.MZ)()],O.prototype,"viewInverseTransposeMatrix",null),(0,a._)([(0,p.MZ)({readOnly:!0})],O.prototype,"_projectionMatrixInternal",null),(0,a._)([(0,p.MZ)()],O.prototype,"relativeElevation",void 0);let S=O=s=(0,a._)([(0,u.$)("esri.views.3d.webgl.RenderCamera")],O),P=(0,y.vt)(),b=(0,f.vt)(),D=(0,m.vt)(),A=(0,m.vt)(),E=(0,c.r_)()},92057:(e,t,i)=>{i.d(t,{R:()=>G});var r=i(20538),o=i(6815),s=i(3391),a=i(40998),n=i(38715),l=i(54036),h=i(35430),c=i(63599),p=i(56911),u=i(44120),d=i(84766),f=i(96772),v=i(26475),_=i(34124),g=i(83094),m=i(4538),w=i(53297),y=i(95554),x=i(88936),T=i(60048),M=i(22045),C=i(64367),O=i(97681),S=i(53041);class P{constructor(){this.factor=new b,this.factorAlignment=new b}}class b{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}var D=i(70950),A=i(81605),E=i(14062),R=i(60649),I=i(96741),F=i(69214),z=i(97305),j=i(93446),H=i(84153);class V extends I.w{constructor(e,t){super(e,t,new R.$(E.H,()=>i.e(3428).then(i.bind(i,33428)))),this.primitiveType=t.occlusionPass?j.WR.POINTS:j.WR.TRIANGLES}initializePipeline(e){let{oitPass:t,hasPolygonOffset:i,draped:r,output:o,depthTestEnabled:s,occlusionPass:a}=e,n=t===F.Y.NONE,l=t===F.Y.ColorAlpha,h=o===m.V.Highlight;return(0,H.Ey)({blending:(0,m.RN)(o)?n?H.Os:(0,z.ez)(t):null,depthTest:s&&!r?{func:j.MT.LEQUAL}:null,depthWrite:!s||r||l||a||h?null:H.Uy,drawBuffers:(0,z.m6)(t,o),colorWrite:H.kn,polygonOffset:i?L:null})}}let L={factor:0,units:-4};var N=i(81856),B=i(26847),Z=i(30066),U=i(95421),W=i(4111);class $ extends W.E{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.textureCoordinateType=B.I.None,this.emissionSource=Z.ZX.None,this.discardInvisibleFragments=!0,this.hasVvInstancing=!1}}(0,N._)([(0,U.W)()],$.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,N._)([(0,U.W)()],$.prototype,"occlusionTestEnabled",void 0),(0,N._)([(0,U.W)()],$.prototype,"signedDistanceFieldEnabled",void 0),(0,N._)([(0,U.W)()],$.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,N._)([(0,U.W)()],$.prototype,"vvSize",void 0),(0,N._)([(0,U.W)()],$.prototype,"vvColor",void 0),(0,N._)([(0,U.W)()],$.prototype,"hasVerticalOffset",void 0),(0,N._)([(0,U.W)()],$.prototype,"hasScreenSizePerspective",void 0),(0,N._)([(0,U.W)()],$.prototype,"hasRotation",void 0),(0,N._)([(0,U.W)()],$.prototype,"debugDrawLabelBorder",void 0),(0,N._)([(0,U.W)()],$.prototype,"hasPolygonOffset",void 0),(0,N._)([(0,U.W)()],$.prototype,"depthTestEnabled",void 0),(0,N._)([(0,U.W)()],$.prototype,"pixelSnappingEnabled",void 0),(0,N._)([(0,U.W)()],$.prototype,"draped",void 0),(0,N._)([(0,U.W)()],$.prototype,"terrainDepthTest",void 0),(0,N._)([(0,U.W)()],$.prototype,"cullAboveTerrain",void 0),(0,N._)([(0,U.W)()],$.prototype,"occlusionPass",void 0),(0,N._)([(0,U.W)()],$.prototype,"occludedFragmentFade",void 0),(0,N._)([(0,U.W)()],$.prototype,"objectAndLayerIdColorInstanced",void 0),(0,N._)([(0,U.W)()],$.prototype,"horizonCullingEnabled",void 0),(0,N._)([(0,U.W)()],$.prototype,"isFocused",void 0);var q=i(92961);class G extends T.im{constructor(e,t){super(e,e_),this.produces=new Map([[M.N.HUD_MATERIAL,e=>(0,m.Mb)(e)&&!this.parameters.drawAsLabel],[M.N.LABEL_MATERIAL,e=>(0,m.Mb)(e)&&this.parameters.drawAsLabel],[M.N.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[M.N.DRAPED_MATERIAL,e=>this.parameters.draped&&(0,m.Mb)(e)]]),this._visible=!0,this._configuration=new $(t)}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===M.N.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||t.slot===M.N.OCCLUSION_PIXELS,(0,m.RN)(e)&&(this._configuration.debugDrawLabelBorder=!!_.b.LABELS_SHOW_BORDER),this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}intersect(e,t,i,r,s,n){let{options:{selectionMode:l,hud:h,excludeLabels:u},point:d,camera:f}=i,{parameters:v}=this;if(!l||!h||u&&v.isLabel||!e.visible||!d)return;let{scaleX:_,scaleY:g}=this._getScreenScale(e,f.pixelRatio);(0,o.z0)(es,t),e.attributes.has(S.r.FEATUREATTRIBUTE)&&function(e){let t=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],n=e[6],l=e[7],h=e[8],c=1/Math.sqrt(t*t+i*i+r*r),p=1/Math.sqrt(o*o+s*s+a*a),u=1/Math.sqrt(n*n+l*l+h*h);e[0]=t*c,e[1]=i*c,e[2]=r*c,e[3]=o*p,e[4]=s*p,e[5]=a*p,e[6]=n*u,e[7]=l*u,e[8]=h*u}(es);let m=e.attributes.get(S.r.POSITION),w=e.attributes.get(S.r.SIZE),y=e.attributes.get(S.r.NORMAL),x=e.attributes.get(S.r.ROTATION),T=e.attributes.get(S.r.CENTEROFFSETANDDISTANCE);(0,O.vA)(m.size>=3);let M=(0,E.c)(v),P="screen"===this.parameters.centerOffsetUnits;for(let e=0;e<m.data.length/m.size;e++){let r=e*m.size;(0,c.i)(J,m.data[r],m.data[r+1],m.data[r+2]),(0,c.t)(J,J,t),(0,c.t)(J,J,f.viewMatrix);let o=e*T.size;if((0,c.i)(el,T.data[o],T.data[o+1],T.data[o+2]),!P&&(J[0]+=el[0],J[1]+=el[1],0!==el[2])){let e=el[2];(0,c.n)(el,J),(0,c.d)(J,J,(0,c.h)(el,el,e))}let s=e*y.size;if((0,c.i)(K,y.data[s],y.data[s+1],y.data[s+2]),k(K,es,f,ep),this._applyVerticalOffsetTransformationView(J,ep,f,Q),f.applyProjection(J,ee),ee[0]>-1){P&&(el[0]||el[1])&&(ee[0]+=el[0]*f.pixelRatio,0!==el[1]&&(ee[1]+=(0,C.m0)(el[1],Q.factorAlignment)*f.pixelRatio),f.unapplyProjection(ee,J)),ee[0]+=this.parameters.screenOffset[0]*f.pixelRatio,ee[1]+=this.parameters.screenOffset[1]*f.pixelRatio,ee[0]=Math.floor(ee[0]),ee[1]=Math.floor(ee[1]);let t=e*w.size;ef[0]=w.data[t],ef[1]=w.data[t+1],(0,C.MD)(ef,Q.factor,ef);let r=eu*f.pixelRatio,o=0;v.textureIsSignedDistanceField&&(o=Math.min(v.outlineSize,.5*ef[0])*f.pixelRatio/2),ef[0]*=_,ef[1]*=g;let s=e*x.size,l=v.rotation+x.data[s];if(X(d,ee[0],ee[1],ef,r,o,l,v,M)){let e=i.ray;if((0,c.t)(ei,J,(0,a.B8)(en,f.viewMatrix)),ee[0]=d[0],ee[1]=d[1],f.unprojectFromRenderScreen(ee,J)){let t=(0,p.vt)();(0,c.c)(t,e.direction);let i=1/(0,c.l)(t);(0,c.h)(t,t,i),n((0,c.j)(e.origin,J)*i,t,-1,!0,1,ei)}}}}}intersectDraped(e,t,i,r,o,s){let a=e.attributes.get(S.r.POSITION),n=e.attributes.get(S.r.SIZE),l=e.attributes.get(S.r.ROTATION),h=this.parameters,c=(0,E.c)(h),{scaleX:p,scaleY:u}=this._getScreenScale(e,e.screenToWorldRatio),d=ed*e.screenToWorldRatio;for(let t=0;t<a.data.length/a.size;t++){let i=t*a.size,f=a.data[i],v=a.data[i+1],_=t*n.size;ef[0]=n.data[_],ef[1]=n.data[_+1];let g=0;h.textureIsSignedDistanceField&&(g=Math.min(h.outlineSize,.5*ef[0])*e.screenToWorldRatio/2),ef[0]*=p,ef[1]*=u;let m=t*l.size;X(r,f,v,ef,d,g,h.rotation+l.data[m],h,c)&&o(s.dist,s.normal,-1,!1)}}createBufferWriter(){return new ew}_updateScaleInfo(e,t,i){let r=this.parameters;null!=r.screenSizePerspective?(0,C.cJ)(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=r.screenSizePerspectiveAlignment?(0,C.cJ)(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,i,r,o,s,a){let n=k(t,i,o,ep);return this._applyVerticalGroundOffsetView(e,n,o,a),this._applyVerticalOffsetTransformationView(a,n,o,s),this._applyPolygonOffsetView(a,n,r[3],o,a),this._applyCenterOffsetView(a,r,a),a}applyShaderOffsetsNDC(e,t,i,r,o){return this._applyCenterOffsetNDC(e,t,i,r),null!=o&&(0,c.c)(o,r),this._applyPolygonOffsetNDC(r,t,i,r),r}_applyPolygonOffsetView(e,t,i,o,s){let a=o.aboveGround?1:-1,n=Math.sign(i);0===n&&(n=a);let l=a*n;if(this.parameters.shaderPolygonOffset<=0)return(0,c.c)(s,e);let h=(0,r.qE)(Math.abs(t.cosAngle),.01,1),p=1-Math.sqrt(1-h*h)/h/o.viewport[2];return(0,c.h)(s,e,l>0?p:1/p),s}_applyVerticalGroundOffsetView(e,t,i,r){let o=(0,c.l)(e),s=i.aboveGround?1:-1,a=i.computeRenderPixelSizeAtDist(o)*w.R,n=(0,c.h)(J,t.normal,s*a);return(0,c.g)(r,e,n),r}_applyVerticalOffsetTransformationView(e,t,i,r){let o=this.parameters;if(!o.verticalOffset?.screenLength){if(o.screenSizePerspective||o.screenSizePerspectiveAlignment){let i=(0,c.l)(e);this._updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}let s=(0,c.l)(e),a=o.screenSizePerspectiveAlignment??o.screenSizePerspective,n=(0,A.kE)(i,s,o.verticalOffset,t.cosAngle,a);return this._updateScaleInfo(r,s,t.cosAngle),(0,c.h)(t.normal,t.normal,n),(0,c.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,i){let r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,c.c)(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&((0,c.n)(K,i),(0,c.g)(i,i,(0,c.h)(K,K,t[2])))),i}_applyCenterOffsetNDC(e,t,i,r){let o="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,c.c)(r,e),o||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}_applyPolygonOffsetNDC(e,t,i,r){let o=this.parameters.shaderPolygonOffset;if(e!==r&&(0,c.c)(r,e),o){let e=i.aboveGround?1:-1,s=e*Math.sign(t[3]);r[2]-=(s||e)*o}return r}set visible(e){this._visible=e}get visible(){let{color:e,outlineSize:t,outlineColor:i}=this.parameters,r=e[3]>=q.Q||t>=q.Q&&i[3]>=q.Q;return this._visible&&r}createGLMaterial(e){return new Y(e)}calculateRelativeScreenBounds(e,t,i=(0,d.vt)()){var r,o,s,a;return r=this.parameters,o=e,s=t,(a=i)[0]=-(r.anchorPosition[0]*o[0])+r.screenOffset[0]*s,a[1]=-(r.anchorPosition[1]*o[1])+r.screenOffset[1]*s,i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}_getScreenScale(e,t){let i=e.attributes.get(S.r.FEATUREATTRIBUTE);if(null==i)return{scaleX:t,scaleY:t};let r=(0,u.ci)(i.data,ec);return(0,v.VC)(eh,this.parameters,r),{scaleX:eh[0]*t,scaleY:eh[1]*t}}}class Y extends x.m8{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(V,e)}}function k(e,t,i,r){var s,a;return((a=s=t)instanceof Float32Array&&a.length>=16||Array.isArray(s)&&s.length>=16)&&(t=(0,o.z0)(ea,t)),(0,c.q)(r.normal,e,t),(0,c.t)(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=(0,c.f)(et,ev),r}function X(e,t,i,o,s,a,n,h,c){let p=t-s-o[0]*c[0],u=p+o[0]+2*s,d=i-s-o[1]*c[1],f=d+o[1]+2*s,v=h.distanceFieldBoundingBox;return h.textureIsSignedDistanceField&&null!=v&&(p+=o[0]*v[0],d+=o[1]*v[1],u-=o[0]*(1-v[2]),f-=o[1]*(1-v[3]),p-=a,u+=a,d-=a,f+=a),(0,l.hZ)(eo,t,i),(0,l.e$)(er,e,eo,(0,r.kU)(n)),er[0]>p&&er[0]<u&&er[1]>d&&er[1]<f}let Q=new P,J=(0,p.vt)(),K=(0,p.vt)(),ee=(0,u.vt)(),et=(0,p.vt)(),ei=(0,p.vt)(),er=(0,h.vt)(),eo=(0,h.vt)(),es=(0,s.vt)(),ea=(0,s.vt)(),en=(0,n.vt)(),el=(0,p.vt)(),eh=(0,p.vt)(),ec=(0,u.vt)(),ep={normal:et,cosAngle:0},eu=1,ed=2,ef=[0,0],ev=(0,p.fA)(0,0,1);class e_ extends x.NV{constructor(){super(...arguments),this.renderOccluded=T.m$.Occlude,this.isDecoration=!1,this.color=(0,u.CN)(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=(0,h.fA)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,u.CN)(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=(0,u.vt)(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusEffect="none",this.draped=!1,this.isLabel=!1}}let eg=(0,g.BP)().vec3f(S.r.POSITION).vec3f(S.r.NORMAL).vec2f(S.r.UV0).vec4u8(S.r.COLOR).vec2f(S.r.SIZE).f32(S.r.ROTATION).vec4f(S.r.CENTEROFFSETANDDISTANCE).vec4f(S.r.FEATUREATTRIBUTE),em=eg.clone().vec4u8(S.r.OBJECTANDLAYERIDCOLOR);class ew{constructor(){this.vertexBufferLayout=(0,y.E)()?em:eg}elementCount(e){return 6*e.get(S.r.POSITION).indices.length}write(e,t,i,r,o,s){(0,D.Hk)(i.get(S.r.POSITION),e,o.position,s,6),(0,D.p1)(i.get(S.r.NORMAL),t,o.normal,s,6);let a=i.get(S.r.UV0)?.data,n=0,l=0,h=1,c=1;a&&a.length>=4&&(n=a[0],l=a[1],h=a[2],c=a[3]),h=Math.min(1.99999,h+1),c=Math.min(1.99999,c+1);let p=i.get(S.r.POSITION).indices.length,u=s,d=o.uv0;for(let e=0;e<p;++e)d.set(u,0,n),d.set(u,1,l),u++,d.set(u,0,h),d.set(u,1,l),u++,d.set(u,0,h),d.set(u,1,c),u++,d.set(u,0,h),d.set(u,1,c),u++,d.set(u,0,n),d.set(u,1,c),u++,d.set(u,0,n),d.set(u,1,l),u++;(0,D.tb)(i.get(S.r.COLOR),4,o.color,s,6);let{data:v,indices:_}=i.get(S.r.SIZE);p=_.length;let g=o.size;u=s;for(let e=0;e<p;++e){let t=v[2*_[e]],i=v[2*_[e]+1];for(let e=0;e<6;++e)g.set(u,0,t),g.set(u,1,i),u++}if((0,D.uO)(i.get(S.r.ROTATION),o.rotation,s,6),i.get(S.r.CENTEROFFSETANDDISTANCE)?(0,D.Ut)(i.get(S.r.CENTEROFFSETANDDISTANCE),o.centerOffsetAndDistance,s,6):(0,D.Pq)(o.centerOffsetAndDistance,s,6*p),i.get(S.r.FEATUREATTRIBUTE)?(0,D.Ut)(i.get(S.r.FEATUREATTRIBUTE),o.featureAttribute,s,6):(0,D.Pq)(o.featureAttribute,s,6*p),null!=r){let e=i.get(S.r.POSITION)?.indices;if(e){let t=e.length,i=o.getField(S.r.OBJECTANDLAYERIDCOLOR,f.XP);(0,D.tH)(r,i,t,s,6)}}}}},93739:(e,t,i)=>{i.d(t,{E:()=>s});var r=i(56911);i(65111);var o=i(9892);function s(e,t,i){return!!(0,o.F)(e,t,a,i.spatialReference)&&(i.x=a[0],i.y=a[1],i.z=a[2],!0)}let a=(0,r.vt)()}}]);