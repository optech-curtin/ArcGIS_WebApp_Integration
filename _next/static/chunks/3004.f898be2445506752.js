"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3004],{2370:(e,t,r)=>{r.d(t,{E:()=>T,w:()=>a});var i=r(31461),n=r(28255);r(57845);var o=r(87196),s=r(70115);class a{constructor(e=9,t){this._compareMinX=p,this._compareMinY=c,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),_.prune(),I.prune(),w.prune(),M.prune()}all(e){l(this._data,e)}search(e,t){let r=this._data,i=this._toBBox;if(g(e,r))for(_.clear();r;){for(let n=0,o=r.children.length;n<o;n++){let o=r.children[n],s=r.leaf?i(o):o;g(e,s)&&(r.leaf?t(o):m(e,s)?l(o,t):_.push(o))}r=_.pop()}}collides(e){let t=this._data,r=this._toBBox;if(!g(e,t))return!1;for(_.clear();t;){for(let i=0,n=t.children.length;i<n;i++){let n=t.children[i],o=t.leaf?r(n):n;if(g(e,o)){if(t.leaf||m(e,o))return!0;_.push(n)}}t=_.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){let e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new A([]),this}remove(e){if(!e)return this;let t,r=this._data,o=null,s=0,a=!1,l=this._toBBox(e);for(w.clear(),M.clear();r||w.length>0;){if(r||(r=w.pop(),o=w.data[w.length-1],s=M.pop()??0,a=!0),r.leaf&&-1!==(t=(0,i.qh)(r.children,(0,n.zI)(e),r.children.length,r.indexHint)))return r.children.splice(t,1),w.push(r),this._condense(w),this;a||r.leaf||!m(r,l)?o?(s++,r=o.children[s],a=!1):r=null:(w.push(r),M.push(s),s=0,o=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,i){let n=r-t+1,o=this._maxEntries;if(n<=o){let i=new A(e.slice(t,r+1));return u(i,this._toBBox),i}i||(i=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/o**(i-1)));let s=new v([]);s.height=i;let a=Math.ceil(n/o),l=a*Math.ceil(Math.sqrt(o));b(e,t,r,l,this._compareMinX);for(let n=t;n<=r;n+=l){let t=Math.min(n+l-1,r);b(e,n,t,a,this._compareMinY);for(let r=n;r<=t;r+=a){let n=Math.min(r+a-1,t);s.children.push(this._build(e,r,n,i-1))}}return u(s,this._toBBox),s}_insert(e,t,r){let i=this._toBBox,n=r?e:i(e);w.clear();let o=function(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){let r,i=1/0,s=1/0;for(let a=0,l=t.children.length;a<l;a++){var n,o;let l=t.children[a],u=y(l),d=(n=e,(Math.max((o=l).maxX,n.maxX)-Math.min(o.minX,n.minX))*(Math.max(o.maxY,n.maxY)-Math.min(o.minY,n.minY))-u);d<s?(s=d,i=u<i?u:i,r=l):d===s&&u<i&&(i=u,r=l)}t=r||t.children[0]}return t}(n,this._data,t,w);for(o.children.push(e),h(o,n);t>=0&&w.data[t].children.length>this._maxEntries;)this._split(w,t),t--;var s=n,a=w,l=t;for(let e=l;e>=0;e--)h(a.data[e],s)}_split(e,t){let r=e.data[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);let o=this._chooseSplitIndex(r,n,i);if(!o)return;let s=r.children.splice(o,r.children.length-o),a=r.leaf?new A(s):new v(s);a.height=r.height,u(r,this._toBBox),u(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this._data=new v([e,t]),this._data.height=e.height+1,u(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let i,n,o;i=n=1/0;for(let s=t;s<=r-t;s++){let t=d(e,0,s,this._toBBox),a=d(e,s,r,this._toBBox),l=function(e,t){let r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY);return Math.max(0,Math.min(e.maxX,t.maxX)-r)*Math.max(0,Math.min(e.maxY,t.maxY)-i)}(t,a),u=y(t)+y(a);l<i?(i=l,o=s,n=u<n?u:n):l===i&&u<n&&(n=u,o=s)}return o}_chooseSplitAxis(e,t,r){let i=e.leaf?this._compareMinX:p,n=e.leaf?this._compareMinY:c;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)}_allDistMargin(e,t,r,i){e.children.sort(i);let n=this._toBBox,o=d(e,0,t,n),s=d(e,r-t,r,n),a=f(o)+f(s);for(let i=t;i<r-t;i++){let t=e.children[i];h(o,e.leaf?n(t):t),a+=f(o)}for(let i=r-t-1;i>=t;i--){let t=e.children[i];h(s,e.leaf?n(t):t),a+=f(s)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){let r=e.data[t];if(0===r.children.length)if(t>0){let n=e.data[t-1],o=n.children;o.splice((0,i.qh)(o,r,o.length,n.indexHint),1)}else this.clear();else u(r,this._toBBox)}}_initFormat(e){let t=["return a"," - b",";"];this._compareMinX=Function("a","b",t.join(e[0])),this._compareMinY=Function("a","b",t.join(e[1])),this._toBBox=Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function l(e,t){let r=e;for(I.clear();r;){if(!0===r.leaf)for(let e of r.children)t((0,n.zI)(e));else I.pushArray(r.children);r=I.pop()??null}}function u(e,t){d(e,0,e.children.length,t,e)}function d(e,t,r,i,n){n||(n=new A([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let o,s=t;s<r;s++)o=e.children[s],h(n,e.leaf?i(o):o);return n}function h(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function p(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function y(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function b(e,t,r,i,n){let o=[t,r];for(;o.length;){let t=o.pop(),r=o.pop();if(t-r<=i)continue;let a=r+Math.ceil((t-r)/i/2)*i;(0,s.q)(e,a,r,t,n),o.push(r,a,a,t)}}let _=new o.A,I=new o.A,w=new o.A,M=new o.A({deallocator:void 0});class T{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class E extends T{constructor(){super(...arguments),this.height=1,this.indexHint=new i.vW}}class A extends E{constructor(e){super(),this.children=e,this.leaf=!0}}class v extends E{constructor(e){super(),this.children=e,this.leaf=!1}}},5895:(e,t,r)=>{r.d(t,{T:()=>n});var i=r(82795);let n={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new i.Om(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)}},9753:(e,t,r)=>{r.d(t,{P:()=>M});var i=r(81856),n=r(28690),o=r(32391),s=r(61939),a=r(90304),l=r(92753),u=r(97409),d=r(91838);r(57845),r(33638);var h=r(12709),p=r(61414),c=r(87960),y=r(65111),f=r(71760),m=r(78754),g=r(93193),b=r(44966),_=r(56283),I=r(90979),w=r(86099);let M=class extends n.A{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;let t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach(r=>{r.name&&(t.set(r.name,"entity"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(r.name),r.properties?.forEach(e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})}))}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(r=>{r.name&&(t.set(r.name,"relationship"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(r.name),r.properties?.forEach(e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})}))}),e.inclusionModeDefinition?.namedTypeDefinitions.forEach((r,i)=>{if("entity"===t.get(i))this.entityTypeNames.add(i);else{if("relationship"!==t.get(i))return s.A.getLogger(this).warn(`A named type, ${i}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(i);this.relationshipTypeNames.add(i)}let n=new Map;r.members?.forEach(e=>{(0,a.tE)(this.memberIdTypeLookup,e.id,()=>new Set).add(i);let t=this.getById(e.id);t&&n.set(e.id,t)}),this.sublayerCaches.set(i,n)})}addToLayer(e){e.forEach(({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new o.A("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){let r=this.inclusionModeDefinition.namedTypeDefinitions.get(e);r.members||(r.members=new Map),r.members.set(t,{id:t}),(0,a.tE)(this.memberIdTypeLookup,t,()=>new Set).add(e)}}else{let r=new Map;r.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:r}),(0,a.tE)(this.memberIdTypeLookup,t,()=>new Set).add(e)}})}getById(e){return g.A.getInstance().readFromStoreById(e)}async getData(e,t,r){let i;if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];if(i=e||new w.A({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){let e=t.parentCompositeLayer,r=this._processingCacheUpdatesLookup.get(t.objectType.name??""),n=i.outFields;n&&1===n.length&&n[0]===m.dr&&"1=1"===i.where||await Promise.all(r??[]);let o=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],s=[];return o.forEach(r=>{if(this.relationshipTypeNames.has(t.objectType.name)){r.geometry=e.relationshipLinkChartDiagramLookup.get(r.attributes[t.objectIdField]);let i=this.memberIdTypeLookup.get(r.attributes[m.Cz]),n=this.memberIdTypeLookup.get(r.attributes[m.KQ]),o=this._isEndEntitySpatial(i,r,m.Cz),s=this._isEndEntitySpatial(n,r,m.KQ);r.attributes[m.BL]=Number(o&&s)}else{r.geometry=e.entityLinkChartDiagramLookup.get(r.attributes[t.objectIdField]);let i=this.geographicLookup.get(t.objectType.name);i&&r.attributes[i.name]?r.attributes[m.BL]=1:r.attributes[m.BL]=0}r.attributes[m.T1]=r.geometry,s.push(r)}),s}return this.retrieveDataFromService(i,t,r)}async getConnectedRecordIds(e,t,r){let i=[],n="",o=this._getNamedTypeIdMapFromNodeIds(e);if(t&&0!==t?.length){for(let e of t)n=n+e+"|";n=n.slice(0,-1)}let s={},a=[];for(let[e,r]of o){let i=`${e}_ids`;s[i]=r,t&&0!==t?.length?a.push(`MATCH (n:${e}) WHERE id(n) IN $${i} WITH n MATCH (n)-[r:${n}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):a.push(`MATCH (n:${e}) WHERE id(n) IN $${i} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!a.length)return i;let l=a.join(" UNION "),u=(await (0,_.executeQueryStreaming)(this.knowledgeGraph,new I.A({openCypherQuery:l,bindParameters:s}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){let{done:e,value:t}=await u.read();if(e)break;for(let e=0;e<t.length;e++){let r=t[e];i.push({id:r[0],typeName:r[1]}),i.push({id:r[2],typeName:r[3]})}}return i}async getRelationshipsBetweenNodes(e,t,r){let i=this._getNamedTypeIdMapFromNodeIds(e);if(0===i.size)return[];let n={relationshipExclusionIds:t,possibleConnectionEntityIds:e},o=[];for(let[e,t]of i.entries()){let r=`${e}_ids`;n[r]=t,o.push(`MATCH (n:${e}) WHERE id(n) IN $${r} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}let s=o.join(" UNION "),a=[],l=(await (0,_.executeQueryStreaming)(this.knowledgeGraph,new I.A({openCypherQuery:s,bindParameters:n}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){let{done:e,value:t}=await l.read();if(e)break;for(let e=0;e<t.length;e++){let r=t[e];a.push({id:r[0],typeName:r[1]})}}return a}async getRelationshipsFromNodes(e,t,r,i){let n=this._getNamedTypeIdMapFromNodeIds(e);if(0===n.size||0===t.length)return[];let o={relationshipExclusionIds:r,possibleConnectionEntityIds:t},s=[];for(let[e,t]of n.entries()){let r=`${e}_ids`;o[r]=t,s.push(`MATCH (n:${e}) WHERE id(n) IN $${r} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}let a=s.join(" UNION "),l=new Map,u=(await (0,_.executeQueryStreaming)(this.knowledgeGraph,new I.A({openCypherQuery:a,bindParameters:o}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){let{done:e,value:t}=await u.read();if(e)break;for(let e=0;e<t.length;e++){let r=t[e],i=l.get(r[1]);i||(i=new Set,l.set(r[1],i)),i.add(r[0])}}let d=[];for(let[e,t]of l)for(let r of t)d.push({id:r,typeName:e});return d}async refreshCacheContent(e,t,r,i=!0,n){let s=g.A.getInstance(),u=[],d=new Map,h=new Map;for(let[l,p]of(this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&h.set(e.name,e)}),this.knowledgeGraph.dataModel.relationshipTypes?.forEach(e=>{e.name&&h.set(e.name,e)}),e||this.inclusionModeDefinition?e?e.forEach(e=>{if(this.memberIdTypeLookup.has(e))for(let t of this.memberIdTypeLookup.get(e))d.has(t)?d.get(t)?.push(e):d.set(t,[e])}):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach((e,t)=>{e.useAllData?d.set(t,null):e.members&&e.members.forEach(e=>{d.has(t)&&null!==d.get(t)?d.get(t)?.push(e.id):d.set(t,[e.id])})}):(this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&d.set(e.name,null)}),this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&d.set(e.name,null)})),d)){let e=new Set(p),d=new Promise((u,d)=>{(async()=>{let u=new Set,d=[],c,y="",f=!1;if(t||h.get(l)?.properties?.forEach(e=>{e.name&&u.add(e.name)}),r&&this.geographicLookup.has(l)){let e=this.geographicLookup.get(l)?.name;e&&u.add(e)}if(this.entityTypeNames.has(l))y=`MATCH (n:${l}) ${p?"WHERE id(n) IN $ids ":""}return ID(n)`,u.forEach(e=>{y+=`, n.${e}`,d.push(e)});else{if(!this.relationshipTypeNames.has(l))throw new o.A("knowledge-graph:layer-data-manager",`The graph type of ${l} could not be determined. Was this type set in the KG data model and inclusion definition?`);f=!0,y=`MATCH ()-[n:${l}]->() ${p?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,u.forEach(e=>{y+=`, n.${e}`,d.push(e)})}c=new I.A(p?{openCypherQuery:y,bindParameters:{ids:p}}:{openCypherQuery:y});let g=(await (0,_.executeQueryStreaming)(this.knowledgeGraph,c,{signal:n?.signal})).resultRowsStream.getReader();for(;;){let{done:t,value:r}=await g.read();if(t)break;let n=[];for(let t=0;t<r.length;t++){let i=r[t],o=0,s=0,l={properties:{}};for(l.id=i[0],o++,s++,f&&(l.originId=i[o],o++,s++,l.destinationId=i[o],o++,s++,(0,a.tE)(this.nodeConnectionsLookup,l.originId,()=>new Set).add(l.id),(0,a.tE)(this.nodeConnectionsLookup,l.destinationId,()=>new Set).add(l.id),(0,a.tE)(this.relationshipConnectionsLookup,l.id,()=>[l.originId,l.destinationId]));o<i.length;o++)l.properties[d[o-s]]=i[o];e.delete(l.id),n.push(l)}let o=s.writeToStore(n,m.dr,this.geographicLookup.get(l)?.name);this.sublayerCaches.has(l)||this.sublayerCaches.set(l,new Map),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(l)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(l,{useAllData:!1,members:new Map}),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(l).members=new Map);let u=this.sublayerCaches.get(l);o.forEach(e=>{u?.set(e.attributes[m.dr],e),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members.has(e.attributes[m.dr])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members.set(e.attributes[m.dr],{id:e.attributes[m.dr]}),(0,a.tE)(this.memberIdTypeLookup,e.attributes[m.dr],()=>new Set).add(l))})}let b=this.inclusionModeDefinition?.namedTypeDefinitions.get(l);if(b)for(let t of e)b.members?.delete(t)})().then(()=>{u(null)}).catch(e=>{"AbortError"===e.name?u(null):d(e)})});u.push(d),this._processingCacheUpdatesLookup.get(l)?.push(d)}if(await Promise.all(u),n?.signal?.aborted)throw(0,l.NK)()}removeFromLayer(e){let t=new Set,r=new Set(e.map(e=>e.id));for(let r of e)t.add(r.typeName),1===this.memberIdTypeLookup.get(r.id)?.size?this.memberIdTypeLookup.delete(r.id):this.memberIdTypeLookup.get(r.id)?.delete(r.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach((e,t)=>{t===r.typeName&&e.members?.has(r.id)&&e.members.delete(r.id)});t.forEach(e=>{this.sublayerCaches.get(e)?.forEach((t,i)=>{r.has(i)&&this.sublayerCaches.get(e)?.delete(i)})})}async retrieveDataFromService(e,t,r){let i=g.A.getInstance(),n=new Set,s=[],a,l="",d=[],h="relationship"===t.graphType,w=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,M=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name),T=!w&&M?Array.from(M).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(T=e.objectIds);else if(null!=e.objectIds&&T&&T.length>0){let t=e.objectIds;e.objectIds=T.filter(e=>t.includes(e))}else if(null!=e.objectIds)T=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=T}if(null!=e.outFields){let r=e.outFields;r.includes("*")?t.fields.forEach(e=>{n.add(e.name)}):r.forEach(e=>{e!==m.dr&&e!==t.geometryFieldName&&n.add(e)})}if(null!=e.geometry){let r,i=e.geometry,d=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,m=d?.spatialReference,g=d?.serviceCapabilities?.geometryCapabilities,_=g?.geometryMaxBoundingRectangleSizeX,w=g?.geometryMaxBoundingRectangleSizeY;if("point"===i.type){let e=i;e.spatialReference?.isWGS84||(await (0,y.initializeProjection)(e.spatialReference,f.KK),e=(0,y.project)(e,f.KK)),r=new p.A({spatialReference:f.KK,xmin:e.x-1e-4,ymin:e.y-1e-4,xmax:e.x+1e-4,ymax:e.y+1e-4})}else i?.extent?.spatialReference&&!i.spatialReference?.isWGS84?(await (0,y.initializeProjection)(i.extent.spatialReference,f.KK),r=(0,y.project)(i.extent,f.KK)):r=i.extent;if(_&&w&&m){if(4326!==m.wkid){let e=new p.A({spatialReference:m,xmax:_,ymax:w}),t=(0,y.project)(e,f.KK);_=t.xmax,w=t.ymax}if(r.xmax-r.xmin>_)throw new o.A("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${_}\xb0 latitude, limit exceeded`);if(r.ymax-r.ymin>w)throw new o.A("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${w}\xb0 longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){let r=await (0,u.GP)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(e=>{r.fieldNames.includes(e.name)&&n.add(e.name)})}l=h?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&n.add(t.geometryFieldName),n.forEach(e=>{l+=`, n.${e}`,s.push(e)}),a=new I.A({openCypherQuery:l,bindParameters:{param_filter_geom:new c.A({rings:(0,b.Wq)(r)})}})}else{let r="";if(null!=e.where&&"1=1"!==e.where){let i=await (0,u.GP)(e.where,t.fieldsIndex);t.fields.forEach(e=>{i.fieldNames.includes(e.name)&&n.add(e.name)});let o=new Set(["column-reference","string","number","binary-expression"]),s=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]),a=!1,l=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&o.has(e.left.type)&&o.has(e.right.type)&&s.has(e.operator))return`${l(e.left)} ${e.operator} ${l(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return a=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return a=!0,"";{let r=e.right.value;"%"===r.charAt(0)&&(r=r.slice(1)),"%"===r.charAt(r.length-1)&&(r=r.slice(0,-1)),t+=`'${r.toLowerCase()}')`}return t}return a=!0,""};r=l(i.parseTree),a&&(r="")}let i="";i=h?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let o=!1;T&&(o=!0,i+=" WHERE ID(n) IN $ids"),r&&(i+=(o?" AND":" WHERE")+` ${r}`),i+=" return ID(n)",h&&(i+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&n.add(t.geometryFieldName),n.forEach(e=>{i+=`, n.${e}`,s.push(e)}),a=new I.A(T?{openCypherQuery:i,bindParameters:{ids:T}}:{openCypherQuery:i})}let E=(await (0,_.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,a,r)).resultRowsStream.getReader();for(;;){let{done:e,value:r}=await E.read();if(e)break;let n=[];for(let e=0;e<r.length;e++){let t=r[e],i=0,o=0,a={properties:{}};for(a.id=t[0],i++,o++,h&&(a.originId=t[i],i++,o++,a.destinationId=t[i],i++,o++);i<t.length;i++)a.properties[s[i-o]]=t[i];n.push(a)}d=d.concat(i.writeToStore(n,m.dr,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return d}_isEndEntitySpatial(e,t,r){for(let i of e??[])if(this.entityTypeNames.has(i)){let e=this.geographicLookup.get(i),n=e&&this.sublayerCaches.get(i)?.get(t.attributes[r]);if(e&&n?.attributes[e.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){let t=new Map;return e.forEach(e=>{if(this.memberIdTypeLookup.has(e))for(let r of this.memberIdTypeLookup.get(e)){if(!this.entityTypeNames.has(r))return;t.has(r)?t.get(r)?.push(e):t.set(r,[e])}}),t}};(0,i._)([(0,d.MZ)()],M.prototype,"knowledgeGraph",void 0),(0,i._)([(0,d.MZ)()],M.prototype,"inclusionModeDefinition",void 0),(0,i._)([(0,d.MZ)()],M.prototype,"entityTypeNames",void 0),(0,i._)([(0,d.MZ)()],M.prototype,"relationshipTypeNames",void 0),(0,i._)([(0,d.MZ)()],M.prototype,"geographicLookup",void 0),(0,i._)([(0,d.MZ)()],M.prototype,"sublayerCaches",void 0),(0,i._)([(0,d.MZ)()],M.prototype,"nodeConnectionsLookup",void 0),(0,i._)([(0,d.MZ)()],M.prototype,"relationshipConnectionsLookup",void 0),(0,i._)([(0,d.MZ)()],M.prototype,"memberIdTypeLookup",void 0),M=(0,i._)([(0,h.$)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],M)},11064:(e,t,r)=>{r.d(t,{A:()=>y});var i=r(31461),n=r(32391),o=r(74652),s=r(61939),a=r(42845),l=r(84766),u=r(60729),d=r(29499),h=r(33332),p=r(5895);let c=(0,a.vt)();class y{constructor(e){this.geometryInfo=e,this._boundsStore=new d.F,this._featuresById=new Map,this._usedMemory=0,this.events=new o.A,this.featureAdapter=p.T}get usedMemory(){return this._usedMemory}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach(t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;let[t,r,i,n]=this.fullBounds;return{xmin:t,ymin:r,xmax:i,ymax:n,spatialReference:(0,h.ag)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(let t of e)this._add(t);this._emitChanged()}upsertMany(e){let t=e.map(e=>this._upsert(e));return this._emitChanged(),t.filter(i.Ru)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged(),this._usedMemory=0}removeById(e){let t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){for(let t of(this._boundsStore.invalidateIndex(),e)){let e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(let r of e){let e=this._boundsStore.get(r.objectId);e&&t((0,a.Jt)(c,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach(t=>e(t))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,e=>{t(this._featuresById.get(e))})}_emitChanged(){this.events.emit("changed",void 0)}_add(e){let t;if(!e)return;let r=e.objectId;if(null==r)return void s.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new n.A("featurestore:invalid-feature","feature id is missing",{feature:e}));let i=this._featuresById.get(r);if(i?(e.displayId=i.displayId,t=this._boundsStore.get(r),this._boundsStore.delete(r),this._usedMemory-=this.estimateFeatureUsedMemory?.(i)??0):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(r,null),void this._featuresById.set(r,e);null!=(t=(0,u.jQ)(null!=t?t:(0,l.vt)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM))&&this._boundsStore.set(r,t),this._featuresById.set(r,e),this._usedMemory+=this.estimateFeatureUsedMemory?.(e)??0}_upsert(e){let t=e?.objectId;if(null==t)return s.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new n.A("featurestore:invalid-feature","feature id is missing",{feature:e})),null;let r=this._featuresById.get(t);if(!r)return this._add(e),e;this._usedMemory-=this.estimateFeatureUsedMemory?.(r)??0;let{geometry:i,attributes:o}=e;for(let e in o)r.attributes[e]=o[e];return i&&(r.geometry=i,this._boundsStore.set(t,(0,u.jQ)((0,l.vt)(),i,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),this._usedMemory+=this.estimateFeatureUsedMemory?.(r)??0,r}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);let t=e.objectId;return this._boundsStore.delete(t),this._featuresById.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(e)??0,e}}},11506:(e,t,r)=>{function i(e,t){return e?t?4:3:t?3:2}function n(e,t,r,n){if(!t?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);let o=e.coords,s=[],a=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:l,coords:u}=t,d=i(r,n),h=0;for(let e of l){let t=function(e,t,r,n,o,s){let a=i(o,s),l=r,u=r+a,d=0,h=0,p=0,c=0,y=0;for(let r=0,i=n-1;r<i;r++,l+=a,u+=a){let r=t[l],i=t[l+1],n=t[l+2],s=t[u],a=t[u+1],f=t[u+2],m=r*a-s*i;c+=m,d+=(r+s)*m,h+=(i+a)*m,o&&(m=r*f-s*n,p+=(n+f)*m,y+=m),r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r),i<e[2]&&(e[2]=i),i>e[3]&&(e[3]=i),o&&(n<e[4]&&(e[4]=n),n>e[5]&&(e[5]=n))}if(c>0&&(c*=-1),y>0&&(y*=-1),!c)return null;let f=[d,h,.5*c];return o&&(f[3]=p,f[4]=.5*y),f}(a,u,h,e,r,n);t&&s.push(t),h+=e*d}if(s.sort((e,t)=>{let i=e[2]-t[2];return 0===i&&r&&(i=e[4]-t[4]),i}),s.length){let e=6*s[0][2];o[0]=s[0][0]/e,o[1]=s[0][1]/e,r&&(e=6*s[0][4],o[2]=0!==e?s[0][3]/e:0),(o[0]<a[0]||o[0]>a[1]||o[1]<a[2]||o[1]>a[3]||r&&(o[2]<a[4]||o[2]>a[5]))&&(o.length=0)}if(!o.length){let e=t.lengths[0]?function(e,t,r,n,o){let s=i(n,o),a=0,l=t+s,u=0,d=0,h=0,p=0;for(let t=0,i=r-1;t<i;t++,a+=s,l+=s){var c,y,f,m,g;let t=e[a],r=e[a+1],i=e[a+2],o=e[l],s=e[l+1],b=e[l+2],_=n?function(e,t,r,i,n,o){let s=i-e,a=n-t,l=o-r;return Math.sqrt(s*s+a*a+l*l)}(t,r,i,o,s,b):function(e,t,r,i){let n=r-e,o=i-t;return Math.sqrt(n*n+o*o)}(t,r,o,s);if(_)if(u+=_,n){let e=[(c=t)+.5*(o-c),(y=r)+.5*(s-y),(f=i)+.5*(b-f)];d+=_*e[0],h+=_*e[1],p+=_*e[2]}else{let e=[(m=t)+.5*(o-m),(g=r)+.5*(s-g)];d+=_*e[0],h+=_*e[1]}}return u>0?n?[d/u,h/u,p/u]:[d/u,h/u]:r>0?n?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}(u,0,l[0],r,n):null;if(!e)return null;o[0]=e[0],o[1]=e[1],r&&e.length>2&&(o[2]=e[2])}return e}r.d(t,{Q:()=>n})},17135:(e,t,r)=>{r.d(t,{F0:()=>a,Vx:()=>d,e2:()=>p,f:()=>c});var i=r(57845),n=r(33715),o=r(54781),s=r(64547);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.Cb:"esriGeometryPolyline"===e?s.yM:s.WR}}}let l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/,u=1;function d(e,t){if((0,i.A)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this${h(t)} = null;`;for(let t in e)r+=`this${h(t)} = ${JSON.stringify(e[t])};`;let i=Function(`
      return class AttributesClass$${u++} {
        constructor() {
          ${r};
        }
      }
    `)();return()=>new i}catch(r){return()=>({[t]:null,...e})}}function h(e){return l.test(e)?`.${e}`:`["${e}"]`}function p(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,n.o8)(e)}}]}function c(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:o.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:o.P,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},20131:(e,t,r)=>{r.d(t,{Fe:()=>l,Km:()=>function e(t,r,i,s){if(t)if("CIMTextSymbol"!==t.type){if(i&&t.effects)for(let e of t.effects)o(e,r);if(t.symbolLayers)for(let i of t.symbolLayers){switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":var a=i,l=r,u=s;if(a&&(a.markerPlacement&&function(e,t){switch((0,n.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){let r=e.placementTemplate.map(e=>e*t);e.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){let r=e.placementTemplate.map(e=>e*t);e.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(a.markerPlacement,l),a.offsetX&&(a.offsetX*=l),a.offsetY&&(a.offsetY*=l),a.anchorPoint&&"Absolute"===a.anchorPointUnits&&(a.anchorPoint={x:a.anchorPoint.x*l,y:a.anchorPoint.y*l}),a.size=null!=a.size?a.size*l:0,"CIMVectorMarker"===a.type&&a.markerGraphics))for(let t of a.markerGraphics)a.scaleSymbolsProportionally||e(t.symbol,l,!0,u);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!s?.preserveOutlineWidth&&i.width&&(i.width*=r);break;case"CIMPictureFill":i.height&&(i.height*=r),i.offsetX&&(i.offsetX*=r),i.offsetY&&(i.offsetY*=r);break;case"CIMHatchFill":e(i.lineSymbol,r,!0,{...s,preserveOutlineWidth:!1}),i.offsetX&&(i.offsetX*=r),i.offsetY&&(i.offsetY*=r),i.separation&&(i.separation*=r)}if(i.effects)for(let e of i.effects)o(e,r)}}else null!=t.height&&(t.height*=r)},Nk:()=>s});var i=r(70152),n=r(95832);function o(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){let r=e.dashTemplate.map(e=>e*t);e.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function s(e){let t=[];return function e(t,r){let i;if(!t)return;i="CIMTextSymbol"===t.type?t.symbol:t;let o="CIMPolygonSymbol"===t.type;if(i?.symbolLayers){for(let t of i.symbolLayers)if(!(t.colorLocked||o&&((0,n.mA)(t)||(0,n.MM)(t)&&t.markerPlacement&&(0,n.zr)(t.markerPlacement))))switch(t.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":t.tintColor&&a(r,t.tintColor);break;case"CIMVectorMarker":t.markerGraphics?.forEach(t=>{e(t.symbol,r)});break;case"CIMSolidStroke":case"CIMSolidFill":a(r,t.color);break;case"CIMHatchFill":e(t.lineSymbol,r)}}}((0,n.lW)(e),t),t.length?new i.A((0,n.e6)(t[0])):null}function a(e,t){for(let r of e)if(r.join(".")===t.join("."))return;e.push(t)}function l(e,t,r){t instanceof i.A||(t=new i.A(t));let o=(0,n.lW)(e);o&&function e(t,r,i){let o;if(!t)return;o="CIMTextSymbol"===t.type?t.symbol:t;let s="CIMPolygonSymbol"===o?.type;if(o?.symbolLayers)for(let t of o.symbolLayers){if(t.colorLocked)continue;if(s){if(i){let{layersToColor:e}=i;if(((0,n.mA)(t)||(0,n.MM)(t)&&t.markerPlacement&&(0,n.zr)(t.markerPlacement))&&"fill"===e||(0,n.jn)(t)&&"outline"===e)continue}else if((0,n.mA)(t)||(0,n.MM)(t)&&t.markerPlacement&&(0,n.zr)(t.markerPlacement))continue}let o=r.toArray();switch(t.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":t.tintColor=o;break;case"CIMVectorMarker":t.markerGraphics?.forEach(t=>{e(t.symbol,r,i)});break;case"CIMSolidStroke":case"CIMSolidFill":t.color=o;break;case"CIMHatchFill":e(t.lineSymbol,r,i)}}}(o,t,r)}},21009:(e,t,r)=>{r.d(t,{$C:()=>d,Hh:()=>_,J:()=>o,JT:()=>n,Tu:()=>l,Wg:()=>u,Xq:()=>p,i6:()=>c,pM:()=>a,tx:()=>i,vJ:()=>h});var i,n,o,s,a,l,u,d,h,p,c,y,f,m=r(81048);let g,b=null;function _(){return g||(g=r.e(3143).then(r.bind(r,93143)).then(e=>e.l).then(({default:e})=>e({locateFile:e=>(0,m.s)(`esri/libs/linkchartlayout/${e}`)})).then(e=>{b=e}))}!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot",e[e.IsOld=8]="IsOld"}(i||(i={})),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.Canceled=2]="Canceled"}(n||(n={})),function(e){e[e.Regular=0]="Regular",e[e.Curved=1]="Curved",e[e.Recursive=2]="Recursive"}(o||(o={})),function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom"}(s||(s={}));let I={none:0,"start-only":1,"start-and-end":2};function w(e,t,r,i,o,s){let a=r.length,l=o.length,u=Float64Array.BYTES_PER_ELEMENT,d=Uint32Array.BYTES_PER_ELEMENT,h=Uint8Array.BYTES_PER_ELEMENT,p=b._malloc(16+a*(h+2*u)+2*d*l);try{let h=p+16-p%16,c=h+a*u,y=c+a*u,f=y+l*d,m=f+l*d,g=()=>[b.HEAPF64.subarray(h>>3,(h>>3)+a),b.HEAPF64.subarray(c>>3,(c>>3)+a),b.HEAPU32.subarray(y>>2,(y>>2)+l),b.HEAPU32.subarray(f>>2,(f>>2)+l),b.HEAPU8.subarray(m,m+a)],[_,I,w,M,T]=g();_.set(r),I.set(i),w.set(o),M.set(s),T.set(t);let E=e(a,m,h,c,l,y,f),A=null,v=null;if(E.value===n.Success){let e=b.getLayoutLinksTypes(),t=b.getLayoutLinksVerticesEndIndices(),r=b.getLayoutLinksVertices(),i=b.countLayoutLinksVertices();!l||e&&t?i&&!r?E.value=n.Error:(A={types:new Uint8Array(b.HEAPU8.subarray(e,e+l)),vertexEndIndex:new Uint32Array(b.HEAPU32.subarray(t>>2,(t>>2)+l)),vertices:new Float64Array(b.HEAPF64.subarray(r>>3,(r>>3)+2*i))},v=b.getAuxiliaryGraphicElements()):E.value=n.Error}let[x,N,k,S,C]=g();return r.set(x),i.set(N),o.set(k),s.set(S),t.set(C),{status:E.value,links:A,graphics:v}}finally{b._free(p),b.cleanupLayout()}}!function(e){e.getMinIdealEdgeLength=function(){return b.getMinIdealEdgeLength()},e.apply=function(e,t,r,i,n,o,s=2,a=1,l=-1){return w((t,r,i,n,o,u,d)=>b.applyForceDirectedLayout(e,t,r,i,n,o,u,d,s,a,l),t,r,i,n,o)}}(a||(a={})),(l||(l={})).apply=function(e,t,r,i,n,o,s=2,a=1,l=-1){return w((t,r,i,n,o,u,d)=>b.applyCommunityLayout(e,t,r,i,n,o,u,d,s,a,l),t,r,i,n,o)},(u||(u={})).apply=function(e,t,r,i,n,o){return w((t,r,i,n,o,s,a)=>b.applySimpleLayout(e,t,r,i,n,o,s,a),t,r,i,n,o)},(d||(d={})).apply=function(e,t,r,i,n,o){return w((t,r,i,n,o,s,a)=>b.applyHierarchicalLayout(e,t,r,i,n,o,s,a),t,r,i,n,o)},(h||(h={})).apply=function(e,t,r,i,n,o){return w((t,r,i,n,o,s,a)=>b.applyRadialTreeLayout(e,t,r,i,n,o,s,a),t,r,i,n,o)},(p||(p={})).apply=function(e,t,r,i,n,o){return w((t,r,i,n,o,s,a)=>b.applySmartTreeLayout(e,t,r,i,n,o,s,a),t,r,i,n,o)},(c||(c={})).apply=function(e,t,r,i,o,a,l,u,d,h,p,c){return w((t,r,i,l,u,y,f)=>{if(o.length!==t||a.length!==t||d.length!==u||h.length!==u)return{value:n.Error};let m=Float64Array.BYTES_PER_ELEMENT,g=b._malloc(16+t*m),_=b._malloc(16+t*m),w=b._malloc(16+u*m),M=b._malloc(16+u*m),T=g+16-g%16,E=_+16-_%16,A=w+16-w%16,v=M+16-M%16;try{return b.HEAPF64.subarray(T>>3,(T>>3)+t).set(o),b.HEAPF64.subarray(E>>3,(E>>3)+t).set(a),b.HEAPF64.subarray(A>>3,(A>>3)+u).set(d),b.HEAPF64.subarray(v>>3,(v>>3)+u).set(h),b.applyChronologicalLayout(e,t,r,i,l,T,E,u,y,f,A,v,p,function(e){let t={...{timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0},...e?.toJSON()??{},eventsTicksVisualization:e?.eventsTicksVisualization??"start-and-end"};return{...t,timeDirection:{value:s[t.timeDirection]??s.right},eventsTicksVisualization:{value:I[t.eventsTicksVisualization]??I["start-and-end"]}}}(c))}finally{b._free(g),b._free(_),b._free(w),b._free(M)}},t,r,i,l,u)},function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(y||(y={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(f||(f={}))},24602:(e,t,r)=>{r.d(t,{A:()=>u});var i=r(81856),n=r(91838);r(57845),r(61939),r(33638);var o=r(12709),s=r(39960),a=r(72675);let l=class extends a.A{constructor(e){super(e),this.layoutGeometry=null}};(0,i._)([(0,n.MZ)({type:s.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0);let u=l=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.Entity")],l)},29499:(e,t,r)=>{r.d(t,{F:()=>a});var i=r(57845),n=r(2370),o=r(84766);let s={minX:0,minY:0,maxX:0,maxY:0};class a{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new n.w(9,(0,i.A)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){let e=Array(this._idByBounds.size),t=0;this._idByBounds.forEach((r,i)=>{e[t++]=i}),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(e=>this._idByBounds.has(e))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;let e=(0,o.Ie)();for(let t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){let t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){var r;this._loadIndex(),r=this._index,s.minX=e[0],s.minY=e[1],s.maxX=e[2],s.maxY=e[3],r.search(s,e=>t(this._idByBounds.get(e)))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){let t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},32547:(e,t,r)=>{r.d(t,{MY:()=>f,Td:()=>c,UT:()=>y,e$:()=>g,iW:()=>m,qN:()=>h});var i=r(70152),n=r(21798),o=r(13852),s=r(56283),a=r(72082),l=r(7644);let u={initializeLayersFromClientData:async(e,t,r)=>{if(t||(t=[...e.layers,...e.tables].map(e=>e.graphTypeName)),0===t?.length)return;let i=new Map;for(let r of t)i.set(r,d(e,r));let n=await (0,s.fetchClientDataAtKeys)(e.dataManager.knowledgeGraph,Array.from(i.values()),{requestOptions:{signal:r?.signal}});for(let t of[...e.layers,...e.tables]){let r=t.objectType.name;if(null==r)continue;let i=n.get(d(e,r));if(i){let e=JSON.parse(i);null===e||"object"!=typeof e||e.hasOwnProperty("showLabels")||(e.showLabels=!1),t.read(e,{origin:"service"})}}}},d=(e,t)=>"knowledge-graph"===e.type?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;async function h(e,t,r){return u.initializeLayersFromClientData(e,t,r)}let p=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"];function c(e){return new i.A(e<0||e>=p.length?"#8f8f82":p[e])}function y(e){let t=e.toArray();return new a.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function f(e){let t="ESRI__ID",r=4;for(let i of e)if(i.name){if("name"===i.name.toLowerCase()){t=i.name;break}i.name.toLowerCase().includes("name")?(t=i.name,r=2):"esriFieldTypeString"===i.fieldType&&r>3&&(t=i.name,r=3)}return t}function m(e,t,r){let i={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},s=new n.A({labelExpressionInfo:new o.A({expression:"ESRI__ID"===r?`${t}`:`$feature.${r}`}),labelPlacement:"above-center",symbol:new l.A(i)}),a=new n.A({labelExpressionInfo:new o.A({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new l.A({...i,yoffset:"12px"})});return"entity"===e?[s]:[a]}function g(e,t,r){let i={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},s="ESRI__ID"===r?`${e}`:`$feature.${r}`;return"point"===t?[new n.A({labelExpressionInfo:new o.A({expression:s}),labelPlacement:"above-center",symbol:new l.A(i)})]:"polyline"===t?[new n.A({labelExpressionInfo:new o.A({expression:s}),labelPlacement:"center-along",repeatLabel:!0,symbol:new l.A(i)})]:"polygon"===t?[new n.A({labelExpressionInfo:new o.A({expression:s}),labelPlacement:"always-horizontal",symbol:new l.A(i)})]:null}},34635:(e,t,r)=>{r.d(t,{$4:()=>function e(t){if(!t)return null;let r=null;switch(t.type){case d:case u:case h:r=e(t.outline);break;case"simple-line":{let e=(0,a.Lz)(t.width);null!=t.style&&"none"!==t.style&&0!==e&&((r={color:t.color,style:g(t.style),width:e,cap:t.cap,join:"miter"===t.join?(0,a.Lz)(t.miterLimit):t.join}).dashArray=m(r).join(",")||"none");break}default:r=null}return r},O0:()=>m,O1:()=>g,Sw:()=>b,eH:()=>y,rc:()=>f});var i=r(81048),n=r(70152),o=r(39166),s=r(16082),a=r(55048),l=r(20131);let u="picture-fill",d="simple-fill",h="simple-marker",p=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),c=new s.q(1e3);function y(e){let t=e.style,r=null;if(e)switch(e.type){case h:"cross"!==t&&"x"!==t&&(r=e.color);break;case d:t&&"solid"!==t?"none"!==t&&(r={type:"pattern",x:0,y:0,src:(0,i.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):r=e.color;break;case u:r={type:"pattern",src:e.url,width:(0,a.Lz)(e.width)*e.xscale,height:(0,a.Lz)(e.height)*e.yscale,x:(0,a.Lz)(e.xoffset),y:(0,a.Lz)(e.yoffset)};break;case"text":r=e.color;break;case"cim":r=(0,l.Nk)(e)}return r}function f(e,t){let r=e+"-"+t;return void 0!==c.get(r)?Promise.resolve(c.get(r)):(0,o.A)(e,{responseType:"image"}).then(e=>{let i=e.data,n=i.naturalWidth,o=i.naturalHeight,s=document.createElement("canvas");s.width=n,s.height=o;let a=s.getContext("2d");a.fillStyle=t,a.fillRect(0,0,n,o),a.globalCompositeOperation="destination-in",a.drawImage(i,0,0);let l=s.toDataURL();return c.put(r,l),l})}function m(e){if(!e?.style)return[];let{dashArray:t,style:r,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map(e=>Number(e));let n=i??0,o=p.has(r)?p.get(r).map(e=>e*n):[];if("butt"!==e.cap)for(let[e,t]of o.entries())o[e]=e%2==1?t+n:Math.max(t-n,1);return o}let g=(()=>{let e={};return t=>{if(e[t])return e[t];let r=t.replaceAll("-","");return e[t]=r,r}})(),b=new n.A([128,128,128])},36371:(e,t,r)=>{r.d(t,{A:()=>u});var i=r(81856),n=r(91838);r(57845),r(61939),r(33638);var o=r(12709),s=r(65442),a=r(72675);let l=class extends a.A{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],l.prototype,"originId",void 0),(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],l.prototype,"destinationId",void 0),(0,i._)([(0,n.MZ)({type:s.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0);let u=l=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.Relationship")],l)},44966:(e,t,r)=>{r.d(t,{k5:()=>u,aq:()=>l,Wq:()=>d}),r(97135);var i=r(32391);r(39960),r(87960),r(65442),r(54774),r(93193),r(21009);var n=r(30781);(0,n.O)()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"}),(0,n.O)()({absoluteValue:"absolute-value",multiplier:"multiplier"});let o=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);var s=r(56283),a=r(90979);async function l(e,t,r){let i=[],n=function(e,t){let r=new Map;if(t.dataModel?.relationshipTypes)for(let e of t.dataModel.relationshipTypes)e.name&&r.set(e.name,[]);for(let t of e)r.has(t.typeName)&&r.get(t.typeName)?.push(t.id);return r}(e,t),o={},l=[];for(let[e,t]of n){if(t.length<1)continue;let r=`${e}_ids`;o[r]=t,l.push(`MATCH (n)-[r:${e}]->(m) WHERE id(r) in $${r} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(0===l.length)return[];let u=l.join(" UNION "),d=new a.A({openCypherQuery:u,bindParameters:o}),h=(await (0,s.executeQueryStreaming)(t,d,r?.requestOptions)).resultRowsStream.getReader();for(;;){let{done:e,value:t}=await h.read();if(e)break;for(let e of t)i.push({id:e[0],typeName:e[1]}),i.push({id:e[2],typeName:e[3]})}return i}r(72082),r(59276),r(7644);let u=e=>o.get(e)??"radial-root-centric";function d(e){if(!e.spatialReference.isWGS84)throw new i.A("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}},51696:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(81856),n=r(92713),o=r(91838);r(57845),r(61939),r(33638);var s=r(12709);let a=class extends n.A{constructor(e){super(e),this.properties=null}};(0,i._)([(0,o.MZ)({json:{write:!0}})],a.prototype,"properties",void 0);let l=a=(0,i._)([(0,s.$)("esri.rest.knowledgeGraph.GraphObject")],a)},54774:(e,t,r)=>{r.d(t,{A:()=>c});var i=r(81856),n=r(91838);r(57845),r(61939),r(33638);var o=r(12709),s=r(40211),a=r(64171),l=r(24743),u=r(23281),d=r(65372),h=r(8136);let p=class extends(0,l.dM)((0,u.j)(a.A)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new d.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,i._)([(0,n.MZ)({type:h.A})],p.prototype,"elevationInfo",void 0),(0,i._)([(0,n.MZ)((0,s.C)(d.Y,"graphics"))],p.prototype,"graphics",void 0),(0,i._)([(0,n.MZ)({type:["show","hide"]})],p.prototype,"listMode",void 0),(0,i._)([(0,n.MZ)()],p.prototype,"screenSizePerspectiveEnabled",void 0),(0,i._)([(0,n.MZ)({readOnly:!0})],p.prototype,"type",void 0),(0,i._)([(0,n.MZ)({constructOnly:!0})],p.prototype,"internal",void 0);let c=p=(0,i._)([(0,o.$)("esri.layers.GraphicsLayer")],p)},54805:(e,t,r)=>{r.d(t,{A:()=>i});class i{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){let e=new i;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},56599:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(94264);class n{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new n(e.lengths,e.coords)}static fromRect(e){let[t,r,i,o]=e,s=i-t,a=o-r;return new n([5],[t,r,s,0,0,a,-s,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,t)=>e+t)}get usedMemory(){return 64+(0,i.Qf)(this.lengths,this.coords)}area(){let e=0,t=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){let i=this.lengths[r];if(i<3)continue;let n=this.coords[2*t],o=this.coords[2*t+1];for(let r=1;r<i;r+=1){let i=this.coords[2*(r+t)],s=this.coords[2*(r+t)+1];e+=-.5*(i-n)*(s+o),n=i,o=s}t+=i}return e}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){let i=this.lengths[r];for(let r=0;r<i;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=i}}deltaDecode(){let e=this.clone(),{coords:t,lengths:r}=e,i=0;for(let e of r){for(let r=1;r<e;r++)t[2*(i+r)]+=t[2*(i+r)-2],t[2*(i+r)+1]+=t[2*(i+r)-1];i+=e}return e}clone(e){if(0===this.lengths.length)return new n([],[this.coords[0],this.coords[1]]);let t=(0===this.lengths.length?1:this.lengths.reduce((e,t)=>e+t))*2,r=this.coords.slice(0,t);return e?(e.set(r),new n(this.lengths,e)):new n(Array.from(this.lengths),Array.from(r))}}},60729:(e,t,r)=>{r.d(t,{B2:()=>w,BW:()=>O,Ch:()=>en,DF:()=>A,Di:()=>U,E2:()=>Y,IE:()=>I,Nl:()=>et,Q4:()=>eo,Rk:()=>es,Ux:()=>V,Ye:()=>q,ZF:()=>W,eU:()=>Z,eY:()=>K,hK:()=>ea,jH:()=>ee,jQ:()=>ei,kz:()=>er,oN:()=>Q,q3:()=>J,qK:()=>P,qN:()=>D,z5:()=>B,zv:()=>X});var i=r(32391),n=r(61939),o=r(40941),s=r(42845),a=r(84766),l=r(31789),u=r(82795),d=r(54805),h=r(56599);function p(e,t){return e?t?4:3:t?3:2}let c=()=>n.A.getLogger("esri.layers.graphics.featureConversionUtils"),y={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},f=(e,t,r,i,n,o)=>{e[r]=n,e[r+1]=o},m=(e,t,r,i,n,o)=>{e[r]=n,e[r+1]=o,e[r+2]=t[i+2]},g=(e,t,r,i,n,o)=>{e[r]=n,e[r+1]=o,e[r+2]=t[i+3]},b=(e,t,r,i,n,o)=>{e[r]=n,e[r+1]=o,e[r+2]=t[i+2],e[r+3]=t[i+3]};function _(e,t,r,i){if(e){if(r)return t&&i?b:m;if(t&&i)return g}else if(t&&i)return m;return f}function I({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function w({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function M({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function T({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function E({scale:e,translate:t},r,i){return r*e[i]+t[i]}function A(e,t,r){return e?t?r?L(e):N(e):r?S(e):v(e):null}function v(e){let t=e.coords;return{x:t[0],y:t[1]}}function x(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function N(e){let t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function k(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function S(e){let t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function C(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function L(e){let t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function R(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function F(e,t){return e&&t?R:e?k:t?C:x}function D(e,t,r=F(null!=t.z,null!=t.m)){return r(e,t)}function P(e,t,r){if(null==e)return null;let i=p(t,r),n=[];for(let t=0;t<e.coords.length;t+=i){let r=[];for(let n=0;n<i;n++)r.push(e.coords[t+n]);n.push(r)}return t?r?{points:n,hasZ:t,hasM:r}:{points:n,hasZ:t}:r?{points:n,hasM:r}:{points:n}}function G(e,t,r=p(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;let i=e.coords,n=0;for(let e of t.points)for(let t=0;t<r;t++)i[n++]=e[t];return e}function O(e,t,r){if(!e)return null;let i=p(t,r),{coords:n,lengths:o}=e,s=[],a=0;for(let e of o){let t=[];for(let r=0;r<e;r++){let e=[];for(let t=0;t<i;t++)e.push(n[a++]);t.push(e)}s.push(t)}return t?r?{paths:s,hasZ:t,hasM:r}:{paths:s,hasZ:t}:r?{paths:s,hasM:r}:{paths:s}}function j(e,t,r=p(t.hasZ,t.hasM)){let{lengths:i,coords:n}=e,o=0;for(let e of t.paths){for(let t of e)for(let e=0;e<r;e++)n[o++]=t[e];i.push(e.length)}return e}function B(e,t,r){if(!e)return null;let i=p(t,r),{coords:n,lengths:o}=e,s=[],a=0;for(let e of o){let t=[];for(let r=0;r<e;r++){let e=[];for(let t=0;t<i;t++)e.push(n[a++]);t.push(e)}s.push(t)}return t?r?{rings:s,hasZ:t,hasM:r}:{rings:s,hasZ:t}:r?{rings:s,hasM:r}:{rings:s}}function q(e,t,r=t.hasZ,i=t.hasM){return Z(e,t.rings,r,i)}function Z(e,t,r,i){let n=p(r,i),{lengths:o,coords:s}=e,a=0;for(let r of(el(e),t)){for(let e of r)for(let t=0;t<n;t++)s[a++]=e[t];o.push(r.length)}return e}let $=[],z=[];function Y(e,t,r,i,n){$[0]=e;let[o]=U(z,$,t,r,i,n);return eu($),eu(z),o}function U(e,t,r,n,o,s){if(eu(e),!r){for(let r of t){let t=s?r.attributes[s]:void 0;e.push(new u.Om(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":let a=F(n,o);for(let{geometry:r,attributes:i}of t){let t=null!=r?a(new h.A,r):null;e.push(new u.Om(t,i,null,s?i[s]:void 0))}break;case"esriGeometryMultipoint":let l=p(n,o);for(let{geometry:r,attributes:i}of t){let t=null!=r?G(new h.A,r,l):null;e.push(new u.Om(t,i,null,s?i[s]:void 0))}break;case"esriGeometryPolyline":let d=p(n,o);for(let{geometry:r,attributes:i,centroid:n}of t){let t=null!=r?j(new h.A,r,d):null,o=null!=n?D(new h.A,n):null;e.push(new u.Om(t,i,o,s?i[s]:void 0))}break;case"esriGeometryPolygon":case"esriGeometryMultiPatch":for(let{geometry:r,centroid:i,attributes:a}of t){let t=null!=r?q(new h.A,r,n,o):null,l=s?a[s]:void 0;null!=i?e.push(new u.Om(t,a,x(new h.A,i),l)):e.push(new u.Om(t,a,null,l))}break;default:c().error("convertToFeatureSet:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${r}'`)),eu(e)}return e}function Q(e,t,r,i){z[0]=e,H($,z,t,r,i);let n=$[0];return eu($),eu(z),n}function V(e,t,r){if(null==e)return null;let n=new h.A;return("hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,l.fT)(e))?F(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(n,e):(0,l.Bi)(e)?q(n,e,t,r):(0,l.Rg)(e)?j(n,e,p(t,r)):(0,l.U9)(e)?G(n,e,p(t,r)):void c().error("convertFromGeometry:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${e}'`))}function X(e,t,r,n){let o=e&&("coords"in e?e:e.geometry);if(null==o)return null;switch(t){case"esriGeometryPoint":{let e=v;return r&&n?e=L:r?e=N:n&&(e=S),e(o)}case"esriGeometryMultipoint":return P(o,r,n);case"esriGeometryPolyline":return O(o,r,n);case"esriGeometryPolygon":return B(o,r,n);default:return c().error("convertToGeometry:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${t}'`)),null}}function H(e,t,r,n,o){if(eu(e),null==r){for(let r of t)e.push({attributes:r.attributes});return e}switch(r){case"esriGeometryPoint":let s=v;for(let r of(n&&o?s=L:n?s=N:o&&(s=S),t)){let{geometry:t,attributes:i}=r,n=null!=t?s(t):null;e.push({attributes:i,geometry:n})}break;case"esriGeometryMultipoint":for(let{geometry:r,attributes:i}of t)e.push({attributes:i,geometry:null!=r?P(r,n,o):null});break;case"esriGeometryPolyline":for(let{geometry:r,attributes:i}of t)e.push({attributes:i,geometry:null!=r?O(r,n,o):null});break;case"esriGeometryPolygon":for(let{geometry:r,attributes:i,centroid:s}of t){let t=null!=r?B(r,n,o):null;if(null!=s){let r=v(s);e.push({attributes:i,centroid:r,geometry:t})}else e.push({attributes:i,geometry:t})}break;default:c().error("convertToFeatureSet:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${r}'`))}return e}function W(e){let{objectIdFieldName:t,spatialReference:r,transform:i,fields:n,hasM:o,hasZ:s,features:a,geometryType:l,exceededTransferLimit:u,uniqueIdField:d,queryGeometry:h,queryGeometryType:p}=e,c={features:H([],a,l,s,o),fields:n,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:d,queryGeometry:X(h,p,!1,!1)};return i&&(c.transform=i),u&&(c.exceededTransferLimit=u),o&&(c.hasM=o),s&&(c.hasZ=s),c}function J(e,t){let r=new d.A,{hasM:n,hasZ:o,features:s,objectIdFieldName:a,spatialReference:l,geometryType:u,exceededTransferLimit:h,transform:p,fields:y}=e;return y&&(r.fields=y),r.geometryType=u??null,r.objectIdFieldName=a??t??null,r.spatialReference=l??null,r.objectIdFieldName?(s&&U(r.features,s,u,o,n,r.objectIdFieldName),h&&(r.exceededTransferLimit=h),n&&(r.hasM=n),o&&(r.hasZ=o),p&&(r.transform=p)):c().error(new i.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r}function K(e){let{transform:t,features:r,hasM:i,hasZ:n}=e;if(!t)return e;for(let e of r)null!=e.geometry&&en(e.geometry,e.geometry,i,n,t),null!=e.centroid&&en(e.centroid,e.centroid,i,n,t);return e.transform=null,e}function ee(e,t){let{geometryType:r,features:i,hasM:n,hasZ:o}=t;if(!e)return t;for(let t=0;t<i.length;t++){let s=i[t],a=s.weakClone();a.geometry=new h.A,et(a.geometry,s.geometry,n,o,r,e),s.centroid&&(a.centroid=new h.A,et(a.centroid,s.centroid,n,o,"esriGeometryPoint",e)),i[t]=a}return t.transform=e,t}function et(e,t,r,i,n,o,s=r,a=i){if(el(e),!t?.coords.length)return null;let l=y[n],{coords:u,lengths:d}=t,h=p(r,i),c=p(r&&s,i&&a),f=_(r,i,s,a);if(!d.length)return f(e.coords,u,0,0,I(o,u[0]),w(o,u[1])),el(e,h,0),e;let m,g,b,M,T=0,E=0,A=0;for(let t of d){if(t<l)continue;let r=0;E=A,b=m=I(o,u[T]),M=g=w(o,u[T+1]),f(e.coords,u,E,T,b,M),r++,T+=h,E+=c;for(let i=1;i<t;i++,T+=h)b=I(o,u[T]),M=w(o,u[T+1]),b===m&&M===g||(f(e.coords,u,E,T,b-m,M-g),E+=c,r++,m=b,g=M);r>=l&&(e.lengths.push(r),A=E)}return eu(e.coords,A),e.coords.length?e:null}function er(e,t,r,i,n,o,s=r,a=i){if(el(e),!t?.coords.length)return null;let l=y[n],{coords:u,lengths:d}=t,h=p(r,i),c=p(r&&s,i&&a),f=_(r,i,s,a);if(!d.length)return f(e.coords,u,0,0,u[0],u[1]),el(e,h,0),e;let m=0,g=o*o;for(let t of d){if(t<l){m+=t*h;continue}let r=e.coords.length/c,i=m,n=m+(t-1)*h;f(e.coords,u,e.coords.length,i,u[i],u[i+1]),function e(t,r,i,n,o,s,a){let l,u=n,d=0;for(let e=s+i;e<a;e+=i)(l=function(e,t,r,i){let n=e[t],o=e[t+1],s=e[r],a=e[r+1],l=e[i],u=e[i+1],d=s,h=a,p=l-d,c=u-h;if(0!==p||0!==c){let e=((n-d)*p+(o-h)*c)/(p*p+c*c);e>1?(d=l,h=u):e>0&&(d+=p*e,h+=c*e)}return(p=n-d)*p+(c=o-h)*c}(r,e,s,a))>u&&(d=e,u=l);u>n&&(d-s>i&&e(t,r,i,n,o,s,d),o(t,r,t.length,d,r[d],r[d+1]),a-d>i&&e(t,r,i,n,o,d,a))}(e.coords,u,h,g,f,i,n),f(e.coords,u,e.coords.length,n,u[n],u[n+1]);let o=e.coords.length/c-r;o>=l?e.lengths.push(o):eu(e.coords,r*c),m+=t*h}return e.coords.length?e:null}function ei(e,t,r,i){if(!t?.coords?.length)return null;let n=p(r,i),o=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY;if(t&&t.coords){let e=t.coords;for(let t=0;t<e.length;t+=n){let r=e[t],i=e[t+1];o=Math.min(o,r),u=Math.max(u,r),l=Math.min(l,i),d=Math.max(d,i)}}return(0,s.is)(e)?(0,s.BI)(e,o,l,u,d):(0,a.fA)(o,l,u,d,e),e}function en(e,t,r,i,n){let{coords:s,lengths:a}=t,l=p(r,i);if(!s.length)return e!==t&&el(e),e;(0,o.Lw)(n);let{originPosition:u,scale:d,translate:h}=n;ed.originPosition=u;let c=ed.scale;c[0]=d[0]??1,c[1]=-(d[1]??1),c[2]=d[2]??1,c[3]=d[3]??1;let y=ed.translate;if(y[0]=h[0]??0,y[1]=h[1]??0,y[2]=h[2]??0,y[3]=h[3]??0,!a.length){for(let t=0;t<l;++t)e.coords[t]=function({scale:e,translate:t},r,i){return r*e[i]+t[i]}(ed,s[t],t);return e!==t&&el(e,l,0),e}let f=0;for(let t=0;t<a.length;t++){let r=a[t];e.lengths[t]=r;for(let t=0;t<l;++t)e.coords[f+t]=function({scale:e,translate:t},r,i){return r*e[i]+t[i]}(ed,s[f+t],t);let i=e.coords[f],n=e.coords[f+1];f+=l;for(let t=1;t<r;t++,f+=l){i+=s[f]*c[0],n+=s[f+1]*c[1],e.coords[f]=i,e.coords[f+1]=n;for(let t=2;t<l;++t)e.coords[f+t]=function({scale:e,translate:t},r,i){return r*e[i]+t[i]}(ed,s[f+t],t)}}return e!==t&&el(e,s.length,a.length),e}function eo(e,t,r,i,n,o){if(el(e),e.lengths.push(...t.lengths),r===n&&i===o)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{let s=p(r,i),a=_(r,i,n,o),l=t.coords;for(let t=0;t<l.length;t+=s)a(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e}function es(e,t){let{coords:r,lengths:i}=e,n=0,o=0;for(let e=0;e<i.length;e++){let s=i[e];o+=function(e,t,r,i){let n=0,o=e[i*t],s=e[i*(t+1)];for(let a=1;a<r;a++){let r=o+e[i*(t+a)],l=s+e[i*(t+a)+1],u=(r-o)*(l+s);o=r,s=l,n+=u}return .5*n}(r,n,s,t),n+=s}return Math.abs(o)}function ea(e,t,r,i,n){let o=p(i,n);if(!e.lengths.length){if(e.coords.length<2)return null;let[r,i]=e.coords,n=M(t,r),o=T(t,i);return new h.A([],[n,o])}let s=new h.A([],[0,0]),a=y[r],l="esriGeometryPolygon"===r||"esriGeometryPolyline"===r,u=0,d=0;for(let r=0;r<e.lengths.length;r++){let i=e.lengths[r],n=d,h=M(t,e.coords[o*u]),p=T(t,e.coords[o*u+1]);s.coords[d++]=h,s.coords[d++]=p;let y=0,m=0,g=1;for(let r=1;r<i;r++){let i=M(t,e.coords[o*(r+u)]),n=T(t,e.coords[o*(r+u)+1]);if(i!==h||n!==p){var c,f;let e=i-h,t=n-p;l&&0==(c=y)*t-e*(f=m)&&c*e+f*t>0?(s.coords[d-2]+=e,s.coords[d-1]+=t,h+=e,p+=t):(s.coords[d++]=i,s.coords[d++]=n,h=i,p=n,y=e,m=t,g+=1)}}g<a?d=n:s.lengths.push(g),u+=i}return 0===s.lengths.length?null:s}function el(e,t=0,r=0){eu(e.lengths,r),eu(e.coords,t)}function eu(e,t=0){e.length!==t&&(e.length=t)}let ed={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},64443:(e,t,r)=>{r.d(t,{A:()=>ei});var i=r(81856),n=r(39267),o=r(33715),s=r(61939),a=r(21892);r(6675);var l=r(91838);r(57845);var u=r(12709),d=r(7780),h=r(44151),p=r(61414),c=r(39960),y=r(87960),f=r(65442),m=r(65111),g=r(91463),b=r(71760),_=r(59879),I=r(64171),w=r(11064),M=r(41359),T=r(17135),E=r(78754);r(33638);let A=(0,r(34929).p)(),v=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,i._)([(0,l.MZ)(A.fields)],t.prototype,"fields",void 0),(0,i._)([(0,l.MZ)(A.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,i._)([(0,u.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t)};var x=r(32547),N=r(24743),k=r(9263),S=r(54843),C=r(57248),L=r(16217),R=r(6255),F=r(23281),D=r(70442),P=r(76572),G=r(74817),O=r(80824),j=r(39265),B=r(21798),q=r(68266),Z=r(18845),$=r(21221),z=r(73723),Y=r(73358),U=r(49570),Q=r(86099),V=r(52438),X=r(89700),H=r(31393);function W(e){let t;if(!e.json)return e;e.json.write=J(e.json.write);let r=e.json.origins;if(!r)return e;for(t in r){let e=r[t];e&&(e.write=J(e.write))}return e}function J(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){let{target:t,writer:r,overridePolicy:i,...n}=e;return function(e,t){let r=ee.call(this,e,t);return r.enabled?{...n,...r}:r}}(e)),e):!0===e?K():e}function K(){return{overridePolicy:ee}}function ee(e,t){let r=!!this.geometryType,i={enabled:r};return r&&(i={...i,...et.call(this,e,t)}),i}function et(e,t){return{ignoreOrigin:this.originIdOf(t)>h.Gr.DEFAULTS}}let er=class extends v((0,k.FJ)((0,C.J)((0,S.F)((0,N.dM)((0,L.fY)((0,D.e)((0,F.j)((0,R.J)((0,a.P)(I.A)))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=(0,T.f)(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=E.dr,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{let e=new MessageChannel;return new H.A(e.port1,{channel:e,client:{queryFeatures:(e,t={})=>{let r=Q.A.fromJSON(e);return this.queryFeaturesJSON(r,t)}}}),[e.port2]})},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){let t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){let e=[];return this.objectType?.properties?.forEach(t=>{let r="esriFieldTypeOID"===t.fieldType?"esriFieldTypeInteger":t.fieldType;e.push(O.A.fromJSON({name:t.name,type:r,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))}),e.push(O.A.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),O.A.fromJSON({name:E.M1,type:"esriFieldTypeInteger",alias:E.M1,editable:!1}),O.A.fromJSON({name:E.BL,type:"esriFieldTypeInteger",alias:E.BL,editable:!1})),e}get geometryType(){if("link-chart"===this.parentCompositeLayer?.type)return"relationship"===this.graphType?"polyline":"point";let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&"esriGeometryNull"!==t?_.gy.fromJSON(t):null}get geometryFieldName(){if("link-chart"===this.parentCompositeLayer?.type)return E.T1;let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name);return e?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,r=t?this.objectType?.properties?.[t]:null;return r?.hasM??!1}get hasZ(){let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,r=t?this.objectType?.properties?.[t]:null;return r?.hasZ??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");let e=this.objectType.properties?(0,x.MY)(this.objectType.properties):"ESRI__ID";return"link-chart"===this.parentCompositeLayer.type?(0,x.iW)(this.graphType,this.graphTypeName,e):(0,x.e$)(this.graphTypeName,this.geometryType,e)}set renderer(e){(0,j.yp)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");let e=this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel,t=[...e?.entityTypes??[],...e?.relationshipTypes??[]].map(e=>e.name).indexOf(this.graphTypeName),r=(0,x.Td)(t);if("link-chart"===this.parentCompositeLayer?.type){if("relationship"===this.graphType)return new $.A({type:"simple",symbol:(0,x.UT)(r)});let e=(0,z.r)((0,T.F0)(_.gy.toJSON("point")).renderer);return(0,X.dt)(e.symbol,r),e}let i=(0,z.r)((0,T.F0)(_.gy.toJSON(this.geometryType)).renderer);return(0,X.dt)(i.symbol,r),i}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??g.A.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return(0,V.tn)(this,e)}createQuery(){return new Q.A({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}async queryFeatures(e,t){await this.load();let{resolvedQuery:r,queryEngine:i}=await this._setupQueryObjects(e),n=U.A.fromJSON(await i.executeQuery(r.toJSON(),t?.signal));return n.features.forEach(e=>{e.sourceLayer=this}),n}async queryFeaturesJSON(e,t){await this.load();let{resolvedQuery:r,queryEngine:i}=await this._setupQueryObjects(e);return await i.executeQuery(r.toJSON(),t?.signal)}async queryFeatureCount(e,t){await this.load();let{resolvedQuery:r,queryEngine:i}=await this._setupQueryObjects(e);return i.executeQueryForCount(r.toJSON(),t?.signal)}async queryExtent(e={},t){let r;await this.load();let i={...e,returnGeometry:!0},{resolvedQuery:n,queryEngine:o}=await this._setupQueryObjects(i),s=await o.executeQueryForExtent(n.toJSON(),t?.signal);return r=null!=s.extent?.xmin&&null!=s.extent?.xmax&&null!=s.extent?.ymin&&null!=s.extent?.ymax?new p.A(s.extent):new p.A,{count:s.count,extent:r}}async queryObjectIds(e,t){let r;await this.load();let i=Q.A.from(e);if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{let e=await this.parentCompositeLayer.dataManager.getData(i,this,t);r=this.loadQueryEngine(e)}return await r.executeQueryForIds(i.toJSON(),t?.signal)}loadQueryEngine(e){let t=new w.A({geometryType:_.gy.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new M.do({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:_.gy.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:t});return r.featureStore.addMany(e),r}async refreshCachedQueryEngine(){let e=await this.parentCompositeLayer.dataManager.getData(new Q.A({where:"1=1",outFields:[E.dr]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then(()=>(0,j.sv)(this.timeInfo,this.fieldsIndex))),Promise.resolve(this)}async _setupQueryObjects(e,t){let r=Q.A.from(e),i=r.geometry;if(i&&!i.spatialReference?.isWGS84&&(await (0,m.initializeProjection)(i.spatialReference,b.KK),r.geometry=(0,m.project)(i instanceof y.A||i instanceof f.A||i instanceof c.A?i:i.extent,b.KK)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)return{resolvedQuery:r,queryEngine:this._cachedQueryEngine};let n=await this.parentCompositeLayer.dataManager.getData(r,this,t);return{resolvedQuery:r,queryEngine:this.loadQueryEngine(n)}}};(0,i._)([(0,l.MZ)(W((0,o.o8)(N.sU)))],er.prototype,"blendMode",void 0),(0,i._)([(0,l.MZ)()],er.prototype,"capabilities",void 0),(0,i._)([(0,l.MZ)({json:{origins:{"web-scene":{write:!1}},write:K()}})],er.prototype,"charts",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],er.prototype,"defaultPopupTemplate",null),(0,i._)([(0,l.MZ)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],er.prototype,"definitionExpression",void 0),(0,i._)([(0,l.MZ)()],er.prototype,"displayField",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(k.Dp)))],er.prototype,"displayFilterEnabled",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(k.KV)))],er.prototype,"displayFilterInfo",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(N.LF)))],er.prototype,"effect",void 0),(0,i._)([(0,l.MZ)()],er.prototype,"elevationInfo",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(S.Y)))],er.prototype,"featureEffect",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(G.d)))],er.prototype,"featureReduction",null),(0,i._)([(0,l.MZ)()],er.prototype,"fields",null),(0,i._)([(0,l.MZ)()],er.prototype,"geometryType",null),(0,i._)([(0,l.MZ)()],er.prototype,"geometryFieldName",null),(0,i._)([(0,l.MZ)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],er.prototype,"graphType",void 0),(0,i._)([(0,l.MZ)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],er.prototype,"graphTypeName",null),(0,i._)([(0,l.MZ)()],er.prototype,"hasM",null),(0,i._)([(0,l.MZ)()],er.prototype,"hasZ",null),(0,i._)([(0,l.MZ)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],er.prototype,"id",void 0),(0,i._)([(0,l.MZ)({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],er.prototype,"labelsVisible",void 0),(0,i._)([(0,l.MZ)({type:[B.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:function(e,t,r){let i=[["ESRI__AGGREGATION_COUNT",E.M1],["ESRI__ORIGIN_ID",E.Cz],["ESRI__DESTINATION_ID",E.KQ],["ESRI__LAYOUT_GEOMETRY",E.T1]];try{for(let t of e)for(let[e,r]of i)t.labelExpression=t.labelExpression?.replaceAll(e,r),t.labelExpressionInfo?.expression&&(t.labelExpressionInfo.expression=t.labelExpressionInfo.expression.replaceAll(e,r))}catch(e){s.A.getLogger(this).warn("Error updating labelingInfo",e)}return(0,q.w)(e,t,r)},write:K()}})],er.prototype,"labelingInfo",null),(0,i._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer?.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],er.prototype,"layerType",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(P.fV)))],er.prototype,"legendEnabled",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(P.hG)))],er.prototype,"maxScale",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(P.hn)))],er.prototype,"minScale",void 0),(0,i._)([(0,l.MZ)()],er.prototype,"objectIdField",void 0),(0,i._)([(0,l.MZ)()],er.prototype,"objectType",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(P.ke)))],er.prototype,"opacity",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(L.ne)))],er.prototype,"orderBy",void 0),(0,i._)([(0,l.MZ)({clonable:!1})],er.prototype,"parent",void 0),(0,i._)([(0,l.MZ)()],er.prototype,"parentCompositeLayer",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(P.M6)))],er.prototype,"popupEnabled",void 0),(0,i._)([(0,l.MZ)({type:n.A,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],er.prototype,"popupTemplate",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:{overridePolicy:et}}})],er.prototype,"refreshInterval",void 0),(0,i._)([(0,l.MZ)({types:Y.Hg,json:{name:"layerDefinition.drawingInfo.renderer",write:K()}})],er.prototype,"renderer",null),(0,i._)([(0,l.MZ)()],er.prototype,"source",void 0),(0,i._)([(0,l.MZ)()],er.prototype,"spatialReference",null),(0,i._)([(0,l.MZ)({type:Z.A,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:!0}}}})],er.prototype,"timeInfo",null),(0,i._)([(0,l.MZ)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],er.prototype,"title",null),(0,i._)([(0,d.K)("title")],er.prototype,"writeTitle",null),(0,i._)([(0,l.MZ)({json:{read:!1}})],er.prototype,"type",void 0),(0,i._)([(0,l.MZ)(W((0,o.o8)(D.B)))],er.prototype,"useViewTime",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{name:"visibility",write:K()}})],er.prototype,"visible",void 0);let ei=er=(0,i._)([(0,u.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],er)},69264:(e,t,r)=>{r.d(t,{cZ:()=>L,XW:()=>j,fe:()=>R});var i,n,o,s,a,l,u,d=r(39166),h=r(32391),p=r(90304);r(60729);var c=r(56599),y=r(91463);class f{constructor(){this.version="",this.queryResult=new m}}class m{constructor(){this.featureResult=new g}}class g{constructor(){this.objectIdFieldName="",this.uniqueIdField=new b,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new _,this.geometryType=null,this.spatialReference=new y.A,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new I,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}}class b{constructor(){this.name="",this.isSystemMaintained=!1}}class _{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}}class I{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new w,this.translate=new M}}class w{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}}class M{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}}class T{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}}class E{constructor(){this.attributes=[],this.compressedGeometry=new A,this.centroid=new A,this.aggregateGeometries=[]}}class A{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}}!function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"}(i||(i={}));let v=[i.ELEMENTUID,i.TYPENAME];!function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"}(n||(n={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(o||(o={}));var x=r(90369),N=r(72477);function k(e){let t=new A;t.geometryType=N.bV[e.geometry_type.value];let r=[],i=[];for(let t=0;t<e.lengths.length;t++)r.push(e.lengths[t]);for(let t=0;t<e.coords.length;t++)i.push(e.coords[t]);return t.lengths=r,t.coords=i,t}function S(e){let t=new T;return t.name=e.name,t.alias=e.alias,t.fieldType=N.r5[e.field_type.value],t.sqlType=l[e.sql_type.value],t.domain=e.domain,t.defaultValue=e.default_value,t}async function C(e){let t=[],r={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(F(e.entitiesUrl).then(e=>{O(e,r)})),e.relationshipsUrl&&t.push(F(e.relationshipsUrl).then(e=>{O(e,r)})),await Promise.all(t),r}async function L(e,t){let r={generateAllSublayers:t??=!1,namedTypeDefinitions:new Map};return await P(e).then(e=>{var t=e,i=r;for(let[e,r]of t){let t=(0,p.tE)(i.namedTypeDefinitions,e,()=>({useAllData:!1,members:new Map}));for(let e of r)t.members.has(e)||t.members.set(e,{id:e})}}),r}async function R(e){let t=await (0,x.I)(),r=new t.MapOfObjectIdentifierSets;!function(e,t,r){for(let[i,n]of r.namedTypeDefinitions){if(!n.members||n.useAllData)continue;let r=n.members.keys(),o=!1,s=!0,a=new t.ObjectIdArray,l=new t.StringArray,u=new t.GlobalIdArray,d=new t.IdentifierArray,h=new t.ObjectIdentifierSet;for(let e of r)s&&(o=!isNaN(Number(e)),s=!1),o?a.add_objectid(Number(e)):(l.add_string(e),u.add_globalid(e)),d.add_identifier(e);h.set_oid_array(a),h.set_string_array(l),h.set_globalid_array(u),h.set_identifier_array(d),a.delete(),l.delete(),u.delete(),d.delete(),e.put_identifier_set(i,h),h.delete()}}(r,t,e);let i=new t.MapOfObjectIdentifierSetsEncoder;try{i.set_map_of_identifier_sets(r),i.encode();let e=i.get_encoding_result();if(0!==e.error.error_code)throw new h.A("knowledge-graph:layer-support-utils",e.error.error_message);let t=structuredClone(e.get_byte_buffer());return i.delete(),t}finally{r.delete()}}!function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"}(s||(s={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(a||(a={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(l||(l={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(u||(u={}));async function F(e){let t=await (0,d.A)(e,{responseType:"array-buffer"});return D(await t.data)}async function D(e){let t=new(await (0,x.I)()).FeatureCollectionDecoder,r=t.decode(new Uint8Array(e));if(0!==r.error_code)throw new h.A("knowledge-graph:layer-support-utils",r.error_message);let i=function(e){let t=new f;t.version=e.version;let r=e.get_query_result();if(0!==r.results_type.value)throw Error("Got a non-feature collection type");let i=r.get_feature_result(),n=t.queryResult.featureResult;n.objectIdFieldName=i.objectid_field_name,n.exceededTransferLimit=i.exceeded_transfer_limit,n.hasM=i.has_m,n.hasZ=i.has_z,n.geometryType=N.bV[i.geometry_type.value],n.globalIdFieldName=i.globalid_field_name,n.geohashFieldName=i.geohash_field_name;let o=n.uniqueIdField,s=i.unique_id_field;o.name=s.name,o.isSystemMaintained=s.isSystemMaintained;let l=n.geometryProperties,u=i.geometry_properties;l.shapeAreaFieldName=u.shapeAreaFieldName,l.shapeLengthFieldName=u.shapeLengthFieldName,l.units=u.units;let d=n.spatialReference,h=i.spatial_reference;d.wkid=h.wkid,d.latestWkid=h.latestWkid,d.vcsWkid=h.vcsWkid,d.latestVcsWkid=h.latestVcsWkid,d.wkt=h.wkt,n.transform=function(e){let t=new I;t.quantizeOriginPosition=a[e.quantizeOriginPosition.value];let r=t.scale,i=e.scale;r.xScale=i.xScale,r.yScale=i.yScale,r.mScale=i.mScale,r.zScale=i.zScale;let n=t.translate,o=e.translate;return n.xTranslate=o.xTranslate,n.yTranslate=o.yTranslate,n.mTranslate=o.mTranslate,n.zTranslate=o.zTranslate,t}(i.transform);let p=n.fields,c=n.fieldNameToAttributeIndexMap,y=i.fields,m=y.size();for(let e=0;e<m;e++){let t=y.get(e),r=S(t);p.push(r),c[r.name]=e,t.delete()}y.delete();let g=n.values,b=i.values_count();for(let e=0;e<b;e++)g.push(i.get_value_at(e));let _=n.features,w=i.features,M=w.size();if(M>0){for(let e of v)if(void 0===c[e])throw Error(`Feature collection missing required attribute: ${e}`)}for(let e=0;e<M;e++){let t=new E,r=w.get(e),i=t.attributes,n=r.attributes_count();for(let e=0;e<n;e++)i.push(r.get_attribute_at(e));let o=r.get_compressed_geometry();o&&(t.compressedGeometry=k(o),t.centroid=k(r.get_centroid()));let s=t.aggregateGeometries,a=r.aggregate_geometries,l=a.size();for(let e=0;e<l;e++){let t=a.get(e),r=k(t);s.push(r),t.delete()}a.delete(),_.push(t),r.delete()}w.delete();let T=n.geometryFields,A=i.geometry_fields,x=A.size();for(let e=0;e<x;e++){let t=A.get(e),r=function(e){let t=S(e);return t.geometryType=N.bV[e.geometry_type.value],t}(t);T.push(r),t.delete()}return A.delete(),t}(t.get_feature_collection());return t.delete(),i}async function P(e){let t=await (0,d.A)(e,{responseType:"array-buffer"});return G(new Uint8Array(await t.data))}async function G(e){let t=new(await (0,x.I)()).MapOfObjectIdentifierSetsDecoder,r=t.decode(new Uint8Array(e)),i=new Map;if(0!==r.error_code)throw new h.A("knowledge-graph:layer-support-utils",r.error_message);let n=t.get_map_of_identifier_sets(),o=n.keys,s=o.size();for(let e=0;e<s;e++){let t=o.get(e),r=n.query_identifier_set(t),s=[];if(r.id_array_type.value===u.GLOBALID_ARRAY){let e=r.get_globalid_array(),t=e.count();for(let r=0;r<t;r++)s.push(e.get_globalid_at(r))}else if(r.id_array_type.value===u.IDENTIFIER_ARRAY){let e=r.get_identifier_array(),t=e.count();for(let r=0;r<t;r++)s.push(e.get_identifier_at(r).toString())}else if(r.id_array_type.value===u.STRING_ARRAY){let e=r.get_string_array(),t=e.count();for(let r=0;r<t;r++)s.push(e.get_string_at(r))}else{if(r.id_array_type.value!==u.OID_ARRAY)throw new h.A("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{let e=r.get_oid_array(),t=e.count();for(let r=0;r<t;r++)s.push(e.get_objectid_at(r).toString())}}i.set(t,s)}return t.delete(),i}function O(e,t){if(!e?.queryResult?.featureResult)return t;let r=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(let n of e.queryResult.featureResult.features){let e=n.attributes[r[i.TYPENAME]],o=(0,p.tE)(t.namedTypeDefinitions,e,()=>({useAllData:!1,members:new Map})),s=n.attributes[r[i.ELEMENTUID]];if(n.compressedGeometry?.coords?.length>0){let e=n.compressedGeometry.lengths;"esriGeometryPoint"===n.compressedGeometry.geometryType&&(e=[]),o.members.set(s,{id:s,linkChartLocation:new c.A(e,n.compressedGeometry.coords)})}else o.members.set(s,{id:s})}return t}let j={fetchAndConvertSerializedLinkChart:e=>C(e)}},72675:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(81856),n=r(91838);r(57845),r(61939),r(33638);var o=r(12709),s=r(51696);let a=class extends s.A{constructor(e){super(e),this.typeName=null,this.id=null}};(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"typeName",void 0),(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"id",void 0);let l=a=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.GraphNamedObject")],a)},78754:(e,t,r)=>{r.d(t,{BL:()=>l,Cz:()=>n,KQ:()=>o,M1:()=>a,T1:()=>s,dr:()=>i});let i="ESRI__ID",n="ESRI__OriginID",o="ESRI__DestID",s="ESRI__LayoutGeometry",a="ESRI__AggregationCount",l="LC.ESRI__IsSpatial"},82795:(e,t,r)=>{r.d(t,{N3:()=>a,Om:()=>s});var i=r(94264),n=r(11506),o=r(56599);class s{constructor(e=null,t={},r,i,n=0){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=i,this.displayId=n}static fromJSON(e){let t=e.geometry?o.A.fromJSON(e.geometry):null,r=e.centroid?o.A.fromJSON(e.centroid):null,i=e.objectId;return new s(t,e.attributes,r,i)}weakClone(){let e=new s(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){let e=new s(this.geometry?.clone(),{...this.attributes},this.centroid?.clone(),this.objectId);return e.displayId=this.displayId,e}ensureCentroid(e){return this.centroid??=(0,n.Q)(new o.A,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+(0,i.lM)(this.attributes)+(this.geometry?.usedMemory??0)}}function a(e){return!!e.geometry?.coords?.length}},89700:(e,t,r)=>{r.d(t,{$d:()=>y,GG:()=>x,N7:()=>f,Sx:()=>m,UQ:()=>v,di:()=>N,dt:()=>b,f3:()=>k,k_:()=>c});var i=r(70152),n=r(83610);r(57845);var o=r(55048),s=r(56911),a=r(27318),l=r(20131),u=r(34635),d=r(93165),h=r(76558);let p=new i.A("white");function c(e){if(!e)return 0;if((0,h.wk)(e)){let t=function(e){let t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,o.PN)((0,u.$4)(e)?.width)}function y(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(e=>"object"===e.type);case"line-3d":return e.symbolLayers.some(e=>"path"===e.type);case"polygon-3d":return e.symbolLayers.some(e=>"object"===e.type||"extrude"===e.type);default:return!1}}function f(e){return e.resource?.href??""}function m(e,t){if(!e)return null;let r=null;return(0,h.wk)(e)?r=function(e){let t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach(e=>{"object"===e.type&&e.resource?.href||(r="water"===e.type?e.color:e.material?e.material.color:null)}),r?new i.A(r):null}(e):(0,h.$y)(e)&&(r="cim"===e.type?(0,l.Nk)(e):e.color?new i.A(e.color):null),r?g(r,t):null}function g(e,t){if(null==t||null==e)return e;let r=e.toRgba();return r[3]=r[3]*t,new i.A(r)}function b(e,t,r){var n;e&&(t||null!=r)&&(t&&(t=new i.A(t)),(0,h.wk)(e)?function(e,t,r){let i=e.symbolLayers;if(!i)return;let n=e=>g(t=t??e??(null!=r?p:null),r);i.forEach(e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=n(e.color);else{let t=n(null!=e.material?e.material.color:null);null==e.material?e.material=new d.N({color:t}):e.material.color=t,null!=r&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=g(e.outline.color,r))}})}(e,t,r):(0,h.$y)(e)&&((n=(n=t)??e.color)&&(e.color=g(n,r)),null!=r&&"outline"in e&&e.outline?.color&&(e.outline.color=g(e.outline.color,r))))}async function _(e,t){let r=e.symbolLayers;r&&await (0,n.jJ)(r,async e=>I(e,t))}async function I(e,t){switch(e.type){case"extrude":var r;e.size="number"==typeof(r=t)[2]?r[2]:0;break;case"icon":case"line":case"text":var i=e,n=t;let o=w(n);null!=o&&(i.size=o);break;case"path":var a=e,l=t;let u=T(l,s.Un,[a.width,void 0,a.height]);a.width=A(l[0],a.width,1,u),a.height=A(l[2],a.height,1,u);break;case"object":await M(e,t)}}function w(e){for(let t of e)if("number"==typeof t)return t;return null}async function M(e,t){let{resourceSize:r,symbolSize:i}=await E(e),n=T(t,r,i);e.width=A(t[0],i[0],r[0],n),e.depth=A(t[1],i[1],r[1],n),e.height=A(t[2],i[2],r[2],n)}function T(e,t,r){for(let i=0;i<3;i++){let n=e[i];switch(n){case"symbol-value":{let e=r[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(n&&t[i])return n/t[i]}}return 1}async function E(e){let{computeObjectLayerResourceSize:t}=await r.e(7713).then(r.bind(r,37713)),i=await t(e,10),{width:n,height:o,depth:s}=e,a=[n,s,o],l=1;for(let e=0;e<3;e++){let t=a[e];if(null!=t){l=t/i[e];break}}for(let e=0;e<3;e++)null==a[e]&&(a[e]=i[e]*l);return{resourceSize:i,symbolSize:a}}function A(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return null!=t?t:r;default:return e}}async function v(e,t){if(e&&t)return(0,h.wk)(e)?_(e,t):void((0,h.$y)(e)&&function(e,t){let r=w(t);if(null!=r)switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{let t=e.width/e.height;t>1?(e.width=r,e.height=r*t):(e.width=r*t,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}(e,t))}function x(e,t,r){if(e&&null!=t)if((0,h.wk)(e)){let i=e.symbolLayers;i&&i.forEach(e=>{if("object"===e.type)switch(r){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)})}else(0,h.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function N(e){if(!e)return null;let t=e.effects.filter(e=>"bloom"!==e.type).map(e=>e.toJSON());return(0,a.zu)(t)}function k(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some(e=>"extrude"===e.type)}},90491:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(81856);r(61939),r(57845),r(33638),r(32391);var n=r(12709),o=r(51696);let s=class extends o.A{constructor(e){super(e)}},a=s=(0,i._)([(0,n.$)("esri.rest.knowledgeGraph.ObjectValue")],s)},90979:(e,t,r)=>{r.d(t,{A:()=>h});var i=r(81856),n=r(91838);r(57845),r(61939),r(33638);var o=r(12709),s=r(91463),a=r(28690);let l=class extends a.A{constructor(e){super(e),this.openCypherQuery=""}};(0,i._)([(0,n.MZ)()],l.prototype,"openCypherQuery",void 0);let u=l=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.GraphQuery")],l),d=class extends u{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,i._)([(0,n.MZ)()],d.prototype,"bindParameters",void 0),(0,i._)([(0,n.MZ)()],d.prototype,"bindGeometryQuantizationParameters",void 0),(0,i._)([(0,n.MZ)()],d.prototype,"outputQuantizationParameters",void 0),(0,i._)([(0,n.MZ)({type:s.A})],d.prototype,"outputSpatialReference",void 0),(0,i._)([(0,n.MZ)()],d.prototype,"provenanceBehavior",void 0);let h=d=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.GraphQueryStreaming")],d)},93193:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(31789),n=r(60729),o=r(82795),s=r(78754);class a{constructor(){this._featureLookup=new Map}static getInstance(){return a.instance||(a.instance=new a),a.instance}static resetInstance(){a.instance&&(a.instance=null)}deleteFromStore(e){e.forEach(e=>{this._featureLookup.delete(e)})}readFromStoreByList(e){let t=[];return e.forEach(e=>{let r=this.readFromStoreById(e);r&&t.push(r)}),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,r){let a=[];return e.forEach(e=>{if(!e?.id)return;e.properties||(e.properties=[]);let l,u=null;if(r&&e.properties[r]&&(u=(0,n.Ux)(e.properties[r])),"originId"in e&&"destinationId"in e&&(e.properties[s.Cz]=e.originId,e.properties[s.KQ]=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){let n=this._featureLookup.get(e.id),s=JSON.parse(JSON.stringify(Object.assign(n.attributes,e.properties)));r&&e.properties[r]&&(s[r]=(0,i.rS)(e.properties[r])),l=new o.Om(u?JSON.parse(JSON.stringify(u)):n?.geometry?JSON.parse(JSON.stringify(n.geometry)):null,s,null,e.properties[t])}else l=new o.Om(u?JSON.parse(JSON.stringify(u)):null,e.properties,null,e.properties[t]);this._featureLookup.set(`${e.typeName?`${e.typeName}__${e.id}`:e.id}`,l),a.push(l)}),a}}},94264:(e,t,r)=>{r.d(t,{Qf:()=>l,Qh:()=>s,RS:()=>n,ez:()=>d,i5:()=>h,lM:()=>o,qK:()=>u});var i=r(48678);let n=16;function o(e){if(!e)return 0;let t=u;for(let r in e)e.hasOwnProperty(r)&&(t+=a(e[r],!1));return t}function s(e){if(!e)return 0;if("number"==typeof e[0])return l(e);if(Array.isArray(e)){var t=e;let r=t.length;if(0===r||"number"==typeof t[0])return function(e,t){return d+e.length*t}(t,8);let i=d;for(let e=0;e<r;e++)i+=a(t[e]);return i}let r=u;for(let t in e)e.hasOwnProperty(t)&&(r+=a(e[t]));return r}function a(e,t=!0){switch(typeof e){case"object":return t?s(e):u;case"string":return 32+e.length;case"number":return n;case"boolean":return 4;default:return 8}}function l(...e){return e.reduce((e,t)=>{var r,o;return e+(t?(0,i.iu)(t)?t.byteLength+h:Array.isArray(t)?(r=t,o=n,d+r.length*o):0:0)},0)}let u=32,d=16,h=145},95573:(e,t,r)=>{r.d(t,{A:()=>u});var i=r(81856),n=r(92713),o=r(91838);r(57845),r(61939),r(33638);var s=r(12709),a=r(51696);let l=class extends n.A{constructor(e){super(e),this.path=[]}};(0,i._)([(0,o.MZ)({type:[a.A],json:{write:!0}})],l.prototype,"path",void 0);let u=l=(0,i._)([(0,s.$)("esri.rest.knowledgeGraph.Path")],l)}}]);