"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7202],{7202:(e,t,r)=>{let n,i,o;r.r(t),r.d(t,{destroyContext:()=>R,dracoDecompressPointCloudData:()=>E,filterObbsForModifications:()=>L,filterObbsForModificationsSync:()=>C,initialize:()=>j,interpretObbModificationResults:()=>k,process:()=>B,project:()=>x,setLegacySchema:()=>P,setModifications:()=>N,setModificationsSync:()=>U,test:()=>H,transformNormals:()=>F});var s,a,l,f,c,u,d,h=r(20538),y=r(91463),m=r(76277),p=r(61102),b=r(78863);!function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"}(s||(s={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}(a||(a={}));var g=r(81048);function _(e){return(0,g.s)(`esri/libs/i3s/${e}`)}r(61939);var w=r(87196),v=r(56911),M=r(7859);r(65111),r(9892);class S{constructor(e,t,r,n,i,o){this.layout=e,this.interleavedVertexData=t,this.indices=r,this.hasColors=n,this.hasModifications=i,this.positionData=o}}class A{constructor(e,t,r,n,i,o,s){this.componentOffsets=e,this.featureIds=t,this.anchorIds=r,this.anchors=n,this.transformedGeometry=i,this.globalTrafo=o,this.obb=s}}async function B(e){o=await D();let t=[e.geometryBuffer];return{result:T(o,e,t),transferList:t}}async function E(e){o=await D();let t=[e.geometryBuffer],{geometryBuffer:r}=e,n=r.byteLength,i=o._malloc(n),s=new Uint8Array(o.HEAPU8.buffer,i,n);s.set(new Uint8Array(r));let a=o.dracoDecompressPointCloudData(i,s.byteLength);if(o._free(i),a.error.length>0)throw Error(`i3s.wasm: ${a.error}`);let l=a.featureIds?.length>0?a.featureIds.slice():null,f=a.positions.slice();return l&&t.push(l.buffer),t.push(f.buffer),{result:{positions:f,featureIds:l},transferList:t}}async function L(e){await D(),C(e);let t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function N(e){await D(),U(e)}async function P(e){(o=await D()).setLegacySchema(e.context,e.jsonSchema)}async function x(e){let t,{localMatrix:n,origin:i,positions:o,vertexSpace:s}=e,a=y.A.fromJSON(e.inSpatialReference),l=y.A.fromJSON(e.outSpatialReference),[{projectBuffer:f},{initializeProjection:c}]=await Promise.all([Promise.resolve().then(r.bind(r,70983)),Promise.resolve().then(r.bind(r,65111))]);await c(a,l);let u=[0,0,0];if(!f(i,a,0,u,l,0))throw Error("Failed to project");if("georeferenced"===s.type&&null==s.origin){if(t=new Float64Array(o.length),!f(o,a,0,t,l,0,t.length/3))throw Error("Failed to project")}else{let e="georeferenced"===s.type?m.A.fromJSON(s):p.A.fromJSON(s),{projectMeshVertexPositions:i}=await r.e(3575).then(r.bind(r,93575)),f=i({vertexAttributes:{position:o},transform:n?{localMatrix:n}:void 0,vertexSpace:e,spatialReference:a},l);if(!f)throw Error("Failed to project");t=f}let d=t.length,[h,b,g]=u;for(let e=0;e<d;e+=3)t[e]-=h,t[e+1]-=b,t[e+2]-=g;return{result:{projected:t,original:o,projectedOrigin:u},transferList:[t.buffer,o.buffer]}}async function F({normalMatrix:e,normals:t}){let r=new Float32Array(t.length);return(0,b.b)(r,t,e),(0,h.or)(e)&&(0,b.n)(r,r),{result:{transformed:r,original:t},transferList:[r.buffer,t.buffer]}}function R(e){I(e)}function U(e){if(!o)return;let t=e.modifications,r=o._malloc(8*t.length),n=new Float64Array(o.HEAPU8.buffer,r,t.length);for(let e=0;e<t.length;++e)n[e]=t[e];o.setModifications(e.context,r,t.length,e.isGeodetic),o._free(r)}function T(e,t,r){let{context:n,globalTrafo:i,mbs:o,obbData:a,elevationOffset:l,geometryBuffer:f,geometryDescriptor:c,indexToVertexProjector:u,vertexToRenderProjector:d}=t,h=e._malloc(f.byteLength),y=e._malloc(33*Float64Array.BYTES_PER_ELEMENT),m=new Uint8Array(e.HEAPU8.buffer,h,f.byteLength);m.set(new Uint8Array(f));let p=new Float64Array(e.HEAPU8.buffer,y,33);O(p,[NaN,NaN,NaN]);let b=p.byteOffset+3*p.BYTES_PER_ELEMENT,g=new Float64Array(p.buffer,b);O(g,i),b+=16*p.BYTES_PER_ELEMENT,O(g=new Float64Array(p.buffer,b),o),b+=4*p.BYTES_PER_ELEMENT,a&&O(g=new Float64Array(p.buffer,b),a);let _={isDraco:!1,isLegacy:!1,color:t.layouts.some(e=>e.some(e=>"color"===e.name)),normal:t.needNormals&&t.layouts.some(e=>e.some(e=>"normalCompressed"===e.name)),uv0:t.layouts.some(e=>e.some(e=>"uv0"===e.name)),uvRegion:t.layouts.some(e=>e.some(e=>"uvRegion"===e.name)),featureIndex:c.featureIndex},w=e.process(n,!!t.obbData,h,m.byteLength,c,_,y,l,u,d,t.normalReferenceFrame);if(e._free(y),e._free(h),w.error.length>0)throw Error(`i3s.wasm: ${w.error}`);if(w.discarded)return null;let v=w.componentOffsets.length>0?w.componentOffsets.slice():null,M=w.featureIds.length>0?w.featureIds.slice():null,B=w.anchorIds.length>0?Array.from(w.anchorIds):null,E=w.anchors.length>0?Array.from(w.anchors):null,L=w.interleavedVertedData.slice().buffer,N=w.indicesType===s.Int16?new Uint16Array(w.indices.buffer,w.indices.byteOffset,w.indices.byteLength/2).slice():new Uint32Array(w.indices.buffer,w.indices.byteOffset,w.indices.byteLength/4).slice(),P=w.positions.slice(),{buffer:x,byteOffset:F,byteLength:R}=w.positionIndices,U=w.positionIndicesType===s.Int16?new Uint16Array(x,F,R/2).slice():new Uint32Array(x,F,R/4).slice(),T=new S(t.layouts[0],L,N,w.hasColors,w.hasModifications,{data:P,indices:U});return M&&r.push(M.buffer),v&&r.push(v.buffer),r.push(L),r.push(N.buffer),r.push(P.buffer),r.push(U.buffer),new A(v,M,B,E,T,i,w.obb)}function k(e){return 0===e?f.Unmodified:1===e?f.PotentiallyModified:2===e?f.Culled:f.Unknown}function C(e){if(!o)return;let{context:t,buffer:r}=e,n=o._malloc(r.byteLength),i=r.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(o.HEAPU8.buffer,n,i),a=new Float64Array(r);s.set(a),o.filterOBBs(t,n,i),a.set(s),o._free(n)}function I(e){o&&0===o.destroy(e)&&(o=null)}function O(e,t){for(let r=0;r<t.length;++r)e[r]=t[r]}async function j(){o||await D()}async function D(){return o||(o=await (i??=(n||(n=new Promise(e=>r.e(9529).then(r.bind(r,19529)).then(e=>e.i).then(({default:t})=>{let r=t({locateFile:_,onRuntimeInitialized:()=>e(r)});delete r.then})).catch(e=>{throw e})),n))),o}M.B,new w.A({deallocator:null}),(0,v.vt)(),r(44120),r(7916),r(32035),function(e){e[e.Unmodified=0]="Unmodified",e[e.Culled=1]="Culled",e[e.NotChecked=2]="NotChecked"}(l||(l={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked"}(f||(f={})),function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached"}(c||(c={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"}(u||(u={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf"}(d||(d={}));let H={transform:(e,t)=>o&&T(o,e,t),destroy:I}},7859:(e,t,r)=>{r.d(t,{B:()=>l});var n=r(31461),i=r(19158),o=r(61939),s=r(92753),a=r(6675);class l{constructor(e,t,r,n,i={}){this._mainMethod=t,this._transferLists=r,this._listeners=[],this._promise=(0,a.ho)(e,{...i,schedule:n}).then(e=>{if(void 0===this._thread)for(let t of(this._thread=e,this._promise=null,i.hasInitialize&&this.broadcast({},"initialize"),this._listeners))this._connectListener(t);else e.close()}),this._promise.catch(t=>o.A.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${t}`))}on(e,t){let r={removed:!1,eventName:e,callback:t,threadHandle:null};return this._listeners.push(r),this._connectListener(r),(0,i.hA)(()=>{r.removed=!0,(0,n.TF)(this._listeners,r),this._thread&&null!=r.threadHandle&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,r){if(this._thread){let n=this._transferLists[e],i=n?n(t):[];return this._thread.invoke(e,t,{transferList:i,signal:r})}return this._promise?this._promise.then(()=>((0,s.Te)(r),this.invokeMethod(e,t,r))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,t)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(t=>{e.removed||(e.threadHandle=t)})}}},61102:(e,t,r)=>{r.d(t,{A:()=>u});var n=r(81856),i=r(71017),o=r(92713),s=r(91838);r(57845),r(61939),r(33638);var a=r(33498),l=r(12709),f=r(56911);let c=class extends i.A.ClonableMixin(o.A){constructor(e){super(e),this.type="local",this.origin=(0,f.vt)()}};(0,n._)([(0,a.e)({local:"local"},{readOnly:!0})],c.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"origin",void 0);let u=c=(0,n._)([(0,l.$)("esri.geometry.support.MeshLocalVertexSpace")],c)},76277:(e,t,r)=>{r.d(t,{A:()=>u});var n,i=r(81856),o=r(71017),s=r(92713),a=r(91838);r(57845),r(61939),r(33638);var l=r(33498),f=r(12709);let c=n=class extends o.A.ClonableMixin(s.A){constructor(e){super(e),this.type="georeferenced",this.origin=null}};c.absolute=new n,(0,i._)([(0,l.e)({georeferenced:"georeferenced"},{readOnly:!0})],c.prototype,"type",void 0),(0,i._)([(0,a.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],c.prototype,"origin",void 0);let u=c=n=(0,i._)([(0,f.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],c)},78863:(e,t,r)=>{r.d(t,{a:()=>u,b:()=>a,c:()=>s,d:()=>i,e:()=>d,f:()=>c,l:()=>f,n:()=>h,t:()=>o});var n=r(50737);function i(e,t,r){o(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function o(e,t,r,n=3,i=n){if(e.length/n!==Math.ceil(t.length/i))return e;let s=e.length/n,a=r[0],l=r[1],f=r[2],c=r[4],u=r[5],d=r[6],h=r[8],y=r[9],m=r[10],p=r[12],b=r[13],g=r[14],_=0,w=0;for(let r=0;r<s;r++){let r=t[_],o=t[_+1],s=t[_+2];e[w]=a*r+c*o+h*s+p,e[w+1]=l*r+u*o+y*s+b,e[w+2]=f*r+d*o+m*s+g,_+=i,w+=n}return e}function s(e,t,r){a(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function a(e,t,r,n=3,i=n){if(e.length/n!==Math.ceil(t.length/i))return;let o=e.length/n,s=r[0],l=r[1],f=r[2],c=r[3],u=r[4],d=r[5],h=r[6],y=r[7],m=r[8],p=0,b=0;for(let r=0;r<o;r++){let r=t[p],o=t[p+1],a=t[p+2];e[b]=s*r+c*o+h*a,e[b+1]=l*r+u*o+y*a,e[b+2]=f*r+d*o+m*a,p+=i,b+=n}}function l(e,t,r,n=3,i=n){let o=Math.min(e.length/n,t.length/i),s=0,a=0;for(let l=0;l<o;l++)e[a]=r*t[s],e[a+1]=r*t[s+1],e[a+2]=r*t[s+2],s+=i,a+=n;return e}function f(e,t,r,n){c(e.typedBuffer,t.typedBuffer,r,n,e.typedBufferStride,t.typedBufferStride)}function c(e,t,r,i,o=3,s=o){let a=Math.min(e.length/o,t.length/s),l=0,f=0,u=1/n.Tf;for(let n=0;n<a;n++)e[f]=i*(r*t[l])**u,e[f+1]=i*(r*t[l+1])**u,e[f+2]=i*(r*t[l+2])**u,l+=s,f+=o}function u(e,t,r,n=3,i=n){let o=e.length/n;if(o!==Math.ceil(t.length/i))return e;let s=0,a=0;for(let l=0;l<o;l++)e[a]=t[s]+r[0],e[a+1]=t[s+1]+r[1],e[a+2]=t[s+2]+r[2],s+=i,a+=n;return e}function d(e,t){h(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function h(e,t,r=3,n=r){let i=Math.min(e.length/r,t.length/n),o=0,s=0;for(let a=0;a<i;a++){let i=t[o],a=t[o+1],l=t[o+2],f=i*i+a*a+l*l;if(f>0){let t=1/Math.sqrt(f);e[s]=t*i,e[s+1]=t*a,e[s+2]=t*l}o+=n,s+=r}}r(57845),r(61939),Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:c,linearToSRGBView:f,normalize:h,normalizeView:d,scale:l,scaleView:function(e,t,r){l(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)},shiftRight:function(e,t,r){let n=Math.min(e.count,t.count),i=e.typedBuffer,o=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,l=0,f=0;for(let e=0;e<n;e++)i[f]=s[l]>>r,i[f+1]=s[l+1]>>r,i[f+2]=s[l+2]>>r,l+=a,f+=o},transformMat3:a,transformMat3View:s,transformMat4:o,transformMat4View:i,translate:u},Symbol.toStringTag,{value:"Module"}))}}]);